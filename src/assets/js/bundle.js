/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {var CookieUtils = {\n  getCookieValue: function (a, b) {\n    b = document.cookie.match('(^|;)\\\\s*' + a + '\\\\s*=\\\\s*([^;]+)');\n    return b ? b.pop() : '';\n  }\n};\n\n// if running in a node environment export this as a module.\nif (true) {\n  module.exports = CookieUtils;\n}\n\n\n\n\n// The florence object is used for storing application state.\nvar Florence = Florence || {\n        babbageBaseUrl: window.location.origin,\n        refreshAdminMenu: function () {\n            // Display a message to show users are on dev or sandpit\n            Florence.environment = isDevOrSandpit();\n\n            var mainNavHtml = templates.mainNav(Florence);\n            $('.js-nav').html(mainNavHtml);\n        },\n        setActiveCollection: function (collection) {\n            document.cookie = \"collection=\" + collection.id + \";path=/\";\n            if (!collection.publishDate) {\n                var formattedDate = null;\n            } else {\n                var formattedDate = StringUtils.formatIsoDateString(collection.publishDate);\n            }\n            Florence.collection = {\n                id: collection.id,\n                name: collection.name,\n                date: formattedDate,\n                publishDate: collection.publishDate,\n                type: collection.type\n            };\n        }\n    };\n\n\nFlorence.Editor = {\n    isDirty: false,\n    data: {}\n};\n\nFlorence.CreateCollection = {\n    selectedRelease: \"\"\n};\n\nFlorence.collection = {};\n\nFlorence.collectionToPublish = {};\n\nFlorence.globalVars = {pagePath: '', activeTab: false, pagePos: '', welsh: false};\n\nFlorence.Authentication = {\n    accessToken: function () {\n        return CookieUtils.getCookieValue(\"access_token\");\n    },\n    isAuthenticated: function () {\n        return Florence.Authentication.accessToken() !== '';\n    },\n    loggedInEmail: function () {\n        return localStorage.getItem(\"loggedInAs\");\n    },\n    userType: function() {\n        return localStorage.getItem(\"userType\");\n    }\n};\n\nFlorence.Handler = function (e) {\n    if (Florence.Editor.isDirty) {\n        var result = confirm(\"You have unsaved changes. Are you sure you want to continue?\");\n        if (result === true) {\n            Florence.Editor.isDirty = false;\n            processPreviewLoad();\n            return true;\n        } else {\n            e.preventDefault();\n            return false;\n        }\n    }\n};\n\n// Add base url to Redux for use in refactored JS\nvar baseUrlState = __webpack_require__(8);\nbaseUrlState.set(window.location.origin);\n\n// if running in a node environment export this as a module.\nif (true) {\n    module.exports = Florence;\n}\n\n\nvar PathUtils = {\n  isJsonFile: function (uri) {\n    return uri.indexOf('data.json', uri.length - 'data.json'.length) !== -1;\n  }\n};\n\n// if running in a node environment export this as a module.\nif (true) {\n  module.exports = PathUtils;\n}\n\n\n\n\nvar StringUtils = {\n  textareaLines: function (line, maxLineLength, start, numberOfLinesCovered) {\n\n    if (start + maxLineLength >= line.length) {\n      //console.log('Line Length = ' + numberOfLinesCovered);\n      return numberOfLinesCovered;\n    }\n\n    var substring = line.substr(start, maxLineLength + 1);\n    var actualLineLength = substring.lastIndexOf(' ') + 1;\n\n    if (actualLineLength === maxLineLength) // edge case - the break is at the end of the line exactly with a space after it\n    {\n      actualLineLength--;\n    }\n\n    if (start + actualLineLength === line.length) {\n      return numberOfLinesCovered;\n    }\n\n    if (actualLineLength === 0) {\n      actualLineLength = maxLineLength;\n    }\n\n    //if(numberOfLinesCovered < 30) {\n    //  console.log('Line: ' + numberOfLinesCovered + ' length = ' + actualLineLength);\n    //}\n    return StringUtils.textareaLines(line, maxLineLength, start + actualLineLength, numberOfLinesCovered + 1);\n  },\n\n  formatIsoDateString: function (input) {\n    var date = new Date(input);\n    var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\n    var formattedDate = $.datepicker.formatDate('dd/mm/yy', date) + ' ' + date.getHours() + ':' + minutes;\n    return formattedDate;\n  },\n\n  formatIsoFullDateString: function (input) {\n    var date = new Date(input);\n//    var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\n    var formattedDate = $.datepicker.formatDate('DD dd MM yy', date);        //+ ' ' + date.getHours() + ':' + minutes;\n    return formattedDate;\n  },\n\n  formatIsoFull: function (input) {\n    var date = new Date(input);\n    var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\n    var formattedDate = $.datepicker.formatDate('DD dd MM yy', date) + ' ' + date.getHours() + ':' + minutes;\n    return formattedDate;\n  },\n\n  formatIsoFullSec: function (input) {\n    var date = new Date(input);\n    var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\n    var seconds = (date.getSeconds() < 10 ? '0' : '') + date.getSeconds();\n    var formattedDate = $.datepicker.formatDate('DD dd MM yy', date) + ' ' + date.getHours() + ':' + minutes + ':' + seconds;\n    return formattedDate;\n  },\n\n  randomId: function () {\n    var S4 = function () {\n      return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n    };\n    return (S4() + S4());\n  }\n\n};\n\n// if running in a node environment export this as a module.\nif (true) {\n  module.exports = StringUtils;\n}\n\nfunction deleteCollection(collectionId, success, error) {\n  $.ajax({\n    url: \"/zebedee/collection/\" + collectionId,\n    type: 'DELETE',\n    success: function (response) {\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction deleteContent(collectionId, path, success, error) {\n  var safePath = checkPathSlashes(path);\n  // send ajax call\n  $.ajax({\n    url: \"/zebedee/content/\" + collectionId + \"?uri=\" + safePath,\n    type: 'DELETE',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction deleteEquation(collectionId, path, success, error) {\n  var safePath = checkPathSlashes(path);\n  $.ajax({\n    url: \"/zebedee/equation/\" + collectionId + \"?uri=\" + safePath,\n    type: 'DELETE',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction getCollection(collectionId, success, error) {\n  return $.ajax({\n    url: \"/zebedee/collection/\" + collectionId,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      error(response);\n    }\n  });\n}\n\nfunction getCollectionDetails(collectionId, success, error) {\n  return $.ajax({\n    url: \"/zebedee/collectionDetails/\" + collectionId,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      error(response);\n    }\n  });\n}\n/**\n * Gets the JSON file for the page\n * @param collectionId\n * @param path\n * @param success\n * @param error\n * @returns {*}\n */\n\nfunction getPageData(collectionId, path, success, error) {\n  var safePath = checkPathSlashes(path);\n  return $.ajax({\n    url: \"/zebedee/data/\" + collectionId + \"?uri=\" + safePath,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * Get page data with only the page description.\n * @param collectionId\n * @param path\n * @param success\n * @param error\n * @returns {*}\n */\nfunction getPageDataDescription(collectionId, path, success, error) {\n  return $.ajax({\n    url: \"/zebedee/data/\" + collectionId + \"?uri=\" + path + '&description',\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * Get page data with only the page title.\n * @param collectionId\n * @param path\n * @param success\n * @param error\n * @returns {*}\n */\nfunction getPageDataTitle(collectionId, path, success, error) {\n  return $.ajax({\n    url: \"/zebedee/data/\" + collectionId + \"?uri=\" + path + '&title',\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction getBabbagePageData(collectionId, path, success, error) {\n  return $.ajax({\n    url: path + '/data',\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\nfunction getPageResource(collectionId, path, success, error) {\n  var safePath = checkPathSlashes(path);\n  return $.ajax({\n    url: \"/zebedee/resource/\" + collectionId + \"?uri=\" + safePath,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * Http post to the zebedee API to get a list of teams.\n * @param success\n * @param error\n * @param name (to get specific details)\n * @returns {*}\n */\nfunction getTeams(success, error, name) {\n\n  var url = \"/zebedee/teams\";\n\n  if(name) {\n    url += '/' + name;\n  }\n\n  return $.ajax({\n    url: url,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      error(response);\n    }\n  });\n}\n\n/**\n * Http post to the zebedee API to get a list of user permissions.\n * @param success\n * @param error\n * @param userId\n * @returns {*}\n */\nfunction getUserPermission(success, error, userId) {\n\n  var url = \"/zebedee/permission?email=\" + userId;\n\n\n  return $.ajax({\n    url: url,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      error(response);\n    }\n  });\n}\n\n/**\n * Http post to the zebedee API to get a list of users.\n * @param success\n * @param error\n * @param userId\n * @returns {*}\n */\nfunction getUsers(success, error, userId) {\n\n  var url = \"/zebedee/users\";\n\n  if(userId) {\n    url += '?email=' + userId;\n  }\n\n  return $.ajax({\n    url: url,\n    dataType: 'json',\n    type: 'GET',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      error(response);\n    }\n  });\n}\nfunction moveContent(collectionId, path, newPath, success, error) {\n  $.ajax({\n    url: \"/zebedee/contentmove/\" + collectionId + \"?uri=\" + checkPathSlashes(path) + \"&toUri=\" + checkPathSlashes(newPath),\n    type: 'POST',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * HTTP post to the zebedee API to set a new password\n * @param success - function to run on success\n * @param error - function to run on error\n * @param email - the email address of the user to change the password for\n * @param password - the password to set\n * @param oldPassword - the current password of the user if they are not already authenticated\n */\nfunction postPassword(success, error, email, password, oldPassword) {\n  $.ajax({\n    url: \"/zebedee/password\",\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'POST',\n    data: JSON.stringify({\n      password: password,\n      email: email,\n      oldPassword: oldPassword\n    }),\n    success: function () {\n      if(success) {\n        success();\n      }\n    },\n    error: function (response) {\n      if(error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}/**\n * Post to the zebedee API permission endpoint.\n * Set permissions for the given email address.\n * @param success\n * @param error\n * @param email - The email of the user to set permissions for\n * @param admin - boolean true if the user should be given admin permissions\n * @param editor - boolean true if the user should be given editor permissions\n */\nfunction postPermission(success, error, email, admin, editor, dataVisPublisher) {\n  $.ajax({\n    url: \"/zebedee/permission\",\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'POST',\n    data: JSON.stringify({\n      email: email,\n      admin: admin,\n      dataVisPublisher: dataVisPublisher,\n      editor: editor\n    }),\n    success: function () {\n      if(success) {\n        success();\n      }\n    },\n    error: function (response) {\n      if(error) {\n        error(response);\n      } else {\n        if (response.status === 403 || response.status === 401) {\n          sweetAlert(\"You are not permitted to update permissions.\")\n        } else {\n          handleApiError(response);\n        }\n      }\n    }\n  });\n}function putContent(collectionId, path, content, success, error, recursive) {\n  postContent(collectionId, path, content, true, recursive,\n    onSuccess = function () {\n      if(success) {\n        success();\n      }\n    },\n    onError = function (response) {\n      if (error) {\n        error(response);\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\nfunction addDeleteMarker(uri, title, success) {\n\n    var deleteTarget = {\n        uri: uri,\n        user: localStorage.getItem('loggedInAs'),\n        title: title,\n        collectionId: Florence.collection.id\n     };\n\n    $.ajax({\n        url: \"/zebedee/DeleteContent/\",\n        type: 'POST',\n        data: JSON.stringify(deleteTarget),\n        dataType: 'json',\n        contentType: 'application/json',\n        cache: false,\n        success: function (response) {\n            if (success)\n                success(response);\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n}\n\nfunction removeDeleteMarker(uri, success) {\n    $.ajax({\n        url: \"/zebedee/DeleteContent/\" + Florence.collection.id + \"?uri=\" + uri,\n        type: 'DELETE',\n        dataType: 'json',\n        contentType: 'application/json',\n        cache: false,\n        success: function (response) {\n            if (success)\n                success(response);\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n}\nsetupFlorence();/**\n * Keeps the accordion open in the tab specified\n * @param active - the active tab\n */\n\nfunction accordion(active) {\n  var activeTab = parseInt(active);\n  if(!activeTab){\n    activeTab = 'none';\n  }\n  $(function () {\n    $(\".edit-accordion\").accordion(\n      {\n        header: \"div.edit-section__head\",\n        heightStyle: \"content\",\n        active: activeTab,\n        collapsible: true\n      }\n    );\n  });\n}\n$('.section').bind('DOMSubtreeModified', function (){\n\t$('.auto-size').textareaAutoSize();\n});\n\n/**\n * Checks for changes in the iframe path\n * @param onChanged - function\n */\nfunction checkForPageChanged(onChanged) {\n    var iframeUrl = Florence.globalVars.pagePath;\n    var nowUrl = $('#iframe')[0].contentWindow.document.location.pathname;\n\n    // Only update URL if it's different and it's got a valid value (ie not 'blank')\n    if (iframeUrl !== nowUrl && !(nowUrl === \"/blank\" || nowUrl === \"blank\")) {\n        Florence.globalVars.activeTab = false;\n        Florence.globalVars.pagePos = '';\n        if (!onChanged) {\n            Florence.globalVars.pagePath = nowUrl;\n        } else {\n            onChanged(nowUrl);\n        }\n    }\n}\n\n/**\n * Checks a valid link\n * @param uri\n * @returns {*} - if valid returns a formatted valid link\n */\n\nfunction checkPathParsed (uri) {\n  if (uri.match(/^(https?|ftp):\\/\\/(([a-z0-9$_\\.\\+!\\*\\'\\(\\),;\\?&=-]|%[0-9a-f]{2})+(:([a-z0-9$_\\.\\+!\\*\\'\\(\\),;\\?&=-]|%[0-9a-f]{2})+)?@)?((([a-z0-9]\\.|[a-z0-9][a-z0-9-]*[a-z0-9]\\.)*[a-z][a-z0-9-]*[a-z0-9]|((\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5]))(:\\d+)?)(((\\/+([a-z0-9$_\\.\\+!\\*\\'\\(\\),;:@&=-]|%[0-9a-f]{2})*)*(\\?([a-z0-9$_\\.\\+!\\*\\'\\(\\),;:@&=-]|%[0-9a-f]{2})*)?)?)?(#([a-z0-9$_\\.\\+!\\*\\'\\(\\),;:@&=-]|%[0-9a-f]{2})*)?/i)) {\n    var myUrl = parseURL(uri);\n    var safeUrl = myUrl.pathname;\n    if (safeUrl.charAt(safeUrl.length-1) === '/') {\n      safeUrl = safeUrl.slice(0, -1);\n    }\n  return safeUrl;\n  } else {\n    sweetAlert('This is not a valid link');\n    return false;\n  }\n}\n/**\n * Checks for initial slash and no trailing slash\n * @param uri\n * @returns {*} - valid format\n */\nfunction checkPathSlashes (uri) {\n  var checkedUri = uri[uri.length - 1] === '/' ? uri.substring(0, uri.length - 1) : uri;\n  checkedUri = checkedUri[0] !== '/' ? '/' + checkedUri : checkedUri;\n  return checkedUri;\n}\n\n/**\n * When content is saved check if the changes made require us to rename the content, i.e. change the uri.\n * @param collectionId\n * @param data\n * @param renameUri\n * @param onSave\n */\nfunction checkRenameUri(collectionId, data, renameUri, onSave) {\n\n    if (renameUri && !data.description.language && !data.description.edition) {   // It will not change welsh url + do not rename content with edition.\n        doRename();\n    } else {\n        onSave(collectionId, data.uri, JSON.stringify(data));\n    }\n\n    function doRename() {\n        // Does it have edition?\n        if (data.description.edition) {\n            // CH 29/04/2016 disabling the URI change of content with an edition as it breaks the link of previous editions\n            //moveContentWithEditionInUri();\n            onSave(collectionId, data.uri, JSON.stringify(data));\n        } else if (data.type === 'static_adhoc') {\n            moveAdHoc();\n        } else {\n            moveContentWithoutEdition();\n        }\n    }\n\n    function moveAdHoc() {\n        var titleNoSpace = data.description.title.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        var referenceNoSpace = data.description.reference.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        var tmpNewUri = data.uri.split(\"/\");\n        tmpNewUri.splice([tmpNewUri.length - 1], 1, referenceNoSpace + titleNoSpace);\n        var newUri = tmpNewUri.join(\"/\");\n\n        putContent(collectionId, data.uri, JSON.stringify(data), function () {\n            moveContent(collectionId, data.uri, newUri, function () {\n                getPageData(collectionId, newUri, function (pageData) { // get the updated data after doing the move.\n                        data = pageData;\n                        Florence.globalVars.pagePath = newUri;\n                        ;\n                        onSave(collectionId, newUri, JSON.stringify(data));\n                    },\n                    onError = function () {\n                        onSave(collectionId, data.uri, JSON.stringify(data));\n                    });\n            });\n        });\n\n        return titleNoSpace;\n    }\n\n    function moveContentWithEditionInUri() {\n        //Special case dataset editions. They have edition but not title\n        if (data.description.title) {\n            var titleNoSpace = data.description.title.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        }\n        var editionNoSpace = data.description.edition.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        var tmpNewUri = data.uri.split(\"/\");\n        if (data.type === 'dataset') {\n            tmpNewUri.splice([tmpNewUri.length - 1], 1, editionNoSpace);\n        } else {\n            tmpNewUri.splice([tmpNewUri.length - 2], 2, titleNoSpace, editionNoSpace);\n        }\n\n        var newUri = tmpNewUri.join(\"/\");\n\n        // save any changes before actually doing the move\n        putContent(collectionId, data.uri, JSON.stringify(data), function () {\n            moveContent(collectionId, data.uri, newUri, function () {\n                    getPageData(collectionId, newUri, function (pageData) { // get the updated data after doing the move.\n                        data = pageData;\n\n                        Florence.globalVars.pagePath = newUri;\n                        //is it a compendium? Rename children array\n                        //take this out if moveContent in Zebedee works\n                        if (data.type === 'compendium_landing_page') {\n                            if (data.chapters) {\n                                data.chapters = renameCompendiumChildren(data.chapters, titleNoSpace, editionNoSpace);\n                            }\n                            if (data.datasets) {\n                                data.datasets = renameCompendiumChildren(data.datasets, titleNoSpace, editionNoSpace);\n                            }\n                        }\n                        onSave(collectionId, newUri, JSON.stringify(data));\n                    });\n                },\n                onError = function () {\n                    onSave(collectionId, data.uri, JSON.stringify(data));\n                });\n        });\n    }\n\n    function moveContentWithoutEdition() {\n        var titleNoSpace = data.description.title.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        var tmpNewUri = data.uri.split(\"/\");\n        //Articles with no edition. Add date as edition\n        if (data.type === 'article' || data.type === 'article_download') {\n            console.log(data.description.releaseDate);\n            var editionDate = $.datepicker.formatDate('yy-mm-dd', new Date(data.description.releaseDate));\n            tmpNewUri.splice([tmpNewUri.length - 2], 2, titleNoSpace, editionDate);\n        } else {\n            tmpNewUri.splice([tmpNewUri.length - 1], 1, titleNoSpace);\n        }\n        var newUri = tmpNewUri.join(\"/\");\n\n        putContent(collectionId, data.uri, JSON.stringify(data), function () {\n            moveContent(collectionId, data.uri, newUri, function () {\n                    getPageData(collectionId, newUri, function (pageData) { // get the updated data after doing the move.\n                        data = pageData;\n\n                        Florence.globalVars.pagePath = newUri;\n                        //if it is a dataset rename children array\n                        //take this out if moveContent in Zebedee works\n                        if (data.type === 'dataset_landing_page') {\n                            if (data.datasets) {\n                                data.datasets = renameDatasetChildren(data.datasets, titleNoSpace);\n                            }\n                        }\n                        onSave(collectionId, newUri, JSON.stringify(data));\n                    });\n                },\n                onError = function () {\n                    onSave(collectionId, data.uri, JSON.stringify(data));\n                });\n        });\n    }\n}\n/**\n * Return the last edited event for the given page, from the given collection.\n * @param collection\n * @param page\n * @returns {*}\n */\nfunction getLastEditedEvent(collection, page) {\n\n  var uri = page;\n  var safeUri = checkPathSlashes(uri);\n\n  var pageEvents = collection.eventsByUri[safeUri];\n\n  var lastEditedEvent = _.chain(pageEvents)\n    .filter(function (event) {\n      return event.type === 'EDITED';\n    })\n    .sortBy(function (event) {\n      return event.date;\n    })\n    .last()\n    .value();\n\n  return lastEditedEvent;\n}\n\n/**\n * Return the collection created event from the given collection of events.\n * @param events\n * @returns {*}\n */\nfunction getCollectionCreatedEvent(events) {\n\n  var event = _.chain(events)\n    .filter(function (event) {\n      return event.type === 'CREATED';\n    })\n    .last()\n    .value();\n\n  return event;\n}\n\n/**\n * Return the last completed event for the given page, from the given collection.\n * @param collection\n * @param page\n * @returns {*}\n */\nfunction getLastCompletedEvent(collection, page) {\n\n  var uri = page;\n  var safeUri = checkPathSlashes(uri);\n\n   var lastCompletedEvent;\n\n  if (collection.eventsByUri) {\n    var pageEvents = collection.eventsByUri[safeUri];\n    if (pageEvents) {\n      lastCompletedEvent = _.chain(pageEvents)\n        .filter(function (event) {\n          return event.type === 'COMPLETED';\n        })\n        .sortBy(function (event) {\n          return event.date;\n        })\n        .last()\n        .value();\n    }\n  }\n  return lastCompletedEvent;\n}\n\n// Copy chart markdown to clipboard (clipboard.js plugin)\nvar clipboard = null;\nfunction initialiseClipboard() {\n    var i;\n\n    // Add index to any trigger/target that will use clipboard.js so we can identify each element individually\n    $('.copy-markdown').each(function(index) {\n        var $this = $(this);\n        if (!$this.hasClass('copy-markdown_' + index)) {\n            $this.addClass('copy-markdown_' + index).attr('data-clipboard-index', index);\n            $this.closest('.edit-section__sortable-item').find('.copy-markdown-target').attr('id', 'copy-markdown-target_' + index);\n            $this.find('.tick-animation-trigger').addClass('tick-animation-trigger_' + index);\n        }\n    });\n\n    // Fire clipboard initialisation\n    clipboard = new Clipboard('.copy-markdown', {\n        target: function(trigger) {\n            i = $(trigger).attr('data-clipboard-index');\n            return document.getElementById('copy-markdown-target_' + i);\n        }\n    });\n    clipboard.on('success', function(e) {\n        toggleTick(i, \"show\");\n        setTimeout(function() {\n            toggleTick(i, \"hide\")\n        }, 2000);\n        e.clearSelection();\n    });\n    clipboard.on('error', function(e) {\n        console.log(\"Error copying markdown\");\n        console.error('Action:', e.action);\n        console.error('Trigger:', e.trigger);\n    });\n\n    // Switch 'done' tick on and off\n    function toggleTick(i, state) {\n        if (state == \"show\") {\n            $(\".copy-markdown_\" + i).attr(\"style\", \"color:transparent;\");\n        }\n        $(\".tick-animation-trigger_\" + i).toggleClass(\"drawn\");\n        if (state == \"hide\") {\n            function showBtnText () { $(\".copy-markdown_\" + i).removeAttr(\"style\");}\n            setTimeout(showBtnText, 1600);\n        }\n    }\n}\nfunction createCollection(teams) {\n\n    var publishTime, collectionId, collectionDate, releaseUri;\n    collectionId = $('#collectionname').val();\n    var publishType = $('input[name=\"publishType\"]:checked').val();\n    var scheduleType = $('input[name=\"scheduleType\"]:checked').val();\n\n    if (publishType === 'scheduled') {\n        publishTime = parseInt($('#hour').val()) + parseInt($('#min').val());\n        var toIsoDate = $('#date').datepicker(\"getDate\");\n        collectionDate = new Date(parseInt(new Date(toIsoDate).getTime()) + publishTime).toISOString();\n    } else {\n        collectionDate = null;\n    }\n\n    if (scheduleType === 'release' && publishType === 'scheduled') {\n        if (!Florence.CreateCollection.selectedRelease) {\n            sweetAlert('Please select a release');\n            return true;\n        }\n        releaseUri = Florence.CreateCollection.selectedRelease.uri;\n    } else {\n        releaseUri = null;\n    }\n\n    // inline tests\n    if (collectionId === '') {\n        sweetAlert('This is not a valid collection name', \"A collection name can't be empty\");\n        return true;\n    }\n    if (collectionId.match(/\\./)) {\n        sweetAlert('This is not a valid collection name', \"You can't use fullstops\");\n        return true;\n    }\n    if ((publishType === 'scheduled') && (scheduleType === 'custom') && (isValidDate(new Date(collectionDate)))) {\n        sweetAlert('This is not a valid date');\n        return true;\n    }\n    if ((publishType === 'scheduled') && (scheduleType === 'custom') && (Date.parse(collectionDate) < new Date())) {\n        sweetAlert('This is not a valid date');\n        return true;\n    } else {\n\n        // Add loading icon to button\n        loadingBtn($('.btn-collection-create'));\n\n        // Create the collection\n        $.ajax({\n            url: \"/zebedee/collection\",\n            dataType: 'json',\n            contentType: 'application/json',\n            type: 'POST',\n            data: JSON.stringify({\n                name: collectionId,\n                type: publishType,\n                publishDate: collectionDate,\n                pendingDeletes: [],\n                teams: teams,\n                collectionOwner: Florence.Authentication.userType(),\n                releaseUri: releaseUri\n            }),\n            success: function (collection) {\n                Florence.setActiveCollection(collection);\n                createWorkspace('', collection.id, 'browse', collection);\n            },\n            error: function (response) {\n                if (response.status === 409) {\n                    sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n                }\n                else {\n                    handleApiError(response);\n                }\n            }\n        });\n    }\n}\n\nfunction isValidDate(d) {\n    if (!isNaN(d.getTime())) {\n        return false;\n    }\n    return true;\n}\n\n/**\n * Handles the initial creation of the workspace screen.\n * @param path - path to iframe\n * @param collectionId\n * @param menu - opens a specific menu\n * @param collectionData - JSON of the currently active collection\n * @param stopEventListener - separates the link between editor and iframe\n * @returns {boolean}\n **/\n\nfunction createWorkspace(path, collectionId, menu, collectionData, stopEventListener) {\n    var safePath = '';\n\n    $(\"#working-on\").on('click', function () {\n    }); // add event listener to mainNav\n\n    if (stopEventListener) {\n        document.getElementById('iframe').onload = function () {\n            var browserLocation = document.getElementById('iframe').contentWindow.location.href;\n            $('.browser-location').val(browserLocation);\n            var iframeEvent = document.getElementById('iframe').contentWindow;\n            iframeEvent.removeEventListener('click', Florence.Handler, true);\n        };\n        return false;\n    } else {\n        var currentPath = '';\n        if (path) {\n            currentPath = path;\n            safePath = checkPathSlashes(currentPath);\n        }\n        \n        Florence.globalVars.pagePath = safePath;\n        if (Florence.globalVars.welsh !== true) {\n            document.cookie = \"lang=\" + \"en;path=/\";\n        } else {\n            document.cookie = \"lang=\" + \"cy;path=/\";\n        }\n        Florence.refreshAdminMenu();\n\n        var workSpace = templates.workSpace(Florence.babbageBaseUrl + safePath);\n        $('.section').html(workSpace);\n\n        // Store nav objects\n        var $nav = $('.js-workspace-nav'),\n            $navItem = $nav.find('.js-workspace-nav__item');\n\n        // Set browse panel to full height to show loading icon\n        $('.loader').css('margin-top', '84px');\n        $('.workspace-menu').height($('.workspace-nav').height());\n\n\n        /* Setup preview */\n        if (collectionData && collectionData.collectionOwner == \"DATA_VISUALISATION\") {\n            // Disable preview for data vis\n            $('#browser-location').show();\n            $('.browser').addClass('disabled');\n            updateBrowserURL(\"/\");\n            $('#iframe').attr('src', Florence.babbageBaseUrl);\n        } else {\n            // Detect click on preview, stopping browsing around preview from getting rid of unsaved data accidentally\n            detectPreviewClick();\n\n            // Detect changes to preview and handle accordingly\n            processPreviewLoad(collectionId, collectionData);\n\n            // Update preview URL on initial load of workspace\n            updateBrowserURL(path);\n        }\n\n        if (Florence.globalVars.welsh !== true) {\n            $('#nav--workspace__welsh').empty().append('<a href=\"#\">Language: English</a>');\n        } else {\n            $('#nav--workspace__welsh').empty().append('<a href=\"#\">Language: Welsh</a>');\n        }\n\n        /* Bind clicking */\n        $navItem.click(function () {\n            menu = '';\n            if (Florence.Editor.isDirty) {\n                swal({\n                    title: \"Warning\",\n                    text: \"You have unsaved changes. Are you sure you want to continue?\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonText: \"Continue\",\n                    cancelButtonText: \"Cancel\"\n                }, function (result) {\n                    if (result === true) {\n                        Florence.Editor.isDirty = false;\n                        processMenuClick(this);\n                    } else {\n                        return false;\n                    }\n                });\n            } else {\n                processMenuClick(this);\n            }\n        });\n\n\n        function processMenuClick(clicked) {\n            var menuItem = $(clicked);\n\n            $navItem.removeClass('selected');\n            menuItem.addClass('selected');\n\n            if (menuItem.is('#browse')) {\n                loadBrowseScreen(collectionId, 'click', collectionData);\n            } else if (menuItem.is('#create')) {\n                Florence.globalVars.pagePath = getPreviewUrl();\n                var type = false;\n                loadCreateScreen(Florence.globalVars.pagePath, collectionId, type, collectionData);\n            } else if (menuItem.is('#edit')) {\n                Florence.globalVars.pagePath = getPreviewUrl();\n                loadPageDataIntoEditor(Florence.globalVars.pagePath, Florence.collection.id);\n            } else if (menuItem.is('#import')) {\n                loadImportScreen(Florence.collection.id);\n            } else {\n                loadBrowseScreen(collectionId, false, collectionData);\n            }\n        }\n\n        $('#nav--workspace__welsh').on('click', function () {\n            Florence.globalVars.welsh = Florence.globalVars.welsh === false ? true : false;\n            createWorkspace(Florence.globalVars.pagePath, collectionId, 'browse');\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-create', function () {\n            var dest = $('.tree-nav-holder ul').find('.js-browse__item.selected').attr('data-url');\n            // var spanType = $(this).parent().prev('span');\n            var spanType = $(this).closest('.js-browse__item').find('.js-browse__item-title:first');\n            var typeClass = spanType[0].attributes[0].nodeValue;\n            var typeGroup = typeClass.match(/--(\\w*)$/);\n            var type = typeGroup[1];\n            Florence.globalVars.pagePath = dest;\n            $navItem.removeClass('selected');\n            $(\"#create\").addClass('selected');\n            loadCreateScreen(Florence.globalVars.pagePath, collectionId, type, collectionData);\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-delete', function () {\n            var $parentItem = $('.tree-nav-holder ul').find('.js-browse__item.selected');\n            var $parentContainer = $parentItem.find('.page__container.selected');\n            var $button = $parentContainer.find('.btn-browse-delete');\n            var dest = $parentItem.attr('data-url');\n            var spanType = $(this).parent().prev('span');\n            var title = spanType.html();\n            addDeleteMarker(dest, title, function() {\n                $parentContainer.addClass('animating').addClass('deleted');\n                toggleDeleteRevertButton($parentContainer);\n                toggleDeleteRevertChildren($parentItem);\n\n                // Stops animation happening anytime other than when going between delete/undo delete\n                $parentContainer.one(\"webkitTransitionEnd transitionEnd\", function() {\n                    $parentContainer.removeClass('animating');\n                });\n            });\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-delete-revert', function () {\n            var $parentItem = $('.tree-nav-holder ul').find('.js-browse__item.selected');\n            var $parentContainer = $parentItem.find('.page__container.selected');\n            var $button = $parentContainer.find('.btn-browse-delete-revert');\n            var dest = $parentItem.attr('data-url');\n            removeDeleteMarker(dest, function() {\n                $parentContainer.addClass('animating').removeClass('deleted');\n                toggleDeleteRevertButton($parentContainer);\n                toggleDeleteRevertChildren($parentItem);\n\n                // Stops animation happening anytime other than when going between delete/undo delete\n                $parentContainer.one(\"webkitTransitionEnd transitionEnd\", function() {\n                    $parentContainer.removeClass('animating');\n                });\n            });\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-move', function() {\n            var $parentItem = $('.tree-nav-holder ul').find('.js-browse__item.selected'),\n                fromUrl = $parentItem.attr('data-url');\n\n            moveBrowseNode(fromUrl);\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-create-datavis', function () {\n            var dest = '/visualisations';\n            var type = 'visualisation';\n            Florence.globalVars.pagePath = dest;\n            loadCreateScreen(Florence.globalVars.pagePath, collectionId, type, collectionData);\n        });\n\n        $('.workspace-menu').on('click', '.btn-browse-edit', function () {\n            var dest = $('.tree-nav-holder ul').find('.js-browse__item.selected').attr('data-url');\n            Florence.globalVars.pagePath = dest;\n            $navItem.removeClass('selected');\n            $(\"#edit\").addClass('selected');\n            loadPageDataIntoEditor(Florence.globalVars.pagePath, collectionId);\n        });\n\n        $('.workspace-menu').on('click', '.js-browse__menu', function() {\n            var $thisItem = $('.js-browse__item.selected .page__container.selected'),\n                $thisBtn = $thisItem.find('.js-browse__menu'),\n                $thisMenu = $thisBtn.next('.page__menu'),\n                menuHidden;\n\n            function toggleMenu() {\n                $thisBtn.toggleClass('active').children('.hamburger-icon__span').toggleClass('active');\n                $thisItem.find('.js-browse__buttons--primary').toggleClass('active');\n                $thisMenu.toggleClass('active');\n            }\n\n            // Toggle menu on click\n            toggleMenu();\n\n            // Shut menu if another item or button is clicked\n            $('.js-browse__item-title, .btn-browse-move, .btn-browse-delete').on('click', function() {\n                if (!menuHidden) {\n                    toggleMenu();\n                    menuHidden = true;\n                }\n            });\n        });\n\n        if (menu === 'edit') {\n            $navItem.removeClass('selected');\n            $(\"#edit\").addClass('selected');\n            loadPageDataIntoEditor(Florence.globalVars.pagePath, collectionId);\n        } else if (menu === 'browse') {\n            $navItem.removeClass('selected');\n            $(\"#browse\").addClass('selected');\n            loadBrowseScreen(collectionId, 'click', collectionData);\n        }\n        //};\n    }\n}\n\n// SHOULD BE REPLACED BY 'onIframeLoad' -  Bind click event to iframe element and run global Florence.Handler\nfunction detectPreviewClick() {\n    var iframeEvent = document.getElementById('iframe').contentWindow;\n    iframeEvent.addEventListener('click', Florence.Handler, true);\n}\n\nfunction processPreviewLoad(collectionId, collectionData) {\n    if (collectionData && collectionData.collectionOwner == \"DATA_VISUALISATION\") {\n        // iframe is blacked out on browse for data vis content\n        $('#iframe').empty();\n\n    } else {\n        // Collection of functions to run on iframe load\n        onIframeLoad(function (event) {\n            var $iframe = $('#iframe'), // iframe element in DOM, check length later to ensure it's on the page before continuing\n                $browse = $('#browse'); // 'Browse' menu tab, check later if it's selected\n\n            // Check it is a load event and that iframe is in the DOM still before processing the load\n            if (event.data == \"load\" && $iframe.length) {\n                // Check whether page URL is different and then load editor or update browse tree\n                checkForPageChanged(function (newUrl) {\n                    var safeUrl = checkPathSlashes(newUrl),\n                        selectedItem = $('.workspace-browse li.selected').attr('data-url'); // Get active node in the browse tree\n\n                    Florence.globalVars.pagePath = safeUrl;\n\n                    if ($('.workspace-edit').length || $('.workspace-create').length) {\n\n                        // Switch to browse screen if navigating around preview whilst on create or edit tab\n                        loadBrowseScreen(collectionId, 'click', collectionData);\n                    }\n                    else if ($('.workspace-browse').length && selectedItem != Florence.globalVars.pagePath) {\n                        // Only update browse tree of on 'browse' tab and preview and active node don't already match\n                        treeNodeSelect(safeUrl);\n                    }\n                });\n                updateBrowserURL(); // Update browser preview URL\n\n                if ($browse.hasClass('selected')) {\n                    browseScrollPos(); // Update browse tree scroll position\n                }\n            }\n        });\n    }\n}\n\n// Reusable iframe startload event - uses message sent up form babbage on window.load\nfunction onIframeLoad(runFunction) {\n    window.addEventListener(\"message\", function (event) {\n        runFunction(event);\n    });\n}\n\n// Update the scroll position of the browse tree if selected item off screen\nfunction browseScrollPos() {\n    var $selectedItem = $('.workspace-browse li.selected .page__container.selected'),\n        $browseTree = $('.workspace-browse');\n\n    if ($selectedItem.length) {\n        var selectedTop = $selectedItem.offset().top,\n            selectedBottom = selectedTop + $selectedItem.height(),\n            browseTop = $browseTree.offset().top,\n            browseBottom = browseTop + $browseTree.height(),\n            navHeight = $('.nav').height();\n\n        if (selectedTop < browseTop) {\n            console.log('Item was above of viewable browse tree');\n            $browseTree.scrollTop($browseTree.scrollTop() + (selectedTop) - (navHeight / 2));\n        } else if (selectedBottom > browseBottom) {\n            console.log('Item was below viewable browse tree');\n            $browseTree.scrollTop(selectedBottom - (navHeight / 2) - $selectedItem.height())\n        }\n    }\n}\n\nfunction updateBrowserURL(url) {\n    if(!url) {\n        url = Florence.globalVars.pagePath;\n    }\n    $('.browser-location').val(Florence.babbageBaseUrl + url);\n}\n\n// toggle delete button from 'delete' to 'revert' for content marked as to be deleted and remove/show other buttons in item\nfunction toggleDeleteRevertButton($container) {\n    $container.find('.btn-browse-delete-revert, .js-browse__buttons--primary, .js-browse__buttons--secondary').toggle();\n}\n\n// Toggle displaying children as deleted or not deleted\nfunction toggleDeleteRevertChildren($item) {\n    var $childContainer = $item.find('.js-browse__item .page__container'),\n        isDeleting = $item.children('.page__container').hasClass('deleted');\n\n    if (isDeleting) {\n        $childContainer.addClass('deleted');\n    } else {\n        $childContainer.removeClass('deleted');\n\n        // If a child item has previously been deleted but is being shown by a parent then undo the toggle buttons\n        if ($childContainer.find('.btn-browse-delete-revert').length) {\n            // toggleDeleteRevertButton($childContainer.find('.btn-browse-delete-revert'));\n            toggleDeleteRevertButton($childContainer);\n        }\n    }\n\n    $childContainer.find('.page__buttons').toggleClass('deleted');\n}\n\nfunction deleteTeam(name) {\n  $.ajax({\n    url: \"/zebedee/teams/\" + name,\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'DELETE',\n    success: function () {\n      sweetAlert('Deleted', \"The team has been successfully deleted\", 'success');\n      viewController('teams');\n    },\n    error: function (response) {\n      if (response.status === 403 || response.status === 401) {\n        sweetAlert(\"Error\", \"You are not permitted to delete teams\", \"error\");\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction deleteTeamMember(name, email) {\n  var encodedName = encodeURIComponent(name);\n  $.ajax({\n    url: \"/zebedee/teams/\" + encodedName + \"?email=\" + email,\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'DELETE',\n    success: function () {\n      console.log('Team member deleted: ' + email);\n    },\n    error: function (response) {\n      handleUserPostError(response);\n    }\n  });\n\n  /**\n   * Handle error response from creating the team.\n   * @param response\n   */\n  function handleUserPostError(response) {\n    if (response.status === 403 || response.status === 401) {\n      sweetAlert(\"You are not permitted to delete users.\");\n    }\n    else if (response.status === 409) {\n      sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n    } else {\n      handleApiError(response);\n    }\n  }\n}\nfunction deleteUnpublishedVersion (collectionId, path, success, error) {\n  var url = \"/zebedee/version/\" + collectionId + \"?uri=\" + path;\n\n  // Update content\n  $.ajax({\n    url: url,\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'DELETE',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction deleteUser(email) {\n  $.ajax({\n    url: \"/zebedee/users?email=\" + email,\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'DELETE',\n    success: function () {\n      console.log('User deleted');\n      sweetAlert('Deleted', \"User '\"  + email + \"' has been deleted\", 'success');\n      viewController('users');\n    },\n    error: function (response) {\n      if (response.status === 403 || response.status === 401) {\n        sweetAlert(\"Error\", \"You are not permitted to delete users\", \"error\")\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * Manage files associated with datasets. When uploading a file creates a new dataset\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param idField - HTML id for the template (has to be 'edition')\n */\n\nfunction addDataset(collectionId, data, field, idField) {\n    var downloadExtensions, pageType;\n    var uriUpload;\n    var lastIndex;\n    if (data[field]) {\n        lastIndex = data[field].length;\n    } else {\n        lastIndex = 0;\n    }\n    var uploadedNotSaved = {uploaded: false, saved: false, editionUri: \"\"};\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n\n    //Add\n    if (data.timeseries) {\n        downloadExtensions = /\\.csdb$|\\.csv$/;\n        pageType = 'timeseries_dataset';\n    } else {\n        downloadExtensions = /\\.csv$|.xls$|.zip$/;\n        pageType = 'dataset';\n    }\n\n    $('#add-' + idField).one('click', function () {\n        // check that a timeseries dataset has max one file\n        if (data.timeseries && (data[field] && data[field].length < 1) || !data.timeseries) {\n            var position = $(\".workspace-edit\").scrollTop();\n            Florence.globalVars.pagePos = position + 200;\n\n            $('#sortable-' + idField).append(\n                '<div id=\"' + lastIndex + '\" class=\"edit-section__item\">' +\n                '  <form id=\"UploadForm\">' +\n                '    <textarea class=\"auto-size\" placeholder=\"Period (E.g. 2015, August to December 2010, etc.\" type=\"text\" id=\"edition\"></textarea>' +\n                '    <textarea class=\"auto-size\" placeholder=\"Label (E.g. Final, Revised, etc.)\" type=\"text\" id=\"version\"></textarea>' +\n                '    <input type=\"file\" title=\"Select a file and click Submit\" name=\"files\">' +\n                '    <div class=\"dataset-buttons\">' +\n                '    <button type=\"submit\" form=\"UploadForm\" value=\"submit\">Submit</button>' +\n                '    <button class=\"btn-page-cancel\" id=\"file-cancel\">Cancel</button>' +\n                //'    <button class=\"btn-dataset-autocsdb\" id=\"no-file\">Auto CSDB</button>' +\n                '    </div>' +\n                '  </form>' +\n                '  <div id=\"response\"></div>' +\n                '  <ul id=\"list\"></ul>' +\n                '</div>');\n            if (!data.timeseries) {\n                $('#no-file').remove();\n            }\n\n            $('#file-cancel').one('click', function (e) {\n                e.preventDefault();\n                $('#' + lastIndex).remove();\n                //Check files uploaded and delete them\n                if (uploadedNotSaved.uploaded === true) {\n                    data[field].splice(-1, 1);\n                    deleteContent(Florence.collection.id, uploadedNotSaved.editionUri,\n                        onSuccess = function () {\n                        },\n                        onError = function (error) {\n                            handleApiError(error);\n                        }\n                    );\n                }\n                addDataset(collectionId, data, 'datasets', 'edition');\n            });\n\n            $('#UploadForm').submit(function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n\n                var formdata = new FormData();\n\n                function showUploadedItem(source) {\n                    $('#list').append(source);\n                }\n\n                var pageTitle = this[0].value;\n                var pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n                var versionLabel = this[1].value;\n\n                var file = this[2].files[0];\n                if (!file) {\n                    sweetAlert(\"Please select a file to upload\");\n                    return;\n                }\n\n                document.getElementById(\"response\").innerHTML = \"Uploading . . .\";\n\n                var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n                if (file.name.match(/\\.csv$/)) {\n                    fileNameNoSpace = 'upload-' + fileNameNoSpace;\n                }\n                uriUpload = data.uri + '/' + pageTitleTrimmed + '/' + fileNameNoSpace;\n                var safeUriUpload = checkPathSlashes(uriUpload);\n\n                if (data[field] && data[field].length > 0) {\n                    $(data[field]).each(function (i, filesUploaded) {\n                        if (filesUploaded.file === safeUriUpload || filesUploaded.file === fileNameNoSpace) {\n                            sweetAlert('This file already exists');\n                            $('#' + lastIndex).remove();\n                            addDataset(collectionId, data, 'datasets', 'edition');\n                            formdata = false;   // if not present the existing file was being overwritten\n                            return;\n                        }\n                    });\n                }\n\n                if (!!file.name.match(downloadExtensions)) {\n                    showUploadedItem(fileNameNoSpace);\n                    if (formdata) {\n                        formdata.append(\"name\", file);\n                    }\n                } else {\n                    sweetAlert('This file type is not supported');\n                    $('#' + lastIndex).remove();\n                    addDataset(collectionId, data, 'datasets', 'edition');\n                    return;\n                }\n\n                if (pageTitle.length < 4 || pageTitle.toLowerCase() === 'data') {\n                    sweetAlert(\"This is not a valid file title\");\n                    return;\n                }\n\n                if (formdata) {\n                    $.ajax({\n                        url: \"/zebedee/content/\" + collectionId + \"?uri=\" + safeUriUpload,\n                        type: 'POST',\n                        data: formdata,\n                        cache: false,\n                        processData: false,\n                        contentType: false,\n                        success: function () {\n                            document.getElementById(\"response\").innerHTML = \"File uploaded successfully\";\n                            if (!data[field]) {\n                                data[field] = [];\n                            }\n                            data[field].push({uri: data.uri + '/' + pageTitleTrimmed});\n                            uploadedNotSaved.uploaded = true;\n                            // create the dataset\n                            loadT8EditionCreator(collectionId, data, pageType, pageTitle, fileNameNoSpace, versionLabel);\n                            // on success save parent and child data\n                        }\n                    });\n                }\n            });\n\n            $('#no-file').one('click', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n\n                if (data.timeseries) {    // not necessary but for extra security\n                    if (data.description.datasetId) {   // check for an id to link the csdb to\n                        // on success save parent and child data\n                        var pageTitle = $('#edition').val();\n                        var pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n                        var fileNameNoSpace = data.description.datasetId + '.csdb';\n\n                        var versionLabel = $('#version').val();\n                        if (pageTitleTrimmed.length < 4 || pageTitleTrimmed === 'data') {\n                            sweetAlert(\"This is not a valid file title\");\n                            e.preventDefault();\n                            e.stopImmediatePropagation();\n                            $('#' + lastIndex).remove();\n                            addDataset(collectionId, data, field, idField);\n                        } else {\n                            data[field].push({uri: data.uri + '/' + pageTitleTrimmed});\n                            // create the dataset if there is not any\n                            loadT8EditionCreator(collectionId, data, pageType, pageTitle, fileNameNoSpace, versionLabel);\n                        }\n                    } else {\n                        sweetAlert(\"Warning!\", \"You need to add a dataset Id to match the CSDB.\", \"error\");\n                        e.preventDefault();\n                        e.stopImmediatePropagation();\n                        $('#' + lastIndex).remove();\n                        addDataset(collectionId, data, field, idField);\n                    }\n                } else {\n                    sweetAlert(\"Oops!\", \"It looks like this is not a timeseries dataset.\", \"error\");\n                }\n            });\n        } else {\n            sweetAlert(\"Warning!\", \"You can add only one file in a timeseries dataset.\", \"error\");\n        }\n    });\n\n\n    function sortable() {\n        $('#sortable-' + idField).sortable({\n            stop: function () {\n                $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n                    $(this).empty().append(index + 1);\n                });\n            }\n        });\n    }\n\n    sortable();\n}\n\n/**\n * Manage files associated with content\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction addFile(collectionId, data, field, idField) {\n    var list = data[field];\n    var downloadExtensions, header, button;\n    if (field === 'supplementaryFiles') {\n        header = 'Supplementary files';\n        button = 'supplementary file';\n    } else if (field === 'pdfDownloads') {\n        header = 'Upload methodology PDF file';\n        button = 'pdf';\n    } else if (field === 'pdfTable') {\n        header = 'PDF Table';\n        button = 'pdf';\n    } else {\n        header = 'Upload files';\n        button = 'file';\n    }\n    var dataTemplate = {list: list, idField: idField, header: header, button: button};\n    var html = templates.editorDownloads(dataTemplate);\n    $('#' + idField).replaceWith(html);\n    var uriUpload;\n\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n\n    //Edit\n    if (!data[field] || data[field].length === 0) {\n        var lastIndex = 0;\n    } else {\n        $(data[field]).each(function (index) {\n            // Delete\n            $('#' + idField + '-delete_' + index).click(function () {\n                fileDelete(collectionId, data, field, index);\n            });\n        });\n    }\n\n    //Add\n    if (data.type === 'static_adhoc') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.pdf$|.zip$/;\n    } else if (data.type === 'static_qmi') {\n        downloadExtensions = /\\.pdf$/;\n    } else if (data.type === 'article_download' || (data.type === 'static_methodology_download' && field === 'pdfDownloads')) {\n        downloadExtensions = /\\.pdf$/;\n    } else if (data.type === 'static_methodology_download' && field === 'downloads') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.ppt$|.zip$/;\n    } else if (data.type === 'static_methodology') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.ppt$|.pdf$|.zip$/;\n    } else if (data.type === 'static_foi') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.pdf$|.zip$/;\n    } else if (data.type === 'static_page') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.pdf$|.zip$/;\n    } else if (data.type === 'static_article') {\n        downloadExtensions = /\\.xls$|.pdf$|.zip$/;\n    } else if (data.type === 'dataset' || data.type === 'timeseries_dataset') {\n        downloadExtensions = /\\.csv$|.xls$|.doc$|.pdf$|.zip$/;\n    } else if (data.type === 'article' || data.type === 'bulletin'|| data.type === 'compendium_chapter') {\n        downloadExtensions = /\\.pdf$/;\n    } else {\n        sweetAlert(\"This file type is not valid\", \"Contact an administrator if you need to add this type of file in this document\", \"info\");\n    }\n\n    $('#add-' + idField).one('click', function () {\n        if ((data.type === 'article' || data.type === 'bulletin') && (data[field] && data[field].length > 0)) {\n            sweetAlert(\"You can upload only one file here\");\n            return false;\n        } else {\n            if (!data[field]) {\n                data[field] = [];\n            }\n            uploadFile(collectionId, data, field, idField, lastIndex, downloadExtensions, addFile);\n        }\n    });\n\n    $(function () {\n        $('.add-tooltip').tooltip({\n            items: '.add-tooltip',\n            content: 'Type title here and click Save to add it to the page',\n            show: \"slideDown\", // show immediately\n            open: function (event, ui) {\n                ui.tooltip.hover(\n                    function () {\n                        $(this).fadeTo(\"slow\", 0.5);\n                    });\n            }\n        });\n    });\n\n    function sortable() {\n        $('#sortable-' + idField).sortable({\n            stop: function () {\n                $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n                    $(this).empty().append(index + 1);\n                });\n            }\n        });\n    }\n\n    sortable();\n}\n\n/**\n * Manages file with description\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction addFileWithDetails(collectionId, data, field, idField) {\n  var list = data[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorDownloadsWithSummary(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  var uriUpload;\n  var downloadExtensions;\n\n  $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n\n  // Edit\n  if (!data[field] || data[field].length === 0) {\n    var lastIndex = 0;\n  } else {\n    $(data[field]).each(function (index) {\n      // Delete\n      $('#' + idField + '-delete_' + index).click(function () {\n        fileDelete(collectionId, data, field, index);\n      });\n\n      // Edit\n      $('#' + idField + '-edit_' + index).click(function () {\n        var editedSectionValue = {\n          \"title\": $('#' + idField + '-title_' + index).val(),\n          \"markdown\": $('#' + idField + '-summary_' + index).val()\n        };\n\n        var saveContent = function (updatedContent) {\n          data[field][index].fileDescription = updatedContent;\n          data[field][index].title = $('#' + idField + '-title_' + index).val();\n          updateContent(collectionId, data.uri, JSON.stringify(data));\n        };\n        loadMarkdownEditor(editedSectionValue, saveContent, data);\n      });\n    });\n  }\n\n  //Add\n  if (data.type === 'compendium_data') {\n    downloadExtensions = /\\.csv$|.xls$|.zip$/;\n  } else {\n    sweetAlert(\"This file type is not valid\", \"Contact an administrator if you need to add this type of file in this document\", \"info\");\n  }\n\n  $('#add-' + idField).one('click', function () {\n    uploadFile(collectionId, data, field, idField, lastIndex, downloadExtensions, addFileWithDetails);\n  });\n\n  $(function () {\n    $('.add-tooltip').tooltip({\n      items: '.add-tooltip',\n      content: 'Type title here and click Edit to add a description',\n      show: \"slideDown\", // show immediately\n      open: function (event, ui) {\n        ui.tooltip.hover(\n          function () {\n            $(this).fadeTo(\"slow\", 0.5);\n          });\n      }\n    });\n  });\n\n  function sortable() {\n    $('#sortable-' + idField).sortable({\n      stop: function () {\n        $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n          $(this).empty().append(index + 1);\n        });\n      }\n    });\n  }\n\n  sortable();\n}\n\n/**\n * Manages alerts\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editAlert(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorAlert(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  initialiseAlert(collectionId, data, templateData, field, idField);\n  // New alert\n  $(\"#add-\" + idField).click(function () {\n    if (!data[field]) {\n      data[field] = [];\n      templateData[field] = [];\n    }\n    var tmpDate = (new Date()).toISOString();\n    data[field].push({markdown: \"\", date: tmpDate, type: \"alert\"});\n    templateData[field].push({markdown: \"\", date: tmpDate, type: \"alert\"});\n    saveAlert(collectionId, data.uri, data, templateData, field, idField);\n  });\n  $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshAlert(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorAlert(dataTemplate);\n  $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n  initialiseAlert(collectionId, data, templateData, field, idField);\n}\n\nfunction initialiseAlert(collectionId, data, templateData, field, idField) {\n  // Load\n  $(data[field]).each(function (index) {\n    dateTmp = data[field][index].date;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#date_' + index).val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data[field][index].date = new Date($('#date_' + index).datepicker('getDate')).toISOString();\n      templateData[field][index].date = new Date($('#date_' + index).datepicker('getDate')).toISOString();\n    });\n    $('#' + idField + '-edit_' + index).click(function () {\n      var editedSectionValue = {title: 'Alert notice', markdown: data[field][index].markdown};\n      //var editedSectionValue = data[field][index].markdown;\n      var saveContent = function (updatedContent) {\n        data[field][index].markdown = updatedContent;\n        templateData[field][index].markdown = updatedContent;\n        saveAlert(collectionId, data.uri, data, templateData, field, idField);\n      };\n      loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n    });\n\n    var correctionCheck;\n    if (data[field][index].type === 'correction') {\n      correctionCheck = 'checked';\n    } else if (data[field][index].type === 'alert') {\n      correctionCheck = 'unchecked';\n    }\n\n    if (data.type === 'dataset_landing_page' || data.type === 'compendium_landing_page') {\n      $('#correction-container_' + index).append('<label for=\"correction-alert_' + index + '\">Show as correction' +\n        '<input id=\"correction-alert_' + index + '\" type=\"checkbox\" value=\"value\" ' + correctionCheck + '/></label>');\n    }\n\n    $('#correction-alert_' + index).change(function () {\n      if ($(this).prop('checked') === true) {\n        data[field][index].type = 'correction';\n      }\n      else {\n        data[field][index].type = 'alert';\n      }\n      saveAlert(collectionId, data.uri, data, templateData, field, idField);\n    });\n\n    // Delete\n    $('#' + idField + '-delete_' + index).click(function () {\n      swal ({\n        title: \"Warning\",\n        text: \"Are you sure you want to delete this alert?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function(result) {\n        if (result === true) {\n          swal({\n            title: \"Deleted\",\n            text: \"This alert has been deleted\",\n            type: \"success\",\n            timer: 2000\n          });\n          var position = $(\".workspace-edit\").scrollTop();\n          Florence.globalVars.pagePos = position;\n          $(this).parent().remove();\n          data[field].splice(index, 1);\n          templateData[field].splice(index, 1);\n          saveAlert(collectionId, data.uri, data, templateData, field, idField);\n        }\n      });\n    });\n  });\n  function sortable() {\n    $('#sortable-' + idField).sortable({\n      stop: function(){\n        $('#' + idField + ' .edit-section__sortable-item--counter').each(function(index) {\n          $(this).empty().append(index + 1);\n        });\n      }\n    });\n  }\n\n  sortable();\n\n}\n\nfunction saveAlert(collectionId, path, data, templateData, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    success = function () {\n      Florence.Editor.isDirty = false;\n      refreshAlert(collectionId, data, templateData, field, idField);\n      refreshPreview(data.uri);\n    },\n    error = function (response) {\n      if (response.status === 409) {\n        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      } else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\n/**\n * Manages related data\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editBlocks(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorT1Blocks(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  resolveStatsTitle(collectionId, data, templateData, field, idField);\n  $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshBlocks(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorT1Blocks(dataTemplate);\n  $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n  initialiseBlocks(collectionId, data, templateData, field, idField);\n}\n\nfunction initialiseBlocks(collectionId, data, templateData, field, idField) {\n  // Load\n  $(data[field]).each(function (index) {\n    // Edit\n    $('#' + idField + '-edit_' + index).click(function () {\n      var $this = data[field][index];\n      if (!$this.title) {\n        // This is data\n        var modal = templates.blockNewsModal($this);\n        var pastedUrl;\n        $('.modal').remove();\n        $('.workspace-menu').append(modal);\n        $('.modal-news').remove();\n\n        //Modal click events\n        $('.btn-uri-cancel').off().one('click', function () {\n          $('.modal').remove();\n        });\n\n        $('.btn-uri-get').off().click(function () {\n          pastedUrl = $('#uri-input').val();\n          if (pastedUrl === \"\") {\n            sweetAlert(\"This field cannot be empty. Please paste a valid url address\");\n          } else {\n            var dataUrl = checkPathParsed(pastedUrl);\n            if (dataUrl === \"\") {    //special case for home page\n              dataUrl = \"/\";\n            }\n            checkValidStats(collectionId, data, templateData, field, idField, dataUrl, index);\n            $('.modal').remove();\n          }\n        });\n      } else {\n        // This is item\n        var images = data.images;\n        var dataTemplate = {block: $this, images: images};\n        var modal = templates.blockNewsModal(dataTemplate);\n        var uri, title, text, image;\n        $('.modal').remove();\n        $('.workspace-menu').append(modal);\n        //menuselect(\"uri-size\");\n\n        $('#uri-input').change(function () {\n          $this.uri = $('#uri-input').val();\n        });\n        $('#uri-title').change(function () {\n          $this.title = $('#uri-title').val();\n        });\n        $(\"#uri-text\").change(function () {\n          $(this).textareaAutoSize();\n          $this.text = $('#uri-text').val();\n        });\n\n        var imageIdx = _.findIndex(images, function(item) {return item.uri === $this.image;});\n        $('#uri-image').val(imageIdx.toString()).prop('selected', 'true');\n\n        $\n        $('#uri-image').change(function () {\n          var index = parseInt($('#uri-image').val());\n          if (index === -1) {\n            $this.image = '';\n          } else {\n            $this.image = images[index].uri;\n          }\n        });\n\n        //Modal click events\n        $('.btn-uri-cancel').off().click(function () {\n          $('.modal').remove();\n        });\n\n        $('.btn-uri-get').off().click(function () {\n          if (!($this.title || title)) {\n            sweetAlert('You need to enter a title to continue');\n            return false;\n          } else {\n            data[field][index] = {uri: $this.uri, title: $this.title, text: $this.text, image: $this.image};\n            saveBlocks(collectionId, data.uri, data, templateData, field, idField);\n            $('.modal').remove();\n          }\n        });\n      }\n    });\n\n    // Delete\n    $('#' + idField + '-delete_' + index).click(function () {\n      swal({\n        title: \"Warning\",\n        text: \"Are you sure you want to delete this block?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function (result) {\n        if (result === true) {\n          swal({\n            title: \"Deleted\",\n            text: \"This \" + idField + \" has been deleted\",\n            type: \"success\",\n            timer: 2000\n          });\n          var position = $(\".workspace-edit\").scrollTop();\n          Florence.globalVars.pagePos = position;\n          $(this).parent().remove();\n          data[field].splice(index, 1);\n          templateData[field].splice(index, 1);\n          putContent(collectionId, data.uri, JSON.stringify(data),\n            function () {\n              Florence.Editor.isDirty = false;\n              refreshPreview(data.uri);\n              refreshBlocks(collectionId, data, templateData, field, idField);\n            },\n            function (response) {\n              if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n              }\n              else {\n                handleApiError(response);\n              }\n            }\n          );\n        }\n      });\n    });\n  });\n\n  //Add\n  $('#add-' + idField).off().click(function () {\n    //add a modal to select an option for stats or news\n    var position = $(\".workspace-edit\").scrollTop();\n    Florence.globalVars.pagePos = position;\n    var modalStatsOrNews = templates.blockModal;\n    $('.workspace-menu').append(modalStatsOrNews);\n    //They choose timeseries\n    $('#data-link').click(function () {\n      if (!data[field]) {\n        data[field] = [];\n      }\n\n      var modal = templates.blockNewsModal;\n      var pastedUrl;\n      $('.modal').remove();\n      $('.workspace-menu').append(modal);\n      $('.modal-news').remove();\n\n      //Modal click events\n      $('.btn-uri-cancel').off().one('click', function () {\n        createWorkspace(data.uri, collectionId, 'edit');\n      });\n\n      $('.btn-uri-get').off().click(function () {\n        pastedUrl = $('#uri-input').val();\n        if (pastedUrl === \"\") {\n          sweetAlert(\"This field cannot be empty. Please paste a valid url address\");\n        } else {\n          var dataUrl = checkPathParsed(pastedUrl);\n          if (dataUrl === \"\") {    //special case for home page\n            dataUrl = \"/\";\n          }\n          checkValidStats(collectionId, data, templateData, field, idField, dataUrl);\n          $('.modal').remove();\n        }\n      });\n    });\n\n    //They choose news\n    $('#item-link').click(function () {\n      if (!data[field]) {\n        data[field] = [];\n      }\n      var images = data.images;\n      var dataTemplate = {block: {}, images: images};\n      var modal = templates.blockNewsModal(dataTemplate);\n      var uri, title, text, image;\n      $('.modal').remove();\n      $('.workspace-menu').append(modal);\n\n      $('#uri-input').change(function () {\n        uri = $('#uri-input').val();\n      });\n      $('#uri-title').change(function () {\n        title = $('#uri-title').val();\n      });\n      $(\"#uri-text\").change(function () {\n        $(this).textareaAutoSize();\n        text = $('#uri-text').val();\n      });\n      $('#uri-image').change(function () {\n        var index = parseInt($('#uri-image').val());\n        if (index === -1) {\n          $this.image = '';\n        } else {\n          $this.image = images[index].uri;\n        }\n      });\n\n      $('.btn-uri-get').off().click(function () {\n        if (!title) {\n          sweetAlert('You need to enter a title to continue');\n        }\n        else {\n          data[field].push({uri: uri, title: title, text: text, image: image});\n          templateData[field].push({uri: uri, title: title, text: text, image: image});\n          saveBlocks(collectionId, data.uri, data, templateData, field, idField);\n          $('.modal').remove();\n        }\n      });\n      $('.btn-uri-cancel').off().click(function () {\n        $('.modal').remove();\n      });\n    });\n\n    //They cancel\n    $('.btn-uri-cancel').off().click(function () {\n      $('.modal').remove();\n    });\n  });\n\n  // Make sections sortable\n  function sortable() {\n    $('#sortable-' + idField).sortable({\n      stop: function () {\n        $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n          $(this).empty().append(index + 1);\n        });\n      }\n    });\n  }\n\n  sortable();\n}\n\nfunction resolveStatsTitle(collectionId, data, templateData, field, idField) {\n  var ajaxRequest = [];\n  $(templateData[field]).each(function (index, path) {\n    var dfd = $.Deferred();\n    if (!this.title) {\n      getPageDataTitle(collectionId, path.uri,\n        function (response) {\n          templateData[field][index] = response;\n          dfd.resolve();\n        },\n        function () {\n          sweetAlert(\"Error\", field + ' address: ' + path.uri + ' is not found.', \"error\");\n          dfd.resolve();\n        }\n      );\n      ajaxRequest.push(dfd);\n    }\n  });\n\n  $.when.apply($, ajaxRequest).then(function () {\n    refreshBlocks(collectionId, data, templateData, field, idField);\n  });\n}\n\n\nfunction saveBlocks(collectionId, path, data, templateData, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    success = function (response) {\n      Florence.Editor.isDirty = false;\n      resolveStatsTitle(collectionId, data, templateData, field, idField);\n      refreshPreview(data.uri);\n    },\n    error = function (response) {\n      if (response.status === 400) {\n        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\nfunction checkValidStats(collectionId, data, templateData, field, idField, dataUrl, index) {\n  var dataUrlData = dataUrl + \"/data\";\n  $.ajax({\n    url: dataUrlData,\n    dataType: 'json',\n    crossDomain: true,\n    success: function (result) {\n      if (result.type === 'timeseries') {\n        if (!data[field]) {\n          data[field] = [];\n          templateData[field] = [];\n        }\n      }\n      else {\n        sweetAlert(\"This is not a valid document\");\n        createWorkspace(data.uri, collectionId, 'edit');\n        return;\n      }\n\n      if (index) {\n        data[field][index] = {uri: dataUrl};\n        templateData[field][index] = {uri: dataUrl};\n      } else {\n        data[field].push({uri: dataUrl});\n        templateData[field].push({uri: dataUrl});\n      }\n      saveBlocks(collectionId, data.uri, data, templateData, field, idField);\n\n    },\n    error: function () {\n      console.log('No page data returned');\n    }\n  });\n}\nfunction editCollection(collection) {\n\n    collection.collectionOwner = Florence.Authentication.userType();\n\n    getTeams(\n        success = function (teams) {\n            var editPublishTime, toIsoDate;\n            var collDetails = $('.js-collection__content').detach();\n            var html = templates.collectionEdit({collection: collection, teams: teams.teams});\n            $('.js-collection__head').after(html);\n            $('.btn-collection-edit').off();\n\n            $('#collection-editor-name').on('input', function () {\n                collection.name = $('#collection-editor-name').val();\n            });\n\n            $(\"#editor-team-tag\").tagit({\n                singleField: true,\n                singleFieldNode: $('#editor-team-input'),\n                singleFieldDelimiter: (\"$$\")\n            });\n\n            $(collection.teams).each(function (i, team) {\n                $('#editor-team-tag').tagit('createTag', team);\n            });\n\n            $('.ui-autocomplete-input').hide();\n\n            $('select#editor-team').change(function () {\n                $('#editor-team-tag').tagit('createTag', $(\"#editor-team option:selected\").text());\n            });\n\n            $('#editor-team-input').change(function () {\n                collection.teams = $('#editor-team-input').val().split('$$');\n                //After creating the array tagit leaves an empty string if all elements are removed\n                if (teams.length === 1 && teams[0] === \"\") {\n                    teams = [];\n                }\n            });\n\n            if (!collection.publishDate) {\n                $('#collection-editor-date').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n                    toIsoDate = $('#collection-editor-date').datepicker(\"getDate\");\n                });\n            } else {\n                dateTmp = collection.publishDate;\n                toIsoDate = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n                $('#collection-editor-date').val(toIsoDate).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n                    toIsoDate = $('#collection-editor-date').datepicker(\"getDate\");\n                });\n            }\n\n            //initial value\n            if (collection.type === \"manual\") {\n                $('#collection-editor-date-block').hide();\n            } else {\n                $('#collection-editor-date-block').show();\n            }\n\n            $('input[type=radio]').click(function () {\n                if ($(this).val() === 'manualCollection') {\n                    collection.type = \"manual\";\n                    $('#collection-editor-date-block').hide();\n                } else if ($(this).val() === 'scheduledCollection') {\n                    collection.type = \"scheduled\";\n                    $('#collection-editor-date-block').show();\n                }\n            });\n\n            //More functionality to be added here\n            // When scheduled, do we change all the dates in the files in the collection?\n\n\n            //Save\n            $('.btn-collection-editor-save').click(function () {\n                //save date and time to collection\n                if (collection.type === 'scheduled') {\n                    editPublishTime = parseInt($('#collection-editor-hour').val()) + parseInt($('#collection-editor-min').val());\n                    collection.publishDate = new Date(parseInt(new Date(toIsoDate).getTime()) + editPublishTime).toISOString();\n                } else {\n                }\n                //check validity\n                if (collection.name === '') {\n                    sweetAlert('This is not a valid collection name', \"A collection name can't be empty\");\n                    return true;\n                }\n                if (collection.name.match(/\\./)) {\n                    sweetAlert('This is not a valid collection name', \"You can't use fullstops\");\n                    return true;\n                }\n                if ((collection.type === 'scheduled') && (Date.parse(collection.publishDate) < new Date())) {\n                    sweetAlert('This is not a valid date. Date cannot be in the past');\n                    return true;\n                } else {\n                    // Update the collection\n                    $.ajax({\n                        url: \"/zebedee/collection/\" + collection.id,\n                        dataType: 'json',\n                        contentType: 'application/json',\n                        type: 'PUT',\n                        data: JSON.stringify(collection),\n                        success: function (updatedCollection) {\n                            Florence.setActiveCollection(updatedCollection);\n                            //createWorkspace('', updatedCollection.id, 'browse');\n                            sweetAlert(\"Collection amended\", \"\", \"success\");\n                            viewCollections(collection.id);\n                        },\n                        error: function (response) {\n                            if (response.status === 409) {\n                                sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n                            }\n                            else {\n                                handleApiError(response);\n                            }\n                        }\n                    });\n                }\n            });\n\n            //Cancel\n            $('.btn-collection-editor-cancel').click(function () {\n                $('.btn-collection-edit').click(function () {\n                    editCollection(collection);\n                });\n                $('.js-collection__edit-modal').remove();\n                $('.js-collection__head').after(collDetails);\n            });\n\n            setCollectionEditorHeight();\n        },\n        error = function (jqxhr) {\n            handleApiError(jqxhr);\n        }\n    );\n}\n\nfunction setCollectionEditorHeight() {\n    var $contentModal = $('.js-collection__edit-modal'),\n        panelHeight = parseInt($('.panel--off-canvas').height()),\n        headHeight = parseInt($('.slider__head').outerHeight()),\n        contentMargin = (parseInt($contentModal.css('margin-top'))) + (parseInt($contentModal.css('margin-bottom')));\n\n    var contentHeight = panelHeight - headHeight - contentMargin;\n    $contentModal.css('height', contentHeight);\n}\n\n/**\n * Manage files associated with datasets. When uploading a file creates a new dataset\n * @param collectionId\n * @param data\n * @param field - JSON data key ('versions')\n * @param idField - HTML id for the template ('version' or 'correction')\n */\n\nfunction editDatasetVersion(collectionId, data, field, idField) {\n    var downloadExtensions, uriUpload, file;\n    var lastIndex;\n    if (data[field]) {\n        lastIndex = data[field].length;\n    } else {\n        lastIndex = 0;\n        data[field] = [];\n    }\n    var uploadedNotSaved = {uploaded: false, saved: false, fileUrl: \"\", oldLabel: data.description.versionLabel};\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n    //Add\n    if (data.type === 'timeseries_dataset') {\n        downloadExtensions = /\\.csdb$|\\.csv$/;\n    } else if (data.type === 'dataset') {\n        downloadExtensions = /\\.csv$|.xls$|.zip$/;\n    }\n\n    var ajaxRequest = [];\n    var templateData = $.extend(true, {}, data);\n    $(templateData[field]).each(function (index, version) {\n        var dfd = $.Deferred();\n        if (version.correctionNotice) {\n            templateData[field][index].type = true;\n        } else {\n            templateData[field][index].type = false;\n        }\n        templateData[field][index].label = version.label;\n        dfd.resolve();\n        ajaxRequest.push(dfd);\n    });\n\n    $.when.apply($, ajaxRequest).then(function () {\n        var html = templates.editorCorrection({idField: idField});\n        $('#' + idField).replaceWith(html);\n        initialiseDatasetVersion(collectionId, data, templateData, field, idField);\n    });\n\n    $(\"#add-\" + idField).one('click', function () {\n        addTheVersion();\n    });\n\n    function addTheVersion() {\n        var position = $(\".workspace-edit\").scrollTop();\n        Florence.globalVars.pagePos = position + 200;\n\n        // todo: Move this HTML into a handlebars template.\n        $('#' + idField + '-section').append(\n            '<div id=\"' + lastIndex + '\" class=\"edit-section__item\">' +\n            '  <form id=\"UploadForm\">' +\n            '    <textarea class=\"auto-size\" type=\"text\" placeholder=\"Add a label here (E.g. Revised, Final, etc\" id=\"label\"></textarea>' +\n            '    <input type=\"file\" title=\"Select a file and click Submit\" name=\"files\">' +\n            '    <div class=\"dataset-buttons\">' +\n            '    <button class=\"btn btn--primary\" type=\"submit\" form=\"UploadForm\" value=\"submit\">Submit</button>' +\n            '    <button class=\"btn btn-page-cancel\" id=\"file-cancel\">Cancel</button>' +\n            //'    <button class=\"btn-dataset-autocsdb\" id=\"no-file\">Auto CSDB</button>' +\n            '    </div>' +\n            '  </form>' +\n            '  <div id=\"response\"></div>' +\n            '  <ul id=\"list\"></ul>' +\n            '</div>');\n\n        if (data.type === 'dataset') {\n            $('#no-file').remove();\n        }\n\n        // The label field is not used for corrections, just use existing version label.\n        if (idField === \"correction\") {\n            var $versionLabel = $('#UploadForm #label');\n            $versionLabel.text(uploadedNotSaved.oldLabel);\n            $versionLabel.hide();\n        }\n\n        $('#file-cancel').one('click', function (e) {\n            e.preventDefault();\n            $('#' + lastIndex).remove();\n            if (uploadedNotSaved.uploaded === true && uploadedNotSaved.saved === false) {\n                data.description.versionLabel = uploadedNotSaved.oldLabel;\n                deleteContent(collectionId, uploadedNotSaved.fileUrl,\n                    onSuccess = function () {\n                    },\n                    onError = function (error) {\n                        handleApiError(error);\n                    }\n                );\n            }\n            initialiseDatasetVersion(collectionId, data, templateData, field, idField);\n        });\n\n        $('#UploadForm').submit(function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n\n            var formdata = new FormData();\n\n            function showUploadedItem(source) {\n                $('#list').append(source);\n            }\n\n            var versionLabel = this[0].value;\n            file = this[1].files[0];\n\n            // Check that a file has been uploaded\n            if (!file) {\n                sweetAlert('Please select a file to upload');\n                return;\n            }\n\n            if (data.type == \"timeseries_dataset\") {\n                // Validate that the file name matches the datasetId (which is stored in the parent dataset_landing page\n                var parentUrl = getParentPage(data.uri);\n\n                fetch(parentUrl + '/data', {credentials: 'include'}).then(function(response) {\n                    return response.json();\n                }).then(function(parentData) {\n                    var datasetId = (parentData.description.datasetId).toUpperCase(),\n                        downloadTitle = ((file.name).split('.').shift()).toUpperCase();\n                    if (!datasetId) {\n                        // Throw error if the parent page has no dataset ID\n                        sweetAlert({\n                            title: \"Dataset missing an ID\",\n                            text: \"Please go to the parent page and give the dataset an ID\",\n                            type: \"warning\"\n                        });\n                    } else if (datasetId !== downloadTitle) {\n                        // Throw error to user if file name and dataset ID don't match\n                        sweetAlert({\n                            title: \"Warning\",\n                            text: \"CSDB filename must match the dataset's ID\",\n                            type: \"warning\"\n                        });\n                    } else {\n                        saveSubmittedFile();\n                    }\n                }).catch(function(error) {\n                    console.log(\"Error getting timeseries dataset parent data... \", error);\n                });\n            } else {\n                // Not a timeseries_dataset, so continue with saving file as normal\n                saveSubmittedFile();\n            }\n\n            function saveSubmittedFile() {\n                var responseElem = document.getElementById(\"response\");\n                responseElem.innerHTML = \"Uploading . . .\";\n\n                var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n                if (file.name.match(/\\.csv$/)) {\n                    fileNameNoSpace = 'upload-' + fileNameNoSpace;\n                }\n                uriUpload = data.uri + '/' + fileNameNoSpace;\n                var safeUriUpload = checkPathSlashes(uriUpload);\n\n                if (!!file.name.match(downloadExtensions)) {\n                    showUploadedItem(fileNameNoSpace);\n                    if (formdata) {\n                        formdata.append(\"name\", file);\n                    }\n                    $('#list').empty();\n                } else {\n                    sweetAlert({\n                        text: 'This file type is not supported',\n                        type: \"warning\"\n                    });\n                    responseElem.innerHTML = \"\";\n                    $('#' + lastIndex).remove();\n                    editDatasetVersion(collectionId, data, field, idField);\n                    return;\n                }\n\n                if (formdata) {\n                    $.ajax({\n                        url: \"/zebedee/content/\" + collectionId + \"?uri=\" + safeUriUpload,\n                        type: 'POST',\n                        data: formdata,\n                        cache: false,\n                        processData: false,\n                        contentType: false,\n                        success: function () {\n                            uploadedNotSaved.uploaded = true;\n                            uploadedNotSaved.fileUrl = safeUriUpload;\n                            // create the new version/correction\n                            saveNewCorrection(collectionId, data.uri,\n                                function (response) {\n                                    responseElem.innerHTML = \"File uploaded successfully\";\n                                    var tmpDate = Florence.collection.publishDate ? Florence.collection.publishDate : (new Date()).toISOString();\n                                    if (idField === \"correction\") {\n                                        data[field].push({\n                                            correctionNotice: \" \",\n                                            updateDate: tmpDate,\n                                            uri: response,\n                                            label: versionLabel\n                                        });\n                                        // Enter a notice\n                                        var editedSectionValue = {title: 'Correction notice', markdown: ''};\n                                        var saveContent = function (updatedContent) {\n                                            data[field][data[field].length - 1].correctionNotice = updatedContent;\n                                            data.downloads = [{file: fileNameNoSpace}];\n                                            uploadedNotSaved.saved = true;\n                                            $(\"#\" + idField).find('.edit-section__content').prepend('<div id=\"sortable-' + idField + '\" class=\"edit-section__sortable\">');\n                                            $(\"#\" + idField + '-section').remove();\n                                            saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                                        };\n                                        loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n                                    } else {\n                                        data[field].push({\n                                            correctionNotice: \"\",\n                                            updateDate: tmpDate,\n                                            uri: response,\n                                            label: versionLabel\n                                        });\n                                        data.description.versionLabel = versionLabel; // only update the version label for versions not corrections.\n                                        data.downloads = [{file: fileNameNoSpace}];\n                                        uploadedNotSaved.saved = true;\n                                        $(\"#\" + idField).find('.edit-section__content').prepend('<div id=\"sortable-' + idField + '\" class=\"edit-section__sortable\">');\n                                        $(\"#\" + idField + '-section').remove();\n                                        saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                                    }\n                                }, function (response) {\n                                    if (response.status === 409) {\n                                        sweetAlert(\"You can add only one \" + idField + \" before publishing.\");\n                                        responseElem.innerHTML = \"\";\n                                        deleteContent(collectionId, uploadedNotSaved.fileUrl);\n                                    }\n                                    else if (response.status === 404) {\n                                        sweetAlert(\"You can only add \" + idField + \"s to content that has been published.\");\n                                        responseElem.innerHTML = \"\";\n                                        deleteContent(collectionId, uploadedNotSaved.fileUrl);\n                                    }\n                                    else {\n                                        responseElem.innerHTML = \"\";\n                                        handleApiError(response);\n                                    }\n                                }\n                            );\n                        },\n                        error: function (response) {\n                            console.log(\"Error in uploading this file\");\n                            handleApiError(response);\n                        }\n                    });\n                }\n            }\n        });\n\n        $('#no-file').one('click', function (e) {\n            e.preventDefault();\n            // extra security check\n            if (data.type === 'timeseries_dataset') {\n                var versionLabel = $('#UploadForm #label').val();\n                uploadedNotSaved.uploaded = false;\n\n                // create the new version/correction\n                saveNewCorrection(collectionId, data.uri,\n                    function (response) {\n                        var tmpDate = Florence.collection.publishDate ? Florence.collection.publishDate : (new Date()).toISOString();\n                        if (idField === \"correction\") {\n                            data[field].push({\n                                correctionNotice: \" \",\n                                updateDate: tmpDate,\n                                uri: response,\n                                label: versionLabel\n                            });\n                            // Enter a notice\n                            var editedSectionValue = {title: 'Correction notice', markdown: ''};\n                            var saveContent = function (updatedContent) {\n                                data[field][data[field].length - 1].correctionNotice = updatedContent;\n                                //data.downloads = [{file: fileNameNoSpace}];    // not necessary as zebedee will have a CSDB file\n                                uploadedNotSaved.saved = true;\n                                $(\"#\" + idField).find('.edit-section__content').prepend('<div id=\"sortable-' + idField + '\" class=\"edit-section__sortable\">');\n                                $(\"#\" + idField + '-section').remove();\n                                saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                            };\n                            loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n                        } else {\n                            data[field].push({\n                                correctionNotice: \"\",\n                                updateDate: tmpDate,\n                                uri: response,\n                                label: versionLabel\n                            });\n                            data.description.versionLabel = versionLabel; // only update the version label for versions not corrections.\n                            //data.downloads = [{file: fileNameNoSpace}];    // not necessary as zebedee will have a CSDB file\n                            uploadedNotSaved.saved = true;\n                            $(\"#\" + idField).find('.edit-section__content').prepend('<div id=\"sortable-' + idField + '\" class=\"edit-section__sortable\">');\n                            $(\"#\" + idField + '-section').remove();\n                            saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                        }\n                    }, function (response) {\n                        if (response.status === 409) {\n                            sweetAlert(\"You can add only one \" + idField + \" before publishing.\");\n                            deleteContent(collectionId, uploadedNotSaved.fileUrl);\n                        }\n                        else if (response.status === 404) {\n                            sweetAlert(\"You can only add \" + idField + \"s to content that has been published.\");\n                            deleteContent(collectionId, uploadedNotSaved.fileUrl);\n                        }\n                        else {\n                            handleApiError(response);\n                        }\n                    }\n                );\n            } else {\n                sweetAlert(\"Oops!\", \"It looks like this is not a timeseries dataset.\", \"error\");\n            }\n        });\n    }\n}\n\nfunction refreshDatasetVersion(collectionId, data, field, idField) {\n    var ajaxRequest = [];\n    var templateData = $.extend(true, {}, data);\n    $(templateData[field]).each(function (index, version) {\n        var dfd = $.Deferred();\n        if (version.correctionNotice) {\n            templateData[field][index].type = true;\n        } else {\n            templateData[field][index].type = false;\n        }\n        templateData[field][index].label = version.label;\n        dfd.resolve();\n        ajaxRequest.push(dfd);\n    });\n\n    $.when.apply($, ajaxRequest).then(function () {\n        initialiseDatasetVersion(collectionId, data, templateData, field, idField);\n    });\n\n}\n\nfunction initialiseDatasetVersion(collectionId, data, templateData, field, idField) {\n    // Load\n    var list = templateData[field];\n    var correction;\n    if (idField === 'correction') {\n        correction = true;\n    } else {\n        correction = false;\n    }\n    var dataTemplate = {list: list, idField: idField, correction: correction};\n    var html = templates.workEditT8VersionList(dataTemplate);\n    $('#sortable-' + idField).replaceWith(html);\n\n    $(data[field]).each(function (index) {\n        //dateTmp = data[field][index].updateDate;\n        //var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n        //$('#' + idField + '-date_' + index).val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n        //  data[field][index].updateDate = new Date($('#' + idField + '-date_' + index).datepicker('getDate')).toISOString();\n        //  saveDatasetVersion(collectionId, data.uri, data, field, idField);\n        //});\n\n        dateTmp = data[field][index].updateDate;\n\n        var monthName = new Array();\n        monthName[0] = \"January\";\n        monthName[1] = \"February\";\n        monthName[2] = \"March\";\n        monthName[3] = \"April\";\n        monthName[4] = \"May\";\n        monthName[5] = \"June\";\n        monthName[6] = \"July\";\n        monthName[7] = \"August\";\n        monthName[8] = \"September\";\n        monthName[9] = \"October\";\n        monthName[10] = \"November\";\n        monthName[11] = \"December\";\n        //var n = monthName[theDateTime.getMonth()];\n\n        theDateTime = new Date(dateTmp);\n        theYear = theDateTime.getFullYear();\n        theMonth = monthName[theDateTime.getMonth()];\n        theDay = addLeadingZero(theDateTime.getDate());\n        theHours = addLeadingZero(theDateTime.getHours());\n        theMinutes = addLeadingZero(theDateTime.getMinutes());\n        //console.log(theHours +':'+ theMinutes);\n\n        var dateTimeInputString = theDay + ' ' + theMonth + ' ' + theYear + ' ' + theHours + ':' + theMinutes;\n\n        function addLeadingZero(number) {\n            var number = '0' + number;\n            number = number.slice(-2);\n            return number;\n        }\n\n        $('#' + idField + '-date_' + index).val(dateTimeInputString).datetimepicker({\n            dateFormat: 'dd MM yy',\n            controlType: 'select',\n            oneLine: true,\n            timeFormat: 'HH:mm',\n            onClose: function () {\n                function isDonePressed() {\n                    return ($('#ui-datepicker-div').html().indexOf('ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all ui-state-hover') > -1);\n                }\n\n                if (isDonePressed()) {\n                    data[field][index].updateDate = new Date($('#' + idField + '-date_' + index).datetimepicker('getDate')).toISOString();\n                    console.log(\"Run save \" + index);\n                    saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                }\n            }\n        });\n\n        if (idField === 'correction') {\n            $('#' + idField + '-edit_' + index).click(function () {\n                var markdown = data[field][index].correctionNotice;\n                var editedSectionValue = {title: 'Correction notice', markdown: markdown};\n                var saveContent = function (updatedContent) {\n                    data[field][index].correctionNotice = updatedContent;\n                    saveDatasetVersion(collectionId, data.uri, data, field, idField);\n                };\n                loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n            });\n        }\n        $('#' + idField + '-edit-label_' + index).click(function () {\n            var markdown = data[field][index].label ? data[field][index].label : \"\";\n            var editedSectionValue = {title: 'Label content', markdown: markdown};\n            var saveContent = function (updatedContent) {\n                data[field][index].label = updatedContent;\n                if (index === data[field].length - 1) {\n                    data.description.versionLabel = updatedContent;\n                }\n                saveDatasetVersion(collectionId, data.uri, data, field, idField);\n            };\n            loadMarkdownEditor(editedSectionValue, saveContent, data);\n        });\n        // Delete\n        $('#' + idField + '-delete_' + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"This will revert all changes you have made in this file. Are you sure you want to delete this \" + idField + \"?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    swal({\n                        title: \"Deleted\",\n                        text: \"This \" + idField + \" version has been deleted\",\n                        type: \"success\",\n                        timer: 2000\n                    });\n                    var pathToDelete = data.uri;\n                    var fileToDelete = pathToDelete + '/' + data.downloads[0].file;  //Saves always the latest\n                    var uriToDelete = $('#' + idField + '-edition_' + index).attr(idField + '-url');\n                    deleteUnpublishedVersion(collectionId, uriToDelete, function () {\n                        var position = $(\".workspace-edit\").scrollTop();\n                        Florence.globalVars.pagePos = position;\n                        $('#' + idField + '-delete_' + index).parent().remove();\n                        // delete uploaded file\n                        deleteContent(collectionId, fileToDelete, function () {\n                            console.log(\"File deleted\");\n                        }, function (error) {\n                            if (error.status === 404) {\n                                sweetAlert(\"There was no CSDB file to delete or this \" + idField + \" has been already published.\");\n                            }\n                            else {\n                                handleApiError(error);\n                            }\n                        });\n                        // delete modified data.json and revert to published\n                        deleteContent(collectionId, pathToDelete, function () {\n                            loadPageDataIntoEditor(pathToDelete, collectionId);\n                            refreshPreview(pathToDelete);\n                        }, function (error) {\n                            handleApiError(error);\n                        });\n                    }, function (response) {\n                        if (response.status === 404) {\n                            sweetAlert(\"You cannot delete a \" + idField + \" that has been published.\");\n                        }\n                        else {\n                            handleApiError(response);\n                        }\n                    });\n                }\n            });\n        });\n    });\n\n}\n\nfunction saveDatasetVersion(collectionId, path, data, field, idField) {\n\n    putContent(collectionId, path, JSON.stringify(data),\n        function () {\n            Florence.Editor.isDirty = false;\n            refreshDatasetVersion(collectionId, data, field, idField);\n            refreshPreview(path);\n        },\n        function (response) {\n            if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        }\n    );\n}\n\n/**\n * Manages dates for release calendar\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editDate(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  runDatePicker(dataTemplate);\n  var html = templates.editorDate(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  initialiseNoteMarkdown(collectionId, data, templateData, field, idField);\n}\n\nfunction runDatePicker(dataTemplate) {\n  if(dataTemplate && dataTemplate.list) {\n    var countSections = dataTemplate.list.length;\n    var i = 0;\n    while (i < countSections) {\n      var tmpDate = dataTemplate.list[i].previousDate;\n      dataTemplate.list[i].previousDate = $.datepicker.formatDate('dd MM yy', new Date(tmpDate));\n      i++;\n    }\n  }\n}\n\nfunction refreshNoteMarkdown(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  runDatePicker(dataTemplate);\n  var html = templates.editorDate(dataTemplate);\n  $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n  initialiseNoteMarkdown(collectionId, data, templateData, field, idField)\n}\n\nfunction initialiseNoteMarkdown(collectionId, data, templateData, field, idField) {\n  // Load\n  $(data[field]).each(function (index) {\n    $('#' + idField + '-note_' + index).click(function () {\n      var markdown = $('#' + idField + '-markdown_' + index).val();\n      var editedSectionValue = {title: 'Note', markdown: markdown};\n      var saveContent = function (updatedContent) {\n        data[field][index].changeNotice = updatedContent;\n        templateData[field][index].changeNotice = updatedContent;\n        saveNoteMarkdown(collectionId, data.uri, data, templateData, field, idField);\n      };\n      loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n    });\n  });\n}\n\nfunction saveNoteMarkdown(collectionId, path, data, templateData, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    success = function () {\n      Florence.Editor.isDirty = false;\n      refreshNoteMarkdown(collectionId, data, templateData, field, idField);\n      refreshPreview(data.uri);\n    },\n    error = function (response) {\n      if (response.status === 400) {\n        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\n/**\n * Manage correction of documents with files attached (compendium_data, article_download)\n * @param collectionId\n * @param data\n * @param field - JSON data key ('versions')\n * @param idField - HTML id for the template ('correction')\n */\n\nfunction editDocWithFilesCorrection(collectionId, data, field, idField) {\n  var downloadExtensions, file;\n  if (!data[field]) {\n    data[field] = [];\n  }\n  var oldFile = $.extend(true, {}, data);\n  var uploadedNotSaved = {uploaded: false, saved: false, files: oldFile.downloads};\n  $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n  //Add file types\n  if (data.type === 'compendium_data'){\n    downloadExtensions = /\\.csv$|.xls$|.zip$/;\n  }\n  else if (data.type === 'article_download'){\n    downloadExtensions = /\\.pdf$/;\n  }\n\n  refreshDocWithFilesCorrection(collectionId, data, field, idField);\n\n\n  $(\"#add-\" + idField).one('click', function () {\n\n    $(\"#add-\" + idField).parent().append('<button class=\"btn-page-delete\"' +\n      ' id=\"cancel-correction\">Cancel</button>');\n    //Display the list of uploaded files in the ref table\n    var list = data.downloads;\n    var html = templates.editorDocWithFiles(list);\n    $('#sortable-correction').append(html);\n\n    //Update the files to be corrected\n    $(data.downloads).each(function (index) {\n      $('#correction-upload_' + index).click(function () {\n        fileCorrection(index);\n      }).children().click(function (e) {\n        e.stopPropagation();\n      });\n    });\n\n    //Cancel the correction\n    $('#cancel-correction').click(function () {\n      //Check the files uploaded\n      var filesToDelete = checkFilesUploaded (uploadedNotSaved.files, data.downloads);\n      if (filesToDelete) {\n        _.each(filesToDelete, function (file) {\n          var fileToDelete = data.uri + file;\n          deleteContent(collectionId, fileToDelete);\n        });\n      }\n      loadPageDataIntoEditor(data.uri, collectionId);\n      refreshPreview(data.uri);\n    });\n\n    //Save the correction\n    $(\"#add-\" + idField).html(\"Save correction\").on().click(function () {\n      saveNewCorrection(collectionId, data.uri,\n        function (response) {\n          var tmpDate = (new Date()).toISOString();           // it could use releaseDate\n          data[field].push({\n            correctionNotice: \"\",\n            updateDate: tmpDate,\n            uri: response\n          });\n          uploadedNotSaved.saved = true;\n          $(\"#add-\" + idField).parents('.edit-section__content').remove('#sortable-' + idField)\n            .find('.text-center').prepend('<div id=\"sortable-' + idField + '\" class=\"edit-section__sortable\">');  //check .after()\n          // Enter a notice\n          var editedSectionValue = {title: 'Enter correction notice', markdown: ''};\n          var saveContent = function (updatedContent) {\n            data[field][data[field].length - 1].correctionNotice = updatedContent;\n            saveDocWithFilesCorrection(collectionId, data.uri, data, field, idField);\n          };\n          loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n          //saveDocWithFilesCorrection(collectionId, data.uri, data, field, idField);\n        }, function (response) {\n          if (response.status === 409) {\n            //Revert to condition before error\n            var filesToDelete = checkFilesUploaded(uploadedNotSaved.files, data.downloads);\n            if (filesToDelete) {\n              _.each(filesToDelete, function (download) {\n                var fileToDelete = data.uri + '/' + download;\n                deleteContent(collectionId, fileToDelete);\n              });\n            }\n            sweetAlert(\"You can add only one \" + idField + \" before publishing.\");\n            refreshDocWithFilesCorrection(collectionId, data, field, idField);\n          }\n          else if (response.status === 404) {\n            //Revert to condition before error\n            var filesToDelete = checkFilesUploaded(uploadedNotSaved.files, data.downloads);\n            if (filesToDelete) {\n              _.each(filesToDelete, function (download) {\n                var fileToDelete = data.uri + '/' + download;\n                deleteContent(collectionId, fileToDelete);\n              });\n            }\n            data.downloads = uploadedNotSaved.files;\n            sweetAlert(\"You can only add \" + idField + \"s to content that has been published.\");\n            refreshDocWithFilesCorrection(collectionId, data, field, idField);\n          }\n          else {\n            //Revert to condition before error\n            var filesToDelete = checkFilesUploaded(uploadedNotSaved.files, data.downloads);\n            if (filesToDelete) {\n              _.each(filesToDelete, function (download) {\n                var fileToDelete = data.uri + '/' + download;\n                deleteContent(collectionId, fileToDelete);\n              });\n            }\n            handleApiError(response);\n            refreshDocWithFilesCorrection(collectionId, data, field, idField);\n          }\n        }\n      );\n    });\n  });\n\n  function fileCorrection(index) {\n    var position = $(\".workspace-edit\").scrollTop();\n    Florence.globalVars.pagePos = position + 200;\n    var html = templates.uploadFileForm(index);\n    $('#correction-filename_show_' + index).append(html);\n\n    $('#file-cancel').one('click', function (e) {\n      e.preventDefault();\n      $('#' + index).remove();\n      if (uploadedNotSaved.uploaded === true && uploadedNotSaved.saved === false) {\n        data.downloads[index].file = uploadedNotSaved.files[index].file;\n        var fileToDelete = data.uri + '/' + uploadedNotSaved.files[index].file;\n        deleteContent(collectionId, fileToDelete);\n      }\n      refreshDocWithFilesCorrection(collectionId, data, field, idField);\n    });\n\n    $('#UploadForm').submit(function (e) {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n\n      var formdata = new FormData();\n\n      function showUploadedItem(source) {\n        $('#list').append(source);\n      }\n\n      file = this[0].files[0];\n      if (!file) {\n        alert('Please select a file to upload.');\n        return;\n      }\n\n      document.getElementById(\"response\").innerHTML = \"Uploading . . .\";\n\n      var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n\n      if (!!file.name.match(downloadExtensions)) {\n        showUploadedItem(fileNameNoSpace);\n        if (formdata) {\n          formdata.append(\"name\", file);\n        }\n      } else {\n        alert('This file type is not supported');\n        $('#' + index).remove();\n        editDocWithFilesCorrection(collectionId, data, field, idField);\n        return;\n      }\n\n      if (formdata) {\n        $.ajax({\n          url: \"/zebedee/content/\" + collectionId + \"?uri=\" + data.uri + '/' + fileNameNoSpace,\n          type: 'POST',\n          data: formdata,\n          cache: false,\n          processData: false,\n          contentType: false,\n          success: function () {\n            document.getElementById(\"response\").innerHTML = \"File uploaded successfully\";\n            uploadedNotSaved.uploaded = true;\n            $('#' + index).remove();\n            $('#correction-filename_show_' + index).replaceWith('<p id=\"correction-filename_show_' + index + '\">' + fileNameNoSpace + '</p>');\n            data.downloads[index].file = fileNameNoSpace;\n          },\n          error: function (response) {\n            handleApiError(response);\n          }\n        });\n      }\n    });\n  }\n}\n\nfunction refreshDocWithFilesCorrection(collectionId, data, field, idField) {\n  var list = data[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorCorrection(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  initialiseDocWithFilesCorrection(collectionId, data, field, idField)\n}\n\nfunction initialiseDocWithFilesCorrection(collectionId, data, field, idField) {\n  // Load\n  $(data[field]).each(function (index) {\n    dateTmp = data[field][index].updateDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#' + idField + '-date_' + index).val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data[field][index].updateDate = new Date($('#' + idField + '-date_' + index).datepicker('getDate')).toISOString();\n      saveDocWithFilesCorrection(collectionId, data.uri, data, field, idField);\n    });\n    if (idField === 'correction') {\n      $('#' + idField + '-edit_' + index).click(function () {\n        var markdown = $('#' + idField + '-markdown_' + index).val();\n        var editedSectionValue = {title: 'Correction notice', markdown: markdown};\n        var saveContent = function (updatedContent) {\n          data[field][index].correctionNotice = updatedContent;\n          saveDocWithFilesCorrection(collectionId, data.uri, data, field, idField);\n        };\n        loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n      });\n    }\n\n    // Delete\n    $('#' + idField + '-delete_' + index).click(function () {\n      var result = confirm(\"This will revert all changes you have made in this file. Are you sure you want to delete\" +\n        \" this \" + idField + \"?\");\n      if (result === true) {\n        var pathToDelete = data.uri;\n        var filesToDelete = data.downloads;  //Delete all files in directory\n        var uriToDelete = $(this).parent().parent().children('#' + idField + '-edition_' + index).attr(idField + '-url');\n        deleteUnpublishedVersion(collectionId, uriToDelete, function () {\n          var position = $(\".workspace-edit\").scrollTop();\n          Florence.globalVars.pagePos = position;\n          $(this).parent().remove();\n          //delete uploaded files in this directory\n          _.each(filesToDelete, function (download) {\n            fileToDelete = data.uri + '/' + download.file;\n            deleteContent(collectionId, fileToDelete);\n          });\n          // delete modified data.json and revert to pubished\n          deleteContent(collectionId, pathToDelete, function () {\n            loadPageDataIntoEditor(pathToDelete, collectionId);\n            refreshPreview(pathToDelete);\n          }, function (error) {\n            handleApiError(error);\n          });\n        }, function (response) {\n          if (response.status === 404) {\n            sweetAlert(\"You cannot delete a \" + idField + \" that has been published.\");\n\n          }\n          else {\n            handleApiError(response);\n          }\n        });\n      }\n    });\n  });\n}\n\nfunction saveDocWithFilesCorrection(collectionId, path, data, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    function () {\n      Florence.Editor.isDirty = false;\n      refreshDocWithFilesCorrection(collectionId, data, field, idField);\n      refreshPreview(path);\n    },\n    function (response) {\n      if (response.status === 400) {\n        alert(\"Cannot edit this page. It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\nfunction checkFilesUploaded (oldFiles, newFiles) {\n  var diff = [];\n  _.each(oldFiles, function (oldFile, i) {\n    if (oldFile.file !== newFiles[i].file) {\n      diff.push(newFiles[i].file);\n    }\n  });\n  return diff;\n}\n\n/**\n * Manages corrections (versions)\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editDocumentCorrection(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorCorrection(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  initialiseCorrection(collectionId, data, templateData, field, idField);\n  // New correction\n  $(\"#add-\" + idField).one('click', function () {\n    if (!data[field]) {\n      data[field] = [];\n      templateData[field] = [];\n    }\n    saveNewCorrection(collectionId, data.uri, function (response) {\n      var tmpDate = Florence.collection.publishDate ? Florence.collection.publishDate : (new Date()).toISOString();\n      data[field].push({correctionNotice: \"\", updateDate: tmpDate, uri: response});\n      templateData[field].push({correctionNotice: \"\", updateDate: tmpDate, uri: response});\n      // Enter a notice\n      var editedSectionValue = {title: 'Correction notice', markdown: data[field].correctionNotice};\n      var saveContent = function (updatedContent) {\n        data[field][data[field].length - 1].correctionNotice = updatedContent;\n        saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n      };\n      loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n      $(\"#add-\" + idField).remove();\n    }, function (response) {\n      if (response.status === 409) {\n        sweetAlert(\"You can add only one correction before publishing.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    });\n  });\n  $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshCorrection(collectionId, data, templateData, field, idField) {\n  var list = templateData[field];\n  var dataTemplate = {list: list, idField: idField};\n  var html = templates.editorCorrection(dataTemplate);\n  $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n  initialiseCorrection(collectionId, data, templateData, field, idField);\n}\n\nfunction initialiseCorrection(collectionId, data, templateData, field, idField) {\n  // Load\n  $(data[field]).each(function (index) {\n    dateTmp = data[field][index].updateDate;\n    // ORIGINAL TIME PICKER CODE\n    // var dateTmpCorr = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    // $('#correction-date_' + index).val(dateTmpCorr).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n    //  data[field][index].updateDate = new Date($('#correction-date_' + index).datepicker('getDate')).toISOString();\n    //  templateData[field][index].updateDate = new Date($('#correction-date_' + index).datepicker('getDate')).toISOString();\n    //  saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n    // });\n\n\n    var monthName = new Array();\n    monthName[0] = \"January\";\n    monthName[1] = \"February\";\n    monthName[2] = \"March\";\n    monthName[3] = \"April\";\n    monthName[4] = \"May\";\n    monthName[5] = \"June\";\n    monthName[6] = \"July\";\n    monthName[7] = \"August\";\n    monthName[8] = \"September\";\n    monthName[9] = \"October\";\n    monthName[10] = \"November\";\n    monthName[11] = \"December\";\n    //var n = monthName[theDateTime.getMonth()];\n\n    theDateTime = new Date(dateTmp);\n    theYear = theDateTime.getFullYear();\n    theMonth = monthName[theDateTime.getMonth()];\n    theDay = addLeadingZero(theDateTime.getDate());\n    theHours = addLeadingZero(theDateTime.getHours());\n    theMinutes = addLeadingZero(theDateTime.getMinutes());\n    //console.log(theHours +':'+ theMinutes);\n\n    var dateTimeInputString = theDay + ' ' + theMonth + ' ' + theYear + ' ' + theHours +':' + theMinutes;\n\n    function addLeadingZero(number){\n      var number = '0' + number;\n      number = number.slice(-2);\n      return number;\n    }\n\n    $('#correction-date_' + index).val(dateTimeInputString).datetimepicker({\n        dateFormat: 'dd MM yy',\n        controlType: 'select',\n        oneLine: true,\n        timeFormat: 'HH:mm',\n        onClose: function () {\n          function isDonePressed() {\n            return ($('#ui-datepicker-div').html().indexOf('ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all ui-state-hover') > -1);\n          }\n          if (isDonePressed()){\n            data[field][index].updateDate = new Date($('#correction-date_' + index).datetimepicker('getDate')).toISOString();\n            templateData[field][index].updateDate = new Date($('#correction-date_' + index).datetimepicker('getDate')).toISOString();\n            console.log(\"Run save \" + index);\n            saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n          }\n        }\n      });\n    //$('#correction-date_' + index).datetimepicker('setDate', new Date(dateTmp));\n\n\n\n    ///////////look at me\n\n    //$('body').on('click', '#done-button', function () {\n    //  data[field][index].updateDate = new Date($('#correction-date_' + index).datetimepicker('getDate')).toISOString();\n    //  templateData[field][index].updateDate = new Date($('#correction-date_' + index).datetimepicker('getDate')).toISOString();\n    //  saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n    //});\n\n\n\n    $('#' + idField + '-edit_' + index).click(function () {\n      var markdown = data[field][index].correctionNotice;\n      var editedSectionValue = {title: 'Correction notice', markdown: markdown};\n      var saveContent = function (updatedContent) {\n        data[field][index].correctionNotice = updatedContent;\n        templateData[field][index].correctionNotice = updatedContent;\n        saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n      };\n      loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n    });\n    // Delete\n    $('#' + idField + '-delete_' + index).click(function () {\n      swal ({\n        title: \"Warning\",\n        text: \"Are you sure you want to delete this correction?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function(result){\n        if (result === true) {\n          deleteUnpublishedVersion(collectionId, data[field][index].uri, function () {\n            var position = $(\".workspace-edit\").scrollTop();\n            Florence.globalVars.pagePos = position;\n            $(this).parent().remove();\n            data[field].splice(index, 1);\n            templateData[field].splice(index, 1);\n            saveCorrection(collectionId, data.uri, data, templateData, field, idField);\n            swal({\n              title: \"Deleted\",\n              text: \"This correction has been deleted\",\n              type: \"success\",\n              timer: 2000\n            });\n          }, function (response) {\n            if (response.status === 400) {\n              sweetAlert(\"You cannot delete a correction that has been published.\");\n            }\n            else {\n              handleApiError(response);\n            }\n          });\n        }\n      });\n    });\n  });\n}\n\nfunction saveCorrection(collectionId, path, data, templateData, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    function () {\n      Florence.Editor.isDirty = false;\n      refreshCorrection(collectionId, data, templateData, field, idField);\n      refreshPreview(data.uri);\n    },\n    function (response) {\n      if (response.status === 400) {\n        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\n/**\n * Manages related data\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editIntAndExtLinks(collectionId, data, templateData, field, idField) {\n    $(data[field]).each(function (index, path) {\n        if (!this.title) {\n            templateData[field][index] = (function () {\n                resolveInternalLinksTitle(collectionId, data, templateData, field, idField, index)\n            })();\n        } else {\n            templateData[field][index].description = {};\n            templateData[field][index].description.title = templateData[field][index].title;\n        }\n    });\n    var list = templateData[field];\n    var dataTemplate = createRelatedItemAccordionSectionViewModel(idField, list, data);\n    var html = templates.editorRelated(dataTemplate);\n    $('#' + idField).replaceWith(html);\n    initialiseLinks(collectionId, data, templateData, field, idField);\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshLinks(collectionId, data, templateData, field, idField) {\n    var list = templateData[field];\n    var dataTemplate = createRelatedItemAccordionSectionViewModel(idField, list, data);\n    var html = templates.editorRelated(dataTemplate);\n    $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n    initialiseLinks(collectionId, data, templateData, field, idField);\n}\n\nfunction initialiseLinks(collectionId, data, templateData, field, idField) {\n    // Load\n    $(data[field]).each(function (index) {\n        // Delete\n        $('#' + idField + '-delete_' + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete this link?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    swal({\n                        title: \"Deleted\",\n                        text: \"This \" + idField + \" has been deleted\",\n                        type: \"success\",\n                        timer: 2000\n                    });\n                    var position = $(\".workspace-edit\").scrollTop();\n                    Florence.globalVars.pagePos = position;\n                    $(this).parent().remove();\n                    data[field].splice(index, 1);\n                    templateData[field].splice(index, 1);\n                    putContent(collectionId, data.uri, JSON.stringify(data),\n                        success = function () {\n                            Florence.Editor.isDirty = false;\n                            refreshPreview(data.uri);\n                            refreshLinks(collectionId, data, templateData, field, idField);\n                        },\n                        error = function (response) {\n                            if (response.status === 400) {\n                                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                            }\n                            else {\n                                handleApiError(response);\n                            }\n                        }\n                    );\n                }\n            });\n        });\n    });\n\n    //Add\n    //$('#add-' + idField).off().one('click', function () {\n    $('#add-link').off().click(function () {\n        //add a modal to select an option for internal or external\n        var position = $(\".workspace-edit\").scrollTop();\n        Florence.globalVars.pagePos = position;\n        var modalIntOrExt = templates.linkModal;\n        $('.workspace-menu').append(modalIntOrExt);\n        //They choose internal\n        $('#internal-link').click(function () {\n            if (!data[field]) {\n                data[field] = [];\n            }\n\n            //Florence.globalVars.pagePos = position;\n            var modal = templates.relatedModal;\n            $('.modal').remove();\n            $('.workspace-menu').append(modal);\n            $('.modal-box input[type=text]').focus();\n\n            //Modal click events\n            $('.btn-uri-cancel').off().one('click', function () {\n                $('.modal').remove();\n            });\n\n            $('.btn-uri-get').off().click(function () {\n                var pastedUrl = $('#uri-input').val();\n                if (pastedUrl === \"\") {\n                    sweetAlert(\"This field cannot be empty. Please paste a valid url address\");\n                } else {\n                    var dataUrl = checkPathParsed(pastedUrl);\n                    if (dataUrl === \"\") {    //special case for home page\n                        dataUrl = \"/\";\n                    }\n                    data[field].push({uri: dataUrl});\n                    templateData[field].push({uri: dataUrl});\n                    saveExternalLink(collectionId, data.uri, data, templateData, field, idField);\n                    $('.modal').remove();\n                }\n            });\n\n            $('.btn-uri-browse').off().one('click', function () {\n                var iframeEvent = document.getElementById('iframe').contentWindow;\n                iframeEvent.removeEventListener('click', Florence.Handler, true);\n                createWorkspace(data.uri, collectionId, '', null , true);\n                $('.modal').remove();\n\n                //Disable the editor\n                $('body').append(\n                    \"<div class='col col--5 panel modal-background'></div>\"\n                );\n\n                //Add buttons to iframe window\n                var iframeNav = templates.iframeNav();\n                $(iframeNav).hide().appendTo('.browser').fadeIn(600);\n\n                //Take iframe window to homepage/root\n                $('#iframe').attr('src', '/');\n\n                $('.btn-browse-cancel').off().one('click', function () {\n                    createWorkspace(data.uri, collectionId, 'edit');\n                    $('.iframe-nav').remove();\n                    $('.modal-background').remove();\n                });\n\n                //Remove added markup if user navigates away from editor screen\n                $('a:not(.btn-browse-get)').click(function () {\n                    $('.iframe-nav').remove();\n                    $('.modal-background').remove();\n                });\n\n                $('.btn-browse-get').off().one('click', function () {\n                    var dataUrl = getPathNameTrimLast();\n                    if (dataUrl === \"\") {   //special case for home page\n                        dataUrl = \"/\";\n                    }\n                    var latestUrl;\n                    //if you wanted to add latest automatically uncomment these lines\n                    if (dataUrl.match(/\\/articles\\//) || dataUrl.match(/\\/bulletins\\//)) {\n                        swal({\n                            title: \"Warning\",\n                            text: \"Would you like to always show the latest release of this document?\",\n                            type: \"warning\",\n                            showCancelButton: true,\n                            confirmButtonText: \"Yes\",\n                            cancelButtonText: \"No\",\n                            closeOnConfirm: true\n                        }, function (result) {\n                            if (result === true) {\n                                var tempUrl = dataUrl.split('/');\n                                tempUrl.pop();\n                                tempUrl.push('latest');\n                                latestUrl = tempUrl.join('/');\n                            } else {\n                                latestUrl = dataUrl;\n                            }\n                            $('.iframe-nav').remove();\n                            $('.modal-background').remove();\n                            data[field].push({uri: latestUrl});\n                            templateData[field].push({uri: latestUrl});\n                            saveExternalLink(collectionId, data.uri, data, templateData, field, idField);\n                        });\n                    } else {\n                        latestUrl = dataUrl;\n                        $('.iframe-nav').remove();\n                        $('.modal-background').remove();\n                        data[field].push({uri: latestUrl});\n                        templateData[field].push({uri: latestUrl});\n                        saveExternalLink(collectionId, data.uri, data, templateData, field, idField);\n                    }\n                });\n            });\n        });\n\n        //They choose external\n        $('#external-link').click(function () {\n            if (!data[field]) {\n                data[field] = [];\n            }\n            var modal = templates.linkExternalModal;\n            var uri, title;\n            $('.modal').remove();\n            $('.workspace-menu').append(modal);\n            $('#uri-input').change(function () {\n                uri = $('#uri-input').val();\n            });\n            $('#uri-title').change(function () {\n                title = $('#uri-title').val();\n            });\n            $('.btn-uri-get').off().click(function () {\n                if (!title) {\n                    sweetAlert('You need to enter a title to continue');\n                }\n                else {\n                    data[field].push({uri: uri, title: title});\n                    saveExternalLink(collectionId, data.uri, data, templateData, field, idField);\n                    $('.modal').remove();\n                }\n            });\n            $('.btn-uri-cancel').off().click(function () {\n                $('.modal').remove();\n            });\n        });\n        //They cancel\n        $('.btn-uri-cancel').off().click(function () {\n            $('.modal').remove();\n        });\n    });\n\n    // Make sections sortable\n    function sortable() {\n        $('#sortable-' + idField).sortable({\n            stop: function () {\n                $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n                    $(this).empty().append(index + 1);\n                });\n            }\n        });\n    }\n\n    sortable();\n}\n\nfunction resolveInternalLinksTitle(collectionId, data, templateData, field, idField, index) {\n    getPageDataTitle(collectionId, templateData[field][index].uri,\n        success = function (response) {\n            templateData[field][index] = response;\n            templateData[field][index].description = {};\n            templateData[field][index].description.title = response.title;\n            if (response.edition) {\n                templateData[field][index].description.edition = response.edition;\n            }\n            refreshLinks(collectionId, data, templateData, field, idField);\n        },\n        error = function () {\n            sweetAlert(\"Error\", field + ' address: ' + templateData[field][index].uri + ' is not found.', \"error\");\n        }\n    );\n}\n\n\nfunction saveExternalLink(collectionId, path, data, templateData, field, idField) {\n    putContent(collectionId, path, JSON.stringify(data),\n        success = function (response) {\n            Florence.Editor.isDirty = false;\n            refreshLinks(collectionId, data, templateData, field, idField);\n            createWorkspace(data.uri, collectionId, 'edit');\n        },\n        error = function (response) {\n            if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        }\n    );\n}\n\n/**\n * Manages markdown content (saves an object)\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param title - header to appear in the editor\n */\n\nfunction editMarkdownOneObject (collectionId, data, field, title) {\n  var list = data[field];\n\n  if(!data[field]) {\n    data[field] = {}\n  }\n\n  var dataTemplate;\n  if (title) {\n    dataTemplate = {list: list, header: title};\n  } else {\n    dataTemplate = {list: list, header: 'Content'};\n  }\n\n  var html = templates.editorContentOne(dataTemplate);\n  $('#one').replaceWith(html);\n  // Load\n  $('#one-edit').click(function() {\n    var markdown = $('#one-markdown').val();\n    var editedSectionValue = {title: 'Content', markdown: markdown};\n    var saveContent = function(updatedContent) {\n      data[field].markdown = updatedContent;\n      saveMarkdownOne (collectionId, data.uri, data, field);\n    };\n\n    loadMarkdownEditor(editedSectionValue, saveContent, data);\n  });\n\n  // Delete\n  $('#one-delete').click(function() {\n    swal ({\n      title: \"Warning\",\n      text: \"Are you sure you want to delete?\",\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: \"Delete\",\n      cancelButtonText: \"Cancel\",\n      closeOnConfirm: false\n    }, function(result) {\n      if (result === true) {\n        $(this).parent().remove();\n        data[field] = {};\n        saveMarkdownOne(collectionId, data.uri, data, field);\n        swal({\n          title: \"Deleted\",\n          text: \"This \" + idField + \" has been deleted\",\n          type: \"success\",\n          timer: 2000\n        });\n      }\n    });\n  });\n}\n\nfunction saveMarkdownOne (collectionId, path, data, field) {\n  putContent(collectionId, path, JSON.stringify(data),\n    success = function () {\n      Florence.Editor.isDirty = false;\n      editMarkdownOneObject (collectionId, data, field);\n    },\n    error = function (response) {\n      if (response.status === 400) {\n          sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\n/**\n * Manages markdown content (saves an array)\n * @param collectionId\n * @param data\n * @param field - JSON data key\n */\n\nfunction editMarkdownWithNoTitle(collectionId, data, field, idField) {\n  var list = data[field];\n\n  var dataTemplate;\n  if (idField === 'note') {\n    dataTemplate = {list: list, idField: idField, header: 'Notes'};\n  } else if (idField === 'prerelease') {\n    dataTemplate = {list: list, idField: idField, header: 'Pre-release access'};\n  } else {\n    dataTemplate = {list: list, idField: idField, header: 'Content'};\n  }\n\n  var html = templates.editorContentNoTitle(dataTemplate);\n  $('#' + idField).replaceWith(html);\n  // Load\n  $('#content-edit').click(function () {\n    var markdown = $('#content-markdown').val();\n    var editedSectionValue = {title: 'Content', markdown: markdown};\n    var saveContent = function (updatedContent) {\n      data[field] = [updatedContent];\n      saveMarkdownNoTitle(collectionId, data.uri, data, field, idField);\n\n      // when finished in the markdown editor be sure to refresh the charts / tables / images list to show any newly added\n      refreshChartList(collectionId, data);\n      refreshTablesList(collectionId, data);\n      refreshImagesList(collectionId, data);\n    };\n    loadMarkdownEditor(editedSectionValue, saveContent, data);\n  });\n\n  // Delete\n  $('#content-delete').click(function () {\n    swal({\n      title: \"Warning\",\n      text: \"Are you sure you want to delete?\",\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: \"Delete\",\n      cancelButtonText: \"Cancel\",\n      closeOnConfirm: false\n    }, function (result) {\n      if (result === true) {\n        $(this).parent().remove();\n        data[field] = [];\n        saveMarkdownNoTitle(collectionId, data.uri, data, field, idField);\n        swal({\n          title: \"Deleted\",\n          text: \"This \" + idField + \" has been deleted\",\n          type: \"success\",\n          timer: 2000\n        });\n      }\n    });\n  });\n\n}\n\nfunction saveMarkdownNoTitle(collectionId, path, data, field, idField) {\n  putContent(collectionId, path, JSON.stringify(data),\n    success = function () {\n      Florence.Editor.isDirty = false;\n      editMarkdownWithNoTitle(collectionId, data, field, idField);\n    },\n    error = function (response) {\n      if (response.status === 400) {\n        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n      }\n      else {\n        handleApiError(response);\n      }\n    }\n  );\n}\n\nfunction editServiceMessage(collectionId, data) {\n  if (!data.serviceMessage) {\n    data.serviceMessage = '';\n  }\n  //add template to editor\n  var text = data.serviceMessage;\n  var html = templates.editorServiceMessage(text);\n  $('#srv-msg').replaceWith(html);\n  //change text\n  $(\"#srv-msg-txt\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.serviceMessage = $(this).val();\n  });\n\n  //delete\n  $('#srv-msg-delete').click(function () {\n    swal({\n      title: \"Warning\",\n      text: \"Are you sure you want to delete?\",\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: \"Delete\",\n      cancelButtonText: \"Cancel\",\n      closeOnConfirm: true\n    }, function (result) {\n      if (result === true) {\n        data.serviceMessage = \"\";\n        putContent(collectionId, '', JSON.stringify(data),\n          success = function () {\n            Florence.Editor.isDirty = false;\n            createWorkspace('/', collectionId, 'edit');\n          },\n          error = function (response) {\n            if (response.status === 400) {\n              sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n              handleApiError(response);\n            }\n          }\n        );\n      }\n    });\n  });\n}/**\n * Manages topics to appear in list pages\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction editTopics(collectionId, data, templateData, field, idField) {\n    var list = templateData[field];\n    var dataTemplate = {list: list, idField: idField};\n    var html = templates.editorTopics(dataTemplate);\n    $('#' + idField).replaceWith(html);\n    initialiseTopics(collectionId, data, templateData, field, idField);\n    resolveTopicTitle(collectionId, data, templateData, field, idField);\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshTopics(collectionId, data, templateData, field, idField) {\n    var list = templateData[field];\n    var dataTemplate = {list: list, idField: idField};\n    var html = templates.editorTopics(dataTemplate);\n    $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n    initialiseTopics(collectionId, data, templateData, field, idField);\n}\n\nfunction initialiseTopics(collectionId, data, templateData, field, idField) {\n    // Load\n    if (!data[field] || data[field].length === 0) {\n        editTopics['lastIndex' + field] = 0;\n    } else {\n        $(data[field]).each(function (index) {\n            editTopics['lastIndex' + field] = index + 1;\n\n            // Delete\n            $('#' + idField + '-delete_' + index).click(function () {\n                swal({\n                    title: \"Warning\",\n                    text: \"Are you sure you want to delete this link?\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonText: \"Delete\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: false\n                }, function (result) {\n                    if (result === true) {\n                        swal({\n                            title: \"Deleted\",\n                            text: \"This \" + idField + \" has been deleted\",\n                            type: \"success\",\n                            timer: 2000\n                        });\n                        var position = $(\".workspace-edit\").scrollTop();\n                        Florence.globalVars.pagePos = position;\n                        $(this).parent().remove();\n                        data[field].splice(index, 1);\n                        templateData[field].splice(index, 1);\n                        putContent(collectionId, data.uri, JSON.stringify(data),\n                            success = function () {\n                                Florence.Editor.isDirty = false;\n                                refreshPreview(data.uri);\n                                refreshTopics(collectionId, data, templateData, field, idField)\n                            },\n                            error = function (response) {\n                                if (response.status === 400) {\n                                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                                }\n                                else {\n                                    handleApiError(response);\n                                }\n                            }\n                        );\n                    }\n                });\n            });\n        });\n    }\n\n    //Add\n    $('#add-' + idField).off().one('click', function () {\n        var hasLatest; //Latest markup doesn't need to show in handlebars template\n        var position = $(\".workspace-edit\").scrollTop();\n\n        Florence.globalVars.pagePos = position;\n        var modal = templates.relatedModal(hasLatest);\n        $('.workspace-menu').append(modal);\n        $('.modal-box input[type=text]').focus();\n\n        //Modal click events\n        $('.btn-uri-cancel').off().one('click', function () {\n            createWorkspace(data.uri, collectionId, 'edit');\n        });\n\n        $('.btn-uri-get').off().one('click', function () {\n            var pastedUrl = $('#uri-input').val();\n            var dataUrl = checkPathParsed(pastedUrl);\n            getTopic(collectionId, data, templateData, field, idField, dataUrl);\n            $('.modal').remove();\n        });\n\n        $('.btn-uri-browse').off().one('click', function () {\n            var iframeEvent = document.getElementById('iframe').contentWindow;\n            iframeEvent.removeEventListener('click', Florence.Handler, true);\n            createWorkspace(data.uri, collectionId, '', null, true);\n            $('.modal').remove();\n\n            //Disable the editor\n            $('body').append(\n                \"<div class='col col--5 panel modal-background'></div>\"\n            );\n\n            //Add buttons to iframe window\n            var iframeNav = templates.iframeNav(hasLatest);\n            $(iframeNav).hide().appendTo('.browser').fadeIn(500);\n\n            $('.btn-browse-cancel').off().one('click', function () {\n                createWorkspace(data.uri, collectionId, 'edit');\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n            });\n\n            //Remove added markup if user navigates away from editor screen\n            $('a:not(.btn-browse-get)').click(function () {\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n            });\n\n            $('.btn-browse-get').off().one('click', function () {\n                var dataUrl = getPathNameTrimLast();\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n                getTopic(collectionId, data, templateData, field, idField, dataUrl);\n            });\n        });\n    });\n\n    function sortable() {\n        $('#sortable-' + idField).sortable({\n            stop: function () {\n                $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n                    $(this).empty().append(index + 1);\n                });\n            }\n        });\n    }\n\n    sortable();\n\n}\n\nfunction getTopic(collectionId, data, templateData, field, idField, dataUrl) {\n    var dataUrlData = dataUrl + \"/data\";\n\n    $.ajax({\n        url: dataUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (result) {\n            if (result.type === 'product_page') {\n                if (!data[field]) {\n                    data[field] = [];\n                    templateData[field] = [];\n                }\n            }\n\n            else {\n                sweetAlert(\"This is not a valid document\");\n                createWorkspace(data.uri, collectionId, 'edit');\n                return;\n            }\n\n            data[field].push({uri: result.uri});\n            templateData[field].push({uri: result.uri});\n            saveTopics(collectionId, data.uri, data, templateData, field, idField);\n\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n}\n\nfunction resolveTopicTitle(collectionId, data, templateData, field, idField) {\n    var ajaxRequest = [];\n    $(templateData[field]).each(function (index, path) {\n        templateData[field][index].description = {};\n        var eachUri = path.uri;\n        var dfd = $.Deferred();\n        getPageDataTitle(collectionId, eachUri,\n            success = function (response) {\n                templateData[field][index].description.title = response.title;\n                dfd.resolve();\n            },\n            error = function () {\n                sweetAlert(\"Error\", field + ' address: ' + eachUri + ' is not found.', \"error\");\n                dfd.resolve();\n            }\n        );\n        ajaxRequest.push(dfd);\n    });\n\n    $.when.apply($, ajaxRequest).then(function () {\n        refreshTopics(collectionId, data, templateData, field, idField);\n    });\n}\n\nfunction saveTopics(collectionId, path, data, templateData, field, idField) {\n    putContent(collectionId, path, JSON.stringify(data),\n        success = function (response) {\n            console.log(\"Updating completed \" + response);\n            Florence.Editor.isDirty = false;\n            resolveTopicTitle(collectionId, data, templateData, field, idField);\n            refreshPreview(path);\n            var iframeEvent = document.getElementById('iframe').contentWindow;\n            iframeEvent.addEventListener('click', Florence.Handler, true);\n        },\n        error = function (response) {\n            if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        }\n    );\n}\n\nfunction isDevOrSandpit () {\n    var hostname = window.location.hostname;\n    var env = {};\n\n    if(hostname.indexOf('develop') > -1) {\n        env.name = 'develop'\n    }\n\n    if(hostname.indexOf('sandpit') > -1) {\n        env.name = 'sandpit'\n    }\n\n    // if((hostname.indexOf('127') > -1) || (hostname.indexOf('localhost')) > -1) {\n    //     env.name = 'localhost'\n    // }\n\n    return env;\n}\n/**\n * Manages links\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction renderExternalLinkAccordionSection(collectionId, data, field, idField) {\n    var list = data[field];\n    var dataTemplate = {list: list, idField: idField};\n    var html = templates.editorLinks(dataTemplate);\n    $('#' + idField).replaceWith(html);\n\n    // Load\n    $(data[field]).each(function (index) {\n\n        $('#' + idField + '-edit_' + index).click(function () {\n            var uri = data[field][index].uri;\n            var title = data[field][index].title;\n            addEditLinksModal('edit', uri, title, index);\n        });\n\n        // Delete\n        $('#' + idField + '-delete_' + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    var position = $(\".workspace-edit\").scrollTop();\n                    Florence.globalVars.pagePos = position + 300;\n                    $(this).parent().remove();\n                    data[field].splice(index, 1);\n                    saveLink(collectionId, data.uri, data, field, idField);\n                    refreshPreview(data.uri);\n                    swal({\n                        title: \"Deleted\",\n                        text: \"This link has been deleted\",\n                        type: \"success\",\n                        timer: 2000\n                    });\n                }\n            });\n        });\n    });\n\n    //Add\n    $('#add-' + idField).click(function () {\n        var position = $(\".workspace-edit\").scrollTop();\n        Florence.globalVars.pagePos = position + 300;\n        addEditLinksModal();\n    });\n\n    function sortable() {\n        $('#sortable-' + idField).sortable({\n            stop: function () {\n                $('#' + idField + ' .edit-section__sortable-item--counter').each(function (index) {\n                    $(this).empty().append(index + 1);\n                });\n            }\n        });\n    }\n\n    sortable();\n\n    function saveLink(collectionId, path, data, field, idField) {\n        putContent(collectionId, path, JSON.stringify(data),\n            success = function () {\n                Florence.Editor.isDirty = false;\n                renderExternalLinkAccordionSection(collectionId, data, field, idField);\n                refreshPreview(data.uri);\n            },\n            error = function (response) {\n                if (response.status === 400) {\n                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                }\n                else {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n\n    function addEditLinksModal(mode, uri, title, index) {\n\n        var uri = uri;\n        var title = title;\n\n        if (!data[field]) {\n            data[field] = [];\n        }\n\n        var linkData = {title: title, uri: uri};\n\n        var modal = templates.linkExternalModal(linkData);\n        $('.workspace-menu').append(modal);\n\n        $('#uri-input').change(function () {\n            uri = $('#uri-input').val();\n        });\n        $('#uri-title').change(function () {\n            title = $('#uri-title').val();\n        });\n\n        $('.btn-uri-get').off().click(function () {\n            if (!title) {\n                sweetAlert('You need to enter a title to continue');\n            } else if (uri.match(/\\s/g)) {\n                sweetAlert('Your link cannot contain spaces');\n            } else {\n                if (mode == 'edit') {\n                    data[field][index].uri = uri;\n                    data[field][index].title = title;\n                } else {\n                    data[field].push({uri: uri, title: title});\n                }\n                saveLink(collectionId, data.uri, data, field, idField);\n                $('.modal').remove();\n            }\n        });\n\n        $('.btn-uri-cancel').off().click(function () {\n            $('.modal').remove();\n        });\n\n    }\n}\n\nfunction fileDelete (collectionId, data, field, index) {\n  swal ({\n    title: \"Warning\",\n    text: \"Are you sure you want to delete this file?\",\n    type: \"warning\",\n    showCancelButton: true,\n    confirmButtonText: \"Delete\",\n    cancelButtonText: \"Cancel\",\n    closeOnConfirm: false\n  }, function(result) {\n    if (result === true) {\n      swal({\n        title: \"Deleted\",\n        text: \"This alert has been deleted\",\n        type: \"success\",\n        timer: 2000\n      });\n      var position = $(\".workspace-edit\").scrollTop();\n      Florence.globalVars.pagePos = position;\n      $(this).parent().remove();\n      $.ajax({\n        url: \"/zebedee/content/\" + collectionId + \"?uri=\" + data.uri + '/' + data[field][index].file,\n        type: \"DELETE\",\n        success: function (res) {\n          console.log(res);\n        },\n        error: function (res) {\n          console.log(res);\n        }\n      });\n      data[field].splice(index, 1);\n      updateContent(collectionId, data.uri, JSON.stringify(data));\n    }\n  });\n}\n\nfunction uploadFile(collectionId, data, field, idField, lastIndex, downloadExtensions, onSave) {\n    var position = $(\".workspace-edit\").scrollTop();\n    Florence.globalVars.pagePos = position + 200;\n    var html = templates.uploadFileForm(lastIndex);\n    $('#sortable-' + idField).append(html);\n\n    $('#file-cancel').one('click', function (e) {\n        e.preventDefault();\n        $('#' + lastIndex).remove();\n        onSave(collectionId, data, field, idField);\n    });\n\n    $('#UploadForm').submit(function (e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n\n        var formdata = new FormData();\n\n        function showUploadedItem(source) {\n            $('#list').append(source);\n        }\n\n        var file = this[0].files[0];\n        if (!file) {\n            sweetAlert(\"Please select a file to upload\");\n            return;\n        }\n\n        document.getElementById(\"response\").innerHTML = \"Uploading . . .\";\n\n        var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n        uriUpload = data.uri + \"/\" + fileNameNoSpace;\n        var safeUriUpload = checkPathSlashes(uriUpload);\n\n        if (data[field] && data[field].length > 0) {\n            $(data[field]).each(function (i, filesUploaded) {\n                if (filesUploaded.file === fileNameNoSpace || filesUploaded.file === safeUriUpload) {\n                    sweetAlert('This file already exists');\n                    $('#' + lastIndex).remove();\n                    onSave(collectionId, data, field, idField);\n                    formdata = false;  // if not present the existing file was being overwritten\n                    return;\n                }\n            });\n        }\n        if (!!file.name.match(downloadExtensions)) {\n            showUploadedItem(fileNameNoSpace);\n            if (formdata) {\n                formdata.append(\"name\", file);\n            }\n        } else {\n            sweetAlert(\"This file type is not supported\");\n            $('#' + lastIndex).remove();\n            onSave(collectionId, data, field, idField);\n            return;\n        }\n\n        if (formdata) {\n            $.ajax({\n                url: \"/zebedee/content/\" + collectionId + \"?uri=\" + safeUriUpload,\n                type: 'POST',\n                data: formdata,\n                cache: false,\n                processData: false,\n                contentType: false,\n                success: function () {\n                    document.getElementById(\"response\").innerHTML = \"File uploaded successfully\";\n                    if (!data[field]) {\n                        data[field] = [];\n                    }\n                    data[field].push({title: '', file: fileNameNoSpace});\n                    updateContent(collectionId, data.uri, JSON.stringify(data));\n                }\n            });\n        }\n    });\n}\n\n/**\n * Gives the last position when on a page\n */\n\nfunction getLastPosition () {\n  var position = Florence.globalVars.pagePos;\n  if (position > 0) {\n    setTimeout(function() {\n      $(\".workspace-edit\").scrollTop(position + 100);\n    }, 200);\n  }\n}\n\n/**\n *  Get the network speed from zebedee/ping endpoint and output the network health\n **/\n\nfunction networkStatus(ping) {\n    var $good = $('.icon-status--good'),\n        $ok = $('.icon-status--ok'),\n        $poor = $('.icon-status--poor'),\n        $veryPoor = $('.icon-status--very-poor');\n\n    if (ping > 0 && ping < 100) {\n        $('.icon-status div').css({\"opacity\": \"1.0\"});\n    } else if (ping >= 100 && ping < 200) {\n        $good.css({\"opacity\": \"0.2\"});\n        $ok.css({\"opacity\": \"1.0\"});\n        $poor.css({\"opacity\": \"1.0\"});\n        $veryPoor.css({\"opacity\": \"1.0\"});\n    } else if (ping >= 200 && ping < 300) {\n        $good.css({\"opacity\": \"0.2\"});\n        $ok.css({\"opacity\": \"0.2\"});\n        $poor.css({\"opacity\": \"1.0\"});\n        $veryPoor.css({\"opacity\": \"1.0\"});\n    } else if (ping >= 300) {\n        $good.css({\"opacity\": \"0.2\"});\n        $ok.css({\"opacity\": \"0.2\"});\n        $poor.css({\"opacity\": \"0.2\"});\n        $veryPoor.css({\"opacity\": \"1.0\"});\n    }\n}function getParentPage (url) {\n  var checkedUrl = checkPathSlashes(url);\n  var contentUrlTmp = checkedUrl.split('/');\n  contentUrlTmp.splice(-1, 1);\n  var contentUrl = contentUrlTmp.join('/');\n  return contentUrl;\n}\nfunction getPathNameTrimLast() {\n  var parsedUrl = document.getElementById('iframe').contentWindow.location.pathname;\n\n  if (parsedUrl.charAt(parsedUrl.length-1) === '/') {\n    parsedUrl = parsedUrl.slice(0, -1);\n  }\n  return parsedUrl;\n}\n\nfunction getPreviewUrl() {\n  var parsedUrl = document.getElementById('iframe').contentWindow.location.pathname;\n  var safeUrl = checkPathSlashes(parsedUrl);\n  return safeUrl;\n}\n\n/**\n * Generic error handler method for ajax responses.\n * Apply your specific requirements for an error response and then call this method to take care of the rest.\n * @param response\n */\nfunction handleApiError(response) {\n\n    if (!response || response.status === 200)\n        return;\n\n    if (response.status === 403 || response.status === 401) {\n        //sweetAlert('You are not logged in', 'Please refresh Florence and log back in.');\n        logout();\n    } else if (response.status === 504) {\n        sweetAlert('This task is taking longer than expected', \"It will continue to run in the background.\", \"info\");\n    } else {\n        var message = 'An error has occurred, please contact an administrator.';\n\n        if (response.responseJSON) {\n            message = response.responseJSON.message;\n        }\n\n        console.log(message);\n        sweetAlert(\"Error\", message, \"error\");\n    }\n}\n\n/* Unique error handling for the login screen */\nfunction handleLoginApiError(response) {\n\n    if (!response || response.status === 200)\n        return;\n\n    if (response.status === 400) {\n        sweetAlert(\"Please enter a valid username and password\");\n        logout();\n    } else if (response.status === 403 || response.status === 401) {\n        sweetAlert('Incorrect login details', 'These login credentials were not recognised. Please try again.', 'error');\n        logout();\n    } else {\n        var message = 'An error has occurred, please contact an administrator.';\n\n        if (response.responseJSON) {\n            message = response.responseJSON.message;\n        }\n\n        console.log(message);\n        sweetAlert(\"Error\", message, \"error\");\n    }\n}\nfunction initialiseLastNoteMarkdown(collectionId, data, field, field2) {\n  // Load\n  var lastIndex = data[field].length - 1;\n  var editedSectionValue = '';\n  var saveContent = function (updatedContent) {\n    data[field][lastIndex][field2] = updatedContent;\n    putContent(collectionId, data.uri, JSON.stringify(data),\n      success = function () {\n        Florence.Editor.isDirty = false;\n        loadPageDataIntoEditor(data.uri, collectionId);\n        refreshPreview(data.uri);\n      },\n      error = function (response) {\n        if (response.status === 400) {\n          sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n        }\n        else {\n          handleApiError(response);\n        }\n      }\n    );\n  };\n  loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n}\n/**\n * Validate an inputs value before it's submitted to the server\n */\n\nfunction validatePageName(customSelector) {\n    var $inputSelector = $('#pagename');\n    var isCustomSelector;\n    var bool = true;\n\n    // Allow other inputs to use same validation (eg edition)\n    if (customSelector) {\n        $inputSelector = $(customSelector);\n        isCustomSelector = true;\n    }\n\n    // Do validation\n    if ($inputSelector.val().toLowerCase() === 'current' || $inputSelector.val().toLowerCase() === 'latest' || $inputSelector.val().toLowerCase() === 'data') { // Check for reserved words (ie endpoints in zebedee/babbage)\n        sweetAlert({\n            title: \"Invalid page name\",\n            text: \"The words 'current', 'latest' and 'data' are reserved paths so can't be used as a page name\",\n            type: \"warning\"\n        });\n        $inputSelector.val('');\n        bool = false;\n    } else if (!$inputSelector.val()) { // Check inputs contains something\n        sweetAlert({\n            title: \"Page name can't be left empty\",\n            type: \"warning\"\n        });\n        bool = false;\n    } else if ($inputSelector.val().length < 5 && !isCustomSelector) { // Check page name length is longer than 4 characters\n        sweetAlert({\n            title: \"Invalid page name\",\n            text: \"A page name must have more than 4 characters\",\n            type: \"warning\"\n        });\n        bool = false;\n    }\n    \n    return bool\n}\nfunction loadBrowseScreen(collectionId, click, collectionData) {\n\n    // Get collection data if it's undefined and re-run the function once request has returned\n    if (!collectionData) {\n        getCollection(collectionId, success = function(getCollectionResponse) {\n                loadBrowseScreen(collectionId, click, getCollectionResponse);\n            }, error = function() {\n                console.log('Error getting collection data for: ', collectionId);\n            });\n\n        return false;\n    }\n\n    return $.ajax({\n        url: \"/zebedee/collectionBrowseTree/\" + collectionId, // url: \"/navigation\",\n        dataType: 'json',\n        type: 'GET',\n        success: function (response) {\n\n            checkAndAddDeleteFlag(response, collectionData);\n\n            // var collectionOwner = localStorage.getItem('userType');\n            response['collectionOwner'] = localStorage.getItem('userType');\n\n            // var browserContent = $('#iframe')[0].contentWindow;\n            var html = templates.workBrowse(response);\n            var browseTree = document.getElementById('browse-tree');\n            browseTree.innerHTML = html;\n\n            $('.workspace-browse').css(\"overflow\", \"scroll\");\n\n            // Send visualisations back to visualisations folder by default on browse tree load\n            // if (collectionOwner == \"DATA_VISUALISATION\") {\n            //     var visDirectory = \"/visualisations\";\n            //     treeNodeSelect(visDirectory);\n            // }\n\n            // Bind click event for browse tree item\n            bindBrowseTreeClick();\n\n            if (click) {\n                var url = getPreviewUrl();\n                if (url === \"/blank\" || response['collectionOwner'] == 'DATA_VISUALISATION') {\n                    treeNodeSelect('/');\n                } else {\n                    treeNodeSelect(url);\n                }\n            } else {\n                treeNodeSelect('/');\n\n            }\n\n            // Switch to browse tab (if not already)\n            var $browseTab = $('#browse');\n            if (!$browseTab.hasClass('selected')) {\n                $('.js-workspace-nav .js-workspace-nav__item').removeClass('selected');\n                $browseTab.addClass('selected');\n            }\n\n            openVisDirectoryOnLoad();\n\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n\n}\n\n// Bind the actions for a click on a browse tree item\nfunction bindBrowseTreeClick() {\n    $('.js-browse__item-title').click(function () {\n        var $this = $(this),\n            $thisItem = $this.closest('.js-browse__item'),\n            uri = $thisItem.attr('data-url'),\n            baseURL = Florence.babbageBaseUrl,\n            isDataVis = localStorage.getItem('userType') == 'DATA_VISUALISATION';\n\n        if (uri) {\n            var newURL = baseURL + uri;\n\n            treeNodeSelect(newURL);\n\n            // Data vis browsing doesn't update iframe\n            if (isDataVis) {\n                return false\n            }\n\n            // Update iframe location which will send change event for iframe to update too\n            document.getElementById('iframe').contentWindow.location.href = newURL;\n            $('.browser-location').val(newURL);\n\n        } else {\n\n            // Set all directories above it in the tree to be active when a directory clicked\n            selectParentDirectories($this);\n        }\n\n        // Open active branches in browse tree\n        openBrowseBranch($this);\n    });\n}\n\nfunction openBrowseBranch($this) {\n    $('.tree-nav-holder ul').removeClass('active');\n    $this.parents('ul').addClass('active');\n    $this.closest('li').children('ul').addClass('active');\n}\n\nfunction openVisDirectoryOnLoad() {\n    var userType = Florence.Authentication.userType();\n\n    if (userType == 'DATA_VISUALISATION') {\n        $('.js-browse__item .page__container').removeClass('selected');\n        $('.page__buttons--list.selected').removeClass('selected');\n        var $this = $('.datavis-directory');\n        $this.next('.page__buttons--list').addClass('selected')\n            .closest('.page__container').addClass('selected')\n            .next('.js-browse__children').addClass('active');\n    }\n}\n\n// recursively add isDeletable and deleteIsInCollection flags to all browse tree nodes\nfunction checkAndAddDeleteFlag(browseTree, collectionData) {\n    browseTree['isDeletable'] = isDeletable(browseTree.type);\n    browseTree['deleteIsInCollection'] = deleteIsInCollection(browseTree.contentPath, collectionData);\n\n    $.each(browseTree.children, function( key, browseTreeNode ) {\n        if (browseTreeNode.children) {\n            checkAndAddDeleteFlag(browseTreeNode, collectionData);\n        }\n    });\n}\n\n// set deletable flag to false for certain page types\nfunction isDeletable(type) {\n    if (type == 'home_page' || type == 'taxonomy_landing_page' || type == 'product_page') {\n        return false;\n    } else {\n        return true;\n    }\n}\n\n// check if given uri is marked for deletion in current collection\nfunction deleteIsInCollection(uri, collectionData) {\n    var bool;\n    if (collectionData.pendingDeletes) {\n        $.each(collectionData.pendingDeletes, function (key, deleteMarker) {\n            if (uri == deleteMarker.root.uri) {\n                bool = true;\n                return false;\n            } else {\n                bool = false;\n            }\n        });\n    }\n    return bool;\n}\n\n// display open directory icon for parents directories\nfunction selectParentDirectories($this) {\n    $('.page__item--directory').removeClass('selected'); // remove previous selections\n    $this.parents('.js-browse__item--directory').find('.page__item--directory:first').addClass('selected'); // select directories along parent path\n}\n\nfunction loadChartBuilder(pageData, onSave, chart) {\n    var chart = chart;\n    var pageUrl = pageData.uri;\n    var html = templates.chartBuilder(chart);\n    $('body').append(html);\n    $('.js-chart-builder').css(\"display\", \"block\");\n\n    if (chart) {\n        $('#chart-data').val(toTsv(chart));\n        refreshExtraOptions();\n    }\n\n    renderText();\n    renderChart();\n\n    function refreshExtraOptions() {\n        var template = getExtraOptionsTemplate(chart.chartType);\n        if (template) {\n            var html = template(chart);\n            $('#extras').html(html);\n        } else {\n            $('#extras').empty();\n        }\n    }\n\n    function getExtraOptionsTemplate(chartType) {\n        switch (chartType) {\n            case 'barline':\n            case 'rotated-barline':\n                return templates.chartEditBarlineExtras;\n            case 'dual-axis':\n                return templates.chartEditDualAxisExtras;\n            case 'line':\n                return templates.chartEditLineChartExtras;\n            case 'bar':\n            case 'rotated':\n                return templates.chartEditBarChartExtras;\n            default:\n                return;\n        }\n    }\n\n    $('.refresh-chart').on('input', function () {\n        chart = buildChartObject();\n        refreshExtraOptions();\n        renderChart();\n    });\n\n    $('.refresh-chart').on('change', ':checkbox', function () {\n        chart = buildChartObject();\n        refreshExtraOptions();\n        renderChart();\n    });\n\n\n    $('.refresh-text').on('input', function () {\n        renderText();\n    });\n\n    $('.btn-chart-builder-cancel').on('click', function () {\n        $('.js-chart-builder').stop().fadeOut(200).remove();\n    });\n\n    $('.btn-chart-builder-create').on('click', function () {\n\n        chart = buildChartObject();\n\n        var jsonPath = chart.uri + \".json\";\n        $.ajax({\n            url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + jsonPath,\n            type: 'POST',\n            data: JSON.stringify(chart),\n            processData: false,\n            contentType: 'application/json',\n            success: function (res) {\n\n                if (!pageData.charts) {\n                    pageData.charts = [];\n                }\n\n                existingChart = _.find(pageData.charts, function (existingChart) {\n                    return existingChart.filename === chart.filename;\n                });\n\n                if (existingChart) {\n                    existingChart.title = chart.title;\n                } else {\n                    pageData.charts.push({\n                        title: chart.title,\n                        filename: chart.filename,\n                        uri: chart.uri\n                    });\n                }\n\n                if (onSave) {\n                    onSave(chart.filename, '<ons-chart path=\"' + chart.filename + '\" />');\n                }\n                $('.js-chart-builder').stop().fadeOut(200).remove();\n            }\n        });\n    });\n\n    setShortcuts('#chart-title', renderText);\n    setShortcuts('#chart-subtitle', renderText);\n    setShortcuts('#chart-data', renderChart);\n    setShortcuts('#chart-x-axis-label', renderChart);\n    setShortcuts('#chart-notes', renderText);\n\n    //Renders html outside actual chart area (title, subtitle, source, notes etc.)\n    function renderText() {\n        var title = doSuperscriptAndSubscript($('#chart-title').val());\n        var subtitle = doSuperscriptAndSubscript($('#chart-subtitle').val());\n        $('#chart-source-preview').html($('#chart-source').val());\n        $('#chart-title-preview').html(title);\n        $('#chart-subtitle-preview').html(subtitle);\n        $('#chart-notes-preview').html(toMarkdown($('#chart-notes').val()));\n    }\n\n    function toMarkdown(text) {\n        if (text && isMarkdownAvailable) {\n            var converter = new Markdown.getSanitizingConverter();\n            Markdown.Extra.init(converter, {\n                extensions: \"all\"\n            });\n            return converter.makeHtml(text)\n        }\n        return '';\n    }\n\n    function isMarkdownAvailable() {\n        return typeof Markdown !== 'undefined'\n    }\n\n    function doSuperscriptAndSubscript(text) {\n        if (text && isMarkdownAvailable) {\n            var converter = new Markdown.Converter();\n            return converter._DoSubscript(converter._DoSuperscript(text));\n        }\n        return text;\n\n    }\n\n    // Builds, parses, and renders our chart in the chart editor\n    function renderChart() {\n        chart = buildChartObject();\n        var preview = $('#chart');\n        var chartHeight = preview.width() * chart.aspectRatio;\n        var chartWidth = preview.width();\n        renderChartObject('chart', chart, chartHeight, chartWidth);\n    }\n\n    function buildChartObject() {\n        var json = $('#chart-data').val();\n        if (!chart) {\n            chart = {};\n        }\n\n        chart.type = \"chart\";\n        chart.title = $('#chart-title').val();\n        chart.filename = chart.filename ? chart.filename : StringUtils.randomId(); //  chart.title.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n        chart.uri = pageUrl + \"/\" + chart.filename;\n        chart.subtitle = $('#chart-subtitle').val();\n        chart.unit = $('#chart-unit').val();\n        chart.source = $('#chart-source').val();\n\n        chart.decimalPlaces = $('#chart-decimal-places').val();\n        chart.labelInterval = $('#chart-label-interval').val();\n\n        chart.notes = $('#chart-notes').val();\n        chart.altText = $('#chart-alt-text').val();\n        chart.xAxisLabel = $('#chart-x-axis-label').val();\n        chart.startFromZero = $('#start-from-zero').prop('checked');\n        chart.finishAtHundred = $('#finish-at-hundred').prop('checked');\n\n        if (chart.title === '') {\n            chart.title = '[Title]'\n        }\n\n        chart.data = tsvJSON(json);\n        chart.headers = tsvJSONHeaders(json);\n        chart.series = tsvJSONColNames(json);\n        chart.categories = tsvJSONRowNames(json);\n\n        chart.aspectRatio = $('#aspect-ratio').val();\n\n        if (isShowBarLineSelection(chart.chartType)) {\n            var types = {};\n            var groups = [];\n            var group = [];\n            var seriesData = chart.series;\n            $.each(seriesData, function (index) {\n                types[seriesData[index]] = $('#types_' + index).val() || 'bar';\n            });\n            (function () {\n                $('#extras input:checkbox:checked').each(function () {\n                    group.push($(this).val());\n                });\n                groups.push(group);\n                return groups;\n            })();\n            chart.chartTypes = types;\n            chart.groups = groups;\n        }\n\n        chart.chartType = $('#chart-type').val();\n\n        //console.log(chart);\n        parseChartObject(chart);\n\n        chart.files = [];\n        //chart.files.push({ type:'download-png', filename:chart.filename + '-download.png' });\n        //chart.files.push({ type:'png', filename:chart.filename + '.png' });\n\n        return chart;\n    }\n\n    //Determines if selected chart type is barline or rotated bar line\n    function isShowBarLineSelection(chartType) {\n        return (chartType === 'barline' || chartType === \"rotated-barline\" || chartType === \"dual-axis\");\n    }\n\n    function parseChartObject(chart) {\n\n        // Determine if we have a time series\n        var timeSeries = axisAsTimeSeries(chart.categories);\n        if (timeSeries && timeSeries.length > 0) {\n            chart.isTimeSeries = true;\n\n            // We create data specific to time\n            timeData = [];\n            _.each(timeSeries, function (time) {\n                var item = chart.data[time['row']];\n                item.date = time['date'];\n                item.label = time['label'];\n                timeData.push(item);\n            });\n\n            chart.timeSeries = timeData;\n        }\n    }\n\n    //// Converts chart to highcharts configuration by posting Babbage /chartconfig endpoint and to the rendering with fetched configuration\n    function renderChartObject(bindTag, chart, chartHeight, chartWidth) {\n\n        var jqxhr = $.post(\"/chartconfig\", {\n                data: JSON.stringify(chart),\n                width: chartWidth\n            },\n            function () {\n                var chartConfig = window[\"chart-\" + chart.filename];\n                console.debug(\"Refreshing the chart, config:\", chartConfig);\n                if (chartConfig) {\n                    chartConfig.chart.renderTo = \"chart\";\n                    new Highcharts.Chart(chartConfig);\n                    delete window[\"chart-\" + chart.filename]; //clear data from window object after rendering\n                }\n            }, \"script\")\n            .fail(function (data, err) {\n                console.error(err);\n                console.log(\"Failed reading chart configuration from server\", chart);\n                $(\"#chart\").empty();\n            });\n    }\n\n    // Data load from text box functions\n    function tsvJSON(input) {\n        var lines = input.split(\"\\n\");\n        var result = [];\n        var headers = lines[0].split(\"\\t\");\n\n        for (var i = 1; i < lines.length; i++) {\n            var obj = {};\n            var currentline = lines[i].split(\",\").join(\"\").split(\"\\t\");\n\n            for (var j = 0; j < headers.length; j++) {\n                obj[headers[j]] = currentline[j];\n            }\n            result.push(obj);\n        }\n        return result; //JSON\n    }\n\n    function toTsv(data) {\n        var output = \"\";\n\n        for (var i = 0; i < data.headers.length; i++) {\n            if (i === data.headers.length - 1) {\n                output += data.headers[i];\n            } else {\n                output += data.headers[i] + \"\\t\";\n            }\n        }\n\n        for (var i = 0; i < data.categories.length; i++) {\n            output += \"\\n\" + toTsvLine(data.data[i], data.headers);\n        }\n\n        return output;\n    }\n\n    function toTsvLine(data, headers) {\n\n        var output = \"\";\n\n        for (var i = 0; i < headers.length; i++) {\n            if (i === headers.length - 1) {\n                output += data[headers[i]];\n            } else {\n                output += data[headers[i]] + \"\\t\";\n            }\n        }\n        return output;\n    }\n\n    function tsvJSONRowNames(input) {\n        var lines = input.split(\"\\n\");\n        var result = [];\n\n        for (var i = 1; i < lines.length; i++) {\n            var currentline = lines[i].split(\"\\t\");\n            result.push(currentline[0]);\n        }\n        return result\n    }\n\n    function tsvJSONColNames(input) {\n        var lines = input.split(\"\\n\");\n        var headers = lines[0].split(\"\\t\");\n        headers.shift();\n        return headers;\n    }\n\n    function tsvJSONHeaders(input) {\n        var lines = input.split(\"\\n\");\n        var headers = lines[0].split(\"\\t\");\n        return headers;\n    }\n\n    function exportToSVG(sourceSelector) {\n        var svgContainer = $(sourceSelector);\n        var svg = svgContainer.find('svg');\n\n        var styleContent = \"\\n\";\n        for (var i = 0; i < document.styleSheets.length; i++) {\n            str = document.styleSheets[i].href.split(\"/\");\n            if (str[str.length - 1] == \"c3.css\") {\n                var rules = document.styleSheets[i].rules;\n                for (var j = 0; j < rules.length; j++) {\n                    styleContent += (rules[j].cssText + \"\\n\");\n                }\n                break;\n            }\n        }\n\n        //var style = document.createElementNS(\"http://www.w3.org/2000/svg\", \"style\");\n        //$(style).textContent += \"\\n<![CDATA[\\n\" + styleContent + \"\\n]]>\\n\";\n        //\n        //svg.prepend(style);\n        //svg[0].getElementsByTagName(\"defs\")[0].appendChild(style);\n\n\n        svg.prepend(\"\\n<style type='text/css'></style>\");\n        svg.find(\"style\").textContent += \"\\n<![CDATA[\" + styleContent + \"]]>\\n\";\n\n\n        //if ($('#chart-type').val() === 'line') {\n        //  $('.c3 line').css(\"fill\", \"none\");\n        //  console.log($('.c3 line'))\n        //}\n\n        var source = (new XMLSerializer).serializeToString(svg[0]);\n        //console.log(source);\n\n        //add name spaces.\n        if (!source.match(/^<svg[^>]+xmlns=\"http\\:\\/\\/www\\.w3\\.org\\/2000\\/svg\"/)) {\n            source = source.replace(/^<svg/, '<svg xmlns=\"http://www.w3.org/2000/svg\"');\n        }\n        if (!source.match(/^<svg[^>]+\"http\\:\\/\\/www\\.w3\\.org\\/1999\\/xlink\"/)) {\n            source = source.replace(/^<svg/, '<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\"');\n        }\n        //add padding\n        source = source.replace(/style=\"overflow: hidden;\"/, 'style=\"overflow: hidden; padding: 50px;\"');\n\n        //add xml declaration\n        source = '<?xml version=\"1.0\" standalone=\"no\"?>\\r\\n' + source;\n\n        return source;\n    }\n\n\n    // Steps through time series points\n    function axisAsTimeSeries(axis) {\n        var result = [];\n        var rowNumber = 0;\n\n        _.each(axis, function (tryTimeString) {\n            var time = convertTimeString(tryTimeString);\n            if (time) {\n                time.row = rowNumber;\n                rowNumber = rowNumber + 1;\n\n                result.push(time);\n            } else {\n                return null;\n            }\n        });\n        return result;\n    }\n\n    function convertTimeString(timeString) {\n        // First time around parse the time string according to rules from regular timeseries\n        var result = {};\n        result.label = timeString;\n\n        // Format time string\n        // Check for strings that will turn themselves into a strange format\n        twoDigitYearEnd = timeString.match(/\\W\\d\\d$/);\n        if (twoDigitYearEnd !== null) {\n            year = parseInt(timeString.substr(timeString.length - 2, timeString.length));\n            prefix = timeString.substr(0, timeString.length - 2).trim();\n\n            if (year >= 40) {\n                timeString = prefix + \" 19\" + year;\n            } else {\n                timeString = prefix + \" 20\" + year;\n            }\n        }\n\n        // Check for quarters\n        quarter = timeString.match(/Q\\d/);\n        year = timeString.match(/\\d\\d\\d\\d/);\n        if ((quarter !== null) && (year !== null)) {\n            months = [\"February \", \"May \", \"August \", \"November \"];\n            quarterMid = parseInt(quarter[0][1]);\n            timeString = months[quarterMid - 1] + year[0];\n        }\n\n        // We are going with all times in a common format\n        var date = new Date(timeString);\n        if (!isNaN(date.getTime())) {\n            result.date = date;\n            result.period = 'other';\n            return result;\n        }\n\n        return (null);\n    }\n\n    function generatePng(sourceSelector, canvasSelector, fileSuffix) {\n\n        var preview = $(sourceSelector);\n        var chartHeight = preview.height();\n        var chartWidth = preview.width();\n\n        var content = exportToSVG(sourceSelector).trim();\n\n        var $canvas = $(canvasSelector);\n        $canvas.width(chartWidth);\n        $canvas.height(chartHeight);\n\n        var canvas = $canvas.get(0);\n\n        // Draw svg on canvas\n        canvg(canvas, content);\n\n        // get data url from canvas.\n        var dataUrl = canvas.toDataURL('image/png');\n        var pngData = dataUrl.replace(/^data:image\\/(png|jpg);base64,/, \"\");\n        //console.log(dataUrl);\n\n        var raw = window.atob(pngData);\n        var rawLength = raw.length;\n        var array = new Uint8Array(new ArrayBuffer(rawLength));\n\n        for (var i = 0; i < rawLength; i++) {\n            array[i] = raw.charCodeAt(i);\n        }\n\n        var suffix = \"\";\n\n        if (fileSuffix) {\n            suffix = fileSuffix\n        }\n\n        var pngUri = pageUrl + \"/\" + chart.filename + suffix + \".png\";\n        $.ajax({\n            url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + pngUri,\n            type: 'POST',\n            data: new Blob([array], {\n                type: 'image/png'\n            }),\n            contentType: \"image/png\",\n            processData: false,\n            success: function (res) {\n                //console.log('png uploaded!');\n            }\n        });\n    }\n}// fully load the charts list from scratch\nfunction loadChartsList(collectionId, data) {\n    var html = templates.workEditCharts(data);\n    $('#charts').replaceWith(html);\n    initialiseChartList(collectionId, data);\n    initialiseClipboard();\n}\n\n// refresh only the list of charts - leaving the container div that accordion works from.\nfunction refreshChartList(collectionId, data) {\n    var html = templates.workEditCharts(data);\n    $('#chart-list').replaceWith($(html).find('#chart-list'));\n    initialiseChartList(collectionId, data);\n    initialiseClipboard();\n}\n\n// do all the wiring up of buttons etc once the template has been rendered.\nfunction initialiseChartList(collectionId, data) {\n\n    $('#add-chart').click(function () {\n        loadChartBuilder(data, function () {\n            refreshPreview();\n\n            putContent(collectionId, data.uri, JSON.stringify(data),\n                success = function () {\n                    Florence.Editor.isDirty = false;\n                    refreshPreview();\n                    refreshChartList(collectionId, data);\n                },\n                error = function (response) {\n                    handleApiError(response);\n                }\n            );\n        });\n    });\n\n    $(data.charts).each(function (index, chart) {\n\n        var basePath = data.uri;\n        var chartPath = basePath + '/' + chart.filename;\n        var chartJson = chartPath;\n\n        $(\"#chart-edit_\" + index).click(function () {\n            getPageData(collectionId, chartJson,\n                onSuccess = function (chartData) {\n\n                    loadChartBuilder(data, function () {\n                        refreshPreview();\n\n                        putContent(collectionId, basePath, JSON.stringify(data),\n                            success = function () {\n                                Florence.Editor.isDirty = false;\n                                refreshPreview();\n                                refreshChartList(collectionId, data);\n                            },\n                            error = function (response) {\n                                handleApiError(response);\n                            }\n                        );\n                    }, chartData);\n                })\n        });\n\n        $(\"#chart-delete_\" + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete this chart?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    $(this).parent().remove();\n                    data.charts = _(data.charts).filter(function (item) {\n                        return item.filename !== chart.filename\n                    });\n                    putContent(collectionId, basePath, JSON.stringify(data),\n                        success = function () {\n                            deleteContent(collectionId, chartJson + '.json', onSuccess = function () {\n                            }, onError = function () {\n                            });\n                            Florence.Editor.isDirty = false;\n                            swal({\n                                title: \"Deleted\",\n                                text: \"This chart has been deleted\",\n                                type: \"success\",\n                                timer: 2000\n                            });\n                            refreshChartList(collectionId, data);\n                        },\n                        error = function (response) {\n                            handleApiError(response);\n                        }\n                    );\n                }\n            });\n        });\n    });\n    // Make sections sortable\n    function sortable() {\n        $('#sortable-chart').sortable();\n    }\n\n    sortable();\n}\n\n\nfunction loadCreateScreen(parentUrl, collectionId, type, collectionData) {\n    var isDataVis = false; // Flag for template to show correct options in select\n\n    // Load data vis creator or ordinary publisher creator\n    if (collectionData && collectionData.collectionOwner == \"DATA_VISUALISATION\") {\n        isDataVis = true;\n        type = 'visualisation';\n    }\n\n    var html = templates.workCreate({\"dataVis\": isDataVis});\n\n    $('.workspace-menu').html(html);\n    loadCreator(parentUrl, collectionId, type, collectionData);\n    $('#pagetype').focus();\n}\nfunction loadCreator(parentUrl, collectionId, type, collectionData) {\n    var $typeSelect = $('#pagetype'),\n        pageType,\n        releaseDate;\n\n    getCollection(collectionId,\n        success = function (response) {\n            if (!response.publishDate) {\n                releaseDate = null;\n            } else {\n                releaseDate = response.publishDate;\n            }\n        },\n        error = function (response) {\n            handleApiError(response);\n        }\n    );\n\n    //releaseDate = Florence.collection.date;             //to be added back to scheduled collections\n\n    if (type === 'bulletin' || type === 'article') {\n        $typeSelect.val(type).change();\n        loadT4Creator(collectionId, releaseDate, type, parentUrl);\n    } else if (type === 'compendium_landing_page') {\n        $typeSelect.val(type).change();\n        loadT6Creator(collectionId, releaseDate, type, parentUrl);\n    } else if (type === 'visualisation') {\n        $typeSelect.val(type).change();\n        loadVisualisationCreator(collectionId, type, collectionData);\n    } else {\n        $typeSelect.off().change(function () {\n            pageType = $(this).val();\n            $('.edition').empty();\n            $('.create-publishing-error').remove();\n\n            if (pageType === 'bulletin' || pageType === 'article' || pageType === 'article_download') {\n                loadT4Creator(collectionId, releaseDate, pageType, parentUrl);\n            }\n            else if (pageType.match(/compendium_.+/)) {\n                loadT6Creator(collectionId, releaseDate, pageType, parentUrl);\n            }\n            else if (pageType.match(/static_.+/)) {\n                loadT7Creator(collectionId, releaseDate, pageType, parentUrl);\n            }\n            else if (pageType === 'dataset_landing_page' || pageType === 'timeseries_landing_page') {\n                loadT8Creator(collectionId, releaseDate, pageType, parentUrl);\n            } else if (pageType === 'visualisation') {\n                console.log('Visualisation');\n\n            } else if (pageType === 'release') {\n                loadT16Creator(collectionId, releaseDate, pageType, parentUrl);\n            }\n            else {\n                sweetAlert(\"Error\", 'Page type not recognised. Contact an administrator', \"error\");\n            }\n        });\n    }\n}\n\n\n\n/*\n*   Loads datepicker with correct format and moves focus to next form element on selection\n */\n\nfunction creatorDatePicker() {\n    $('#releaseDate').datepicker({\n        dateFormat: 'dd MM yy',\n        onSelect: function() {\n            nextFormElement();\n        }\n    });\n}\n\nfunction nextFormElement() {\n    var $dateInput = $('#releaseDate');\n\n    if ($dateInput.nextUntil('input, select, textarea, button').length) {\n        $dateInput.nextUntil('input, select, textarea, button').focus();\n        console.log('sibling', $dateInput.nextUntil('input, select, textarea, button'));\n    } else if ($dateInput.closest('.edition').nextUntil('input, select, textarea, button').length) {\n        $dateInput.closest('.edition').nextUntil('input, select, textarea, button').focus();\n        console.log('parents sibling', $dateInput.closest('.edition').nextUntil('input, select, textarea, button'));\n    } else {\n        console.log('No following inputs');\n    }\n}\n/**\n * Created by crispin on 10/12/2015.\n */\nfunction loadEmbedIframe(onSave) {\n    // add modal window\n    $('.workspace-menu').append(templates.embedIframe());\n\n    // variables\n    var modal = $(\".modal\");\n\n    // modal functions\n    function closeModal() {\n        modal.remove();\n    }\n    function saveUrl() {\n        var embedUrl = $('input#embed-url').val();\n        if (!embedUrl) {\n            console.log(\"No url added\");\n            sweetAlert('URL field is empty', 'Please add a url and save again');\n        } else {\n            onSave('<ons-interactive url=\"' + embedUrl + '\" />');\n            modal.remove();\n        }\n    }\n\n    // bind events\n    $('.btn-embed-cancel').click(function() {\n        closeModal();\n    });\n    $('.btn-embed-save').click(function() {\n        saveUrl();\n    });\n    modal.keyup(function(e) {\n        if (e.keyCode == 27) { //close on esc key\n            closeModal()\n        }\n        if (e.keyCode == 13) { //save on enter key\n            saveUrl();\n        }\n    });\n}function loadEquationBuilder(pageData, onSave, equation) {\n  var equation = equation;\n  var pageUrl = pageData.uri;\n  var html = templates.equationBuilder(equation);\n\n  var renderingPreview = false;\n\n  $('body').append(html);\n  $('.js-equation-builder').css(\"display\", \"block\");\n\n  $('.btn-equation-builder-cancel').on('click', function () {\n    $('.js-equation-builder').stop().fadeOut(200).remove();\n  });\n\n  // if editing existing equation render preview straight away\n  if (equation) {\n    var contentStr = equation.content;\n    renderPreview(contentStr);\n  }\n\n  // on change of content filed re-render preview\n  var timeout;\n  $('#equation-content').keyup(function () {\n\n    if (!renderingPreview) {\n      clearTimeout(timeout);\n      var contentStr = $(this).val();\n      timeout = setTimeout(function () {\n        renderPreview(contentStr);\n      }, 100);\n    }\n\n  });\n\n\n  // save equation\n  $('.btn-equation-builder-create').on('click', function () {\n\n    equation = buildEquationObject();\n\n    var jsonPath = equation.uri + \".json\";\n    $.ajax({\n      url: \"/zebedee/equation/\" + Florence.collection.id + \"?uri=\" + jsonPath,\n      type: 'POST',\n      data: JSON.stringify(equation),\n      processData: false,\n      contentType: 'application/json',\n      success: function () {\n\n        if (!pageData.equations) {\n          pageData.equations = [];\n        }\n\n        existingEquation = _.find(pageData.equations, function (existingEquation) {\n          return existingEquation.filename === equation.filename;\n        });\n\n        if (existingEquation) {\n          existingEquation.title = equation.title;\n        } else {\n          pageData.equations.push({\n            title: equation.title,\n            filename: equation.filename,\n            uri: equation.uri\n          });\n        }\n\n        if (onSave) {\n          onSave(equation.filename, '<ons-equation path=\"' + equation.filename + '\" />');\n        }\n        $('.js-equation-builder').stop().fadeOut(200).remove();\n        refreshEquationsList(Florence.collection.id, pageData);\n      }\n    });\n  });\n\n  function buildEquationObject() {\n    if (!equation) {\n      equation = {};\n    }\n\n    equation.type = \"equation\";\n    equation.filename = equation.filename ? equation.filename : StringUtils.randomId();\n    equation.uri = pageUrl + \"/\" + equation.filename;\n    equation.title = $('#equation-title').val();\n    equation.content = $('#equation-content').val();\n\n    return equation;\n  }\n\n\n  function renderPreview(content) {\n    renderingPreview = true;\n    var svg;\n    $.ajax({\n      url: \"/zebedee/equationpreview/\",\n      type: 'POST',\n      contentType: 'text/plain',\n      crossDomain: true,\n      data: JSON.stringify(content),\n      success: function (data) {\n        svg = data;\n        $(\".js-equation-preview\").html(svg);\n        renderingPreview = false;\n      },\n      error: function () {\n        renderingPreview = false;\n      }\n    });\n  }\n\n}// fully load the equations list from scratch\nfunction loadEquationsList(collectionId, data) {\n    var html = templates.workEditEquations(data);\n    $('#equations').replaceWith(html);\n    initialiseEquationList(collectionId, data);\n    initialiseClipboard();\n}\n\n// refresh only the list of equations - leaving the container div that accordion works from.\nfunction refreshEquationsList(collectionId, data) {\n    var html = templates.workEditEquations(data);\n    $('#equation-list').replaceWith($(html).find('#equation-list'));\n    initialiseEquationList(collectionId, data);\n    initialiseClipboard();\n}\n\n// do all the wiring up of buttons etc once the template has been rendered.\nfunction initialiseEquationList(collectionId, data) {\n\n    $('#add-equation').click(function () {\n        loadEquationBuilder(data, function () {\n            refreshPreview();\n\n            putContent(collectionId, data.uri, JSON.stringify(data),\n                success = function () {\n                    Florence.Editor.isDirty = false;\n                    refreshPreview();\n                    refreshEquationsList(collectionId, data);\n                },\n                error = function (response) {\n                    handleApiError(response);\n                }\n            );\n        });\n    });\n\n    $(data.equations).each(function (index, equation) {\n\n        var basePath = data.uri;\n        var equationPath = basePath + '/' + equation.filename;\n        var equationJson = equationPath;\n\n        $(\"#equation-edit_\" + index).click(function () {\n            getPageData(collectionId, equationJson,\n                onSuccess = function (equationData) {\n\n                    loadEquationBuilder(data, function () {\n                        refreshPreview();\n\n                        putContent(collectionId, basePath, JSON.stringify(data),\n                            success = function () {\n                                Florence.Editor.isDirty = false;\n                                refreshPreview();\n                                refreshEquationList(collectionId, data);\n                            },\n                            error = function (response) {\n                                handleApiError(response);\n                            }\n                        );\n                    }, equationData);\n                })\n        });\n\n        $(\"#equation-delete_\" + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete this equation?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    $(this).parent().remove();\n                    data.equations = _(data.equations).filter(function (item) {\n                        return item.filename !== equation.filename\n                    });\n                    putContent(collectionId, basePath, JSON.stringify(data),\n                        success = function () {\n                            deleteEquation(collectionId, equationJson, onSuccess = function () {\n                            }, onError = function () {\n                            });\n                            Florence.Editor.isDirty = false;\n                            swal({\n                                title: \"Deleted\",\n                                text: \"This equation has been deleted\",\n                                type: \"success\",\n                                timer: 2000\n                            });\n                            refreshEquationsList(collectionId, data);\n                        },\n                        error = function (response) {\n                            handleApiError(response);\n                        }\n                    );\n                }\n            });\n        });\n    });\n    // Make sections sortable\n    function sortable() {\n        $('#sortable-equation').sortable();\n    }\n\n    sortable();\n}\n\n\n/**\n * Load the image builder screen. This screen is for adding images that cannot be built using the chart\n * builder, hence the additional parameters in the builder that imitate a chart.\n * @param pageData - The data for the page the image is being added to.\n * @param onSave - The function to call when the image is saved and the image builder is closed.\n * @param image - The existing image object if an existing image is being edited.\n */\nfunction loadImageBuilder(pageData, onSave, image) {\n  var pageUrl = pageData.uri;\n  var previewImage;\n\n  // render the template for the image builder screen\n  var html = templates.imageBuilder(image);\n  $('body').append(html);\n\n  // The files uploaded as part of the image creation are stored in an array on the image object.\n  // These keys identify the different types of files that can be added.\n  var imageFileKey = \"uploaded-image\"; // The actual image shown on screen\n  var dataFileKey = \"uploaded-data\"; // The associated data file for the image.\n\n  // if we are passing an existing image to the builder, go ahead and show it.\n  if (image) {\n    renderImage(getImageUri(image));\n    renderText();\n  }\n\n  // If any text fields on the form are changed, update them.\n  $('.refresh-text').on('input', function () {\n    renderText();\n  });\n\n  $('#upload-image-form').submit(function (event) {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n\n    var formData = new FormData($(this)[0]);\n    var file = this[0].files[0];\n    if (!file) {\n      sweetAlert('Please select a file to upload.');\n      return;\n    }\n\n    if (!/\\.png|.jpeg$|.jpg$|/.test(file)) {\n      sweetAlert('The data file upload is limited to PNG and JPEG.', \"\", \"info\");\n      return;\n    }\n\n    var fileExtension = file.name.split('.').pop();\n    previewImage = buildJsonObjectFromForm(previewImage);\n    var imagePath = previewImage.uri + '.' + fileExtension;\n    var imageFileName = previewImage.filename + '.' + fileExtension;\n    var fileExists = getExistingFileName(previewImage, imageFileKey);\n\n    uploadFile(\n      imagePath,\n      formData,\n      success = function () {\n        if (!fileExists) {\n          previewImage.files.push({type: imageFileKey, filename: imageFileName, fileType: fileExtension});\n        }\n        renderImage(getImageUri(previewImage));\n      });\n\n    return false;\n  });\n\n  $('#upload-data-form').submit(function (event) {\n    $(this).find(':submit').attr('disabled', 'disabled');\n    event.preventDefault();\n    event.stopImmediatePropagation();\n\n    var formData = new FormData($(this)[0]);\n    var file = this[0].files[0];\n    if (!file) {\n      sweetAlert('Please select a file to upload.');\n      return;\n    }\n\n    if (!/\\.csv$|.xls$|.xlsx$|/.test(file)) {\n      sweetAlert('The data file upload is limited to CSV, XLS, or XLSX.');\n      return;\n    }\n\n    var fileExtension = file.name.split('.').pop();\n    previewImage = buildJsonObjectFromForm(previewImage);\n    var filePath = previewImage.uri + '.' + fileExtension;\n    var fileName = previewImage.filename + '.' + fileExtension;\n    var fileExists = getExistingFileName(previewImage, dataFileKey);\n\n    uploadFile(\n      filePath,\n      formData,\n      success = function () {\n        if (!fileExists) {\n          swal({\n            title: \"Upload complete\",\n            text: \"Upload complete\",\n            type: \"success\",\n            timer: 2000\n          });\n          previewImage.files.push({type: dataFileKey, filename: fileName, fileType: fileExtension});\n        }\n      });\n\n    return false;\n  });\n\n\n  function mapImageJsonValues(from, to) {\n    to = buildJsonObjectFromForm(to);\n\n    $(from.files).each(function (fromIndex, fromFile) {\n      var fileExistsInImage = false;\n\n      $(to.files).each(function (toIndex, toFile) {\n        if (fromFile.type == toFile.type) {\n          fileExistsInImage = true;\n          toFile.fileName = fromFile.fileName;\n          toFile.fileType = fromFile.fileType;\n        }\n      });\n\n      if (!fileExistsInImage) {\n        to.files.push(fromFile);\n      }\n    });\n\n    return to;\n  }\n\n  $('.btn-image-builder-create').on('click', function () {\n\n    previewImage = buildJsonObjectFromForm(previewImage);\n\n    if (!previewImage.title) {\n      sweetAlert(\"Please enter a title for the image.\");\n      return;\n    }\n\n    var imageFileName = getExistingFileName(previewImage, imageFileKey);\n    if (!imageFileName && image)\n      imageFileName = getExistingFileName(image, imageFileKey);\n    if (!imageFileName) {\n      sweetAlert(\"Please upload an image\");\n      return;\n    }\n\n    var imageExists = false;\n    if (image) {\n      imageExists = true;\n      // map preview image values onto image\n      image = mapImageJsonValues(previewImage, image);\n    } else { // just use the preview files\n      image = previewImage;\n      addImageToPageJson(image);\n    }\n\n    saveImageJson(image, success = function () {\n\n      // if there is an image that exists already, overwrite it.\n      if (imageExists) {\n        $(previewImage.files).each(function (index, file) {\n          var fromFile = pageUrl + '/' + file.filename;\n          var toFile = pageUrl + '/' + file.filename.replace(previewImage.filename, image.filename);\n          if (fromFile != toFile) {\n            console.log(\"moving... table file: \" + fromFile + \" to: \" + toFile);\n            renameContent(Florence.collection.id, fromFile, toFile,\n              onSuccess = function () {\n                console.log(\"Moved table file: \" + fromFile + \" to: \" + toFile);\n              });\n          }\n        });\n      }\n\n      if (onSave) {\n        onSave(image.filename, '<ons-image path=\"' + image.filename + '\" />', pageData);\n      }\n      closeImageBuilderScreen();\n    });\n  });\n\n  $('.btn-image-builder-cancel').on('click', function () {\n\n    closeImageBuilderScreen();\n\n    if (previewImage) {\n      $(previewImage.files).each(function (index, file) {\n\n        var fileToDelete = pageUrl + '/' + file.filename;\n        deleteContent(Florence.collection.id, fileToDelete,\n          onSuccess = function () {\n            console.log(\"deleted image file: \" + fileToDelete);\n          });\n      });\n    }\n  });\n\n  function closeImageBuilderScreen() {\n    $('.image-builder').stop().fadeOut(200).remove();\n  }\n\n  setShortcuts('#image-title');\n  setShortcuts('#image-subtitle');\n\n  function renderText() {\n    var title = doSuperscriptAndSubscript($('#image-title').val());\n    var subtitle = doSuperscriptAndSubscript($('#image-subtitle').val());\n    $('#image-title-preview').html(title);\n    $('#image-subtitle-preview').html(subtitle);\n    $('#image-source-preview').html($('#image-source').val());\n    $('#image-notes-preview').html(toMarkdown($('#image-notes').val()));\n  }\n\n  function renderImage(imageUri) {\n    var iframeMarkup = '<iframe id=\"preview-frame\" frameBorder =\"0\" scrolling = \"yes\" src=\"' + '/zebedee/resource/' + Florence.collection.id + '?uri=' + imageUri + '\"></iframe>';\n    $('#image').html(iframeMarkup);\n    var iframe = document.getElementById('preview-frame');\n    iframe.height = \"500px\";\n    iframe.width = \"100%\";\n    setTimeout(\n      function () {\n        body = $('#preview-frame').contents().find('body');\n        $(body).children().css('height', '100%');\n      }, 100);\n  }\n\n  function toMarkdown(text) {\n    if (text && isMarkdownAvailable) {\n      var converter = new Markdown.getSanitizingConverter();\n      Markdown.Extra.init(converter, {\n        extensions: \"all\"\n      });\n      return converter.makeHtml(text)\n    }\n    return '';\n  }\n\n  function isMarkdownAvailable() {\n    return typeof Markdown !== 'undefined'\n  }\n\n  function doSuperscriptAndSubscript(text) {\n    if (text && isMarkdownAvailable) {\n      var converter = new Markdown.Converter();\n      return converter._DoSubscript(converter._DoSuperscript(text));\n    }\n    return text;\n\n  }\n\n\n  function uploadFile(path, formData, success) {\n    $.ajax({\n      url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + path,\n      type: 'POST',\n      data: formData,\n      async: false,\n      cache: false,\n      contentType: false,\n      processData: false,\n      success: function () {\n        if (success) {\n          success();\n        }\n      }\n    });\n  }\n\n  function getImageUri(image) {\n    if (pageUrl === '/') {\n      return '/' + getImageFilename(image);\n    } else {\n      return pageData.uri + '/' + getImageFilename(image);\n    }\n  }\n\n  function getImageFilename(image) {\n    return getExistingFileName(image, imageFileKey)\n  }\n\n  // for any figure object, iterate the files and return the file path for the given key.\n  function getExistingFileName(object, key) {\n    var result;\n    _.each(object.files, function (file) {\n      if (key === file.type) {\n        result = file.filename;\n      }\n    });\n    return result;\n  }\n\n  function saveImageJson(image, success, error) {\n    var noExtension = image.uri.match(/^(.+?)(\\.[^.]*$|$)/);\n    var imageJson = noExtension[1] + \".json\";\n\n    $.ajax({\n      url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + imageJson,\n      type: 'POST',\n      data: JSON.stringify(image),\n      processData: false,\n      contentType: 'application/json',\n      success: function (response) {\n        if (success)\n          success(response);\n      },\n      error: function (response) {\n        if (error) {\n          error(response);\n        } else {\n          handleApiError(response);\n        }\n      }\n    });\n  }\n\n  function addImageToPageJson(image) {\n    if (!pageData.images) {\n      pageData.images = [];\n    } else {\n\n      var existingImage = _.find(pageData.images, function (existingImage) {\n        return existingImage.filename === image.filename;\n      });\n\n      if (existingImage) {\n        existingImage.title = image.title;\n        return;\n      }\n    }\n\n    pageData.images.push({title: image.title, filename: image.filename, uri: image.uri});\n  }\n\n  function buildJsonObjectFromForm(image) {\n    if (!image) {\n      image = {};\n    }\n\n    image.type = \"image\";\n    // give the image a unique ID if it does not already have one.\n    image.filename = image.filename ? image.filename : StringUtils.randomId();\n    image.title = $('#image-title').val();\n    if (pageUrl === '/') {\n      image.uri = \"/\" + image.filename;\n    } else {\n      image.uri = pageUrl + \"/\" + image.filename;\n    }\n    image.subtitle = $('#image-subtitle').val();\n    image.source = $('#image-source').val();\n    image.notes = $('#image-notes').val();\n    image.altText = $('#image-alt-text').val();\n\n    if (!image.files) {\n      image.files = [];\n    }\n\n    return image;\n  }\n}\n\n\nfunction loadImagesList(collectionId, data) {\n    var html = templates.workEditImages(data);\n    $('#images').replaceWith(html);\n    initialiseImagesList(collectionId, data);\n    initialiseClipboard();\n}\n\nfunction refreshImagesList(collectionId, data) {\n    var html = templates.workEditImages(data);\n    $('#image-list').replaceWith($(html).find('#image-list'));\n    initialiseImagesList(collectionId, data);\n    initialiseClipboard();\n}\n\nfunction initialiseImagesList(collectionId, data) {\n\n    $('#add-image').click(function () {\n        loadImageBuilder(data, function () {\n            Florence.Editor.isDirty = false;\n            refreshImagesList(collectionId, data);\n        });\n    });\n\n    $(data.images).each(function (index, image) {\n        var basePath = data.uri;\n        var noExtension = image.uri.match(/^(.+?)(\\.[^.]*$|$)/);\n        var imageJson = noExtension[1] + '.json';\n\n        $(\"#image-edit_\" + index).click(function () {\n            getPageResource(collectionId, imageJson,\n                onSuccess = function (imageData) {\n                    loadImageBuilder(data, function () {\n                        Florence.Editor.isDirty = false;\n                        //refreshPreview();\n                        refreshImagesList(collectionId, data);\n                    }, imageData);\n                }\n            );\n        });\n\n        $(\"#image-delete_\" + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete this image?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    $(this).parent().remove();\n                    // delete any files associated with the image.\n                    getPageResource(collectionId, imageJson,\n                        onSuccess = function (imageData) {\n                            if (imageData.files) {\n                                _.each(imageData.files, function (file) {\n                                    var fileUri = basePath + '/' + file.filename;\n                                    //console.log('deleting ' + fileUri);\n                                    deleteContent(collectionId, fileUri, function () {\n                                    }, function () {\n                                    });\n                                });\n                            } else {\n                                //console.log('deleting ' + image.uri);\n                                deleteContent(collectionId, image.uri);\n                            }\n                        });\n\n                    // remove the image from the page json when its deleted\n                    data.images = _(data.images).filter(function (item) {\n                        return item.filename !== image.filename;\n                    });\n\n                    // save the updated page json\n                    putContent(collectionId, basePath, JSON.stringify(data),\n                        success = function () {\n                            Florence.Editor.isDirty = false;\n\n                            swal({\n                                title: \"Deleted\",\n                                text: \"This image has been deleted\",\n                                type: \"success\",\n                                timer: 2000\n                            });\n\n                            refreshImagesList(collectionId, data);\n\n                            // delete the image json file\n                            deleteContent(collectionId, imageJson,\n                                onSuccess = function () {\n                                },\n                                error = function (response) {\n                                    if (response.status !== 404)\n                                        handleApiError(response);\n                                });\n                        },\n                        error = function (response) {\n                            handleApiError(response);\n                        }\n                    );\n                }\n            });\n        });\n    });\n    // Make sections sortable\n    function sortable() {\n        $('#sortable-image').sortable();\n    }\n\n    sortable();\n}\nfunction loadImportScreen (collectionId) {\n\n  getCollection(collectionId,\n    success = function (collection) {\n      var html = templates.workImport;\n      $('.workspace-menu').html(html);\n\n      $('#UploadForm').submit(function (e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n\n        var formdata = new FormData();\n\n        function showUploadedItem(source) {\n          $('#list').append(source);\n        }\n\n        var file = this[0].files[0];\n        if (!file) {\n          sweetAlert(\"Please select a file to upload\");\n          return;\n        }\n\n        document.getElementById(\"response\").innerHTML = \"Uploading . . .\";\n\n        var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n        var uriUpload = \"/\" + fileNameNoSpace;\n\n        // check if the file already exists.\n        //if (data[field] && data[field].length > 0) {\n        //  $(data[field]).each(function (i, filesUploaded) {\n        //    if (filesUploaded.file === fileNameNoSpace || filesUploaded.file === fileNameNoSpace ) {\n        //      sweetAlert('This file already exists');\n        //      $('#' + lastIndex).remove();\n        //      formdata = false;  // if not present the existing file was being overwritten\n        //      return;\n        //    }\n        //  });\n        //}\n\n        if (file.name.match(\".csv\")) {\n          showUploadedItem(fileNameNoSpace);\n          if (formdata) {\n            formdata.append(\"name\", file);\n          }\n        } else {\n          sweetAlert(\"This file type is not supported\");\n          return;\n        }\n\n        if (formdata) {\n          $.ajax({\n            url: \"/zebedee/timeseriesimport/\" + collectionId + \"?uri=\" + uriUpload,\n            type: 'POST',\n            data: formdata,\n            cache: false,\n            processData: false,\n            contentType: false,\n            success: function () {\n              document.getElementById(\"response\").innerHTML = \"File uploaded successfully\";\n              //if (!data[field]) {\n              //  data[field] = [];\n              //}\n              //data[field].push({title: '', file: fileNameNoSpace});\n            }\n          });\n        }\n      });\n    },\n    error = function (response) {\n      handleApiError(response);\n    }\n  );\n\n\n\n\n}\n\n/**\n * Manages markdown editor\n * @param content\n * @param onSave\n * @param pageData\n * @param notEmpty - if present, markdown cannot be left empty\n */\n\nfunction loadMarkdownEditor(content, onSave, pageData, notEmpty) {\n\n    if (content.title == undefined) {\n        var html = templates.markdownEditorNoTitle(content);\n        $('body').append(html);\n        $('.markdown-editor').stop().fadeIn(200);\n        $('#wmd-input').focus();\n    } else {\n        var html = templates.markdownEditor(content);\n        $('body').append(html);\n        $('.markdown-editor').stop().fadeIn(200);\n        $('#wmd-input').focus();\n    }\n\n    markdownEditor();\n\n    var markdown = $('#wmd-input').val();\n\n    // Detect if markdown updated and update variable\n    $('#wmd-input').on('input', function() {\n        markdown = $('#wmd-input').val();\n    });\n\n    if (notEmpty === true || markdown === '') {\n        $('.btn-markdown-editor-cancel').hide();\n    } else {\n        $('.btn-markdown-editor-cancel').on('click', function () {\n            $('.markdown-editor').stop().fadeOut(200).remove();\n        });\n    }\n\n    $(\".btn-markdown-editor-save\").click(function () {\n        onSave(markdown);\n    });\n\n    if (notEmpty) {\n        $(\".btn-markdown-editor-exit\").click(function () {\n            if (markdown === '') {\n                sweetAlert('Please add some text', \"This can't be left empty\");\n            } else {\n                onSave(markdown);\n                $('.markdown-editor').stop().fadeOut(200).remove();\n            }\n        });\n    } else {\n        $(\".btn-markdown-editor-exit\").click(function () {\n            // Just a little test to see if the markdown is ever getting set to null - can delete it later if this is never fired\n            if (!markdown || markdown == \"null\") {\n                console.log(\"Error, undefined or null markdown value\");\n            }\n            onSave(markdown);\n            $('.markdown-editor').stop().fadeOut(200).remove();\n        });\n    }\n\n    var onInsertSave = function (name, markdown) {\n        insertAtCursor($('#wmd-input')[0], markdown);\n        $('#wmd-input').trigger('input');\n        Florence.Editor.markdownEditor.refreshPreview();\n    };\n\n    $(\"#js-editor--chart\").click(function () {\n        loadChartBuilder(pageData, onInsertSave);\n    });\n\n    $(\"#js-editor--table\").click(function () {\n        loadTableBuilder(pageData, onInsertSave);\n    });\n\n    $(\"#js-editor--equation\").click(function () {\n        loadEquationBuilder(pageData, onInsertSave);\n    });\n\n    $(\"#js-editor--image\").click(function () {\n        loadImageBuilder(pageData, function (name, markdown, pageData) {\n            onInsertSave(name, markdown);\n            refreshImagesList(Florence.collection.id, pageData)\n        });\n    });\n\n    $(\"#js-editor--embed\").click(function () {\n        loadEmbedIframe(function (markdown) {\n            onInsertSave('', markdown);\n        });\n    });\n\n    $(\"#wmd-input\").on('click', function () {\n        markDownEditorSetLines();\n    });\n\n    $(\"#wmd-input\").on('keyup', function () {\n        markDownEditorSetLines();\n    });\n\n    // http://stackoverflow.com/questions/6140632/how-to-handle-tab-in-textarea\n    $(\"#wmd-input\").keydown(function (e) {\n        if (e.keyCode === 9) { // tab was pressed\n            // get caret position/selection\n            var start = this.selectionStart;\n            var end = this.selectionEnd;\n\n            var $this = $(this);\n            var value = $this.val();\n\n            // set textarea value to: text before caret + tab + text after caret\n            $this.val(value.substring(0, start)\n                + \"\\t\"\n                + value.substring(end));\n\n            // put caret at right position again (add one for the tab)\n            this.selectionStart = this.selectionEnd = start + 1;\n\n            // prevent the focus lose\n            e.preventDefault();\n        }\n    });\n\n    // http://stackoverflow.com/questions/11076975/insert-text-into-textarea-at-cursor-position-javascript\n    function insertAtCursor(field, value) {\n        //IE support\n        if (document.selection) {\n            field.focus();\n            sel = document.selection.createRange();\n            sel.text = value;\n        }\n        //MOZILLA and others\n        else if (field.selectionStart || field.selectionStart == '0') {\n            var startPos = field.selectionStart;\n            var endPos = field.selectionEnd;\n            field.value = field.value.substring(0, startPos)\n                + value\n                + field.value.substring(endPos, field.value.length);\n            field.selectionStart = startPos + value.length;\n            field.selectionEnd = startPos + value.length;\n        } else {\n            field.value += value;\n        }\n    }\n}\n\n\nfunction markdownEditor() {\n\n    var converter = new Markdown.getSanitizingConverter();\n\n    // output chart tag as text instead of the actual tag.\n    converter.hooks.chain(\"preBlockGamut\", function (text) {\n        var newText = text.replace(/(<ons-chart\\spath=\"[-A-Za-z0-9+&@#\\/%?=~_|!:,.;\\(\\)*[\\]$]+\"?\\s?\\/>)/ig, function (match) {\n            var path = $(match).attr('path');\n            return '[chart path=\"' + path + '\" ]';\n        });\n        return newText;\n    });\n\n    // output table tag as text instead of the actual tag.\n    converter.hooks.chain(\"preBlockGamut\", function (text) {\n        var newText = text.replace(/(<ons-table\\spath=\"[-A-Za-z0-9+&@#\\/%?=~_|!:,.;\\(\\)*[\\]$]+\"?\\s?\\/>)/ig, function (match) {\n            var path = $(match).attr('path');\n            return '[table path=\"' + path + '\" ]';\n        });\n        return newText;\n    });\n\n    // output equation tag as text instead of the actual tag.\n    converter.hooks.chain(\"preBlockGamut\", function (text) {\n        var newText = text.replace(/(<ons-equation\\spath=\"[-A-Za-z0-9+&@#\\/%?=~_|!:,.;\\(\\)*[\\]$]+\"?\\s?\\/>)/ig, function (match) {\n            var path = $(match).attr('path');\n            return '[equation path=\"' + path + '\" ]';\n        });\n        return newText;\n    });\n\n    // output interactive tag as text instead of the actual tag.\n    converter.hooks.chain(\"preBlockGamut\", function (text) {\n        var newText = text.replace(/(<ons-interactive\\surl=\"[-A-Za-z0-9+&@#\\/%?=~_|!:,.;\\(\\)*[\\]$]+\"?\\s?\\/>)/ig, function (match) {\n            var path = $(match).attr('url');\n            return '[interactive url=\"' + path + '\" ]';\n        });\n        return newText;\n    });\n\n    converter.hooks.chain(\"plainLinkText\", function (link) {\n        console.log(\"link done, innit\");\n        console.log(link);\n    });\n\n    Markdown.Extra.init(converter, {\n        extensions: \"all\"\n    });\n\n    var editor = new Markdown.Editor(converter);\n    Florence.Editor.markdownEditor = editor;\n\n    editor.hooks.chain(\"onPreviewRefresh\", function () {\n        MathJax.Hub.Queue([\"Typeset\", MathJax.Hub]);\n    });\n\n    editor.run();\n    markDownEditorSetLines();\n}\n\n/**\n * Editor data loader\n * @param path\n * @param collectionId\n * @param click - if present checks the page url to keep in sync with iframe\n */\n\nfunction loadPageDataIntoEditor(path, collectionId, click) {\n\n    if (Florence.globalVars.welsh) {\n        if (path === '/') {       //add whatever needed to read content in Welsh\n            var pageUrlData = path + '&lang=cy';\n            var toApproveUrlData = '/data_cy.json';\n        } else {\n            var pageUrlData = path + '&lang=cy';\n            var toApproveUrlData = path + '/data_cy.json';\n        }\n    } else {\n        if (path === '/') {       //add whatever needed to read content in English\n            var pageUrlData = path;\n            var toApproveUrlData = '/data.json';\n        } else {\n            var pageUrlData = path;\n            var toApproveUrlData = path + '/data.json';\n        }\n    }\n\n    var pageData, isPageComplete;\n    var ajaxRequests = [];\n\n    ajaxRequests.push(\n        getPageData(collectionId, pageUrlData,\n            success = function (response) {\n                pageData = response;\n            },\n            error = function (response) {\n                handleApiError(response);\n            }\n        )\n    );\n\n    ajaxRequests.push(\n        getCollection(collectionId,\n            success = function (response) {\n                var lastCompletedEvent = getLastCompletedEvent(response, toApproveUrlData);\n                isPageComplete = !(!lastCompletedEvent || lastCompletedEvent.email === Florence.Authentication.loggedInEmail());\n            },\n            error = function (response) {\n                handleApiError(response);\n            })\n    );\n\n    $.when.apply($, ajaxRequests).then(function () {\n        if (click) {\n            var iframe = getPreviewUrl();\n            if (iframe !== pageData.uri) {\n                setTimeout(loadPageDataIntoEditor(path, collectionId), 200);\n            } else {\n                renderAccordionSections(collectionId, pageData, isPageComplete);\n            }\n        } else {\n            renderAccordionSections(collectionId, pageData, isPageComplete);\n        }\n    });\n}\nfunction loadParentLink(collectionId, data, parentUrl) {\n\n  getPageDataTitle(collectionId, parentUrl,\n      function (response) {\n        var parentTitle = response.title;\n        $('.child-page__title').append(parentTitle);\n      },\n      function () {\n        sweetAlert(\"Error\", \"Could not find parent that this is a sub page of\", \"error\");\n      }\n  );\n\n  //Add link back to parent page\n  $('.child-page').append(\"<a class='child-page__link'>Back to parent page</a>\");\n\n  //Take user to parent edit screen on link click\n  $('.child-page__link').click(function () {\n    //If there are edits check whether user wants to continue\n    if (Florence.Editor.isDirty) {\n      swal ({\n        title: \"Warning\",\n        text: \"You have unsaved changes. Are you sure you want to continue?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Continue\",\n        cancelButtonText: \"Cancel\"\n      }, function (result) {\n        if (result === true) {\n          Florence.Editor.isDirty = false;\n          //Return to parent if user confirms it\n          updateContent(collectionId, data.uri, JSON.stringify(data), parentUrl);\n          return true;\n        }\n      });\n    } else {\n      //Return to parent without saving\n      createWorkspace(parentUrl, collectionId, 'edit');\n    }\n  });\n\n}/**\n * Creates releases' JSON\n * @param collectionId\n * @param releaseDate\n * @param pageType\n * @param parentUrl\n */\n\nfunction loadT16Creator(collectionId, releaseDate, pageType, parentUrl) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var pageType, pageTitle, uriSection, pageTitleTrimmed, newUri, pageData, safeNewUri;\n    var parentUrlData = \"/data\"; //home page\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            //Checks page is built in correct location\n            if (checkData.type === 'home_page') {\n                submitFormHandler();\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler() {\n        $('.edition').append(\n            '<label for=\"releaseDate\">Release date</label>' +\n            '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />' +\n            '<div class=\"select-wrap select-wrap--half\">' +\n            '<select id=\"hour\">' +\n            '  <option value=\"0\">00</option>' +\n            '  <option value=\"3600000\">01</option>' +\n            '  <option value=\"7200000\">02</option>' +\n            '  <option value=\"10800000\">03</option>' +\n            '  <option value=\"14400000\">04</option>' +\n            '  <option value=\"18000000\">05</option>' +\n            '  <option value=\"21600000\">06</option>' +\n            '  <option value=\"25200000\">07</option>' +\n            '  <option value=\"28800000\">08</option>' +\n            '  <option value=\"32400000\" selected=\"selected\">09</option>' +\n            '  <option value=\"36000000\">10</option>' +\n            '  <option value=\"39600000\">11</option>' +\n            '  <option value=\"43200000\">12</option>' +\n            '  <option value=\"46800000\">13</option>' +\n            '  <option value=\"50400000\">14</option>' +\n            '  <option value=\"54000000\">15</option>' +\n            '  <option value=\"57600000\">16</option>' +\n            '  <option value=\"61200000\">17</option>' +\n            '  <option value=\"64800000\">18</option>' +\n            '  <option value=\"68400000\">19</option>' +\n            '  <option value=\"72000000\">20</option>' +\n            '  <option value=\"75600000\">21</option>' +\n            '  <option value=\"79200000\">22</option>' +\n            '  <option value=\"82800000\">23</option>' +\n            '</select>' +\n            '</div>' +\n            '<div class=\"select-wrap select-wrap--half\">' +\n            '<select id=\"min\">' +\n            '  <option value=\"0\">00</option>' +\n            '  <option value=\"1800000\" selected=\"selected\">30</option>' +\n            '</select>' +\n            '</div>'\n        );\n        // $('#releaseDate').datepicker({\n        //     dateFormat: 'dd MM yy',\n        //     onSelect: function() {\n        //         $('select#hour').focus();\n        //     }\n        // });\n        creatorDatePicker();\n\n        //Submits inherited and added information to JSON\n        $('form').off().submit(function (e) {\n            var nameValid = validatePageName();\n            if (!nameValid) {\n                return false;\n            }\n            pageData = pageTypeDataT16(pageType);\n            var publishTime = parseInt($('#hour').val()) + parseInt($('#min').val());\n            var toIsoDate = $('#releaseDate').datepicker(\"getDate\");\n            pageData.description.releaseDate = new Date(parseInt(new Date(toIsoDate).getTime()) + publishTime).toISOString();\n            pageData.description.edition = $('#edition').val();\n            pageTitle = $('#pagename').val();\n            pageData.description.title = pageTitle;\n            uriSection = \"releases\";\n            pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            newUri = makeUrl(uriSection, pageTitleTrimmed);\n            safeNewUri = checkPathSlashes(newUri);\n\n            if (!pageData.description.releaseDate) {\n                sweetAlert('Release date can not be empty');\n                return true;\n            }\n            if (pageTitle.length < 5) {\n                sweetAlert(\"This is not a valid file title\");\n                return true;\n            } else {\n                Florence.globalVars.pagePath = safeNewUri;\n                saveContent(collectionId, safeNewUri, pageData);\n            }\n            e.preventDefault();\n        });\n    }\n}\n\nfunction pageTypeDataT16(pageType) {\n    return {\n        \"description\": {\n            \"releaseDate\": \"\",\n            \"provisionalDate\": \"\",\n            \"finalised\": false,\n            \"nextRelease\": \"\", //does not make sense\n            \"contact\": {\n                \"name\": \"\",\n                \"email\": \"\",\n                \"telephone\": \"\"\n            },\n            \"summary\": \"\",\n            \"title\": \"\",\n            \"nationalStatistic\": false,\n            \"cancelled\": false,\n            \"cancellationNotice\": [],\n            \"published\": false\n        },\n        \"markdown\": [],\n        \"relatedDatasets\": [],\n        \"relatedDocuments\": [],\n        \"relatedMethodology\": [],\n        \"relatedMethodologyArticle\": [],\n        \"links\": [],\n        type: pageType,\n        \"dateChanges\": []\n    };\n}\n\n/**\n * Creates article and bulletin JSON\n * @param collectionId\n * @param releaseDate\n * @param pageType\n * @param parentUrl\n */\n\nfunction loadT4Creator(collectionId, releaseDate, pageType, parentUrl) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var conditions = true;\n    var pageType, pageTitle, uriSection, pageTitleTrimmed, pageEditionTrimmed, releaseDateManual,\n        isInheriting, newUri, pageData, natStat, contactName, contactEmail,\n        contactTel, keyWords, metaDescr, relatedData, summary, relatedMethodology;\n    var parentUrlData = parentUrl + \"/data\";\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            if (checkData.type === 'product_page' && !Florence.globalVars.welsh) {\n                var checkedUrl = checkPathSlashes(checkData.uri);\n                submitFormHandler(checkedUrl);\n                return true;\n            }\n            if ((checkData.type === 'bulletin' && pageType === 'bulletin') || (checkData.type === 'article' && pageType === 'article') || (checkData.type === 'article_download' && pageType === 'article_download')) {\n                var checkedUrl = checkPathSlashes(checkData.uri);\n                var safeParentUrl = getParentPage(checkedUrl);\n                natStat = checkData.description.nationalStatistic;\n                contactName = checkData.description.contact.name;\n                contactEmail = checkData.description.contact.email;\n                contactTel = checkData.description.contact.telephone;\n                pageTitle = checkData.description.title;\n                keyWords = checkData.description.keywords;\n                summary = checkData.description.summary;\n                metaDescr = checkData.description.metaDescription;\n                relatedMethodology = checkData.relatedMethodology;\n                if (checkData.type === 'bulletin' && pageType === 'bulletin') {\n                    relatedData = checkData.relatedData;\n                }\n                isInheriting = true;\n                submitFormHandler(safeParentUrl, pageTitle, isInheriting);\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler(parentUrl, title, isInheriting) {\n\n        $('.edition').append(\n            '<div id=\"edition-div\">' +\n            '  <label for=\"edition\">Edition</label>' +\n            '  <input id=\"edition\" type=\"text\" placeholder=\"August 2010, Q3 2015, 1978, etc.\" />' +\n            '</div>'\n        );\n        if (!releaseDate) {\n            $('.edition').append(\n                '<div id=\"release-div\">' +\n                '  <label for=\"releaseDate\">Release date</label>' +\n                '  <input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />' +\n                '</div>'\n            );\n            creatorDatePicker();\n        }\n        if(!isInheriting) {\n            $('.btn-page-create').before(\n                '<p class=\"create-publishing-error\">Creating a publication here will create a new series.</p>'\n            )\n        }\n        if (title) {\n            pageTitle = title;\n            $('#pagename').val(title);\n        }\n\n        $('form').off().submit(function (e) {\n            e.preventDefault();\n            releaseDateManual = $('#releaseDate').val();\n            var pageEdition = $('#edition').val();\n\n            // Do input validation\n            var nameValid = validatePageName();\n            if (!nameValid) {\n                return false;\n            }\n\n            // Bulletin page title validation\n            if (pageType === 'bulletin' && !validatePageName('#edition')) {\n                return false;\n            }\n\n            // Article page validation - remove empty space\n            if ((pageType === 'article' || pageType === 'article_download') && pageEdition === \" \") {\n                pageEdition = \"\";\n            }\n\n            pageData = pageTypeDataT4(pageType);\n            pageData.description.edition = pageEdition;\n            if (title) {\n                //do nothing;\n            } else {\n                pageTitle = $('#pagename').val();\n            }\n            pageData.description.title = pageTitle;\n            if (pageType === 'article_download') {\n                uriSection = 'articles';\n            } else {\n                uriSection = pageType + \"s\";\n            }\n            pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            if (pageData.description.edition) {\n                pageEditionTrimmed = pageData.description.edition.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n                var releaseUri = pageEditionTrimmed;\n            }\n\n            if (!pageData.description.edition && releaseDateManual) {                          //Manual collections\n                date = $.datepicker.parseDate(\"dd MM yy\", releaseDateManual);\n                releaseUri = $.datepicker.formatDate('yy-mm-dd', date);\n            } else if (!pageData.description.edition && !releaseDateManual) {\n                releaseUri = $.datepicker.formatDate('yy-mm-dd', new Date(releaseDate));\n            }\n\n            if (!releaseDate) {\n                pageData.description.releaseDate = new Date($('#releaseDate').val()).toISOString();\n            } else {\n                pageData.description.releaseDate = releaseDate;\n            }\n            if (isInheriting) {\n                pageData.description.nationalStatistic = natStat;\n                pageData.description.contact.name = contactName;\n                pageData.description.contact.email = contactEmail;\n                pageData.description.contact.telephone = contactTel;\n                pageData.description.keywords = keyWords;\n                pageData.description.metaDescription = metaDescr;\n                pageData.relatedMethodology = relatedMethodology;\n                if (pageType === 'bulletin') {\n                    pageData.description.summary = summary;\n                    pageData.relatedData = relatedData;\n                }\n                newUri = makeUrl(parentUrl, releaseUri);\n            } else {\n                newUri = makeUrl(parentUrl, uriSection, pageTitleTrimmed, releaseUri);\n            }\n            var safeNewUri = checkPathSlashes(newUri);\n\n            if (pageType === 'bulletin' && !pageData.description.edition) {\n                sweetAlert('Edition can not be empty');\n                $('.select-wrap').remove();\n                $('#edition-div').remove();\n                $('#release-div').remove();\n                loadT4Creator(collectionId, releaseDate, pageType, parentUrl);\n                e.preventDefault();\n                conditions = false;\n            }\n            if (!pageData.description.releaseDate) {\n                sweetAlert('Release date can not be empty');\n                $('.select-wrap').remove();\n                $('#edition-div').remove();\n                $('#release-div').remove();\n                loadT4Creator(collectionId, releaseDate, pageType, parentUrl);\n                e.preventDefault();\n                conditions = false;\n            }\n            if (pageTitle.length < 5) {\n                sweetAlert(\"This is not a valid file title\");\n                $('.select-wrap').remove();\n                $('#edition-div').remove();\n                $('#release-div').remove();\n                loadT4Creator(collectionId, releaseDate, pageType, parentUrl);\n                e.preventDefault();\n                conditions = false;\n            }\n            else if (conditions) {\n                saveContent(collectionId, safeNewUri, pageData);\n            }\n        });\n    }\n\n    function pageTypeDataT4(pageType) {\n\n        if (pageType === \"bulletin\") {\n            return {\n                \"description\": {\n                    \"title\": \"\",\n                    \"edition\": \"\",\n                    \"summary\": \"\",\n                    \"releaseDate\": \"\",\n                    \"nextRelease\": \"\",\n                    \"contact\": {\n                        \"name\": \"\",\n                        \"email\": \"\",\n                        \"telephone\": \"\"\n                    },\n                    \"nationalStatistic\": false,\n                    \"headline1\": \"\",\n                    \"headline2\": \"\",\n                    \"headline3\": \"\",\n                    \"keywords\": [],\n                    \"metaDescription\": \"\",\n                },\n                \"sections\": [],\n                \"accordion\": [],\n                \"relatedDocuments\": [],\n                \"relatedData\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"topics\": [],\n                \"links\": [],\n                \"charts\": [],\n                \"tables\": [],\n                \"equations\": [],\n                \"pdfTable\": [],\n                \"images\": [],\n                \"alerts\": [],\n                \"versions\": [],\n                type: pageType\n            };\n        }\n\n        else if (pageType === \"article\") {\n            return {\n                \"description\": {\n                    \"title\": \"\",\n                    \"edition\": \"\",\n                    \"_abstract\": \"\",\n                    \"releaseDate\": \"\",\n                    \"nextRelease\": \"\",\n                    \"contact\": {\n                        \"name\": \"\",\n                        \"email\": \"\",\n                        \"telephone\": \"\"\n                    },\n                    \"nationalStatistic\": false,\n                    \"keywords\": [],\n                    \"metaDescription\": \"\",\n                },\n                \"sections\": [],\n                \"accordion\": [],\n                \"relatedDocuments\": [],\n                \"relatedData\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"topics\": [],\n                \"links\": [],\n                \"charts\": [],\n                \"tables\": [],\n                \"equations\": [],\n                \"pdfTable\": [],\n                \"images\": [],\n                \"alerts\": [],\n                \"versions\": [],\n                type: pageType\n            };\n        }\n\n        else if (pageType === \"article_download\") {\n            return {\n                \"description\": {\n                    \"title\": \"\",\n                    \"_abstract\": \"\",\n                    \"edition\": \"\",\n                    \"releaseDate\": \"\",\n                    \"nextRelease\": \"\",\n                    \"contact\": {\n                        \"name\": \"\",\n                        \"email\": \"\",\n                        \"telephone\": \"\"\n                    },\n                    \"nationalStatistic\": false,\n                    \"keywords\": [],\n                    \"metaDescription\": \"\"\n                },\n                \"markdown\": [],\n                \"downloads\": [],\n                \"relatedDocuments\": [],\n                \"relatedData\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"topics\": [],\n                \"links\": [],\n                \"charts\": [],\n                \"tables\": [],\n                \"equations\": [],\n                \"images\": [],\n                \"alerts\": [],\n                \"versions\": [],\n                type: pageType\n            };\n        }\n\n        else {\n            sweetAlert('Unsupported page type. This is not an article or a bulletin');\n        }\n    }\n}\n\n/**\n * Creates compendium documents\n * @param collectionId\n * @param releaseDate\n * @param pageType\n * @param parentUrl\n * @param pageTitle\n */\n\nfunction loadT6Creator(collectionId, releaseDate, pageType, parentUrl, pageTitle) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var pageType, pageTitle, pageEdition, uriSection, pageTitleTrimmed, pageEditionTrimmed, releaseDateManual, isInheriting, newUri, pageData, parentData;\n    var parentUrlData = parentUrl + \"/data\";\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            parentData = $.extend(true, {}, checkData);\n            if ((checkData.type === 'product_page' && pageType === 'compendium_landing_page' && !Florence.globalVars.welsh) ||\n                (checkData.type === 'compendium_landing_page' && pageType === 'compendium_chapter') ||\n                (checkData.type === 'compendium_landing_page' && pageType === 'compendium_data')) {\n                parentUrl = checkData.uri;\n                pageData = pageTypeDataT6(pageType, checkData);\n                if (pageTitle) {\n                    submitNoForm(parentUrl, pageTitle);\n                } else {\n                    submitFormHandler(parentUrl);\n                }\n                return true;\n            }\n            if (checkData.type === 'compendium_landing_page' && pageType === 'compendium_landing_page') {\n                parentUrl = getParentPage(checkData.uri);\n                pageTitle = checkData.description.title;\n                isInheriting = true;\n                pageData = pageTypeDataT6(pageType, checkData);\n                submitFormHandler(parentUrl, pageTitle, isInheriting);\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler(parentUrl, title, isInheriting) {\n        $('.edition').empty();\n        if (pageType === 'compendium_landing_page') {\n            $('.edition').append(\n                '<label for=\"edition\">Edition</label>' +\n                '<input id=\"edition\" type=\"text\" placeholder=\"August 2010, Q3 2015, 1978, etc.\" />' +\n                '<br>' +\n                '<label for=\"releaseDate\">Release date</label>' +\n                '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />'\n            );\n            creatorDatePicker();\n        }\n        if (title) {\n            pageTitle = title;\n            $('#pagename').val(title);\n        }\n\n        $('form').off().submit(function (e) {\n            releaseDateManual = $('#releaseDate').val();\n\n            // Input validation\n            var nameValid = validatePageName();\n            var editionValid = validatePageName('#edition');\n            if (!nameValid || !editionValid) {\n                return false;\n            }\n\n            if (pageType === 'compendium_landing_page') {\n                pageData.description.edition = $('#edition').val();\n            }\n            if (!title) {\n                pageTitle = $('#pagename').val();\n            }\n\n            pageData.description.title = pageTitle;\n            pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n            pageEdition = pageData.description.edition;\n            pageEditionTrimmed = pageEdition.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n            if (pageType === 'compendium_landing_page' && releaseDate == null) {\n                pageData.description.releaseDate = new Date($('#releaseDate').val()).toISOString();\n            }\n            else if (pageType === 'compendium_landing_page' && releaseDate) {\n                pageData.description.releaseDate = releaseDate;\n            }\n\n            if (isInheriting && pageType === 'compendium_landing_page') {\n                newUri = makeUrl(parentUrl, pageEditionTrimmed);\n            }\n            else if (pageType === 'compendium_landing_page') {\n                uriSection = \"compendium\";\n                newUri = makeUrl(parentUrl, uriSection, pageTitleTrimmed, pageEditionTrimmed);\n            }\n            else if ((pageType === 'compendium_chapter') || (pageType === 'compendium_data')) {\n                newUri = makeUrl(parentUrl, pageTitleTrimmed);\n            }\n            else {\n                sweetAlert('Oops! Something went the wrong.', \"\", \"error\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n            var safeNewUri = checkPathSlashes(newUri);\n\n            if ((pageType === 'compendium_landing_page') && (!pageData.description.edition)) {\n                sweetAlert('Edition can not be empty');\n                e.preventDefault();\n                return true;\n            }\n            if ((pageType === 'compendium_landing_page') && (!pageData.description.releaseDate)) {\n                sweetAlert('Release date can not be empty');\n                e.preventDefault();\n                return true;\n            }\n            if (pageTitle.length < 5) {\n                sweetAlert(\"This is not a valid file title\");\n                e.preventDefault();\n                return true;\n            }\n            if (pageTitle.toLowerCase() === 'current' || pageTitle.toLowerCase() === 'latest') {\n                alert(\"This is not a valid file title\");\n                e.preventDefault();\n                return true;\n            }\n            else {\n                putContent(collectionId, safeNewUri, JSON.stringify(pageData),\n                    success = function (message) {\n                        console.log(\"Updating completed \" + message);\n                        if (pageData.type === 'compendium_landing_page') {\n                            viewWorkspace(safeNewUri, collectionId, 'edit');\n                            refreshPreview(safeNewUri);\n                            return true;\n                        }\n                        else if ((pageType === 'compendium_chapter') || (pageType === 'compendium_data')) {\n                            updateParentLink(safeNewUri);\n                            return true;\n                        }\n                    },\n                    error = function (response) {\n                        if (response.status === 409) {\n                            sweetAlert(\"Cannot create this page\", \"It already exists.\");\n                        }\n                        else {\n                            handleApiError(response);\n                        }\n                    }\n                );\n            }\n            e.preventDefault();\n        });\n    }\n\n    function submitNoForm(parentUrl, title) {\n\n        pageData.description.title = title;\n        pageTitleTrimmed = title.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n        if ((pageType === 'compendium_chapter') || (pageType === 'compendium_data')) {\n            newUri = makeUrl(parentUrl, pageTitleTrimmed);\n        } else {\n            sweetAlert('Oops! Something went the wrong way.');\n            loadCreateScreen(parentUrl, collectionId);\n        }\n\n        var safeNewUri = checkPathSlashes(newUri);\n\n        // check if the page exists\n        getPageData(collectionId, safeNewUri,\n            success = function () {\n                sweetAlert('This page already exists');\n            },\n            // if the page does not exist, create it\n            error = function () {\n                putContent(collectionId, safeNewUri, JSON.stringify(pageData),\n                    success = function (message) {\n                        console.log(\"Updating completed \" + message);\n                        updateParentLink(safeNewUri);\n                    },\n                    error = function (response) {\n                        if (response.status === 400) {\n                            sweetAlert(\"Cannot edit this page. It is already part of another collection.\");\n                        }\n                        else {\n                            handleApiError(response);\n                        }\n                    }\n                );\n            }\n        );\n    }\n\n    function pageTypeDataT6(pageType, checkData) {\n\n        if (pageType === \"compendium_landing_page\") {\n            return {\n                \"description\": {\n                    \"releaseDate\": \"\",\n                    \"nextRelease\": \"\",\n                    \"contact\": {\n                        \"name\": \"\",\n                        \"email\": \"\",\n                        \"telephone\": \"\"\n                    },\n                    \"summary\": \"\",\n                    \"keywords\": [],\n                    \"metaDescription\": \"\",\n                    \"nationalStatistic\": false,\n                    \"title\": \"\",\n                    \"edition\": \"\"\n                },\n                \"datasets\": [],\n                \"chapters\": [],\n                \"relatedDocuments\": [],\n                \"relatedData\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"topics\": [],\n                \"alerts\": [],\n                type: pageType\n            };\n        }\n\n        else if (pageType === 'compendium_chapter') {\n            return {\n                \"description\": {\n                    \"releaseDate\": checkData.description.releaseDate || \"\",\n                    \"nextRelease\": checkData.description.nextRelease || \"\",\n                    \"contact\": {\n                        \"name\": checkData.description.contact.name || \"\",\n                        \"email\": checkData.description.contact.email || \"\",\n                        \"telephone\": checkData.description.contact.telephone || \"\"\n                    },\n                    \"_abstract\": \"\",\n                    \"authors\": [],\n                    \"keywords\": checkData.description.keywords || [],\n                    \"metaDescription\": checkData.description.metaDescription || \"\",\n                    \"nationalStatistic\": checkData.description.nationalStatistic,\n                    \"title\": \"\",\n                    \"headline\": \"\",\n                },\n                \"sections\": [],\n                \"accordion\": [],\n                \"relatedDocuments\": [],\n                \"relatedData\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"externalLinks\": [],\n                \"charts\": [],\n                \"tables\": [],\n                \"images\": [],\n                \"versions\": [],\n                \"alerts\": [],\n                \"pdfTable\": [],\n                type: pageType\n            };\n        }\n\n        else if (pageType === 'compendium_data') {\n            return {\n                \"description\": {\n                    \"releaseDate\": checkData.description.releaseDate || \"\",\n                    \"nextRelease\": checkData.description.nextRelease || \"\",\n                    \"contact\": {\n                        \"name\": checkData.description.contact.name || \"\",\n                        \"email\": checkData.description.contact.email || \"\",\n                        \"telephone\": checkData.description.contact.telephone || \"\"\n                    },\n                    \"summary\": \"\",\n                    \"datasetId\": \"\",\n                    \"keywords\": checkData.description.keywords || [],\n                    \"metaDescription\": checkData.description.metaDescription || \"\",\n                    \"nationalStatistic\": checkData.description.nationalStatistic,\n                    \"title\": \"\"\n                },\n                \"downloads\": [],\n                \"versions\": [], //{date, uri, correctionNotice}\n                \"relatedDocuments\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                type: pageType\n            };\n        }\n\n        else {\n            sweetAlert('Unsupported page type. This is not a compendium file type');\n        }\n    }\n\n    function updateParentLink(childUri) {\n        if (pageType === \"compendium_chapter\") {\n            parentData.chapters.push({uri: childUri})\n        }\n        else if (pageType === 'compendium_data') {\n            parentData.datasets.push({uri: childUri})\n        }\n        else {\n            sweetAlert('Oops! Something went the wrong way.');\n            loadCreateScreen(parentUrl, collectionId);\n        }\n        putContent(collectionId, parentUrl, JSON.stringify(parentData),\n            success = function (message) {\n                viewWorkspace(childUri, collectionId, 'edit');\n                refreshPreview(childUri);\n                console.log(\"Parent link updating completed \" + message);\n            },\n            error = function (response) {\n                if (response.status === 400) {\n                    sweetAlert(\"Cannot edit this page. It is already part of another collection.\");\n                }\n                else {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n}\n\n/**\n * Creates static pages' JSON\n * @param collectionId\n * @param releaseDate\n * @param pageType\n * @param parentUrl\n */\n\nfunction loadT7Creator(collectionId, releaseDate, pageType, parentUrl) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var pageName, pageNameTrimmed, newUri, pageData, isNumber;\n    if (parentUrl === '/') {        //to check home page\n        parentUrl = '';\n    }\n    var parentUrlData = parentUrl + \"/data\";\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            if (pageType === 'static_landing_page' && checkData.type === 'home_page' ||\n                (pageType === 'static_qmi' || pageType === 'static_adhoc' || pageType === 'static_methodology' || pageType === 'static_methodology_download') && checkData.type === 'product_page' ||\n                (pageType === 'static_landing_page' || pageType === 'static_page' || pageType === 'static_article') && checkData.type === 'home_page_census') {\n                submitFormHandler();\n                return true;\n            } else if ((pageType === 'static_foi' || pageType === 'static_page' || pageType === 'static_article' || pageType === 'static_landing_page') && checkData.type.match(/static_.+/)) {\n                submitFormHandler();\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler() {\n        if (pageType === 'static_qmi') {\n            $('.edition').append(\n                '<label for=\"releaseDate\">Last revised</label>' +\n                '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />'\n            );\n\n            creatorDatePicker();\n        } else if (pageType === 'static_adhoc') {\n            $('.edition').append(\n                '<label for=\"releaseDate\">Release date</label>' +\n                '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />' +\n                '<br>' +\n                '<label for=\"adhoc-reference\">Reference</label>' +\n                '<input id=\"adhoc-reference\" type=\"text\" placeholder=\"Reference number\" />'\n            );\n            creatorDatePicker();\n            $('#adhoc-reference').on('input', function () {\n                isNumber = $(this).val();\n                if (!isNumber.match(/^\\d+$/)) {\n                    sweetAlert('This needs to be a number');\n                    $(this).val('');\n                }\n            });\n        }\n        else if (!releaseDate && !(pageType === 'static_page' || pageType === 'static_landing_page')) {\n            $('.edition').append(\n                '<label for=\"releaseDate\">Release date</label>' +\n                '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />'\n            );\n            creatorDatePicker();\n        }\n\n        $('form').off().submit(function (e) {\n            e.preventDefault();\n            var nameValid = validatePageName();\n            if (!nameValid) {\n                return false;\n            }\n            pageData = pageTypeDataT7(pageType);\n            pageName = $('#pagename').val().trim();\n            pageData.description.title = pageName;\n            pageNameTrimmed = pageName.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            pageData.fileName = pageNameTrimmed;\n            pageData.description.reference = isNumber;\n            var adHocUrl = isNumber + pageNameTrimmed;\n            if (pageType === 'static_qmi' && !Florence.globalVars.welsh) {\n                newUri = makeUrl(parentUrl, 'qmis', pageNameTrimmed);\n            } else if (pageType === 'static_adhoc' && !Florence.globalVars.welsh) {\n                newUri = makeUrl(parentUrl, 'adhocs', adHocUrl);\n            } else if ((pageType === 'static_methodology' || pageType === 'static_methodology_download') && !Florence.globalVars.welsh) {\n                newUri = makeUrl(parentUrl, 'methodologies', pageNameTrimmed);\n            } else if (!Florence.globalVars.welsh) {\n                newUri = makeUrl(parentUrl, pageNameTrimmed);\n            } else {\n                sweetAlert('You can not perform that operation in Welsh.');\n            }\n            var safeNewUri = checkPathSlashes(newUri);\n            if (releaseDate && (pageType === 'static_qmi')) {\n                date = new Date(releaseDate);\n                pageData.description.lastRevised = $.datepicker.formatDate('dd/mm/yy', date);\n            } else if (releaseDate) {\n                date = new Date(releaseDate);\n                pageData.description.releaseDate = $.datepicker.formatDate('dd/mm/yy', date);\n            } else if (!releaseDate && (pageType === 'static_qmi')) {\n                pageData.description.lastRevised = new Date($('#releaseDate').val()).toISOString();\n                //} else if (!releaseDate && (pageType === 'static_page' || pageType === 'static_article')) {\n                //  pageData.description.releaseDate = \"1970-01-01T00:00:00.000Z\";  // zebedee throws a JsonSyntaxException\n                // if no date is present\n            } else if (!releaseDate) {\n                if ($('#releaseDate').val()) {\n                    pageData.description.releaseDate = new Date($('#releaseDate').val()).toISOString();\n                } else {\n                    pageData.description.releaseDate = new Date().toISOString();\n                }\n            }\n\n            if (pageName.length < 4) {\n                sweetAlert({\n                    title: \"This is not a valid page name\",\n                    text: \"Page names must be 4 characters or longer\",\n                    type: \"warning\"\n                });\n                loadCreateScreen(parentUrl, collectionId);\n            } else {\n                saveContent(collectionId, safeNewUri, pageData);\n            }\n        });\n    }\n}\n\nfunction pageTypeDataT7(pageType) {\n\n    if (pageType === \"static_page\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"summary\": \"\",\n                \"releaseDate\": \"\",\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"markdown\": [],\n            \"charts\": [],\n            \"tables\": [],\n            \"equations\": [],\n            \"images\": [],\n            \"downloads\": [],\n            type: pageType,\n            \"anchors\": [],\n            \"links\": []\n        };\n    } else if (pageType === \"static_landing_page\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"summary\": \"\",\n                \"releaseDate\": \"\",\n                \"keywords\": [],\n                \"metaDescription\": \"\",\n            },\n            \"sections\": [],\n            \"markdown\": [],\n            type: pageType,\n            \"links\": []\n        };\n    }\n    else if (pageType === \"static_article\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"summary\": \"\",\n                \"releaseDate\": \"\",\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"sections\": [],\n            \"charts\": [],\n            \"tables\": [],\n            \"equations\": [],\n            \"images\": [],\n            \"anchors\": [],\n            \"links\": [],\n            \"alerts\": [],\n            type: pageType\n        };\n    } else if (pageType === \"static_methodology\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"summary\": \"\",\n                \"releaseDate\": \"\",\n                \"contact\": {\n                    \"name\": \"\",\n                    \"email\": \"\",\n                    \"telephone\": \"\"\n                },\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"sections\": [],\n            \"accordion\": [],\n            \"relatedDocuments\": [],\n            \"relatedDatasets\": [],\n            \"relatedMethodology\": [],\n            \"relatedMethodologyArticle\": [],\n            \"charts\": [],\n            \"tables\": [],\n            \"equations\": [],\n            \"images\": [],\n            \"downloads\": [],\n            \"links\": [],\n            \"pdfTable\": [],\n            \"alerts\": [],\n            type: pageType\n        };\n    } else if (pageType === \"static_methodology_download\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"contact\": {\n                    \"name\": \"\",\n                    \"email\": \"\",\n                    \"phone\": \"\"\n                },\n                \"releaseDate\": \"\",\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"markdown\": [],\n            \"downloads\": [],\n            \"relatedDocuments\": [],\n            \"relatedDatasets\": [],\n            \"relatedMethodology\": [],\n            \"relatedMethodologyArticle\": [],\n            \"links\": [],\n            \"alerts\": [],\n            type: pageType\n        };\n    } else if (pageType === \"static_qmi\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"contact\": {\n                    \"name\": \"\",\n                    \"email\": \"\",\n                    \"phone\": \"\"\n                },\n                \"surveyName\": \"\",\n                \"frequency\": \"\",\n                \"compilation\": \"\",\n                \"geographicCoverage\": \"\",\n                \"sampleSize\": null,\n                \"lastRevised\": \"\",\n                \"nationalStatistic\": false,\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"markdown\": [],\n            \"downloads\": [],\n            \"relatedDocuments\": [],\n            \"relatedDatasets\": [],\n            \"relatedMethodology\": [],\n            \"relatedMethodologyArticle\": [],\n            \"links\": [],\n            type: pageType\n        };\n    } else if (pageType === \"static_foi\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"releaseDate\": \"\",\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"downloads\": [],\n            \"markdown\": [],\n            \"links\": [],\n            type: pageType\n        };\n    } else if (pageType === \"static_adhoc\") {\n        return {\n            \"description\": {\n                \"title\": \"\",\n                \"releaseDate\": \"\",\n                \"reference\": null,\n                \"keywords\": [],\n                \"metaDescription\": \"\"\n            },\n            \"downloads\": [],\n            \"markdown\": [],\n            \"links\": [],\n            type: pageType\n        };\n    } else {\n        sweetAlert('Unsupported page type', 'This is not a static page', \"info\");\n    }\n}/**\n * Creates data JSON\n * @param collectionId\n * @param data\n * @param pageType\n * @param pageEdition\n * @param downloadUrl\n */\n\nfunction loadT8EditionCreator(collectionId, data, pageType, pageEdition, downloadUrl, versionLabel) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var pageEditionTrimmed, newUri, pageData;\n\n    pageData = pageTypeDataT8(pageType, data);\n    submitNoForm(data.uri, pageEdition, downloadUrl, versionLabel);\n\n    function submitNoForm(parentUrl, edition, downloadUrl) {\n        pageData.description.edition = edition;\n        pageData.description.versionLabel = versionLabel;\n        pageData.downloads.push({file: downloadUrl});\n        pageEditionTrimmed = edition.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n        if ((pageType === 'dataset') || (pageType === 'timeseries_dataset')) {\n            newUri = makeUrl(parentUrl, pageEditionTrimmed);\n        } else {\n            sweetAlert('Oops! Something went the wrong.');\n            loadCreateScreen(parentUrl, collectionId);\n        }\n\n        var safeNewUri = checkPathSlashes(newUri);\n\n        putContent(collectionId, safeNewUri, JSON.stringify(pageData),\n            success = function () {\n                updateContent(collectionId, data.uri, JSON.stringify(data));\n            },\n            error = function (response) {\n                if (response.status === 409) {\n                    sweetAlert(\"Cannot create this page\", \"It already exists.\");\n                }\n                else {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n\n    function pageTypeDataT8(pageType, parentData) {\n\n        if (pageType === \"dataset\") {\n            return {\n                \"description\": {\n                    \"releaseDate\": parentData.description.releaseDate || \"\",\n                    \"edition\": \"\",\n                    \"versionLabel\": \"\"\n                },\n                \"versions\": [], //{updateDate, uri, correctionNotice, label}\n                \"downloads\": [],\n                \"supplementaryFiles\": [],\n                type: pageType\n            };\n        }\n\n        else if (pageType === \"timeseries_dataset\") {\n            return {\n                \"description\": {\n                    \"releaseDate\": parentData.description.releaseDate || \"\",\n                    \"edition\": \"\",\n                    \"versionLabel\": \"\"\n                },\n                \"versions\": [], //{updateDate, uri, correctionNotice, label}\n                \"downloads\": [],\n                \"supplementaryFiles\": [],\n                type: pageType\n            };\n        }\n\n        else {\n            sweetAlert('Unsupported page type', 'This is not a dataset type');\n        }\n    }\n}\n\n/**\n * Creates data JSON\n * @param collectionId\n * @param releaseDate\n * @param pageType\n * @param parentUrl\n */\n\nfunction loadT8Creator(collectionId, releaseDate, pageType, parentUrl, pageTitle) {\n    var releaseDate = null;             //overwrite scheduled collection date\n    var uriSection, pageTitleTrimmed, releaseDateManual, newUri, pageData;\n    var parentUrlData = parentUrl + \"/data\";\n    // will add this var in dataset_landing_page\n    var timeseries = false;\n    if (pageType === 'timeseries_landing_page') {\n        timeseries = true;\n        pageType = 'dataset_landing_page';\n    }\n\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            if (checkData.type === 'product_page' && !Florence.globalVars.welsh) {\n                submitFormHandler();\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                loadCreateScreen(parentUrl, collectionId);\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler() {\n\n        if (!releaseDate) {\n            $('.edition').append(\n                '<label for=\"releaseDate\">Release date</label>' +\n                '<input id=\"releaseDate\" type=\"text\" placeholder=\"day month year\" />'\n            );\n            creatorDatePicker();\n        }\n\n        $('form').off().submit(function (e) {\n            var nameValid = validatePageName();\n            if (!nameValid) {\n                return false;\n            }\n\n            releaseDateManual = $('#releaseDate').val()\n            pageData = pageTypeDataT8(pageType);\n            pageTitle = $('#pagename').val();\n            pageData.description.title = pageTitle;\n            pageData.timeseries = timeseries;\n            uriSection = \"datasets\";\n            pageTitleTrimmed = pageTitle.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n\n            if (!releaseDate) {\n                pageData.description.releaseDate = new Date($('#releaseDate').val()).toISOString();\n            } else {\n                pageData.description.releaseDate = releaseDate;\n            }\n            newUri = makeUrl(parentUrl, uriSection, pageTitleTrimmed);\n            var safeNewUri = checkPathSlashes(newUri);\n\n            if (!pageData.description.releaseDate) {\n                sweetAlert('Release date can not be empty');\n                return true;\n            }\n            if (pageTitle.length < 5) {\n                sweetAlert(\"This is not a valid file title\");\n                return true;\n            }\n            else {\n                saveContent(collectionId, safeNewUri, pageData);\n            }\n            e.preventDefault();\n        });\n    }\n\n    function pageTypeDataT8(pageType) {\n\n        if (pageType === \"dataset_landing_page\") {\n            return {\n                \"description\": {\n                    \"releaseDate\": \"\",\n                    \"nextRelease\": \"\",\n                    \"contact\": {\n                        \"name\": \"\",\n                        \"email\": \"\",\n                        \"telephone\": \"\"\n                    },\n                    \"summary\": \"\",\n                    \"datasetId\": \"\",\n                    \"keywords\": [],\n                    \"metaDescription\": \"\",\n                    \"nationalStatistic\": false,\n                    \"title\": \"\"\n                },\n                \"timeseries\": false,\n                \"datasets\": [],\n                \"section\": {},      //notes\n                \"corrections\": [],\n                \"relatedDatasets\": [],\n                \"relatedDocuments\": [],\n                \"relatedMethodology\": [],\n                \"relatedMethodologyArticle\": [],\n                \"topics\": [],\n                \"alerts\": [],\n                \"links\": [],\n                type: pageType\n            };\n        }\n        else {\n            sweetAlert('Unsupported page type. This is not a dataset type');\n        }\n    }\n}\n\nfunction loadTableBuilder(pageData, onSave, table) {\n  var pageUrl = pageData.uri;\n  var html = templates.tableBuilder(table);\n  var previewTable;\n  var path;\n  var xlsPath;\n  var htmlPath;\n  var currentTable = table;\n\n  $('body').append(html);\n\n  if (table) {\n    renderTable(table.uri);\n    $('#table-modify-form').show();\n  }\n\n  /** Upload a XLS file **/\n  $('#upload-table-form').submit(function (event) {\n    var formData = new FormData($(this)[0]);\n    previewTable = buildJsonObjectFromForm(previewTable);\n\n    if ( $(\"#files\").val() ) {\n      var errors = validateTableModifications(previewTable);\n      if (!errors.exist()) {\n        uploadFile(previewTable, formData);\n      } else {\n        errors.show();\n      }\n    } else {\n        sweetAlert(\"Validation error\", \"Please select a .xls file to upload.\");\n    }\n  });\n\n    /** Upload the file. **/\n  function uploadFile(previewTable, formData) {\n    path = previewTable.uri;\n    xlsPath = path + \".xls\";\n    htmlPath = path + \".html\";\n\n    // send xls file to zebedee\n    $.ajax({\n      url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + xlsPath,\n      type: 'POST',\n      data: formData,\n      async: false,\n      cache: false,\n      contentType: false,\n      processData: false,\n      success: function () {\n        createTableHtml(previewTable);\n      }\n    });\n    currentTable = previewTable;\n    $('#table-modify-form').show();\n    return false;\n  }\n\n    /** Create HTML **/\n  function createTableHtml(previewTable) {\n    $.ajax({\n      url: \"/zebedee/table/\" + Florence.collection.id + \"?uri=\" + xlsPath,\n      type: 'POST',\n      data: JSON.stringify(previewTable),\n      contentType: 'application/json',\n      dataType: 'text',\n      success: function (html) {\n        saveTableJson(previewTable, success = function () {\n          saveTableHtml(html);\n        });\n      }\n    });\n  }\n\n  function saveTableJson(table, success) {\n    var tableJson = table.uri + \".json\";\n\n    $.ajax({\n      url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + tableJson,\n      type: 'POST',\n      data: JSON.stringify(table),\n      processData: false,\n      contentType: 'application/json',\n      success: function () {\n        if (success) {\n          success();\n        }\n      }\n    });\n  }\n\n  /** Save HTML **/\n  function saveTableHtml(data) {\n    $.ajax({\n      url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + htmlPath + \"&validateJson=false\",\n      type: 'POST',\n      data: data,\n      processData: false,\n      success: function () {\n        addFilesToPreview();\n        renderTable(path);\n        $('#table-metadata-form').slideDown(\"slow\");\n      }\n    });\n  }\n\n  function addFilesToPreview() {\n    previewTable.files = [];\n    previewTable.files.push({type: 'download-xls', filename: previewTable.filename + '.xls'});\n    previewTable.files.push({type: 'html', filename: previewTable.filename + '.html'});\n  }\n\n  function renderTable(path) {\n    var iframeMarkup = '<iframe id=\"preview-frame\" style=\"opacity:0\" frameBorder =\"0\" scrolling = \"yes\" src=\"' + path + '\"></iframe>';\n    $('#preview-table').html(iframeMarkup);\n    var iframe = $('#preview-frame');\n    iframe.load(function () {\n      var contents = iframe.contents();\n      contents.find('body').css(\"background\", \"transparent\");\n      contents.find('body').css(\"width\", \"480px\");\n      contents.find('.markdown-table-wrap').css('width', '700px');\n      iframe.height(contents.find('html').height());\n      iframe.css(\"opacity\", \"1\");\n    });\n  }\n\n  /** Submit modifications details. **/\n  $('#table-modify-form').submit(function (event) {\n    event.preventDefault();\n    previewModifications();\n  });\n\n  function previewModifications() {\n    previewTable = buildJsonObjectFromForm(previewTable);\n    var errors = validateTableModifications(previewTable);\n\n    if (!errors.exist()) {\n        postModifyTableForm(previewTable);\n    } else {\n        errors.show();\n    }\n  }\n\n  /** Validate the form contains correct data. **/\n  function validateTableModifications(tableData) {\n    var errors = {\n        messages: [],\n        exist: function () {\n            return this.messages.length > 0;\n        },\n\n        show: function () {\n          var msg = \"\";\n          this.messages.forEach( function (item) {\n            msg = msg + item + \"\\n\";\n          });\n          sweetAlert(\"Validation error\", msg);\n        }\n    }\n\n    var mods = tableData.modifications;\n    validateList(mods.rowsExcluded, \"Rows Excluded\", errors);\n    validateList(mods.headerRows, \"Table Header Rows\", errors);\n    validateList(mods.headerColumns, \"Table Header Columns\", errors);\n\n    if (mods.rowsExcluded.length > 0 && mods.headerRows.length > 0) {\n        mods.headerRows.forEach( function (header) {\n            if ($.inArray(header, mods.rowsExcluded) >= 0) {\n                errors.messages.push(\"Row \" + header + \" is excluded and cannot be set as a Header Row.\");\n            }\n        });\n    }\n    return errors;\n  }\n\n  /** Post the modify table form. **/\n  function postModifyTableForm(tableData) {\n    var currentUri = currentTable ? currentTable.uri : tableData.uri;\n    var tableMetadataUrl = \"/zebedee/modifytable/\" + Florence.collection.id + \"?currentUri=\" + currentUri + \"&newUri=\" + tableData.uri + \"&validateJson=false\";\n\n    $.ajax({\n      url: tableMetadataUrl,\n      type: 'POST',\n      dataType: 'text',\n      contentType: 'application/json',\n      data: JSON.stringify(tableData),\n      success: function ( response ) {\n        getSavedTableModifications(tableData.uri);\n        addFilesToPreview();\n      },\n      error: function (response) {\n        getSavedTableModifications(tableData.uri);\n        addFilesToPreview();\n        handleApiError(response);\n      }\n    });\n  }\n\n  /** Get the current saved values of the table modifications. **/\n  function getSavedTableModifications(uri) {\n    var updatedContentUri = \"/zebedee/modifytable/\" + Florence.collection.id + \"?uri=\" + uri + \".json\";\n    $.ajax({\n      url: updatedContentUri,\n      type: 'GET',\n      dataType: 'json',\n      success: function (json) {\n        updateTableModificationForm(json);\n        renderTable(uri);\n        $('#table-modify-form').slideDown(\"slow\");\n      }\n    });\n  }\n\n  /** Update the table modifications form. **/\n  function updateTableModificationForm(tableJson) {\n    $(\"#rows-excluded\").val(\"\");\n    $(\"#header-rows\").val(\"\");\n    $(\"#header-columns\").val(\"\");\n    $(\"#rows-excluded\").val(asCommaSeparatedStr(tableJson.modifications.rowsExcluded));\n    $(\"#header-rows\").val(asCommaSeparatedStr(tableJson.modifications.headerRows));\n    $(\"#header-columns\").val(asCommaSeparatedStr(tableJson.modifications.headerColumns));\n  }\n\n  /** Delete / Cancel **/\n  $('.btn-table-builder-cancel').on('click', function () {\n    $('.table-builder').stop().fadeOut(200).remove();\n\n    // delete the preview table\n    if (previewTable) {\n      $(previewTable.files).each(function (index, file) {\n        var fileToDelete = pageUrl + '/' + file.filename;\n        deleteContent(Florence.collection.id, fileToDelete,\n          onSuccess = function () {\n            console.log(\"deleted table file: \" + fileToDelete);\n          });\n      });\n\n      deleteContent(Florence.collection.id, previewTable.uri + \".json\", function(){}, function(){});\n    }\n  });\n\n  /** Save **/\n  $('.btn-table-builder-create').on('click', function () {\n    // if uploaded = true rename the preview table\n    previewTable = buildJsonObjectFromForm(previewTable);\n    var tableExists = false;\n\n    if (table) {\n      tableExists = true;\n      table = mapJsonValues(previewTable, table);\n    } else { // just keep the preview files\n      table = previewTable;\n      addTableToPageJson(table);\n    }\n\n    saveTableJson(table, success=function() {\n      if (tableExists) {\n\n        if (previewTable.files.length == 0) {\n            addFilesToPreview();\n        }\n\n        // if a table exists, rename the preview to its name\n        $(previewTable.files).each(function (index, file) {\n          var fromFile = pageUrl + '/' + file.filename;\n          var toFile = pageUrl + '/' + file.filename.replace(previewTable.filename, table.filename);\n          console.log(\"moving... table file: \" + fromFile + \" to: \" + toFile);\n          renameContent(Florence.collection.id, fromFile, toFile,\n            onSuccess = function () {\n              console.log(\"Moved table file: \" + fromFile + \" to: \" + toFile);\n            });\n        });\n        deleteContent(Florence.collection.id, previewTable.uri + \".json\", function(){}, function(){});\n      }\n\n      if (onSave) {\n        onSave(table.filename, '<ons-table path=\"' + table.filename + '\" />');\n      }\n      $('.table-builder').stop().fadeOut(200).remove();\n    });\n  });\n\n  setShortcuts('#table-title');\n\n  function addTableToPageJson(table) {\n    if (!pageData.tables) {\n      pageData.tables = [];\n    } else {\n\n      var existingTable = _.find(pageData.tables, function (existingTable) {\n        return existingTable.filename === table.filename;\n      });\n\n      if (existingTable) {\n        existingTable.title = table.title;\n        return;\n      }\n    }\n\n    pageData.tables.push({title: table.title, filename: table.filename, uri: table.uri});\n  }\n\n  function mapJsonValues(from, to) {\n    to = buildJsonObjectFromForm(to);\n\n    $(from.files).each(function (fromIndex, fromFile) {\n      var fileExistsInImage = false;\n\n      $(to.files).each(function (toIndex, toFile) {\n        if (fromFile.type == toFile.type) {\n          fileExistsInImage = true;\n          toFile.fileName = fromFile.fileName;\n          toFile.fileType = fromFile.fileType;\n        }\n      });\n\n      if(!fileExistsInImage) {\n        to.files.push(fromFile);\n      }\n\n    });\n\n    return to;\n  }\n\n  function buildJsonObjectFromForm(table) {\n    if (!table) {\n      table = {};\n    }\n\n    table.type = 'table';\n    table.title = $('#table-title').val();\n\n    if (!table.filename) {\n        table.filename = StringUtils.randomId();\n    }\n\n    table.uri = pageUrl + \"/\" + table.filename;\n\n    if (table.title === '') {\n      table.title = '[Title]';\n    }\n\n    if (!table.files) {\n      table.files = [];\n    }\n\n    table.modifications = {};\n    table.modifications.rowsExcluded = inputAsList(\"#rows-excluded\", []);\n    table.modifications.headerRows = inputAsList(\"#header-rows\", []);\n    table.modifications.headerColumns = inputAsList(\"#header-columns\", []);\n    return table;\n  }\n\n  function asCommaSeparatedStr(_list) {\n    var currentValues = \"\";\n    _list.forEach( function( item) {\n      currentValues = item + \", \" + currentValues;\n    });\n    return currentValues.substring(0, currentValues.lastIndexOf(\",\"));\n  }\n\n  /** Converts a comma separated string to a list **/\n  function inputAsList(_elemId, _list) {\n    if ( $(_elemId).val() ) {\n      var valuesString = $(_elemId).val().split(\",\");\n      valuesString.forEach( function(item) {\n        var value = item.trim();\n        if (value) {\n          _list.push(value);\n        }\n      });\n    }\n    return _list;\n  }\n\n  function validateList(_list, fieldName, errors) {\n    if (_list.length == 0) {\n        return errors;\n    }\n\n    for (i = 0; i < _list.length; i++) {\n      var value = _list[i];\n      if (isNaN(value) || (!value)) {\n        errors.messages.push(fieldName + \" is invalid.\");\n        isValid = false;\n        break;\n      }\n    }\n    return errors;\n  }\n}\n\nfunction loadTablesList(collectionId, data) {\n    var html = templates.workEditTables(data);\n    $('#tables').replaceWith(html);\n    initialiseTablesList(collectionId, data);\n    initialiseClipboard();\n}\n\nfunction refreshTablesList(collectionId, data) {\n    var html = templates.workEditTables(data);\n    $('#table-list').replaceWith($(html).find('#table-list'));\n    initialiseTablesList(collectionId, data);\n    initialiseClipboard();\n}\n\nfunction initialiseTablesList(collectionId, data) {\n\n    $('#add-table').click(function () {\n        loadTableBuilder(data, function () {\n            Florence.Editor.isDirty = false;\n            refreshPreview();\n            refreshTablesList(collectionId, data);\n        });\n    });\n\n    $(data.tables).each(function (index, table) {\n        var basePath = data.uri;\n        var tablePath = basePath + '/' + table.filename;\n        var tableJson = tablePath;\n\n        $(\"#table-edit_\" + index).click(function () {\n            getPageData(collectionId, tableJson,\n                onSuccess = function (tableData) {\n                    loadTableBuilder(data, function () {\n                        Florence.Editor.isDirty = false;\n                        refreshPreview();\n                        refreshTablesList(collectionId, data);\n                    }, tableData);\n                })\n        });\n\n        $(\"#table-delete_\" + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete this table?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n                    $(this).parent().remove();\n                    // delete any files associated with the table.\n                    var extraFiles = [table.filename + '.html', table.filename + '.xls'];\n                    _(extraFiles).each(function (file) {\n                        var fileToDelete = basePath + '/' + file;\n                        deleteContent(collectionId, fileToDelete,\n                            onSuccess = function () {\n                            },\n                            onError = function (error) {\n                            });\n                    });\n\n                    // remove the table from the page json when its deleted\n                    data.tables = _(data.tables).filter(function (item) {\n                        return item.filename !== table.filename\n                    });\n                    // save the updated page json\n                    putContent(collectionId, basePath, JSON.stringify(data),\n                        success = function () {\n\n                            // delete the table json file\n                            deleteContent(collectionId, tableJson + '.json', onSuccess = function () {\n                            }, onError = function (error) {\n                            });\n\n                            Florence.Editor.isDirty = false;\n                            refreshTablesList(collectionId, data);\n\n                            swal({\n                                title: \"Deleted\",\n                                text: \"This table has been deleted\",\n                                type: \"success\",\n                                timer: 2000\n                            });\n                        },\n                        error = function (response) {\n                            if (response.status !== 404)\n                                handleApiError(response);\n                        }\n                    );\n\n\n                }\n            });\n        });\n    });\n    // Make sections sortable\n    function sortable() {\n        $('#sortable-table').sortable();\n    }\n\n    sortable();\n}/**\n * Creates data visualisation's JSON\n * @param collectionId\n * @param pageType\n * @param collectionData\n */\n\nfunction loadVisualisationCreator(collectionId, pageType, collectionData) {\n    var pageData, pageTitle, pageId, newUri, safeNewUri, uriSection, pageIdTrimmed;\n    var parentUrlData = \"/data\";\n    $.ajax({\n        url: parentUrlData,\n        dataType: 'json',\n        crossDomain: true,\n        success: function (checkData) {\n            //Checks page is being built in root - the directory is not recognised, so we're looking for the home_page page type\n            if (checkData.type === 'home_page') {\n                submitFormHandler();\n                return true;\n            } else {\n                sweetAlert(\"This is not a valid place to create this page.\");\n                //TODO load data vis directory\n            }\n        },\n        error: function () {\n            console.log('No page data returned');\n        }\n    });\n\n    function submitFormHandler() {\n        pageData = pageTypeDataVisualisation(pageType);\n\n        // Prepend unique code field into create form\n        var codeInput = \"<label for='visualisation-uid'>Unique ID</label><input placeholder='Eg DVC126' type='text' id='visualisation-uid'>\";\n        $('.edition').after(codeInput);\n\n        $('form').submit(function(e) {\n            e.preventDefault();\n            var nameValid = validatePageName();\n            if (!nameValid) {\n                return false;\n            }\n\n            // Update page title and UID\n            pageTitle = $('#pagename').val();\n            pageData.description.title = pageTitle;\n            pageId = $('#visualisation-uid').val();\n            pageData.uid = pageId;\n\n            // Save the new page\n            pageIdTrimmed = pageId.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            uriSection = \"visualisations\";\n            newUri = makeUrl(uriSection, pageIdTrimmed);\n            safeNewUri = checkPathSlashes(newUri);\n            Florence.globalVars.pagePath = safeNewUri;\n            saveContent(collectionId, safeNewUri, pageData, collectionData);\n        });\n\n    }\n}\n\nfunction pageTypeDataVisualisation(pageType) {\n    return {\n        description: {\n            title: \"\"\n        },\n        uid: \"\",\n        type: pageType,\n        zipTitle: \"\",\n        filenames: [],\n        indexPage: \"\"\n\n    };\n}\n\n\n/**\n * Logout the current user and return to the login screen.\n */\nfunction logout() {\n  delete_cookie('access_token');\n  delete_cookie('collection');\n  localStorage.setItem(\"loggedInAs\", \"\");\n  localStorage.setItem(\"userType\", \"\");\n  Florence.refreshAdminMenu();\n  viewController();\n}\n\nfunction delete_cookie(name) {\n  document.cookie = name + '=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';\n}function makeUrl(args) {\n  var accumulator;\n  accumulator = [];\n  for(var i=0; i < arguments.length; i++) {\n    accumulator =  accumulator.concat(arguments[i]\n                              .split('/')\n                              .filter(function(argument){return argument !== \"\";}));\n  }\n  return accumulator.join('/');\n}\n\n/**\n * Manages markdown content\n * @param collectionId\n * @param data\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\nfunction renderMarkdownContentAccordionSection(collectionId, data, field, idField) {\n\n    // the list of content sections to render in accordion section.\n    var list = data[field];\n\n    // a view model including the list and field name the list is contained in.\n    var dataTemplate = {list: list, idField: idField};\n\n    // render the HTML for the accordion section.\n    var html = templates.editorContent(dataTemplate);\n\n    // inject the HTML into the accordion section\n    $('#' + idField).replaceWith(html);\n\n    // attach event handlers for the buttons.\n    initialiseMarkdownContentAccordionSection(collectionId, data, field, idField)\n}\n\nfunction refreshMarkdownContentAccordionSection(collectionId, data, field, idField) {\n    var list = data[field];\n    var dataTemplate = {list: list, idField: idField};\n    var html = templates.editorContent(dataTemplate);\n    $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n    initialiseMarkdownContentAccordionSection(collectionId, data, field, idField)\n}\n\nfunction initialiseMarkdownContentAccordionSection(collectionId, data, field, idField) {\n\n    // for each entry in the list\n    function debugLogAccordionSection() {\n        for (var i = 0; i < data[field].length; i++) {\n            console.log(data[field][i].title)\n        }\n    }\n\n    $(data[field]).each(function (index) {\n\n        $('#' + idField + '-title_' + index).on('input', function () {\n            data[field][index].title = $(this).val();\n            //debugLogAccordionSection();\n        });\n\n        // attach edit handler\n        $('#' + idField + '-edit_' + index).click(function () {\n\n            // create view model to pass to the markdown editor\n            var editedSectionValue = {\n                \"title\": data[field][index].title,\n                \"markdown\": data[field][index].markdown\n            };\n\n            // create the function to define what happens on save in the markdown editor\n            var saveContent = function (updatedContent) {\n                data[field][index].markdown = updatedContent;\n                saveContentThenRefreshSection(collectionId, data.uri, data, field, idField);\n\n                // when finished in the markdown editor be sure to refresh the charts / tables / images list to show any newly added\n                refreshChartList(collectionId, data);\n                refreshTablesList(collectionId, data);\n                refreshEquationsList(collectionId, data);\n                refreshImagesList(collectionId, data);\n            };\n\n            loadMarkdownEditor(editedSectionValue, saveContent, data);\n        });\n\n        // attach delete handler\n        $('#' + idField + '-delete_' + index).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"Are you sure you want to delete?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Delete\",\n                cancelButtonText: \"Cancel\",\n                closeOnConfirm: false\n            }, function (result) {\n                if (result === true) {\n\n                    // delete the item from the data model\n                    data[field].splice(index, 1);\n\n                    // post content to the server and refresh accordion section view.\n                    saveContentThenRefreshSection(collectionId, data.uri, data, field, idField);\n\n                    swal({\n                        title: \"Deleted\",\n                        text: \"This \" + idField + \" has been deleted\",\n                        type: \"success\",\n                        timer: 2000\n                    });\n                }\n            });\n        });\n    });\n\n    // Attach add new handler.\n    $('#add-' + idField).off().one('click', function () {\n        data[field].push({markdown: \"\", title: \"\"});\n        saveContentThenRefreshSection(collectionId, data.uri, data, field, idField);\n    });\n\n    function sortable() {\n\n        var sortableStartPosition;\n\n        $('#sortable-' + idField).sortable({\n            start: function (event, ui) {\n\n                // remember the index of the item at the start of drag + drop\n                sortableStartPosition = ui.item.index();\n                //console.log(\"sortable start: \" + sortableStartPosition);\n            },\n            stop: function (event, ui) {\n\n                // determine the new index of the item after being dropped.\n                var sortableEndPosition = ui.item.index();\n                //console.log(\"sortable update: Start: \" + sortableStartPosition + \" now: \" + sortableEndPosition) ;\n\n                var sectionsArray = data[field];\n                var item = data[field][sortableStartPosition];\n\n                // Move the item from the start drag position to the end drop position in the data model.\n                sectionsArray.splice(sortableStartPosition, 1);\n                sectionsArray.splice(sortableEndPosition, 0, item);\n\n                saveContentThenRefreshSection(collectionId, data.uri, data, field, idField);\n            }\n        });\n    }\n\n    sortable();\n\n    function saveContentThenRefreshSection(collectionId, path, data, field, idField) {\n        putContent(collectionId, path, JSON.stringify(data),\n            success = function () {\n                Florence.Editor.isDirty = false;\n                refreshMarkdownContentAccordionSection(collectionId, data, field, idField);\n                refreshPreview(data.uri);\n            },\n            error = function (response) {\n                if (response.status === 400) {\n                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                }\n                else {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n}\n\nfunction markDownEditorSetLines() {\n  var textarea = $(\"#wmd-input\");\n  // var linesHolder = $('.markdown-editor-line-numbers');\n  var textareaWidth = textarea.width();\n  var charWidth = 7;\n  var lineHeight = 21;\n  var textareaMaxChars = Math.floor(textareaWidth / charWidth);\n  var lines = textarea.val().split('\\n');\n  var linesLi = '';\n  var cursorEndPos = textarea.prop('selectionEnd');\n  var charMapArray = [];\n  var charMapArrayJoin = [];\n  var lineLengthArray = [];\n  var contentLength = textarea.val().length;\n  var cumulativeLineLength = 0;\n  // var cursorLine = textarea.prop('selectionStart').split('\\n').length;\n  $.each(lines, function(index){\n    var lineNumber = index + 1;\n    var lineLength = this.length;\n    var lineWrap = Math.round(lineLength / textareaMaxChars);\n    // var lineWrap = Math.floor(lineLength / textareaMaxChars);\n    // var lineWrap = Math.ceil(lineLength / textareaMaxChars);\n\n    //console.log('max chars: ' + textareaMaxChars);\n    //console.log('line length: ' + lineLength);\n\n    var numberOfLinesCovered = StringUtils.textareaLines(this, textareaMaxChars, 0, 0);\n    var liPaddingBottom = numberOfLinesCovered * lineHeight;\n\n    if(lineNumber === 1) {\n      cumulativeLineLength += lineLength;\n    } else {\n      cumulativeLineLength += lineLength + 1;\n      // console.log('+1');\n    }\n\n    linesLi += '<li id=\"markdownEditorLine-' + lineNumber + '\" style=\"padding-bottom:' + liPaddingBottom +'px\">&nbsp;</li>';\n    lineLengthArray.push(cumulativeLineLength);\n\n    //push to charmap\n    // charMapArray.push(this.replace(this.split(''), lineNumber));\n    // console.log(this.selectionStart);\n    //console.log('line wrap: ' + lineWrap + ' (' + lineLength / textareaMaxChars + ')');\n  });\n\n  if(linesLi) {\n    var linesOl = '<ol>' + linesLi + '</ol>';\n    $('#markdown-editor-line-numbers').html(linesOl);\n    // console.log(linesOl);\n  }\n\n  //sync scroll\n  // $('.markdown-editor-line-numbers ol').css('margin-top', -textarea.scrollTop());\n  // textarea.on('scroll', function () {\n  //   // var editorHeight = $('.wmd-input').height();\n  //   // var previewHeight = $('.wmd-preview').height();\n  //   // console.log(editorHeight);\n  //   var marginTop = $(this).scrollTop();\n  //   $('.markdown-editor-line-numbers ol').css('margin-top', -marginTop);\n  //   $('.wmd-preview').scrollTop(marginTop);\n  // });\n\n\n  //proportional scroll\n  //var $wmdscrollsync = $('.wmd-input, .wmd-preview');\n  //var wmdsync = function(e){\n  //    var $other = $wmdscrollsync.not(this).off('scroll'), other = $other.get(0);\n  //    var percentage = this.scrollTop / (this.scrollHeight - this.offsetHeight);\n  //    other.scrollTop = percentage * (other.scrollHeight - other.offsetHeight);\n  //    setTimeout( function(){ $other.on('scroll', wmdsync ); },10);\n  //}\n  //$wmdscrollsync.on( 'scroll', wmdsync);\n\n\n\n  for (var i = 0; i < lineLengthArray.length; i++) {\n    if(cursorEndPos <= lineLengthArray[i]) {\n      // console.log(i + 1);\n      var activeLine = i + 1;\n      $('#markdownEditorLine-' + activeLine).addClass('active');\n      break;\n    }\n    // console.log(lineLengthArray[i]);\n    //Do something\n  }\n\n\n\n}\nfunction menuselect(classId) {\n  $.widget(\"custom.iconselectmenu\", $.ui.selectmenu, {\n    _renderItem: function(ul, item) {\n      var li = $(\"<li>\", {\n        text: item.label\n      });\n\n      if (item.disabled) {\n        li.addClass(\"ui-state-disabled\");\n      }\n\n      $(\"<span>\", {\n        style: item.element.attr(\"data-style\"),\n        \"class\": \"ui-icon \" + item.element.attr(\"data-class\")\n      })\n        .appendTo(li);\n\n      return li.appendTo(ul);\n    }\n  });\n\n  $(classId)\n    .iconselectmenu()\n    .iconselectmenu(\"menuWidget\")\n    .addClass(\"ui-menu-icons customicons\");\n}/**\n * Overlays modal for selecting where a node of the browse tree is being moved to\n * @param fromUrl - where the node is being moved from\n */\n\nfunction moveBrowseNode(fromUrl) {\n    var moveToBtn = \"<button class='btn btn--positive btn-browse-move-to'>Move here</button>\",\n        moveInProgress = true, // flag to use to see state of move process\n        headerHeight = 98,\n        $browseTree = $('#browse-tree'),\n        $wrapper = $('.wrapper'),\n        overlay = $('<div class=\"overlay\"></div>'),\n        browseTreeMoveHeader = $('<div class=\"workspace-menu__header\"><h2>Select a location</h2></div>'),\n        $treeBrowser = $('.workspace-browse');\n\n    // Toggle buttons on selected item\n    showBrowseTreeModal();\n    toggleMoveHereButton();\n\n    // Switch off browse tree changes updating the preview or global pagePath\n    $('.js-browse__item-title').off().click(function (e) {\n        var $this = $(this),\n            itemUrl = $this.closest('.js-browse__item').attr('data-url');\n\n        // Set previously selected item to normal\n        toggleMoveHereButton();\n\n        if (itemUrl) {\n            treeNodeSelect(itemUrl);\n        } else {\n            selectParentDirectories($this);\n        }\n\n        openBrowseBranch($this);\n\n        // Toggle buttons on newly selected item\n        toggleMoveHereButton();\n\n        $('.btn-browse-move-to').click(function() {\n\n            // Data to be sent to Zebedee\n            var toUrl = $(this).closest('.js-browse__item').attr('data-url'),\n                moveData = {fromUrl: fromUrl, toUrl: toUrl};\n            console.log('Move data: ', moveData);\n\n            // Remove current event binding and return ordinary browse tree functionality\n            $('.js-browse__item-title').off();\n            bindBrowseTreeClick();\n\n            // Set state of move to finished\n            moveInProgress = false;\n\n            // Show ordinary browse tree buttons\n            toggleMoveHereButton();\n            hideBrowseTreeModal();\n\n        });\n\n    });\n\n    // Removes the usual buttons on browse tree items and replaces them with a single 'Move here' button\n    function toggleMoveHereButton() {\n        var $thisButtons = $('.page__buttons--list.selected'),\n            $moveToButton = $('.btn-browse-move-to');\n\n        // Remove previous, so they're not littered around the DOM or if move is finished\n        $moveToButton.remove();\n\n        // Toggle current buttons (show if move is finished or hide if move is in progress\n        $thisButtons.find('.js-browse__buttons--primary, .js-browse__buttons--secondary').toggle();\n\n        if (moveInProgress) {\n            // Hide existing buttons in selected item and add in new 'Move here' button\n            $thisButtons.append(moveToBtn);\n        }\n\n    }\n\n    function showBrowseTreeModal() {\n        // give blacked put appearance to page\n        $wrapper.append(overlay);\n        // add move header to browse tree\n        $browseTree.prepend(browseTreeMoveHeader);\n        // bring browse tree element in front of overlay\n        $browseTree.css({'z-index': 1001, 'position': 'relative'});\n        // resize browser height because adding header has taken up space\n        $treeBrowser.height($treeBrowser[0].offsetHeight - headerHeight);\n    }\n\n    function hideBrowseTreeModal() {\n        //remove overlay & header\n        overlay.remove();\n        browseTreeMoveHeader.remove();\n        // 'reset' z-index\n        $browseTree.css({'z-index': 1, 'position': 'relative'});\n        // calculate size after removing header\n        $treeBrowser.height($treeBrowser[0].offsetHeight + headerHeight);\n    }\n\n}\nfunction parseURL(url) {\n    var parser = document.createElement('a'),\n        searchObject = {},\n        queries, split, i;\n    // Let the browser do the work\n    parser.href = url;\n    // Convert query string to object\n    queries = parser.search.replace(/^\\?/, '').split('&');\n    for( i = 0; i < queries.length; i++ ) {\n        split = queries[i].split('=');\n        searchObject[split[0]] = split[1];\n    }\n    return {\n        protocol: parser.protocol,\n        host: parser.host,\n        hostname: parser.hostname,\n        port: parser.port,\n        pathname: parser.pathname,\n        search: parser.search,\n        searchObject: searchObject,\n        hash: parser.hash\n    };\n}\n\nfunction postApproveCollection(collectionId) {\n    $.ajax({\n        url: \"/zebedee/approve/\" + collectionId,\n        dataType: 'json',\n        contentType: 'application/json',\n        crossDomain: true,\n        type: 'POST',\n        success: function () {\n            // $('.over').remove(); // Commented because I can't see what this does at the moment?\n            hidePanel({onHide: function(){\n                    // Select collections tab\n                    viewController('collections')\n                }\n            });\n        },\n        error: function (response) {\n            // $('.over').remove();\n            if (response.status === 409) {\n                sweetAlert(\"Cannot approve this collection\", \"It contains files that have not been approved.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        }\n    });\n}\nfunction saveAndCompleteContent(collectionId, path, content, recursive, redirectToPath) {\n\n    if (!recursive) {\n        recursive = false;\n    }\n\n    putContent(collectionId, path, content,\n        success = function () {\n            Florence.Editor.isDirty = false;\n            if (redirectToPath) {\n                completeContent(collectionId, path, recursive, redirectToPath);\n            } else {\n                completeContent(collectionId, path, recursive);\n            }\n        },\n        error = function (response) {\n            if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        },\n        recursive);\n}\n\nfunction completeContent(collectionId, path, recursive, redirectToPath) {\n    var redirect = redirectToPath;\n    var safePath = checkPathSlashes(path);\n    if (safePath === '/') {\n        safePath = '';          // edge case for home\n    }\n\n    if (Florence.globalVars.welsh) {\n        var url = \"/zebedee/complete/\" + collectionId + \"?uri=\" + safePath + \"/data_cy.json\";\n    } else {\n        var url = \"/zebedee/complete/\" + collectionId + \"?uri=\" + safePath + \"/data.json\";\n    }\n\n    var url = url + '&recursive=' + recursive;\n\n    // Update content\n    $.ajax({\n        url: url,\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        success: function () {\n            if (redirect) {\n                createWorkspace(redirect, collectionId, 'edit');\n                return;\n            } else {\n                // Remove selection from 'working on: collection' tab\n                $('.js-nav-item--collection').hide();\n                $('.js-nav-item').removeClass('selected');\n                $('.js-nav-item--collections').addClass('selected');\n\n                viewCollections(collectionId);\n            }\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n}\n/**\n * save content to zebedee, making it in progress in a collection.\n * @param collectionId\n * @param path\n * @param content\n * @param overwriteExisting - should the content be overwritten if it already exists?\n * @param recursive - should we recurse the directory of the file and make all files under it in progress?\n * @param success\n * @param error\n */\nfunction postContent(collectionId, path, content, overwriteExisting, recursive, success, error) {\n    // Temporary workaround for content disappearing from bulletins - store last 10 saves to local storage and update with server response later\n    postToLocalStorage(collectionId, path, content);\n\n\n    var safePath = checkPathSlashes(path);\n    if (safePath === '/') {\n        safePath = '';          // edge case for home\n    }\n\n    if (Florence.globalVars.welsh) {\n        var url = \"/zebedee/content/\" + collectionId + \"?uri=\" + safePath + \"/data_cy.json\";\n        var toAddLang = JSON.parse(content);\n        toAddLang.description.language = 'cy';\n        content = JSON.stringify(toAddLang);\n    } else {\n        var url = \"/zebedee/content/\" + collectionId + \"?uri=\" + safePath + \"/data.json\";\n    }\n\n    var url = url + '&overwriteExisting=' + overwriteExisting;\n    var url = url + '&recursive=' + recursive;\n\n    $.ajax({\n        url: url,\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        data: content,\n        success: function (response) {\n            addLocalPostResponse(response);\n            success(response);\n        },\n        error: function (response) {\n            addLocalPostResponse(response);\n            if (error) {\n                error(response);\n            } else {\n                handleApiError(response);\n            }\n        }\n    });\n}\n\nfunction postToLocalStorage(collectionId, path, content) {\n    var newSaveTime = new Date();\n    var newId = collectionId;\n    var newPath = path;\n    var newContent = JSON.parse(content);\n\n    console.log(newContent);\n    \n    var localBackup = localStorage.getItem('localBackup');\n\n    if (localBackup == null) {\n        // If storage item doesn't exist yet initialise it with first save\n        localBackup = [\n            {\n                collectionId: newId,\n                content: newContent,\n                path: newPath,\n                saveTime: newSaveTime,\n                postResponse: ''\n            }\n        ]\n    } else {\n        // Parse string back into JSON for reading and writing\n        localBackup = JSON.parse(localBackup);\n\n        var backupLength = localBackup.length;\n\n        // Remove oldest entry if array is full\n        if (backupLength == 10) {\n            localBackup.pop();\n        }\n\n        // Add new entry to the top of the array\n        localBackup.unshift(\n            {\n                collectionId: newId,\n                content: newContent,\n                path: newPath,\n                saveTime: newSaveTime,\n                postResponse: ''\n            }\n        );\n    }\n\n    localBackup = JSON.stringify(localBackup);\n    localStorage.setItem('localBackup', localBackup);\n}\n\nfunction addLocalPostResponse(response) {\n    var localBackup = JSON.parse(localStorage.getItem('localBackup'));\n    localBackup[0].postResponse = response;\n    localStorage.setItem('localBackup', JSON.stringify(localBackup));\n}\n/**\n * Http post to the zebedee API to authenticate a user.\n * @param email - the email of the user to authenticate\n * @param password - the password of the user\n * @returns {boolean}\n */\nfunction postLogin(email, password) {\n    $.ajax({\n        url: \"/zebedee/login\",\n        dataType: 'json',\n        contentType: 'application/json',\n        crossDomain: true,\n        type: 'POST',\n        data: JSON.stringify({\n            email: email,\n            password: password\n        }),\n        success: function (response) {\n            document.cookie = \"access_token=\" + response + \";path=/\";\n            localStorage.setItem(\"loggedInAs\", email);\n\n            // Storing in Redux for use in refactored JS\n            var userState = __webpack_require__(24);\n            userState.email.set(email);\n\n            getUserPermission(\n                function (permission) {\n                    console.log(permission);\n                    // Only allow access to editors and admin\n                    if (permission.admin || permission.editor) {\n                        getPublisherType(permission);\n                        Florence.refreshAdminMenu();\n                        viewController();\n\n                    } else {\n                        logout();\n                        sweetAlert(\"You do not have the permissions to enter here. Please contact an administrator\");\n                    }\n                },\n                function (error) {\n                    logout();\n                    sweetAlert(\"There is a problem with permissions. Please contact an administrator\");\n                },\n                email\n            );\n        },\n        error: function (response) {\n            if (response.status === 417) {\n                viewChangePassword(email, true);\n            } else {\n                handleLoginApiError(response);\n            }\n        }\n    });\n    return true;\n}\n\nfunction getPublisherType(permission) {\n    // Variable for user type to be dispatched to Redux later\n    var userState = __webpack_require__(24),\n        userType;\n\n    // Store in localStorage publisher type\n    if (permission.admin) {\n        localStorage.setItem(\"userType\", \"PUBLISHING_SUPPORT\");\n        userType = \"PUBLISHING_SUPPORT\"\n    } else if (permission.editor && !permission.dataVisPublisher) {\n        localStorage.setItem(\"userType\", \"PUBLISHING_SUPPORT\");\n        userType = \"PUBLISHING_SUPPORT\";\n    } else if (permission.editor && permission.dataVisPublisher) {\n        localStorage.setItem(\"userType\", \"DATA_VISUALISATION\");\n        userType = \"DATA_VISUALISATION\";\n    } else if (!permission.admin && !permission.editor && !permission.dataVisPublisher) {\n        localStorage.setItem(\"userType\", \"VIEWER\");\n        userType = \"VIEWER\";\n    }\n\n    // Update Redux with user type\n    userState.type.set(userType);\n}\nfunction saveAndReviewContent(collectionId, path, content, recursive, redirectToPath) {\n\n    if (!recursive) {\n        recursive = false;\n    }\n\n    putContent(collectionId, path, content,\n        success = function () {\n            Florence.Editor.isDirty = false;\n            if (redirectToPath) {\n                postReview(collectionId, path, recursive, redirectToPath);\n            } else {\n                postReview(collectionId, path, recursive);\n            }\n        },\n        error = function (response) {\n            if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        },\n        recursive);\n}\n\nfunction postReview(collectionId, path, recursive, redirectToPath) {\n    var redirect = redirectToPath;\n    var safePath = checkPathSlashes(path);\n    if (safePath === '/') {\n        safePath = '';          // edge case for home\n    }\n\n    if (Florence.globalVars.welsh) {\n        var url = \"/zebedee/review/\" + collectionId + \"?uri=\" + safePath + \"/data_cy.json\";\n    } else {\n        var url = \"/zebedee/review/\" + collectionId + \"?uri=\" + safePath + \"/data.json\";\n    }\n\n    var url = url + '&recursive=' + recursive;\n\n    // Open the file for editing\n    $.ajax({\n        url: url,\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        success: function () {\n            if (redirect) {\n                createWorkspace(redirect, collectionId, 'edit');\n                return;\n            } else {\n                // Remove selection from 'working on: collection' tab\n                $('.js-nav-item--collection').hide();\n                $('.js-nav-item').removeClass('selected');\n                $('.js-nav-item--collections').addClass('selected');\n\n                viewCollections(collectionId);\n            }\n        },\n        error: function () {\n            console.log('Error');\n        }\n    });\n}\nfunction postTeam(name) {\n\n    var encodedName = encodeURIComponent(name);\n    $.ajax({\n        url: \"/zebedee/teams/\" + encodedName,\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        data: JSON.stringify({\n            name: encodedName\n        }),\n        success: function () {\n\n            viewTeams(selectTableRowAndDisplayTeamDetails);\n\n            // on success of view teams, display new team details and highlight team in table\n            function selectTableRowAndDisplayTeamDetails() {\n                var rowToSelect = $(\"table\").find(\"[data-id='\" + name + \"']\");\n                viewTeamDetails(name, rowToSelect);\n            }\n\n        },\n        error: function (response) {\n            handleUserPostError(response);\n        }\n    });\n\n    /**\n     * Handle error response from creating the team.\n     * @param response\n     */\n    function handleUserPostError(response) {\n        if (response.status === 403 || response.status === 401) {\n            sweetAlert(\"You are not permitted to create teams.\");\n        }\n        else if (response.status === 409) {\n            sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n        } else {\n            handleApiError(response);\n        }\n    }\n}\n\nfunction postTeamMember(name, email) {\n    var encodedName = encodeURIComponent(name);\n    $.ajax({\n        url: \"/zebedee/teams/\" + encodedName + \"?email=\" + email,\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        data: JSON.stringify({\n            name: email\n        }),\n        success: function () {\n            console.log('Team member added: ' + email);\n        },\n        error: function (response) {\n            handleUserPostError(response);\n        }\n    });\n\n    /**\n     * Handle error response from creating the team.\n     * @param response\n     */\n    function handleUserPostError(response) {\n        if (response.status === 403 || response.status === 401) {\n            sweetAlert(\"You are not permitted to add users.\");\n        }\n        else if (response.status === 409) {\n            sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n        } else {\n            handleApiError(response);\n        }\n    }\n}\nfunction postUser(name, email, password, isAdmin, isEditor, isDataVisPublisher) {\n\n    var html = templates.loadingAnimation({dark: true, large: true});\n    sweetAlert({\n        title: \"User being created...\",\n        text: html,\n        showConfirmButton: false,\n        html: true\n    });\n\n    $.ajax({\n        url: \"/zebedee/users\",\n        dataType: 'json',\n        contentType: 'application/json',\n        type: 'POST',\n        data: JSON.stringify({\n            name: name,\n            email: email\n        }),\n        success: function () {\n            console.log('User created');\n            setPassword();\n        },\n        error: function (response) {\n            handleUserPostError(response);\n        }\n    });\n\n    /**\n     * Once the user is created do a separate post to the zebedee API\n     * to set the password.\n     */\n    function setPassword() {\n        postPassword(\n            success = function () {\n                console.log('Password set');\n                setPermissions();\n            },\n            error = null,\n            email,\n            password);\n    }\n\n    /**\n     * Once the user is created and the password is set, set the permissions for the user.\n     */\n    function setPermissions() {\n        postPermission(\n            success = function () {\n                sweetAlert(\"User created\", \"User '\" + email + \"' has been created\", \"success\");\n                viewController('users');\n            },\n            error = null,\n            email = email,\n            admin = isAdmin,\n            editor = isEditor,\n            dataVisPublisher = isDataVisPublisher\n            );\n    }\n\n    /**\n     * Handle error response from creating the user.\n     * @param response\n     */\n    function handleUserPostError(response) {\n        if (response.status === 403 || response.status === 401) {\n            sweetAlert(\"You are not permitted to create users.\");\n        }\n        else if (response.status === 409) {\n            sweetAlert(\"Error\", response.responseJSON.message, \"error\");\n        } else {\n            handleApiError(response);\n        }\n    }\n}\n\nfunction publish(collectionId) {\n\n  // Open the file for editing\n  $.ajax({\n    url: \"/zebedee/publish/\" + collectionId,\n    dataType: 'json',\n    contentType: 'application/json',\n    crossDomain: true,\n    type: 'POST',\n    success: function (response) {\n      $('.over').remove();\n\n      if(response) {\n        sweetAlert(\"Published!\", \"Your collection has successfully published\", \"success\");\n\n        $('.publish-selected').animate({right: \"-50%\"}, 500);\n        // Wait until the animation ends\n        setTimeout(function () {\n          viewController('publish');\n        }, 500);\n      } else {\n        console.log('An error has occurred during the publish process, please contact an administrator. ' + response);\n        sweetAlert(\"Oops!\", 'An error has occurred during the publish process, please contact an administrator.', \"error\");\n      }\n    },\n    error: function (response) {\n      $('.over').remove();\n      handleApiError(response);\n    }\n  });\n}\n\nfunction unlock(collectionId) {\n\n  // Open the file for editing\n  $.ajax({\n    url: \"/zebedee/unlock/\" + collectionId,\n    dataType: 'json',\n    contentType: 'application/json',\n    crossDomain: true,\n    type: 'POST',\n    success: function () {\n      sweetAlert(\"Unlocked!\", \"Your collection has be unlocked from publishing\", \"success\");\n      $('.publish-selected').animate({right: \"-50%\"}, 500);\n      // Wait until the animation ends\n      setTimeout(function () {\n        viewController('publish');\n      }, 500);\n    },\n    error: function (response) {\n      handleApiError(response);\n    }\n  });\n}\n\nfunction refreshPreview(url) {\n\n  if (url) {\n    var safeUrl = checkPathSlashes(url);\n    var newUrl = Florence.babbageBaseUrl + safeUrl;\n    document.getElementById('iframe').contentWindow.location.href = newUrl;\n    $('.browser-location').val(newUrl);\n  }\n  else {\n    var urlStored = Florence.globalVars.pagePath;\n    var safeUrl = checkPathSlashes(urlStored);\n    var newUrl = Florence.babbageBaseUrl + safeUrl;\n    document.getElementById('iframe').contentWindow.location.href = newUrl;\n    $('.browser-location').val(newUrl);\n  }\n}\n\n/**\n * Manages related data\n * @param collectionId\n * @param data\n * @param templateData\n * @param field - JSON data key\n * @param idField - HTML id for the template\n */\n\nfunction renderRelatedItemAccordionSection(collectionId, data, templateData, field, idField) {\n    var list = templateData[field];\n    var dataTemplate = createRelatedItemAccordionSectionViewModel(idField, list, data);\n    var html = templates.editorRelated(dataTemplate);\n    $('#' + idField).replaceWith(html);\n    resolvePageTitlesThenRefresh(collectionId, data, templateData, field, idField);\n    $(\".workspace-edit\").scrollTop(Florence.globalVars.pagePos);\n}\n\nfunction refreshRelatedItemAccordionSection(collectionId, data, templateData, field, idField) {\n    var list = templateData[field];\n    var dataTemplate = createRelatedItemAccordionSectionViewModel(idField, list, data);\n    var html = templates.editorRelated(dataTemplate);\n    $('#sortable-' + idField).replaceWith($(html).find('#sortable-' + idField));\n    initialiseRelatedItemAccordionSection(collectionId, data, templateData, field, idField);\n}\n\nfunction createRelatedItemAccordionSectionViewModel(idField, list, data) {\n    var dataTemplate;\n    var isPublication = (data.type === 'bulletin' || data.type === 'article' || data.type === 'compendium_chapter');\n\n    if (idField === 'article') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'articles (DO NOT USE. TO BE DELETED)'};\n    } else if (idField === 'bulletin') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'bulletins (DO NOT USE. TO BE DELETED)'};\n    } else if (idField === 'dataset') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'datasets'};\n    } else if (idField === 'document') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'bulletins | articles | compendia'};\n    } else if (idField === 'qmi' && isPublication) {\n        // Tell users not to use related QMIs if editing a publication (input being phased out)\n        dataTemplate = {list: list, idField: idField, idPlural: 'QMIs (DO NOT USE. TO BE DELETED)'}\n    } else if (idField === 'qmi') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'QMIs'}\n    } else if (idField === 'methodology' && isPublication) {\n        // Tell users not to use related methodology if editing a publication (input being phased out)\n        dataTemplate = {list: list, idField: idField, idPlural: 'methodology (DO NOT USE. TO BE DELETED)'};\n    } else if (idField === 'methodology') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'methodology'};\n    } else if (idField === 'link') {\n        dataTemplate = {list: list, idField: idField, idPlural: 'links'};\n    } else {\n        dataTemplate = {list: list, idField: idField};\n    }\n    return dataTemplate;\n}\n\nfunction initialiseRelatedItemAccordionSection(collectionId, data, templateData, field, idField) {\n\n    if (data[field]) {\n        $(data[field]).each(function (index) {\n            // Attach delete button handler.\n            $('#' + idField + '-delete_' + index).click(function () {\n                deleteItem(index);\n            });\n        });\n    }\n\n    // attach add button handler.\n    $('#add-' + idField).click(function () {\n        renderRelatedItemModal();\n    });\n\n    // Make sections sortable\n    function sortable() {\n        var sortableStartPosition;\n\n        $('#sortable-' + idField).sortable({\n            start: function (event, ui) {\n\n                // remember the index of the item at the start of drag + drop\n                sortableStartPosition = ui.item.index();\n                console.log(\"sortable start: \" + sortableStartPosition);\n            },\n            stop: function (event, ui) {\n\n                // determine the new index of the item after being dropped.\n                var sortableEndPosition = ui.item.index();\n                console.log(\"sortable update: Start: \" + sortableStartPosition + \" now: \" + sortableEndPosition);\n\n                var sectionsArray = data[field];\n                var item = data[field][sortableStartPosition];\n\n                // Move the item from the start drag position to the end drop position in the data model.\n                sectionsArray.splice(sortableStartPosition, 1);\n                sectionsArray.splice(sortableEndPosition, 0, item);\n\n                saveContentAndRefreshSection();\n            }\n        });\n    }\n\n    sortable();\n\n    function deleteItem(index) {\n        swal({\n            title: \"Warning\",\n            text: \"Are you sure you want to delete this link?\",\n            type: \"warning\",\n            showCancelButton: true,\n            confirmButtonText: \"Delete\",\n            cancelButtonText: \"Cancel\",\n            closeOnConfirm: false\n        }, function (result) {\n            if (result === true) {\n\n                showDeletedMessage();\n\n                // delete the item from the data model.\n                data[field].splice(index, 1);\n                templateData[field].splice(index, 1);\n\n                saveContentAndRefreshSection();\n            }\n        });\n    }\n\n    function saveContentAndRefreshSection() {\n        putContent(collectionId, data.uri, JSON.stringify(data),\n            success = function () {\n                Florence.Editor.isDirty = false;\n                refreshPreview(data.uri);\n                refreshRelatedItemAccordionSection(collectionId, data, templateData, field, idField);\n            },\n            error = function (response) {\n                if (response.status === 409) {\n                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                } else {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n\n    function showDeletedMessage() {\n        swal({\n            title: \"Deleted\",\n            text: \"This \" + idField + \" has been deleted\",\n            type: \"success\",\n            timer: 2000\n        });\n    }\n\n    function renderRelatedItemModal() {\n\n        var viewModel = {hasLatest: false}; //Set to true if 'latest' checkbox should show\n        var latestCheck; //Populated with true/false later to check state of checkbox\n\n        if (idField === 'article' || idField === 'bulletin' || idField === 'articles' || idField === 'bulletins' || idField === 'document' || idField === 'highlights') {\n            viewModel = {hasLatest: true};\n        }\n\n        $('.modal').remove();\n        var modal = templates.relatedModal(viewModel);\n        $('.workspace-menu').append(modal);\n        $('.modal-box input[type=text]').focus();\n\n        //Modal click events\n        $('.btn-uri-cancel').off().one('click', function () {\n            $('.modal').remove();\n            //createWorkspace(data.uri, collectionId, 'edit');\n        });\n\n        $('.btn-uri-get').click(function () {\n            var pastedUrl = $('#uri-input').val();\n            var dataUrl = checkPathParsed(pastedUrl);\n            var latestCheck = $('input[id=\"latest\"]').prop('checked');\n            getPage(data, templateData, field, latestCheck, dataUrl);\n            $('.modal').remove();\n        });\n\n        $('.btn-uri-browse').off().one('click', function () {\n            var iframeEvent = document.getElementById('iframe').contentWindow;\n            iframeEvent.removeEventListener('click', Florence.Handler, true);\n            createWorkspace(data.uri, collectionId, '', null, true);\n            $('.modal').remove();\n\n            //Disable the editor\n            $('body').append(\n                \"<div class='col col--5 panel modal-background'></div>\"\n            );\n\n            //Add buttons to iframe window\n            var iframeNav = templates.iframeNav(viewModel);\n            $(iframeNav).hide().appendTo('.browser').fadeIn(600);\n\n            //Take iframe window to homepage/root\n            $('#iframe').attr('src', '/');\n\n            $('.btn-browse-cancel').off().one('click', function () {\n                createWorkspace(data.uri, collectionId, 'edit');\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n            });\n\n            //Remove added markup if user navigates away from editor screen\n            $('a:not(.btn-browse-get)').click(function () {\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n            });\n\n            $('.btn-browse-get').off().one('click', function () {\n                var dataUrl = getPathNameTrimLast();\n                latestCheck = $('input[id=\"latest\"]').prop('checked');\n                $('.iframe-nav').remove();\n                $('.modal-background').remove();\n                getPage(data, templateData, field, latestCheck, dataUrl);\n            });\n        });\n    }\n\n    function getPage(data, templateData, field, latestCheck, dataUrl) {\n\n        var dataUrlData = dataUrl + \"/data\";\n        var latestUrl;\n        if (latestCheck) {\n            var tempUrl = dataUrl.split('/');\n            tempUrl.pop();\n            tempUrl.push('latest');\n            latestUrl = tempUrl.join('/');\n        } else {\n            latestUrl = dataUrl;\n        }\n\n        $.ajax({\n            url: dataUrlData,\n            dataType: 'json',\n            crossDomain: true,\n            success: function (page) {\n\n                if ((field === 'relatedBulletins' || field === 'statsBulletins') && page.type === 'bulletin') {\n                    initialiseField();\n                }\n                else if ((field === 'relatedDatasets' || field === 'datasets') && (page.type === 'dataset' || page.type === 'timeseries_dataset')) {\n                    initialiseField();\n                }\n                else if (field === 'relatedArticles' && (page.type === 'article' || page.type === 'article_download' || page.type === 'compendium_landing_page')) {\n                    initialiseField();\n                }\n                else if ((field === 'relatedDocuments') && (page.type === 'article' || page.type === 'article_download' || page.type === 'bulletin' || page.type === 'compendium_landing_page')) {\n                    initialiseField();\n                }\n                else if ((field === 'relatedDatasets' || field === 'datasets') && (page.type === 'dataset_landing_page' || page.type === 'compendium_data')) {\n                    initialiseField();\n                }\n                else if ((field === 'items') && (page.type === 'timeseries')) {\n                    initialiseField();\n                }\n                else if ((field === 'relatedData') && (page.type === 'dataset_landing_page' || page.type === 'timeseries' || page.type === 'compendium_data')) {\n                    initialiseField();\n                }\n                else if (field === 'relatedMethodology' && (page.type === 'static_qmi')) {\n                    initialiseField();\n                }\n                else if (field === 'relatedMethodologyArticle' && (page.type === 'static_methodology' || page.type === 'static_methodology_download')) {\n                    initialiseField();\n                }\n                else if (field === 'highlightedLinks' && (page.type === 'article' || page.type === 'article_download' || page.type === 'bulletin' || page.type === 'compendium_landing_page')) {\n                    initialiseField();\n                }\n                else if (field === 'links') {\n                    initialiseField();\n                }\n                else {\n                    sweetAlert(\"This is not a valid document\");\n                    //createWorkspace(data.uri, collectionId, 'edit');\n                    return;\n                }\n\n                function initialiseField() {\n                    if (!data[field]) {\n                        data[field] = [];\n                        templateData[field] = [];\n                    }\n                }\n\n                data[field].push({uri: latestUrl});\n\n                var viewModelTitle = latestCheck ? '(Latest) ' + page.description.title : page.description.title;\n                var viewModel = {uri: latestUrl, description: {title: viewModelTitle}};\n                if (page.description.edition) {\n                    viewModel.description.edition = page.description.edition;\n                }\n                templateData[field].push(viewModel);\n\n                saveContentAndRefreshSection();\n                //saveRelated(collectionId, data.uri, data, templateData, field, idField);\n\n            },\n            error: function () {\n                console.log('No page data returned');\n            }\n        });\n    }\n}\n\nfunction resolvePageTitlesThenRefresh(collectionId, data, templateData, field, idField) {\n    var ajaxRequest = [];\n    $(templateData[field]).each(function (index, path) {\n        templateData[field][index].description = {};\n        var eachUri = path.uri;\n        var latest = eachUri.match(/\\/latest\\/?$/) ? true : false;\n        var dfd = $.Deferred();\n        getBabbagePageData(collectionId, eachUri,\n            success = function (response) {\n                templateData[field][index].description.title = latest ? '(Latest) ' + response.description.title : response.description.title;\n                if (response.description.edition) {\n                    templateData[field][index].description.edition = response.description.edition;\n                }\n                dfd.resolve();\n            },\n            error = function () {\n                sweetAlert(\"Error\", field + ' address: ' + eachUri + ' is not found.', \"error\");\n                dfd.resolve();\n            }\n        );\n        ajaxRequest.push(dfd);\n    });\n\n    $.when.apply($, ajaxRequest).then(function () {\n        refreshRelatedItemAccordionSection(collectionId, data, templateData, field, idField);\n    });\n}\nfunction renameCompendiumChildren (arrayToRename, titleNoSpace, editionNoSpace) {\n  arrayToRename.forEach(function (elem, index, array) {\n    var x = elem.uri.split(\"/\");\n    x.splice([x.length - 3], 2, titleNoSpace, editionNoSpace);\n    elem.uri = x.join(\"/\");\n  });\n  return arrayToRename;\n}\n\nfunction renameDatasetChildren (arrayToRename, titleNoSpace) {\n  arrayToRename.forEach(function (elem, index, array) {\n    var x = elem.uri.split(\"/\");\n    x.splice([x.length - 2], 1, titleNoSpace);\n    elem.uri = x.join(\"/\");\n  });\n  return arrayToRename;\n}\n\nfunction renameContent(collectionId, path, newPath, success, error) {\n  $.ajax({\n    url: \"/zebedee/contentrename/\" + collectionId + \"?uri=\" + checkPathSlashes(path) + \"&toUri=\" + checkPathSlashes(newPath),\n    type: 'POST',\n    success: function (response) {\n      if (success)\n        success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\n/**\n * Manages the editor menus\n * @param collectionId\n * @param pageData\n * @param isPageComplete - if present page has been approved\n */\n\nfunction renderAccordionSections(collectionId, pageData, isPageComplete) {\n\n    var templateData = jQuery.extend(true, {}, pageData); // clone page data to add template related properties.\n    templateData.isPageComplete = isPageComplete;\n\n    if (pageData.type === 'home_page') {\n        var email = localStorage.getItem('loggedInAs');   // get user permissions\n        getUserPermission(\n            function (permission) {\n                if (permission.admin) {\n                    var html = templates.workEditT1(templateData);\n                    $('.workspace-menu').html(html);\n                    editServiceMessage(collectionId, pageData);\n                    accordion();\n                    t1Editor(collectionId, pageData, templateData);   //templateData used to resolve section titles\n                } else {\n                    $('.workspace-menu').html(\"<section class='panel workspace-edit'><div class='edit-section'>\" +\n                        \"<div class='edit-section__head'><h1>You cannot edit this page. Please contact an administrator</h1></div></div></section>\");\n                }\n            },\n            function (error) {\n                sweetAlert(\"There is a problem with permissions. Please contact an administrator\");\n            },\n            email\n        );\n    }\n\n    else if (pageData.type === 'home_page_census') {\n        var email = localStorage.getItem('loggedInAs');   // get user permissions\n        getUserPermission(\n            function (permission) {\n                if (permission.admin) {\n                    var html = templates.workEditT1Census(templateData);\n                    $('.workspace-menu').html(html);\n                    if (pageData.images) {\n                        loadImagesList(collectionId, pageData);\n                    }\n                    editBlocks(collectionId, pageData, templateData, 'sections', 'block');\n                    accordion();\n                    t1EditorCensus(collectionId, pageData, templateData);   //templateData used to resolve section titles\n                } else {\n                    $('.workspace-menu').html(\"<section class='panel workspace-edit'><div class='edit-section'>\" +\n                        \"<div class='edit-section__head'><h1>You cannot edit this page. Please contact an administrator</h1></div></div></section>\");\n                }\n            },\n            function (error) {\n                sweetAlert(\"There is a problem with permissions. Please contact an administrator\");\n            },\n            email\n        );\n    }\n\n    else if (pageData.type === 'taxonomy_landing_page') {\n        var html = templates.workEditT2(templateData);\n        $('.workspace-menu').html(html);\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'highlightedLinks', 'highlights');\n        accordion();\n        t2Editor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'product_page') {\n        var html = templates.workEditT3(templateData);\n        $('.workspace-menu').html(html);\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'items', 'timeseries');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'statsBulletins', 'bulletins');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedArticles', 'articles');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'datasets', 'datasets');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        accordion();\n        t3Editor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'bulletin') {\n        var html = templates.workEditT4Bulletin(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.equations) {\n            loadEquationsList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'sections', 'section');\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'accordion', 'tab');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedData', 'data');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        addFile(collectionId, pageData, 'pdfTable', 'pdf');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        editDocumentCorrection(collectionId, pageData, templateData, 'versions', 'correction');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        bulletinEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'article') {\n        var html = templates.workEditT4Article(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.equations) {\n            loadEquationsList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'sections', 'section');\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'accordion', 'tab');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedData', 'data');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        addFile(collectionId, pageData, 'pdfTable', 'pdf');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        editDocumentCorrection(collectionId, pageData, templateData, 'versions', 'correction');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        articleEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'article_download') {\n        var html = templates.workEditT4ArticleDownload(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedData', 'data');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        editDocWithFilesCorrection(collectionId, pageData, 'versions', 'correction');\n        accordion();\n        ArticleDownloadEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'timeseries') {\n        var html = templates.workEditT5(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownOneObject(collectionId, pageData, 'section');\n        editMarkdownWithNoTitle(collectionId, pageData, 'notes', 'note');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedData', 'timeseries');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        timeseriesEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'compendium_landing_page') {\n        var html = templates.workEditT6(templateData);\n        $('.workspace-menu').html(html);\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedData', 'data');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        compendiumEditor(collectionId, pageData, templateData);     //templateData used to resolve chapter titles\n    }\n\n    else if (pageData.type === 'compendium_chapter') {\n        var html = templates.workEditT4Compendium(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.equations) {\n            loadEquationsList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'sections', 'section');\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'accordion', 'tab');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        addFile(collectionId, pageData, 'pdfTable', 'pdf');\n        editDocumentCorrection(collectionId, pageData, templateData, 'versions', 'correction');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        compendiumChapterEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'compendium_data') {\n        var html = templates.workEditT8Compendium(templateData);\n        $('.workspace-menu').html(html);\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        addFileWithDetails(collectionId, pageData, 'downloads', 'file');\n        editDocWithFilesCorrection(collectionId, pageData, 'versions', 'correction');\n        accordion();\n        compendiumDataEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_landing_page') {\n        var html = templates.workEditT7Landing(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        accordion();\n        staticLandingPageEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_page') {\n        var html = templates.workEditT7(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        editIntAndExtLinks(collectionId, pageData, templateData, 'links', 'link');\n        accordion();\n        staticPageEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_article') {\n        var html = templates.workEditT7StaticArticle(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.equations) {\n            loadEquationsList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'sections', 'section');\n        editIntAndExtLinks(collectionId, pageData, templateData, 'links', 'link');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        staticArticleEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_qmi') {\n        var html = templates.workEditT7(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        accordion();\n        qmiEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_foi') {\n        var html = templates.workEditT7(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        accordion();\n        foiEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_adhoc') {\n        var html = templates.workEditT7(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        accordion();\n        adHocEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_methodology') {\n        var html = templates.workEditT4Methodology(templateData);\n        $('.workspace-menu').html(html);\n        if (pageData.charts) {\n            loadChartsList(collectionId, pageData);\n        }\n        if (pageData.tables) {\n            loadTablesList(collectionId, pageData);\n        }\n        if (pageData.images) {\n            loadImagesList(collectionId, pageData);\n        }\n        if (pageData.equations) {\n            loadEquationsList(collectionId, pageData);\n        }\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'sections', 'section');\n        renderMarkdownContentAccordionSection(collectionId, pageData, 'accordion', 'tab');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        editIntAndExtLinks(collectionId, pageData, templateData, 'links', 'link');\n        addFile(collectionId, pageData, 'pdfTable', 'pdf');\n        //editTopics (collectionId, pageData, templateData, 'topics', 'topics');  //ready 2b used\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        methodologyEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'static_methodology_download') {\n        var html = templates.workEditT7(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'content');\n        addFile(collectionId, pageData, 'downloads', 'file');\n        addFile(collectionId, pageData, 'pdfDownloads', 'pdfFile');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        editIntAndExtLinks(collectionId, pageData, templateData, 'links', 'link');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        methodologyDownloadEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'dataset_landing_page') {\n        var html = templates.workEditT8LandingPage(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownOneObject(collectionId, pageData, 'section', 'Notes');\n        addDataset(collectionId, pageData, 'datasets', 'edition');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDatasets', 'dataset');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodology', 'qmi');\n        renderRelatedItemAccordionSection(collectionId, pageData, templateData, 'relatedMethodologyArticle', 'methodology');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        editTopics(collectionId, pageData, templateData, 'topics', 'topics');\n        editAlert(collectionId, pageData, templateData, 'alerts', 'alert');\n        accordion();\n        datasetLandingEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'dataset') {\n        var html = templates.workEditT8(templateData);\n        $('.workspace-menu').html(html);\n        editDatasetVersion(collectionId, pageData, 'versions', 'version');\n        editDatasetVersion(collectionId, pageData, 'versions', 'correction');\n        addFile(collectionId, pageData, 'supplementaryFiles', 'supplementary-files');\n        accordion();\n        datasetEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'timeseries_dataset') {\n        var html = templates.workEditT8(templateData);\n        $('.workspace-menu').html(html);\n        editDatasetVersion(collectionId, pageData, 'versions', 'version');\n        addFile(collectionId, pageData, 'supplementaryFiles', 'supplementary-files');\n        editDatasetVersion(collectionId, pageData, 'versions', 'correction');\n        accordion();\n        datasetEditor(collectionId, pageData);\n    }\n\n    else if (pageData.type === 'release') {\n        var html = templates.workEditT16(templateData);\n        $('.workspace-menu').html(html);\n        editMarkdownWithNoTitle(collectionId, pageData, 'markdown', 'prerelease');\n        editDate(collectionId, pageData, templateData, 'dateChanges', 'changeDate');\n        renderExternalLinkAccordionSection(collectionId, pageData, 'links', 'link');\n        //renderRelatedItemAccordionSection (collectionId, pageData, templateData, 'relatedDocuments', 'document');\n        //renderRelatedItemAccordionSection (collectionId, pageData, templateData, 'relatedDatasets', 'data');\n        accordion();\n        releaseEditor(collectionId, pageData, templateData);\n    }\n\n    else if (pageData.type === 'visualisation') {\n        var html = templates.workEditVisualisation(templateData);\n        $('.workspace-menu').html(html);\n        accordion();\n        visualisationEditor(collectionId, pageData, templateData);\n    }\n\n    else {\n\n        var workspace_menu_sub_edit =\n            '<section class=\"workspace-edit\">' +\n            '  <p style=\"font-size:20px; color:red;\">Page: ' + pageData.type + ' is not supported.</p>' +\n            '  <textarea class=\"fl-editor__headline\" name=\"fl-editor__headline\" style=\"height: 728px\" cols=\"104\"></textarea>' +\n            '  <nav class=\"edit-nav\">' +\n            '  </nav>' +\n            '</section>';\n\n        $('.workspace-menu').html(workspace_menu_sub_edit);\n        $('.fl-editor__headline').val(JSON.stringify(pageData, null, 2));\n\n        refreshEditNavigation();\n\n        var editNav = $('.edit-nav');\n        editNav.off(); // remove any existing event handlers.\n\n        editNav.on('click', '.btn-edit-save', function () {\n            var pageDataToSave = $('.fl-editor__headline').val();\n            updateContent(collectionId, pageData.uri, pageDataToSave);\n        });\n\n        // complete\n        editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n            var pageDataToSave = $('.fl-editor__headline').val();\n            saveAndCompleteContent(collectionId, pageData.uri, pageDataToSave);\n        });\n\n        // review\n        editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n            var pageDataToSave = $('.fl-editor__headline').val();\n            saveAndReviewContent(collectionId, pageData.uri, pageDataToSave);\n        });\n    }\n\n    // Listen on all input within the workspace edit panel for dirty checks.\n    $('.workspace-edit :input').on('input', function () {\n        Florence.Editor.isDirty = true;\n        // remove the handler now we know content has changed.\n        //$(':input').unbind('input');\n        //console.log('Changes detected.');\n    });\n}\n\nfunction refreshEditNavigation() {\n    getCollection(Florence.collection.id,\n        success = function (collection) {\n            var pagePath = getPreviewUrl();\n            var pageFile = pagePath + '/data.json';\n            var lastCompletedEvent = getLastCompletedEvent(collection, pageFile);\n            var isPageComplete = !(!lastCompletedEvent || lastCompletedEvent.email === Florence.Authentication.loggedInEmail());\n\n            var editNav = templates.editNav({isPageComplete: isPageComplete});\n            $('.edit-nav').html(editNav);\n        },\n        error = function (response) {\n            handleApiError(response);\n        })\n}function resetPage() {\n    // Prevent default behaviour of all form submits throught Florence\n    $(document).on('submit', 'form', function(e) {\n        e.preventDefault();\n    });\n\n    // Fix for modal form submits not being detected\n    $(document).on('click', 'button', function() {\n        var $closestForm = $(this).closest('form');\n        $closestForm.submit(function(e) {\n            e.preventDefault();\n        });\n    });\n\n    // Stop anchors doing default behaviour\n    // $(document).on('click', 'a', function(e) {\n    //     e.preventDefault();\n    //     console.log('Anchor click stopped on: ', e);\n    // });\n\n    // $(document).on('click', 'form', function(e) {\n    //     e.preventDefault();\n    //     console.log('Form clicked');\n    // });\n\n    // $(document).on('click', 'button', function (e) {\n    //     e.preventDefault();\n    //     console.log(e);\n    // });\n\n    // $(document).on('submit', '#cancel-form', function(e) {\n    //     e.preventDefault();\n    //     console.log(e);\n    // });\n}/**\n * Save new content.\n * @param collectionId\n * @param uri\n * @param data - new content being posted for update\n * @param collectionData - JSON for collection\n */\nfunction saveContent(collectionId, uri, data, collectionData) {\n    postContent(collectionId, uri, JSON.stringify(data), false, false,\n        success = function (message) {\n            console.log(\"Updating completed \" + message);\n            createWorkspace(uri, collectionId, 'edit', collectionData);\n        },\n        error = function (response) {\n            if (response.status === 409) {\n                sweetAlert(\"Cannot create this page\", \"It already exists.\");\n            }\n            else {\n                handleApiError(response);\n            }\n        }\n    );\n}\nfunction saveNewCorrection (collectionId, path, success, error) {\n  var safePath = checkPathSlashes(path);\n  if (safePath === '/') {\n    safePath = '';          // edge case for home\n  }\n\n  var url = \"/zebedee/version/\" + collectionId + \"?uri=\" + safePath;\n\n  // Update content\n  $.ajax({\n    url: url,\n    dataType: 'json',\n    contentType: 'application/json',\n    type: 'POST',\n    success: function (response) {\n      success(response);\n    },\n    error: function (response) {\n      if (error) {\n        error(response);\n      } else {\n        handleApiError(response);\n      }\n    }\n  });\n}\n\nfunction setShortcuts(field, callback) {\n  $(field).select(function (e) {\n    $(field).on('keydown', null, 'ctrl+m', function (ev) {\n      var inputValue = $(field).val();\n      var start = e.target.selectionStart;\n      var end = e.target.selectionEnd;\n      var outputValue = [inputValue.slice(0, start), \"^\", inputValue.slice(start, end), \"^\", inputValue.slice(end)].join('');\n      $(field).val(outputValue);\n      ev.stopImmediatePropagation();\n      ev.preventDefault();\n      if(typeof callback === 'function') {\n        callback();\n      }\n    });\n    $(field).on('keyup', null, 'ctrl+q', function (ev) {\n      var inputValue = $(field).val();\n      var start = e.target.selectionStart;\n      var end = e.target.selectionEnd;\n      var outputValue = [inputValue.slice(0, start), \"~\", inputValue.slice(start, end), \"~\", inputValue.slice(end)].join('');\n      $(field).val(outputValue);\n      ev.stopImmediatePropagation();\n      if(typeof callback === 'function') {\n        callback();\n      }\n    });\n  });\n}function setupFlorence() {\n    window.templates = Handlebars.templates;\n    Handlebars.registerPartial(\"browseNode\", templates.browseNode);\n    Handlebars.registerPartial(\"browseNodeDataVis\", templates.browseNodeDataVis);\n    Handlebars.registerPartial(\"editNav\", templates.editNav);\n    Handlebars.registerPartial(\"editNavChild\", templates.editNavChild);\n    Handlebars.registerPartial(\"selectorHour\", templates.selectorHour);\n    Handlebars.registerPartial(\"selectorMinute\", templates.selectorMinute);\n    Handlebars.registerPartial(\"tickAnimation\", templates.tickAnimation);\n    Handlebars.registerPartial(\"loadingAnimation\", templates.loadingAnimation);\n    Handlebars.registerPartial(\"childDeletes\", templates.childDeletes);\n    Handlebars.registerHelper('select', function (value, options) {\n        var $el = $('<select />').html(options.fn(this));\n        $el.find('[value=\"' + value + '\"]').attr({'selected': 'selected'});\n        return $el.html();\n    });\n    Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {\n\n        switch (operator) {\n            case '==':\n                return (v1 == v2) ? options.fn(this) : options.inverse(this);\n            case '===':\n                return (v1 === v2) ? options.fn(this) : options.inverse(this);\n            case '<':\n                return (v1 < v2) ? options.fn(this) : options.inverse(this);\n            case '<=':\n                return (v1 <= v2) ? options.fn(this) : options.inverse(this);\n            case '>':\n                return (v1 > v2) ? options.fn(this) : options.inverse(this);\n            case '>=':\n                return (v1 >= v2) ? options.fn(this) : options.inverse(this);\n            case '&&':\n                return (v1 && v2) ? options.fn(this) : options.inverse(this);\n            case '||':\n                return (v1 || v2) ? options.fn(this) : options.inverse(this);\n            default:\n                return options.inverse(this);\n        }\n    });\n    //Check if array contains element\n    Handlebars.registerHelper('ifContains', function (elem, list, options) {\n        if (list.indexOf(elem) > -1) {\n            return options.fn(this);\n        }\n        return options.inverse(this);\n    });\n    // Add two values together. Primary usage was '@index + 1' to create numbered lists\n    Handlebars.registerHelper('plus', function (value1, value2) {\n        return value1 + value2;\n    });\n    // Add two values together. Primary usage was '@index + 1' to create numbered lists\n    Handlebars.registerHelper('lastEditedBy', function (array) {\n        if (array) {\n            var event = array[array.length - 1];\n            if (event) {\n                return 'Last edited ' + StringUtils.formatIsoDateString(new Date(event.date)) + \" by \" + event.email;\n            }\n        }\n        return '';\n    });\n    Handlebars.registerHelper('createdBy', function (array) {\n        if (array) {\n            var event = getCollectionCreatedEvent(array);\n            if (event) {\n                return 'Created ' + StringUtils.formatIsoDateString(new Date(event.date)) + \" by \" + event.email + '';\n            } else {\n                return \"\";\n            }\n        }\n        return \"\";\n    });\n    // If two strings match\n    Handlebars.registerHelper('if_eq', function (a, b, opts) {\n        if (a == b)\n            return opts.fn(this);\n        else\n            return opts.inverse(this);\n    });\n    // If two strings don't match\n    Handlebars.registerHelper('if_ne', function (a, b, opts) {\n        if (a != b)\n            return opts.fn(this);\n        else\n            return opts.inverse(this);\n    });\n\n    Handlebars.registerHelper('comma_separated_list', function (array) {\n        var asString = \"\";\n\n        if (array) {\n            array.forEach(function (item) {\n                asString = asString + item + \", \";\n            });\n            return asString.substring(0, asString.lastIndexOf(\",\"));\n        }\n        return asString;\n    });\n\n    Handlebars.registerHelper('parent_dir', function (uri) {\n        var pathSections = uri.split(\"/\");\n        if (pathSections.length > 0) {\n            return \"/\" + pathSections[pathSections.length -1];\n        }\n        return \"\";\n    });\n\n    Handlebars.registerHelper('debug', function (message, object) {\n        console.log(\"DEBUG: \" + message + \" \" + JSON.stringify(object));\n        return \"\";\n    });\n\n\n    Florence.globalVars.activeTab = false;\n\n    // load main florence template\n    var florence = templates.florence;\n\n    $('body').append(florence);\n    Florence.refreshAdminMenu();\n\n    var adminMenu = $('.js-nav');\n    // dirty checks on admin menu\n    adminMenu.on('click', '.js-nav-item', function () {\n        if (Florence.Editor.isDirty) {\n            swal({\n                title: \"Warning\",\n                text: \"If you do not come back to this page, you will lose any unsaved changes\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Continue\",\n                cancelButtonText: \"Cancel\"\n            }, function (result) {\n                if (result === true) {\n                    Florence.Editor.isDirty = false;\n                    processMenuClick(this);\n                    return true;\n                } else {\n                    return false;\n                }\n            });\n        } else {\n            processMenuClick(this);\n        }\n    });\n\n\n    window.onbeforeunload = function () {\n        if (Florence.Editor.isDirty) {\n            return 'You have unsaved changes.';\n        }\n    };\n    viewController();\n\n\n    function processMenuClick(clicked) {\n        Florence.collection = {};\n\n        $('.js-nav-item--collection').hide();\n        $('.js-nav-item').removeClass('selected');\n        var menuItem = $(clicked);\n\n        menuItem.addClass('selected');\n\n\n        if (menuItem.hasClass(\"js-nav-item--collections\")) {\n            viewController('collections');\n        } else if (menuItem.hasClass(\"js-nav-item--collection\")) {\n            var thisCollection = CookieUtils.getCookieValue(\"collection\");\n            viewCollections(thisCollection);\n            $(\".js-nav-item--collections\").addClass('selected');\n        } else if (menuItem.hasClass(\"js-nav-item--users\")) {\n            viewController('users');\n        } else if (menuItem.hasClass(\"js-nav-item--teams\")) {\n            viewController('teams');\n        } else if (menuItem.hasClass(\"js-nav-item--publish\")) {\n            viewController('publish');\n        } else if (menuItem.hasClass(\"js-nav-item--reports\")) {\n            viewController('reports');\n        } else if (menuItem.hasClass(\"js-nav-item--login\")) {\n            viewController('login');\n        } else if (menuItem.hasClass(\"js-nav-item--logout\")) {\n            logout();\n            viewController();\n        }\n    }\n\n    // Get ping times to zebedee and surface for user\n    var lastPingTime;\n    var pingTimes = [];\n\n    function doPing() {\n        var start = new Date().getTime();\n        $.ajax({\n            url: \"/zebedee/ping\",\n            dataType: 'json',\n            contentType: 'application/json',\n            type: 'POST',\n            data: JSON.stringify({\n                lastPingTime: lastPingTime\n            }),\n            success: function (response) {\n\n                // Handle session information\n                checkSessionTimeout(response);\n\n                var end = new Date().getTime();\n                var time = end - start;\n\n                lastPingTime = time;\n                pingTimes.push(time);\n                if (pingTimes.length > 5)\n                    pingTimes.shift();\n\n                var sum = 0;\n                for (var i = 0; i < pingTimes.length; ++i) {\n                    sum += pingTimes[i];\n                }\n\n                var averagePingTime = sum / pingTimes.length;\n\n                networkStatus(lastPingTime);\n\n                if (averagePingTime < 100) {\n                    console.log(\"ping time: pretty good! \" + time + \" average: \" + averagePingTime + \" \" + pingTimes);\n                } else if (averagePingTime < 300) {\n                    console.log(\"ping time: not so good! \" + time + \" average: \" + averagePingTime + \" \" + pingTimes);\n                } else {\n                    console.log(\"ping time: really bad! \" + time);\n                }\n\n                pingTimer = setTimeout(function () {\n                    doPing();\n                }, 10000);\n            }\n        });\n    }\n\n    var pingTimer = setTimeout(function () {\n        doPing();\n    }, 10000);\n\n    // Alert user if ping states that their session is going to log out (log out if it's run out too)\n    var countdownIsShown = false,\n        secondCounter = 0;\n\n    function checkSessionTimeout(sessionData) {\n        var currentDateTime = new Date(),\n            sessionExpiry = new Date(sessionData.sessionExpiryDate),\n            timeLeftInSession = parseInt((sessionExpiry - currentDateTime)/1000);\n\n        if (timeLeftInSession <= 31 && !countdownIsShown) {\n            // Session is going to expire soon, warn user and give them option to reset session timer\n            countdownIsShown = true;\n            secondCounter = timeLeftInSession;\n            console.log(\"Session to expire in \" + timeLeftInSession + \" seconds\");\n            sweetAlert({\n                type: \"warning\",\n                title: \"Session expiring in <span id='session-expiry'>\" + timeLeftInSession + \"</span> seconds\",\n                text: \"You've not been active for sometime now, are you still using Florence?\",\n                html: true,\n                confirmButtonText: \"I'm still using Florence!\"\n            }, function(response) {\n                if (response) {\n                    $.get(\"/zebedee/users?email=\" + Florence.Authentication.loggedInEmail());\n                    countdownIsShown = false;\n                    console.log(\"Session timer reset\");\n                }\n            });\n            // Update alert with amount of time user has left until they're logged out\n            var sessionCountdown = setInterval(function() {\n                secondCounter -= 1;\n                $('#session-expiry').html(secondCounter);\n\n                // If session has timed out & the warning hasn't been closed yet, log out the user and inform them why they've been logged out\n                if (secondCounter === 0 && countdownIsShown) {\n                    sweetAlert({\n                        type: \"warning\",\n                        title: \"Your session has expired\",\n                        text: \"Florence was left inactive for too long so you have been logged out\"\n                    });\n                    logout();\n                    countdownIsShown = false;\n                    clearInterval(sessionCountdown);\n                } else if (!countdownIsShown) {\n                    // User responded to warning so Florence is active now, clear the countdown\n                    clearInterval(sessionCountdown);\n                }\n            }, 1000);\n        }\n    }\n\n    // Reset default functions from certain elements - eg form submits\n    resetPage();\n\n    // Log every click that will be changing the state or data in Florence\n    $(document).on('click', 'a, button, input[type=\"button\"], iframe, .table--primary tr, .js-nav-item, .page__item', function(e) {\n        var diagnosticJSON = JSON.stringify(new clickEventObject(e));\n        $.ajax({\n            url: \"/zebedee/clickEventLog\",\n            type: 'POST',\n            contentType: \"application/json\",\n            data: diagnosticJSON,\n            async: true,\n        });\n    });\n\n    function clickEventObject(event) {\n        this.user = localStorage.getItem('loggedInAs');\n        triggerTemp = {};\n        collectionTemp = {};\n\n        if (event.target.id) {\n            triggerTemp.elementId = event.target.id;\n        }\n\n        if ($(event.target).attr('class')) {\n            classes = [];\n            $.each($(event.target).attr('class').split(\" \"), function(index, value) {\n                if (value) {\n                    classes.push(value);\n                }\n            });\n            if (classes.length > 0) {\n                triggerTemp.elementClasses = classes;\n            }\n        }\n\n        if (Florence.collection.id) {\n            collectionTemp.id = Florence.collection.id;\n        }\n\n        if (Florence.collection.name) {\n            collectionTemp.name = Florence.collection.name;\n        }\n\n        if (Florence.collection.type) {\n            collectionTemp.type = Florence.collection.type;\n        }\n\n        if (triggerTemp.elementId || triggerTemp.elementClasses) {\n            this.trigger = triggerTemp;\n        }\n\n        if (collectionTemp.id || collectionTemp.name || collectionTemp.type) {\n            this.collection = collectionTemp\n        }\n    }\n\n    // Check running version versus latest and notify user if they don't match\n    var runningVersion,\n        userWarned = false;\n    function checkVersion() {\n        return fetch('assets/version.json')\n            .then(function(response) {\n                return response.json();\n            })\n            .then(function(responseJson) {\n                return responseJson;\n            })\n            .catch(function(err) {\n                console.log(\"Error getting latest Florence version: \", err);\n                return err\n            });\n    }\n\n    checkVersion().then(function(response) {\n        runningVersion = response;\n    });\n\n    setInterval(function() {\n        // Get the latest version and alert user if it differs from version stored on load (but only if the user hasn't been warned already, so they don't get spammed after being warned already)\n        if (!userWarned) {\n            checkVersion().then(function (response) {\n                if (response.major !== runningVersion.major || response.minor !== runningVersion.minor || response.build !== runningVersion.build) {\n                    console.log(\"New version of Florence available: \", response.major + \".\" + response.minor + \".\" + response.build);\n                    swal({\n                        title: \"New version of Florence available\",\n                        type: \"info\",\n                        showCancelButton: true,\n                        closeOnCancel: false,\n                        closeOnConfirm: false,\n                        confirmButtonText: \"Refresh Florence\",\n                        cancelButtonText: \"Don't refresh\"\n                    }, function (isConfirm) {\n                        userWarned = true;\n                        if (isConfirm) {\n                            location.reload();\n                        } else {\n                            swal(\"Warning\", \"Florence could be unstable without the latest version\", \"warning\")\n                        }\n                    });\n                    runningVersion = response;\n                }\n            });\n        }\n    }, 10000)\n}\n\nfunction releaseEditor(collectionId, data) {\n    var setActiveTab, getActiveTab;\n    var renameUri = false;\n    var pageDataRequests = [];\n    var pages = {};\n\n    $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n        setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n        if (setActiveTab !== false) {\n            Florence.globalVars.activeTab = setActiveTab;\n        }\n    });\n\n    getActiveTab = Florence.globalVars.activeTab;\n    accordion(getActiveTab);\n    getLastPosition();\n\n    processCollection(collectionId, 'noSave');\n\n    $(\"#title\").on('input', function () {\n        renameUri = true;\n        data.description.title = $(this).val();\n    });\n    $(\"#provisionalDate\").on('input', function () {\n        data.description.provisionalDate = $(this).val();\n    });\n    var dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'});\n    if (!data.description.finalised) {\n        $('.release-date').on('change', function () {\n            var publishTime = parseInt($('#release-hour').val()) + parseInt($('#release-min').val());\n            var toIsoDate = $('#releaseDate').datepicker(\"getDate\");\n            data.description.releaseDate = new Date(parseInt(new Date(toIsoDate).getTime()) + publishTime).toISOString();\n        });\n    } else {\n        $('.release-date').on('change', function () {\n            swal({\n                title: \"Warning\",\n                text: \"You will need to add an explanation for this change. Are you sure you want to proceed?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Continue\",\n                cancelButtonText: \"Cancel\"\n            }, function (result) {\n                if (result === true) {\n                    saveOldDate(collectionId, data, dateTmp);\n                    var publishTime = parseInt($('#release-hour').val()) + parseInt($('#release-min').val());\n                    var toIsoDate = $('#releaseDate').datepicker(\"getDate\");\n                    data.description.releaseDate = new Date(parseInt(new Date(toIsoDate).getTime()) + publishTime).toISOString();\n                } else {\n                    $('#releaseDate').val(dateTmpFormatted);\n                }\n            });\n        });\n    }\n\n    var date = new Date(data.description.releaseDate);\n    var hour = date.getHours();\n    $('#release-hour').val(hour * 3600000);\n\n    var minutes = date.getMinutes();\n    $('#release-min').val(minutes * 60000);\n\n    $(\"#nextRelease\").on('input', function () {\n        data.description.nextRelease = $(this).val();\n        \n    });\n    if (!data.description.contact) {\n        data.description.contact = {};\n    }\n    $(\"#contactName\").on('input', function () {\n        data.description.contact.name = $(this).val();\n        \n    });\n    $(\"#contactEmail\").on('input', function () {\n        data.description.contact.email = $(this).val();\n        \n    });\n    $(\"#contactTelephone\").on('input', function () {\n        data.description.contact.telephone = $(this).val();\n        \n    });\n    $(\"#summary\").on('input', function () {\n        data.description.summary = $(this).val();\n        \n    });\n\n    /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n    var checkBoxStatus = function (id) {\n        if (id === 'natStat') {\n            if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n                return false;\n            } else {\n                return true;\n            }\n        } else if (id === 'cancelled') {\n            if (data.description.cancelled === \"false\" || data.description.cancelled === false) {\n                return false;\n            } else {\n                return true;\n            }\n        } else if (id === 'finalised') {\n            if (data.description.finalised === \"false\" || data.description.finalised === false) {\n                return false;\n            } else {\n                return true;\n            }\n        }\n    };\n\n    // Gets status of checkbox and sets JSON to match\n    $(\"#natStat input[type='checkbox']\").prop('checked', checkBoxStatus($('#natStat').attr('id'))).click(function () {\n        data.description.nationalStatistic = $(\"#natStat input[type='checkbox']\").prop('checked') ? true : false;\n        \n    });\n\n    $(\"#cancelled input[type='checkbox']\").prop('checked', checkBoxStatus($('#cancelled').attr('id'))).click(function () {\n        data.description.cancelled = $(\"#cancelled input[type='checkbox']\").prop('checked') ? true : false;\n        if (data.description.cancelled) {\n            var editedSectionValue = {};\n            editedSectionValue.title = \"Please enter the reason for the cancellation\";\n            var saveContent = function (updatedContent) {\n                data.description.cancellationNotice = [updatedContent];\n                putContent(collectionId, data.uri, JSON.stringify(data),\n                    success = function () {\n                        Florence.Editor.isDirty = false;\n                        loadPageDataIntoEditor(data.uri, collectionId);\n                        refreshPreview(data.uri);\n                    },\n                    error = function (response) {\n                        if (response.status === 400) {\n                            sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                        }\n                        else {\n                            handleApiError(response);\n                        }\n                    }\n                );\n            };\n            loadMarkdownEditor(editedSectionValue, saveContent, data, 'notEmpty');\n        } else {\n            data.description.cancellationNotice = [];\n        }\n        \n    });\n\n    if (data.description.finalised) {\n        $(\"#finalised input[type='checkbox']\").prop('checked', checkBoxStatus($('#finalised').attr('id'))).click(function (e) {\n            sweetAlert('You cannot change this field once it is finalised.');\n            e.preventDefault();\n        });\n    } else {\n        $(\"#finalised input[type='checkbox']\").prop('checked', checkBoxStatus($('#finalised').attr('id'))).click(function () {\n            swal({\n                title: \"Warning\",\n                text: \"You will not be able reset the date to provisional once you've done this. Are you sure you want to proceed?\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonText: \"Continue\",\n                cancelButtonText: \"Cancel\"\n            }, function (result) {\n                if (result) {\n                    data.description.finalised = $(\"#finalised input[type='checkbox']\").prop('checked') ? true : false;\n                    if (data.description.finalised) {\n                        // remove provisional date\n                        data.description.provisionalDate = \"\";\n                        $('.provisional-date').remove();\n                        $('#finalised').remove();\n                    }\n                } else {\n                    $(\"#finalised input[type='checkbox']\").prop('checked', false);\n                }\n            });\n        });\n    }\n\n    $(\"#dateChange\").on('input', function () {\n        data.dateChanges.previousDate = $(this).val();\n        \n    });\n\n    function saveOldDate(collectionId, data, oldDate) {\n        data.dateChanges.push({previousDate: oldDate, changeNotice: \"\"});\n        initialiseLastNoteMarkdown(collectionId, data, 'dateChanges', 'changeNotice');\n    }\n\n    $('#add-preview').click(function () {\n        //Check if it is article, bulletin or dataset\n        processCollection(collectionId);\n    });\n\n    function processCollection(collectionId, noSave) {\n        pageDataRequests.push(\n            getCollectionDetails(collectionId,\n                success = function (response) {\n                    pages = response;\n                },\n                error = function (response) {\n                    handleApiError(response);\n                }\n            )\n        );\n        $.when.apply($, pageDataRequests).then(function () {\n            if(pages.releaseUri && pages.releaseUri == data.uri) {\n                processPreview(data, pages);\n                if (noSave) {\n                    putContent(collectionId, data.uri, JSON.stringify(data),\n                      success = function () {\n                          Florence.Editor.isDirty = false;\n                          refreshPreview(data.uri);\n                      },\n                      error = function (response) {\n                          if (response.status === 400) {\n                              sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                          } else {\n                              handleApiError(response);\n                          }\n                      }\n                    );\n                } else {\n                    updateContent(collectionId, data.uri, JSON.stringify(data));\n                }\n            }\n        });\n    }\n\n    //Add uri to relatedDocuments or relatedDatasets\n    function processPreview(data, pages) {\n        data.relatedDocuments = [];\n        data.relatedDatasets = [];\n        data.relatedMethodology = [];\n        data.relatedMethodologyArticle = [];\n        _.each(pages.inProgress, function (page) {\n            if (page.type === 'article' || page.type === 'article_download' || page.type === 'bulletin' || page.type === 'compendium_landing_page') {\n                data.relatedDocuments.push({uri: page.uri});\n                //console.log(page.uri);\n            } else if (page.type === 'dataset_landing_page') {\n                data.relatedDatasets.push({uri: page.uri});\n            } else if (page.type === 'static_qmi') {\n                data.relatedMethodology.push({uri: page.uri});\n            } else if (page.type === 'static_methodology' || page.type === 'static_methodology_download') {\n                data.relatedMethodologyArticle.push({uri: page.uri});\n            }\n        });\n        _.each(pages.complete, function (page) {\n            if (page.type === 'article' || page.type === 'article_download' || page.type === 'bulletin' || page.type === 'compendium_landing_page') {\n                data.relatedDocuments.push({uri: page.uri});\n                //console.log(page.uri);\n            } else if (page.type === 'dataset_landing_page') {\n                data.relatedDatasets.push({uri: page.uri});\n            } else if (page.type === 'static_qmi') {\n                data.relatedMethodology.push({uri: page.uri});\n            } else if (page.type === 'static_methodology' || page.type === 'static_methodology_download') {\n                data.relatedMethodologyArticle.push({uri: page.uri});\n            }\n        });\n        _.each(pages.reviewed, function (page) {\n            if (page.type === 'article' || page.type === 'article_download' || page.type === 'bulletin' || page.type === 'compendium_landing_page') {\n                data.relatedDocuments.push({uri: page.uri});\n                //console.log(page.uri);\n            } else if (page.type === 'dataset_landing_page') {\n                data.relatedDatasets.push({uri: page.uri});\n            } else if (page.type === 'static_qmi') {\n                data.relatedMethodology.push({uri: page.uri});\n            } else if (page.type === 'static_methodology' || page.type === 'static_methodology_download') {\n                data.relatedMethodologyArticle.push({uri: page.uri});\n            }\n        });\n    }\n\n    // Check whether release is being added back into collection and the published flag should be toggled to truthy\n    function checkPublishedFlag(data) {\n        return new Promise (function(resolve, reject) {\n            if (!data.description.published) {\n                getCollection(collectionId, success = function (collectionData) {\n                    if (collectionData.releaseUri == data.uri) {\n                        data.description.published = true;\n                    }\n                    resolve()\n                }, error = function (error) {\n                    reject(error);\n                });\n            } else {\n                resolve();\n            }\n        });\n    }\n\n    //Save and update preview page\n    //Get collection content\n\n    // Save\n    var editNav = $('.edit-nav');\n    editNav.off(); // remove any existing event handlers.\n\n    editNav.on('click', '.btn-edit-save', function () {\n        save(updateContent);\n    });\n\n    // completed to review\n    editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n        save(saveAndCompleteContent);\n    });\n\n    // reviewed to approve\n    editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n        save(saveAndReviewContent);\n    });\n\n    function save(onSave) {\n        // Check whether the publish flag needs to be toggle - this is async so needs to be a promise\n        checkPublishedFlag(data).then(function() {\n            // Once publish flag is checked then continue with rest of save\n            checkRenameUri(collectionId, data, renameUri, onSave);\n        }).catch(function(error) {\n            console.log(\"Error getting collection data: \", error);\n        });\n\n    }\n}\n\nfunction t1Editor(collectionId, data, templateData) {\n\n  var newSections = [];\n  var setActiveTab, getActiveTab;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n\n  resolveTitleT1(collectionId, data, templateData, 'sections');\n\n  // Metadata edition and saving\n  if (Florence.globalVars.welsh) {\n    $(\"#title\").on('input', function () {\n      $(this).textareaAutoSize();\n      data.description.title = $(this).val();\n    });\n  } else {\n    $(\".title\").remove();\n  }\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save();\n    updateContent(collectionId, '', JSON.stringify(data));\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    //pageData = $('.fl-editor__headline').val();\n    save();\n    saveAndCompleteContent(collectionId, '', JSON.stringify(data));\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save();\n    saveAndReviewContent(collectionId, '', JSON.stringify(data));\n  });\n\n  function save() {\n    // sections\n    var orderSections = $(\"#sortable-section\").sortable('toArray');\n    $(orderSections).each(function (indexS, nameS) {\n      var uri = data.sections[parseInt(nameS)].statistics.uri;\n      var safeUri = checkPathSlashes(uri);\n      var link = data.sections[parseInt(nameS)].theme.uri;\n      newSections[parseInt(indexS)] = {\n        theme: {uri: link},\n        statistics: {uri: safeUri}\n      };\n    });\n    data.sections = newSections;\n  }\n}\n\nfunction resolveTitleT1(collectionId, data, templateData, field) {\n  var ajaxRequest = [];\n  $(templateData[field]).each(function (index, path) {\n    var eachUri = path.statistics.uri;\n    var dfd = $.Deferred();\n    getBabbagePageData(collectionId, eachUri,\n      success = function (response) {\n        templateData[field][index].statistics.title = response.description.title;\n        dfd.resolve();\n      },\n      error = function () {\n        sweetAlert(\"Error\", field + ' address: ' + eachUri + ' is not found.', \"error\");\n        dfd.resolve();\n      }\n    );\n    ajaxRequest.push(dfd);\n  });\n\n  $.when.apply($, ajaxRequest).then(function () {\n    var dataTemplate = templateData[field];\n    var html = templates.workEditT1Sections(dataTemplate);\n    $('#to-populate').replaceWith(html);\n\n    //Edit section\n    $(data.sections).each(function (index, section) {\n//  lastIndexSections = index + 1;\n      $(\"#section-edit_\" + index).on('click', function () {\n        swal ({\n          title: \"Warning\",\n          text: \"If you do not come back to this page, you will lose any unsaved changes\",\n          type: \"warning\",\n          showCancelButton: true,\n          confirmButtonText: \"Continue\",\n          cancelButtonText: \"Cancel\"\n        }, function(result) {\n          if (result === true) {\n            var iframeEvent = document.getElementById('iframe').contentWindow;\n            iframeEvent.removeEventListener('click', Florence.Handler, true);\n            createWorkspace('/', collectionId, '', null, true);\n\n            $('#' + index).replaceWith(\n              '<div id=\"' + index + '\" class=\"edit-section__sortable-item\">' +\n              '  <textarea id=\"uri_' + index + '\" placeholder=\"Go to the related document and click Get\"></textarea>' +\n              '  <button class=\"btn-page-get\" id=\"section-get_' + index + '\">Get</button>' +\n              '  <button class=\"btn-page-cancel\" id=\"section-cancel_' + index + '\">Cancel</button>' +\n              '</div>');\n            $(\"#section-cancel_\" + index).hide();\n\n            $(\"#section-get_\" + index).one('click', function () {\n              var pastedUrl = $('#uri_' + index).val();\n              if (!pastedUrl) {\n                pastedUrl = getPathNameTrimLast();\n              } else {\n                pastedUrl = checkPathParsed(pastedUrl);\n              }\n              var sectionUrlData = pastedUrl + \"/data\";\n\n              $.ajax({\n                url: sectionUrlData,\n                dataType: 'json',\n                crossDomain: true,\n                success: function (sectionData) {\n                  if (sectionData.type === 'timeseries') {\n                    data.sections.splice(index, 1,\n                      {\n                        theme: {uri: getTheme(sectionData.uri)},\n                        statistics: {uri: sectionData.uri}\n                      });\n                    putContent(collectionId, '', JSON.stringify(data),\n                      success = function (response) {\n                        console.log(\"Updating completed \" + response);\n                        Florence.Editor.isDirty = false;\n                        createWorkspace('/', collectionId, 'edit');\n                      },\n                      error = function (response) {\n                        if (response.status === 400) {\n                          sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                        }\n                        else {\n                          handleApiError(response);\n                        }\n                      }\n                    );\n                  } else {\n                    sweetAlert(\"This is not a time series\");\n                  }\n                },\n                error: function () {\n                  console.log('No page data returned');\n                }\n              });\n            });\n\n            $(\"#section-cancel_\" + index).show().one('click', function () {\n              createWorkspace('', collectionId, 'edit');\n            });\n          }\n        });\n      });\n    });\n\n    function sortableSections() {\n      $(\"#sortable-section\").sortable();\n    }\n\n    sortableSections();\n\n  });\n}\n\nfunction getTheme(uri) {\n  var parts = uri.split('/');\n  var theme = parts.splice(0, 2);\n  return theme.join('/');\n}\nfunction t1EditorCensus(collectionId, data, templateData) {\n\n  var newBlocks = [], newImage = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n    // Blocks\n    var orderBlocks = $(\"#sortable-block\").sortable('toArray');\n    $(orderBlocks).each(function (indexB, titleB) {\n      if (!data.sections[parseInt(titleB)].title) {\n        var uri = data.sections[parseInt(titleB)].uri;\n        var size = data.sections[parseInt(titleB)].size;\n        var safeUri = checkPathSlashes(uri);\n        newBlocks[indexB] = {uri: safeUri, size: size};\n      } else {\n        var uri = data.sections[parseInt(titleB)].uri;\n        var title = data.sections[parseInt(titleB)].title;\n        var size = data.sections[parseInt(titleB)].size;\n        var image = data.sections[parseInt(titleB)].image;\n        var text = data.sections[parseInt(titleB)].text;\n        newBlocks[indexB] = {uri: uri, title: title, text: text, image: image, size: size};\n      }\n    });\n    data.sections = newBlocks;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n\n}\n\nfunction t2Editor(collectionId, data) {\n\n  var setActiveTab, getActiveTab;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    updateContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    saveAndReviewContent(collectionId, data.uri, JSON.stringify(data));\n  });\n}\n\nfunction t3Editor(collectionId, data) {\n\n  var setActiveTab, getActiveTab;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    updateContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    saveAndReviewContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n}\n\nfunction ArticleDownloadEditor(collectionId, data) {\n\n//  var index = data.release;\n  var newFiles = [], newChart = [], newTable = [], newImage = [], newData = [], newLinks = [], newRelatedQmi = [], newRelatedMethodology = [], newDocuments = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#edition\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.edition = $(this).val();\n  });\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n\n  $(\"#nextRelease\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.nextRelease = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#abstract\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description._abstract = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    }\n    return true;\n  };\n\n  $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n\n    // charts\n    var orderChart = $(\"#sortable-chart\").sortable('toArray');\n    $(orderChart).each(function (indexCh, nameCh) {\n      var uri = data.charts[parseInt(nameCh)].uri;\n      var title = data.charts[parseInt(nameCh)].title;\n      var filename = data.charts[parseInt(nameCh)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.charts = newChart;\n    // tables\n    var orderTable = $(\"#sortable-table\").sortable('toArray');\n    $(orderTable).each(function (indexTable, nameTable) {\n      var uri = data.tables[parseInt(nameTable)].uri;\n      var title = data.tables[parseInt(nameTable)].title;\n      var filename = data.tables[parseInt(nameTable)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.tables = newTable;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n    // External links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      var displayText = data.links[parseInt(nameL)].title;\n      var link = $('#link-uri_' + nameL).val();\n      newLinks[indexL] = {uri: link, title: displayText};\n    });\n    data.links = newLinks;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\n\nfunction articleEditor(collectionId, data) {\n\n  var newChart = [], newTable = [], newEquation = [], newImage = [], newLinks = [], newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#edition\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.edition = $(this).val();\n  });\n\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n\n  $(\"#nextRelease\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.nextRelease = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#abstract\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description._abstract = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n\n  $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // charts\n    var orderChart = $(\"#sortable-chart\").sortable('toArray');\n    $(orderChart).each(function (indexCh, nameCh) {\n      var uri = data.charts[parseInt(nameCh)].uri;\n      var title = data.charts[parseInt(nameCh)].title;\n      var filename = data.charts[parseInt(nameCh)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.charts = newChart;\n    // tables\n    var orderTable = $(\"#sortable-table\").sortable('toArray');\n    $(orderTable).each(function (indexTable, nameTable) {\n      var uri = data.tables[parseInt(nameTable)].uri;\n      var title = data.tables[parseInt(nameTable)].title;\n      var filename = data.tables[parseInt(nameTable)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.tables = newTable;\n    // equations\n    var orderEquation = $(\"#sortable-equation\").sortable('toArray');\n    $(orderEquation).each(function (indexEquation, nameEquation) {\n      var uri = data.equations[parseInt(nameEquation)].uri;\n      var title = data.equations[parseInt(nameEquation)].title;\n      var filename = data.equations[parseInt(nameEquation)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newEquation[indexEquation] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.equations = newEquation;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n    // External links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      var displayText = data.links[parseInt(nameL)].title;\n      var link = $('#link-uri_' + nameL).val();\n      newLinks[indexL] = {uri: link, title: displayText};\n    });\n    data.links = newLinks;\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-pdf\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#pdf-title_' + nameF).val();\n      var file = data.pdfTable[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.pdfTable = newFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction bulletinEditor(collectionId, data) {\n\n    var newChart = [], newTable = [], newEquation = [], newImage = [], newLinks = [], newFiles = [];\n    var setActiveTab, getActiveTab;\n    var renameUri = false;\n\n    $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n        setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n        if (setActiveTab !== false) {\n            Florence.globalVars.activeTab = setActiveTab;\n        }\n    });\n\n    getActiveTab = Florence.globalVars.activeTab;\n    accordion(getActiveTab);\n    getLastPosition();\n\n    // Metadata load, edition and saving\n    $(\"#title\").on('input', function () {\n        renameUri = true;\n        $(this).textareaAutoSize();\n        data.description.title = $(this).val();\n    });\n    $(\"#edition\").on('input', function () {\n        renameUri = true;\n        $(this).textareaAutoSize();\n        data.description.edition = $(this).val();\n    });\n\n    if (!data.description.releaseDate) {\n        $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n        });\n    } else {\n        dateTmp = data.description.releaseDate;\n        var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n        $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n        });\n    }\n\n    $(\"#nextRelease\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.nextRelease = $(this).val();\n    });\n    if (!data.description.contact) {\n        data.description.contact = {};\n    }\n    $(\"#contactName\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.name = $(this).val();\n    });\n    $(\"#contactEmail\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.email = $(this).val();\n    });\n    $(\"#contactTelephone\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.telephone = $(this).val();\n    });\n    $(\"#summary\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.summary = $(this).val();\n    });\n    $(\"#headline1\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.headline1 = $(this).val();\n    });\n    $(\"#headline2\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.headline2 = $(this).val();\n    });\n    $(\"#headline3\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.headline3 = $(this).val();\n    });\n    $(\"#keywordsTag\").tagit({\n        availableTags: data.description.keywords,\n        singleField: true,\n        allowSpaces: true,\n        singleFieldNode: $('#keywords')\n    });\n    $('#keywords').on('change', function () {\n        data.description.keywords = $('#keywords').val().split(',');\n    });\n    $(\"#metaDescription\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.metaDescription = $(this).val();\n    });\n\n    /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n     is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n    var checkBoxStatus = function () {\n        if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n            return false;\n        }\n        return true;\n    };\n\n    $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n        data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n    });\n\n    // Save\n    var editNav = $('.edit-nav');\n    editNav.off(); // remove any existing event handlers.\n\n    editNav.on('click', '.btn-edit-save', function () {\n        save(updateContent);\n    });\n\n    // completed to review\n    editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n        save(saveAndCompleteContent);\n    });\n\n    // reviewed to approve\n    editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n        save(saveAndReviewContent);\n    });\n\n    function save(onSave) {\n\n        Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n        // charts\n        var orderChart = $(\"#sortable-chart\").sortable('toArray');\n        $(orderChart).each(function (indexCh, nameCh) {\n            var uri = data.charts[parseInt(nameCh)].uri;\n            var title = data.charts[parseInt(nameCh)].title;\n            var filename = data.charts[parseInt(nameCh)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.charts = newChart;\n        // tables\n        var orderTable = $(\"#sortable-table\").sortable('toArray');\n        $(orderTable).each(function (indexTable, nameTable) {\n            var uri = data.tables[parseInt(nameTable)].uri;\n            var title = data.tables[parseInt(nameTable)].title;\n            var filename = data.tables[parseInt(nameTable)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.tables = newTable;\n        // equations\n        var orderEquation = $(\"#sortable-equation\").sortable('toArray');\n        $(orderEquation).each(function (indexEquation, nameEquation) {\n            var uri = data.equations[parseInt(nameEquation)].uri;\n            var title = data.equations[parseInt(nameEquation)].title;\n            var filename = data.equations[parseInt(nameEquation)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newEquation[indexEquation] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.equations = newEquation;\n        // images\n        var orderImage = $(\"#sortable-image\").sortable('toArray');\n        $(orderImage).each(function (indexImage, nameImage) {\n            var uri = data.images[parseInt(nameImage)].uri;\n            var title = data.images[parseInt(nameImage)].title;\n            var filename = data.images[parseInt(nameImage)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.images = newImage;\n        // External links\n        var orderLink = $(\"#sortable-link\").sortable('toArray');\n        $(orderLink).each(function (indexL, nameL) {\n            var displayText = data.links[parseInt(nameL)].title;\n            var link = $('#link-uri_' + nameL).val();\n            newLinks[indexL] = {uri: link, title: displayText};\n        });\n        data.links = newLinks;\n        // Files are uploaded. Save metadata\n        var orderFile = $(\"#sortable-pdf\").sortable('toArray');\n        $(orderFile).each(function (indexF, nameF) {\n            var title = $('#pdf-title_' + nameF).val();\n            var file = data.pdfTable[parseInt(nameF)].file;\n            newFiles[indexF] = {title: title, file: file};\n        });\n        data.pdfTable = newFiles;\n\n        checkRenameUri(collectionId, data, renameUri, onSave);\n    }\n}\n\nfunction timeseriesEditor(collectionId, data) {\n\n  var setActiveTab, getActiveTab;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#nextRelease\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.nextRelease = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#number\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.number = $(this).val();\n  });\n  $(\"#keyNote\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.keyNote = $(this).val();\n  });\n  $(\"#unit\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.unit = $(this).val();\n  });\n  $(\"#preUnit\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.preUnit = $(this).val();\n  });\n  $(\"#source\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.source = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n\n  $(\"#metadata-list #natStat input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list #natStat input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  var isIndexStatus = function () {\n    if (data.description.isIndex === true) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  $(\"#metadata-list #isIndex input[type='checkbox']\").prop('checked', isIndexStatus).click(function () {\n    data.description.isIndex = $(\"#metadata-list #isIndex input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    if (Florence.globalVars.welsh) {\n      sweetAlert('You cannot perform this operation in Welsh.');\n    } else {\n      Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n      updateContent(collectionId, data.uri, JSON.stringify(data));\n    }\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    if (Florence.globalVars.welsh) {\n      sweetAlert('You cannot perform this operation in Welsh.');\n    } else {\n      Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n      saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data));\n    }\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n    saveAndReviewContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n}\n\nfunction compendiumChapterEditor(collectionId, data) {\n\n    var newChart = [], newTable = [], newEquation = [], newImage = [], newLinks = [];\n    var parentUrl = getParentPage(data.uri);\n    var setActiveTab, getActiveTab;\n\n    //Add parent link onto page\n    loadParentLink(collectionId, data, parentUrl);\n\n    $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n        setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n        if (setActiveTab !== false) {\n            Florence.globalVars.activeTab = setActiveTab;\n        }\n    });\n\n    getActiveTab = Florence.globalVars.activeTab;\n    accordion(getActiveTab);\n    getLastPosition();\n\n    // Metadata edition and saving\n    $(\"#title\").on('input', function () {\n        $(this).textareaAutoSize();\n        sweetAlert(\"Cannot remame this page here\", \"Go back to parent page and use the rename function there\");\n    });\n    $(\"#headline\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.headline = $(this).val();\n    });\n    if (!data.description.releaseDate) {\n        $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n        });\n    } else {\n        dateTmp = data.description.releaseDate;\n        var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n        $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n        });\n    }\n    $(\"#nextRelease\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.nextRelease = $(this).val();\n    });\n    if (!data.description.contact) {\n        data.description.contact = {};\n    }\n    $(\"#contactName\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.name = $(this).val();\n    });\n    $(\"#contactEmail\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.email = $(this).val();\n    });\n    $(\"#contactTelephone\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.telephone = $(this).val();\n    });\n    $(\"#abstract\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description._abstract = $(this).val();\n    });\n    $(\"#keywordsTag\").tagit({\n        availableTags: data.description.keywords,\n        singleField: true,\n        allowSpaces: true,\n        singleFieldNode: $('#keywords')\n    });\n    $('#keywords').on('change', function () {\n        data.description.keywords = $('#keywords').val().split(',');\n    });\n    $(\"#metaDescription\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.metaDescription = $(this).val();\n    });\n\n    /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n     is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n    var checkBoxStatus = function () {\n        if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n            return false;\n        } else {\n            return true;\n        }\n    };\n\n    $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n        data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n    });\n\n    // Save\n    var editNav = $('.edit-nav');\n    editNav.off(); // remove any existing event handlers.\n\n    editNav.on('click', '.btn-edit-save', function () {\n        save();\n        updateContent(collectionId, data.uri, JSON.stringify(data));\n    });\n\n    // completed to review\n    editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n        save();\n        saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data), false, parentUrl);\n    });\n\n    // reviewed to approve\n    editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n        save();\n        saveAndReviewContent(collectionId, data.uri, JSON.stringify(data), false, parentUrl);\n    });\n\n\n    function save() {\n\n        Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n        // charts\n        var orderChart = $(\"#sortable-chart\").sortable('toArray');\n        $(orderChart).each(function (indexCh, nameCh) {\n            var uri = data.charts[parseInt(nameCh)].uri;\n            var title = data.charts[parseInt(nameCh)].title;\n            var filename = data.charts[parseInt(nameCh)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.charts = newChart;\n\n        // tables\n        var orderTable = $(\"#sortable-table\").sortable('toArray');\n        $(orderTable).each(function (indexTable, nameTable) {\n            var uri = data.tables[parseInt(nameTable)].uri;\n            var title = data.tables[parseInt(nameTable)].title;\n            var filename = data.tables[parseInt(nameTable)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.tables = newTable;\n        var orderEquation = $(\"#sortable-equation\").sortable('toArray');\n        $(orderEquation).each(function (indexEquation, nameEquation) {\n            var uri = data.equations[parseInt(nameEquation)].uri;\n            var title = data.equations[parseInt(nameEquation)].title;\n            var filename = data.equations[parseInt(nameEquation)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newEquation[indexEquation] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.equations = newEquation;\n        // images\n        var orderImage = $(\"#sortable-image\").sortable('toArray');\n        $(orderImage).each(function (indexImage, nameImage) {\n            var uri = data.images[parseInt(nameImage)].uri;\n            var title = data.images[parseInt(nameImage)].title;\n            var filename = data.images[parseInt(nameImage)].filename;\n            var safeUri = checkPathSlashes(uri);\n            newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n        });\n        data.images = newImage;\n\n        // External links\n        var orderLink = $(\"#sortable-link\").sortable('toArray');\n        $(orderLink).each(function (indexL, nameL) {\n            var displayText = data.links[parseInt(nameL)].title;\n            var link = $('#link-uri_' + nameL).val();\n            newLinks[indexL] = {uri: link, title: displayText};\n        });\n        data.links = newLinks;\n    }\n}\n\nfunction compendiumDataEditor(collectionId, data) {\n\n    var newFiles = [];\n    var parentUrl = getParentPage(data.uri);\n    var setActiveTab, getActiveTab;\n\n    //Add parent link onto page\n    loadParentLink(collectionId, data, parentUrl);\n\n    $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n        setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n        if (setActiveTab !== false) {\n            Florence.globalVars.activeTab = setActiveTab;\n        }\n    });\n\n    getActiveTab = Florence.globalVars.activeTab;\n    accordion(getActiveTab);\n    getLastPosition();\n\n    // Metadata edition and saving\n    $(\"#title\").on('input', function () {\n        $(this).textareaAutoSize();\n        sweetAlert(\"Cannot remame this page here\", \"Go back to parent page and use the rename function there\");\n    });\n    $(\"#summary\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.summary = $(this).val();\n    });\n    //if (!Florence.collection.date) {                    //overwrite scheduled collection date\n    if (!data.description.releaseDate) {\n        $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n        });\n    } else {\n        dateTmp = data.description.releaseDate;\n        var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n        $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n            data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n        });\n    }\n    //} else {\n    //    $('.release-date').hide();\n    //}\n    $(\"#nextRelease\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.nextRelease = $(this).val();\n    });\n    if (!data.description.contact) {\n        data.description.contact = {};\n    }\n    $(\"#contactName\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.name = $(this).val();\n    });\n    $(\"#contactEmail\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.email = $(this).val();\n    });\n    $(\"#contactTelephone\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.contact.telephone = $(this).val();\n    });\n    $(\"#datasetId\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.datasetId = $(this).val();\n    });\n    $(\"#keywordsTag\").tagit({\n        availableTags: data.description.keywords,\n        singleField: true,\n        allowSpaces: true,\n        singleFieldNode: $('#keywords')\n    });\n    $('#keywords').on('change', function () {\n        data.description.keywords = $('#keywords').val().split(',');\n    });\n    $(\"#metaDescription\").on('input', function () {\n        $(this).textareaAutoSize();\n        data.description.metaDescription = $(this).val();\n    });\n\n    /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n     is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n    var checkBoxStatus = function () {\n        if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n            return false;\n        } else {\n            return true;\n        }\n    };\n    $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n        data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n    });\n\n    // Save\n    var editNav = $('.edit-nav');\n    editNav.off(); // remove any existing event handlers.\n\n    editNav.on('click', '#save', function () {\n        save();\n        updateContent(collectionId, data.uri, JSON.stringify(data));\n    });\n\n    // completed to review\n    editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n        //pageData = $('.fl-editor__headline').val();\n        save();\n        saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data), parentUrl);\n    });\n\n    // reviewed to approve\n    editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n        save();\n        saveAndReviewContent(collectionId, data.uri, JSON.stringify(data), parentUrl);\n    });\n\n    function save() {\n\n        Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n        // Files are uploaded. Save metadata\n        var orderFile = $(\"#sortable-file\").sortable('toArray');\n        $(orderFile).each(function (indexF, nameF) {\n            var title = $('#file-title_' + nameF).val();\n            var fileDescription = $(\"#file-summary_\" + nameF).val();\n            var file = data.downloads[parseInt(nameF)].file;\n            newFiles[indexF] = {title: title, fileDescription: fileDescription, file: file};\n        });\n        data.downloads = newFiles;\n    }\n}\n\nfunction compendiumEditor(collectionId, data, templateData) {\n\n//  var index = data.release;\n  var newChapters = [];\n  var lastIndexChapter, lastIndexDataset;\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  resolveTitleT6(collectionId, data, templateData, 'chapters');\n  resolveTitleT6(collectionId, data, templateData, 'datasets');\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#edition\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.edition = $(this).val();\n  });\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  $(\"#nextRelease\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.nextRelease = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#headline\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.headline = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    }\n    return true;\n  };\n\n  $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  //Add new chapter\n  $(\"#add-chapter\").one('click', function () {\n    var chapterTitle;\n    $('#sortable-chapter').append(\n      '<div id=\"' + lastIndexChapter + '\" class=\"edit-section__sortable-item\">' +\n      '<textarea class=\"auto-size\" id=\"new-chapter-title\" placeholder=\"Type title here and click add\"></textarea>' +\n      '<div class=\"edit-section__buttons\">' +\n      '<button class=\"btn-markdown-edit\" id=\"chapter-add\">Edit chapter</button>' +\n      '</div>' +\n      '</div>');\n    $('#new-chapter-title').on('input', function () {\n      $(this).textareaAutoSize();\n      chapterTitle = $(this).val();\n    });\n    $('#chapter-add').on('click', function () {\n      if (chapterTitle.length < 5) {\n        sweetAlert(\"This is not a valid file title\");\n        return true;\n      } else {\n        loadT6Creator(collectionId, data.description.releaseDate, 'compendium_chapter', data.uri, chapterTitle);\n      }\n    });\n  });\n\n  //Add new table (only one per compendium)\n  if (!data.datasets || data.datasets.length === 0) {\n    $(\"#add-compendium-data\").one('click', function () {\n      var tableTitle;\n      $('#sortable-compendium-data').append(\n        '<div id=\"' + lastIndexDataset + '\" class=\"edit-section__item\">' +\n        '<textarea class=\"auto-size\" id=\"new-compendium-data-title\" placeholder=\"Type title here and click add\"></textarea>' +\n        '<div class=\"edit-section__buttons\">' +\n        '<button class=\"btn-markdown-edit\" id=\"compendium-data-add\">Edit data</button>' +\n        '</div>' +\n        '</div>');\n      $('#new-compendium-data-title').on('input', function () {\n        $(this).textareaAutoSize();\n        tableTitle = $(this).val();\n      });\n      $('#compendium-data-add').on('click', function () {\n        if (tableTitle.length < 5) {\n          sweetAlert(\"This is not a valid file title\");\n          return true;\n        } else {\n          loadT6Creator(collectionId, data.description.releaseDate, 'compendium_data', data.uri, tableTitle);\n        }\n      });\n    });\n  } else {\n    $('#add-compendium-data').hide().one('click', function () {\n      sweetAlert('At the moment you can have one section here.');\n    });\n  }\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Chapters\n    var orderRelatedChapter = $(\"#sortable-chapter\").sortable('toArray');\n    $(orderRelatedChapter).each(function (indexC, nameC) {\n      var uri = data.chapters[parseInt(nameC)].uri;\n      var safeUri = checkPathSlashes(uri);\n      newChapters[indexC] = {uri: safeUri};\n    });\n    data.chapters = newChapters;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction resolveTitleT6(collectionId, data, templateData, field) {\n  var ajaxRequest = [];\n  $(templateData[field]).each(function (index, path) {\n    templateData[field][index].description = {};\n    var eachUri = path.uri;\n    var dfd = $.Deferred();\n    getPageDataTitle(collectionId, eachUri,\n      function (response) {\n        templateData[field][index].description.title = response.title;\n        dfd.resolve();\n      },\n      function () {\n        sweetAlert(\"Error\", field + ' address: ' + eachUri + ' is not found.', \"error\");\n        dfd.resolve();\n      }\n    );\n    ajaxRequest.push(dfd);\n  });\n\n  $.when.apply($, ajaxRequest).then(function () {\n    var dataTemplate = templateData[field];\n    if (field === 'datasets') {\n      var html = templates.workEditT6Dataset(dataTemplate);\n    } else {\n      var html = templates.workEditT6Chapter(dataTemplate);\n    }\n    $('#' + field).replaceWith(html);\n\n    if (field === 'datasets') {\n      editData(collectionId, data);\n    } else {\n      editChapters(collectionId, data);\n    }\n  });\n}\n\nfunction editChapters(collectionId, data) {\n  // Edit chapters\n  // Load chapter to edit\n  $(data.chapters).each(function (index) {\n    lastIndexChapter = index + 1;\n\n    //open document\n    $(\"#chapter-edit_\" + index).click(function () {\n      var selectedChapter = data.chapters[index].uri;\n      createWorkspace(selectedChapter, collectionId, 'edit');\n    });\n\n    $('#chapter-edit-label_' + index).click(function () {\n      var selectedChapter = data.chapters[index].uri;\n      getPageData(collectionId, selectedChapter,\n        function (pageData) {\n          var markdown = pageData.description.title;\n          var editedSectionValue = {title: 'Compendium chapter title', markdown: markdown};\n          var saveContent = function (updatedContent) {\n            pageData.description.title = updatedContent;\n            var childTitle = updatedContent.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            putContent(collectionId, pageData.uri, JSON.stringify(pageData),\n              function () {\n                //save children change and move\n                checkRenameUri(collectionId, pageData, true, updateContent);\n                putContent(collectionId, data.uri, JSON.stringify(data),\n                  function () {\n                    // on success update dataset uri in parent and save\n                    data.chapters[index].uri = data.uri + \"/\" + childTitle;\n                  },\n                  function (response) {\n                    if (response.status === 409) {\n                      sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                    } else {\n                      handleApiError(response);\n                    }\n                  }\n                );\n              },\n              function (message) {\n                if (message.status === 400) {\n                  sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                }\n                else {\n                  handleApiError(message);\n                }\n              }\n            );\n          };\n          loadMarkdownEditor(editedSectionValue, saveContent, pageData);\n        },\n        function (message) {\n          handleApiError(message);\n        }\n      );\n    });\n\n    // Delete\n    $(\"#chapter-delete_\" + index).click(function () {\n      swal({\n        title: \"Warning\",\n        text: \"You are going to delete the chapter this link refers to. Are you sure you want to proceed?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Continue\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function (result) {\n        if (result === true) {\n          var selectedChapter = data.chapters[index].uri;\n          var path = data.uri;\n          $(\"#\" + index).remove();\n          data.chapters.splice(index, 1);\n          putContent(collectionId, path, JSON.stringify(data),\n            function () {\n              swal({\n                title: \"Deleted\",\n                text: \"This file has been deleted\",\n                type: \"success\",\n                timer: 2000\n              });\n              Florence.Editor.isDirty = false;\n              deleteContent(collectionId, selectedChapter, function () {\n                refreshPreview(path);\n                loadPageDataIntoEditor(path, collectionId);\n              }, error);\n            },\n            function (response) {\n              if (response.status === 400) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n              }\n              else {\n                handleApiError(response);\n              }\n            }\n          );\n        }\n      });\n    });\n  });\n\n  function sortableSections() {\n    $(\"#sortable-chapter\").sortable();\n  }\n\n  sortableSections();\n}\n\nfunction editData(collectionId, data) {\n  // Edit data reference table\n  // Load table to edit\n  if (!data.datasets || data.datasets.length === 0) {\n    lastIndexDataset = 0;\n  } else {\n    $(data.datasets).each(function (index) {\n      //open document\n      var selectedData = data.datasets[index].uri;\n      $(\"#compendium-data-edit_\" + index).click(function () {\n        refreshPreview(selectedData);\n        viewWorkspace(selectedData, collectionId, 'edit');\n      });\n\n      $('#compendium-data-edit-label_' + index).click(function () {\n        getPageData(collectionId, selectedData,\n          function (pageData) {\n            var markdown = pageData.description.title;\n            var editedSectionValue = {title: 'Compendium dataset title', markdown: markdown};\n            var saveContent = function (updatedContent) {\n              pageData.description.title = updatedContent;\n              var childTitle = updatedContent.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n              putContent(collectionId, pageData.uri, JSON.stringify(pageData),\n                function () {\n                  //save children changes\n                  //move\n                  checkRenameUri(collectionId, pageData, true, updateContent);\n                  putContent(collectionId, data.uri, JSON.stringify(data),\n                    function () {\n                      // on success update dataset uri in parent and save\n                      data.datasets[index].uri = data.uri + \"/\" + childTitle;\n                    },\n                    function (response) {\n                      if (response.status === 409) {\n                        sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                      } else {\n                        handleApiError(response);\n                      }\n                    }\n                  );\n                },\n                function (message) {\n                  if (message.status === 400) {\n                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                  }\n                  else {\n                    handleApiError(message);\n                  }\n                }\n              );\n            };\n            loadMarkdownEditor(editedSectionValue, saveContent, pageData);\n          },\n          function (message) {\n            handleApiError(message);\n          }\n        );\n      });\n\n      // Delete\n      $(\"#compendium-data-delete_\" + index).click(function () {\n        //var result = confirm(\"You are going to delete the chapter this link refers to. Are you sure you want to proceed?\");\n        swal({\n          title: \"Warning\",\n          text: \"You are going to delete the chapter this link refers to. Are you sure you want to proceed?\",\n          type: \"warning\",\n          showCancelButton: true,\n          confirmButtonText: \"Delete\",\n          cancelButtonText: \"Cancel\",\n          closeOnConfirm: false\n        }, function (result) {\n          if (result === true) {\n            var selectedData = data.datasets[index].uri;\n            var path = data.uri;\n            $(\"#\" + index).remove();\n            data.datasets.splice(index, 1);\n            putContent(collectionId, path, JSON.stringify(data),\n              function () {\n                swal({\n                  title: \"Deleted\",\n                  text: \"This file has been deleted\",\n                  type: \"success\",\n                  timer: 2000\n                });\n                Florence.Editor.isDirty = false;\n                deleteContent(collectionId, selectedData, function () {\n                  refreshPreview(path);\n                  loadPageDataIntoEditor(path, collectionId);\n                }, error);\n              },\n              function (response) {\n                if (response.status === 400) {\n                  sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                }\n                else {\n                  handleApiError(response);\n                }\n              }\n            );\n          }\n        });\n      });\n    });\n  }\n}\n\nfunction adHocEditor(collectionId, data) {\n\n  var newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  $(\"#metadata-f\").remove();\n  $(\"#metadata-md\").remove();\n  $(\"#metadata-q\").remove();\n  $(\"#metadata-s\").remove();\n  $(\"#summary-p\").remove();\n  $(\"#contact-p\").remove();\n  $(\"#natStat\").remove();\n  $(\"#survey-p\").remove();\n  $(\"#frequency-p\").remove();\n  $(\"#compilation-p\").remove();\n  $(\"#geoCoverage-p\").remove();\n  $(\"#sampleSize-p\").remove();\n  $(\".lastRevised-p\").remove();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  //if (!Florence.collection.date) {                    //overwrite scheduled collection date\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  //} else {\n  //    $('.release-date').hide();\n  //}\n  $(\"#reference\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    var isNumber = $(this).val();\n    if (isNumber.match(/^\\d+$/)) {\n      data.description.reference = isNumber;\n    } else {\n      sweetAlert('This needs to be a number');\n    }\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction foiEditor(collectionId, data) {\n\n  var newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  $(\"#metadata-ad\").remove();\n  $(\"#metadata-md\").remove();\n  $(\"#metadata-q\").remove();\n  $(\"#metadata-s\").remove();\n  $(\"#summary-p\").remove();\n  $(\"#contact-p\").remove();\n  $(\"#natStat\").remove();\n  $(\"#survey-p\").remove();\n  $(\"#frequency-p\").remove();\n  $(\"#compilation-p\").remove();\n  $(\"#geoCoverage-p\").remove();\n  $(\"#sampleSize-p\").remove();\n  $(\".lastRevised-p\").remove();\n  $(\"#reference-p\").remove();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  //if (!Florence.collection.date) {                    //overwrite scheduled collection date\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  //} else {\n  //    $('.release-date').hide();\n  //}\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction methodologyDownloadEditor(collectionId, data) {\n\n  var newFiles = [], newPdfFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  $(\"#metadata-ad\").remove();\n  $(\"#metadata-f\").remove();\n  $(\"#metadata-q\").remove();\n  $(\"#metadata-s\").remove();\n  $(\"#summary-p\").remove();\n  $(\"#natStat\").remove();\n  $(\"#survey-p\").remove();\n  $(\"#frequency-p\").remove();\n  $(\"#compilation-p\").remove();\n  $(\"#geoCoverage-p\").remove();\n  $(\"#sampleSize-p\").remove();\n  $(\".lastRevised-p\").remove();\n  $(\"#reference-p\").remove();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n    // PDF files are uploaded. Save metadata\n    var orderPdfFile = $(\"#sortable-pdfFile\").sortable('toArray');\n    $(orderPdfFile).each(function (indexP, nameP) {\n      var pdfTitle = $('#pdfFile-title_' + nameP).val();\n      var pdfFile = data.pdfDownloads[parseInt(nameP)].file;\n      newPdfFiles[indexP] = {title: pdfTitle, file: pdfFile};\n    });\n    data.pdfDownloads = newPdfFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\n\nfunction methodologyEditor(collectionId, data) {\n\n  var newChart = [], newTable = [], newEquation = [], newImage = [], newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  //if (!Florence.collection.date) {                        //overwrite scheduled collection date\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    //dateTmp = $('#releaseDate').val();\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  //} else {\n  //    $('.release-date').hide();\n  //}\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // charts\n    var orderChart = $(\"#sortable-chart\").sortable('toArray');\n    $(orderChart).each(function (indexCh, nameCh) {\n      var uri = data.charts[parseInt(nameCh)].uri;\n      var title = data.charts[parseInt(nameCh)].title;\n      var filename = data.charts[parseInt(nameCh)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.charts = newChart;\n    // tables\n    var orderTable = $(\"#sortable-table\").sortable('toArray');\n    $(orderTable).each(function (indexTable, nameTable) {\n      var uri = data.tables[parseInt(nameTable)].uri;\n      var title = data.tables[parseInt(nameTable)].title;\n      var filename = data.tables[parseInt(nameTable)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.tables = newTable;\n    // equations\n    var orderEquation = $(\"#sortable-equation\").sortable('toArray');\n    $(orderEquation).each(function (indexEquation, nameEquation) {\n      var uri = data.equations[parseInt(nameEquation)].uri;\n      var title = data.equations[parseInt(nameEquation)].title;\n      var filename = data.equations[parseInt(nameEquation)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newEquation[indexEquation] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.equations = newEquation;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction qmiEditor(collectionId, data) {\n\n  var newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  $(\"#metadata-ad\").remove();\n  $(\"#metadata-f\").remove();\n  $(\"#metadata-md\").remove();\n  $(\"#metadata-s\").remove();\n  $(\"#summary-p\").remove();\n  $(\".release-date\").remove();\n  $(\"#reference-p\").remove();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#survey\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.surveyName = $(this).val();\n  });\n  $(\"#frequency\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.frequency = $(this).val();\n  });\n  $(\"#compilation\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.compilation = $(this).val();\n  });\n  $(\"#geoCoverage\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.geographicCoverage = $(this).val();\n  });\n  $(\"#sampleSize\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.sampleSize = $(this).val();\n  });\n  if (!data.description.lastRevised) {\n    $('#lastRevised').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.lastRevised = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.lastRevised;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#lastRevised').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.lastRevised = new Date($('#lastRevised').datepicker('getDate')).toISOString();\n    });\n  }\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    }\n    return true;\n  };\n\n  $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction staticArticleEditor(collectionId, data) {\n\n  var newChart = [], newTable = [], newEquation = [], newImage = [], newLinks = [], newFiles = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Metadata load, edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  //if (!Florence.collection.date) {                        //overwrite scheduled collection date\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    //dateTmp = $('#releaseDate').val();\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  //} else {\n  //    $('.release-date').hide();\n  //}\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // charts\n    var orderChart = $(\"#sortable-chart\").sortable('toArray');\n    $(orderChart).each(function (indexCh, nameCh) {\n      var uri = data.charts[parseInt(nameCh)].uri;\n      var title = data.charts[parseInt(nameCh)].title;\n      var filename = data.charts[parseInt(nameCh)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.charts = newChart;\n    // tables\n    var orderTable = $(\"#sortable-table\").sortable('toArray');\n    $(orderTable).each(function (indexTable, nameTable) {\n      var uri = data.tables[parseInt(nameTable)].uri;\n      var title = data.tables[parseInt(nameTable)].title;\n      var filename = data.tables[parseInt(nameTable)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.tables = newTable;\n    // equations\n    var orderEquation = $(\"#sortable-equation\").sortable('toArray');\n    $(orderEquation).each(function (indexEquation, nameEquation) {\n      var uri = data.equations[parseInt(nameEquation)].uri;\n      var title = data.equations[parseInt(nameEquation)].title;\n      var filename = data.equations[parseInt(nameEquation)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newEquation[indexEquation] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.equations = newEquation;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n    // links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      if (data.links[parseInt(nameL)].title) {\n        var name = data.links[parseInt(nameL)].title;\n        var link = data.links[parseInt(nameL)].uri;\n        newLinks[indexL] = {uri: link, title: name};\n      } else {\n        var link = data.links[parseInt(nameL)].uri;\n        newLinks[indexL] = {uri: link};\n      }\n    });\n    data.links = newLinks;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction staticLandingPageEditor(collectionId, data) {\n\n  var newSections = [], newLinks = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Edit content\n  // Load and edition\n  $(data.sections).each(function (index) {\n\n    $('#section-uri_' + index).on('paste', function () {\n      setTimeout(function () {\n        var pastedUrl = $('#section-uri_' + index).val();\n        var safeUrl = checkPathParsed(pastedUrl);\n        $('#section-uri_' + index).val(safeUrl);\n      }, 50);\n    });\n\n    if (!$('#section-uri_' + index).val()) {\n      $('<button class=\"btn-edit-save-and-submit-for-review\" id=\"section-get_' + index + '\">Go to</button>').insertAfter('#section-uri_' + index);\n\n      $('#section-get_' + index).click(function () {\n        var iframeEvent = document.getElementById('iframe').contentWindow;\n        iframeEvent.removeEventListener('click', Florence.Handler, true);\n        createWorkspace(data.uri, collectionId, '', null, true);\n        $('#section-get_' + index).html('Copy link').off().one('click', function () {\n          var uriCheck = getPathNameTrimLast();\n          var uriChecked = checkPathSlashes(uriCheck);\n          data.sections[index].uri = uriChecked;\n          putContent(collectionId, data.uri, JSON.stringify(data),\n            success = function (response) {\n              console.log(\"Updating completed \" + response);\n              Florence.Editor.isDirty = false;\n              viewWorkspace(data.uri, collectionId, 'edit');\n              refreshPreview(data.uri);\n              var iframeEvent = document.getElementById('iframe').contentWindow;\n              iframeEvent.addEventListener('click', Florence.Handler, true);\n            },\n            error = function (response) {\n              if (response.status === 400) {\n                  sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n              }\n              else {\n                handleApiError(response);\n              }\n            }\n          );\n        });\n      });\n    }\n\n    $(\"#section-edit_\" + index).click(function () {\n      var editedSectionValue = {\n        \"title\": $('#section-title_' + index).val(),\n        \"markdown\": $(\"#section-markdown_\" + index).val()\n      };\n\n      var saveContent = function (updatedContent) {\n        data.sections[index].summary = updatedContent;\n        data.sections[index].title = $('#section-title_' + index).val();\n        data.sections[index].uri = $('#section-uri_' + index).val();\n        updateContent(collectionId, data.uri, JSON.stringify(data));\n      };\n\n      loadMarkdownEditor(editedSectionValue, saveContent, data);\n    });\n\n    // Delete\n    $(\"#section-delete_\" + index).click(function () {\n      swal ({\n        title: \"Warning\",\n        text: \"Are you sure you want to delete?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function(result) {\n        if (result === true) {\n          $(\"#\" + index).remove();\n          data.sections.splice(index, 1);\n          updateContent(collectionId, data.uri, JSON.stringify(data));\n          swal({\n            title: \"Deleted\",\n            text: \"This section has been deleted\",\n            type: \"success\",\n            timer: 2000\n          });\n        }\n      });\n    });\n\n      // Tooltips\n    $(function () {\n      $('#section-uri_' + index).tooltip({\n        items: '#section-uri_' + index,\n        content: 'Copy link or click Go to, navigate to page and click Copy link. Then add a title and click Edit',\n        show: \"slideDown\", // show immediately\n        open: function (event, ui) {\n          ui.tooltip.hover(\n            function () {\n              $(this).fadeTo(\"slow\", 0.5);\n            });\n        }\n      });\n    });\n\n    $(function () {\n      $('#section-title_' + index).tooltip({\n        items: '#section-title_' + index,\n        content: 'Type a title and click Edit',\n        show: \"slideDown\", // show immediately\n        open: function (event, ui) {\n          ui.tooltip.hover(\n            function () {\n              $(this).fadeTo(\"slow\", 0.5);\n            });\n        }\n      });\n    });\n  });\n\n  //Add new content\n  $(\"#add-section\").one('click', function () {\n    swal ({\n      title: \"Warning\",\n      text: \"If you do not come back to this page, you will lose any unsaved changes\",\n      type: \"warning\",\n      showCancelButton: true,\n      confirmButtonText: \"Continue\",\n      cancelButtonText: \"Cancel\"\n    }, function(result) {\n      if (result === true) {\n        data.sections.push({uri: \"\", title: \"\", summary: \"\"});\n        updateContent(collectionId, data.uri, JSON.stringify(data));\n      } else {\n        loadPageDataIntoEditor(data.uri, collectionId);\n      }\n    });\n  });\n\n  function sortableContent() {\n    $(\"#sortable-section\").sortable();\n  }\n\n  sortableContent();\n\n  renderExternalLinkAccordionSection(collectionId, data, 'links', 'link');\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Sections\n    var orderSection = $(\"#sortable-section\").sortable('toArray');\n    $(orderSection).each(function (indexS, nameS) {\n      var summary = data.sections[parseInt(nameS)].summary;\n        // Fixes title or uri not saving unless markdown edited\n        var title = $('#section-title_' + nameS).val();\n        var uri = $('#section-uri_' + nameS).val();\n      //var title = data.sections[parseInt(nameS)].title;\n      //var uri = data.sections[parseInt(nameS)].uri;\n      var uriChecked = checkPathSlashes(uri);\n      newSections[indexS] = {uri: uriChecked, title: title, summary: summary};\n    });\n    data.sections = newSections;\n    // External links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      var displayText = data.links[parseInt(nameL)].title;\n      var link = $('#link-uri_' + nameL).val();\n      newLinks[indexL] = {uri: link, title: displayText};\n    });\n    data.links = newLinks;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction staticPageEditor(collectionId, data) {\n\n  var newLinks = [], newFiles = [], newChart = [], newTable = [], newImage = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n\n  $(\"#metadata-ad\").remove();\n  $(\"#metadata-f\").remove();\n  $(\"#metadata-md\").remove();\n  $(\"#metadata-q\").remove();\n  $(\"#contact-p\").remove();\n  $(\"#natStat\").remove();\n  $(\"#survey-p\").remove();\n  $(\"#frequency-p\").remove();\n  $(\"#compilation-p\").remove();\n  $(\"#geoCoverage-p\").remove();\n  $(\"#sampleSize-p\").remove();\n  $(\".lastRevised-p\").remove();\n  $(\"#reference-p\").remove();\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n    // Sections\n    data.markdown = [$('#content-markdown').val()];\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-file\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#file-title_' + nameF).val();\n      var file = data.downloads[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.downloads = newFiles;\n    // charts\n    var orderChart = $(\"#sortable-chart\").sortable('toArray');\n    $(orderChart).each(function (indexCh, nameCh) {\n      var uri = data.charts[parseInt(nameCh)].uri;\n      var title = data.charts[parseInt(nameCh)].title;\n      var filename = data.charts[parseInt(nameCh)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newChart[indexCh] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.charts = newChart;\n    // tables\n    var orderTable = $(\"#sortable-table\").sortable('toArray');\n    $(orderTable).each(function (indexTable, nameTable) {\n      var uri = data.tables[parseInt(nameTable)].uri;\n      var title = data.tables[parseInt(nameTable)].title;\n      var filename = data.tables[parseInt(nameTable)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newTable[indexTable] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.tables = newTable;\n    // images\n    var orderImage = $(\"#sortable-image\").sortable('toArray');\n    $(orderImage).each(function (indexImage, nameImage) {\n      var uri = data.images[parseInt(nameImage)].uri;\n      var title = data.images[parseInt(nameImage)].title;\n      var filename = data.images[parseInt(nameImage)].filename;\n      var safeUri = checkPathSlashes(uri);\n      newImage[indexImage] = {uri: safeUri, title: title, filename: filename};\n    });\n    data.images = newImage;\n    // links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      if (data.links[parseInt(nameL)].title) {\n        var name = data.links[parseInt(nameL)].title;\n        var link = data.links[parseInt(nameL)].uri;\n        newLinks[indexL] = {uri: link, title: name};\n      } else {\n        var link = data.links[parseInt(nameL)].uri;\n        newLinks[indexL] = {uri: link};\n      }\n    });\n    data.links = newLinks;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction datasetEditor(collectionId, data) {\n\n  var newFiles = [];\n  var setActiveTab, getActiveTab;\n  var parentUrl = getParentPage(data.uri);\n\n  //Add parent link onto page\n  loadParentLink(collectionId, data, parentUrl);\n\n\n  $(\".edit-accordion\").on('accordionactivate', function () {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save();\n    updateContent(collectionId, data.uri, JSON.stringify(data));\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    //pageData = $('.fl-editor__headline').val();\n    save();\n    saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data), false, parentUrl);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save();\n    saveAndReviewContent(collectionId, data.uri, JSON.stringify(data), false, parentUrl);\n  });\n\n  function save() {\n    // Files are uploaded. Save metadata\n    var orderFile = $(\"#sortable-supplementary-files\").sortable('toArray');\n    $(orderFile).each(function (indexF, nameF) {\n      var title = $('#supplementary-files-title_' + nameF).val();\n      var file = data.supplementaryFiles[parseInt(nameF)].file;\n      newFiles[indexF] = {title: title, file: file};\n    });\n    data.supplementaryFiles = newFiles;\n    // Notes\n    data.section = {markdown: $('#one-markdown').val()};\n  }\n}function datasetLandingEditor(collectionId, data) {\n\n  var newDatasets = [], newLinks = [], newRelatedDocuments = [], newRelatedQmi = [], newRelatedMethodology = [];\n  var setActiveTab, getActiveTab;\n  var renameUri = false;\n\n  $(\".edit-accordion\").on('accordionactivate', function (event, ui) {\n    setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n    if (setActiveTab !== false) {\n      Florence.globalVars.activeTab = setActiveTab;\n    }\n  });\n\n  getActiveTab = Florence.globalVars.activeTab;\n  accordion(getActiveTab);\n  getLastPosition();\n\n  resolveTitleT8(collectionId, data, 'datasets');\n\n  // Metadata edition and saving\n  $(\"#title\").on('input', function () {\n    renameUri = true;\n    $(this).textareaAutoSize();\n    data.description.title = $(this).val();\n  });\n  $(\"#summary\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.summary = $(this).val();\n  });\n  //if (!Florence.collection.date) {                      //overwrite scheduled collection date\n  if (!data.description.releaseDate) {\n    $('#releaseDate').datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($(this).datepicker({dateFormat: 'dd MM yy'})[0].value).toISOString();\n    });\n  } else {\n    dateTmp = data.description.releaseDate;\n    var dateTmpFormatted = $.datepicker.formatDate('dd MM yy', new Date(dateTmp));\n    $('#releaseDate').val(dateTmpFormatted).datepicker({dateFormat: 'dd MM yy'}).on('change', function () {\n      data.description.releaseDate = new Date($('#releaseDate').datepicker('getDate')).toISOString();\n    });\n  }\n  //} else {\n  //    $('.release-date').hide();\n  //}\n  $(\"#nextRelease\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.nextRelease = $(this).val();\n  });\n  if (!data.description.contact) {\n    data.description.contact = {};\n  }\n  $(\"#contactName\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.name = $(this).val();\n  });\n  $(\"#contactEmail\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.email = $(this).val();\n  });\n  $(\"#contactTelephone\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.contact.telephone = $(this).val();\n  });\n  $(\"#datasetId\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.datasetId = $(this).val();\n  });\n  $(\"#keywordsTag\").tagit({\n    availableTags: data.description.keywords,\n    singleField: true,\n    allowSpaces: true,\n    singleFieldNode: $('#keywords')\n  });\n  $('#keywords').on('change', function () {\n    data.description.keywords = $('#keywords').val().split(',');\n  });\n  $(\"#metaDescription\").on('input', function () {\n    $(this).textareaAutoSize();\n    data.description.metaDescription = $(this).val();\n  });\n\n  /* The checked attribute is a boolean attribute, which means the corresponding property is true if the attribute\n   is present at all—even if, for example, the attribute has no value or is set to empty string value or even \"false\" */\n  var checkBoxStatus = function () {\n    if (data.description.nationalStatistic === \"false\" || data.description.nationalStatistic === false) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n  $(\"#metadata-list input[type='checkbox']\").prop('checked', checkBoxStatus).click(function () {\n    data.description.nationalStatistic = $(\"#metadata-list input[type='checkbox']\").prop('checked') ? true : false;\n  });\n\n  // Save\n  var editNav = $('.edit-nav');\n  editNav.off(); // remove any existing event handlers.\n\n  editNav.on('click', '.btn-edit-save', function () {\n    save(updateContent);\n  });\n\n  // completed to review\n  editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n    save(saveAndCompleteContent);\n  });\n\n  // reviewed to approve\n  editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n    save(saveAndReviewContent);\n  });\n\n  function save(onSave) {\n\n    Florence.globalVars.pagePos = $(\".workspace-edit\").scrollTop();\n\n    // Datasets are uploaded. Save metadata\n    var orderDataset = $(\"#sortable-edition\").sortable('toArray');\n    $(orderDataset).each(function (indexF, nameF) {\n      var file = data.datasets[parseInt(nameF)].uri;\n      newDatasets[indexF] = {uri: file};\n    });\n    data.datasets = newDatasets;\n\n    // links\n    var orderLink = $(\"#sortable-link\").sortable('toArray');\n    $(orderLink).each(function (indexL, nameL) {\n      var displayText = data.links[parseInt(nameL)].title;\n      var link = $('#link-uri_' + nameL).val();\n      newLinks[indexL] = {uri: link, title: displayText};\n    });\n    data.links = newLinks;\n\n    checkRenameUri(collectionId, data, renameUri, onSave);\n  }\n}\n\nfunction resolveTitleT8(collectionId, data, field) {\n  var ajaxRequest = [];\n  var templateData = $.extend(true, {}, data);\n  $(templateData[field]).each(function (index, path) {\n    templateData[field][index].description = {};\n    var eachUri = path.uri;\n    var dfd = $.Deferred();\n    getPageDataTitle(collectionId, eachUri,\n      function (response) {\n        templateData[field][index].description.edition = response.edition;\n        templateData[field][index].uri = eachUri;\n        dfd.resolve();\n      },\n      function () {\n        sweetAlert(\"Error\", field + ' address: ' + eachUri + ' is not found.', \"error\");\n        dfd.resolve();\n      }\n    );\n    ajaxRequest.push(dfd);\n  });\n\n  $.when.apply($, ajaxRequest).then(function () {\n    var dataTemplate = templateData[field];\n    var html = templates.workEditT8LandingDatasetList(dataTemplate);\n    $('#edition').replaceWith(html);\n    addEditionEditButton(collectionId, data, templateData);\n  });\n}\n\nfunction addEditionEditButton(collectionId, data, templateData) {\n  // Load dataset to edit\n  $(templateData.datasets).each(function (index) {\n    //open document\n    $(\"#edition-edit_\" + index).click(function () {\n      var selectedEdition = data.datasets[index].uri;\n      Florence.globalVars.activeTab = '';\n      createWorkspace(selectedEdition, collectionId, 'edit');\n    });\n\n    $('#edition-edit-label_' + index).click(function () {\n      var selectedEdition = data.datasets[index].uri;\n      getPageData(collectionId, selectedEdition,\n        function (pageData) {\n          var markdown = pageData.description.edition;\n          var editedSectionValue = {title: 'Edition title', markdown: markdown};\n          var saveContent = function (updatedContent) {\n            pageData.description.edition = updatedContent;\n            var childTitle = updatedContent.replace(/[^A-Z0-9]+/ig, \"\").toLowerCase();\n            putContent(collectionId, pageData.uri, JSON.stringify(pageData),\n              function () {\n                //save children changes and move\n                checkRenameUri(collectionId, pageData, true, updateContent);\n                //update dataset uri in parent and save\n                data.datasets[index].uri = data.uri + \"/\" + childTitle;\n                putContent(collectionId, data.uri, JSON.stringify(data),\n                  function () {},\n                  function (response) {\n                    if (response.status === 409) {\n                      sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                    } else {\n                      handleApiError(response);\n                    }\n                  }\n                );\n              },\n              function (message) {\n                if (message.status === 400) {\n                  sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                }\n                else {\n                  handleApiError(message);\n                }\n              }\n            );\n          };\n          loadMarkdownEditor(editedSectionValue, saveContent, pageData);\n        },\n        function (message) {\n          handleApiError(message);\n        }\n      );\n    });\n\n    // Delete (assuming datasets in makeEditSection - not dynamic fields here)\n    $('#edition-delete_' + index).click(function () {\n      swal({\n        title: \"Warning\",\n        text: \"Are you sure you want to delete this edition?\",\n        type: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Delete\",\n        cancelButtonText: \"Cancel\",\n        closeOnConfirm: false\n      }, function (result) {\n        if (result === true) {\n          swal({\n            title: \"Deleted\",\n            text: \"This edition has been deleted\",\n            type: \"success\",\n            timer: 2000\n          });\n          var position = $(\".workspace-edit\").scrollTop();\n          Florence.globalVars.pagePos = position;\n          $('#edition-delete_' + index).parent().remove();\n          $.ajax({\n            url: \"/zebedee/content/\" + collectionId + \"?uri=\" + data.datasets[index].uri,\n            type: \"DELETE\",\n            success: function (res) {\n              console.log(res);\n            },\n            error: function (res) {\n              console.log(res);\n            }\n          });\n          data.datasets.splice(index, 1);\n          updateContent(collectionId, data.uri, JSON.stringify(data));\n        }\n      });\n    });\n  });\n\n  function sortableSections() {\n    $(\"#sortable-edition\").sortable();\n  }\n\n  sortableSections();\n}\n\nfunction transfer(source, destination, uri) {\n  var transferRequest = {\n    source: source,\n    destination: destination,\n    uri: uri\n  };\n  $.ajax({\n    url: \"/zebedee/transfer\",\n    type: \"POST\",\n    dataType: \"json\",\n    contentType: 'application/json',\n    data: JSON.stringify(transferRequest),\n    success: function() {\n      console.log(' file has been moved');\n    },\n    error: function() {\n      console.log('error moving file');\n    }\n  });\n}\n\nfunction treeNodeSelect(url) {\n    var urlPart = url.replace(Florence.babbageBaseUrl, '');\n\n    // BEING REMOVED BECAUSE BABBAGE IS NOW RENDERING SAME AS NORMAL PAGE - Remove the trailing slash on visualisations so the node select works as expected (unless at root)\n    // if (urlPart !== '/') {\n    //     urlPart = urlPart.replace(/\\/+$/, '');\n    // }\n\n    var $selectedListItem = $('[data-url=\"' + urlPart + '\"]'); //get first li with data-url with url\n    $('.js-browse__item.selected').removeClass('selected');\n    $selectedListItem.addClass('selected');\n\n    // Hide container for item and buttons for previous and show selected one\n    $('.page__container.selected').removeClass('selected');\n    $selectedListItem.find('.page__container:first').addClass('selected');\n\n    // Hide previous displayed page buttons and show selected one\n    if ($selectedListItem.find('.page__buttons:first')) {\n        $('.page__buttons.selected').removeClass('selected');\n        $selectedListItem.find('.page__buttons:first').addClass('selected');\n    }\n\n    //page-list-tree\n    $('.tree-nav-holder ul').removeClass('active');\n    $selectedListItem.parents('ul').addClass('active');\n    $selectedListItem.closest('li').children('ul').addClass('active');\n\n    // Update browse tree scroll position\n    browseScrollPos();\n\n    // Open active directories\n    selectParentDirectories($selectedListItem);\n}\n/*\n*   Function that are applied just to UI/styling and aren't specific to certain screens or functions\n */\n\nvar $delegatedSelector = $('#main'); // This should be the highest point event handlers are delegated up to\n\n// Add focus styling to selects\nvar $closestWrap;\n$delegatedSelector.on('focus', '.select-wrap select', function(e) {\n    $closestWrap = $(e.target).closest('.select-wrap');\n    $closestWrap.toggleClass('select-wrap--focus');\n});\n\n$delegatedSelector.on('focusout', '.select-wrap select', function(e) {\n    $closestWrap.toggleClass('select-wrap--focus');\n});\n\n// Function to add loading icon to a button\nfunction loadingBtn(selector) {\n    var loadingHTML = $(templates.loadingAnimation()).css('top', '-3px'); // -3px to get animation in centre of button\n\n    selector\n        .width(selector.width()).height(selector.height()) // make btn keep width & height with loading icon\n        .empty() // remove button text\n        .append(loadingHTML); // Load loading animation template into button\n}function uiTidyUp() {\n\t//wrap selects with <div class=\"select-wrap\">\n\t// $('select').wrap('<span class=\"select-wrap\"></span>');\n\tconsole.log('uiTidyup');\n\t$(function() {\n \n    $( 'select' )\n      .selectmenu()\n      .selectmenu( \"menuWidget\" )\n        .addClass( \"overflow\" );\n  });\n}function updateContent(collectionId, path, content, redirectToPath) {\n    putContent(collectionId, path, content,\n        success = function () {\n            Florence.Editor.isDirty = false;\n            if (redirectToPath) {\n                createWorkspace(redirectToPath, collectionId, 'edit');\n                return;\n            } else {\n                //createWorkspace(path, collectionId, 'edit');\n                refreshPreview(path);\n                loadPageDataIntoEditor(path, collectionId);\n            }\n        },\n        error = function (response) {\n            if (response.status === 409) {\n                sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n            } else {\n                handleApiError(response);\n            }\n        }\n    );\n}\n/**\n * Show the change password screen to change the password for the given email.\n * @param email - The email address of the user to change the password for.\n * @param authenticate - true if the existing password for the user needs to be entered.\n */\nfunction viewChangePassword(email, authenticate) {\n\n  var viewModel = {\n    authenticate: authenticate\n  };\n  \n  $('body').append(templates.changePassword(viewModel));\n\n  $('.change-password-overlay__inner input:first').focus(); // Put focus on first input\n\n  $('#update-password').on('click', function () {\n    var oldPassword = $('#password-old').val();\n    var newPassword = $('#password-new').val();\n    var confirmPassword = $('#password-confirm').val();\n\n    if(newPassword !== confirmPassword) {\n      sweetAlert('The passphrases provided do not match', 'Please enter the new passphrase again and confirm it.');\n    } else if(!newPassword.match(/.+\\s.+\\s.+\\s.+/)) {\n      sweetAlert('The passphrase does not have four words', 'Please enter a new passphrase and confirm it.');\n    } else if(newPassword.length < 15) {\n      sweetAlert('The passphrase is too short', 'Please make sure it has at least 15 characters (including spaces).');\n    } else {\n      submitNewPassword(newPassword, oldPassword);\n    }\n  });\n\n  $('#update-password-cancel').on('click', function () {\n    $('.change-password-overlay').stop().fadeOut(200).remove();\n  });\n\n  function submitNewPassword(newPassword, oldPassword) {\n    postPassword(\n      success = function () {\n        console.log('Password updated');\n        sweetAlert(\"Password updated\", \"\", \"success\");\n        $('.change-password-overlay').stop().fadeOut(200).remove();\n\n        if(authenticate) {\n          postLogin(email, newPassword);\n        }\n      },\n      error = function (response) {\n        if (response.status === 403 || response.status === 401) {\n          if (authenticate) {\n            sweetAlert('The password you entered is incorrect. Please try again');\n          } else {\n            sweetAlert('You are not authorised to change the password for this user');\n          }\n        }\n      },\n      email,\n      newPassword,\n      oldPassword);\n  }\n}\n\n\nfunction viewCollectionDetails(collectionId, $this) {\n\n    getCollectionDetails(collectionId,\n        success = function (response) {\n            populateCollectionDetails(response, collectionId, $this);\n        },\n        error = function (response) {\n            handleApiError(response);\n        }\n    );\n\n    function populateCollectionDetails(collection, collectionId) {\n\n        Florence.setActiveCollection(collection);\n\n        // Set published date\n        if (!collection.publishDate) {\n            collection.date = '[manual collection]';\n        } else if (collection.publishDate && collection.type === 'manual') {\n            collection.date = '[manual collection] Originally scheduled for ' + StringUtils.formatIsoFull(collection.publishDate);\n        } else {\n            collection.date = StringUtils.formatIsoFull(collection.publishDate);\n        }\n\n        // Set collection progress\n        ProcessPages(collection.inProgress);\n        ProcessPages(collection.complete);\n        ProcessPages(collection.reviewed);\n\n        // Set collection approval state\n        var approvalStates = {inProgress: false, thrownError: false, completed: false};\n        switch (collection.approvalStatus) {\n            case (undefined): {\n                collection.approvalState = '';\n                break;\n            }\n            case ('IN_PROGRESS'): {\n                approvalStates.inProgress = true;\n                break;\n            }\n            case ('COMPLETE'): {\n                approvalStates.completed = true;\n                break;\n            }\n            case ('ERROR'): {\n                approvalStates.thrownError = true;\n                break;\n            }\n        }\n        collection.approvalState = approvalStates;\n\n        var showPanelOptions = {\n            html: window.templates.collectionDetails(collection)\n        };\n        showPanel($this, showPanelOptions);\n\n        var deleteButton = $('#collection-delete'),\n            collectionCanBeDeleted = collection.inProgress.length === 0\n                && collection.complete.length === 0\n                && collection.reviewed.length === 0\n                && collection.timeseriesImportFiles.length === 0\n                && collection.pendingDeletes.length <= 0;\n        if (collectionCanBeDeleted) {\n            deleteButton.show().click(function () {\n                swal({\n                    title: \"Warning\",\n                    text: \"Are you sure you want to delete this collection?\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonText: \"Continue\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: false\n                }, function (result) {\n                    if (result === true) {\n                        deleteCollection(collectionId,\n                            function () {\n                                swal({\n                                    title: \"Collection deleted\",\n                                    type: \"success\",\n                                    timer: 2000\n                                });\n                                viewCollections();\n                            },\n                            function (error) {\n                                viewCollectionDetails(collectionId);\n                                sweetAlert('File has not been deleted. Contact an administrator', error, \"error\");\n                            })\n                    } else {\n                    }\n                });\n            });\n        } else {\n            deleteButton.hide();\n        }\n\n        var $approveBtn = $('.btn-collection-approve'),\n            $editBtn = $('.btn-collection-edit'),\n            $workOnBtn = $('.btn-collection-work-on');\n\n        if (collection.approvalState.inProgress) {\n            // Collection has been approved and is generating PDF, timeseries etc so disable buttons\n            $workOnBtn.addClass('btn--disabled').attr('disabled', true);\n            $approveBtn.addClass('btn--disabled').attr('disabled', true);\n        } else if (collection.approvalState.thrownError) {\n            // Collection has thrown error doing pre-publish tasks, give user option to retry approval\n            $workOnBtn.hide();\n            $approveBtn.text('Retry approval').show().one('click', function () {\n                postApproveCollection(collection.id);\n            });\n        } else if (showApproveButton(collection)) {\n            // Collection has been reviewed and is ready for approval, so show button and bind click\n            $approveBtn.show().one('click', function () {\n                postApproveCollection(collection.id);\n            });\n        } else {\n            // You can't approve collections unless there is nothing left to be reviewed, hide approve button\n            $approveBtn.hide();\n        }\n\n        //edit collection\n        $editBtn.click(function () {\n            editCollection(collection);\n        });\n\n        //page-list\n        $('.page__item:not(.delete-child)').click(function () {\n            $('.page-list li').removeClass('selected');\n            $('.page__buttons').hide();\n            $('.page__children').hide();\n\n            var $this = $(this),\n                $buttons = $this.next('.page__buttons'),\n                $childrenPages = $buttons.length > 0 ? $buttons.next('.page__children') : $this.next('.page__children');\n\n            $this.parent('li').addClass('selected');\n            $buttons.show();\n            $childrenPages.show();\n        });\n\n        $('.btn-page-edit').click(function () {\n            var path = $(this).attr('data-path');\n            var language = $(this).attr('data-language');\n            if (language === 'cy') {\n                var safePath = checkPathSlashes(path);\n                Florence.globalVars.welsh = true;\n            } else {\n                var safePath = checkPathSlashes(path);\n                Florence.globalVars.welsh = false;\n            }\n            getPageDataDescription(collectionId, safePath,\n                success = function () {\n                    createWorkspace(safePath, collectionId, 'edit', collection);\n                },\n                error = function (response) {\n                    handleApiError(response);\n                }\n            );\n        });\n\n        $('.page-delete').click(function () {\n            var path = $(this).attr('data-path');\n            var language = $(this).attr('data-language');\n\n            //Shows relevant alert text - SweetAlert doesn't return a true or false in same way that confirm() does so have to write each alert with delete function called after it\n            function deleteAlert(text) {\n                swal({\n                    title: \"Warning\",\n                    text: text,\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonText: \"Delete\",\n                    cancelButtonText: \"Cancel\",\n                    closeOnConfirm: false\n                }, function (result) {\n                    if (result === true) {\n                        //if (language === 'cy' && !(path.match(/\\/bulletins\\//) || path.match(/\\/articles\\//))) {\n                        if (language === 'cy') {\n                            path = path + '/data_cy.json';\n                        }\n                        deleteContent(collectionId, path, function () {\n                                viewCollectionDetails(collectionId);\n                                swal({\n                                    title: \"Page deleted\",\n                                    text: \"This page has been deleted\",\n                                    type: \"success\",\n                                    timer: 2000\n                                });\n                            }, function (error) {\n                                handleApiError(error);\n                            }\n                        );\n                    }\n                });\n            }\n\n            //if (path.match(/\\/bulletins\\//) || path.match(/\\/articles\\//)) {\n            //  deleteAlert(\"This will delete the English and Welsh content of this page, if any. Are you sure you want to delete this page from the collection?\");\n            //} else if (language === 'cy') {\n            deleteAlert(\"Are you sure you want to delete this page from the collection?\");\n            //} else {\n            //  deleteAlert(\"This will delete the English and Welsh content of this page, if any. Are you sure you want to delete this page from the collection?\");\n            //}\n        });\n\n        $('.delete-marker-remove').click(function () {\n            var selection = $('.page-list').find('.selected');\n            var uri = $(this).attr('data-path');\n            removeDeleteMarker(uri, function() {\n                // selection.remove();\n                getCollectionDetails(collectionId,\n                    success = function (response) {\n                        populateCollectionDetails(response, collectionId, $this);\n                    },\n                    error = function (response) {\n                        handleApiError(response);\n                    }\n                );\n                sweetAlert('Undo', \"Deletion removed\", 'success');\n            });\n        });\n\n        $('.btn-collection-cancel').click(function () {\n            hidePanel({});\n        });\n\n        $workOnBtn.click(function () {\n            var workspaceState = __webpack_require__(25);\n            workspaceState.reset();\n            var collectionState = __webpack_require__(28);\n            collectionState.set(collection);\n            var workspaceController = __webpack_require__(29);\n            workspaceController.init();\n            // Florence.globalVars.welsh = false;\n            // createWorkspace('', collectionId, 'browse', collection);\n        });\n\n        setCollectionDetailsHeight();\n    };\n\n    function ProcessPages(pages) {\n        _.sortBy(pages, 'uri');\n        _.each(pages, function (page) {\n            page.uri = page.uri.replace('/data.json', '');\n            return page;\n        });\n    }\n\n    function setCollectionDetailsHeight() {\n        var panelHeight = parseInt($('.panel--off-canvas').height());\n\n        var headHeight = parseInt($('.slider__head').height());\n        var headPadding = parseInt($('.slider__head').css('padding-bottom'));\n\n        var contentPadding = parseInt($('.slider__content').css('padding-bottom'));\n\n        var navHeight = parseInt($('.slider__nav').height());\n        var navPadding = (parseInt($('.slider__nav').css('padding-bottom'))) + (parseInt($('.slider__nav').css('padding-top')));\n\n        var contentHeight = panelHeight - (headHeight + headPadding + contentPadding + navHeight + navPadding);\n        $('.slider__content').css('height', contentHeight);\n    }\n\n    function showApproveButton(collection) {\n        // If the collection contains deletes...\n        if (collection.pendingDeletes && collection.pendingDeletes.length > 0) {\n            // Check that the current user is not the owner of any of the deletes.\n            for (i = 0; i < collection.pendingDeletes.length; i++) {\n                var pendingDelete = collection.pendingDeletes[i];\n                if (pendingDelete.user == localStorage.getItem('loggedInAs')) {\n                    $(\"#approval-permission-blocked\").show();\n                    return false;\n                }\n            }\n\n            return (collection.inProgress.length === 0 && collection.complete.length === 0\n                && collection.reviewed.length >= 0) || (collection.timeseriesImportFiles.length > 0);\n        }\n        return (collection.inProgress.length === 0 && collection.complete.length === 0\n            && collection.reviewed.length > 0) || (collection.timeseriesImportFiles.length > 0);\n    }\n}function viewCollections(collectionId) {\n\n    var result = {};\n    var pageDataRequests = []; // list of promises - one for each ajax request.\n    pageDataRequests.push(\n        $.ajax({\n            url: \"/zebedee/collections\",\n            type: \"get\",\n            success: function (data) {\n                result.data = data;\n            },\n            error: function (jqxhr) {\n                handleApiError(jqxhr);\n            }\n        })\n    );\n    pageDataRequests.push(\n        getTeams(\n            success = function (team) {\n                result.team = team;\n            },\n            error = function (response) {\n                handleApiError(response);\n            }\n        )\n    );\n\n    $.when.apply($, pageDataRequests).then(function () {\n\n        var response = [], teams = [], date = \"\";\n\n        $.each(result.data, function (i, collection) {\n            var approvalStates = {inProgress: false, thrownError: false, completed: false};\n\n            if (collection.approvalStatus != \"COMPLETE\") {\n\n                // Set publish date\n                if (!collection.publishDate) {\n                    date = '[manual collection]';\n                } else if (collection.publishDate && collection.type === 'manual') {\n                    date = StringUtils.formatIsoDateString(collection.publishDate) + ' [rolled back]';\n                } else {\n                    date = StringUtils.formatIsoDateString(collection.publishDate);\n                }\n\n                // Set approval state\n                switch (collection.approvalStatus) {\n                    case (undefined): {\n                        break;\n                    }\n                    case ('IN_PROGRESS'): {\n                        approvalStates.inProgress = true;\n                        break;\n                    }\n                    case ('COMPLETE'): {\n                        approvalStates.completed = true;\n                        break;\n                    }\n                    case ('ERROR'): {\n                        approvalStates.thrownError = true;\n                        break;\n                    }\n                }\n\n                response.push({id: collection.id, name: collection.name, date: date, approvalState: approvalStates});\n            }\n        });\n\n        var isDataVis = false;\n        if (Florence.Authentication.userType() === \"DATA_VISUALISATION\") {\n            isDataVis = true;\n        }\n        var collectionsHtml = templates.collectionList({response: response, teams: result.team.teams, isDataVis: isDataVis});\n        $('.section').html(collectionsHtml);\n\n        if (collectionId) {\n            viewCollectionDetails(collectionId, $('.js-selectable-table tr[data-id=\"' + collectionId + '\"]'));\n        }\n\n        $('.js-selectable-table tbody tr').click(function () {\n            var collectionId = $(this).attr('data-id');\n            viewCollectionDetails(collectionId, $(this));\n        });\n\n        $(\"#team-tag\").tagit({\n            singleField: true,\n            singleFieldNode: $('#team-input')\n        });\n\n        $('.ui-autocomplete-input').hide();\n\n        $('select#team').change(function () {\n            $('#team-tag').tagit('createTag', $(\"#team option:selected\").text());\n        });\n\n        $('#team-input').change(function () {\n            teams = $('#team-input').val().split(',');\n            //After creating the array tagit leaves an empty string if all elements are removed\n            if (teams.length === 1 && teams[0] === \"\") {\n                teams = [];\n            }\n        });\n\n        $('form input[type=radio]').click(function () {\n\n            if ($(this).val() === 'manual') {\n                $('#scheduledPublishOptions').hide();\n            } else if ($(this).val() === 'scheduled') {\n                $('#scheduledPublishOptions').show();\n            } else if ($(this).val() === 'custom') {\n                $('#customScheduleOptions').show();\n                $('#releaseScheduleOptions').hide();\n            } else if ($(this).val() === 'release') {\n                $('#customScheduleOptions').hide();\n                $('#releaseScheduleOptions').show();\n            }\n        });\n\n\n        $(function () {\n            var today = new Date();\n            $('#date').datepicker({\n                minDate: today,\n                dateFormat: 'dd/mm/yy',\n                constrainInput: true\n            });\n        });\n\n\n        $('.btn-select-release').on(\"click\", function (e) {\n            e.preventDefault();\n            viewReleaseSelector();\n        });\n\n        $('.form-create-collection').submit(function (e) {\n            e.preventDefault();\n            createCollection(teams);\n        });\n    });\n}function viewController(view) {\n\n    if (Florence.Authentication.isAuthenticated()) {\n\n        if (view === 'collections') {\n            viewCollections();\n        }\n        else if (view === 'users') {\n            viewUsers();\n        }\n        else if (view === 'teams') {\n            viewTeams();\n        }\n        else if (view === 'login') {\n            viewLogIn();\n        }\n        else if (view === 'publish') {\n            viewPublish();\n        }\n        else if (view === 'reports') {\n            viewReports();\n        }\n        else {\n            viewController('collections');\n        }\n    }\n    else {\n        viewLogIn();\n    }\n}\n\nfunction viewLogIn() {\n\n    var login_form = templates.login;\n    $('.section').html(login_form);\n\n    $('.form-login').submit(function (e) {\n        e.preventDefault();\n        loadingBtn($('#login'));\n        var email = $('.fl-user-and-access__email').val();\n        var password = $('.fl-user-and-access__password').val();\n        postLogin(email, password);\n    });\n}\n\nfunction viewPublish() {\n    var manual = '[manual collection]';\n\n    $.ajax({\n        url: \"/zebedee/collections\",\n        type: \"get\",\n        crossDomain: true,\n        success: function (collections) {\n            $(collections).each(function (i) {\n                if (!collections[i].type || (collections[i].type === 'manual')) {\n                    collections[i].publishDate = manual;\n                }\n            });\n            populatePublishTable(collections);\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n\n    var result = [];\n\n    function populatePublishTable(collections) {\n\n\n        var collectionsByDate = _.chain(collections)\n            .filter(function (collection) {\n                return collection.approvalStatus == \"COMPLETE\"\n            })\n            .sortBy('publishDate')\n            .groupBy('publishDate')\n            .value();\n\n        for (var key in collectionsByDate) {\n            var response = [];\n            if (key === manual) {\n                var formattedDate = manual;\n            } else {\n                var formattedDate = StringUtils.formatIsoFull(key);\n            }\n            $(collectionsByDate[key]).each(function (n) {\n                var id = collectionsByDate[key][n].id;\n                response.push(id);\n            });\n            result.push({date: formattedDate, ids: response});\n        }\n\n        var publishList = templates.publishList(result);\n        $('.section').html(publishList);\n\n        $('.js-selectable-table tbody tr').click(function () {\n            var collections = $(this).attr('data-collections').split(',');\n            Florence.collectionToPublish.publishDate = $(this).find('td').html();\n            viewPublishDetails(collections);\n\n            var showPanelOptions = {\n                html: false,\n                moveCenteredPanel: true\n            };\n            showPanel($(this), showPanelOptions);\n            // $('.panel--centred').animate({marginLeft: \"0%\"}, 800);\n        });\n    }\n}\n\nfunction viewPublishDetails(collections) {\n\n    var manual = '[manual collection]';\n    var result = {\n        date: Florence.collectionToPublish.publishDate,\n        subtitle: '',\n        collectionDetails: [],\n        pendingDeletes: []\n    };\n    var pageDataRequests = []; // list of promises - one for each ajax request to load page data.\n    var onlyOne = 0;\n\n    $.each(collections, function (i, collectionId) {\n        onlyOne += 1;\n        pageDataRequests.push(\n            getCollectionDetails(collectionId,\n                success = function (response) {\n                    if (result.date === manual) {\n                        result.collectionDetails.push({\n                            id: response.id,\n                            name: response.name,\n                            pageDetails: response.reviewed,\n                            pageType: 'manual',\n                            pendingDeletes: response.pendingDeletes\n                        });\n                    } else {\n                        result.collectionDetails.push({\n                            id: response.id,\n                            name: response.name,\n                            pageDetails: response.reviewed\n                        });\n                    }\n                },\n                error = function (response) {\n                    handleApiError(response);\n                }\n            )\n        );\n    });\n\n    if (onlyOne < 2) {\n        result.subtitle = 'The following collection has been approved';\n    } else {\n        result.subtitle = 'The following collections have been approved';\n    }\n\n    $.when.apply($, pageDataRequests).then(function () {\n        var publishDetails = templates.publishDetails(result);\n        $('.panel--off-canvas').html(publishDetails);\n        bindAccordions();\n\n        $('.btn-collection-publish').click(function () {\n            var collection = $(this).closest('.js-accordion').find('.collection-name').attr('data-id');\n            console.log(collection);\n            publish(collection);\n        });\n\n        $('.btn-collection-unlock').click(function () {\n            var collection = $(this).closest('.js-accordion').find('.collection-name').attr('data-id');\n            console.log(collection);\n\n            if (result.date !== manual) {\n                swal({\n                        title: \"Are you sure?\",\n                        text: \"If unlocked, this collection will not be published on \" + result.date + \" unless it is approved\" +\n                        \" again\",\n                        type: \"warning\",\n                        showCancelButton: true,\n                        confirmButtonColor: \"#6d272b\",\n                        confirmButtonText: \"Yes, unlock it!\",\n                        closeOnConfirm: false\n                    },\n                    function () {\n                        unlock(collection);\n                    });\n            } else {\n                unlock(collection);\n            }\n        });\n\n        //page-list\n        $('.page__item:not(.delete-child)').click(function () {\n            $('.page-list li').removeClass('selected');\n            $('.page__buttons').hide();\n            $('.page__children').hide();\n\n            // $(this).parent('li').addClass('selected');\n            // $(this).next('.page__buttons').show();\n\n            var $this = $(this),\n                $buttons = $this.next('.page__buttons'),\n                $childrenPages = $buttons.length > 0 ? $buttons.next('.page__children') : $this.next('.page__children');\n\n            $this.parent('li').addClass('selected');\n            $buttons.show();\n            $childrenPages.show();\n        });\n\n        $('.btn-collection-cancel').click(function () {\n            var hidePanelOptions = {\n                onHide: false,\n                moveCenteredPanel: true\n            };\n\n            hidePanel(hidePanelOptions);\n        });\n    });\n}\n/**\n * Load the release selector screen and populate the list of available releases.\n */\nfunction viewReleaseSelector() {\n\n    var html = templates.releaseSelector();\n    $('body').append(html);\n\n    var releases = [];\n    PopulateReleasesForUri(\"/releasecalendar/data?view=upcoming\", releases);\n\n    $('.btn-release-selector-cancel').on('click', function () {\n        $('.release-select').stop().fadeOut(200).remove();\n    });\n\n    var $searchInput = $('#release-search-input');\n    $searchInput.focus();\n    $searchInput.on('input', function () {\n        var searchText = $(this).val();\n        populateReleasesList(releases, searchText);\n    });\n\n    function PopulateReleasesForUri(baseReleaseUri, releases) {\n        //console.log(\"populating release for uri \" + baseReleaseUri);\n        $.ajax({\n                url: baseReleaseUri,\n                type: \"get\",\n                success: function (data) {\n                    populateRemainingReleasePages(data, releases, baseReleaseUri);\n                },\n                error: function (response) {\n                    handleApiError(response);\n                }\n            }\n        );\n    }\n\n    /**\n     * Take the data from the response of getting the first release page and\n     * determine if there are any more pages to get.\n     * @param data\n     */\n    function populateRemainingReleasePages(data, releases, baseReleaseUri) {\n        var pageSize = 10;\n        _(data.result.results).each(function (release) {\n            releases.push(release);\n        });\n\n        // if there are more results than the existing page size, go get them.\n        if (data.result.numberOfResults > pageSize) {\n\n            var pagesToGet = Math.ceil((data.result.numberOfResults - pageSize) / pageSize);\n            var pageDataRequests = []; // list of promises - one for each ajax request to load page data.\n\n            for (var i = 2; i < pagesToGet + 2; i++) {\n                var dfd = getReleasesPage(baseReleaseUri, i, releases);\n                pageDataRequests.push(dfd);\n            }\n\n            $.when.apply($, pageDataRequests).then(function () {\n                populateReleasesList(releases);\n            });\n        } else {\n            populateReleasesList(releases);\n        }\n    }\n\n    /**\n     * Get the release page for the given index and add the response to the given releases array.\n     * @param i\n     * @param releases\n     * @returns {*}\n     */\n    function getReleasesPage(baseReleaseUri, i, releases) {\n        //console.log(\"getting page  \" + i + \" for \" + baseReleaseUri);\n        var dfd = $.Deferred();\n        $.ajax({\n            url: baseReleaseUri + '&page=' + i,\n            type: \"get\",\n            success: function (data) {\n                _(data.result.results).each(function (release) {\n                    releases.push(release);\n                });\n                dfd.resolve();\n            },\n            error: function (response) {\n                handleApiError(response);\n                dfd.resolve();\n            }\n        });\n        return dfd;\n    }\n\n    /**\n     * Populate the releases list from the given array of releases.\n     * @param releases\n     */\n    function populateReleasesList(releases, filter) {\n        var releaseList = $('#release-list');\n        releaseList.find('tr').remove(); // remove existing table entries\n\n        _(_.sortBy(releases, function (release) {\n            return release.description.releaseDate\n        }))\n            .each(function (release) {\n                if (!filter || (release.description.title.toUpperCase().indexOf(filter.toUpperCase()) > -1)) {\n                    var date = StringUtils.formatIsoFullDateString(release.description.releaseDate);\n                    releaseList.append('<tr data-id=\"' + release.description.title + '\" data-uri=\"' + release.uri + '\"><td>' + release.description.title + '</td><td>' + date + '</td></tr>');\n                }\n            });\n\n        releaseList.find('tr').on('click', function () {\n            var releaseTitle = $(this).attr('data-id');\n            var releaseUri = $(this).attr('data-uri'),\n                $releaseTitle = $('.selected-release');\n            Florence.CreateCollection.selectedRelease = {uri: releaseUri, title: releaseTitle};\n\n\n            $releaseTitle.show().text(releaseTitle);\n            $('.release-select').stop().fadeOut(200).remove();\n        })\n    }\n}/**\n * Display panel with selected report's details\n *\n * @param collection = selected collection data object\n * @param isPublished = boolean flag of whether selected collection is published or not\n * @param $this = jQuery object of selected item from table\n */\n\nfunction viewReportDetails(collection, isPublished, $this) {\n\n    var details, reportDetails, published, events;\n\n    // get the event details\n    $.ajax({\n        url: \"/zebedee/collectionHistory/\" + collection.id,\n        type: \"get\",\n        crossDomain: true,\n        success: function (events) {\n\n            // format eventDate to user readable date\n            $(events).each(function (i) {\n                var formattedDate = events[i].eventDetails.date;\n                events[i].formattedDate = StringUtils.formatIsoFull(formattedDate);\n            });\n\n            if (isPublished) {\n\n\n                $.ajax({\n                    url: \"/zebedee/publishedCollections/\" + collection.id,\n                    type: \"GET\",\n                    crossDomain: true,\n                    success: function (collection) {\n\n                        var collection = collection[0];\n\n                        var date = collection.publishEndDate;\n                        collection.formattedDate = StringUtils.formatIsoFull(date);\n\n                        // Load details with published data\n                        if (!collection.publishResults || collection.publishResults.length === 0) {\n                            return;\n                        }\n\n                        var success = collection.publishResults[collection.publishResults.length - 1];\n                        var duration = (function () {\n\n                            if (collection.publishStartDate && collection.publishEndDate) {\n                                var start = new Date(collection.publishStartDate);\n                                var end = new Date(collection.publishEndDate);\n                            } else {\n                                var start = new Date(success.transaction.startDate);\n                                var end = new Date(success.transaction.endDate);\n                            }\n                            return end - start;\n                        })();\n\n\n                        if (collection.publishStartDate) {\n                            var starting = StringUtils.formatIsoFullSec(collection.publishStartDate);\n                        } else {\n                            var starting = StringUtils.formatIsoFullSec(success.transaction.startDate);\n                        }\n\n                        // var verifiedCount = collection.verifiedCount;\n                        // var verifyFailedCount = collection.verifyFailedCount;\n                        // var verifyInprogressCount = collection.verifyInprogressCount;\n                        details = {\n                            name: collection.name,\n                            // verifiedCount: verifiedCount,\n                            // verifyInprogressCount: verifyInprogressCount,\n                            // verifyFailedCount: verifyFailedCount,\n                            date: collection.formattedDate,\n                            starting: starting,\n                            duration: duration,\n                            success: success,\n                            events: events\n                        };\n\n                        var showPanelOptions = {\n                            html: templates.reportPublishedDetails(details),\n                            moveCenteredPanel: true\n                        };\n\n                        showPanel($this, showPanelOptions);\n                        bindAccordions();\n                        bindTableOrdering();\n\n                    },\n                    error: function (response) {\n                        handleApiError(response);\n                    }\n                });\n\n\n\n            } else {\n\n                // Load details with unpublished data\n                details = {\n                    name: collection.name,\n                    events: events\n                };\n\n                var showPanelOptions = {\n                    html: templates.reportUnpublishedDetails(details),\n                    moveCenteredPanel: true\n                };\n                showPanel($this, showPanelOptions);\n            }\n\n            bindAccordions();\n\n            $('.btn-collection-cancel').click(function () {\n                var hidePanelOptions = {\n                    moveCenteredPanel: true\n                };\n                hidePanel(hidePanelOptions)\n            });\n\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n\n}\n\nfunction bindTableOrdering() {\n    // Bind table ordering functionality to publish times\n    var $publishTimeHeadings = $('.publish-times-table th');\n    $publishTimeHeadings.click(function () {\n\n        // Get table, reverse order and rebuild it\n        var table = $(this).parents('table').eq(0);\n        var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()));\n        this.asc = !this.asc;\n        if (!this.asc) {\n            rows = rows.reverse();\n        }\n        for (var i = 0; i < rows.length; i++) {\n            table.append(rows[i]);\n        }\n\n        /* TODO Get sorting arrows working - also code commented out in related SCSS */\n        // Update active classes to show sort direction in UI\n        $publishTimeHeadings.removeClass('active active--asc active--desc');\n        var tableDirection = \"asc\";\n        if (!this.asc) {\n            tableDirection = \"desc\";\n        }\n        var activeClass = \"active active--\" + tableDirection;\n        $(this).addClass(activeClass);\n    });\n\n    function comparer(index) {\n        return function (a, b) {\n            var valA = getCellValue(a, index), valB = getCellValue(b, index);\n            return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.localeCompare(valB);\n        }\n    }\n\n    function getCellValue(row, index) {\n        return $(row).children('td').eq(index).html()\n    }\n\n}function viewReports() {\n\n    $.ajax({\n        url: \"/zebedee/publishedCollections\",\n        type: \"GET\",\n        crossDomain: true,\n        success: function (collections) {\n            getUnpublishedCollections(collections);\n        },\n        error: function (response) {\n            handleApiError(response);\n        }\n    });\n\n    function getUnpublishedCollections(publishedCollections) {\n        $.ajax({\n            url: \"/zebedee/collections\",\n            type: \"GET\",\n            crossDomain: true,\n            success: function(response) {\n                var collections = [];\n                collections[\"published\"] = publishedCollections;\n                collections[\"unpublished\"] = response;\n                populateTable(collections);\n            },\n            error: function (response) {\n                handleApiError(response)\n            }\n        })\n    }\n\n    function populateTable(collections) {\n        var collections = collections;\n        //console.log(collections);\n\n        // Build published collections objects\n        // // var publishedCollections = _.chain(collections.published)\n        // //     .filter(function (collection) {\n        // //         return collection.publishResults && collection.publishResults.length > 0;\n        // //     })\n        // //     .value();\n        //\n        //\n        // console.log(publishedCollections);\n        // $(publishedCollections).each(function (n, coll) {\n        //     var date = publishedCollections[n].\n        //     if (coll.publishResults && coll.publishResults.length > 0) {\n        //\n        //         if (coll.publishStartDate) {\n        //             var date = coll.publishStartDate;\n        //         } else {\n        //             var date = coll.publishResults[coll.publishResults.length - 1].transaction.startDate;\n        //         }\n        //\n        //         publishedCollections[n].formattedDate = StringUtils.formatIsoFull(date);\n        //     }\n        // });\n        //\n        // collections[\"published\"] = publishedCollections;\n\n        var publishedCollections = collections.published;\n\n        $(publishedCollections).each(function (i) {\n            publishedCollections[i].order = i;\n        });\n\n        // Format the publishDate to user readable and add into JSON\n        $(publishedCollections).each(function (i) {\n            var formattedDate = collections[\"published\"][i].publishDate;\n            collections[\"published\"][i].formattedDate = StringUtils.formatIsoFull(formattedDate);\n        });\n\n        // Pass data to template \n        var reportList = templates.reportList(collections);\n        $('.section').html(reportList);\n\n        // Bind click on unpublished collection\n        $('.unpublished').click(function() {\n            var i = $(this).attr('data-collections-order');\n            var isPublished = false;\n            viewReportDetails(collections.unpublished[i], isPublished, $(this));\n\n            selectTr($(this));\n        });\n\n        // Bind click on published collection\n        $('.published').click(function () {\n            var i = $(this).attr('data-collections-order');\n            var isPublished = true;\n            viewReportDetails(collections.published[i], isPublished, $(this));\n\n            selectTr($(this));\n        });\n\n        function selectTr($this) {\n            // $('.publish-select-table tbody tr').removeClass('selected');\n            // $this.addClass('selected');\n            // $('.publish-selected').animate({right: \"0%\"}, 800);\n            // $('.publish-select').animate({marginLeft: \"0%\"}, 500);\n            var showPanelOptions = {\n\n            }\n        }\n    }\n}\n/**\n * Display the details of the team with the given name.\n * @param teamName\n * @param $this = jQuery object of selected table item\n */\nfunction viewTeamDetails(teamName, $this) {\n\n    getTeams(\n        success = function (team) {\n            populateTeamDetails(team, $this);\n        },\n        error = function (response) {\n            handleApiError(response);\n        },\n        teamName\n    );\n\n    function populateTeamDetails(team, $this) {\n\n        var showPanelOptions = {\n            html: window.templates.teamDetails(team)\n        };\n        showPanel($this, showPanelOptions);\n\n        $('.btn-team-delete').click(function () {\n            swal({\n                title: \"Confirm deletion\",\n                text: \"Please enter the name of the team you want to delete\",\n                type: \"input\",\n                inputPlaceHolder: \"Name\",\n                showCancelButton: true,\n                closeOnConfirm: false,\n                confirmButtonText: \"Delete\",\n                animation: \"slide-from-top\"\n            }, function (result) {\n                console.log(result);\n                if (result) {\n                    if (result === teamName) {\n                        var encodedName = encodeURIComponent(teamName);\n                        deleteTeam(encodedName);\n                    } else {\n                        sweetAlert(\"Oops!\", 'The name you entered did not match the team you want to delete.');\n                    }\n                }\n            });\n        });\n\n        $('.btn-team-cancel').click(function () {\n            hidePanel({});\n        });\n\n        $('.btn-team-edit-members').click(function () {\n            populateMembers(team);\n        });\n    }\n}\n\nfunction populateMembers(team) {\n    var userArray, userNotInTeam;\n    getUsers(\n        function (users) {\n            userArray = _.pluck(users, \"email\");\n            //console.log(\"UA: \" + userArray);\n            userNotInTeam = _.difference(userArray, team.members);\n            //console.log(\"UNIT: \" + userNotInTeam);\n            var teamsHtml = templates.teamEdit({team: team, user: userNotInTeam});\n            $('.section').append(teamsHtml);\n\n            $('#team-search-input').on('input', function () {\n                var searchText = $(this).val();\n                populateUsersList(userNotInTeam, searchText);\n            });\n\n            $('.btn-team-selector-cancel').click(function () {\n                $('.team-select').stop().fadeOut(200).remove();\n                viewTeamDetails(team.name);\n            });\n\n            $('.user-list').on('click', '.btn-team-add', function() {\n                console.log('you clicked add');\n                var $this = $(this),\n                    $li = $this.parent('li'),\n                    $email = $this.data('email');\n                $li.remove();\n                moveUser($email, true)\n                postTeamMember(team.name, $email);\n                userNotInTeam = _.difference(userNotInTeam, [$email]);\n\n            });\n\n\n            $('.team-list').on('click', '.btn-team-remove', function() {\n                console.log('you clicked remove');\n                var $this = $(this),\n                    $li = $this.parent('li'),\n                    $email = $this.data('email');\n                $li.remove();\n                moveUser($email, false)\n                deleteTeamMember(team.name, $email);\n                userNotInTeam.push($email);\n            });\n\n            //dragAndDrop();\n        },\n        function (jqxhr) {\n            handleApiError(jqxhr);\n        }\n    );\n\n    /**\n     * Populate the users list from the given array of users.\n     * @param users\n     */\n    function populateUsersList(users, filter) {\n        var userList = $('.user-list');\n        userList.find('li').remove(); // remove existing table entries\n\n        _(_.sortBy(users, function (user) {\n            return user;\n        }))\n            .each(function (user) {\n                if (!filter || (user.toUpperCase().indexOf(filter.toUpperCase()) > -1)) {\n                    userList.append('<li >' + user + ' <button class=\"btn-team-list btn-team-add\" data-email=\"' + user + '\">Add</button></li>');\n                }\n            });\n        //dragAndDrop();\n    }\n\n    //function dragAndDrop() {\n    //    $('.user-list > li').draggable({\n    //        appendTo: 'document',\n    //        helper: 'clone',\n    //        cursor: 'move'\n    //    });\n    //\n    //    $('.team-list > li').draggable({\n    //        appendTo: 'document',\n    //        helper: 'clone',\n    //        cursor: 'move'\n    //    });\n    //\n    //    $('.user-list').droppable({\n    //        accept: \".team-list > li\",\n    //        drop: function (event, ui) {\n    //            var targetElem = $(this).attr(\"id\");\n    //            $(this).addClass(\"ui-state-highlight\");\n    //            $(ui.draggable).appendTo(this);\n    //            deleteTeamMember(team.name, ui.draggable[0].firstChild.textContent);\n    //            userNotInTeam.push(ui.draggable[0].firstChild.textContent);\n    //        }\n    //    });\n    //\n    //    $('.team-list').droppable({\n    //        accept: \".user-list > li\",\n    //        drop: function (event, ui) {\n    //            var targetElem = $(this).attr(\"id\");\n    //            $(this).addClass(\"ui-state-highlight\");\n    //            $(ui.draggable).appendTo(this);\n    //            postTeamMember(team.name, ui.draggable[0].firstChild.textContent);\n    //            userNotInTeam = _.difference(userNotInTeam, [ui.draggable[0].firstChild.textContent]);\n    //        }\n    //    });\n    //};\n\n    /**\n     * Handle moving list items between lsits.\n     * @param user - email string\n     * @param beingAdded - true or false\n     */\n    function moveUser(user, beingAdded) {\n        if (beingAdded) {\n            button = '<button class=\"btn-team-list btn-team-remove\" data-email=\"' + user + '\">Remove</button>';\n        } else {\n            button = '<button class=\"btn-team-list btn-team-add\" data-email=\"' + user + '\">Add</button>';\n        }\n        var str = '<li>' + user + ' ' + button + '</li>';\n\n        if (beingAdded) {\n            $('.team-list').prepend(str);\n        } else {\n            $('.user-list').prepend(str);\n        }\n    }\n}\n\n\nfunction viewTeams(selectTableRowAndDisplayTeamDetails) {\n\n    getTeams(\n        success = function (data) {\n            populateTeamsTable(data.teams);\n\n            // on creation of new team highlight row in table and display team details\n            if (selectTableRowAndDisplayTeamDetails) {\n                selectTableRowAndDisplayTeamDetails();\n            }\n        },\n        error = function (jqxhr) {\n            handleApiError(jqxhr);\n        }\n    );\n\n    function populateTeamsTable(data) {\n        var teamsHtml = templates.teamList(data);\n        $('.section').html(teamsHtml);\n\n        $('.js-selectable-table tbody tr').click(function () {\n            var teamId = $(this).attr('data-id');\n            viewTeamDetails(teamId, $(this));\n        });\n\n        $('.form-create-team').submit(function (e) {\n            e.preventDefault();\n\n            var teamName = $('#create-team-name').val();\n\n            if (teamName.length < 1) {\n                sweetAlert(\"Please enter a user name.\");\n                return;\n            }\n\n            teamName = teamName.trim();\n            postTeam(teamName);\n        });\n    }\n}\n\n\n/**\n * Display the details of the user with the given email.\n *\n * @param email\n * @param $this = jQuery object of selected table item\n */\nfunction viewUserDetails(email, $this) {\n\n    getUsers(\n        success = function (user) {\n            populateUserDetails(user, email, $this);\n        },\n        error = function (response) {\n            handleApiError(response);\n        },\n        email\n    );\n\n    var isAdmin, isEditor, isVisPublisher;\n    function populateUserDetails(user, email, $this) {\n        getUserPermission(\n            function (permission) {\n                isAdmin = permission.admin;\n                isEditor = permission.editor;\n                isVisPublisher = permission.dataVisPublisher;\n\n                addPermissionToJSON(user);\n\n                var showPanelOptions = {\n                    html: window.templates.userDetails(user)\n                };\n                showPanel($this, showPanelOptions);\n\n                $('.btn-user-change-password').click(function () {\n                    var currentPasswordRequired = false;\n\n                    if (email == Florence.Authentication.loggedInEmail()) {\n                        currentPasswordRequired = true;\n                    }\n\n                    viewChangePassword(email, currentPasswordRequired);\n                });\n\n                $('.btn-user-delete').click(function () {\n                    swal({\n                        title: \"Confirm deletion\",\n                        text: \"Please enter the email address of the user you want to delete\",\n                        type: \"input\",\n                        inputPlaceHolder: \"Email address\",\n                        showCancelButton: true,\n                        closeOnConfirm: false,\n                        confirmButtonText: \"Delete\",\n                        animation: \"slide-from-top\"\n                    }, function (result) {\n                        console.log(result);\n                        if (result) {\n                            if (result === email) {\n                                swal({\n                                    title: \"User deleted\",\n                                    text: \"This user has been deleted\",\n                                    type: \"success\",\n                                    timer: 2000\n                                });\n                                deleteUser(email);\n                            } else {\n                                sweetAlert(\"Oops!\", 'The email you entered did not match the user you want to delete.')\n                            }\n                        }\n                    });\n                });\n\n                $('.btn-user-cancel').click(function () {\n                    hidePanel({});\n                });\n            },\n            function (error) {handleApiError(error);},\n            email\n        );\n\n    }\n\n    /*\n     * Add permissions object to JSON so accessible to handlebars template\n     * @param user - JSON object\n     */\n    function addPermissionToJSON (user) {\n        user['permission'] = permissionStr(isAdmin, isEditor, isVisPublisher);\n    }\n\n\n    /*\n     * Logic to work out user role\n     * @param isAdmin - true/false\n     * @param isEditor - true/false\n     * @return the user's role as string\n     */\n    function permissionStr (isAdmin, isEditor, isVisPublisher) {\n        var permissionStr;\n        if (!isAdmin && !isEditor) {permissionStr = 'viewer';}\n        if (isEditor && !isVisPublisher) {permissionStr = 'publisher';}\n        if (isEditor && isVisPublisher) {permissionStr = 'visualisation publisher';}\n        if (isAdmin) {permissionStr = \"admin\";}\n\n        return permissionStr;\n    }\n}function viewUsers(view) {\n    var loggedUser = localStorage.getItem('loggedInAs');\n    getUsers(\n        success = function (data) {\n            //based on user permission will show the options to create different users\n            getUserPermission(\n                function (permission) {\n                    populateUsersTable(data, permission);\n                },\n                function (error) {\n                    handleApiError(error);\n                },\n                loggedUser\n            );\n        },\n        error = function (jqxhr) {\n            handleApiError(jqxhr);\n        }\n    );\n\n    function populateUsersTable(data, permission) {\n        var orderedUsers = _.sortBy(data, 'name');\n        var dataTemplate = {data: orderedUsers, permission: permission};\n        var usersHtml = templates.userList(dataTemplate);\n        var isAdmin = false;\n        var isDataVisPublisher = false;\n        var isEditor = false;\n        $('.section').html(usersHtml);\n\n\n        $('.js-selectable-table tbody tr').click(function () {\n            var userId = $(this).attr('data-id');\n            viewUserDetails(userId, $(this));\n        });\n\n        $('.radioBtnDiv').change(function () {\n            if ($('input:checked').val() === 'admin') {\n                isAdmin = true;\n                isEditor = true;\n                isDataVisPublisher = false;\n            }\n            else if ($('input:checked').val() === 'publisher') {\n                isAdmin = false;\n                isEditor = true;\n                isDataVisPublisher = false;\n            }\n            else if ($('input:checked').val() === 'dataVisPublisher') {\n                isAdmin = false;\n                isEditor = false;\n                isDataVisPublisher = true;\n            }\n            else {\n                isAdmin = false;\n                isEditor = false;\n                isDataVisPublisher = false;\n            }\n        });\n\n        $('.form-create-user').submit(function (e) {\n            e.preventDefault();\n\n            var username = $('#create-user-username').val();\n            var email = $('#create-user-email').val();\n            var password = $('#create-user-password').val();\n\n            if (username.length < 1) {\n                sweetAlert(\"Please enter a user name.\");\n                return;\n            }\n\n            if (email.length < 1) {\n                sweetAlert(\"Please enter a user name.\");\n                return;\n            }\n\n            if (password.length < 1) {\n                sweetAlert(\"Please enter a password.\");\n                return;\n            }\n            postUser(username, email, password, isAdmin, isEditor, isDataVisPublisher);\n            viewUsers();\n        });\n    }\n}\n\nfunction viewWorkspace(path, collectionId, menu) {\n\n  var currentPath = '';\n  if (path) {\n    currentPath = path;\n  }\n  Florence.globalVars.pagePath = currentPath;\n\n  if (menu === 'browse') {\n    $('.nav__item--workspace').removeClass('selected');\n    $(\"#browse\").addClass('selected');\n    loadBrowseScreen(collectionId, 'click');\n  }\n  else if (menu === 'create') {\n    $('.nav__item--workspace').removeClass('selected');\n    $(\"#create\").addClass('selected');\n    loadCreateScreen(currentPath, collectionId);\n  }\n  else if (menu === 'edit') {\n    $('.nav__item--workspace').removeClass('selected');\n    $(\"#edit\").addClass('selected');\n    loadPageDataIntoEditor(currentPath, collectionId);\n  }\n}\n\n/**\n * Editor screen for uploading visualisations\n * @param collectionId\n * @param data\n */\n\nfunction visualisationEditor(collectionId, data) {\n    var path = data.uri,\n        $fileInput = $('#input-vis'),\n        $fileForm = $('#upload-vis'),\n        i, setActiveTab, getActiveTab;\n\n    // Active tab\n    $(\".edit-accordion\").on('accordionactivate', function () {\n        setActiveTab = $(\".edit-accordion\").accordion(\"option\", \"active\");\n        if (setActiveTab !== false) {\n            Florence.globalVars.activeTab = setActiveTab;\n        }\n    });\n    getActiveTab = Florence.globalVars.activeTab;\n    accordion(getActiveTab);\n    getLastPosition();\n\n    // Update hidden select to display all HTML files in ZIP\n    var selectOptions = [\"<option value=''>-- Select an HTML file to preview --</option>\"],\n        $selectWrapper = $('#select-vis-wrapper');\n\n    for (i = 0; i < data.filenames.length; i++) {\n        selectOptions.push(\"<option value='\" + data.filenames[i] + \"'>\" + data.filenames[i] + \"</option>\")\n    }\n    $selectWrapper.find('select').empty().append(selectOptions.join(''));\n    $selectWrapper.show();\n    $('#browser-location').hide();\n    $('.browser.disabled').removeClass('disabled');\n\n    // Bind to select's change and toggle preview to selected HTML file\n    $('#select-vis-preview').change(function() {\n        refreshVisPreview(\"/\" + $(this).val());\n    });\n\n    // Disable preview when navigating back to browse tab\n    $('#browse').click(function() {\n        $selectWrapper.hide();\n        $('#browser-location').show();\n        $('.browser').addClass('disabled');\n        updateBrowserURL(\"/\");\n        $('#iframe').attr('src', Florence.babbageBaseUrl);\n    });\n\n    // Submit new ZIP file\n    bindZipSubmit();\n\n    // Bind file save to the change event of the file input\n    $fileInput.on('change', function() {\n        data.zipTitle = ($(this).val()).split('\\\\').pop();\n        $fileForm.submit();\n    });\n\n    // Bind save buttons\n    var editNav = $('.edit-nav');\n    editNav.off(); // remove any existing event handlers.\n\n    editNav.on('click', '.btn-edit-save', function () {\n        save();\n    });\n\n    editNav.on('click', '.btn-edit-save-and-submit-for-review', function () {\n        saveAndCompleteContent(collectionId, data.uri, JSON.stringify(data), true);\n    });\n\n    editNav.on('click', '.btn-edit-save-and-submit-for-approval', function () {\n        saveAndReviewContent(collectionId, data.uri, JSON.stringify(data), true);\n    });\n\n\n    /* FUNCTIONS */\n    function bindZipSubmit() {\n        // Upload ZIP file\n        $('#upload-vis').on('submit', function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n\n            var formdata = new FormData($(this)[0]),\n                file = this[0].files[0];\n\n            if (!$('#input-vis')) {\n                sweetAlert(\"Please choose a file before submitting\");\n                return false;\n            }\n\n            $('.input__file').attr('data-file-title', 'File uploading ...');\n\n            var fileNameNoSpace = file.name.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n            var uniqueIdNoSpace = data.uid.replace(/[^a-zA-Z0-9\\.]/g, \"\").toLowerCase();\n            var contentUri = \"/visualisations/\" + uniqueIdNoSpace + \"/content\";\n            var uriUpload = contentUri + \"/\" + fileNameNoSpace;\n            var safeUriUpload = checkPathSlashes(uriUpload);\n\n            path = \"/visualisations/\" + uniqueIdNoSpace;\n\n            deleteAndUploadFile(\n                safeUriUpload, contentUri, formdata,\n                success = function () {\n                    unpackZip(safeUriUpload,\n                        success = function () {\n\n                            // On unpack of Zip refresh the reload editor and preview\n                            loadPageDataIntoEditor(path, collectionId);\n                        }\n                    );\n                }\n            )\n\n        });\n    }\n\n    // Refresh preview (don't use global refreshPreview function because we want do other functions at the same time when selecting different HTML files)\n    function refreshVisPreview(url) {\n        document.getElementById('iframe').contentWindow.location.href = Florence.babbageBaseUrl + path + url;\n    }\n\n    function deleteAndUploadFile(path, contentUri, formData, success) {\n        $.ajax({\n            url: \"/zebedee/DataVisualisationZip/\" + Florence.collection.id + \"?zipPath=\" + contentUri,\n            type: 'DELETE',\n            async: false,\n            cache: false,\n            contentType: false,\n            processData: false,\n            success: function (response) {\n                uploadFile(path, formData, success);\n            },\n            error: function (response) {\n                handleApiError(response);\n            }\n        });\n    }\n\n    function uploadFile(path, formData, success) {\n        // Send zip file to zebedee\n        $.ajax({\n            url: \"/zebedee/content/\" + Florence.collection.id + \"?uri=\" + path,\n            type: 'POST',\n            data: formData,\n            async: false,\n            cache: false,\n            contentType: false,\n            processData: false,\n            success: function (response) {\n                success(response);\n            },\n            error: function (response) {\n                handleApiError(response);\n            }\n        });\n    }\n\n    function unpackZip(zipPath, success, error) {\n        // Unpack contents of ZIP\n        console.log(\"Unpack: \" + zipPath);\n        var url = \"/zebedee/DataVisualisationZip/\" + Florence.collection.id + \"?zipPath=\" + zipPath;\n\n        $.ajax({\n            url: url,\n            contentType: 'application/json',\n            type: 'POST',\n            success: function (response) {\n                success(response);\n            },\n            error: function (response) {\n                if (error) {\n                    error(response);\n                } else {\n                    handleApiError(response);\n                }\n            }\n        });\n    }\n\n    function save() {\n        putContent(collectionId, data.uri, JSON.stringify(data),\n            success = function () {\n                Florence.Editor.isDirty = false;\n                // refreshVisPreview();\n                // refreshPreview();\n                loadPageDataIntoEditor(data.uri, collectionId);\n            },\n            error = function (response) {\n                if (response.status === 409) {\n                    sweetAlert(\"Cannot edit this page\", \"It is already part of another collection.\");\n                } else {\n                    handleApiError(response);\n                }\n            },\n            true\n        );\n    }\n}\n/**\n * Registers service worker (in root of Florence)\n */\n\nif (navigator.serviceWorker) {\n    navigator.serviceWorker.register('../florence/service-worker.js').then(function(registration) {\n        console.log('ServiceWorker registration successful with scope:',  registration.scope);\n    }).catch(function(error) {\n        console.log('ServiceWorker registration failed:', error);\n    });\n}\n/**\n *  A simple jQuery accordion\n *  Requires a container ('js-accordion'), a title ('js-accordion__title) and the content ('js-accordion__content')\n **/\n\nfunction bindAccordions() {\n    var $accordions = $('.js-accordion'),\n        $title = $accordions.find('.js-accordion__title');\n\n    // if ($accordions.length === 1) {\n    //     $accordions.find('.js-accordion__content').addClass('accordion__content--borders');\n    // }\n\n    $title.click(function() {\n        var $this = $(this),\n            $activeAccordions = $('.js-accordion .active'),\n            active = false;\n\n        // Remove class that disables animations on load\n        $this.next('.js-accordion__content').removeClass('disable-animation');\n\n        // Detect whether the accordion is active already or not\n        if ($this.hasClass('active')) {\n            active = true;\n        }\n\n        // Deselect any accordions already active\n        $activeAccordions.closest('.js-accordion').removeClass('active');\n        $activeAccordions.removeClass('active');\n\n        // Activate clicked accordion if it wasn't already\n        if (!active) {\n            $this.closest('.js-accordion').addClass('active');\n            $this.addClass('active');\n            $this.next('.js-accordion__content').addClass('active');\n        }\n\n    });\n}\n/**\n * Controls the enhanced file input type, inputs is hidden off of page so javascript performs functions that you'd see happen natively\n */\n\n$(function() {\n    var $body = $('body');\n\n    // Update file name being displayed when a new one is uploaded\n    $body.on('change', '.input__file input', function() {\n        var $this = $(this),\n            fileName = ($this.val()).split('\\\\').pop(); // split file path by backslashes into an array and use last entry\n\n        $this.closest('label').attr('data-file-title', fileName);\n    });\n\n    // Focus state\n    var $fileInput;\n    $body.on('focusin', '.input__file input', function() {\n        $fileInput = $('.input__file');\n        $fileInput.addClass('focus');\n    });\n    $body.on('focusout', '.input__file input', function() {\n        $fileInput.removeClass('focus');\n    })\n});\n/**\n * Hide panel off-screen\n * @param options = options that can be passed to the function to perform\n *\n * @option onHide = function to run at the end of the hide animation\n * @options moveCenteredPanel = if true then remove margin from the centered selectable panel\n */\n\nfunction hidePanel(options) {\n    $('.js-selectable-table tbody tr').removeClass('selected');\n\n    if (options.onHide) {\n        // Run any functions set to run once the off-screen panel is hidden\n        $('.panel--off-canvas').stop().animate({right: \"-50%\"}, 500, function() {\n            options.onHide();\n        });\n    } else {\n        // Default to just hiding off-screen panel\n        $('.panel--off-canvas').stop().animate({right: \"-50%\"}, 500);\n    }\n\n    if (options.moveCenteredPanel) {\n        // Add the default margin back in for the centered panel\n        $('.panel--centred').animate({marginLeft: \"25%\"}, 800);\n    }\n}\n/**\n * Animate off-screen panel to appear on-screen\n *\n * @param $this = the table item that has been selected\n * @param options = object of options for the function to use\n *\n * @options html = contents of the panel/slider\n * @options moveCenteredPanel = if true then remove margin from the centered selectable panel\n */\n\nfunction showPanel($this, options) {\n\n    if ($this) {\n        $('.js-selectable-table tbody tr').removeClass('selected');\n        $this.addClass('selected');\n    }\n\n    if (options.html) {\n        $('.panel--off-canvas').html(options.html).animate({right: \"0%\"}, 500);\n    } else {\n        $('.panel--off-canvas').animate({right: \"0%\"}, 500);\n    }\n\n    if (options.moveCenteredPanel) {\n        // Remove the margin from the centered panel to make room for off-screen panel\n        $('.panel--centred').animate({marginLeft: \"0\"}, 500);\n    }\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Fzc2V0cy9qcy9tYWluLmpzPzJmYjUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIENvb2tpZVV0aWxzID0ge1xuICBnZXRDb29raWVWYWx1ZTogZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBiID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCcoXnw7KVxcXFxzKicgKyBhICsgJ1xcXFxzKj1cXFxccyooW147XSspJyk7XG4gICAgcmV0dXJuIGIgPyBiLnBvcCgpIDogJyc7XG4gIH1cbn07XG5cbi8vIGlmIHJ1bm5pbmcgaW4gYSBub2RlIGVudmlyb25tZW50IGV4cG9ydCB0aGlzIGFzIGEgbW9kdWxlLlxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gQ29va2llVXRpbHM7XG59XG5cblxuXG5cbi8vIFRoZSBmbG9yZW5jZSBvYmplY3QgaXMgdXNlZCBmb3Igc3RvcmluZyBhcHBsaWNhdGlvbiBzdGF0ZS5cbnZhciBGbG9yZW5jZSA9IEZsb3JlbmNlIHx8IHtcbiAgICAgICAgYmFiYmFnZUJhc2VVcmw6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIHJlZnJlc2hBZG1pbk1lbnU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIERpc3BsYXkgYSBtZXNzYWdlIHRvIHNob3cgdXNlcnMgYXJlIG9uIGRldiBvciBzYW5kcGl0XG4gICAgICAgICAgICBGbG9yZW5jZS5lbnZpcm9ubWVudCA9IGlzRGV2T3JTYW5kcGl0KCk7XG5cbiAgICAgICAgICAgIHZhciBtYWluTmF2SHRtbCA9IHRlbXBsYXRlcy5tYWluTmF2KEZsb3JlbmNlKTtcbiAgICAgICAgICAgICQoJy5qcy1uYXYnKS5odG1sKG1haW5OYXZIdG1sKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0QWN0aXZlQ29sbGVjdGlvbjogZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IFwiY29sbGVjdGlvbj1cIiArIGNvbGxlY3Rpb24uaWQgKyBcIjtwYXRoPS9cIjtcbiAgICAgICAgICAgIGlmICghY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWREYXRlID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdHRlZERhdGUgPSBTdHJpbmdVdGlscy5mb3JtYXRJc29EYXRlU3RyaW5nKGNvbGxlY3Rpb24ucHVibGlzaERhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgRmxvcmVuY2UuY29sbGVjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBpZDogY29sbGVjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBjb2xsZWN0aW9uLm5hbWUsXG4gICAgICAgICAgICAgICAgZGF0ZTogZm9ybWF0dGVkRGF0ZSxcbiAgICAgICAgICAgICAgICBwdWJsaXNoRGF0ZTogY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBjb2xsZWN0aW9uLnR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbkZsb3JlbmNlLkVkaXRvciA9IHtcbiAgICBpc0RpcnR5OiBmYWxzZSxcbiAgICBkYXRhOiB7fVxufTtcblxuRmxvcmVuY2UuQ3JlYXRlQ29sbGVjdGlvbiA9IHtcbiAgICBzZWxlY3RlZFJlbGVhc2U6IFwiXCJcbn07XG5cbkZsb3JlbmNlLmNvbGxlY3Rpb24gPSB7fTtcblxuRmxvcmVuY2UuY29sbGVjdGlvblRvUHVibGlzaCA9IHt9O1xuXG5GbG9yZW5jZS5nbG9iYWxWYXJzID0ge3BhZ2VQYXRoOiAnJywgYWN0aXZlVGFiOiBmYWxzZSwgcGFnZVBvczogJycsIHdlbHNoOiBmYWxzZX07XG5cbkZsb3JlbmNlLkF1dGhlbnRpY2F0aW9uID0ge1xuICAgIGFjY2Vzc1Rva2VuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBDb29raWVVdGlscy5nZXRDb29raWVWYWx1ZShcImFjY2Vzc190b2tlblwiKTtcbiAgICB9LFxuICAgIGlzQXV0aGVudGljYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gRmxvcmVuY2UuQXV0aGVudGljYXRpb24uYWNjZXNzVG9rZW4oKSAhPT0gJyc7XG4gICAgfSxcbiAgICBsb2dnZWRJbkVtYWlsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImxvZ2dlZEluQXNcIik7XG4gICAgfSxcbiAgICB1c2VyVHlwZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJUeXBlXCIpO1xuICAgIH1cbn07XG5cbkZsb3JlbmNlLkhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gY29uZmlybShcIllvdSBoYXZlIHVuc2F2ZWQgY2hhbmdlcy4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNvbnRpbnVlP1wiKTtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIHByb2Nlc3NQcmV2aWV3TG9hZCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyBBZGQgYmFzZSB1cmwgdG8gUmVkdXggZm9yIHVzZSBpbiByZWZhY3RvcmVkIEpTXG52YXIgYmFzZVVybFN0YXRlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL2Jhc2VVcmxTdGF0ZScpO1xuYmFzZVVybFN0YXRlLnNldCh3aW5kb3cubG9jYXRpb24ub3JpZ2luKTtcblxuLy8gaWYgcnVubmluZyBpbiBhIG5vZGUgZW52aXJvbm1lbnQgZXhwb3J0IHRoaXMgYXMgYSBtb2R1bGUuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IEZsb3JlbmNlO1xufVxuXG5cbnZhciBQYXRoVXRpbHMgPSB7XG4gIGlzSnNvbkZpbGU6IGZ1bmN0aW9uICh1cmkpIHtcbiAgICByZXR1cm4gdXJpLmluZGV4T2YoJ2RhdGEuanNvbicsIHVyaS5sZW5ndGggLSAnZGF0YS5qc29uJy5sZW5ndGgpICE9PSAtMTtcbiAgfVxufTtcblxuLy8gaWYgcnVubmluZyBpbiBhIG5vZGUgZW52aXJvbm1lbnQgZXhwb3J0IHRoaXMgYXMgYSBtb2R1bGUuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBQYXRoVXRpbHM7XG59XG5cblxuXG5cbnZhciBTdHJpbmdVdGlscyA9IHtcbiAgdGV4dGFyZWFMaW5lczogZnVuY3Rpb24gKGxpbmUsIG1heExpbmVMZW5ndGgsIHN0YXJ0LCBudW1iZXJPZkxpbmVzQ292ZXJlZCkge1xuXG4gICAgaWYgKHN0YXJ0ICsgbWF4TGluZUxlbmd0aCA+PSBsaW5lLmxlbmd0aCkge1xuICAgICAgLy9jb25zb2xlLmxvZygnTGluZSBMZW5ndGggPSAnICsgbnVtYmVyT2ZMaW5lc0NvdmVyZWQpO1xuICAgICAgcmV0dXJuIG51bWJlck9mTGluZXNDb3ZlcmVkO1xuICAgIH1cblxuICAgIHZhciBzdWJzdHJpbmcgPSBsaW5lLnN1YnN0cihzdGFydCwgbWF4TGluZUxlbmd0aCArIDEpO1xuICAgIHZhciBhY3R1YWxMaW5lTGVuZ3RoID0gc3Vic3RyaW5nLmxhc3RJbmRleE9mKCcgJykgKyAxO1xuXG4gICAgaWYgKGFjdHVhbExpbmVMZW5ndGggPT09IG1heExpbmVMZW5ndGgpIC8vIGVkZ2UgY2FzZSAtIHRoZSBicmVhayBpcyBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lIGV4YWN0bHkgd2l0aCBhIHNwYWNlIGFmdGVyIGl0XG4gICAge1xuICAgICAgYWN0dWFsTGluZUxlbmd0aC0tO1xuICAgIH1cblxuICAgIGlmIChzdGFydCArIGFjdHVhbExpbmVMZW5ndGggPT09IGxpbmUubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gbnVtYmVyT2ZMaW5lc0NvdmVyZWQ7XG4gICAgfVxuXG4gICAgaWYgKGFjdHVhbExpbmVMZW5ndGggPT09IDApIHtcbiAgICAgIGFjdHVhbExpbmVMZW5ndGggPSBtYXhMaW5lTGVuZ3RoO1xuICAgIH1cblxuICAgIC8vaWYobnVtYmVyT2ZMaW5lc0NvdmVyZWQgPCAzMCkge1xuICAgIC8vICBjb25zb2xlLmxvZygnTGluZTogJyArIG51bWJlck9mTGluZXNDb3ZlcmVkICsgJyBsZW5ndGggPSAnICsgYWN0dWFsTGluZUxlbmd0aCk7XG4gICAgLy99XG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLnRleHRhcmVhTGluZXMobGluZSwgbWF4TGluZUxlbmd0aCwgc3RhcnQgKyBhY3R1YWxMaW5lTGVuZ3RoLCBudW1iZXJPZkxpbmVzQ292ZXJlZCArIDEpO1xuICB9LFxuXG4gIGZvcm1hdElzb0RhdGVTdHJpbmc6IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoaW5wdXQpO1xuICAgIHZhciBtaW51dGVzID0gKGRhdGUuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICB2YXIgZm9ybWF0dGVkRGF0ZSA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCdkZC9tbS95eScsIGRhdGUpICsgJyAnICsgZGF0ZS5nZXRIb3VycygpICsgJzonICsgbWludXRlcztcbiAgICByZXR1cm4gZm9ybWF0dGVkRGF0ZTtcbiAgfSxcblxuICBmb3JtYXRJc29GdWxsRGF0ZVN0cmluZzogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShpbnB1dCk7XG4vLyAgICB2YXIgbWludXRlcyA9IChkYXRlLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgdmFyIGZvcm1hdHRlZERhdGUgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnREQgZGQgTU0geXknLCBkYXRlKTsgICAgICAgIC8vKyAnICcgKyBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBtaW51dGVzO1xuICAgIHJldHVybiBmb3JtYXR0ZWREYXRlO1xuICB9LFxuXG4gIGZvcm1hdElzb0Z1bGw6IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoaW5wdXQpO1xuICAgIHZhciBtaW51dGVzID0gKGRhdGUuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICB2YXIgZm9ybWF0dGVkRGF0ZSA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCdERCBkZCBNTSB5eScsIGRhdGUpICsgJyAnICsgZGF0ZS5nZXRIb3VycygpICsgJzonICsgbWludXRlcztcbiAgICByZXR1cm4gZm9ybWF0dGVkRGF0ZTtcbiAgfSxcblxuICBmb3JtYXRJc29GdWxsU2VjOiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGlucHV0KTtcbiAgICB2YXIgbWludXRlcyA9IChkYXRlLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgdmFyIHNlY29uZHMgPSAoZGF0ZS5nZXRTZWNvbmRzKCkgPCAxMCA/ICcwJyA6ICcnKSArIGRhdGUuZ2V0U2Vjb25kcygpO1xuICAgIHZhciBmb3JtYXR0ZWREYXRlID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ0REIGRkIE1NIHl5JywgZGF0ZSkgKyAnICcgKyBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBtaW51dGVzICsgJzonICsgc2Vjb25kcztcbiAgICByZXR1cm4gZm9ybWF0dGVkRGF0ZTtcbiAgfSxcblxuICByYW5kb21JZDogZnVuY3Rpb24gKCkge1xuICAgIHZhciBTNCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAoKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKSB8IDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG4gICAgfTtcbiAgICByZXR1cm4gKFM0KCkgKyBTNCgpKTtcbiAgfVxuXG59O1xuXG4vLyBpZiBydW5uaW5nIGluIGEgbm9kZSBlbnZpcm9ubWVudCBleHBvcnQgdGhpcyBhcyBhIG1vZHVsZS5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cyA9IFN0cmluZ1V0aWxzO1xufVxuXG5mdW5jdGlvbiBkZWxldGVDb2xsZWN0aW9uKGNvbGxlY3Rpb25JZCwgc3VjY2VzcywgZXJyb3IpIHtcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvY29sbGVjdGlvbi9cIiArIGNvbGxlY3Rpb25JZCxcbiAgICB0eXBlOiAnREVMRVRFJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBzdWNjZXNzLCBlcnJvcikge1xuICB2YXIgc2FmZVBhdGggPSBjaGVja1BhdGhTbGFzaGVzKHBhdGgpO1xuICAvLyBzZW5kIGFqYXggY2FsbFxuICAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9jb250ZW50L1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgc2FmZVBhdGgsXG4gICAgdHlwZTogJ0RFTEVURScsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoc3VjY2VzcylcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUVxdWF0aW9uKGNvbGxlY3Rpb25JZCwgcGF0aCwgc3VjY2VzcywgZXJyb3IpIHtcbiAgdmFyIHNhZmVQYXRoID0gY2hlY2tQYXRoU2xhc2hlcyhwYXRoKTtcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvZXF1YXRpb24vXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBzYWZlUGF0aCxcbiAgICB0eXBlOiAnREVMRVRFJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChzdWNjZXNzKVxuICAgICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbihjb2xsZWN0aW9uSWQsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9jb2xsZWN0aW9uL1wiICsgY29sbGVjdGlvbklkLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRDb2xsZWN0aW9uRGV0YWlscyhjb2xsZWN0aW9uSWQsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9jb2xsZWN0aW9uRGV0YWlscy9cIiArIGNvbGxlY3Rpb25JZCxcbiAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgIHR5cGU6ICdHRVQnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgfVxuICB9KTtcbn1cbi8qKlxuICogR2V0cyB0aGUgSlNPTiBmaWxlIGZvciB0aGUgcGFnZVxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHBhdGhcbiAqIEBwYXJhbSBzdWNjZXNzXG4gKiBAcGFyYW0gZXJyb3JcbiAqIEByZXR1cm5zIHsqfVxuICovXG5cbmZ1bmN0aW9uIGdldFBhZ2VEYXRhKGNvbGxlY3Rpb25JZCwgcGF0aCwgc3VjY2VzcywgZXJyb3IpIHtcbiAgdmFyIHNhZmVQYXRoID0gY2hlY2tQYXRoU2xhc2hlcyhwYXRoKTtcbiAgcmV0dXJuICQuYWpheCh7XG4gICAgdXJsOiBcIi96ZWJlZGVlL2RhdGEvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBzYWZlUGF0aCxcbiAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgIHR5cGU6ICdHRVQnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKHN1Y2Nlc3MpXG4gICAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIEdldCBwYWdlIGRhdGEgd2l0aCBvbmx5IHRoZSBwYWdlIGRlc2NyaXB0aW9uLlxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHBhdGhcbiAqIEBwYXJhbSBzdWNjZXNzXG4gKiBAcGFyYW0gZXJyb3JcbiAqIEByZXR1cm5zIHsqfVxuICovXG5mdW5jdGlvbiBnZXRQYWdlRGF0YURlc2NyaXB0aW9uKGNvbGxlY3Rpb25JZCwgcGF0aCwgc3VjY2VzcywgZXJyb3IpIHtcbiAgcmV0dXJuICQuYWpheCh7XG4gICAgdXJsOiBcIi96ZWJlZGVlL2RhdGEvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBwYXRoICsgJyZkZXNjcmlwdGlvbicsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICB0eXBlOiAnR0VUJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChzdWNjZXNzKVxuICAgICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgcGFnZSBkYXRhIHdpdGggb25seSB0aGUgcGFnZSB0aXRsZS5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBwYXRoXG4gKiBAcGFyYW0gc3VjY2Vzc1xuICogQHBhcmFtIGVycm9yXG4gKiBAcmV0dXJucyB7Kn1cbiAqL1xuZnVuY3Rpb24gZ2V0UGFnZURhdGFUaXRsZShjb2xsZWN0aW9uSWQsIHBhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9kYXRhL1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgcGF0aCArICcmdGl0bGUnLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoc3VjY2VzcylcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldEJhYmJhZ2VQYWdlRGF0YShjb2xsZWN0aW9uSWQsIHBhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogcGF0aCArICcvZGF0YScsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICB0eXBlOiAnR0VUJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChzdWNjZXNzKVxuICAgICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cbmZ1bmN0aW9uIGdldFBhZ2VSZXNvdXJjZShjb2xsZWN0aW9uSWQsIHBhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHZhciBzYWZlUGF0aCA9IGNoZWNrUGF0aFNsYXNoZXMocGF0aCk7XG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9yZXNvdXJjZS9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVQYXRoLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoc3VjY2VzcylcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogSHR0cCBwb3N0IHRvIHRoZSB6ZWJlZGVlIEFQSSB0byBnZXQgYSBsaXN0IG9mIHRlYW1zLlxuICogQHBhcmFtIHN1Y2Nlc3NcbiAqIEBwYXJhbSBlcnJvclxuICogQHBhcmFtIG5hbWUgKHRvIGdldCBzcGVjaWZpYyBkZXRhaWxzKVxuICogQHJldHVybnMgeyp9XG4gKi9cbmZ1bmN0aW9uIGdldFRlYW1zKHN1Y2Nlc3MsIGVycm9yLCBuYW1lKSB7XG5cbiAgdmFyIHVybCA9IFwiL3plYmVkZWUvdGVhbXNcIjtcblxuICBpZihuYW1lKSB7XG4gICAgdXJsICs9ICcvJyArIG5hbWU7XG4gIH1cblxuICByZXR1cm4gJC5hamF4KHtcbiAgICB1cmw6IHVybCxcbiAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgIHR5cGU6ICdHRVQnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBIdHRwIHBvc3QgdG8gdGhlIHplYmVkZWUgQVBJIHRvIGdldCBhIGxpc3Qgb2YgdXNlciBwZXJtaXNzaW9ucy5cbiAqIEBwYXJhbSBzdWNjZXNzXG4gKiBAcGFyYW0gZXJyb3JcbiAqIEBwYXJhbSB1c2VySWRcbiAqIEByZXR1cm5zIHsqfVxuICovXG5mdW5jdGlvbiBnZXRVc2VyUGVybWlzc2lvbihzdWNjZXNzLCBlcnJvciwgdXNlcklkKSB7XG5cbiAgdmFyIHVybCA9IFwiL3plYmVkZWUvcGVybWlzc2lvbj9lbWFpbD1cIiArIHVzZXJJZDtcblxuXG4gIHJldHVybiAkLmFqYXgoe1xuICAgIHVybDogdXJsLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgdHlwZTogJ0dFVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIEh0dHAgcG9zdCB0byB0aGUgemViZWRlZSBBUEkgdG8gZ2V0IGEgbGlzdCBvZiB1c2Vycy5cbiAqIEBwYXJhbSBzdWNjZXNzXG4gKiBAcGFyYW0gZXJyb3JcbiAqIEBwYXJhbSB1c2VySWRcbiAqIEByZXR1cm5zIHsqfVxuICovXG5mdW5jdGlvbiBnZXRVc2VycyhzdWNjZXNzLCBlcnJvciwgdXNlcklkKSB7XG5cbiAgdmFyIHVybCA9IFwiL3plYmVkZWUvdXNlcnNcIjtcblxuICBpZih1c2VySWQpIHtcbiAgICB1cmwgKz0gJz9lbWFpbD0nICsgdXNlcklkO1xuICB9XG5cbiAgcmV0dXJuICQuYWpheCh7XG4gICAgdXJsOiB1cmwsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICB0eXBlOiAnR0VUJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgIH1cbiAgfSk7XG59XG5mdW5jdGlvbiBtb3ZlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIG5ld1BhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gICQuYWpheCh7XG4gICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnRtb3ZlL1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgY2hlY2tQYXRoU2xhc2hlcyhwYXRoKSArIFwiJnRvVXJpPVwiICsgY2hlY2tQYXRoU2xhc2hlcyhuZXdQYXRoKSxcbiAgICB0eXBlOiAnUE9TVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoc3VjY2VzcylcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogSFRUUCBwb3N0IHRvIHRoZSB6ZWJlZGVlIEFQSSB0byBzZXQgYSBuZXcgcGFzc3dvcmRcbiAqIEBwYXJhbSBzdWNjZXNzIC0gZnVuY3Rpb24gdG8gcnVuIG9uIHN1Y2Nlc3NcbiAqIEBwYXJhbSBlcnJvciAtIGZ1bmN0aW9uIHRvIHJ1biBvbiBlcnJvclxuICogQHBhcmFtIGVtYWlsIC0gdGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXIgdG8gY2hhbmdlIHRoZSBwYXNzd29yZCBmb3JcbiAqIEBwYXJhbSBwYXNzd29yZCAtIHRoZSBwYXNzd29yZCB0byBzZXRcbiAqIEBwYXJhbSBvbGRQYXNzd29yZCAtIHRoZSBjdXJyZW50IHBhc3N3b3JkIG9mIHRoZSB1c2VyIGlmIHRoZXkgYXJlIG5vdCBhbHJlYWR5IGF1dGhlbnRpY2F0ZWRcbiAqL1xuZnVuY3Rpb24gcG9zdFBhc3N3b3JkKHN1Y2Nlc3MsIGVycm9yLCBlbWFpbCwgcGFzc3dvcmQsIG9sZFBhc3N3b3JkKSB7XG4gICQuYWpheCh7XG4gICAgdXJsOiBcIi96ZWJlZGVlL3Bhc3N3b3JkXCIsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIHR5cGU6ICdQT1NUJyxcbiAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICBlbWFpbDogZW1haWwsXG4gICAgICBvbGRQYXNzd29yZDogb2xkUGFzc3dvcmRcbiAgICB9KSxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZihzdWNjZXNzKSB7XG4gICAgICAgIHN1Y2Nlc3MoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufS8qKlxuICogUG9zdCB0byB0aGUgemViZWRlZSBBUEkgcGVybWlzc2lvbiBlbmRwb2ludC5cbiAqIFNldCBwZXJtaXNzaW9ucyBmb3IgdGhlIGdpdmVuIGVtYWlsIGFkZHJlc3MuXG4gKiBAcGFyYW0gc3VjY2Vzc1xuICogQHBhcmFtIGVycm9yXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgZW1haWwgb2YgdGhlIHVzZXIgdG8gc2V0IHBlcm1pc3Npb25zIGZvclxuICogQHBhcmFtIGFkbWluIC0gYm9vbGVhbiB0cnVlIGlmIHRoZSB1c2VyIHNob3VsZCBiZSBnaXZlbiBhZG1pbiBwZXJtaXNzaW9uc1xuICogQHBhcmFtIGVkaXRvciAtIGJvb2xlYW4gdHJ1ZSBpZiB0aGUgdXNlciBzaG91bGQgYmUgZ2l2ZW4gZWRpdG9yIHBlcm1pc3Npb25zXG4gKi9cbmZ1bmN0aW9uIHBvc3RQZXJtaXNzaW9uKHN1Y2Nlc3MsIGVycm9yLCBlbWFpbCwgYWRtaW4sIGVkaXRvciwgZGF0YVZpc1B1Ymxpc2hlcikge1xuICAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9wZXJtaXNzaW9uXCIsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIHR5cGU6ICdQT1NUJyxcbiAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBlbWFpbDogZW1haWwsXG4gICAgICBhZG1pbjogYWRtaW4sXG4gICAgICBkYXRhVmlzUHVibGlzaGVyOiBkYXRhVmlzUHVibGlzaGVyLFxuICAgICAgZWRpdG9yOiBlZGl0b3JcbiAgICB9KSxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZihzdWNjZXNzKSB7XG4gICAgICAgIHN1Y2Nlc3MoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgYXJlIG5vdCBwZXJtaXR0ZWQgdG8gdXBkYXRlIHBlcm1pc3Npb25zLlwiKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG59ZnVuY3Rpb24gcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIGNvbnRlbnQsIHN1Y2Nlc3MsIGVycm9yLCByZWN1cnNpdmUpIHtcbiAgcG9zdENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50LCB0cnVlLCByZWN1cnNpdmUsXG4gICAgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYoc3VjY2Vzcykge1xuICAgICAgICBzdWNjZXNzKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBvbkVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5mdW5jdGlvbiBhZGREZWxldGVNYXJrZXIodXJpLCB0aXRsZSwgc3VjY2Vzcykge1xuXG4gICAgdmFyIGRlbGV0ZVRhcmdldCA9IHtcbiAgICAgICAgdXJpOiB1cmksXG4gICAgICAgIHVzZXI6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2dnZWRJbkFzJyksXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgY29sbGVjdGlvbklkOiBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkXG4gICAgIH07XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvRGVsZXRlQ29udGVudC9cIixcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkZWxldGVUYXJnZXQpLFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpXG4gICAgICAgICAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiByZW1vdmVEZWxldGVNYXJrZXIodXJpLCBzdWNjZXNzKSB7XG4gICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiBcIi96ZWJlZGVlL0RlbGV0ZUNvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsgdXJpLFxuICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKVxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbnNldHVwRmxvcmVuY2UoKTsvKipcbiAqIEtlZXBzIHRoZSBhY2NvcmRpb24gb3BlbiBpbiB0aGUgdGFiIHNwZWNpZmllZFxuICogQHBhcmFtIGFjdGl2ZSAtIHRoZSBhY3RpdmUgdGFiXG4gKi9cblxuZnVuY3Rpb24gYWNjb3JkaW9uKGFjdGl2ZSkge1xuICB2YXIgYWN0aXZlVGFiID0gcGFyc2VJbnQoYWN0aXZlKTtcbiAgaWYoIWFjdGl2ZVRhYil7XG4gICAgYWN0aXZlVGFiID0gJ25vbmUnO1xuICB9XG4gICQoZnVuY3Rpb24gKCkge1xuICAgICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFxuICAgICAge1xuICAgICAgICBoZWFkZXI6IFwiZGl2LmVkaXQtc2VjdGlvbl9faGVhZFwiLFxuICAgICAgICBoZWlnaHRTdHlsZTogXCJjb250ZW50XCIsXG4gICAgICAgIGFjdGl2ZTogYWN0aXZlVGFiLFxuICAgICAgICBjb2xsYXBzaWJsZTogdHJ1ZVxuICAgICAgfVxuICAgICk7XG4gIH0pO1xufVxuJCgnLnNlY3Rpb24nKS5iaW5kKCdET01TdWJ0cmVlTW9kaWZpZWQnLCBmdW5jdGlvbiAoKXtcblx0JCgnLmF1dG8tc2l6ZScpLnRleHRhcmVhQXV0b1NpemUoKTtcbn0pO1xuXG4vKipcbiAqIENoZWNrcyBmb3IgY2hhbmdlcyBpbiB0aGUgaWZyYW1lIHBhdGhcbiAqIEBwYXJhbSBvbkNoYW5nZWQgLSBmdW5jdGlvblxuICovXG5mdW5jdGlvbiBjaGVja0ZvclBhZ2VDaGFuZ2VkKG9uQ2hhbmdlZCkge1xuICAgIHZhciBpZnJhbWVVcmwgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoO1xuICAgIHZhciBub3dVcmwgPSAkKCcjaWZyYW1lJylbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZTtcblxuICAgIC8vIE9ubHkgdXBkYXRlIFVSTCBpZiBpdCdzIGRpZmZlcmVudCBhbmQgaXQncyBnb3QgYSB2YWxpZCB2YWx1ZSAoaWUgbm90ICdibGFuaycpXG4gICAgaWYgKGlmcmFtZVVybCAhPT0gbm93VXJsICYmICEobm93VXJsID09PSBcIi9ibGFua1wiIHx8IG5vd1VybCA9PT0gXCJibGFua1wiKSkge1xuICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IGZhbHNlO1xuICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAnJztcbiAgICAgICAgaWYgKCFvbkNoYW5nZWQpIHtcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBub3dVcmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvbkNoYW5nZWQobm93VXJsKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVja3MgYSB2YWxpZCBsaW5rXG4gKiBAcGFyYW0gdXJpXG4gKiBAcmV0dXJucyB7Kn0gLSBpZiB2YWxpZCByZXR1cm5zIGEgZm9ybWF0dGVkIHZhbGlkIGxpbmtcbiAqL1xuXG5mdW5jdGlvbiBjaGVja1BhdGhQYXJzZWQgKHVyaSkge1xuICBpZiAodXJpLm1hdGNoKC9eKGh0dHBzP3xmdHApOlxcL1xcLygoW2EtejAtOSRfXFwuXFwrIVxcKlxcJ1xcKFxcKSw7XFw/Jj0tXXwlWzAtOWEtZl17Mn0pKyg6KFthLXowLTkkX1xcLlxcKyFcXCpcXCdcXChcXCksO1xcPyY9LV18JVswLTlhLWZdezJ9KSspP0ApPygoKFthLXowLTldXFwufFthLXowLTldW2EtejAtOS1dKlthLXowLTldXFwuKSpbYS16XVthLXowLTktXSpbYS16MC05XXwoKFxcZHxbMS05XVxcZHwxXFxkezJ9fDJbMC00XVswLTldfDI1WzAtNV0pXFwuKXszfShcXGR8WzEtOV1cXGR8MVxcZHsyfXwyWzAtNF1bMC05XXwyNVswLTVdKSkoOlxcZCspPykoKChcXC8rKFthLXowLTkkX1xcLlxcKyFcXCpcXCdcXChcXCksOzpAJj0tXXwlWzAtOWEtZl17Mn0pKikqKFxcPyhbYS16MC05JF9cXC5cXCshXFwqXFwnXFwoXFwpLDs6QCY9LV18JVswLTlhLWZdezJ9KSopPyk/KT8oIyhbYS16MC05JF9cXC5cXCshXFwqXFwnXFwoXFwpLDs6QCY9LV18JVswLTlhLWZdezJ9KSopPy9pKSkge1xuICAgIHZhciBteVVybCA9IHBhcnNlVVJMKHVyaSk7XG4gICAgdmFyIHNhZmVVcmwgPSBteVVybC5wYXRobmFtZTtcbiAgICBpZiAoc2FmZVVybC5jaGFyQXQoc2FmZVVybC5sZW5ndGgtMSkgPT09ICcvJykge1xuICAgICAgc2FmZVVybCA9IHNhZmVVcmwuc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgcmV0dXJuIHNhZmVVcmw7XG4gIH0gZWxzZSB7XG4gICAgc3dlZXRBbGVydCgnVGhpcyBpcyBub3QgYSB2YWxpZCBsaW5rJyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4vKipcbiAqIENoZWNrcyBmb3IgaW5pdGlhbCBzbGFzaCBhbmQgbm8gdHJhaWxpbmcgc2xhc2hcbiAqIEBwYXJhbSB1cmlcbiAqIEByZXR1cm5zIHsqfSAtIHZhbGlkIGZvcm1hdFxuICovXG5mdW5jdGlvbiBjaGVja1BhdGhTbGFzaGVzICh1cmkpIHtcbiAgdmFyIGNoZWNrZWRVcmkgPSB1cmlbdXJpLmxlbmd0aCAtIDFdID09PSAnLycgPyB1cmkuc3Vic3RyaW5nKDAsIHVyaS5sZW5ndGggLSAxKSA6IHVyaTtcbiAgY2hlY2tlZFVyaSA9IGNoZWNrZWRVcmlbMF0gIT09ICcvJyA/ICcvJyArIGNoZWNrZWRVcmkgOiBjaGVja2VkVXJpO1xuICByZXR1cm4gY2hlY2tlZFVyaTtcbn1cblxuLyoqXG4gKiBXaGVuIGNvbnRlbnQgaXMgc2F2ZWQgY2hlY2sgaWYgdGhlIGNoYW5nZXMgbWFkZSByZXF1aXJlIHVzIHRvIHJlbmFtZSB0aGUgY29udGVudCwgaS5lLiBjaGFuZ2UgdGhlIHVyaS5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gcmVuYW1lVXJpXG4gKiBAcGFyYW0gb25TYXZlXG4gKi9cbmZ1bmN0aW9uIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpIHtcblxuICAgIGlmIChyZW5hbWVVcmkgJiYgIWRhdGEuZGVzY3JpcHRpb24ubGFuZ3VhZ2UgJiYgIWRhdGEuZGVzY3JpcHRpb24uZWRpdGlvbikgeyAgIC8vIEl0IHdpbGwgbm90IGNoYW5nZSB3ZWxzaCB1cmwgKyBkbyBub3QgcmVuYW1lIGNvbnRlbnQgd2l0aCBlZGl0aW9uLlxuICAgICAgICBkb1JlbmFtZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9uU2F2ZShjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZG9SZW5hbWUoKSB7XG4gICAgICAgIC8vIERvZXMgaXQgaGF2ZSBlZGl0aW9uP1xuICAgICAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uKSB7XG4gICAgICAgICAgICAvLyBDSCAyOS8wNC8yMDE2IGRpc2FibGluZyB0aGUgVVJJIGNoYW5nZSBvZiBjb250ZW50IHdpdGggYW4gZWRpdGlvbiBhcyBpdCBicmVha3MgdGhlIGxpbmsgb2YgcHJldmlvdXMgZWRpdGlvbnNcbiAgICAgICAgICAgIC8vbW92ZUNvbnRlbnRXaXRoRWRpdGlvbkluVXJpKCk7XG4gICAgICAgICAgICBvblNhdmUoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3N0YXRpY19hZGhvYycpIHtcbiAgICAgICAgICAgIG1vdmVBZEhvYygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbW92ZUNvbnRlbnRXaXRob3V0RWRpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW92ZUFkSG9jKCkge1xuICAgICAgICB2YXIgdGl0bGVOb1NwYWNlID0gZGF0YS5kZXNjcmlwdGlvbi50aXRsZS5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB2YXIgcmVmZXJlbmNlTm9TcGFjZSA9IGRhdGEuZGVzY3JpcHRpb24ucmVmZXJlbmNlLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciB0bXBOZXdVcmkgPSBkYXRhLnVyaS5zcGxpdChcIi9cIik7XG4gICAgICAgIHRtcE5ld1VyaS5zcGxpY2UoW3RtcE5ld1VyaS5sZW5ndGggLSAxXSwgMSwgcmVmZXJlbmNlTm9TcGFjZSArIHRpdGxlTm9TcGFjZSk7XG4gICAgICAgIHZhciBuZXdVcmkgPSB0bXBOZXdVcmkuam9pbihcIi9cIik7XG5cbiAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbW92ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgbmV3VXJpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZ2V0UGFnZURhdGEoY29sbGVjdGlvbklkLCBuZXdVcmksIGZ1bmN0aW9uIChwYWdlRGF0YSkgeyAvLyBnZXQgdGhlIHVwZGF0ZWQgZGF0YSBhZnRlciBkb2luZyB0aGUgbW92ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBwYWdlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBuZXdVcmk7XG4gICAgICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgICAgICBvblNhdmUoY29sbGVjdGlvbklkLCBuZXdVcmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25FcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU2F2ZShjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aXRsZU5vU3BhY2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW92ZUNvbnRlbnRXaXRoRWRpdGlvbkluVXJpKCkge1xuICAgICAgICAvL1NwZWNpYWwgY2FzZSBkYXRhc2V0IGVkaXRpb25zLiBUaGV5IGhhdmUgZWRpdGlvbiBidXQgbm90IHRpdGxlXG4gICAgICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLnRpdGxlKSB7XG4gICAgICAgICAgICB2YXIgdGl0bGVOb1NwYWNlID0gZGF0YS5kZXNjcmlwdGlvbi50aXRsZS5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlZGl0aW9uTm9TcGFjZSA9IGRhdGEuZGVzY3JpcHRpb24uZWRpdGlvbi5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB2YXIgdG1wTmV3VXJpID0gZGF0YS51cmkuc3BsaXQoXCIvXCIpO1xuICAgICAgICBpZiAoZGF0YS50eXBlID09PSAnZGF0YXNldCcpIHtcbiAgICAgICAgICAgIHRtcE5ld1VyaS5zcGxpY2UoW3RtcE5ld1VyaS5sZW5ndGggLSAxXSwgMSwgZWRpdGlvbk5vU3BhY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdG1wTmV3VXJpLnNwbGljZShbdG1wTmV3VXJpLmxlbmd0aCAtIDJdLCAyLCB0aXRsZU5vU3BhY2UsIGVkaXRpb25Ob1NwYWNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBuZXdVcmkgPSB0bXBOZXdVcmkuam9pbihcIi9cIik7XG5cbiAgICAgICAgLy8gc2F2ZSBhbnkgY2hhbmdlcyBiZWZvcmUgYWN0dWFsbHkgZG9pbmcgdGhlIG1vdmVcbiAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbW92ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgbmV3VXJpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdldFBhZ2VEYXRhKGNvbGxlY3Rpb25JZCwgbmV3VXJpLCBmdW5jdGlvbiAocGFnZURhdGEpIHsgLy8gZ2V0IHRoZSB1cGRhdGVkIGRhdGEgYWZ0ZXIgZG9pbmcgdGhlIG1vdmUuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gcGFnZURhdGE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBuZXdVcmk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lzIGl0IGEgY29tcGVuZGl1bT8gUmVuYW1lIGNoaWxkcmVuIGFycmF5XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Rha2UgdGhpcyBvdXQgaWYgbW92ZUNvbnRlbnQgaW4gWmViZWRlZSB3b3Jrc1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNoYXB0ZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuY2hhcHRlcnMgPSByZW5hbWVDb21wZW5kaXVtQ2hpbGRyZW4oZGF0YS5jaGFwdGVycywgdGl0bGVOb1NwYWNlLCBlZGl0aW9uTm9TcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGFzZXRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YXNldHMgPSByZW5hbWVDb21wZW5kaXVtQ2hpbGRyZW4oZGF0YS5kYXRhc2V0cywgdGl0bGVOb1NwYWNlLCBlZGl0aW9uTm9TcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlKGNvbGxlY3Rpb25JZCwgbmV3VXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgb25TYXZlKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW92ZUNvbnRlbnRXaXRob3V0RWRpdGlvbigpIHtcbiAgICAgICAgdmFyIHRpdGxlTm9TcGFjZSA9IGRhdGEuZGVzY3JpcHRpb24udGl0bGUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdmFyIHRtcE5ld1VyaSA9IGRhdGEudXJpLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgLy9BcnRpY2xlcyB3aXRoIG5vIGVkaXRpb24uIEFkZCBkYXRlIGFzIGVkaXRpb25cbiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ2FydGljbGUnIHx8IGRhdGEudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKTtcbiAgICAgICAgICAgIHZhciBlZGl0aW9uRGF0ZSA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCd5eS1tbS1kZCcsIG5ldyBEYXRlKGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUpKTtcbiAgICAgICAgICAgIHRtcE5ld1VyaS5zcGxpY2UoW3RtcE5ld1VyaS5sZW5ndGggLSAyXSwgMiwgdGl0bGVOb1NwYWNlLCBlZGl0aW9uRGF0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0bXBOZXdVcmkuc3BsaWNlKFt0bXBOZXdVcmkubGVuZ3RoIC0gMV0sIDEsIHRpdGxlTm9TcGFjZSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5ld1VyaSA9IHRtcE5ld1VyaS5qb2luKFwiL1wiKTtcblxuICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBtb3ZlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBuZXdVcmksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFnZURhdGEoY29sbGVjdGlvbklkLCBuZXdVcmksIGZ1bmN0aW9uIChwYWdlRGF0YSkgeyAvLyBnZXQgdGhlIHVwZGF0ZWQgZGF0YSBhZnRlciBkb2luZyB0aGUgbW92ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBwYWdlRGF0YTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUGF0aCA9IG5ld1VyaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgaXQgaXMgYSBkYXRhc2V0IHJlbmFtZSBjaGlsZHJlbiBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgLy90YWtlIHRoaXMgb3V0IGlmIG1vdmVDb250ZW50IGluIFplYmVkZWUgd29ya3NcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdkYXRhc2V0X2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhc2V0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFzZXRzID0gcmVuYW1lRGF0YXNldENoaWxkcmVuKGRhdGEuZGF0YXNldHMsIHRpdGxlTm9TcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlKGNvbGxlY3Rpb25JZCwgbmV3VXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgb25TYXZlKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm4gdGhlIGxhc3QgZWRpdGVkIGV2ZW50IGZvciB0aGUgZ2l2ZW4gcGFnZSwgZnJvbSB0aGUgZ2l2ZW4gY29sbGVjdGlvbi5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uXG4gKiBAcGFyYW0gcGFnZVxuICogQHJldHVybnMgeyp9XG4gKi9cbmZ1bmN0aW9uIGdldExhc3RFZGl0ZWRFdmVudChjb2xsZWN0aW9uLCBwYWdlKSB7XG5cbiAgdmFyIHVyaSA9IHBhZ2U7XG4gIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuXG4gIHZhciBwYWdlRXZlbnRzID0gY29sbGVjdGlvbi5ldmVudHNCeVVyaVtzYWZlVXJpXTtcblxuICB2YXIgbGFzdEVkaXRlZEV2ZW50ID0gXy5jaGFpbihwYWdlRXZlbnRzKVxuICAgIC5maWx0ZXIoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICByZXR1cm4gZXZlbnQudHlwZSA9PT0gJ0VESVRFRCc7XG4gICAgfSlcbiAgICAuc29ydEJ5KGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgcmV0dXJuIGV2ZW50LmRhdGU7XG4gICAgfSlcbiAgICAubGFzdCgpXG4gICAgLnZhbHVlKCk7XG5cbiAgcmV0dXJuIGxhc3RFZGl0ZWRFdmVudDtcbn1cblxuLyoqXG4gKiBSZXR1cm4gdGhlIGNvbGxlY3Rpb24gY3JlYXRlZCBldmVudCBmcm9tIHRoZSBnaXZlbiBjb2xsZWN0aW9uIG9mIGV2ZW50cy5cbiAqIEBwYXJhbSBldmVudHNcbiAqIEByZXR1cm5zIHsqfVxuICovXG5mdW5jdGlvbiBnZXRDb2xsZWN0aW9uQ3JlYXRlZEV2ZW50KGV2ZW50cykge1xuXG4gIHZhciBldmVudCA9IF8uY2hhaW4oZXZlbnRzKVxuICAgIC5maWx0ZXIoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICByZXR1cm4gZXZlbnQudHlwZSA9PT0gJ0NSRUFURUQnO1xuICAgIH0pXG4gICAgLmxhc3QoKVxuICAgIC52YWx1ZSgpO1xuXG4gIHJldHVybiBldmVudDtcbn1cblxuLyoqXG4gKiBSZXR1cm4gdGhlIGxhc3QgY29tcGxldGVkIGV2ZW50IGZvciB0aGUgZ2l2ZW4gcGFnZSwgZnJvbSB0aGUgZ2l2ZW4gY29sbGVjdGlvbi5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uXG4gKiBAcGFyYW0gcGFnZVxuICogQHJldHVybnMgeyp9XG4gKi9cbmZ1bmN0aW9uIGdldExhc3RDb21wbGV0ZWRFdmVudChjb2xsZWN0aW9uLCBwYWdlKSB7XG5cbiAgdmFyIHVyaSA9IHBhZ2U7XG4gIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuXG4gICB2YXIgbGFzdENvbXBsZXRlZEV2ZW50O1xuXG4gIGlmIChjb2xsZWN0aW9uLmV2ZW50c0J5VXJpKSB7XG4gICAgdmFyIHBhZ2VFdmVudHMgPSBjb2xsZWN0aW9uLmV2ZW50c0J5VXJpW3NhZmVVcmldO1xuICAgIGlmIChwYWdlRXZlbnRzKSB7XG4gICAgICBsYXN0Q29tcGxldGVkRXZlbnQgPSBfLmNoYWluKHBhZ2VFdmVudHMpXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50LnR5cGUgPT09ICdDT01QTEVURUQnO1xuICAgICAgICB9KVxuICAgICAgICAuc29ydEJ5KGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHJldHVybiBldmVudC5kYXRlO1xuICAgICAgICB9KVxuICAgICAgICAubGFzdCgpXG4gICAgICAgIC52YWx1ZSgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGFzdENvbXBsZXRlZEV2ZW50O1xufVxuXG4vLyBDb3B5IGNoYXJ0IG1hcmtkb3duIHRvIGNsaXBib2FyZCAoY2xpcGJvYXJkLmpzIHBsdWdpbilcbnZhciBjbGlwYm9hcmQgPSBudWxsO1xuZnVuY3Rpb24gaW5pdGlhbGlzZUNsaXBib2FyZCgpIHtcbiAgICB2YXIgaTtcblxuICAgIC8vIEFkZCBpbmRleCB0byBhbnkgdHJpZ2dlci90YXJnZXQgdGhhdCB3aWxsIHVzZSBjbGlwYm9hcmQuanMgc28gd2UgY2FuIGlkZW50aWZ5IGVhY2ggZWxlbWVudCBpbmRpdmlkdWFsbHlcbiAgICAkKCcuY29weS1tYXJrZG93bicpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgaWYgKCEkdGhpcy5oYXNDbGFzcygnY29weS1tYXJrZG93bl8nICsgaW5kZXgpKSB7XG4gICAgICAgICAgICAkdGhpcy5hZGRDbGFzcygnY29weS1tYXJrZG93bl8nICsgaW5kZXgpLmF0dHIoJ2RhdGEtY2xpcGJvYXJkLWluZGV4JywgaW5kZXgpO1xuICAgICAgICAgICAgJHRoaXMuY2xvc2VzdCgnLmVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbScpLmZpbmQoJy5jb3B5LW1hcmtkb3duLXRhcmdldCcpLmF0dHIoJ2lkJywgJ2NvcHktbWFya2Rvd24tdGFyZ2V0XycgKyBpbmRleCk7XG4gICAgICAgICAgICAkdGhpcy5maW5kKCcudGljay1hbmltYXRpb24tdHJpZ2dlcicpLmFkZENsYXNzKCd0aWNrLWFuaW1hdGlvbi10cmlnZ2VyXycgKyBpbmRleCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZpcmUgY2xpcGJvYXJkIGluaXRpYWxpc2F0aW9uXG4gICAgY2xpcGJvYXJkID0gbmV3IENsaXBib2FyZCgnLmNvcHktbWFya2Rvd24nLCB7XG4gICAgICAgIHRhcmdldDogZnVuY3Rpb24odHJpZ2dlcikge1xuICAgICAgICAgICAgaSA9ICQodHJpZ2dlcikuYXR0cignZGF0YS1jbGlwYm9hcmQtaW5kZXgnKTtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29weS1tYXJrZG93bi10YXJnZXRfJyArIGkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY2xpcGJvYXJkLm9uKCdzdWNjZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB0b2dnbGVUaWNrKGksIFwic2hvd1wiKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRvZ2dsZVRpY2soaSwgXCJoaWRlXCIpXG4gICAgICAgIH0sIDIwMDApO1xuICAgICAgICBlLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgfSk7XG4gICAgY2xpcGJvYXJkLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciBjb3B5aW5nIG1hcmtkb3duXCIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdBY3Rpb246JywgZS5hY3Rpb24pO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdUcmlnZ2VyOicsIGUudHJpZ2dlcik7XG4gICAgfSk7XG5cbiAgICAvLyBTd2l0Y2ggJ2RvbmUnIHRpY2sgb24gYW5kIG9mZlxuICAgIGZ1bmN0aW9uIHRvZ2dsZVRpY2soaSwgc3RhdGUpIHtcbiAgICAgICAgaWYgKHN0YXRlID09IFwic2hvd1wiKSB7XG4gICAgICAgICAgICAkKFwiLmNvcHktbWFya2Rvd25fXCIgKyBpKS5hdHRyKFwic3R5bGVcIiwgXCJjb2xvcjp0cmFuc3BhcmVudDtcIik7XG4gICAgICAgIH1cbiAgICAgICAgJChcIi50aWNrLWFuaW1hdGlvbi10cmlnZ2VyX1wiICsgaSkudG9nZ2xlQ2xhc3MoXCJkcmF3blwiKTtcbiAgICAgICAgaWYgKHN0YXRlID09IFwiaGlkZVwiKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBzaG93QnRuVGV4dCAoKSB7ICQoXCIuY29weS1tYXJrZG93bl9cIiArIGkpLnJlbW92ZUF0dHIoXCJzdHlsZVwiKTt9XG4gICAgICAgICAgICBzZXRUaW1lb3V0KHNob3dCdG5UZXh0LCAxNjAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNyZWF0ZUNvbGxlY3Rpb24odGVhbXMpIHtcblxuICAgIHZhciBwdWJsaXNoVGltZSwgY29sbGVjdGlvbklkLCBjb2xsZWN0aW9uRGF0ZSwgcmVsZWFzZVVyaTtcbiAgICBjb2xsZWN0aW9uSWQgPSAkKCcjY29sbGVjdGlvbm5hbWUnKS52YWwoKTtcbiAgICB2YXIgcHVibGlzaFR5cGUgPSAkKCdpbnB1dFtuYW1lPVwicHVibGlzaFR5cGVcIl06Y2hlY2tlZCcpLnZhbCgpO1xuICAgIHZhciBzY2hlZHVsZVR5cGUgPSAkKCdpbnB1dFtuYW1lPVwic2NoZWR1bGVUeXBlXCJdOmNoZWNrZWQnKS52YWwoKTtcblxuICAgIGlmIChwdWJsaXNoVHlwZSA9PT0gJ3NjaGVkdWxlZCcpIHtcbiAgICAgICAgcHVibGlzaFRpbWUgPSBwYXJzZUludCgkKCcjaG91cicpLnZhbCgpKSArIHBhcnNlSW50KCQoJyNtaW4nKS52YWwoKSk7XG4gICAgICAgIHZhciB0b0lzb0RhdGUgPSAkKCcjZGF0ZScpLmRhdGVwaWNrZXIoXCJnZXREYXRlXCIpO1xuICAgICAgICBjb2xsZWN0aW9uRGF0ZSA9IG5ldyBEYXRlKHBhcnNlSW50KG5ldyBEYXRlKHRvSXNvRGF0ZSkuZ2V0VGltZSgpKSArIHB1Ymxpc2hUaW1lKS50b0lTT1N0cmluZygpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbGxlY3Rpb25EYXRlID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoc2NoZWR1bGVUeXBlID09PSAncmVsZWFzZScgJiYgcHVibGlzaFR5cGUgPT09ICdzY2hlZHVsZWQnKSB7XG4gICAgICAgIGlmICghRmxvcmVuY2UuQ3JlYXRlQ29sbGVjdGlvbi5zZWxlY3RlZFJlbGVhc2UpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1BsZWFzZSBzZWxlY3QgYSByZWxlYXNlJyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZWxlYXNlVXJpID0gRmxvcmVuY2UuQ3JlYXRlQ29sbGVjdGlvbi5zZWxlY3RlZFJlbGVhc2UudXJpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJlbGVhc2VVcmkgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIGlubGluZSB0ZXN0c1xuICAgIGlmIChjb2xsZWN0aW9uSWQgPT09ICcnKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgaXMgbm90IGEgdmFsaWQgY29sbGVjdGlvbiBuYW1lJywgXCJBIGNvbGxlY3Rpb24gbmFtZSBjYW4ndCBiZSBlbXB0eVwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjb2xsZWN0aW9uSWQubWF0Y2goL1xcLi8pKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgaXMgbm90IGEgdmFsaWQgY29sbGVjdGlvbiBuYW1lJywgXCJZb3UgY2FuJ3QgdXNlIGZ1bGxzdG9wc1wiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICgocHVibGlzaFR5cGUgPT09ICdzY2hlZHVsZWQnKSAmJiAoc2NoZWR1bGVUeXBlID09PSAnY3VzdG9tJykgJiYgKGlzVmFsaWREYXRlKG5ldyBEYXRlKGNvbGxlY3Rpb25EYXRlKSkpKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgaXMgbm90IGEgdmFsaWQgZGF0ZScpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKChwdWJsaXNoVHlwZSA9PT0gJ3NjaGVkdWxlZCcpICYmIChzY2hlZHVsZVR5cGUgPT09ICdjdXN0b20nKSAmJiAoRGF0ZS5wYXJzZShjb2xsZWN0aW9uRGF0ZSkgPCBuZXcgRGF0ZSgpKSkge1xuICAgICAgICBzd2VldEFsZXJ0KCdUaGlzIGlzIG5vdCBhIHZhbGlkIGRhdGUnKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcblxuICAgICAgICAvLyBBZGQgbG9hZGluZyBpY29uIHRvIGJ1dHRvblxuICAgICAgICBsb2FkaW5nQnRuKCQoJy5idG4tY29sbGVjdGlvbi1jcmVhdGUnKSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBjb2xsZWN0aW9uXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvY29sbGVjdGlvblwiLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZTogY29sbGVjdGlvbklkLFxuICAgICAgICAgICAgICAgIHR5cGU6IHB1Ymxpc2hUeXBlLFxuICAgICAgICAgICAgICAgIHB1Ymxpc2hEYXRlOiBjb2xsZWN0aW9uRGF0ZSxcbiAgICAgICAgICAgICAgICBwZW5kaW5nRGVsZXRlczogW10sXG4gICAgICAgICAgICAgICAgdGVhbXM6IHRlYW1zLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Pd25lcjogRmxvcmVuY2UuQXV0aGVudGljYXRpb24udXNlclR5cGUoKSxcbiAgICAgICAgICAgICAgICByZWxlYXNlVXJpOiByZWxlYXNlVXJpXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgRmxvcmVuY2Uuc2V0QWN0aXZlQ29sbGVjdGlvbihjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoJycsIGNvbGxlY3Rpb24uaWQsICdicm93c2UnLCBjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gaXNWYWxpZERhdGUoZCkge1xuICAgIGlmICghaXNOYU4oZC5nZXRUaW1lKCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogSGFuZGxlcyB0aGUgaW5pdGlhbCBjcmVhdGlvbiBvZiB0aGUgd29ya3NwYWNlIHNjcmVlbi5cbiAqIEBwYXJhbSBwYXRoIC0gcGF0aCB0byBpZnJhbWVcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBtZW51IC0gb3BlbnMgYSBzcGVjaWZpYyBtZW51XG4gKiBAcGFyYW0gY29sbGVjdGlvbkRhdGEgLSBKU09OIG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSBzdG9wRXZlbnRMaXN0ZW5lciAtIHNlcGFyYXRlcyB0aGUgbGluayBiZXR3ZWVuIGVkaXRvciBhbmQgaWZyYW1lXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqKi9cblxuZnVuY3Rpb24gY3JlYXRlV29ya3NwYWNlKHBhdGgsIGNvbGxlY3Rpb25JZCwgbWVudSwgY29sbGVjdGlvbkRhdGEsIHN0b3BFdmVudExpc3RlbmVyKSB7XG4gICAgdmFyIHNhZmVQYXRoID0gJyc7XG5cbiAgICAkKFwiI3dvcmtpbmctb25cIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIH0pOyAvLyBhZGQgZXZlbnQgbGlzdGVuZXIgdG8gbWFpbk5hdlxuXG4gICAgaWYgKHN0b3BFdmVudExpc3RlbmVyKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWUnKS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYnJvd3NlckxvY2F0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgICAgICAgICQoJy5icm93c2VyLWxvY2F0aW9uJykudmFsKGJyb3dzZXJMb2NhdGlvbik7XG4gICAgICAgICAgICB2YXIgaWZyYW1lRXZlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdztcbiAgICAgICAgICAgIGlmcmFtZUV2ZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgRmxvcmVuY2UuSGFuZGxlciwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY3VycmVudFBhdGggPSAnJztcbiAgICAgICAgaWYgKHBhdGgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gcGF0aDtcbiAgICAgICAgICAgIHNhZmVQYXRoID0gY2hlY2tQYXRoU2xhc2hlcyhjdXJyZW50UGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBzYWZlUGF0aDtcbiAgICAgICAgaWYgKEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2ggIT09IHRydWUpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IFwibGFuZz1cIiArIFwiZW47cGF0aD0vXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBcImxhbmc9XCIgKyBcImN5O3BhdGg9L1wiO1xuICAgICAgICB9XG4gICAgICAgIEZsb3JlbmNlLnJlZnJlc2hBZG1pbk1lbnUoKTtcblxuICAgICAgICB2YXIgd29ya1NwYWNlID0gdGVtcGxhdGVzLndvcmtTcGFjZShGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCArIHNhZmVQYXRoKTtcbiAgICAgICAgJCgnLnNlY3Rpb24nKS5odG1sKHdvcmtTcGFjZSk7XG5cbiAgICAgICAgLy8gU3RvcmUgbmF2IG9iamVjdHNcbiAgICAgICAgdmFyICRuYXYgPSAkKCcuanMtd29ya3NwYWNlLW5hdicpLFxuICAgICAgICAgICAgJG5hdkl0ZW0gPSAkbmF2LmZpbmQoJy5qcy13b3Jrc3BhY2UtbmF2X19pdGVtJyk7XG5cbiAgICAgICAgLy8gU2V0IGJyb3dzZSBwYW5lbCB0byBmdWxsIGhlaWdodCB0byBzaG93IGxvYWRpbmcgaWNvblxuICAgICAgICAkKCcubG9hZGVyJykuY3NzKCdtYXJnaW4tdG9wJywgJzg0cHgnKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaGVpZ2h0KCQoJy53b3Jrc3BhY2UtbmF2JykuaGVpZ2h0KCkpO1xuXG5cbiAgICAgICAgLyogU2V0dXAgcHJldmlldyAqL1xuICAgICAgICBpZiAoY29sbGVjdGlvbkRhdGEgJiYgY29sbGVjdGlvbkRhdGEuY29sbGVjdGlvbk93bmVyID09IFwiREFUQV9WSVNVQUxJU0FUSU9OXCIpIHtcbiAgICAgICAgICAgIC8vIERpc2FibGUgcHJldmlldyBmb3IgZGF0YSB2aXNcbiAgICAgICAgICAgICQoJyNicm93c2VyLWxvY2F0aW9uJykuc2hvdygpO1xuICAgICAgICAgICAgJCgnLmJyb3dzZXInKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHVwZGF0ZUJyb3dzZXJVUkwoXCIvXCIpO1xuICAgICAgICAgICAgJCgnI2lmcmFtZScpLmF0dHIoJ3NyYycsIEZsb3JlbmNlLmJhYmJhZ2VCYXNlVXJsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIERldGVjdCBjbGljayBvbiBwcmV2aWV3LCBzdG9wcGluZyBicm93c2luZyBhcm91bmQgcHJldmlldyBmcm9tIGdldHRpbmcgcmlkIG9mIHVuc2F2ZWQgZGF0YSBhY2NpZGVudGFsbHlcbiAgICAgICAgICAgIGRldGVjdFByZXZpZXdDbGljaygpO1xuXG4gICAgICAgICAgICAvLyBEZXRlY3QgY2hhbmdlcyB0byBwcmV2aWV3IGFuZCBoYW5kbGUgYWNjb3JkaW5nbHlcbiAgICAgICAgICAgIHByb2Nlc3NQcmV2aWV3TG9hZChjb2xsZWN0aW9uSWQsIGNvbGxlY3Rpb25EYXRhKTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIHByZXZpZXcgVVJMIG9uIGluaXRpYWwgbG9hZCBvZiB3b3Jrc3BhY2VcbiAgICAgICAgICAgIHVwZGF0ZUJyb3dzZXJVUkwocGF0aCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoRmxvcmVuY2UuZ2xvYmFsVmFycy53ZWxzaCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgJCgnI25hdi0td29ya3NwYWNlX193ZWxzaCcpLmVtcHR5KCkuYXBwZW5kKCc8YSBocmVmPVwiI1wiPkxhbmd1YWdlOiBFbmdsaXNoPC9hPicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnI25hdi0td29ya3NwYWNlX193ZWxzaCcpLmVtcHR5KCkuYXBwZW5kKCc8YSBocmVmPVwiI1wiPkxhbmd1YWdlOiBXZWxzaDwvYT4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIEJpbmQgY2xpY2tpbmcgKi9cbiAgICAgICAgJG5hdkl0ZW0uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbWVudSA9ICcnO1xuICAgICAgICAgICAgaWYgKEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5KSB7XG4gICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJZb3UgaGF2ZSB1bnNhdmVkIGNoYW5nZXMuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjb250aW51ZT9cIixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTWVudUNsaWNrKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb2Nlc3NNZW51Q2xpY2sodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc01lbnVDbGljayhjbGlja2VkKSB7XG4gICAgICAgICAgICB2YXIgbWVudUl0ZW0gPSAkKGNsaWNrZWQpO1xuXG4gICAgICAgICAgICAkbmF2SXRlbS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIG1lbnVJdGVtLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgICAgICAgICBpZiAobWVudUl0ZW0uaXMoJyNicm93c2UnKSkge1xuICAgICAgICAgICAgICAgIGxvYWRCcm93c2VTY3JlZW4oY29sbGVjdGlvbklkLCAnY2xpY2snLCBjb2xsZWN0aW9uRGF0YSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLmlzKCcjY3JlYXRlJykpIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoID0gZ2V0UHJldmlld1VybCgpO1xuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoLCBjb2xsZWN0aW9uSWQsIHR5cGUsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uaXMoJyNlZGl0JykpIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoID0gZ2V0UHJldmlld1VybCgpO1xuICAgICAgICAgICAgICAgIGxvYWRQYWdlRGF0YUludG9FZGl0b3IoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUGF0aCwgRmxvcmVuY2UuY29sbGVjdGlvbi5pZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLmlzKCcjaW1wb3J0JykpIHtcbiAgICAgICAgICAgICAgICBsb2FkSW1wb3J0U2NyZWVuKEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2FkQnJvd3NlU2NyZWVuKGNvbGxlY3Rpb25JZCwgZmFsc2UsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICQoJyNuYXYtLXdvcmtzcGFjZV9fd2Vsc2gnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoID0gRmxvcmVuY2UuZ2xvYmFsVmFycy53ZWxzaCA9PT0gZmFsc2UgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUGF0aCwgY29sbGVjdGlvbklkLCAnYnJvd3NlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLm9uKCdjbGljaycsICcuYnRuLWJyb3dzZS1jcmVhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGVzdCA9ICQoJy50cmVlLW5hdi1ob2xkZXIgdWwnKS5maW5kKCcuanMtYnJvd3NlX19pdGVtLnNlbGVjdGVkJykuYXR0cignZGF0YS11cmwnKTtcbiAgICAgICAgICAgIC8vIHZhciBzcGFuVHlwZSA9ICQodGhpcykucGFyZW50KCkucHJldignc3BhbicpO1xuICAgICAgICAgICAgdmFyIHNwYW5UeXBlID0gJCh0aGlzKS5jbG9zZXN0KCcuanMtYnJvd3NlX19pdGVtJykuZmluZCgnLmpzLWJyb3dzZV9faXRlbS10aXRsZTpmaXJzdCcpO1xuICAgICAgICAgICAgdmFyIHR5cGVDbGFzcyA9IHNwYW5UeXBlWzBdLmF0dHJpYnV0ZXNbMF0ubm9kZVZhbHVlO1xuICAgICAgICAgICAgdmFyIHR5cGVHcm91cCA9IHR5cGVDbGFzcy5tYXRjaCgvLS0oXFx3KikkLyk7XG4gICAgICAgICAgICB2YXIgdHlwZSA9IHR5cGVHcm91cFsxXTtcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBkZXN0O1xuICAgICAgICAgICAgJG5hdkl0ZW0ucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAkKFwiI2NyZWF0ZVwiKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIGxvYWRDcmVhdGVTY3JlZW4oRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUGF0aCwgY29sbGVjdGlvbklkLCB0eXBlLCBjb2xsZWN0aW9uRGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLm9uKCdjbGljaycsICcuYnRuLWJyb3dzZS1kZWxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJHBhcmVudEl0ZW0gPSAkKCcudHJlZS1uYXYtaG9sZGVyIHVsJykuZmluZCgnLmpzLWJyb3dzZV9faXRlbS5zZWxlY3RlZCcpO1xuICAgICAgICAgICAgdmFyICRwYXJlbnRDb250YWluZXIgPSAkcGFyZW50SXRlbS5maW5kKCcucGFnZV9fY29udGFpbmVyLnNlbGVjdGVkJyk7XG4gICAgICAgICAgICB2YXIgJGJ1dHRvbiA9ICRwYXJlbnRDb250YWluZXIuZmluZCgnLmJ0bi1icm93c2UtZGVsZXRlJyk7XG4gICAgICAgICAgICB2YXIgZGVzdCA9ICRwYXJlbnRJdGVtLmF0dHIoJ2RhdGEtdXJsJyk7XG4gICAgICAgICAgICB2YXIgc3BhblR5cGUgPSAkKHRoaXMpLnBhcmVudCgpLnByZXYoJ3NwYW4nKTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IHNwYW5UeXBlLmh0bWwoKTtcbiAgICAgICAgICAgIGFkZERlbGV0ZU1hcmtlcihkZXN0LCB0aXRsZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHBhcmVudENvbnRhaW5lci5hZGRDbGFzcygnYW5pbWF0aW5nJykuYWRkQ2xhc3MoJ2RlbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICB0b2dnbGVEZWxldGVSZXZlcnRCdXR0b24oJHBhcmVudENvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgdG9nZ2xlRGVsZXRlUmV2ZXJ0Q2hpbGRyZW4oJHBhcmVudEl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU3RvcHMgYW5pbWF0aW9uIGhhcHBlbmluZyBhbnl0aW1lIG90aGVyIHRoYW4gd2hlbiBnb2luZyBiZXR3ZWVuIGRlbGV0ZS91bmRvIGRlbGV0ZVxuICAgICAgICAgICAgICAgICRwYXJlbnRDb250YWluZXIub25lKFwid2Via2l0VHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uRW5kXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkcGFyZW50Q29udGFpbmVyLnJlbW92ZUNsYXNzKCdhbmltYXRpbmcnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5vbignY2xpY2snLCAnLmJ0bi1icm93c2UtZGVsZXRlLXJldmVydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkcGFyZW50SXRlbSA9ICQoJy50cmVlLW5hdi1ob2xkZXIgdWwnKS5maW5kKCcuanMtYnJvd3NlX19pdGVtLnNlbGVjdGVkJyk7XG4gICAgICAgICAgICB2YXIgJHBhcmVudENvbnRhaW5lciA9ICRwYXJlbnRJdGVtLmZpbmQoJy5wYWdlX19jb250YWluZXIuc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIHZhciAkYnV0dG9uID0gJHBhcmVudENvbnRhaW5lci5maW5kKCcuYnRuLWJyb3dzZS1kZWxldGUtcmV2ZXJ0Jyk7XG4gICAgICAgICAgICB2YXIgZGVzdCA9ICRwYXJlbnRJdGVtLmF0dHIoJ2RhdGEtdXJsJyk7XG4gICAgICAgICAgICByZW1vdmVEZWxldGVNYXJrZXIoZGVzdCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHBhcmVudENvbnRhaW5lci5hZGRDbGFzcygnYW5pbWF0aW5nJykucmVtb3ZlQ2xhc3MoJ2RlbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICB0b2dnbGVEZWxldGVSZXZlcnRCdXR0b24oJHBhcmVudENvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgdG9nZ2xlRGVsZXRlUmV2ZXJ0Q2hpbGRyZW4oJHBhcmVudEl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU3RvcHMgYW5pbWF0aW9uIGhhcHBlbmluZyBhbnl0aW1lIG90aGVyIHRoYW4gd2hlbiBnb2luZyBiZXR3ZWVuIGRlbGV0ZS91bmRvIGRlbGV0ZVxuICAgICAgICAgICAgICAgICRwYXJlbnRDb250YWluZXIub25lKFwid2Via2l0VHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uRW5kXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkcGFyZW50Q29udGFpbmVyLnJlbW92ZUNsYXNzKCdhbmltYXRpbmcnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5vbignY2xpY2snLCAnLmJ0bi1icm93c2UtbW92ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRwYXJlbnRJdGVtID0gJCgnLnRyZWUtbmF2LWhvbGRlciB1bCcpLmZpbmQoJy5qcy1icm93c2VfX2l0ZW0uc2VsZWN0ZWQnKSxcbiAgICAgICAgICAgICAgICBmcm9tVXJsID0gJHBhcmVudEl0ZW0uYXR0cignZGF0YS11cmwnKTtcblxuICAgICAgICAgICAgbW92ZUJyb3dzZU5vZGUoZnJvbVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLm9uKCdjbGljaycsICcuYnRuLWJyb3dzZS1jcmVhdGUtZGF0YXZpcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkZXN0ID0gJy92aXN1YWxpc2F0aW9ucyc7XG4gICAgICAgICAgICB2YXIgdHlwZSA9ICd2aXN1YWxpc2F0aW9uJztcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBkZXN0O1xuICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoLCBjb2xsZWN0aW9uSWQsIHR5cGUsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51Jykub24oJ2NsaWNrJywgJy5idG4tYnJvd3NlLWVkaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGVzdCA9ICQoJy50cmVlLW5hdi1ob2xkZXIgdWwnKS5maW5kKCcuanMtYnJvd3NlX19pdGVtLnNlbGVjdGVkJykuYXR0cignZGF0YS11cmwnKTtcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBkZXN0O1xuICAgICAgICAgICAgJG5hdkl0ZW0ucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAkKFwiI2VkaXRcIikuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGgsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLm9uKCdjbGljaycsICcuanMtYnJvd3NlX19tZW51JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXNJdGVtID0gJCgnLmpzLWJyb3dzZV9faXRlbS5zZWxlY3RlZCAucGFnZV9fY29udGFpbmVyLnNlbGVjdGVkJyksXG4gICAgICAgICAgICAgICAgJHRoaXNCdG4gPSAkdGhpc0l0ZW0uZmluZCgnLmpzLWJyb3dzZV9fbWVudScpLFxuICAgICAgICAgICAgICAgICR0aGlzTWVudSA9ICR0aGlzQnRuLm5leHQoJy5wYWdlX19tZW51JyksXG4gICAgICAgICAgICAgICAgbWVudUhpZGRlbjtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlTWVudSgpIHtcbiAgICAgICAgICAgICAgICAkdGhpc0J0bi50b2dnbGVDbGFzcygnYWN0aXZlJykuY2hpbGRyZW4oJy5oYW1idXJnZXItaWNvbl9fc3BhbicpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkdGhpc0l0ZW0uZmluZCgnLmpzLWJyb3dzZV9fYnV0dG9ucy0tcHJpbWFyeScpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkdGhpc01lbnUudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUb2dnbGUgbWVudSBvbiBjbGlja1xuICAgICAgICAgICAgdG9nZ2xlTWVudSgpO1xuXG4gICAgICAgICAgICAvLyBTaHV0IG1lbnUgaWYgYW5vdGhlciBpdGVtIG9yIGJ1dHRvbiBpcyBjbGlja2VkXG4gICAgICAgICAgICAkKCcuanMtYnJvd3NlX19pdGVtLXRpdGxlLCAuYnRuLWJyb3dzZS1tb3ZlLCAuYnRuLWJyb3dzZS1kZWxldGUnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1lbnVIaWRkZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlTWVudSgpO1xuICAgICAgICAgICAgICAgICAgICBtZW51SGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG1lbnUgPT09ICdlZGl0Jykge1xuICAgICAgICAgICAgJG5hdkl0ZW0ucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAkKFwiI2VkaXRcIikuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGgsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgIH0gZWxzZSBpZiAobWVudSA9PT0gJ2Jyb3dzZScpIHtcbiAgICAgICAgICAgICRuYXZJdGVtLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgJChcIiNicm93c2VcIikuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICBsb2FkQnJvd3NlU2NyZWVuKGNvbGxlY3Rpb25JZCwgJ2NsaWNrJywgY29sbGVjdGlvbkRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIC8vfTtcbiAgICB9XG59XG5cbi8vIFNIT1VMRCBCRSBSRVBMQUNFRCBCWSAnb25JZnJhbWVMb2FkJyAtICBCaW5kIGNsaWNrIGV2ZW50IHRvIGlmcmFtZSBlbGVtZW50IGFuZCBydW4gZ2xvYmFsIEZsb3JlbmNlLkhhbmRsZXJcbmZ1bmN0aW9uIGRldGVjdFByZXZpZXdDbGljaygpIHtcbiAgICB2YXIgaWZyYW1lRXZlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdztcbiAgICBpZnJhbWVFdmVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIEZsb3JlbmNlLkhhbmRsZXIsIHRydWUpO1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzUHJldmlld0xvYWQoY29sbGVjdGlvbklkLCBjb2xsZWN0aW9uRGF0YSkge1xuICAgIGlmIChjb2xsZWN0aW9uRGF0YSAmJiBjb2xsZWN0aW9uRGF0YS5jb2xsZWN0aW9uT3duZXIgPT0gXCJEQVRBX1ZJU1VBTElTQVRJT05cIikge1xuICAgICAgICAvLyBpZnJhbWUgaXMgYmxhY2tlZCBvdXQgb24gYnJvd3NlIGZvciBkYXRhIHZpcyBjb250ZW50XG4gICAgICAgICQoJyNpZnJhbWUnKS5lbXB0eSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ29sbGVjdGlvbiBvZiBmdW5jdGlvbnMgdG8gcnVuIG9uIGlmcmFtZSBsb2FkXG4gICAgICAgIG9uSWZyYW1lTG9hZChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciAkaWZyYW1lID0gJCgnI2lmcmFtZScpLCAvLyBpZnJhbWUgZWxlbWVudCBpbiBET00sIGNoZWNrIGxlbmd0aCBsYXRlciB0byBlbnN1cmUgaXQncyBvbiB0aGUgcGFnZSBiZWZvcmUgY29udGludWluZ1xuICAgICAgICAgICAgICAgICRicm93c2UgPSAkKCcjYnJvd3NlJyk7IC8vICdCcm93c2UnIG1lbnUgdGFiLCBjaGVjayBsYXRlciBpZiBpdCdzIHNlbGVjdGVkXG5cbiAgICAgICAgICAgIC8vIENoZWNrIGl0IGlzIGEgbG9hZCBldmVudCBhbmQgdGhhdCBpZnJhbWUgaXMgaW4gdGhlIERPTSBzdGlsbCBiZWZvcmUgcHJvY2Vzc2luZyB0aGUgbG9hZFxuICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEgPT0gXCJsb2FkXCIgJiYgJGlmcmFtZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHBhZ2UgVVJMIGlzIGRpZmZlcmVudCBhbmQgdGhlbiBsb2FkIGVkaXRvciBvciB1cGRhdGUgYnJvd3NlIHRyZWVcbiAgICAgICAgICAgICAgICBjaGVja0ZvclBhZ2VDaGFuZ2VkKGZ1bmN0aW9uIChuZXdVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNhZmVVcmwgPSBjaGVja1BhdGhTbGFzaGVzKG5ld1VybCksXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW0gPSAkKCcud29ya3NwYWNlLWJyb3dzZSBsaS5zZWxlY3RlZCcpLmF0dHIoJ2RhdGEtdXJsJyk7IC8vIEdldCBhY3RpdmUgbm9kZSBpbiB0aGUgYnJvd3NlIHRyZWVcblxuICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoID0gc2FmZVVybDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLndvcmtzcGFjZS1lZGl0JykubGVuZ3RoIHx8ICQoJy53b3Jrc3BhY2UtY3JlYXRlJykubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN3aXRjaCB0byBicm93c2Ugc2NyZWVuIGlmIG5hdmlnYXRpbmcgYXJvdW5kIHByZXZpZXcgd2hpbHN0IG9uIGNyZWF0ZSBvciBlZGl0IHRhYlxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZEJyb3dzZVNjcmVlbihjb2xsZWN0aW9uSWQsICdjbGljaycsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgkKCcud29ya3NwYWNlLWJyb3dzZScpLmxlbmd0aCAmJiBzZWxlY3RlZEl0ZW0gIT0gRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSB1cGRhdGUgYnJvd3NlIHRyZWUgb2Ygb24gJ2Jyb3dzZScgdGFiIGFuZCBwcmV2aWV3IGFuZCBhY3RpdmUgbm9kZSBkb24ndCBhbHJlYWR5IG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmVlTm9kZVNlbGVjdChzYWZlVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHVwZGF0ZUJyb3dzZXJVUkwoKTsgLy8gVXBkYXRlIGJyb3dzZXIgcHJldmlldyBVUkxcblxuICAgICAgICAgICAgICAgIGlmICgkYnJvd3NlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyb3dzZVNjcm9sbFBvcygpOyAvLyBVcGRhdGUgYnJvd3NlIHRyZWUgc2Nyb2xsIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8vIFJldXNhYmxlIGlmcmFtZSBzdGFydGxvYWQgZXZlbnQgLSB1c2VzIG1lc3NhZ2Ugc2VudCB1cCBmb3JtIGJhYmJhZ2Ugb24gd2luZG93LmxvYWRcbmZ1bmN0aW9uIG9uSWZyYW1lTG9hZChydW5GdW5jdGlvbikge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgcnVuRnVuY3Rpb24oZXZlbnQpO1xuICAgIH0pO1xufVxuXG4vLyBVcGRhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiBvZiB0aGUgYnJvd3NlIHRyZWUgaWYgc2VsZWN0ZWQgaXRlbSBvZmYgc2NyZWVuXG5mdW5jdGlvbiBicm93c2VTY3JvbGxQb3MoKSB7XG4gICAgdmFyICRzZWxlY3RlZEl0ZW0gPSAkKCcud29ya3NwYWNlLWJyb3dzZSBsaS5zZWxlY3RlZCAucGFnZV9fY29udGFpbmVyLnNlbGVjdGVkJyksXG4gICAgICAgICRicm93c2VUcmVlID0gJCgnLndvcmtzcGFjZS1icm93c2UnKTtcblxuICAgIGlmICgkc2VsZWN0ZWRJdGVtLmxlbmd0aCkge1xuICAgICAgICB2YXIgc2VsZWN0ZWRUb3AgPSAkc2VsZWN0ZWRJdGVtLm9mZnNldCgpLnRvcCxcbiAgICAgICAgICAgIHNlbGVjdGVkQm90dG9tID0gc2VsZWN0ZWRUb3AgKyAkc2VsZWN0ZWRJdGVtLmhlaWdodCgpLFxuICAgICAgICAgICAgYnJvd3NlVG9wID0gJGJyb3dzZVRyZWUub2Zmc2V0KCkudG9wLFxuICAgICAgICAgICAgYnJvd3NlQm90dG9tID0gYnJvd3NlVG9wICsgJGJyb3dzZVRyZWUuaGVpZ2h0KCksXG4gICAgICAgICAgICBuYXZIZWlnaHQgPSAkKCcubmF2JykuaGVpZ2h0KCk7XG5cbiAgICAgICAgaWYgKHNlbGVjdGVkVG9wIDwgYnJvd3NlVG9wKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSXRlbSB3YXMgYWJvdmUgb2Ygdmlld2FibGUgYnJvd3NlIHRyZWUnKTtcbiAgICAgICAgICAgICRicm93c2VUcmVlLnNjcm9sbFRvcCgkYnJvd3NlVHJlZS5zY3JvbGxUb3AoKSArIChzZWxlY3RlZFRvcCkgLSAobmF2SGVpZ2h0IC8gMikpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkQm90dG9tID4gYnJvd3NlQm90dG9tKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSXRlbSB3YXMgYmVsb3cgdmlld2FibGUgYnJvd3NlIHRyZWUnKTtcbiAgICAgICAgICAgICRicm93c2VUcmVlLnNjcm9sbFRvcChzZWxlY3RlZEJvdHRvbSAtIChuYXZIZWlnaHQgLyAyKSAtICRzZWxlY3RlZEl0ZW0uaGVpZ2h0KCkpXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUJyb3dzZXJVUkwodXJsKSB7XG4gICAgaWYoIXVybCkge1xuICAgICAgICB1cmwgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoO1xuICAgIH1cbiAgICAkKCcuYnJvd3Nlci1sb2NhdGlvbicpLnZhbChGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCArIHVybCk7XG59XG5cbi8vIHRvZ2dsZSBkZWxldGUgYnV0dG9uIGZyb20gJ2RlbGV0ZScgdG8gJ3JldmVydCcgZm9yIGNvbnRlbnQgbWFya2VkIGFzIHRvIGJlIGRlbGV0ZWQgYW5kIHJlbW92ZS9zaG93IG90aGVyIGJ1dHRvbnMgaW4gaXRlbVxuZnVuY3Rpb24gdG9nZ2xlRGVsZXRlUmV2ZXJ0QnV0dG9uKCRjb250YWluZXIpIHtcbiAgICAkY29udGFpbmVyLmZpbmQoJy5idG4tYnJvd3NlLWRlbGV0ZS1yZXZlcnQsIC5qcy1icm93c2VfX2J1dHRvbnMtLXByaW1hcnksIC5qcy1icm93c2VfX2J1dHRvbnMtLXNlY29uZGFyeScpLnRvZ2dsZSgpO1xufVxuXG4vLyBUb2dnbGUgZGlzcGxheWluZyBjaGlsZHJlbiBhcyBkZWxldGVkIG9yIG5vdCBkZWxldGVkXG5mdW5jdGlvbiB0b2dnbGVEZWxldGVSZXZlcnRDaGlsZHJlbigkaXRlbSkge1xuICAgIHZhciAkY2hpbGRDb250YWluZXIgPSAkaXRlbS5maW5kKCcuanMtYnJvd3NlX19pdGVtIC5wYWdlX19jb250YWluZXInKSxcbiAgICAgICAgaXNEZWxldGluZyA9ICRpdGVtLmNoaWxkcmVuKCcucGFnZV9fY29udGFpbmVyJykuaGFzQ2xhc3MoJ2RlbGV0ZWQnKTtcblxuICAgIGlmIChpc0RlbGV0aW5nKSB7XG4gICAgICAgICRjaGlsZENvbnRhaW5lci5hZGRDbGFzcygnZGVsZXRlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRjaGlsZENvbnRhaW5lci5yZW1vdmVDbGFzcygnZGVsZXRlZCcpO1xuXG4gICAgICAgIC8vIElmIGEgY2hpbGQgaXRlbSBoYXMgcHJldmlvdXNseSBiZWVuIGRlbGV0ZWQgYnV0IGlzIGJlaW5nIHNob3duIGJ5IGEgcGFyZW50IHRoZW4gdW5kbyB0aGUgdG9nZ2xlIGJ1dHRvbnNcbiAgICAgICAgaWYgKCRjaGlsZENvbnRhaW5lci5maW5kKCcuYnRuLWJyb3dzZS1kZWxldGUtcmV2ZXJ0JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyB0b2dnbGVEZWxldGVSZXZlcnRCdXR0b24oJGNoaWxkQ29udGFpbmVyLmZpbmQoJy5idG4tYnJvd3NlLWRlbGV0ZS1yZXZlcnQnKSk7XG4gICAgICAgICAgICB0b2dnbGVEZWxldGVSZXZlcnRCdXR0b24oJGNoaWxkQ29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjaGlsZENvbnRhaW5lci5maW5kKCcucGFnZV9fYnV0dG9ucycpLnRvZ2dsZUNsYXNzKCdkZWxldGVkJyk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZVRlYW0obmFtZSkge1xuICAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS90ZWFtcy9cIiArIG5hbWUsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIHR5cGU6ICdERUxFVEUnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHN3ZWV0QWxlcnQoJ0RlbGV0ZWQnLCBcIlRoZSB0ZWFtIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBkZWxldGVkXCIsICdzdWNjZXNzJyk7XG4gICAgICB2aWV3Q29udHJvbGxlcigndGVhbXMnKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICBzd2VldEFsZXJ0KFwiRXJyb3JcIiwgXCJZb3UgYXJlIG5vdCBwZXJtaXR0ZWQgdG8gZGVsZXRlIHRlYW1zXCIsIFwiZXJyb3JcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlVGVhbU1lbWJlcihuYW1lLCBlbWFpbCkge1xuICB2YXIgZW5jb2RlZE5hbWUgPSBlbmNvZGVVUklDb21wb25lbnQobmFtZSk7XG4gICQuYWpheCh7XG4gICAgdXJsOiBcIi96ZWJlZGVlL3RlYW1zL1wiICsgZW5jb2RlZE5hbWUgKyBcIj9lbWFpbD1cIiArIGVtYWlsLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB0eXBlOiAnREVMRVRFJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZygnVGVhbSBtZW1iZXIgZGVsZXRlZDogJyArIGVtYWlsKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGhhbmRsZVVzZXJQb3N0RXJyb3IocmVzcG9uc2UpO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBlcnJvciByZXNwb25zZSBmcm9tIGNyZWF0aW5nIHRoZSB0ZWFtLlxuICAgKiBAcGFyYW0gcmVzcG9uc2VcbiAgICovXG4gIGZ1bmN0aW9uIGhhbmRsZVVzZXJQb3N0RXJyb3IocmVzcG9uc2UpIHtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgYXJlIG5vdCBwZXJtaXR0ZWQgdG8gZGVsZXRlIHVzZXJzLlwiKTtcbiAgICB9XG4gICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZGVsZXRlVW5wdWJsaXNoZWRWZXJzaW9uIChjb2xsZWN0aW9uSWQsIHBhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gIHZhciB1cmwgPSBcIi96ZWJlZGVlL3ZlcnNpb24vXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBwYXRoO1xuXG4gIC8vIFVwZGF0ZSBjb250ZW50XG4gICQuYWpheCh7XG4gICAgdXJsOiB1cmwsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIHR5cGU6ICdERUxFVEUnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3IocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZVVzZXIoZW1haWwpIHtcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvdXNlcnM/ZW1haWw9XCIgKyBlbWFpbCxcbiAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgdHlwZTogJ0RFTEVURScsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coJ1VzZXIgZGVsZXRlZCcpO1xuICAgICAgc3dlZXRBbGVydCgnRGVsZXRlZCcsIFwiVXNlciAnXCIgICsgZW1haWwgKyBcIicgaGFzIGJlZW4gZGVsZXRlZFwiLCAnc3VjY2VzcycpO1xuICAgICAgdmlld0NvbnRyb2xsZXIoJ3VzZXJzJyk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIFwiWW91IGFyZSBub3QgcGVybWl0dGVkIHRvIGRlbGV0ZSB1c2Vyc1wiLCBcImVycm9yXCIpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBNYW5hZ2UgZmlsZXMgYXNzb2NpYXRlZCB3aXRoIGRhdGFzZXRzLiBXaGVuIHVwbG9hZGluZyBhIGZpbGUgY3JlYXRlcyBhIG5ldyBkYXRhc2V0XG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleVxuICogQHBhcmFtIGlkRmllbGQgLSBIVE1MIGlkIGZvciB0aGUgdGVtcGxhdGUgKGhhcyB0byBiZSAnZWRpdGlvbicpXG4gKi9cblxuZnVuY3Rpb24gYWRkRGF0YXNldChjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGRvd25sb2FkRXh0ZW5zaW9ucywgcGFnZVR5cGU7XG4gICAgdmFyIHVyaVVwbG9hZDtcbiAgICB2YXIgbGFzdEluZGV4O1xuICAgIGlmIChkYXRhW2ZpZWxkXSkge1xuICAgICAgICBsYXN0SW5kZXggPSBkYXRhW2ZpZWxkXS5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGFzdEluZGV4ID0gMDtcbiAgICB9XG4gICAgdmFyIHVwbG9hZGVkTm90U2F2ZWQgPSB7dXBsb2FkZWQ6IGZhbHNlLCBzYXZlZDogZmFsc2UsIGVkaXRpb25Vcmk6IFwiXCJ9O1xuICAgICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyk7XG5cbiAgICAvL0FkZFxuICAgIGlmIChkYXRhLnRpbWVzZXJpZXMpIHtcbiAgICAgICAgZG93bmxvYWRFeHRlbnNpb25zID0gL1xcLmNzZGIkfFxcLmNzdiQvO1xuICAgICAgICBwYWdlVHlwZSA9ICd0aW1lc2VyaWVzX2RhdGFzZXQnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC56aXAkLztcbiAgICAgICAgcGFnZVR5cGUgPSAnZGF0YXNldCc7XG4gICAgfVxuXG4gICAgJCgnI2FkZC0nICsgaWRGaWVsZCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY2hlY2sgdGhhdCBhIHRpbWVzZXJpZXMgZGF0YXNldCBoYXMgbWF4IG9uZSBmaWxlXG4gICAgICAgIGlmIChkYXRhLnRpbWVzZXJpZXMgJiYgKGRhdGFbZmllbGRdICYmIGRhdGFbZmllbGRdLmxlbmd0aCA8IDEpIHx8ICFkYXRhLnRpbWVzZXJpZXMpIHtcbiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbiArIDIwMDtcblxuICAgICAgICAgICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJzxkaXYgaWQ9XCInICsgbGFzdEluZGV4ICsgJ1wiIGNsYXNzPVwiZWRpdC1zZWN0aW9uX19pdGVtXCI+JyArXG4gICAgICAgICAgICAgICAgJyAgPGZvcm0gaWQ9XCJVcGxvYWRGb3JtXCI+JyArXG4gICAgICAgICAgICAgICAgJyAgICA8dGV4dGFyZWEgY2xhc3M9XCJhdXRvLXNpemVcIiBwbGFjZWhvbGRlcj1cIlBlcmlvZCAoRS5nLiAyMDE1LCBBdWd1c3QgdG8gRGVjZW1iZXIgMjAxMCwgZXRjLlwiIHR5cGU9XCJ0ZXh0XCIgaWQ9XCJlZGl0aW9uXCI+PC90ZXh0YXJlYT4nICtcbiAgICAgICAgICAgICAgICAnICAgIDx0ZXh0YXJlYSBjbGFzcz1cImF1dG8tc2l6ZVwiIHBsYWNlaG9sZGVyPVwiTGFiZWwgKEUuZy4gRmluYWwsIFJldmlzZWQsIGV0Yy4pXCIgdHlwZT1cInRleHRcIiBpZD1cInZlcnNpb25cIj48L3RleHRhcmVhPicgK1xuICAgICAgICAgICAgICAgICcgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgdGl0bGU9XCJTZWxlY3QgYSBmaWxlIGFuZCBjbGljayBTdWJtaXRcIiBuYW1lPVwiZmlsZXNcIj4nICtcbiAgICAgICAgICAgICAgICAnICAgIDxkaXYgY2xhc3M9XCJkYXRhc2V0LWJ1dHRvbnNcIj4nICtcbiAgICAgICAgICAgICAgICAnICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGZvcm09XCJVcGxvYWRGb3JtXCIgdmFsdWU9XCJzdWJtaXRcIj5TdWJtaXQ8L2J1dHRvbj4nICtcbiAgICAgICAgICAgICAgICAnICAgIDxidXR0b24gY2xhc3M9XCJidG4tcGFnZS1jYW5jZWxcIiBpZD1cImZpbGUtY2FuY2VsXCI+Q2FuY2VsPC9idXR0b24+JyArXG4gICAgICAgICAgICAgICAgLy8nICAgIDxidXR0b24gY2xhc3M9XCJidG4tZGF0YXNldC1hdXRvY3NkYlwiIGlkPVwibm8tZmlsZVwiPkF1dG8gQ1NEQjwvYnV0dG9uPicgK1xuICAgICAgICAgICAgICAgICcgICAgPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgJyAgPC9mb3JtPicgK1xuICAgICAgICAgICAgICAgICcgIDxkaXYgaWQ9XCJyZXNwb25zZVwiPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICcgIDx1bCBpZD1cImxpc3RcIj48L3VsPicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj4nKTtcbiAgICAgICAgICAgIGlmICghZGF0YS50aW1lc2VyaWVzKSB7XG4gICAgICAgICAgICAgICAgJCgnI25vLWZpbGUnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCgnI2ZpbGUtY2FuY2VsJykub25lKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICQoJyMnICsgbGFzdEluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAvL0NoZWNrIGZpbGVzIHVwbG9hZGVkIGFuZCBkZWxldGUgdGhlbVxuICAgICAgICAgICAgICAgIGlmICh1cGxvYWRlZE5vdFNhdmVkLnVwbG9hZGVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZSgtMSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZUNvbnRlbnQoRmxvcmVuY2UuY29sbGVjdGlvbi5pZCwgdXBsb2FkZWROb3RTYXZlZC5lZGl0aW9uVXJpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFkZERhdGFzZXQoY29sbGVjdGlvbklkLCBkYXRhLCAnZGF0YXNldHMnLCAnZWRpdGlvbicpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJyNVcGxvYWRGb3JtJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dVcGxvYWRlZEl0ZW0oc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNsaXN0JykuYXBwZW5kKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VUaXRsZSA9IHRoaXNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VUaXRsZVRyaW1tZWQgPSBwYWdlVGl0bGUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uTGFiZWwgPSB0aGlzWzFdLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZpbGUgPSB0aGlzWzJdLmZpbGVzWzBdO1xuICAgICAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiUGxlYXNlIHNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkXCIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNwb25zZVwiKS5pbm5lckhUTUwgPSBcIlVwbG9hZGluZyAuIC4gLlwiO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZpbGVOYW1lTm9TcGFjZSA9IGZpbGUubmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLl0vZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZS5uYW1lLm1hdGNoKC9cXC5jc3YkLykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWVOb1NwYWNlID0gJ3VwbG9hZC0nICsgZmlsZU5hbWVOb1NwYWNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cmlVcGxvYWQgPSBkYXRhLnVyaSArICcvJyArIHBhZ2VUaXRsZVRyaW1tZWQgKyAnLycgKyBmaWxlTmFtZU5vU3BhY2U7XG4gICAgICAgICAgICAgICAgdmFyIHNhZmVVcmlVcGxvYWQgPSBjaGVja1BhdGhTbGFzaGVzKHVyaVVwbG9hZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YVtmaWVsZF0gJiYgZGF0YVtmaWVsZF0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpLCBmaWxlc1VwbG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNVcGxvYWRlZC5maWxlID09PSBzYWZlVXJpVXBsb2FkIHx8IGZpbGVzVXBsb2FkZWQuZmlsZSA9PT0gZmlsZU5hbWVOb1NwYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnVGhpcyBmaWxlIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBsYXN0SW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERhdGFzZXQoY29sbGVjdGlvbklkLCBkYXRhLCAnZGF0YXNldHMnLCAnZWRpdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1kYXRhID0gZmFsc2U7ICAgLy8gaWYgbm90IHByZXNlbnQgdGhlIGV4aXN0aW5nIGZpbGUgd2FzIGJlaW5nIG92ZXJ3cml0dGVuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoISFmaWxlLm5hbWUubWF0Y2goZG93bmxvYWRFeHRlbnNpb25zKSkge1xuICAgICAgICAgICAgICAgICAgICBzaG93VXBsb2FkZWRJdGVtKGZpbGVOYW1lTm9TcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWRhdGEuYXBwZW5kKFwibmFtZVwiLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgZmlsZSB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBsYXN0SW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBhZGREYXRhc2V0KGNvbGxlY3Rpb25JZCwgZGF0YSwgJ2RhdGFzZXRzJywgJ2VkaXRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChwYWdlVGl0bGUubGVuZ3RoIDwgNCB8fCBwYWdlVGl0bGUudG9Mb3dlckNhc2UoKSA9PT0gJ2RhdGEnKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGlzIG5vdCBhIHZhbGlkIGZpbGUgdGl0bGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9ybWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogXCIvemViZWRlZS9jb250ZW50L1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgc2FmZVVyaVVwbG9hZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzcG9uc2VcIikuaW5uZXJIVE1MID0gXCJGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGF0YVtmaWVsZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0ucHVzaCh7dXJpOiBkYXRhLnVyaSArICcvJyArIHBhZ2VUaXRsZVRyaW1tZWR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnVwbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGRhdGFzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkVDhFZGl0aW9uQ3JlYXRvcihjb2xsZWN0aW9uSWQsIGRhdGEsIHBhZ2VUeXBlLCBwYWdlVGl0bGUsIGZpbGVOYW1lTm9TcGFjZSwgdmVyc2lvbkxhYmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbiBzdWNjZXNzIHNhdmUgcGFyZW50IGFuZCBjaGlsZCBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcjbm8tZmlsZScpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEudGltZXNlcmllcykgeyAgICAvLyBub3QgbmVjZXNzYXJ5IGJ1dCBmb3IgZXh0cmEgc2VjdXJpdHlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGVzY3JpcHRpb24uZGF0YXNldElkKSB7ICAgLy8gY2hlY2sgZm9yIGFuIGlkIHRvIGxpbmsgdGhlIGNzZGIgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uIHN1Y2Nlc3Mgc2F2ZSBwYXJlbnQgYW5kIGNoaWxkIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWdlVGl0bGUgPSAkKCcjZWRpdGlvbicpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VUaXRsZVRyaW1tZWQgPSBwYWdlVGl0bGUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlTmFtZU5vU3BhY2UgPSBkYXRhLmRlc2NyaXB0aW9uLmRhdGFzZXRJZCArICcuY3NkYic7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uTGFiZWwgPSAkKCcjdmVyc2lvbicpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VUaXRsZVRyaW1tZWQubGVuZ3RoIDwgNCB8fCBwYWdlVGl0bGVUcmltbWVkID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgbGFzdEluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREYXRhc2V0KGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IGRhdGEudXJpICsgJy8nICsgcGFnZVRpdGxlVHJpbW1lZH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgZGF0YXNldCBpZiB0aGVyZSBpcyBub3QgYW55XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFQ4RWRpdGlvbkNyZWF0b3IoY29sbGVjdGlvbklkLCBkYXRhLCBwYWdlVHlwZSwgcGFnZVRpdGxlLCBmaWxlTmFtZU5vU3BhY2UsIHZlcnNpb25MYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiV2FybmluZyFcIiwgXCJZb3UgbmVlZCB0byBhZGQgYSBkYXRhc2V0IElkIHRvIG1hdGNoIHRoZSBDU0RCLlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgbGFzdEluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERhdGFzZXQoY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiT29wcyFcIiwgXCJJdCBsb29rcyBsaWtlIHRoaXMgaXMgbm90IGEgdGltZXNlcmllcyBkYXRhc2V0LlwiLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydChcIldhcm5pbmchXCIsIFwiWW91IGNhbiBhZGQgb25seSBvbmUgZmlsZSBpbiBhIHRpbWVzZXJpZXMgZGF0YXNldC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcbiAgICAgICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5zb3J0YWJsZSh7XG4gICAgICAgICAgICBzdG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJyAuZWRpdC1zZWN0aW9uX19zb3J0YWJsZS1pdGVtLS1jb3VudGVyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lbXB0eSgpLmFwcGVuZChpbmRleCArIDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzb3J0YWJsZSgpO1xufVxuXG4vKipcbiAqIE1hbmFnZSBmaWxlcyBhc3NvY2lhdGVkIHdpdGggY29udGVudFxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXlcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlXG4gKi9cblxuZnVuY3Rpb24gYWRkRmlsZShjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcbiAgICB2YXIgZG93bmxvYWRFeHRlbnNpb25zLCBoZWFkZXIsIGJ1dHRvbjtcbiAgICBpZiAoZmllbGQgPT09ICdzdXBwbGVtZW50YXJ5RmlsZXMnKSB7XG4gICAgICAgIGhlYWRlciA9ICdTdXBwbGVtZW50YXJ5IGZpbGVzJztcbiAgICAgICAgYnV0dG9uID0gJ3N1cHBsZW1lbnRhcnkgZmlsZSc7XG4gICAgfSBlbHNlIGlmIChmaWVsZCA9PT0gJ3BkZkRvd25sb2FkcycpIHtcbiAgICAgICAgaGVhZGVyID0gJ1VwbG9hZCBtZXRob2RvbG9neSBQREYgZmlsZSc7XG4gICAgICAgIGJ1dHRvbiA9ICdwZGYnO1xuICAgIH0gZWxzZSBpZiAoZmllbGQgPT09ICdwZGZUYWJsZScpIHtcbiAgICAgICAgaGVhZGVyID0gJ1BERiBUYWJsZSc7XG4gICAgICAgIGJ1dHRvbiA9ICdwZGYnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGhlYWRlciA9ICdVcGxvYWQgZmlsZXMnO1xuICAgICAgICBidXR0b24gPSAnZmlsZSc7XG4gICAgfVxuICAgIHZhciBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZCwgaGVhZGVyOiBoZWFkZXIsIGJ1dHRvbjogYnV0dG9ufTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JEb3dubG9hZHMoZGF0YVRlbXBsYXRlKTtcbiAgICAkKCcjJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAgIHZhciB1cmlVcGxvYWQ7XG5cbiAgICAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcChGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MpO1xuXG4gICAgLy9FZGl0XG4gICAgaWYgKCFkYXRhW2ZpZWxkXSB8fCBkYXRhW2ZpZWxkXS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdmFyIGxhc3RJbmRleCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgIC8vIERlbGV0ZVxuICAgICAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1kZWxldGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZmlsZURlbGV0ZShjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpbmRleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy9BZGRcbiAgICBpZiAoZGF0YS50eXBlID09PSAnc3RhdGljX2FkaG9jJykge1xuICAgICAgICBkb3dubG9hZEV4dGVuc2lvbnMgPSAvXFwuY3N2JHwueGxzJHwuZG9jJHwucGRmJHwuemlwJC87XG4gICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdzdGF0aWNfcW1pJykge1xuICAgICAgICBkb3dubG9hZEV4dGVuc2lvbnMgPSAvXFwucGRmJC87XG4gICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdhcnRpY2xlX2Rvd25sb2FkJyB8fCAoZGF0YS50eXBlID09PSAnc3RhdGljX21ldGhvZG9sb2d5X2Rvd25sb2FkJyAmJiBmaWVsZCA9PT0gJ3BkZkRvd25sb2FkcycpKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5wZGYkLztcbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZCcgJiYgZmllbGQgPT09ICdkb3dubG9hZHMnKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC5kb2MkfC5wcHQkfC56aXAkLztcbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neScpIHtcbiAgICAgICAgZG93bmxvYWRFeHRlbnNpb25zID0gL1xcLmNzdiR8LnhscyR8LmRvYyR8LnBwdCR8LnBkZiR8LnppcCQvO1xuICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnc3RhdGljX2ZvaScpIHtcbiAgICAgICAgZG93bmxvYWRFeHRlbnNpb25zID0gL1xcLmNzdiR8LnhscyR8LmRvYyR8LnBkZiR8LnppcCQvO1xuICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnc3RhdGljX3BhZ2UnKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC5kb2MkfC5wZGYkfC56aXAkLztcbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3N0YXRpY19hcnRpY2xlJykge1xuICAgICAgICBkb3dubG9hZEV4dGVuc2lvbnMgPSAvXFwueGxzJHwucGRmJHwuemlwJC87XG4gICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdkYXRhc2V0JyB8fCBkYXRhLnR5cGUgPT09ICd0aW1lc2VyaWVzX2RhdGFzZXQnKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC5kb2MkfC5wZGYkfC56aXAkLztcbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ2FydGljbGUnIHx8IGRhdGEudHlwZSA9PT0gJ2J1bGxldGluJ3x8IGRhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fY2hhcHRlcicpIHtcbiAgICAgICAgZG93bmxvYWRFeHRlbnNpb25zID0gL1xcLnBkZiQvO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGZpbGUgdHlwZSBpcyBub3QgdmFsaWRcIiwgXCJDb250YWN0IGFuIGFkbWluaXN0cmF0b3IgaWYgeW91IG5lZWQgdG8gYWRkIHRoaXMgdHlwZSBvZiBmaWxlIGluIHRoaXMgZG9jdW1lbnRcIiwgXCJpbmZvXCIpO1xuICAgIH1cblxuICAgICQoJyNhZGQtJyArIGlkRmllbGQpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgoZGF0YS50eXBlID09PSAnYXJ0aWNsZScgfHwgZGF0YS50eXBlID09PSAnYnVsbGV0aW4nKSAmJiAoZGF0YVtmaWVsZF0gJiYgZGF0YVtmaWVsZF0ubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgY2FuIHVwbG9hZCBvbmx5IG9uZSBmaWxlIGhlcmVcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVwbG9hZEZpbGUoY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCwgbGFzdEluZGV4LCBkb3dubG9hZEV4dGVuc2lvbnMsIGFkZEZpbGUpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnLmFkZC10b29sdGlwJykudG9vbHRpcCh7XG4gICAgICAgICAgICBpdGVtczogJy5hZGQtdG9vbHRpcCcsXG4gICAgICAgICAgICBjb250ZW50OiAnVHlwZSB0aXRsZSBoZXJlIGFuZCBjbGljayBTYXZlIHRvIGFkZCBpdCB0byB0aGUgcGFnZScsXG4gICAgICAgICAgICBzaG93OiBcInNsaWRlRG93blwiLCAvLyBzaG93IGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgICAgICAgICAgICAgdWkudG9vbHRpcC5ob3ZlcihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5mYWRlVG8oXCJzbG93XCIsIDAuNSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHNvcnRhYmxlKCkge1xuICAgICAgICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnNvcnRhYmxlKHtcbiAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCcjJyArIGlkRmllbGQgKyAnIC5lZGl0LXNlY3Rpb25fX3NvcnRhYmxlLWl0ZW0tLWNvdW50ZXInKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmVtcHR5KCkuYXBwZW5kKGluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNvcnRhYmxlKCk7XG59XG5cbi8qKlxuICogTWFuYWdlcyBmaWxlIHdpdGggZGVzY3JpcHRpb25cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gZmllbGQgLSBKU09OIGRhdGEga2V5XG4gKiBAcGFyYW0gaWRGaWVsZCAtIEhUTUwgaWQgZm9yIHRoZSB0ZW1wbGF0ZVxuICovXG5cbmZ1bmN0aW9uIGFkZEZpbGVXaXRoRGV0YWlscyhjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHZhciBsaXN0ID0gZGF0YVtmaWVsZF07XG4gIHZhciBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZH07XG4gIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvckRvd25sb2Fkc1dpdGhTdW1tYXJ5KGRhdGFUZW1wbGF0ZSk7XG4gICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gIHZhciB1cmlVcGxvYWQ7XG4gIHZhciBkb3dubG9hZEV4dGVuc2lvbnM7XG5cbiAgJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zKTtcblxuICAvLyBFZGl0XG4gIGlmICghZGF0YVtmaWVsZF0gfHwgZGF0YVtmaWVsZF0ubGVuZ3RoID09PSAwKSB7XG4gICAgdmFyIGxhc3RJbmRleCA9IDA7XG4gIH0gZWxzZSB7XG4gICAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgIC8vIERlbGV0ZVxuICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1kZWxldGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZpbGVEZWxldGUoY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaW5kZXgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEVkaXRcbiAgICAgICQoJyMnICsgaWRGaWVsZCArICctZWRpdF8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IHtcbiAgICAgICAgICBcInRpdGxlXCI6ICQoJyMnICsgaWRGaWVsZCArICctdGl0bGVfJyArIGluZGV4KS52YWwoKSxcbiAgICAgICAgICBcIm1hcmtkb3duXCI6ICQoJyMnICsgaWRGaWVsZCArICctc3VtbWFyeV8nICsgaW5kZXgpLnZhbCgpXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLmZpbGVEZXNjcmlwdGlvbiA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS50aXRsZSA9ICQoJyMnICsgaWRGaWVsZCArICctdGl0bGVfJyArIGluZGV4KS52YWwoKTtcbiAgICAgICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgfTtcbiAgICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvL0FkZFxuICBpZiAoZGF0YS50eXBlID09PSAnY29tcGVuZGl1bV9kYXRhJykge1xuICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC56aXAkLztcbiAgfSBlbHNlIHtcbiAgICBzd2VldEFsZXJ0KFwiVGhpcyBmaWxlIHR5cGUgaXMgbm90IHZhbGlkXCIsIFwiQ29udGFjdCBhbiBhZG1pbmlzdHJhdG9yIGlmIHlvdSBuZWVkIHRvIGFkZCB0aGlzIHR5cGUgb2YgZmlsZSBpbiB0aGlzIGRvY3VtZW50XCIsIFwiaW5mb1wiKTtcbiAgfVxuXG4gICQoJyNhZGQtJyArIGlkRmllbGQpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgdXBsb2FkRmlsZShjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkLCBsYXN0SW5kZXgsIGRvd25sb2FkRXh0ZW5zaW9ucywgYWRkRmlsZVdpdGhEZXRhaWxzKTtcbiAgfSk7XG5cbiAgJChmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmFkZC10b29sdGlwJykudG9vbHRpcCh7XG4gICAgICBpdGVtczogJy5hZGQtdG9vbHRpcCcsXG4gICAgICBjb250ZW50OiAnVHlwZSB0aXRsZSBoZXJlIGFuZCBjbGljayBFZGl0IHRvIGFkZCBhIGRlc2NyaXB0aW9uJyxcbiAgICAgIHNob3c6IFwic2xpZGVEb3duXCIsIC8vIHNob3cgaW1tZWRpYXRlbHlcbiAgICAgIG9wZW46IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgdWkudG9vbHRpcC5ob3ZlcihcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmZhZGVUbyhcInNsb3dcIiwgMC41KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5zb3J0YWJsZSh7XG4gICAgICBzdG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoJyMnICsgaWRGaWVsZCArICcgLmVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbS0tY291bnRlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgJCh0aGlzKS5lbXB0eSgpLmFwcGVuZChpbmRleCArIDEpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHNvcnRhYmxlKCk7XG59XG5cbi8qKlxuICogTWFuYWdlcyBhbGVydHNcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gdGVtcGxhdGVEYXRhXG4gKiBAcGFyYW0gZmllbGQgLSBKU09OIGRhdGEga2V5XG4gKiBAcGFyYW0gaWRGaWVsZCAtIEhUTUwgaWQgZm9yIHRoZSB0ZW1wbGF0ZVxuICovXG5cbmZ1bmN0aW9uIGVkaXRBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgdmFyIGxpc3QgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JBbGVydChkYXRhVGVtcGxhdGUpO1xuICAkKCcjJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICBpbml0aWFsaXNlQWxlcnQoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgLy8gTmV3IGFsZXJ0XG4gICQoXCIjYWRkLVwiICsgaWRGaWVsZCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIGlmICghZGF0YVtmaWVsZF0pIHtcbiAgICAgIGRhdGFbZmllbGRdID0gW107XG4gICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdID0gW107XG4gICAgfVxuICAgIHZhciB0bXBEYXRlID0gKG5ldyBEYXRlKCkpLnRvSVNPU3RyaW5nKCk7XG4gICAgZGF0YVtmaWVsZF0ucHVzaCh7bWFya2Rvd246IFwiXCIsIGRhdGU6IHRtcERhdGUsIHR5cGU6IFwiYWxlcnRcIn0pO1xuICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0ucHVzaCh7bWFya2Rvd246IFwiXCIsIGRhdGU6IHRtcERhdGUsIHR5cGU6IFwiYWxlcnRcIn0pO1xuICAgIHNhdmVBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgfSk7XG4gICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgdmFyIGxpc3QgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JBbGVydChkYXRhVGVtcGxhdGUpO1xuICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKCQoaHRtbCkuZmluZCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKSk7XG4gIGluaXRpYWxpc2VBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlQWxlcnQoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIC8vIExvYWRcbiAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICBkYXRlVG1wID0gZGF0YVtmaWVsZF1baW5kZXhdLmRhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI2RhdGVfJyArIGluZGV4KS52YWwoZGF0ZVRtcEZvcm1hdHRlZCkuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhW2ZpZWxkXVtpbmRleF0uZGF0ZSA9IG5ldyBEYXRlKCQoJyNkYXRlXycgKyBpbmRleCkuZGF0ZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uZGF0ZSA9IG5ldyBEYXRlKCQoJyNkYXRlXycgKyBpbmRleCkuZGF0ZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICAgICQoJyMnICsgaWRGaWVsZCArICctZWRpdF8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdBbGVydCBub3RpY2UnLCBtYXJrZG93bjogZGF0YVtmaWVsZF1baW5kZXhdLm1hcmtkb3dufTtcbiAgICAgIC8vdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IGRhdGFbZmllbGRdW2luZGV4XS5tYXJrZG93bjtcbiAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICBkYXRhW2ZpZWxkXVtpbmRleF0ubWFya2Rvd24gPSB1cGRhdGVkQ29udGVudDtcbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0ubWFya2Rvd24gPSB1cGRhdGVkQ29udGVudDtcbiAgICAgICAgc2F2ZUFsZXJ0KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgfTtcbiAgICAgIGxvYWRNYXJrZG93bkVkaXRvcihlZGl0ZWRTZWN0aW9uVmFsdWUsIHNhdmVDb250ZW50LCBkYXRhLCAnbm90RW1wdHknKTtcbiAgICB9KTtcblxuICAgIHZhciBjb3JyZWN0aW9uQ2hlY2s7XG4gICAgaWYgKGRhdGFbZmllbGRdW2luZGV4XS50eXBlID09PSAnY29ycmVjdGlvbicpIHtcbiAgICAgIGNvcnJlY3Rpb25DaGVjayA9ICdjaGVja2VkJztcbiAgICB9IGVsc2UgaWYgKGRhdGFbZmllbGRdW2luZGV4XS50eXBlID09PSAnYWxlcnQnKSB7XG4gICAgICBjb3JyZWN0aW9uQ2hlY2sgPSAndW5jaGVja2VkJztcbiAgICB9XG5cbiAgICBpZiAoZGF0YS50eXBlID09PSAnZGF0YXNldF9sYW5kaW5nX3BhZ2UnIHx8IGRhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgJCgnI2NvcnJlY3Rpb24tY29udGFpbmVyXycgKyBpbmRleCkuYXBwZW5kKCc8bGFiZWwgZm9yPVwiY29ycmVjdGlvbi1hbGVydF8nICsgaW5kZXggKyAnXCI+U2hvdyBhcyBjb3JyZWN0aW9uJyArXG4gICAgICAgICc8aW5wdXQgaWQ9XCJjb3JyZWN0aW9uLWFsZXJ0XycgKyBpbmRleCArICdcIiB0eXBlPVwiY2hlY2tib3hcIiB2YWx1ZT1cInZhbHVlXCIgJyArIGNvcnJlY3Rpb25DaGVjayArICcvPjwvbGFiZWw+Jyk7XG4gICAgfVxuXG4gICAgJCgnI2NvcnJlY3Rpb24tYWxlcnRfJyArIGluZGV4KS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09PSB0cnVlKSB7XG4gICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS50eXBlID0gJ2NvcnJlY3Rpb24nO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS50eXBlID0gJ2FsZXJ0JztcbiAgICAgIH1cbiAgICAgIHNhdmVBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICB9KTtcblxuICAgIC8vIERlbGV0ZVxuICAgICQoJyMnICsgaWRGaWVsZCArICctZGVsZXRlXycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgc3dhbCAoe1xuICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgIHRleHQ6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGFsZXJ0P1wiLFxuICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgfSwgZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBhbGVydCBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgIHRpbWVyOiAyMDAwXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHBvc2l0aW9uID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIHNhdmVBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcbiAgICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnNvcnRhYmxlKHtcbiAgICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgICQoJyMnICsgaWRGaWVsZCArICcgLmVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbS0tY291bnRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgICAkKHRoaXMpLmVtcHR5KCkuYXBwZW5kKGluZGV4ICsgMSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc29ydGFibGUoKTtcblxufVxuXG5mdW5jdGlvbiBzYXZlQWxlcnQoY29sbGVjdGlvbklkLCBwYXRoLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgIHJlZnJlc2hBbGVydChjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgIH0sXG4gICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICApO1xufVxuXG4vKipcbiAqIE1hbmFnZXMgcmVsYXRlZCBkYXRhXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIHRlbXBsYXRlRGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleVxuICogQHBhcmFtIGlkRmllbGQgLSBIVE1MIGlkIGZvciB0aGUgdGVtcGxhdGVcbiAqL1xuXG5mdW5jdGlvbiBlZGl0QmxvY2tzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gIHZhciBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZH07XG4gIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvclQxQmxvY2tzKGRhdGFUZW1wbGF0ZSk7XG4gICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gIHJlc29sdmVTdGF0c1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hCbG9ja3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHZhciBsaXN0ID0gdGVtcGxhdGVEYXRhW2ZpZWxkXTtcbiAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZWRpdG9yVDFCbG9ja3MoZGF0YVRlbXBsYXRlKTtcbiAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aCgkKGh0bWwpLmZpbmQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkpO1xuICBpbml0aWFsaXNlQmxvY2tzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG59XG5cbmZ1bmN0aW9uIGluaXRpYWxpc2VCbG9ja3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIC8vIExvYWRcbiAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAvLyBFZGl0XG4gICAgJCgnIycgKyBpZEZpZWxkICsgJy1lZGl0XycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgdmFyICR0aGlzID0gZGF0YVtmaWVsZF1baW5kZXhdO1xuICAgICAgaWYgKCEkdGhpcy50aXRsZSkge1xuICAgICAgICAvLyBUaGlzIGlzIGRhdGFcbiAgICAgICAgdmFyIG1vZGFsID0gdGVtcGxhdGVzLmJsb2NrTmV3c01vZGFsKCR0aGlzKTtcbiAgICAgICAgdmFyIHBhc3RlZFVybDtcbiAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG4gICAgICAgICQoJy5tb2RhbC1uZXdzJykucmVtb3ZlKCk7XG5cbiAgICAgICAgLy9Nb2RhbCBjbGljayBldmVudHNcbiAgICAgICAgJCgnLmJ0bi11cmktY2FuY2VsJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ0bi11cmktZ2V0Jykub2ZmKCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHBhc3RlZFVybCA9ICQoJyN1cmktaW5wdXQnKS52YWwoKTtcbiAgICAgICAgICBpZiAocGFzdGVkVXJsID09PSBcIlwiKSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBmaWVsZCBjYW5ub3QgYmUgZW1wdHkuIFBsZWFzZSBwYXN0ZSBhIHZhbGlkIHVybCBhZGRyZXNzXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZGF0YVVybCA9IGNoZWNrUGF0aFBhcnNlZChwYXN0ZWRVcmwpO1xuICAgICAgICAgICAgaWYgKGRhdGFVcmwgPT09IFwiXCIpIHsgICAgLy9zcGVjaWFsIGNhc2UgZm9yIGhvbWUgcGFnZVxuICAgICAgICAgICAgICBkYXRhVXJsID0gXCIvXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGVja1ZhbGlkU3RhdHMoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkLCBkYXRhVXJsLCBpbmRleCk7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVGhpcyBpcyBpdGVtXG4gICAgICAgIHZhciBpbWFnZXMgPSBkYXRhLmltYWdlcztcbiAgICAgICAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtibG9jazogJHRoaXMsIGltYWdlczogaW1hZ2VzfTtcbiAgICAgICAgdmFyIG1vZGFsID0gdGVtcGxhdGVzLmJsb2NrTmV3c01vZGFsKGRhdGFUZW1wbGF0ZSk7XG4gICAgICAgIHZhciB1cmksIHRpdGxlLCB0ZXh0LCBpbWFnZTtcbiAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG4gICAgICAgIC8vbWVudXNlbGVjdChcInVyaS1zaXplXCIpO1xuXG4gICAgICAgICQoJyN1cmktaW5wdXQnKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICR0aGlzLnVyaSA9ICQoJyN1cmktaW5wdXQnKS52YWwoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJyN1cmktdGl0bGUnKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICR0aGlzLnRpdGxlID0gJCgnI3VyaS10aXRsZScpLnZhbCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgJChcIiN1cmktdGV4dFwiKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICAgICR0aGlzLnRleHQgPSAkKCcjdXJpLXRleHQnKS52YWwoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGltYWdlSWR4ID0gXy5maW5kSW5kZXgoaW1hZ2VzLCBmdW5jdGlvbihpdGVtKSB7cmV0dXJuIGl0ZW0udXJpID09PSAkdGhpcy5pbWFnZTt9KTtcbiAgICAgICAgJCgnI3VyaS1pbWFnZScpLnZhbChpbWFnZUlkeC50b1N0cmluZygpKS5wcm9wKCdzZWxlY3RlZCcsICd0cnVlJyk7XG5cbiAgICAgICAgJFxuICAgICAgICAkKCcjdXJpLWltYWdlJykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgaW5kZXggPSBwYXJzZUludCgkKCcjdXJpLWltYWdlJykudmFsKCkpO1xuICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICR0aGlzLmltYWdlID0gJyc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR0aGlzLmltYWdlID0gaW1hZ2VzW2luZGV4XS51cmk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL01vZGFsIGNsaWNrIGV2ZW50c1xuICAgICAgICAkKCcuYnRuLXVyaS1jYW5jZWwnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idG4tdXJpLWdldCcpLm9mZigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoISgkdGhpcy50aXRsZSB8fCB0aXRsZSkpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1lvdSBuZWVkIHRvIGVudGVyIGEgdGl0bGUgdG8gY29udGludWUnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdID0ge3VyaTogJHRoaXMudXJpLCB0aXRsZTogJHRoaXMudGl0bGUsIHRleHQ6ICR0aGlzLnRleHQsIGltYWdlOiAkdGhpcy5pbWFnZX07XG4gICAgICAgICAgICBzYXZlQmxvY2tzKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIERlbGV0ZVxuICAgICQoJyMnICsgaWRGaWVsZCArICctZGVsZXRlXycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgc3dhbCh7XG4gICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgYmxvY2s/XCIsXG4gICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBcIiArIGlkRmllbGQgKyBcIiBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgIHRpbWVyOiAyMDAwXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHBvc2l0aW9uID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgICAgICAgICAgcmVmcmVzaEJsb2Nrcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vQWRkXG4gICQoJyNhZGQtJyArIGlkRmllbGQpLm9mZigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAvL2FkZCBhIG1vZGFsIHRvIHNlbGVjdCBhbiBvcHRpb24gZm9yIHN0YXRzIG9yIG5ld3NcbiAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uO1xuICAgIHZhciBtb2RhbFN0YXRzT3JOZXdzID0gdGVtcGxhdGVzLmJsb2NrTW9kYWw7XG4gICAgJCgnLndvcmtzcGFjZS1tZW51JykuYXBwZW5kKG1vZGFsU3RhdHNPck5ld3MpO1xuICAgIC8vVGhleSBjaG9vc2UgdGltZXNlcmllc1xuICAgICQoJyNkYXRhLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgIGRhdGFbZmllbGRdID0gW107XG4gICAgICB9XG5cbiAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5ibG9ja05ld3NNb2RhbDtcbiAgICAgIHZhciBwYXN0ZWRVcmw7XG4gICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG4gICAgICAkKCcubW9kYWwtbmV3cycpLnJlbW92ZSgpO1xuXG4gICAgICAvL01vZGFsIGNsaWNrIGV2ZW50c1xuICAgICAgJCgnLmJ0bi11cmktY2FuY2VsJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY3JlYXRlV29ya3NwYWNlKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICB9KTtcblxuICAgICAgJCgnLmJ0bi11cmktZ2V0Jykub2ZmKCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBwYXN0ZWRVcmwgPSAkKCcjdXJpLWlucHV0JykudmFsKCk7XG4gICAgICAgIGlmIChwYXN0ZWRVcmwgPT09IFwiXCIpIHtcbiAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBmaWVsZCBjYW5ub3QgYmUgZW1wdHkuIFBsZWFzZSBwYXN0ZSBhIHZhbGlkIHVybCBhZGRyZXNzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBkYXRhVXJsID0gY2hlY2tQYXRoUGFyc2VkKHBhc3RlZFVybCk7XG4gICAgICAgICAgaWYgKGRhdGFVcmwgPT09IFwiXCIpIHsgICAgLy9zcGVjaWFsIGNhc2UgZm9yIGhvbWUgcGFnZVxuICAgICAgICAgICAgZGF0YVVybCA9IFwiL1wiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaGVja1ZhbGlkU3RhdHMoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkLCBkYXRhVXJsKTtcbiAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvL1RoZXkgY2hvb3NlIG5ld3NcbiAgICAkKCcjaXRlbS1saW5rJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCFkYXRhW2ZpZWxkXSkge1xuICAgICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgfVxuICAgICAgdmFyIGltYWdlcyA9IGRhdGEuaW1hZ2VzO1xuICAgICAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtibG9jazoge30sIGltYWdlczogaW1hZ2VzfTtcbiAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5ibG9ja05ld3NNb2RhbChkYXRhVGVtcGxhdGUpO1xuICAgICAgdmFyIHVyaSwgdGl0bGUsIHRleHQsIGltYWdlO1xuICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5hcHBlbmQobW9kYWwpO1xuXG4gICAgICAkKCcjdXJpLWlucHV0JykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdXJpID0gJCgnI3VyaS1pbnB1dCcpLnZhbCgpO1xuICAgICAgfSk7XG4gICAgICAkKCcjdXJpLXRpdGxlJykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGl0bGUgPSAkKCcjdXJpLXRpdGxlJykudmFsKCk7XG4gICAgICB9KTtcbiAgICAgICQoXCIjdXJpLXRleHRcIikuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIHRleHQgPSAkKCcjdXJpLXRleHQnKS52YWwoKTtcbiAgICAgIH0pO1xuICAgICAgJCgnI3VyaS1pbWFnZScpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHBhcnNlSW50KCQoJyN1cmktaW1hZ2UnKS52YWwoKSk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAkdGhpcy5pbWFnZSA9ICcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICR0aGlzLmltYWdlID0gaW1hZ2VzW2luZGV4XS51cmk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAkKCcuYnRuLXVyaS1nZXQnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgICBzd2VldEFsZXJ0KCdZb3UgbmVlZCB0byBlbnRlciBhIHRpdGxlIHRvIGNvbnRpbnVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGF0YVtmaWVsZF0ucHVzaCh7dXJpOiB1cmksIHRpdGxlOiB0aXRsZSwgdGV4dDogdGV4dCwgaW1hZ2U6IGltYWdlfSk7XG4gICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IHVyaSwgdGl0bGU6IHRpdGxlLCB0ZXh0OiB0ZXh0LCBpbWFnZTogaW1hZ2V9KTtcbiAgICAgICAgICBzYXZlQmxvY2tzKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICQoJy5tb2RhbCcpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgICQoJy5idG4tdXJpLWNhbmNlbCcpLm9mZigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vVGhleSBjYW5jZWxcbiAgICAkKCcuYnRuLXVyaS1jYW5jZWwnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gTWFrZSBzZWN0aW9ucyBzb3J0YWJsZVxuICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcbiAgICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnNvcnRhYmxlKHtcbiAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJyAuZWRpdC1zZWN0aW9uX19zb3J0YWJsZS1pdGVtLS1jb3VudGVyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAkKHRoaXMpLmVtcHR5KCkuYXBwZW5kKGluZGV4ICsgMSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc29ydGFibGUoKTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVN0YXRzVGl0bGUoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHZhciBhamF4UmVxdWVzdCA9IFtdO1xuICAkKHRlbXBsYXRlRGF0YVtmaWVsZF0pLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwYXRoKSB7XG4gICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBpZiAoIXRoaXMudGl0bGUpIHtcbiAgICAgIGdldFBhZ2VEYXRhVGl0bGUoY29sbGVjdGlvbklkLCBwYXRoLnVyaSxcbiAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0gPSByZXNwb25zZTtcbiAgICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIGZpZWxkICsgJyBhZGRyZXNzOiAnICsgcGF0aC51cmkgKyAnIGlzIG5vdCBmb3VuZC4nLCBcImVycm9yXCIpO1xuICAgICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBhamF4UmVxdWVzdC5wdXNoKGRmZCk7XG4gICAgfVxuICB9KTtcblxuICAkLndoZW4uYXBwbHkoJCwgYWpheFJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHJlZnJlc2hCbG9ja3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgfSk7XG59XG5cblxuZnVuY3Rpb24gc2F2ZUJsb2Nrcyhjb2xsZWN0aW9uSWQsIHBhdGgsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICByZXNvbHZlU3RhdHNUaXRsZShjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgIH0sXG4gICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tWYWxpZFN0YXRzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCwgZGF0YVVybCwgaW5kZXgpIHtcbiAgdmFyIGRhdGFVcmxEYXRhID0gZGF0YVVybCArIFwiL2RhdGFcIjtcbiAgJC5hamF4KHtcbiAgICB1cmw6IGRhdGFVcmxEYXRhLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgaWYgKHJlc3VsdC50eXBlID09PSAndGltZXNlcmllcycpIHtcbiAgICAgICAgaWYgKCFkYXRhW2ZpZWxkXSkge1xuICAgICAgICAgIGRhdGFbZmllbGRdID0gW107XG4gICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgZG9jdW1lbnRcIik7XG4gICAgICAgIGNyZWF0ZVdvcmtzcGFjZShkYXRhLnVyaSwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChpbmRleCkge1xuICAgICAgICBkYXRhW2ZpZWxkXVtpbmRleF0gPSB7dXJpOiBkYXRhVXJsfTtcbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0gPSB7dXJpOiBkYXRhVXJsfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGFbZmllbGRdLnB1c2goe3VyaTogZGF0YVVybH0pO1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdLnB1c2goe3VyaTogZGF0YVVybH0pO1xuICAgICAgfVxuICAgICAgc2F2ZUJsb2Nrcyhjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcblxuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdObyBwYWdlIGRhdGEgcmV0dXJuZWQnKTtcbiAgICB9XG4gIH0pO1xufVxuZnVuY3Rpb24gZWRpdENvbGxlY3Rpb24oY29sbGVjdGlvbikge1xuXG4gICAgY29sbGVjdGlvbi5jb2xsZWN0aW9uT3duZXIgPSBGbG9yZW5jZS5BdXRoZW50aWNhdGlvbi51c2VyVHlwZSgpO1xuXG4gICAgZ2V0VGVhbXMoXG4gICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAodGVhbXMpIHtcbiAgICAgICAgICAgIHZhciBlZGl0UHVibGlzaFRpbWUsIHRvSXNvRGF0ZTtcbiAgICAgICAgICAgIHZhciBjb2xsRGV0YWlscyA9ICQoJy5qcy1jb2xsZWN0aW9uX19jb250ZW50JykuZGV0YWNoKCk7XG4gICAgICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5jb2xsZWN0aW9uRWRpdCh7Y29sbGVjdGlvbjogY29sbGVjdGlvbiwgdGVhbXM6IHRlYW1zLnRlYW1zfSk7XG4gICAgICAgICAgICAkKCcuanMtY29sbGVjdGlvbl9faGVhZCcpLmFmdGVyKGh0bWwpO1xuICAgICAgICAgICAgJCgnLmJ0bi1jb2xsZWN0aW9uLWVkaXQnKS5vZmYoKTtcblxuICAgICAgICAgICAgJCgnI2NvbGxlY3Rpb24tZWRpdG9yLW5hbWUnKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbi5uYW1lID0gJCgnI2NvbGxlY3Rpb24tZWRpdG9yLW5hbWUnKS52YWwoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKFwiI2VkaXRvci10ZWFtLXRhZ1wiKS50YWdpdCh7XG4gICAgICAgICAgICAgICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2luZ2xlRmllbGROb2RlOiAkKCcjZWRpdG9yLXRlYW0taW5wdXQnKSxcbiAgICAgICAgICAgICAgICBzaW5nbGVGaWVsZERlbGltaXRlcjogKFwiJCRcIilcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGNvbGxlY3Rpb24udGVhbXMpLmVhY2goZnVuY3Rpb24gKGksIHRlYW0pIHtcbiAgICAgICAgICAgICAgICAkKCcjZWRpdG9yLXRlYW0tdGFnJykudGFnaXQoJ2NyZWF0ZVRhZycsIHRlYW0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy51aS1hdXRvY29tcGxldGUtaW5wdXQnKS5oaWRlKCk7XG5cbiAgICAgICAgICAgICQoJ3NlbGVjdCNlZGl0b3ItdGVhbScpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnI2VkaXRvci10ZWFtLXRhZycpLnRhZ2l0KCdjcmVhdGVUYWcnLCAkKFwiI2VkaXRvci10ZWFtIG9wdGlvbjpzZWxlY3RlZFwiKS50ZXh0KCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJyNlZGl0b3ItdGVhbS1pbnB1dCcpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbi50ZWFtcyA9ICQoJyNlZGl0b3ItdGVhbS1pbnB1dCcpLnZhbCgpLnNwbGl0KCckJCcpO1xuICAgICAgICAgICAgICAgIC8vQWZ0ZXIgY3JlYXRpbmcgdGhlIGFycmF5IHRhZ2l0IGxlYXZlcyBhbiBlbXB0eSBzdHJpbmcgaWYgYWxsIGVsZW1lbnRzIGFyZSByZW1vdmVkXG4gICAgICAgICAgICAgICAgaWYgKHRlYW1zLmxlbmd0aCA9PT0gMSAmJiB0ZWFtc1swXSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICB0ZWFtcyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIWNvbGxlY3Rpb24ucHVibGlzaERhdGUpIHtcbiAgICAgICAgICAgICAgICAkKCcjY29sbGVjdGlvbi1lZGl0b3ItZGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0b0lzb0RhdGUgPSAkKCcjY29sbGVjdGlvbi1lZGl0b3ItZGF0ZScpLmRhdGVwaWNrZXIoXCJnZXREYXRlXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkYXRlVG1wID0gY29sbGVjdGlvbi5wdWJsaXNoRGF0ZTtcbiAgICAgICAgICAgICAgICB0b0lzb0RhdGUgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgICAgICAgICAgICAgJCgnI2NvbGxlY3Rpb24tZWRpdG9yLWRhdGUnKS52YWwodG9Jc29EYXRlKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9Jc29EYXRlID0gJCgnI2NvbGxlY3Rpb24tZWRpdG9yLWRhdGUnKS5kYXRlcGlja2VyKFwiZ2V0RGF0ZVwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9pbml0aWFsIHZhbHVlXG4gICAgICAgICAgICBpZiAoY29sbGVjdGlvbi50eXBlID09PSBcIm1hbnVhbFwiKSB7XG4gICAgICAgICAgICAgICAgJCgnI2NvbGxlY3Rpb24tZWRpdG9yLWRhdGUtYmxvY2snKS5oaWRlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJyNjb2xsZWN0aW9uLWVkaXRvci1kYXRlLWJsb2NrJykuc2hvdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXJhZGlvXScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS52YWwoKSA9PT0gJ21hbnVhbENvbGxlY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24udHlwZSA9IFwibWFudWFsXCI7XG4gICAgICAgICAgICAgICAgICAgICQoJyNjb2xsZWN0aW9uLWVkaXRvci1kYXRlLWJsb2NrJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS52YWwoKSA9PT0gJ3NjaGVkdWxlZENvbGxlY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24udHlwZSA9IFwic2NoZWR1bGVkXCI7XG4gICAgICAgICAgICAgICAgICAgICQoJyNjb2xsZWN0aW9uLWVkaXRvci1kYXRlLWJsb2NrJykuc2hvdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL01vcmUgZnVuY3Rpb25hbGl0eSB0byBiZSBhZGRlZCBoZXJlXG4gICAgICAgICAgICAvLyBXaGVuIHNjaGVkdWxlZCwgZG8gd2UgY2hhbmdlIGFsbCB0aGUgZGF0ZXMgaW4gdGhlIGZpbGVzIGluIHRoZSBjb2xsZWN0aW9uP1xuXG5cbiAgICAgICAgICAgIC8vU2F2ZVxuICAgICAgICAgICAgJCgnLmJ0bi1jb2xsZWN0aW9uLWVkaXRvci1zYXZlJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vc2F2ZSBkYXRlIGFuZCB0aW1lIHRvIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbi50eXBlID09PSAnc2NoZWR1bGVkJykge1xuICAgICAgICAgICAgICAgICAgICBlZGl0UHVibGlzaFRpbWUgPSBwYXJzZUludCgkKCcjY29sbGVjdGlvbi1lZGl0b3ItaG91cicpLnZhbCgpKSArIHBhcnNlSW50KCQoJyNjb2xsZWN0aW9uLWVkaXRvci1taW4nKS52YWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24ucHVibGlzaERhdGUgPSBuZXcgRGF0ZShwYXJzZUludChuZXcgRGF0ZSh0b0lzb0RhdGUpLmdldFRpbWUoKSkgKyBlZGl0UHVibGlzaFRpbWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9jaGVjayB2YWxpZGl0eVxuICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uLm5hbWUgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgaXMgbm90IGEgdmFsaWQgY29sbGVjdGlvbiBuYW1lJywgXCJBIGNvbGxlY3Rpb24gbmFtZSBjYW4ndCBiZSBlbXB0eVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uLm5hbWUubWF0Y2goL1xcLi8pKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgaXMgbm90IGEgdmFsaWQgY29sbGVjdGlvbiBuYW1lJywgXCJZb3UgY2FuJ3QgdXNlIGZ1bGxzdG9wc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoY29sbGVjdGlvbi50eXBlID09PSAnc2NoZWR1bGVkJykgJiYgKERhdGUucGFyc2UoY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSkgPCBuZXcgRGF0ZSgpKSkge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KCdUaGlzIGlzIG5vdCBhIHZhbGlkIGRhdGUuIERhdGUgY2Fubm90IGJlIGluIHRoZSBwYXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY29sbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbGxlY3Rpb24vXCIgKyBjb2xsZWN0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGNvbGxlY3Rpb24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHVwZGF0ZWRDb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2Uuc2V0QWN0aXZlQ29sbGVjdGlvbih1cGRhdGVkQ29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jcmVhdGVXb3Jrc3BhY2UoJycsIHVwZGF0ZWRDb2xsZWN0aW9uLmlkLCAnYnJvd3NlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNvbGxlY3Rpb24gYW1lbmRlZFwiLCBcIlwiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25zKGNvbGxlY3Rpb24uaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5tZXNzYWdlLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vQ2FuY2VsXG4gICAgICAgICAgICAkKCcuYnRuLWNvbGxlY3Rpb24tZWRpdG9yLWNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCcuYnRuLWNvbGxlY3Rpb24tZWRpdCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdENvbGxlY3Rpb24oY29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJCgnLmpzLWNvbGxlY3Rpb25fX2VkaXQtbW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcuanMtY29sbGVjdGlvbl9faGVhZCcpLmFmdGVyKGNvbGxEZXRhaWxzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZXRDb2xsZWN0aW9uRWRpdG9ySGVpZ2h0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0gZnVuY3Rpb24gKGpxeGhyKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihqcXhocik7XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5mdW5jdGlvbiBzZXRDb2xsZWN0aW9uRWRpdG9ySGVpZ2h0KCkge1xuICAgIHZhciAkY29udGVudE1vZGFsID0gJCgnLmpzLWNvbGxlY3Rpb25fX2VkaXQtbW9kYWwnKSxcbiAgICAgICAgcGFuZWxIZWlnaHQgPSBwYXJzZUludCgkKCcucGFuZWwtLW9mZi1jYW52YXMnKS5oZWlnaHQoKSksXG4gICAgICAgIGhlYWRIZWlnaHQgPSBwYXJzZUludCgkKCcuc2xpZGVyX19oZWFkJykub3V0ZXJIZWlnaHQoKSksXG4gICAgICAgIGNvbnRlbnRNYXJnaW4gPSAocGFyc2VJbnQoJGNvbnRlbnRNb2RhbC5jc3MoJ21hcmdpbi10b3AnKSkpICsgKHBhcnNlSW50KCRjb250ZW50TW9kYWwuY3NzKCdtYXJnaW4tYm90dG9tJykpKTtcblxuICAgIHZhciBjb250ZW50SGVpZ2h0ID0gcGFuZWxIZWlnaHQgLSBoZWFkSGVpZ2h0IC0gY29udGVudE1hcmdpbjtcbiAgICAkY29udGVudE1vZGFsLmNzcygnaGVpZ2h0JywgY29udGVudEhlaWdodCk7XG59XG5cbi8qKlxuICogTWFuYWdlIGZpbGVzIGFzc29jaWF0ZWQgd2l0aCBkYXRhc2V0cy4gV2hlbiB1cGxvYWRpbmcgYSBmaWxlIGNyZWF0ZXMgYSBuZXcgZGF0YXNldFxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXkgKCd2ZXJzaW9ucycpXG4gKiBAcGFyYW0gaWRGaWVsZCAtIEhUTUwgaWQgZm9yIHRoZSB0ZW1wbGF0ZSAoJ3ZlcnNpb24nIG9yICdjb3JyZWN0aW9uJylcbiAqL1xuXG5mdW5jdGlvbiBlZGl0RGF0YXNldFZlcnNpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIHZhciBkb3dubG9hZEV4dGVuc2lvbnMsIHVyaVVwbG9hZCwgZmlsZTtcbiAgICB2YXIgbGFzdEluZGV4O1xuICAgIGlmIChkYXRhW2ZpZWxkXSkge1xuICAgICAgICBsYXN0SW5kZXggPSBkYXRhW2ZpZWxkXS5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGFzdEluZGV4ID0gMDtcbiAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICB9XG4gICAgdmFyIHVwbG9hZGVkTm90U2F2ZWQgPSB7dXBsb2FkZWQ6IGZhbHNlLCBzYXZlZDogZmFsc2UsIGZpbGVVcmw6IFwiXCIsIG9sZExhYmVsOiBkYXRhLmRlc2NyaXB0aW9uLnZlcnNpb25MYWJlbH07XG4gICAgJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zKTtcbiAgICAvL0FkZFxuICAgIGlmIChkYXRhLnR5cGUgPT09ICd0aW1lc2VyaWVzX2RhdGFzZXQnKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc2RiJHxcXC5jc3YkLztcbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ2RhdGFzZXQnKSB7XG4gICAgICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC56aXAkLztcbiAgICB9XG5cbiAgICB2YXIgYWpheFJlcXVlc3QgPSBbXTtcbiAgICB2YXIgdGVtcGxhdGVEYXRhID0gJC5leHRlbmQodHJ1ZSwge30sIGRhdGEpO1xuICAgICQodGVtcGxhdGVEYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHZlcnNpb24pIHtcbiAgICAgICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICAgICAgaWYgKHZlcnNpb24uY29ycmVjdGlvbk5vdGljZSkge1xuICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0udHlwZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS50eXBlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0ubGFiZWwgPSB2ZXJzaW9uLmxhYmVsO1xuICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgICBhamF4UmVxdWVzdC5wdXNoKGRmZCk7XG4gICAgfSk7XG5cbiAgICAkLndoZW4uYXBwbHkoJCwgYWpheFJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JDb3JyZWN0aW9uKHtpZEZpZWxkOiBpZEZpZWxkfSk7XG4gICAgICAgICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gICAgICAgIGluaXRpYWxpc2VEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIH0pO1xuXG4gICAgJChcIiNhZGQtXCIgKyBpZEZpZWxkKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBhZGRUaGVWZXJzaW9uKCk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBhZGRUaGVWZXJzaW9uKCkge1xuICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbiArIDIwMDtcblxuICAgICAgICAvLyB0b2RvOiBNb3ZlIHRoaXMgSFRNTCBpbnRvIGEgaGFuZGxlYmFycyB0ZW1wbGF0ZS5cbiAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1zZWN0aW9uJykuYXBwZW5kKFxuICAgICAgICAgICAgJzxkaXYgaWQ9XCInICsgbGFzdEluZGV4ICsgJ1wiIGNsYXNzPVwiZWRpdC1zZWN0aW9uX19pdGVtXCI+JyArXG4gICAgICAgICAgICAnICA8Zm9ybSBpZD1cIlVwbG9hZEZvcm1cIj4nICtcbiAgICAgICAgICAgICcgICAgPHRleHRhcmVhIGNsYXNzPVwiYXV0by1zaXplXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkFkZCBhIGxhYmVsIGhlcmUgKEUuZy4gUmV2aXNlZCwgRmluYWwsIGV0Y1wiIGlkPVwibGFiZWxcIj48L3RleHRhcmVhPicgK1xuICAgICAgICAgICAgJyAgICA8aW5wdXQgdHlwZT1cImZpbGVcIiB0aXRsZT1cIlNlbGVjdCBhIGZpbGUgYW5kIGNsaWNrIFN1Ym1pdFwiIG5hbWU9XCJmaWxlc1wiPicgK1xuICAgICAgICAgICAgJyAgICA8ZGl2IGNsYXNzPVwiZGF0YXNldC1idXR0b25zXCI+JyArXG4gICAgICAgICAgICAnICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLS1wcmltYXJ5XCIgdHlwZT1cInN1Ym1pdFwiIGZvcm09XCJVcGxvYWRGb3JtXCIgdmFsdWU9XCJzdWJtaXRcIj5TdWJtaXQ8L2J1dHRvbj4nICtcbiAgICAgICAgICAgICcgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tcGFnZS1jYW5jZWxcIiBpZD1cImZpbGUtY2FuY2VsXCI+Q2FuY2VsPC9idXR0b24+JyArXG4gICAgICAgICAgICAvLycgICAgPGJ1dHRvbiBjbGFzcz1cImJ0bi1kYXRhc2V0LWF1dG9jc2RiXCIgaWQ9XCJuby1maWxlXCI+QXV0byBDU0RCPC9idXR0b24+JyArXG4gICAgICAgICAgICAnICAgIDwvZGl2PicgK1xuICAgICAgICAgICAgJyAgPC9mb3JtPicgK1xuICAgICAgICAgICAgJyAgPGRpdiBpZD1cInJlc3BvbnNlXCI+PC9kaXY+JyArXG4gICAgICAgICAgICAnICA8dWwgaWQ9XCJsaXN0XCI+PC91bD4nICtcbiAgICAgICAgICAgICc8L2Rpdj4nKTtcblxuICAgICAgICBpZiAoZGF0YS50eXBlID09PSAnZGF0YXNldCcpIHtcbiAgICAgICAgICAgICQoJyNuby1maWxlJykucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGUgbGFiZWwgZmllbGQgaXMgbm90IHVzZWQgZm9yIGNvcnJlY3Rpb25zLCBqdXN0IHVzZSBleGlzdGluZyB2ZXJzaW9uIGxhYmVsLlxuICAgICAgICBpZiAoaWRGaWVsZCA9PT0gXCJjb3JyZWN0aW9uXCIpIHtcbiAgICAgICAgICAgIHZhciAkdmVyc2lvbkxhYmVsID0gJCgnI1VwbG9hZEZvcm0gI2xhYmVsJyk7XG4gICAgICAgICAgICAkdmVyc2lvbkxhYmVsLnRleHQodXBsb2FkZWROb3RTYXZlZC5vbGRMYWJlbCk7XG4gICAgICAgICAgICAkdmVyc2lvbkxhYmVsLmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJyNmaWxlLWNhbmNlbCcpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJCgnIycgKyBsYXN0SW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgaWYgKHVwbG9hZGVkTm90U2F2ZWQudXBsb2FkZWQgPT09IHRydWUgJiYgdXBsb2FkZWROb3RTYXZlZC5zYXZlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnZlcnNpb25MYWJlbCA9IHVwbG9hZGVkTm90U2F2ZWQub2xkTGFiZWw7XG4gICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHVwbG9hZGVkTm90U2F2ZWQuZmlsZVVybCxcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5pdGlhbGlzZURhdGFzZXRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJyNVcGxvYWRGb3JtJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICB2YXIgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc2hvd1VwbG9hZGVkSXRlbShzb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAkKCcjbGlzdCcpLmFwcGVuZChzb3VyY2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdmVyc2lvbkxhYmVsID0gdGhpc1swXS52YWx1ZTtcbiAgICAgICAgICAgIGZpbGUgPSB0aGlzWzFdLmZpbGVzWzBdO1xuXG4gICAgICAgICAgICAvLyBDaGVjayB0aGF0IGEgZmlsZSBoYXMgYmVlbiB1cGxvYWRlZFxuICAgICAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnUGxlYXNlIHNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGF0YS50eXBlID09IFwidGltZXNlcmllc19kYXRhc2V0XCIpIHtcbiAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IHRoZSBmaWxlIG5hbWUgbWF0Y2hlcyB0aGUgZGF0YXNldElkICh3aGljaCBpcyBzdG9yZWQgaW4gdGhlIHBhcmVudCBkYXRhc2V0X2xhbmRpbmcgcGFnZVxuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRVcmwgPSBnZXRQYXJlbnRQYWdlKGRhdGEudXJpKTtcblxuICAgICAgICAgICAgICAgIGZldGNoKHBhcmVudFVybCArICcvZGF0YScsIHtjcmVkZW50aWFsczogJ2luY2x1ZGUnfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocGFyZW50RGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YXNldElkID0gKHBhcmVudERhdGEuZGVzY3JpcHRpb24uZGF0YXNldElkKS50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRUaXRsZSA9ICgoZmlsZS5uYW1lKS5zcGxpdCgnLicpLnNoaWZ0KCkpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YXNldElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaHJvdyBlcnJvciBpZiB0aGUgcGFyZW50IHBhZ2UgaGFzIG5vIGRhdGFzZXQgSURcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRhdGFzZXQgbWlzc2luZyBhbiBJRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiUGxlYXNlIGdvIHRvIHRoZSBwYXJlbnQgcGFnZSBhbmQgZ2l2ZSB0aGUgZGF0YXNldCBhbiBJRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhc2V0SWQgIT09IGRvd25sb2FkVGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRocm93IGVycm9yIHRvIHVzZXIgaWYgZmlsZSBuYW1lIGFuZCBkYXRhc2V0IElEIGRvbid0IG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJDU0RCIGZpbGVuYW1lIG11c3QgbWF0Y2ggdGhlIGRhdGFzZXQncyBJRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVTdWJtaXR0ZWRGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGdldHRpbmcgdGltZXNlcmllcyBkYXRhc2V0IHBhcmVudCBkYXRhLi4uIFwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vdCBhIHRpbWVzZXJpZXNfZGF0YXNldCwgc28gY29udGludWUgd2l0aCBzYXZpbmcgZmlsZSBhcyBub3JtYWxcbiAgICAgICAgICAgICAgICBzYXZlU3VibWl0dGVkRmlsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzYXZlU3VibWl0dGVkRmlsZSgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNwb25zZVwiKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZUVsZW0uaW5uZXJIVE1MID0gXCJVcGxvYWRpbmcgLiAuIC5cIjtcblxuICAgICAgICAgICAgICAgIHZhciBmaWxlTmFtZU5vU3BhY2UgPSBmaWxlLm5hbWUucmVwbGFjZSgvW15hLXpBLVowLTlcXC5dL2csIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUubmFtZS5tYXRjaCgvXFwuY3N2JC8pKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lTm9TcGFjZSA9ICd1cGxvYWQtJyArIGZpbGVOYW1lTm9TcGFjZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXJpVXBsb2FkID0gZGF0YS51cmkgKyAnLycgKyBmaWxlTmFtZU5vU3BhY2U7XG4gICAgICAgICAgICAgICAgdmFyIHNhZmVVcmlVcGxvYWQgPSBjaGVja1BhdGhTbGFzaGVzKHVyaVVwbG9hZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoISFmaWxlLm5hbWUubWF0Y2goZG93bmxvYWRFeHRlbnNpb25zKSkge1xuICAgICAgICAgICAgICAgICAgICBzaG93VXBsb2FkZWRJdGVtKGZpbGVOYW1lTm9TcGFjZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWRhdGEuYXBwZW5kKFwibmFtZVwiLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkKCcjbGlzdCcpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnVGhpcyBmaWxlIHR5cGUgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VFbGVtLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICQoJyMnICsgbGFzdEluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdERhdGFzZXRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGZvcm1kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvY29udGVudC9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVVcmlVcGxvYWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmb3JtZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnVwbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLmZpbGVVcmwgPSBzYWZlVXJpVXBsb2FkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgbmV3IHZlcnNpb24vY29ycmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVOZXdDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VFbGVtLmlubmVySFRNTCA9IFwiRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXBEYXRlID0gRmxvcmVuY2UuY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSA/IEZsb3JlbmNlLmNvbGxlY3Rpb24ucHVibGlzaERhdGUgOiAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZEZpZWxkID09PSBcImNvcnJlY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0aW9uTm90aWNlOiBcIiBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGF0ZTogdG1wRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHZlcnNpb25MYWJlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVudGVyIGEgbm90aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IHt0aXRsZTogJ0NvcnJlY3Rpb24gbm90aWNlJywgbWFya2Rvd246ICcnfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZUNvbnRlbnQgPSBmdW5jdGlvbiAodXBkYXRlZENvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF1bZGF0YVtmaWVsZF0ubGVuZ3RoIC0gMV0uY29ycmVjdGlvbk5vdGljZSA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRvd25sb2FkcyA9IFt7ZmlsZTogZmlsZU5hbWVOb1NwYWNlfV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZGVkTm90U2F2ZWQuc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI1wiICsgaWRGaWVsZCkuZmluZCgnLmVkaXQtc2VjdGlvbl9fY29udGVudCcpLnByZXBlbmQoJzxkaXYgaWQ9XCJzb3J0YWJsZS0nICsgaWRGaWVsZCArICdcIiBjbGFzcz1cImVkaXQtc2VjdGlvbl9fc29ydGFibGVcIj4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGlkRmllbGQgKyAnLXNlY3Rpb24nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZURhdGFzZXRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRNYXJrZG93bkVkaXRvcihlZGl0ZWRTZWN0aW9uVmFsdWUsIHNhdmVDb250ZW50LCBkYXRhLCAnbm90RW1wdHknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Rpb25Ob3RpY2U6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZURhdGU6IHRtcERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVyaTogcmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB2ZXJzaW9uTGFiZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnZlcnNpb25MYWJlbCA9IHZlcnNpb25MYWJlbDsgLy8gb25seSB1cGRhdGUgdGhlIHZlcnNpb24gbGFiZWwgZm9yIHZlcnNpb25zIG5vdCBjb3JyZWN0aW9ucy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRvd25sb2FkcyA9IFt7ZmlsZTogZmlsZU5hbWVOb1NwYWNlfV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZWROb3RTYXZlZC5zYXZlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGlkRmllbGQpLmZpbmQoJy5lZGl0LXNlY3Rpb25fX2NvbnRlbnQnKS5wcmVwZW5kKCc8ZGl2IGlkPVwic29ydGFibGUtJyArIGlkRmllbGQgKyAnXCIgY2xhc3M9XCJlZGl0LXNlY3Rpb25fX3NvcnRhYmxlXCI+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGlkRmllbGQgKyAnLXNlY3Rpb24nKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlRGF0YXNldFZlcnNpb24oY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgY2FuIGFkZCBvbmx5IG9uZSBcIiArIGlkRmllbGQgKyBcIiBiZWZvcmUgcHVibGlzaGluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VFbGVtLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHVwbG9hZGVkTm90U2F2ZWQuZmlsZVVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgY2FuIG9ubHkgYWRkIFwiICsgaWRGaWVsZCArIFwicyB0byBjb250ZW50IHRoYXQgaGFzIGJlZW4gcHVibGlzaGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUVsZW0uaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgdXBsb2FkZWROb3RTYXZlZC5maWxlVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlRWxlbS5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgaW4gdXBsb2FkaW5nIHRoaXMgZmlsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnI25vLWZpbGUnKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIC8vIGV4dHJhIHNlY3VyaXR5IGNoZWNrXG4gICAgICAgICAgICBpZiAoZGF0YS50eXBlID09PSAndGltZXNlcmllc19kYXRhc2V0Jykge1xuICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uTGFiZWwgPSAkKCcjVXBsb2FkRm9ybSAjbGFiZWwnKS52YWwoKTtcbiAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnVwbG9hZGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIG5ldyB2ZXJzaW9uL2NvcnJlY3Rpb25cbiAgICAgICAgICAgICAgICBzYXZlTmV3Q29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXBEYXRlID0gRmxvcmVuY2UuY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSA/IEZsb3JlbmNlLmNvbGxlY3Rpb24ucHVibGlzaERhdGUgOiAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZEZpZWxkID09PSBcImNvcnJlY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0aW9uTm90aWNlOiBcIiBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGF0ZTogdG1wRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHZlcnNpb25MYWJlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVudGVyIGEgbm90aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IHt0aXRsZTogJ0NvcnJlY3Rpb24gbm90aWNlJywgbWFya2Rvd246ICcnfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZUNvbnRlbnQgPSBmdW5jdGlvbiAodXBkYXRlZENvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF1bZGF0YVtmaWVsZF0ubGVuZ3RoIC0gMV0uY29ycmVjdGlvbk5vdGljZSA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RhdGEuZG93bmxvYWRzID0gW3tmaWxlOiBmaWxlTmFtZU5vU3BhY2V9XTsgICAgLy8gbm90IG5lY2Vzc2FyeSBhcyB6ZWJlZGVlIHdpbGwgaGF2ZSBhIENTREIgZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnNhdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGlkRmllbGQpLmZpbmQoJy5lZGl0LXNlY3Rpb25fX2NvbnRlbnQnKS5wcmVwZW5kKCc8ZGl2IGlkPVwic29ydGFibGUtJyArIGlkRmllbGQgKyAnXCIgY2xhc3M9XCJlZGl0LXNlY3Rpb25fX3NvcnRhYmxlXCI+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjXCIgKyBpZEZpZWxkICsgJy1zZWN0aW9uJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0aW9uTm90aWNlOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVEYXRlOiB0bXBEYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmk6IHJlc3BvbnNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdmVyc2lvbkxhYmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi52ZXJzaW9uTGFiZWwgPSB2ZXJzaW9uTGFiZWw7IC8vIG9ubHkgdXBkYXRlIHRoZSB2ZXJzaW9uIGxhYmVsIGZvciB2ZXJzaW9ucyBub3QgY29ycmVjdGlvbnMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXRhLmRvd25sb2FkcyA9IFt7ZmlsZTogZmlsZU5hbWVOb1NwYWNlfV07ICAgIC8vIG5vdCBuZWNlc3NhcnkgYXMgemViZWRlZSB3aWxsIGhhdmUgYSBDU0RCIGZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnNhdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI1wiICsgaWRGaWVsZCkuZmluZCgnLmVkaXQtc2VjdGlvbl9fY29udGVudCcpLnByZXBlbmQoJzxkaXYgaWQ9XCJzb3J0YWJsZS0nICsgaWRGaWVsZCArICdcIiBjbGFzcz1cImVkaXQtc2VjdGlvbl9fc29ydGFibGVcIj4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI1wiICsgaWRGaWVsZCArICctc2VjdGlvbicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIllvdSBjYW4gYWRkIG9ubHkgb25lIFwiICsgaWRGaWVsZCArIFwiIGJlZm9yZSBwdWJsaXNoaW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgdXBsb2FkZWROb3RTYXZlZC5maWxlVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIllvdSBjYW4gb25seSBhZGQgXCIgKyBpZEZpZWxkICsgXCJzIHRvIGNvbnRlbnQgdGhhdCBoYXMgYmVlbiBwdWJsaXNoZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCB1cGxvYWRlZE5vdFNhdmVkLmZpbGVVcmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIk9vcHMhXCIsIFwiSXQgbG9va3MgbGlrZSB0aGlzIGlzIG5vdCBhIHRpbWVzZXJpZXMgZGF0YXNldC5cIiwgXCJlcnJvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByZWZyZXNoRGF0YXNldFZlcnNpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIHZhciBhamF4UmVxdWVzdCA9IFtdO1xuICAgIHZhciB0ZW1wbGF0ZURhdGEgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGF0YSk7XG4gICAgJCh0ZW1wbGF0ZURhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdmVyc2lvbikge1xuICAgICAgICB2YXIgZGZkID0gJC5EZWZlcnJlZCgpO1xuICAgICAgICBpZiAodmVyc2lvbi5jb3JyZWN0aW9uTm90aWNlKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS50eXBlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLnR5cGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5sYWJlbCA9IHZlcnNpb24ubGFiZWw7XG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICAgIGFqYXhSZXF1ZXN0LnB1c2goZGZkKTtcbiAgICB9KTtcblxuICAgICQud2hlbi5hcHBseSgkLCBhamF4UmVxdWVzdCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGluaXRpYWxpc2VEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIH0pO1xuXG59XG5cbmZ1bmN0aW9uIGluaXRpYWxpc2VEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICAvLyBMb2FkXG4gICAgdmFyIGxpc3QgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICAgIHZhciBjb3JyZWN0aW9uO1xuICAgIGlmIChpZEZpZWxkID09PSAnY29ycmVjdGlvbicpIHtcbiAgICAgICAgY29ycmVjdGlvbiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29ycmVjdGlvbiA9IGZhbHNlO1xuICAgIH1cbiAgICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGNvcnJlY3Rpb246IGNvcnJlY3Rpb259O1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDhWZXJzaW9uTGlzdChkYXRhVGVtcGxhdGUpO1xuICAgICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG5cbiAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAvL2RhdGVUbXAgPSBkYXRhW2ZpZWxkXVtpbmRleF0udXBkYXRlRGF0ZTtcbiAgICAgICAgLy92YXIgZGF0ZVRtcEZvcm1hdHRlZCA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCdkZCBNTSB5eScsIG5ldyBEYXRlKGRhdGVUbXApKTtcbiAgICAgICAgLy8kKCcjJyArIGlkRmllbGQgKyAnLWRhdGVfJyArIGluZGV4KS52YWwoZGF0ZVRtcEZvcm1hdHRlZCkuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vICBkYXRhW2ZpZWxkXVtpbmRleF0udXBkYXRlRGF0ZSA9IG5ldyBEYXRlKCQoJyMnICsgaWRGaWVsZCArICctZGF0ZV8nICsgaW5kZXgpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgLy8gIHNhdmVEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgIC8vfSk7XG5cbiAgICAgICAgZGF0ZVRtcCA9IGRhdGFbZmllbGRdW2luZGV4XS51cGRhdGVEYXRlO1xuXG4gICAgICAgIHZhciBtb250aE5hbWUgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgbW9udGhOYW1lWzBdID0gXCJKYW51YXJ5XCI7XG4gICAgICAgIG1vbnRoTmFtZVsxXSA9IFwiRmVicnVhcnlcIjtcbiAgICAgICAgbW9udGhOYW1lWzJdID0gXCJNYXJjaFwiO1xuICAgICAgICBtb250aE5hbWVbM10gPSBcIkFwcmlsXCI7XG4gICAgICAgIG1vbnRoTmFtZVs0XSA9IFwiTWF5XCI7XG4gICAgICAgIG1vbnRoTmFtZVs1XSA9IFwiSnVuZVwiO1xuICAgICAgICBtb250aE5hbWVbNl0gPSBcIkp1bHlcIjtcbiAgICAgICAgbW9udGhOYW1lWzddID0gXCJBdWd1c3RcIjtcbiAgICAgICAgbW9udGhOYW1lWzhdID0gXCJTZXB0ZW1iZXJcIjtcbiAgICAgICAgbW9udGhOYW1lWzldID0gXCJPY3RvYmVyXCI7XG4gICAgICAgIG1vbnRoTmFtZVsxMF0gPSBcIk5vdmVtYmVyXCI7XG4gICAgICAgIG1vbnRoTmFtZVsxMV0gPSBcIkRlY2VtYmVyXCI7XG4gICAgICAgIC8vdmFyIG4gPSBtb250aE5hbWVbdGhlRGF0ZVRpbWUuZ2V0TW9udGgoKV07XG5cbiAgICAgICAgdGhlRGF0ZVRpbWUgPSBuZXcgRGF0ZShkYXRlVG1wKTtcbiAgICAgICAgdGhlWWVhciA9IHRoZURhdGVUaW1lLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIHRoZU1vbnRoID0gbW9udGhOYW1lW3RoZURhdGVUaW1lLmdldE1vbnRoKCldO1xuICAgICAgICB0aGVEYXkgPSBhZGRMZWFkaW5nWmVybyh0aGVEYXRlVGltZS5nZXREYXRlKCkpO1xuICAgICAgICB0aGVIb3VycyA9IGFkZExlYWRpbmdaZXJvKHRoZURhdGVUaW1lLmdldEhvdXJzKCkpO1xuICAgICAgICB0aGVNaW51dGVzID0gYWRkTGVhZGluZ1plcm8odGhlRGF0ZVRpbWUuZ2V0TWludXRlcygpKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGVIb3VycyArJzonKyB0aGVNaW51dGVzKTtcblxuICAgICAgICB2YXIgZGF0ZVRpbWVJbnB1dFN0cmluZyA9IHRoZURheSArICcgJyArIHRoZU1vbnRoICsgJyAnICsgdGhlWWVhciArICcgJyArIHRoZUhvdXJzICsgJzonICsgdGhlTWludXRlcztcblxuICAgICAgICBmdW5jdGlvbiBhZGRMZWFkaW5nWmVybyhudW1iZXIpIHtcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSAnMCcgKyBudW1iZXI7XG4gICAgICAgICAgICBudW1iZXIgPSBudW1iZXIuc2xpY2UoLTIpO1xuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJyMnICsgaWRGaWVsZCArICctZGF0ZV8nICsgaW5kZXgpLnZhbChkYXRlVGltZUlucHV0U3RyaW5nKS5kYXRldGltZXBpY2tlcih7XG4gICAgICAgICAgICBkYXRlRm9ybWF0OiAnZGQgTU0geXknLFxuICAgICAgICAgICAgY29udHJvbFR5cGU6ICdzZWxlY3QnLFxuICAgICAgICAgICAgb25lTGluZTogdHJ1ZSxcbiAgICAgICAgICAgIHRpbWVGb3JtYXQ6ICdISDptbScsXG4gICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gaXNEb25lUHJlc3NlZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkKCcjdWktZGF0ZXBpY2tlci1kaXYnKS5odG1sKCkuaW5kZXhPZigndWktZGF0ZXBpY2tlci1jbG9zZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXByaW1hcnkgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1ob3ZlcicpID4gLTEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0RvbmVQcmVzc2VkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLnVwZGF0ZURhdGUgPSBuZXcgRGF0ZSgkKCcjJyArIGlkRmllbGQgKyAnLWRhdGVfJyArIGluZGV4KS5kYXRldGltZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJ1biBzYXZlIFwiICsgaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICBzYXZlRGF0YXNldFZlcnNpb24oY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGlkRmllbGQgPT09ICdjb3JyZWN0aW9uJykge1xuICAgICAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1lZGl0XycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBtYXJrZG93biA9IGRhdGFbZmllbGRdW2luZGV4XS5jb3JyZWN0aW9uTm90aWNlO1xuICAgICAgICAgICAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb3JyZWN0aW9uIG5vdGljZScsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgICAgICAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS5jb3JyZWN0aW9uTm90aWNlID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAkKCcjJyArIGlkRmllbGQgKyAnLWVkaXQtbGFiZWxfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbWFya2Rvd24gPSBkYXRhW2ZpZWxkXVtpbmRleF0ubGFiZWwgPyBkYXRhW2ZpZWxkXVtpbmRleF0ubGFiZWwgOiBcIlwiO1xuICAgICAgICAgICAgdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IHt0aXRsZTogJ0xhYmVsIGNvbnRlbnQnLCBtYXJrZG93bjogbWFya2Rvd259O1xuICAgICAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLmxhYmVsID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSBkYXRhW2ZpZWxkXS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24udmVyc2lvbkxhYmVsID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNhdmVEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gRGVsZXRlXG4gICAgICAgICQoJyMnICsgaWRGaWVsZCArICctZGVsZXRlXycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiV2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHRleHQ6IFwiVGhpcyB3aWxsIHJldmVydCBhbGwgY2hhbmdlcyB5b3UgaGF2ZSBtYWRlIGluIHRoaXMgZmlsZS4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIFwiICsgaWRGaWVsZCArIFwiP1wiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJUaGlzIFwiICsgaWRGaWVsZCArIFwiIHZlcnNpb24gaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGhUb0RlbGV0ZSA9IGRhdGEudXJpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVRvRGVsZXRlID0gcGF0aFRvRGVsZXRlICsgJy8nICsgZGF0YS5kb3dubG9hZHNbMF0uZmlsZTsgIC8vU2F2ZXMgYWx3YXlzIHRoZSBsYXRlc3RcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVyaVRvRGVsZXRlID0gJCgnIycgKyBpZEZpZWxkICsgJy1lZGl0aW9uXycgKyBpbmRleCkuYXR0cihpZEZpZWxkICsgJy11cmwnKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlVW5wdWJsaXNoZWRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgdXJpVG9EZWxldGUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgaWRGaWVsZCArICctZGVsZXRlXycgKyBpbmRleCkucGFyZW50KCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgdXBsb2FkZWQgZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGZpbGVUb0RlbGV0ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmlsZSBkZWxldGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGVyZSB3YXMgbm8gQ1NEQiBmaWxlIHRvIGRlbGV0ZSBvciB0aGlzIFwiICsgaWRGaWVsZCArIFwiIGhhcyBiZWVuIGFscmVhZHkgcHVibGlzaGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBtb2RpZmllZCBkYXRhLmpzb24gYW5kIHJldmVydCB0byBwdWJsaXNoZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoVG9EZWxldGUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKHBhdGhUb0RlbGV0ZSwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoUHJldmlldyhwYXRoVG9EZWxldGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIllvdSBjYW5ub3QgZGVsZXRlIGEgXCIgKyBpZEZpZWxkICsgXCIgdGhhdCBoYXMgYmVlbiBwdWJsaXNoZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbn1cblxuZnVuY3Rpb24gc2F2ZURhdGFzZXRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgcGF0aCwgZGF0YSwgZmllbGQsIGlkRmllbGQpIHtcblxuICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlZnJlc2hEYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KHBhdGgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cbi8qKlxuICogTWFuYWdlcyBkYXRlcyBmb3IgcmVsZWFzZSBjYWxlbmRhclxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSB0ZW1wbGF0ZURhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXlcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlXG4gKi9cblxuZnVuY3Rpb24gZWRpdERhdGUoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHZhciBsaXN0ID0gdGVtcGxhdGVEYXRhW2ZpZWxkXTtcbiAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgcnVuRGF0ZVBpY2tlcihkYXRhVGVtcGxhdGUpO1xuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JEYXRlKGRhdGFUZW1wbGF0ZSk7XG4gICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gIGluaXRpYWxpc2VOb3RlTWFya2Rvd24oY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbn1cblxuZnVuY3Rpb24gcnVuRGF0ZVBpY2tlcihkYXRhVGVtcGxhdGUpIHtcbiAgaWYoZGF0YVRlbXBsYXRlICYmIGRhdGFUZW1wbGF0ZS5saXN0KSB7XG4gICAgdmFyIGNvdW50U2VjdGlvbnMgPSBkYXRhVGVtcGxhdGUubGlzdC5sZW5ndGg7XG4gICAgdmFyIGkgPSAwO1xuICAgIHdoaWxlIChpIDwgY291bnRTZWN0aW9ucykge1xuICAgICAgdmFyIHRtcERhdGUgPSBkYXRhVGVtcGxhdGUubGlzdFtpXS5wcmV2aW91c0RhdGU7XG4gICAgICBkYXRhVGVtcGxhdGUubGlzdFtpXS5wcmV2aW91c0RhdGUgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZSh0bXBEYXRlKSk7XG4gICAgICBpKys7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hOb3RlTWFya2Rvd24oY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHZhciBsaXN0ID0gdGVtcGxhdGVEYXRhW2ZpZWxkXTtcbiAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgcnVuRGF0ZVBpY2tlcihkYXRhVGVtcGxhdGUpO1xuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JEYXRlKGRhdGFUZW1wbGF0ZSk7XG4gICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoJChodG1sKS5maW5kKCcjc29ydGFibGUtJyArIGlkRmllbGQpKTtcbiAgaW5pdGlhbGlzZU5vdGVNYXJrZG93bihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpXG59XG5cbmZ1bmN0aW9uIGluaXRpYWxpc2VOb3RlTWFya2Rvd24oY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIC8vIExvYWRcbiAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAkKCcjJyArIGlkRmllbGQgKyAnLW5vdGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbWFya2Rvd24gPSAkKCcjJyArIGlkRmllbGQgKyAnLW1hcmtkb3duXycgKyBpbmRleCkudmFsKCk7XG4gICAgICB2YXIgZWRpdGVkU2VjdGlvblZhbHVlID0ge3RpdGxlOiAnTm90ZScsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgICB2YXIgc2F2ZUNvbnRlbnQgPSBmdW5jdGlvbiAodXBkYXRlZENvbnRlbnQpIHtcbiAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLmNoYW5nZU5vdGljZSA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5jaGFuZ2VOb3RpY2UgPSB1cGRhdGVkQ29udGVudDtcbiAgICAgICAgc2F2ZU5vdGVNYXJrZG93bihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgIH07XG4gICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzYXZlTm90ZU1hcmtkb3duKGNvbGxlY3Rpb25JZCwgcGF0aCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICByZWZyZXNoTm90ZU1hcmtkb3duKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICByZWZyZXNoUHJldmlldyhkYXRhLnVyaSk7XG4gICAgfSxcbiAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICApO1xufVxuXG4vKipcbiAqIE1hbmFnZSBjb3JyZWN0aW9uIG9mIGRvY3VtZW50cyB3aXRoIGZpbGVzIGF0dGFjaGVkIChjb21wZW5kaXVtX2RhdGEsIGFydGljbGVfZG93bmxvYWQpXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleSAoJ3ZlcnNpb25zJylcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlICgnY29ycmVjdGlvbicpXG4gKi9cblxuZnVuY3Rpb24gZWRpdERvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICB2YXIgZG93bmxvYWRFeHRlbnNpb25zLCBmaWxlO1xuICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgfVxuICB2YXIgb2xkRmlsZSA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkYXRhKTtcbiAgdmFyIHVwbG9hZGVkTm90U2F2ZWQgPSB7dXBsb2FkZWQ6IGZhbHNlLCBzYXZlZDogZmFsc2UsIGZpbGVzOiBvbGRGaWxlLmRvd25sb2Fkc307XG4gICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyk7XG4gIC8vQWRkIGZpbGUgdHlwZXNcbiAgaWYgKGRhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fZGF0YScpe1xuICAgIGRvd25sb2FkRXh0ZW5zaW9ucyA9IC9cXC5jc3YkfC54bHMkfC56aXAkLztcbiAgfVxuICBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdhcnRpY2xlX2Rvd25sb2FkJyl7XG4gICAgZG93bmxvYWRFeHRlbnNpb25zID0gL1xcLnBkZiQvO1xuICB9XG5cbiAgcmVmcmVzaERvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG5cblxuICAkKFwiI2FkZC1cIiArIGlkRmllbGQpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAkKFwiI2FkZC1cIiArIGlkRmllbGQpLnBhcmVudCgpLmFwcGVuZCgnPGJ1dHRvbiBjbGFzcz1cImJ0bi1wYWdlLWRlbGV0ZVwiJyArXG4gICAgICAnIGlkPVwiY2FuY2VsLWNvcnJlY3Rpb25cIj5DYW5jZWw8L2J1dHRvbj4nKTtcbiAgICAvL0Rpc3BsYXkgdGhlIGxpc3Qgb2YgdXBsb2FkZWQgZmlsZXMgaW4gdGhlIHJlZiB0YWJsZVxuICAgIHZhciBsaXN0ID0gZGF0YS5kb3dubG9hZHM7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZWRpdG9yRG9jV2l0aEZpbGVzKGxpc3QpO1xuICAgICQoJyNzb3J0YWJsZS1jb3JyZWN0aW9uJykuYXBwZW5kKGh0bWwpO1xuXG4gICAgLy9VcGRhdGUgdGhlIGZpbGVzIHRvIGJlIGNvcnJlY3RlZFxuICAgICQoZGF0YS5kb3dubG9hZHMpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAkKCcjY29ycmVjdGlvbi11cGxvYWRfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZpbGVDb3JyZWN0aW9uKGluZGV4KTtcbiAgICAgIH0pLmNoaWxkcmVuKCkuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy9DYW5jZWwgdGhlIGNvcnJlY3Rpb25cbiAgICAkKCcjY2FuY2VsLWNvcnJlY3Rpb24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAvL0NoZWNrIHRoZSBmaWxlcyB1cGxvYWRlZFxuICAgICAgdmFyIGZpbGVzVG9EZWxldGUgPSBjaGVja0ZpbGVzVXBsb2FkZWQgKHVwbG9hZGVkTm90U2F2ZWQuZmlsZXMsIGRhdGEuZG93bmxvYWRzKTtcbiAgICAgIGlmIChmaWxlc1RvRGVsZXRlKSB7XG4gICAgICAgIF8uZWFjaChmaWxlc1RvRGVsZXRlLCBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgIHZhciBmaWxlVG9EZWxldGUgPSBkYXRhLnVyaSArIGZpbGU7XG4gICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGZpbGVUb0RlbGV0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgbG9hZFBhZ2VEYXRhSW50b0VkaXRvcihkYXRhLnVyaSwgY29sbGVjdGlvbklkKTtcbiAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICB9KTtcblxuICAgIC8vU2F2ZSB0aGUgY29ycmVjdGlvblxuICAgICQoXCIjYWRkLVwiICsgaWRGaWVsZCkuaHRtbChcIlNhdmUgY29ycmVjdGlvblwiKS5vbigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHNhdmVOZXdDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksXG4gICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIHZhciB0bXBEYXRlID0gKG5ldyBEYXRlKCkpLnRvSVNPU3RyaW5nKCk7ICAgICAgICAgICAvLyBpdCBjb3VsZCB1c2UgcmVsZWFzZURhdGVcbiAgICAgICAgICBkYXRhW2ZpZWxkXS5wdXNoKHtcbiAgICAgICAgICAgIGNvcnJlY3Rpb25Ob3RpY2U6IFwiXCIsXG4gICAgICAgICAgICB1cGRhdGVEYXRlOiB0bXBEYXRlLFxuICAgICAgICAgICAgdXJpOiByZXNwb25zZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHVwbG9hZGVkTm90U2F2ZWQuc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICQoXCIjYWRkLVwiICsgaWRGaWVsZCkucGFyZW50cygnLmVkaXQtc2VjdGlvbl9fY29udGVudCcpLnJlbW92ZSgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKVxuICAgICAgICAgICAgLmZpbmQoJy50ZXh0LWNlbnRlcicpLnByZXBlbmQoJzxkaXYgaWQ9XCJzb3J0YWJsZS0nICsgaWRGaWVsZCArICdcIiBjbGFzcz1cImVkaXQtc2VjdGlvbl9fc29ydGFibGVcIj4nKTsgIC8vY2hlY2sgLmFmdGVyKClcbiAgICAgICAgICAvLyBFbnRlciBhIG5vdGljZVxuICAgICAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdFbnRlciBjb3JyZWN0aW9uIG5vdGljZScsIG1hcmtkb3duOiAnJ307XG4gICAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgICBkYXRhW2ZpZWxkXVtkYXRhW2ZpZWxkXS5sZW5ndGggLSAxXS5jb3JyZWN0aW9uTm90aWNlID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgICBzYXZlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgICAgICAgLy9zYXZlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgLy9SZXZlcnQgdG8gY29uZGl0aW9uIGJlZm9yZSBlcnJvclxuICAgICAgICAgICAgdmFyIGZpbGVzVG9EZWxldGUgPSBjaGVja0ZpbGVzVXBsb2FkZWQodXBsb2FkZWROb3RTYXZlZC5maWxlcywgZGF0YS5kb3dubG9hZHMpO1xuICAgICAgICAgICAgaWYgKGZpbGVzVG9EZWxldGUpIHtcbiAgICAgICAgICAgICAgXy5lYWNoKGZpbGVzVG9EZWxldGUsIGZ1bmN0aW9uIChkb3dubG9hZCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlVG9EZWxldGUgPSBkYXRhLnVyaSArICcvJyArIGRvd25sb2FkO1xuICAgICAgICAgICAgICAgIGRlbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBmaWxlVG9EZWxldGUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgY2FuIGFkZCBvbmx5IG9uZSBcIiArIGlkRmllbGQgKyBcIiBiZWZvcmUgcHVibGlzaGluZy5cIik7XG4gICAgICAgICAgICByZWZyZXNoRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAgIC8vUmV2ZXJ0IHRvIGNvbmRpdGlvbiBiZWZvcmUgZXJyb3JcbiAgICAgICAgICAgIHZhciBmaWxlc1RvRGVsZXRlID0gY2hlY2tGaWxlc1VwbG9hZGVkKHVwbG9hZGVkTm90U2F2ZWQuZmlsZXMsIGRhdGEuZG93bmxvYWRzKTtcbiAgICAgICAgICAgIGlmIChmaWxlc1RvRGVsZXRlKSB7XG4gICAgICAgICAgICAgIF8uZWFjaChmaWxlc1RvRGVsZXRlLCBmdW5jdGlvbiAoZG93bmxvYWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVRvRGVsZXRlID0gZGF0YS51cmkgKyAnLycgKyBkb3dubG9hZDtcbiAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZmlsZVRvRGVsZXRlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhLmRvd25sb2FkcyA9IHVwbG9hZGVkTm90U2F2ZWQuZmlsZXM7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KFwiWW91IGNhbiBvbmx5IGFkZCBcIiArIGlkRmllbGQgKyBcInMgdG8gY29udGVudCB0aGF0IGhhcyBiZWVuIHB1Ymxpc2hlZC5cIik7XG4gICAgICAgICAgICByZWZyZXNoRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvL1JldmVydCB0byBjb25kaXRpb24gYmVmb3JlIGVycm9yXG4gICAgICAgICAgICB2YXIgZmlsZXNUb0RlbGV0ZSA9IGNoZWNrRmlsZXNVcGxvYWRlZCh1cGxvYWRlZE5vdFNhdmVkLmZpbGVzLCBkYXRhLmRvd25sb2Fkcyk7XG4gICAgICAgICAgICBpZiAoZmlsZXNUb0RlbGV0ZSkge1xuICAgICAgICAgICAgICBfLmVhY2goZmlsZXNUb0RlbGV0ZSwgZnVuY3Rpb24gKGRvd25sb2FkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVUb0RlbGV0ZSA9IGRhdGEudXJpICsgJy8nICsgZG93bmxvYWQ7XG4gICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGZpbGVUb0RlbGV0ZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgcmVmcmVzaERvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBmdW5jdGlvbiBmaWxlQ29ycmVjdGlvbihpbmRleCkge1xuICAgIHZhciBwb3NpdGlvbiA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gcG9zaXRpb24gKyAyMDA7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMudXBsb2FkRmlsZUZvcm0oaW5kZXgpO1xuICAgICQoJyNjb3JyZWN0aW9uLWZpbGVuYW1lX3Nob3dfJyArIGluZGV4KS5hcHBlbmQoaHRtbCk7XG5cbiAgICAkKCcjZmlsZS1jYW5jZWwnKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICQoJyMnICsgaW5kZXgpLnJlbW92ZSgpO1xuICAgICAgaWYgKHVwbG9hZGVkTm90U2F2ZWQudXBsb2FkZWQgPT09IHRydWUgJiYgdXBsb2FkZWROb3RTYXZlZC5zYXZlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgZGF0YS5kb3dubG9hZHNbaW5kZXhdLmZpbGUgPSB1cGxvYWRlZE5vdFNhdmVkLmZpbGVzW2luZGV4XS5maWxlO1xuICAgICAgICB2YXIgZmlsZVRvRGVsZXRlID0gZGF0YS51cmkgKyAnLycgKyB1cGxvYWRlZE5vdFNhdmVkLmZpbGVzW2luZGV4XS5maWxlO1xuICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZmlsZVRvRGVsZXRlKTtcbiAgICAgIH1cbiAgICAgIHJlZnJlc2hEb2NXaXRoRmlsZXNDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIH0pO1xuXG4gICAgJCgnI1VwbG9hZEZvcm0nKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIHZhciBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXG4gICAgICBmdW5jdGlvbiBzaG93VXBsb2FkZWRJdGVtKHNvdXJjZSkge1xuICAgICAgICAkKCcjbGlzdCcpLmFwcGVuZChzb3VyY2UpO1xuICAgICAgfVxuXG4gICAgICBmaWxlID0gdGhpc1swXS5maWxlc1swXTtcbiAgICAgIGlmICghZmlsZSkge1xuICAgICAgICBhbGVydCgnUGxlYXNlIHNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkLicpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzcG9uc2VcIikuaW5uZXJIVE1MID0gXCJVcGxvYWRpbmcgLiAuIC5cIjtcblxuICAgICAgdmFyIGZpbGVOYW1lTm9TcGFjZSA9IGZpbGUubmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLl0vZywgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgaWYgKCEhZmlsZS5uYW1lLm1hdGNoKGRvd25sb2FkRXh0ZW5zaW9ucykpIHtcbiAgICAgICAgc2hvd1VwbG9hZGVkSXRlbShmaWxlTmFtZU5vU3BhY2UpO1xuICAgICAgICBpZiAoZm9ybWRhdGEpIHtcbiAgICAgICAgICBmb3JtZGF0YS5hcHBlbmQoXCJuYW1lXCIsIGZpbGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhbGVydCgnVGhpcyBmaWxlIHR5cGUgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgICAkKCcjJyArIGluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgZWRpdERvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGZvcm1kYXRhKSB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBkYXRhLnVyaSArICcvJyArIGZpbGVOYW1lTm9TcGFjZSxcbiAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgZGF0YTogZm9ybWRhdGEsXG4gICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNwb25zZVwiKS5pbm5lckhUTUwgPSBcIkZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5XCI7XG4gICAgICAgICAgICB1cGxvYWRlZE5vdFNhdmVkLnVwbG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICQoJyMnICsgaW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJCgnI2NvcnJlY3Rpb24tZmlsZW5hbWVfc2hvd18nICsgaW5kZXgpLnJlcGxhY2VXaXRoKCc8cCBpZD1cImNvcnJlY3Rpb24tZmlsZW5hbWVfc2hvd18nICsgaW5kZXggKyAnXCI+JyArIGZpbGVOYW1lTm9TcGFjZSArICc8L3A+Jyk7XG4gICAgICAgICAgICBkYXRhLmRvd25sb2Fkc1tpbmRleF0uZmlsZSA9IGZpbGVOYW1lTm9TcGFjZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hEb2NXaXRoRmlsZXNDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcbiAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZWRpdG9yQ29ycmVjdGlvbihkYXRhVGVtcGxhdGUpO1xuICAkKCcjJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICBpbml0aWFsaXNlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKVxufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIC8vIExvYWRcbiAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICBkYXRlVG1wID0gZGF0YVtmaWVsZF1baW5kZXhdLnVwZGF0ZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnIycgKyBpZEZpZWxkICsgJy1kYXRlXycgKyBpbmRleCkudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLnVwZGF0ZURhdGUgPSBuZXcgRGF0ZSgkKCcjJyArIGlkRmllbGQgKyAnLWRhdGVfJyArIGluZGV4KS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgICBzYXZlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgfSk7XG4gICAgaWYgKGlkRmllbGQgPT09ICdjb3JyZWN0aW9uJykge1xuICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1lZGl0XycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWFya2Rvd24gPSAkKCcjJyArIGlkRmllbGQgKyAnLW1hcmtkb3duXycgKyBpbmRleCkudmFsKCk7XG4gICAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb3JyZWN0aW9uIG5vdGljZScsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS5jb3JyZWN0aW9uTm90aWNlID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgc2F2ZURvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICB9O1xuICAgICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBEZWxldGVcbiAgICAkKCcjJyArIGlkRmllbGQgKyAnLWRlbGV0ZV8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXN1bHQgPSBjb25maXJtKFwiVGhpcyB3aWxsIHJldmVydCBhbGwgY2hhbmdlcyB5b3UgaGF2ZSBtYWRlIGluIHRoaXMgZmlsZS4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZVwiICtcbiAgICAgICAgXCIgdGhpcyBcIiArIGlkRmllbGQgKyBcIj9cIik7XG4gICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgIHZhciBwYXRoVG9EZWxldGUgPSBkYXRhLnVyaTtcbiAgICAgICAgdmFyIGZpbGVzVG9EZWxldGUgPSBkYXRhLmRvd25sb2FkczsgIC8vRGVsZXRlIGFsbCBmaWxlcyBpbiBkaXJlY3RvcnlcbiAgICAgICAgdmFyIHVyaVRvRGVsZXRlID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbignIycgKyBpZEZpZWxkICsgJy1lZGl0aW9uXycgKyBpbmRleCkuYXR0cihpZEZpZWxkICsgJy11cmwnKTtcbiAgICAgICAgZGVsZXRlVW5wdWJsaXNoZWRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgdXJpVG9EZWxldGUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uO1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlKCk7XG4gICAgICAgICAgLy9kZWxldGUgdXBsb2FkZWQgZmlsZXMgaW4gdGhpcyBkaXJlY3RvcnlcbiAgICAgICAgICBfLmVhY2goZmlsZXNUb0RlbGV0ZSwgZnVuY3Rpb24gKGRvd25sb2FkKSB7XG4gICAgICAgICAgICBmaWxlVG9EZWxldGUgPSBkYXRhLnVyaSArICcvJyArIGRvd25sb2FkLmZpbGU7XG4gICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZmlsZVRvRGVsZXRlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBkZWxldGUgbW9kaWZpZWQgZGF0YS5qc29uIGFuZCByZXZlcnQgdG8gcHViaXNoZWRcbiAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aFRvRGVsZXRlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKHBhdGhUb0RlbGV0ZSwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KHBhdGhUb0RlbGV0ZSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihlcnJvcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgICAgc3dlZXRBbGVydChcIllvdSBjYW5ub3QgZGVsZXRlIGEgXCIgKyBpZEZpZWxkICsgXCIgdGhhdCBoYXMgYmVlbiBwdWJsaXNoZWQuXCIpO1xuXG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzYXZlRG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIHBhdGgsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICBmdW5jdGlvbiAoKSB7XG4gICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgcmVmcmVzaERvY1dpdGhGaWxlc0NvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICByZWZyZXNoUHJldmlldyhwYXRoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgIGFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlLiBJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICApO1xufVxuXG5mdW5jdGlvbiBjaGVja0ZpbGVzVXBsb2FkZWQgKG9sZEZpbGVzLCBuZXdGaWxlcykge1xuICB2YXIgZGlmZiA9IFtdO1xuICBfLmVhY2gob2xkRmlsZXMsIGZ1bmN0aW9uIChvbGRGaWxlLCBpKSB7XG4gICAgaWYgKG9sZEZpbGUuZmlsZSAhPT0gbmV3RmlsZXNbaV0uZmlsZSkge1xuICAgICAgZGlmZi5wdXNoKG5ld0ZpbGVzW2ldLmZpbGUpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBkaWZmO1xufVxuXG4vKipcbiAqIE1hbmFnZXMgY29ycmVjdGlvbnMgKHZlcnNpb25zKVxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSB0ZW1wbGF0ZURhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXlcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlXG4gKi9cblxuZnVuY3Rpb24gZWRpdERvY3VtZW50Q29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgdmFyIGxpc3QgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JDb3JyZWN0aW9uKGRhdGFUZW1wbGF0ZSk7XG4gICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gIGluaXRpYWxpc2VDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gIC8vIE5ldyBjb3JyZWN0aW9uXG4gICQoXCIjYWRkLVwiICsgaWRGaWVsZCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXSA9IFtdO1xuICAgIH1cbiAgICBzYXZlTmV3Q29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHZhciB0bXBEYXRlID0gRmxvcmVuY2UuY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSA/IEZsb3JlbmNlLmNvbGxlY3Rpb24ucHVibGlzaERhdGUgOiAobmV3IERhdGUoKSkudG9JU09TdHJpbmcoKTtcbiAgICAgIGRhdGFbZmllbGRdLnB1c2goe2NvcnJlY3Rpb25Ob3RpY2U6IFwiXCIsIHVwZGF0ZURhdGU6IHRtcERhdGUsIHVyaTogcmVzcG9uc2V9KTtcbiAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0ucHVzaCh7Y29ycmVjdGlvbk5vdGljZTogXCJcIiwgdXBkYXRlRGF0ZTogdG1wRGF0ZSwgdXJpOiByZXNwb25zZX0pO1xuICAgICAgLy8gRW50ZXIgYSBub3RpY2VcbiAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb3JyZWN0aW9uIG5vdGljZScsIG1hcmtkb3duOiBkYXRhW2ZpZWxkXS5jb3JyZWN0aW9uTm90aWNlfTtcbiAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICBkYXRhW2ZpZWxkXVtkYXRhW2ZpZWxkXS5sZW5ndGggLSAxXS5jb3JyZWN0aW9uTm90aWNlID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgIHNhdmVDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgfTtcbiAgICAgIGxvYWRNYXJrZG93bkVkaXRvcihlZGl0ZWRTZWN0aW9uVmFsdWUsIHNhdmVDb250ZW50LCBkYXRhLCAnbm90RW1wdHknKTtcbiAgICAgICQoXCIjYWRkLVwiICsgaWRGaWVsZCkucmVtb3ZlKCk7XG4gICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgc3dlZXRBbGVydChcIllvdSBjYW4gYWRkIG9ubHkgb25lIGNvcnJlY3Rpb24gYmVmb3JlIHB1Ymxpc2hpbmcuXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gIHZhciBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZH07XG4gIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvckNvcnJlY3Rpb24oZGF0YVRlbXBsYXRlKTtcbiAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aCgkKGh0bWwpLmZpbmQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkpO1xuICBpbml0aWFsaXNlQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgLy8gTG9hZFxuICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgIGRhdGVUbXAgPSBkYXRhW2ZpZWxkXVtpbmRleF0udXBkYXRlRGF0ZTtcbiAgICAvLyBPUklHSU5BTCBUSU1FIFBJQ0tFUiBDT0RFXG4gICAgLy8gdmFyIGRhdGVUbXBDb3JyID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgIC8vICQoJyNjb3JyZWN0aW9uLWRhdGVfJyArIGluZGV4KS52YWwoZGF0ZVRtcENvcnIpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIC8vICBkYXRhW2ZpZWxkXVtpbmRleF0udXBkYXRlRGF0ZSA9IG5ldyBEYXRlKCQoJyNjb3JyZWN0aW9uLWRhdGVfJyArIGluZGV4KS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgLy8gIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLnVwZGF0ZURhdGUgPSBuZXcgRGF0ZSgkKCcjY29ycmVjdGlvbi1kYXRlXycgKyBpbmRleCkuZGF0ZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgIC8vICBzYXZlQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAvLyB9KTtcblxuXG4gICAgdmFyIG1vbnRoTmFtZSA9IG5ldyBBcnJheSgpO1xuICAgIG1vbnRoTmFtZVswXSA9IFwiSmFudWFyeVwiO1xuICAgIG1vbnRoTmFtZVsxXSA9IFwiRmVicnVhcnlcIjtcbiAgICBtb250aE5hbWVbMl0gPSBcIk1hcmNoXCI7XG4gICAgbW9udGhOYW1lWzNdID0gXCJBcHJpbFwiO1xuICAgIG1vbnRoTmFtZVs0XSA9IFwiTWF5XCI7XG4gICAgbW9udGhOYW1lWzVdID0gXCJKdW5lXCI7XG4gICAgbW9udGhOYW1lWzZdID0gXCJKdWx5XCI7XG4gICAgbW9udGhOYW1lWzddID0gXCJBdWd1c3RcIjtcbiAgICBtb250aE5hbWVbOF0gPSBcIlNlcHRlbWJlclwiO1xuICAgIG1vbnRoTmFtZVs5XSA9IFwiT2N0b2JlclwiO1xuICAgIG1vbnRoTmFtZVsxMF0gPSBcIk5vdmVtYmVyXCI7XG4gICAgbW9udGhOYW1lWzExXSA9IFwiRGVjZW1iZXJcIjtcbiAgICAvL3ZhciBuID0gbW9udGhOYW1lW3RoZURhdGVUaW1lLmdldE1vbnRoKCldO1xuXG4gICAgdGhlRGF0ZVRpbWUgPSBuZXcgRGF0ZShkYXRlVG1wKTtcbiAgICB0aGVZZWFyID0gdGhlRGF0ZVRpbWUuZ2V0RnVsbFllYXIoKTtcbiAgICB0aGVNb250aCA9IG1vbnRoTmFtZVt0aGVEYXRlVGltZS5nZXRNb250aCgpXTtcbiAgICB0aGVEYXkgPSBhZGRMZWFkaW5nWmVybyh0aGVEYXRlVGltZS5nZXREYXRlKCkpO1xuICAgIHRoZUhvdXJzID0gYWRkTGVhZGluZ1plcm8odGhlRGF0ZVRpbWUuZ2V0SG91cnMoKSk7XG4gICAgdGhlTWludXRlcyA9IGFkZExlYWRpbmdaZXJvKHRoZURhdGVUaW1lLmdldE1pbnV0ZXMoKSk7XG4gICAgLy9jb25zb2xlLmxvZyh0aGVIb3VycyArJzonKyB0aGVNaW51dGVzKTtcblxuICAgIHZhciBkYXRlVGltZUlucHV0U3RyaW5nID0gdGhlRGF5ICsgJyAnICsgdGhlTW9udGggKyAnICcgKyB0aGVZZWFyICsgJyAnICsgdGhlSG91cnMgKyc6JyArIHRoZU1pbnV0ZXM7XG5cbiAgICBmdW5jdGlvbiBhZGRMZWFkaW5nWmVybyhudW1iZXIpe1xuICAgICAgdmFyIG51bWJlciA9ICcwJyArIG51bWJlcjtcbiAgICAgIG51bWJlciA9IG51bWJlci5zbGljZSgtMik7XG4gICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH1cblxuICAgICQoJyNjb3JyZWN0aW9uLWRhdGVfJyArIGluZGV4KS52YWwoZGF0ZVRpbWVJbnB1dFN0cmluZykuZGF0ZXRpbWVwaWNrZXIoe1xuICAgICAgICBkYXRlRm9ybWF0OiAnZGQgTU0geXknLFxuICAgICAgICBjb250cm9sVHlwZTogJ3NlbGVjdCcsXG4gICAgICAgIG9uZUxpbmU6IHRydWUsXG4gICAgICAgIHRpbWVGb3JtYXQ6ICdISDptbScsXG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmdW5jdGlvbiBpc0RvbmVQcmVzc2VkKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkKCcjdWktZGF0ZXBpY2tlci1kaXYnKS5odG1sKCkuaW5kZXhPZigndWktZGF0ZXBpY2tlci1jbG9zZSB1aS1zdGF0ZS1kZWZhdWx0IHVpLXByaW9yaXR5LXByaW1hcnkgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1ob3ZlcicpID4gLTEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNEb25lUHJlc3NlZCgpKXtcbiAgICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS51cGRhdGVEYXRlID0gbmV3IERhdGUoJCgnI2NvcnJlY3Rpb24tZGF0ZV8nICsgaW5kZXgpLmRhdGV0aW1lcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS51cGRhdGVEYXRlID0gbmV3IERhdGUoJCgnI2NvcnJlY3Rpb24tZGF0ZV8nICsgaW5kZXgpLmRhdGV0aW1lcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJ1biBzYXZlIFwiICsgaW5kZXgpO1xuICAgICAgICAgICAgc2F2ZUNvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAvLyQoJyNjb3JyZWN0aW9uLWRhdGVfJyArIGluZGV4KS5kYXRldGltZXBpY2tlcignc2V0RGF0ZScsIG5ldyBEYXRlKGRhdGVUbXApKTtcblxuXG5cbiAgICAvLy8vLy8vLy8vL2xvb2sgYXQgbWVcblxuICAgIC8vJCgnYm9keScpLm9uKCdjbGljaycsICcjZG9uZS1idXR0b24nLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gIGRhdGFbZmllbGRdW2luZGV4XS51cGRhdGVEYXRlID0gbmV3IERhdGUoJCgnI2NvcnJlY3Rpb24tZGF0ZV8nICsgaW5kZXgpLmRhdGV0aW1lcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgLy8gIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLnVwZGF0ZURhdGUgPSBuZXcgRGF0ZSgkKCcjY29ycmVjdGlvbi1kYXRlXycgKyBpbmRleCkuZGF0ZXRpbWVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICAvLyAgc2F2ZUNvcnJlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgLy99KTtcblxuXG5cbiAgICAkKCcjJyArIGlkRmllbGQgKyAnLWVkaXRfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbWFya2Rvd24gPSBkYXRhW2ZpZWxkXVtpbmRleF0uY29ycmVjdGlvbk5vdGljZTtcbiAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb3JyZWN0aW9uIG5vdGljZScsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgICB2YXIgc2F2ZUNvbnRlbnQgPSBmdW5jdGlvbiAodXBkYXRlZENvbnRlbnQpIHtcbiAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLmNvcnJlY3Rpb25Ob3RpY2UgPSB1cGRhdGVkQ29udGVudDtcbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uY29ycmVjdGlvbk5vdGljZSA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICBzYXZlQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgIH07XG4gICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSwgJ25vdEVtcHR5Jyk7XG4gICAgfSk7XG4gICAgLy8gRGVsZXRlXG4gICAgJCgnIycgKyBpZEZpZWxkICsgJy1kZWxldGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICBzd2FsICh7XG4gICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgY29ycmVjdGlvbj9cIixcbiAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcbiAgICAgIH0sIGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBkZWxldGVVbnB1Ymxpc2hlZFZlcnNpb24oY29sbGVjdGlvbklkLCBkYXRhW2ZpZWxkXVtpbmRleF0udXJpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gcG9zaXRpb247XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgZGF0YVtmaWVsZF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHNhdmVDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgdGV4dDogXCJUaGlzIGNvcnJlY3Rpb24gaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgY2Fubm90IGRlbGV0ZSBhIGNvcnJlY3Rpb24gdGhhdCBoYXMgYmVlbiBwdWJsaXNoZWQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzYXZlQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIHBhdGgsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICByZWZyZXNoQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbi8qKlxuICogTWFuYWdlcyByZWxhdGVkIGRhdGFcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gdGVtcGxhdGVEYXRhXG4gKiBAcGFyYW0gZmllbGQgLSBKU09OIGRhdGEga2V5XG4gKiBAcGFyYW0gaWRGaWVsZCAtIEhUTUwgaWQgZm9yIHRoZSB0ZW1wbGF0ZVxuICovXG5cbmZ1bmN0aW9uIGVkaXRJbnRBbmRFeHRMaW5rcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcGF0aCkge1xuICAgICAgICBpZiAoIXRoaXMudGl0bGUpIHtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlSW50ZXJuYWxMaW5rc1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCwgaW5kZXgpXG4gICAgICAgICAgICB9KSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uZGVzY3JpcHRpb24gPSB7fTtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLmRlc2NyaXB0aW9uLnRpdGxlID0gdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0udGl0bGU7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gICAgdmFyIGRhdGFUZW1wbGF0ZSA9IGNyZWF0ZVJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvblZpZXdNb2RlbChpZEZpZWxkLCBsaXN0LCBkYXRhKTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JSZWxhdGVkKGRhdGFUZW1wbGF0ZSk7XG4gICAgJCgnIycgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aChodG1sKTtcbiAgICBpbml0aWFsaXNlTGlua3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcChGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MpO1xufVxuXG5mdW5jdGlvbiByZWZyZXNoTGlua3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGxpc3QgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICAgIHZhciBkYXRhVGVtcGxhdGUgPSBjcmVhdGVSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb25WaWV3TW9kZWwoaWRGaWVsZCwgbGlzdCwgZGF0YSk7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZWRpdG9yUmVsYXRlZChkYXRhVGVtcGxhdGUpO1xuICAgICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoJChodG1sKS5maW5kKCcjc29ydGFibGUtJyArIGlkRmllbGQpKTtcbiAgICBpbml0aWFsaXNlTGlua3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZUxpbmtzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIC8vIExvYWRcbiAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAvLyBEZWxldGVcbiAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1kZWxldGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgbGluaz9cIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBcIiArIGlkRmllbGQgKyBcIiBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoTGlua3MoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vQWRkXG4gICAgLy8kKCcjYWRkLScgKyBpZEZpZWxkKS5vZmYoKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQoJyNhZGQtbGluaycpLm9mZigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9hZGQgYSBtb2RhbCB0byBzZWxlY3QgYW4gb3B0aW9uIGZvciBpbnRlcm5hbCBvciBleHRlcm5hbFxuICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgdmFyIG1vZGFsSW50T3JFeHQgPSB0ZW1wbGF0ZXMubGlua01vZGFsO1xuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5hcHBlbmQobW9kYWxJbnRPckV4dCk7XG4gICAgICAgIC8vVGhleSBjaG9vc2UgaW50ZXJuYWxcbiAgICAgICAgJCgnI2ludGVybmFsLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9GbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5yZWxhdGVkTW9kYWw7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG4gICAgICAgICAgICAkKCcubW9kYWwtYm94IGlucHV0W3R5cGU9dGV4dF0nKS5mb2N1cygpO1xuXG4gICAgICAgICAgICAvL01vZGFsIGNsaWNrIGV2ZW50c1xuICAgICAgICAgICAgJCgnLmJ0bi11cmktY2FuY2VsJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcuYnRuLXVyaS1nZXQnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhc3RlZFVybCA9ICQoJyN1cmktaW5wdXQnKS52YWwoKTtcbiAgICAgICAgICAgICAgICBpZiAocGFzdGVkVXJsID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGZpZWxkIGNhbm5vdCBiZSBlbXB0eS4gUGxlYXNlIHBhc3RlIGEgdmFsaWQgdXJsIGFkZHJlc3NcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFVcmwgPSBjaGVja1BhdGhQYXJzZWQocGFzdGVkVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFVcmwgPT09IFwiXCIpIHsgICAgLy9zcGVjaWFsIGNhc2UgZm9yIGhvbWUgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybCA9IFwiL1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe3VyaTogZGF0YVVybH0pO1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdLnB1c2goe3VyaTogZGF0YVVybH0pO1xuICAgICAgICAgICAgICAgICAgICBzYXZlRXh0ZXJuYWxMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCgnLmJ0bi11cmktYnJvd3NlJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWZyYW1lRXZlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdztcbiAgICAgICAgICAgICAgICBpZnJhbWVFdmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIEZsb3JlbmNlLkhhbmRsZXIsIHRydWUpO1xuICAgICAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZShkYXRhLnVyaSwgY29sbGVjdGlvbklkLCAnJywgbnVsbCAsIHRydWUpO1xuICAgICAgICAgICAgICAgICQoJy5tb2RhbCcpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgLy9EaXNhYmxlIHRoZSBlZGl0b3JcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICBcIjxkaXYgY2xhc3M9J2NvbCBjb2wtLTUgcGFuZWwgbW9kYWwtYmFja2dyb3VuZCc+PC9kaXY+XCJcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgLy9BZGQgYnV0dG9ucyB0byBpZnJhbWUgd2luZG93XG4gICAgICAgICAgICAgICAgdmFyIGlmcmFtZU5hdiA9IHRlbXBsYXRlcy5pZnJhbWVOYXYoKTtcbiAgICAgICAgICAgICAgICAkKGlmcmFtZU5hdikuaGlkZSgpLmFwcGVuZFRvKCcuYnJvd3NlcicpLmZhZGVJbig2MDApO1xuXG4gICAgICAgICAgICAgICAgLy9UYWtlIGlmcmFtZSB3aW5kb3cgdG8gaG9tZXBhZ2Uvcm9vdFxuICAgICAgICAgICAgICAgICQoJyNpZnJhbWUnKS5hdHRyKCdzcmMnLCAnLycpO1xuXG4gICAgICAgICAgICAgICAgJCgnLmJ0bi1icm93c2UtY2FuY2VsJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5pZnJhbWUtbmF2JykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbC1iYWNrZ3JvdW5kJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvL1JlbW92ZSBhZGRlZCBtYXJrdXAgaWYgdXNlciBuYXZpZ2F0ZXMgYXdheSBmcm9tIGVkaXRvciBzY3JlZW5cbiAgICAgICAgICAgICAgICAkKCdhOm5vdCguYnRuLWJyb3dzZS1nZXQpJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuaWZyYW1lLW5hdicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwtYmFja2dyb3VuZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCgnLmJ0bi1icm93c2UtZ2V0Jykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFVcmwgPSBnZXRQYXRoTmFtZVRyaW1MYXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXJsID09PSBcIlwiKSB7ICAgLy9zcGVjaWFsIGNhc2UgZm9yIGhvbWUgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybCA9IFwiL1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXRlc3RVcmw7XG4gICAgICAgICAgICAgICAgICAgIC8vaWYgeW91IHdhbnRlZCB0byBhZGQgbGF0ZXN0IGF1dG9tYXRpY2FsbHkgdW5jb21tZW50IHRoZXNlIGxpbmVzXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXJsLm1hdGNoKC9cXC9hcnRpY2xlc1xcLy8pIHx8IGRhdGFVcmwubWF0Y2goL1xcL2J1bGxldGluc1xcLy8pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJXb3VsZCB5b3UgbGlrZSB0byBhbHdheXMgc2hvdyB0aGUgbGF0ZXN0IHJlbGVhc2Ugb2YgdGhpcyBkb2N1bWVudD9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIlllc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiTm9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBVcmwgPSBkYXRhVXJsLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBVcmwucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBVcmwucHVzaCgnbGF0ZXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGVzdFVybCA9IHRlbXBVcmwuam9pbignLycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGVzdFVybCA9IGRhdGFVcmw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5pZnJhbWUtbmF2JykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tncm91bmQnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IGxhdGVzdFVybH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0ucHVzaCh7dXJpOiBsYXRlc3RVcmx9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlRXh0ZXJuYWxMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RVcmwgPSBkYXRhVXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmlmcmFtZS1uYXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbC1iYWNrZ3JvdW5kJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IGxhdGVzdFVybH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IGxhdGVzdFVybH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUV4dGVybmFsTGluayhjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vVGhleSBjaG9vc2UgZXh0ZXJuYWxcbiAgICAgICAgJCgnI2V4dGVybmFsLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5saW5rRXh0ZXJuYWxNb2RhbDtcbiAgICAgICAgICAgIHZhciB1cmksIHRpdGxlO1xuICAgICAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5hcHBlbmQobW9kYWwpO1xuICAgICAgICAgICAgJCgnI3VyaS1pbnB1dCcpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdXJpID0gJCgnI3VyaS1pbnB1dCcpLnZhbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKCcjdXJpLXRpdGxlJykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aXRsZSA9ICQoJyN1cmktdGl0bGUnKS52YWwoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCgnLmJ0bi11cmktZ2V0Jykub2ZmKCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnWW91IG5lZWQgdG8gZW50ZXIgYSB0aXRsZSB0byBjb250aW51ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0ucHVzaCh7dXJpOiB1cmksIHRpdGxlOiB0aXRsZX0pO1xuICAgICAgICAgICAgICAgICAgICBzYXZlRXh0ZXJuYWxMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoJy5idG4tdXJpLWNhbmNlbCcpLm9mZigpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy9UaGV5IGNhbmNlbFxuICAgICAgICAkKCcuYnRuLXVyaS1jYW5jZWwnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBNYWtlIHNlY3Rpb25zIHNvcnRhYmxlXG4gICAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgICAgICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkuc29ydGFibGUoe1xuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoJyMnICsgaWRGaWVsZCArICcgLmVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbS0tY291bnRlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZW1wdHkoKS5hcHBlbmQoaW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc29ydGFibGUoKTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUludGVybmFsTGlua3NUaXRsZShjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQsIGluZGV4KSB7XG4gICAgZ2V0UGFnZURhdGFUaXRsZShjb2xsZWN0aW9uSWQsIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLnVyaSxcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0gPSByZXNwb25zZTtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLmRlc2NyaXB0aW9uID0ge307XG4gICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbi50aXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gcmVzcG9uc2UuZWRpdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZnJlc2hMaW5rcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCBmaWVsZCArICcgYWRkcmVzczogJyArIHRlbXBsYXRlRGF0YVtmaWVsZF1baW5kZXhdLnVyaSArICcgaXMgbm90IGZvdW5kLicsIFwiZXJyb3JcIik7XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5cbmZ1bmN0aW9uIHNhdmVFeHRlcm5hbExpbmsoY29sbGVjdGlvbklkLCBwYXRoLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgcmVmcmVzaExpbmtzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoZGF0YS51cmksIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cbi8qKlxuICogTWFuYWdlcyBtYXJrZG93biBjb250ZW50IChzYXZlcyBhbiBvYmplY3QpXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleVxuICogQHBhcmFtIHRpdGxlIC0gaGVhZGVyIHRvIGFwcGVhciBpbiB0aGUgZWRpdG9yXG4gKi9cblxuZnVuY3Rpb24gZWRpdE1hcmtkb3duT25lT2JqZWN0IChjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCB0aXRsZSkge1xuICB2YXIgbGlzdCA9IGRhdGFbZmllbGRdO1xuXG4gIGlmKCFkYXRhW2ZpZWxkXSkge1xuICAgIGRhdGFbZmllbGRdID0ge31cbiAgfVxuXG4gIHZhciBkYXRhVGVtcGxhdGU7XG4gIGlmICh0aXRsZSkge1xuICAgIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBoZWFkZXI6IHRpdGxlfTtcbiAgfSBlbHNlIHtcbiAgICBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaGVhZGVyOiAnQ29udGVudCd9O1xuICB9XG5cbiAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZWRpdG9yQ29udGVudE9uZShkYXRhVGVtcGxhdGUpO1xuICAkKCcjb25lJykucmVwbGFjZVdpdGgoaHRtbCk7XG4gIC8vIExvYWRcbiAgJCgnI29uZS1lZGl0JykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1hcmtkb3duID0gJCgnI29uZS1tYXJrZG93bicpLnZhbCgpO1xuICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb250ZW50JywgbWFya2Rvd246IG1hcmtkb3dufTtcbiAgICB2YXIgc2F2ZUNvbnRlbnQgPSBmdW5jdGlvbih1cGRhdGVkQ29udGVudCkge1xuICAgICAgZGF0YVtmaWVsZF0ubWFya2Rvd24gPSB1cGRhdGVkQ29udGVudDtcbiAgICAgIHNhdmVNYXJrZG93bk9uZSAoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQpO1xuICAgIH07XG5cbiAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgZGF0YSk7XG4gIH0pO1xuXG4gIC8vIERlbGV0ZVxuICAkKCcjb25lLWRlbGV0ZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgIHN3YWwgKHtcbiAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgIHRleHQ6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZT9cIixcbiAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgIH0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICBkYXRhW2ZpZWxkXSA9IHt9O1xuICAgICAgICBzYXZlTWFya2Rvd25PbmUoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQpO1xuICAgICAgICBzd2FsKHtcbiAgICAgICAgICB0aXRsZTogXCJEZWxldGVkXCIsXG4gICAgICAgICAgdGV4dDogXCJUaGlzIFwiICsgaWRGaWVsZCArIFwiIGhhcyBiZWVuIGRlbGV0ZWRcIixcbiAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNhdmVNYXJrZG93bk9uZSAoY29sbGVjdGlvbklkLCBwYXRoLCBkYXRhLCBmaWVsZCkge1xuICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICBlZGl0TWFya2Rvd25PbmVPYmplY3QgKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQpO1xuICAgIH0sXG4gICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICB9XG4gICAgfVxuICApO1xufVxuXG4vKipcbiAqIE1hbmFnZXMgbWFya2Rvd24gY29udGVudCAoc2F2ZXMgYW4gYXJyYXkpXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleVxuICovXG5cbmZ1bmN0aW9uIGVkaXRNYXJrZG93bldpdGhOb1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcblxuICB2YXIgZGF0YVRlbXBsYXRlO1xuICBpZiAoaWRGaWVsZCA9PT0gJ25vdGUnKSB7XG4gICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGhlYWRlcjogJ05vdGVzJ307XG4gIH0gZWxzZSBpZiAoaWRGaWVsZCA9PT0gJ3ByZXJlbGVhc2UnKSB7XG4gICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGhlYWRlcjogJ1ByZS1yZWxlYXNlIGFjY2Vzcyd9O1xuICB9IGVsc2Uge1xuICAgIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkLCBoZWFkZXI6ICdDb250ZW50J307XG4gIH1cblxuICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JDb250ZW50Tm9UaXRsZShkYXRhVGVtcGxhdGUpO1xuICAkKCcjJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAvLyBMb2FkXG4gICQoJyNjb250ZW50LWVkaXQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1hcmtkb3duID0gJCgnI2NvbnRlbnQtbWFya2Rvd24nKS52YWwoKTtcbiAgICB2YXIgZWRpdGVkU2VjdGlvblZhbHVlID0ge3RpdGxlOiAnQ29udGVudCcsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICBkYXRhW2ZpZWxkXSA9IFt1cGRhdGVkQ29udGVudF07XG4gICAgICBzYXZlTWFya2Rvd25Ob1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcblxuICAgICAgLy8gd2hlbiBmaW5pc2hlZCBpbiB0aGUgbWFya2Rvd24gZWRpdG9yIGJlIHN1cmUgdG8gcmVmcmVzaCB0aGUgY2hhcnRzIC8gdGFibGVzIC8gaW1hZ2VzIGxpc3QgdG8gc2hvdyBhbnkgbmV3bHkgYWRkZWRcbiAgICAgIHJlZnJlc2hDaGFydExpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgIHJlZnJlc2hUYWJsZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgICByZWZyZXNoSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgIH07XG4gICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEpO1xuICB9KTtcblxuICAvLyBEZWxldGVcbiAgJCgnI2NvbnRlbnQtZGVsZXRlJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIHN3YWwoe1xuICAgICAgdGl0bGU6IFwiV2FybmluZ1wiLFxuICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlP1wiLFxuICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICBzYXZlTWFya2Rvd25Ob1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgc3dhbCh7XG4gICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgIHRleHQ6IFwiVGhpcyBcIiArIGlkRmllbGQgKyBcIiBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG59XG5cbmZ1bmN0aW9uIHNhdmVNYXJrZG93bk5vVGl0bGUoY29sbGVjdGlvbklkLCBwYXRoLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICBlZGl0TWFya2Rvd25XaXRoTm9UaXRsZShjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICB9LFxuICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbmZ1bmN0aW9uIGVkaXRTZXJ2aWNlTWVzc2FnZShjb2xsZWN0aW9uSWQsIGRhdGEpIHtcbiAgaWYgKCFkYXRhLnNlcnZpY2VNZXNzYWdlKSB7XG4gICAgZGF0YS5zZXJ2aWNlTWVzc2FnZSA9ICcnO1xuICB9XG4gIC8vYWRkIHRlbXBsYXRlIHRvIGVkaXRvclxuICB2YXIgdGV4dCA9IGRhdGEuc2VydmljZU1lc3NhZ2U7XG4gIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvclNlcnZpY2VNZXNzYWdlKHRleHQpO1xuICAkKCcjc3J2LW1zZycpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAvL2NoYW5nZSB0ZXh0XG4gICQoXCIjc3J2LW1zZy10eHRcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuc2VydmljZU1lc3NhZ2UgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvL2RlbGV0ZVxuICAkKCcjc3J2LW1zZy1kZWxldGUnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgc3dhbCh7XG4gICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGU/XCIsXG4gICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICBjbG9zZU9uQ29uZmlybTogdHJ1ZVxuICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgZGF0YS5zZXJ2aWNlTWVzc2FnZSA9IFwiXCI7XG4gICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCAnJywgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoJy8nLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0vKipcbiAqIE1hbmFnZXMgdG9waWNzIHRvIGFwcGVhciBpbiBsaXN0IHBhZ2VzXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICogQHBhcmFtIHRlbXBsYXRlRGF0YVxuICogQHBhcmFtIGZpZWxkIC0gSlNPTiBkYXRhIGtleVxuICogQHBhcmFtIGlkRmllbGQgLSBIVE1MIGlkIGZvciB0aGUgdGVtcGxhdGVcbiAqL1xuXG5mdW5jdGlvbiBlZGl0VG9waWNzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIHZhciBsaXN0ID0gdGVtcGxhdGVEYXRhW2ZpZWxkXTtcbiAgICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvclRvcGljcyhkYXRhVGVtcGxhdGUpO1xuICAgICQoJyMnICsgaWRGaWVsZCkucmVwbGFjZVdpdGgoaHRtbCk7XG4gICAgaW5pdGlhbGlzZVRvcGljcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIHJlc29sdmVUb3BpY1RpdGxlKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zKTtcbn1cblxuZnVuY3Rpb24gcmVmcmVzaFRvcGljcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gICAgdmFyIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JUb3BpY3MoZGF0YVRlbXBsYXRlKTtcbiAgICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKCQoaHRtbCkuZmluZCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKSk7XG4gICAgaW5pdGlhbGlzZVRvcGljcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlVG9waWNzKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIC8vIExvYWRcbiAgICBpZiAoIWRhdGFbZmllbGRdIHx8IGRhdGFbZmllbGRdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBlZGl0VG9waWNzWydsYXN0SW5kZXgnICsgZmllbGRdID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgZWRpdFRvcGljc1snbGFzdEluZGV4JyArIGZpZWxkXSA9IGluZGV4ICsgMTtcblxuICAgICAgICAgICAgLy8gRGVsZXRlXG4gICAgICAgICAgICAkKCcjJyArIGlkRmllbGQgKyAnLWRlbGV0ZV8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiV2FybmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBsaW5rP1wiLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBcIiArIGlkRmllbGQgKyBcIiBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRvcGljcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvL0FkZFxuICAgICQoJyNhZGQtJyArIGlkRmllbGQpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoYXNMYXRlc3Q7IC8vTGF0ZXN0IG1hcmt1cCBkb2Vzbid0IG5lZWQgdG8gc2hvdyBpbiBoYW5kbGViYXJzIHRlbXBsYXRlXG4gICAgICAgIHZhciBwb3NpdGlvbiA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gcG9zaXRpb247XG4gICAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5yZWxhdGVkTW9kYWwoaGFzTGF0ZXN0KTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuYXBwZW5kKG1vZGFsKTtcbiAgICAgICAgJCgnLm1vZGFsLWJveCBpbnB1dFt0eXBlPXRleHRdJykuZm9jdXMoKTtcblxuICAgICAgICAvL01vZGFsIGNsaWNrIGV2ZW50c1xuICAgICAgICAkKCcuYnRuLXVyaS1jYW5jZWwnKS5vZmYoKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idG4tdXJpLWdldCcpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGFzdGVkVXJsID0gJCgnI3VyaS1pbnB1dCcpLnZhbCgpO1xuICAgICAgICAgICAgdmFyIGRhdGFVcmwgPSBjaGVja1BhdGhQYXJzZWQocGFzdGVkVXJsKTtcbiAgICAgICAgICAgIGdldFRvcGljKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCwgZGF0YVVybCk7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ0bi11cmktYnJvd3NlJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWVFdmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWUnKS5jb250ZW50V2luZG93O1xuICAgICAgICAgICAgaWZyYW1lRXZlbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBGbG9yZW5jZS5IYW5kbGVyLCB0cnVlKTtcbiAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZShkYXRhLnVyaSwgY29sbGVjdGlvbklkLCAnJywgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgLy9EaXNhYmxlIHRoZSBlZGl0b3JcbiAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPSdjb2wgY29sLS01IHBhbmVsIG1vZGFsLWJhY2tncm91bmQnPjwvZGl2PlwiXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvL0FkZCBidXR0b25zIHRvIGlmcmFtZSB3aW5kb3dcbiAgICAgICAgICAgIHZhciBpZnJhbWVOYXYgPSB0ZW1wbGF0ZXMuaWZyYW1lTmF2KGhhc0xhdGVzdCk7XG4gICAgICAgICAgICAkKGlmcmFtZU5hdikuaGlkZSgpLmFwcGVuZFRvKCcuYnJvd3NlcicpLmZhZGVJbig1MDApO1xuXG4gICAgICAgICAgICAkKCcuYnRuLWJyb3dzZS1jYW5jZWwnKS5vZmYoKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZShkYXRhLnVyaSwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgICQoJy5pZnJhbWUtbmF2JykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tncm91bmQnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL1JlbW92ZSBhZGRlZCBtYXJrdXAgaWYgdXNlciBuYXZpZ2F0ZXMgYXdheSBmcm9tIGVkaXRvciBzY3JlZW5cbiAgICAgICAgICAgICQoJ2E6bm90KC5idG4tYnJvd3NlLWdldCknKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnLmlmcmFtZS1uYXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwtYmFja2dyb3VuZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5idG4tYnJvd3NlLWdldCcpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFVcmwgPSBnZXRQYXRoTmFtZVRyaW1MYXN0KCk7XG4gICAgICAgICAgICAgICAgJCgnLmlmcmFtZS1uYXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwtYmFja2dyb3VuZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGdldFRvcGljKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCwgZGF0YVVybCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcbiAgICAgICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5zb3J0YWJsZSh7XG4gICAgICAgICAgICBzdG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJyAuZWRpdC1zZWN0aW9uX19zb3J0YWJsZS1pdGVtLS1jb3VudGVyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lbXB0eSgpLmFwcGVuZChpbmRleCArIDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzb3J0YWJsZSgpO1xuXG59XG5cbmZ1bmN0aW9uIGdldFRvcGljKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCwgZGF0YVVybCkge1xuICAgIHZhciBkYXRhVXJsRGF0YSA9IGRhdGFVcmwgKyBcIi9kYXRhXCI7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IGRhdGFVcmxEYXRhLFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICBjcm9zc0RvbWFpbjogdHJ1ZSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC50eXBlID09PSAncHJvZHVjdF9wYWdlJykge1xuICAgICAgICAgICAgICAgIGlmICghZGF0YVtmaWVsZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgZG9jdW1lbnRcIik7XG4gICAgICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRhW2ZpZWxkXS5wdXNoKHt1cmk6IHJlc3VsdC51cml9KTtcbiAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0ucHVzaCh7dXJpOiByZXN1bHQudXJpfSk7XG4gICAgICAgICAgICBzYXZlVG9waWNzKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gcGFnZSBkYXRhIHJldHVybmVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVRvcGljVGl0bGUoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGFqYXhSZXF1ZXN0ID0gW107XG4gICAgJCh0ZW1wbGF0ZURhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcGF0aCkge1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbiA9IHt9O1xuICAgICAgICB2YXIgZWFjaFVyaSA9IHBhdGgudXJpO1xuICAgICAgICB2YXIgZGZkID0gJC5EZWZlcnJlZCgpO1xuICAgICAgICBnZXRQYWdlRGF0YVRpdGxlKGNvbGxlY3Rpb25JZCwgZWFjaFVyaSxcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbi50aXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xuICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIGZpZWxkICsgJyBhZGRyZXNzOiAnICsgZWFjaFVyaSArICcgaXMgbm90IGZvdW5kLicsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgYWpheFJlcXVlc3QucHVzaChkZmQpO1xuICAgIH0pO1xuXG4gICAgJC53aGVuLmFwcGx5KCQsIGFqYXhSZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVmcmVzaFRvcGljcyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBzYXZlVG9waWNzKGNvbGxlY3Rpb25JZCwgcGF0aCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjb21wbGV0ZWQgXCIgKyByZXNwb25zZSk7XG4gICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzb2x2ZVRvcGljVGl0bGUoY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KHBhdGgpO1xuICAgICAgICAgICAgdmFyIGlmcmFtZUV2ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3c7XG4gICAgICAgICAgICBpZnJhbWVFdmVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIEZsb3JlbmNlLkhhbmRsZXIsIHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuZnVuY3Rpb24gaXNEZXZPclNhbmRwaXQgKCkge1xuICAgIHZhciBob3N0bmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcbiAgICB2YXIgZW52ID0ge307XG5cbiAgICBpZihob3N0bmFtZS5pbmRleE9mKCdkZXZlbG9wJykgPiAtMSkge1xuICAgICAgICBlbnYubmFtZSA9ICdkZXZlbG9wJ1xuICAgIH1cblxuICAgIGlmKGhvc3RuYW1lLmluZGV4T2YoJ3NhbmRwaXQnKSA+IC0xKSB7XG4gICAgICAgIGVudi5uYW1lID0gJ3NhbmRwaXQnXG4gICAgfVxuXG4gICAgLy8gaWYoKGhvc3RuYW1lLmluZGV4T2YoJzEyNycpID4gLTEpIHx8IChob3N0bmFtZS5pbmRleE9mKCdsb2NhbGhvc3QnKSkgPiAtMSkge1xuICAgIC8vICAgICBlbnYubmFtZSA9ICdsb2NhbGhvc3QnXG4gICAgLy8gfVxuXG4gICAgcmV0dXJuIGVudjtcbn1cbi8qKlxuICogTWFuYWdlcyBsaW5rc1xuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXlcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlXG4gKi9cblxuZnVuY3Rpb24gcmVuZGVyRXh0ZXJuYWxMaW5rQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcbiAgICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvckxpbmtzKGRhdGFUZW1wbGF0ZSk7XG4gICAgJCgnIycgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aChodG1sKTtcblxuICAgIC8vIExvYWRcbiAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuXG4gICAgICAgICQoJyMnICsgaWRGaWVsZCArICctZWRpdF8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1cmkgPSBkYXRhW2ZpZWxkXVtpbmRleF0udXJpO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gZGF0YVtmaWVsZF1baW5kZXhdLnRpdGxlO1xuICAgICAgICAgICAgYWRkRWRpdExpbmtzTW9kYWwoJ2VkaXQnLCB1cmksIHRpdGxlLCBpbmRleCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERlbGV0ZVxuICAgICAgICAkKCcjJyArIGlkRmllbGQgKyAnLWRlbGV0ZV8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGU/XCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gcG9zaXRpb24gKyAzMDA7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBsaW5rIGhhcyBiZWVuIGRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy9BZGRcbiAgICAkKCcjYWRkLScgKyBpZEZpZWxkKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBwb3NpdGlvbiA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uICsgMzAwO1xuICAgICAgICBhZGRFZGl0TGlua3NNb2RhbCgpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgICAgICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkuc29ydGFibGUoe1xuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoJyMnICsgaWRGaWVsZCArICcgLmVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbS0tY291bnRlcicpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZW1wdHkoKS5hcHBlbmQoaW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc29ydGFibGUoKTtcblxuICAgIGZ1bmN0aW9uIHNhdmVMaW5rKGNvbGxlY3Rpb25JZCwgcGF0aCwgZGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJlbmRlckV4dGVybmFsTGlua0FjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkRWRpdExpbmtzTW9kYWwobW9kZSwgdXJpLCB0aXRsZSwgaW5kZXgpIHtcblxuICAgICAgICB2YXIgdXJpID0gdXJpO1xuICAgICAgICB2YXIgdGl0bGUgPSB0aXRsZTtcblxuICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxpbmtEYXRhID0ge3RpdGxlOiB0aXRsZSwgdXJpOiB1cml9O1xuXG4gICAgICAgIHZhciBtb2RhbCA9IHRlbXBsYXRlcy5saW5rRXh0ZXJuYWxNb2RhbChsaW5rRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG5cbiAgICAgICAgJCgnI3VyaS1pbnB1dCcpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1cmkgPSAkKCcjdXJpLWlucHV0JykudmFsKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjdXJpLXRpdGxlJykuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRpdGxlID0gJCgnI3VyaS10aXRsZScpLnZhbCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnRuLXVyaS1nZXQnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIXRpdGxlKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnWW91IG5lZWQgdG8gZW50ZXIgYSB0aXRsZSB0byBjb250aW51ZScpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1cmkubWF0Y2goL1xccy9nKSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1lvdXIgbGluayBjYW5ub3QgY29udGFpbiBzcGFjZXMnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG1vZGUgPT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS51cmkgPSB1cmk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe3VyaTogdXJpLCB0aXRsZTogdGl0bGV9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2F2ZUxpbmsoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgICAgICAgICAgICAgICQoJy5tb2RhbCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnRuLXVyaS1jYW5jZWwnKS5vZmYoKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGZpbGVEZWxldGUgKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGluZGV4KSB7XG4gIHN3YWwgKHtcbiAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZmlsZT9cIixcbiAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gIH0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgIHN3YWwoe1xuICAgICAgICB0aXRsZTogXCJEZWxldGVkXCIsXG4gICAgICAgIHRleHQ6IFwiVGhpcyBhbGVydCBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgIHR5cGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgfSk7XG4gICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gcG9zaXRpb247XG4gICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBkYXRhLnVyaSArICcvJyArIGRhdGFbZmllbGRdW2luZGV4XS5maWxlLFxuICAgICAgICB0eXBlOiBcIkRFTEVURVwiLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB1cGxvYWRGaWxlKGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQsIGlkRmllbGQsIGxhc3RJbmRleCwgZG93bmxvYWRFeHRlbnNpb25zLCBvblNhdmUpIHtcbiAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uICsgMjAwO1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLnVwbG9hZEZpbGVGb3JtKGxhc3RJbmRleCk7XG4gICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5hcHBlbmQoaHRtbCk7XG5cbiAgICAkKCcjZmlsZS1jYW5jZWwnKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKCcjJyArIGxhc3RJbmRleCkucmVtb3ZlKCk7XG4gICAgICAgIG9uU2F2ZShjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICB9KTtcblxuICAgICQoJyNVcGxvYWRGb3JtJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuICAgICAgICB2YXIgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuICAgICAgICBmdW5jdGlvbiBzaG93VXBsb2FkZWRJdGVtKHNvdXJjZSkge1xuICAgICAgICAgICAgJCgnI2xpc3QnKS5hcHBlbmQoc291cmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmaWxlID0gdGhpc1swXS5maWxlc1swXTtcbiAgICAgICAgaWYgKCFmaWxlKSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KFwiUGxlYXNlIHNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNwb25zZVwiKS5pbm5lckhUTUwgPSBcIlVwbG9hZGluZyAuIC4gLlwiO1xuXG4gICAgICAgIHZhciBmaWxlTmFtZU5vU3BhY2UgPSBmaWxlLm5hbWUucmVwbGFjZSgvW15hLXpBLVowLTlcXC5dL2csIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHVyaVVwbG9hZCA9IGRhdGEudXJpICsgXCIvXCIgKyBmaWxlTmFtZU5vU3BhY2U7XG4gICAgICAgIHZhciBzYWZlVXJpVXBsb2FkID0gY2hlY2tQYXRoU2xhc2hlcyh1cmlVcGxvYWQpO1xuXG4gICAgICAgIGlmIChkYXRhW2ZpZWxkXSAmJiBkYXRhW2ZpZWxkXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpLCBmaWxlc1VwbG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVzVXBsb2FkZWQuZmlsZSA9PT0gZmlsZU5hbWVOb1NwYWNlIHx8IGZpbGVzVXBsb2FkZWQuZmlsZSA9PT0gc2FmZVVyaVVwbG9hZCkge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KCdUaGlzIGZpbGUgYWxyZWFkeSBleGlzdHMnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBsYXN0SW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBvblNhdmUoY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1kYXRhID0gZmFsc2U7ICAvLyBpZiBub3QgcHJlc2VudCB0aGUgZXhpc3RpbmcgZmlsZSB3YXMgYmVpbmcgb3ZlcndyaXR0ZW5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghIWZpbGUubmFtZS5tYXRjaChkb3dubG9hZEV4dGVuc2lvbnMpKSB7XG4gICAgICAgICAgICBzaG93VXBsb2FkZWRJdGVtKGZpbGVOYW1lTm9TcGFjZSk7XG4gICAgICAgICAgICBpZiAoZm9ybWRhdGEpIHtcbiAgICAgICAgICAgICAgICBmb3JtZGF0YS5hcHBlbmQoXCJuYW1lXCIsIGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgZmlsZSB0eXBlIGlzIG5vdCBzdXBwb3J0ZWRcIik7XG4gICAgICAgICAgICAkKCcjJyArIGxhc3RJbmRleCkucmVtb3ZlKCk7XG4gICAgICAgICAgICBvblNhdmUoY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZm9ybWRhdGEpIHtcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBzYWZlVXJpVXBsb2FkLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBmb3JtZGF0YSxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzcG9uc2VcIikuaW5uZXJIVE1MID0gXCJGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseVwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnB1c2goe3RpdGxlOiAnJywgZmlsZTogZmlsZU5hbWVOb1NwYWNlfSk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8qKlxuICogR2l2ZXMgdGhlIGxhc3QgcG9zaXRpb24gd2hlbiBvbiBhIHBhZ2VcbiAqL1xuXG5mdW5jdGlvbiBnZXRMYXN0UG9zaXRpb24gKCkge1xuICB2YXIgcG9zaXRpb24gPSBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3M7XG4gIGlmIChwb3NpdGlvbiA+IDApIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AocG9zaXRpb24gKyAxMDApO1xuICAgIH0sIDIwMCk7XG4gIH1cbn1cblxuLyoqXG4gKiAgR2V0IHRoZSBuZXR3b3JrIHNwZWVkIGZyb20gemViZWRlZS9waW5nIGVuZHBvaW50IGFuZCBvdXRwdXQgdGhlIG5ldHdvcmsgaGVhbHRoXG4gKiovXG5cbmZ1bmN0aW9uIG5ldHdvcmtTdGF0dXMocGluZykge1xuICAgIHZhciAkZ29vZCA9ICQoJy5pY29uLXN0YXR1cy0tZ29vZCcpLFxuICAgICAgICAkb2sgPSAkKCcuaWNvbi1zdGF0dXMtLW9rJyksXG4gICAgICAgICRwb29yID0gJCgnLmljb24tc3RhdHVzLS1wb29yJyksXG4gICAgICAgICR2ZXJ5UG9vciA9ICQoJy5pY29uLXN0YXR1cy0tdmVyeS1wb29yJyk7XG5cbiAgICBpZiAocGluZyA+IDAgJiYgcGluZyA8IDEwMCkge1xuICAgICAgICAkKCcuaWNvbi1zdGF0dXMgZGl2JykuY3NzKHtcIm9wYWNpdHlcIjogXCIxLjBcIn0pO1xuICAgIH0gZWxzZSBpZiAocGluZyA+PSAxMDAgJiYgcGluZyA8IDIwMCkge1xuICAgICAgICAkZ29vZC5jc3Moe1wib3BhY2l0eVwiOiBcIjAuMlwifSk7XG4gICAgICAgICRvay5jc3Moe1wib3BhY2l0eVwiOiBcIjEuMFwifSk7XG4gICAgICAgICRwb29yLmNzcyh7XCJvcGFjaXR5XCI6IFwiMS4wXCJ9KTtcbiAgICAgICAgJHZlcnlQb29yLmNzcyh7XCJvcGFjaXR5XCI6IFwiMS4wXCJ9KTtcbiAgICB9IGVsc2UgaWYgKHBpbmcgPj0gMjAwICYmIHBpbmcgPCAzMDApIHtcbiAgICAgICAgJGdvb2QuY3NzKHtcIm9wYWNpdHlcIjogXCIwLjJcIn0pO1xuICAgICAgICAkb2suY3NzKHtcIm9wYWNpdHlcIjogXCIwLjJcIn0pO1xuICAgICAgICAkcG9vci5jc3Moe1wib3BhY2l0eVwiOiBcIjEuMFwifSk7XG4gICAgICAgICR2ZXJ5UG9vci5jc3Moe1wib3BhY2l0eVwiOiBcIjEuMFwifSk7XG4gICAgfSBlbHNlIGlmIChwaW5nID49IDMwMCkge1xuICAgICAgICAkZ29vZC5jc3Moe1wib3BhY2l0eVwiOiBcIjAuMlwifSk7XG4gICAgICAgICRvay5jc3Moe1wib3BhY2l0eVwiOiBcIjAuMlwifSk7XG4gICAgICAgICRwb29yLmNzcyh7XCJvcGFjaXR5XCI6IFwiMC4yXCJ9KTtcbiAgICAgICAgJHZlcnlQb29yLmNzcyh7XCJvcGFjaXR5XCI6IFwiMS4wXCJ9KTtcbiAgICB9XG59ZnVuY3Rpb24gZ2V0UGFyZW50UGFnZSAodXJsKSB7XG4gIHZhciBjaGVja2VkVXJsID0gY2hlY2tQYXRoU2xhc2hlcyh1cmwpO1xuICB2YXIgY29udGVudFVybFRtcCA9IGNoZWNrZWRVcmwuc3BsaXQoJy8nKTtcbiAgY29udGVudFVybFRtcC5zcGxpY2UoLTEsIDEpO1xuICB2YXIgY29udGVudFVybCA9IGNvbnRlbnRVcmxUbXAuam9pbignLycpO1xuICByZXR1cm4gY29udGVudFVybDtcbn1cbmZ1bmN0aW9uIGdldFBhdGhOYW1lVHJpbUxhc3QoKSB7XG4gIHZhciBwYXJzZWRVcmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcblxuICBpZiAocGFyc2VkVXJsLmNoYXJBdChwYXJzZWRVcmwubGVuZ3RoLTEpID09PSAnLycpIHtcbiAgICBwYXJzZWRVcmwgPSBwYXJzZWRVcmwuc2xpY2UoMCwgLTEpO1xuICB9XG4gIHJldHVybiBwYXJzZWRVcmw7XG59XG5cbmZ1bmN0aW9uIGdldFByZXZpZXdVcmwoKSB7XG4gIHZhciBwYXJzZWRVcmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcbiAgdmFyIHNhZmVVcmwgPSBjaGVja1BhdGhTbGFzaGVzKHBhcnNlZFVybCk7XG4gIHJldHVybiBzYWZlVXJsO1xufVxuXG4vKipcbiAqIEdlbmVyaWMgZXJyb3IgaGFuZGxlciBtZXRob2QgZm9yIGFqYXggcmVzcG9uc2VzLlxuICogQXBwbHkgeW91ciBzcGVjaWZpYyByZXF1aXJlbWVudHMgZm9yIGFuIGVycm9yIHJlc3BvbnNlIGFuZCB0aGVuIGNhbGwgdGhpcyBtZXRob2QgdG8gdGFrZSBjYXJlIG9mIHRoZSByZXN0LlxuICogQHBhcmFtIHJlc3BvbnNlXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKSB7XG5cbiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKVxuICAgICAgICByZXR1cm47XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgLy9zd2VldEFsZXJ0KCdZb3UgYXJlIG5vdCBsb2dnZWQgaW4nLCAnUGxlYXNlIHJlZnJlc2ggRmxvcmVuY2UgYW5kIGxvZyBiYWNrIGluLicpO1xuICAgICAgICBsb2dvdXQoKTtcbiAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTA0KSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoJ1RoaXMgdGFzayBpcyB0YWtpbmcgbG9uZ2VyIHRoYW4gZXhwZWN0ZWQnLCBcIkl0IHdpbGwgY29udGludWUgdG8gcnVuIGluIHRoZSBiYWNrZ3JvdW5kLlwiLCBcImluZm9cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSAnQW4gZXJyb3IgaGFzIG9jY3VycmVkLCBwbGVhc2UgY29udGFjdCBhbiBhZG1pbmlzdHJhdG9yLic7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLnJlc3BvbnNlSlNPTikge1xuICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCBtZXNzYWdlLCBcImVycm9yXCIpO1xuICAgIH1cbn1cblxuLyogVW5pcXVlIGVycm9yIGhhbmRsaW5nIGZvciB0aGUgbG9naW4gc2NyZWVuICovXG5mdW5jdGlvbiBoYW5kbGVMb2dpbkFwaUVycm9yKHJlc3BvbnNlKSB7XG5cbiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKVxuICAgICAgICByZXR1cm47XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgc3dlZXRBbGVydChcIlBsZWFzZSBlbnRlciBhIHZhbGlkIHVzZXJuYW1lIGFuZCBwYXNzd29yZFwiKTtcbiAgICAgICAgbG9nb3V0KCk7XG4gICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICBzd2VldEFsZXJ0KCdJbmNvcnJlY3QgbG9naW4gZGV0YWlscycsICdUaGVzZSBsb2dpbiBjcmVkZW50aWFscyB3ZXJlIG5vdCByZWNvZ25pc2VkLiBQbGVhc2UgdHJ5IGFnYWluLicsICdlcnJvcicpO1xuICAgICAgICBsb2dvdXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbWVzc2FnZSA9ICdBbiBlcnJvciBoYXMgb2NjdXJyZWQsIHBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3IuJztcblxuICAgICAgICBpZiAocmVzcG9uc2UucmVzcG9uc2VKU09OKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gcmVzcG9uc2UucmVzcG9uc2VKU09OLm1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIG1lc3NhZ2UsIFwiZXJyb3JcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gaW5pdGlhbGlzZUxhc3ROb3RlTWFya2Rvd24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgZmllbGQyKSB7XG4gIC8vIExvYWRcbiAgdmFyIGxhc3RJbmRleCA9IGRhdGFbZmllbGRdLmxlbmd0aCAtIDE7XG4gIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSAnJztcbiAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgZGF0YVtmaWVsZF1bbGFzdEluZGV4XVtmaWVsZDJdID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgIGxvYWRQYWdlRGF0YUludG9FZGl0b3IoZGF0YS51cmksIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgIH0sXG4gICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfTtcbiAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEsICdub3RFbXB0eScpO1xufVxuLyoqXG4gKiBWYWxpZGF0ZSBhbiBpbnB1dHMgdmFsdWUgYmVmb3JlIGl0J3Mgc3VibWl0dGVkIHRvIHRoZSBzZXJ2ZXJcbiAqL1xuXG5mdW5jdGlvbiB2YWxpZGF0ZVBhZ2VOYW1lKGN1c3RvbVNlbGVjdG9yKSB7XG4gICAgdmFyICRpbnB1dFNlbGVjdG9yID0gJCgnI3BhZ2VuYW1lJyk7XG4gICAgdmFyIGlzQ3VzdG9tU2VsZWN0b3I7XG4gICAgdmFyIGJvb2wgPSB0cnVlO1xuXG4gICAgLy8gQWxsb3cgb3RoZXIgaW5wdXRzIHRvIHVzZSBzYW1lIHZhbGlkYXRpb24gKGVnIGVkaXRpb24pXG4gICAgaWYgKGN1c3RvbVNlbGVjdG9yKSB7XG4gICAgICAgICRpbnB1dFNlbGVjdG9yID0gJChjdXN0b21TZWxlY3Rvcik7XG4gICAgICAgIGlzQ3VzdG9tU2VsZWN0b3IgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIERvIHZhbGlkYXRpb25cbiAgICBpZiAoJGlucHV0U2VsZWN0b3IudmFsKCkudG9Mb3dlckNhc2UoKSA9PT0gJ2N1cnJlbnQnIHx8ICRpbnB1dFNlbGVjdG9yLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICdsYXRlc3QnIHx8ICRpbnB1dFNlbGVjdG9yLnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICdkYXRhJykgeyAvLyBDaGVjayBmb3IgcmVzZXJ2ZWQgd29yZHMgKGllIGVuZHBvaW50cyBpbiB6ZWJlZGVlL2JhYmJhZ2UpXG4gICAgICAgIHN3ZWV0QWxlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IFwiSW52YWxpZCBwYWdlIG5hbWVcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhlIHdvcmRzICdjdXJyZW50JywgJ2xhdGVzdCcgYW5kICdkYXRhJyBhcmUgcmVzZXJ2ZWQgcGF0aHMgc28gY2FuJ3QgYmUgdXNlZCBhcyBhIHBhZ2UgbmFtZVwiLFxuICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCJcbiAgICAgICAgfSk7XG4gICAgICAgICRpbnB1dFNlbGVjdG9yLnZhbCgnJyk7XG4gICAgICAgIGJvb2wgPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKCEkaW5wdXRTZWxlY3Rvci52YWwoKSkgeyAvLyBDaGVjayBpbnB1dHMgY29udGFpbnMgc29tZXRoaW5nXG4gICAgICAgIHN3ZWV0QWxlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IFwiUGFnZSBuYW1lIGNhbid0IGJlIGxlZnQgZW1wdHlcIixcbiAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgIH0pO1xuICAgICAgICBib29sID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmICgkaW5wdXRTZWxlY3Rvci52YWwoKS5sZW5ndGggPCA1ICYmICFpc0N1c3RvbVNlbGVjdG9yKSB7IC8vIENoZWNrIHBhZ2UgbmFtZSBsZW5ndGggaXMgbG9uZ2VyIHRoYW4gNCBjaGFyYWN0ZXJzXG4gICAgICAgIHN3ZWV0QWxlcnQoe1xuICAgICAgICAgICAgdGl0bGU6IFwiSW52YWxpZCBwYWdlIG5hbWVcIixcbiAgICAgICAgICAgIHRleHQ6IFwiQSBwYWdlIG5hbWUgbXVzdCBoYXZlIG1vcmUgdGhhbiA0IGNoYXJhY3RlcnNcIixcbiAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgIH0pO1xuICAgICAgICBib29sID0gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBib29sXG59XG5mdW5jdGlvbiBsb2FkQnJvd3NlU2NyZWVuKGNvbGxlY3Rpb25JZCwgY2xpY2ssIGNvbGxlY3Rpb25EYXRhKSB7XG5cbiAgICAvLyBHZXQgY29sbGVjdGlvbiBkYXRhIGlmIGl0J3MgdW5kZWZpbmVkIGFuZCByZS1ydW4gdGhlIGZ1bmN0aW9uIG9uY2UgcmVxdWVzdCBoYXMgcmV0dXJuZWRcbiAgICBpZiAoIWNvbGxlY3Rpb25EYXRhKSB7XG4gICAgICAgIGdldENvbGxlY3Rpb24oY29sbGVjdGlvbklkLCBzdWNjZXNzID0gZnVuY3Rpb24oZ2V0Q29sbGVjdGlvblJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgbG9hZEJyb3dzZVNjcmVlbihjb2xsZWN0aW9uSWQsIGNsaWNrLCBnZXRDb2xsZWN0aW9uUmVzcG9uc2UpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgZ2V0dGluZyBjb2xsZWN0aW9uIGRhdGEgZm9yOiAnLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvY29sbGVjdGlvbkJyb3dzZVRyZWUvXCIgKyBjb2xsZWN0aW9uSWQsIC8vIHVybDogXCIvbmF2aWdhdGlvblwiLFxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGNoZWNrQW5kQWRkRGVsZXRlRmxhZyhyZXNwb25zZSwgY29sbGVjdGlvbkRhdGEpO1xuXG4gICAgICAgICAgICAvLyB2YXIgY29sbGVjdGlvbk93bmVyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJUeXBlJyk7XG4gICAgICAgICAgICByZXNwb25zZVsnY29sbGVjdGlvbk93bmVyJ10gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlclR5cGUnKTtcblxuICAgICAgICAgICAgLy8gdmFyIGJyb3dzZXJDb250ZW50ID0gJCgnI2lmcmFtZScpWzBdLmNvbnRlbnRXaW5kb3c7XG4gICAgICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrQnJvd3NlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHZhciBicm93c2VUcmVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3dzZS10cmVlJyk7XG4gICAgICAgICAgICBicm93c2VUcmVlLmlubmVySFRNTCA9IGh0bWw7XG5cbiAgICAgICAgICAgICQoJy53b3Jrc3BhY2UtYnJvd3NlJykuY3NzKFwib3ZlcmZsb3dcIiwgXCJzY3JvbGxcIik7XG5cbiAgICAgICAgICAgIC8vIFNlbmQgdmlzdWFsaXNhdGlvbnMgYmFjayB0byB2aXN1YWxpc2F0aW9ucyBmb2xkZXIgYnkgZGVmYXVsdCBvbiBicm93c2UgdHJlZSBsb2FkXG4gICAgICAgICAgICAvLyBpZiAoY29sbGVjdGlvbk93bmVyID09IFwiREFUQV9WSVNVQUxJU0FUSU9OXCIpIHtcbiAgICAgICAgICAgIC8vICAgICB2YXIgdmlzRGlyZWN0b3J5ID0gXCIvdmlzdWFsaXNhdGlvbnNcIjtcbiAgICAgICAgICAgIC8vICAgICB0cmVlTm9kZVNlbGVjdCh2aXNEaXJlY3RvcnkpO1xuICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAvLyBCaW5kIGNsaWNrIGV2ZW50IGZvciBicm93c2UgdHJlZSBpdGVtXG4gICAgICAgICAgICBiaW5kQnJvd3NlVHJlZUNsaWNrKCk7XG5cbiAgICAgICAgICAgIGlmIChjbGljaykge1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBnZXRQcmV2aWV3VXJsKCk7XG4gICAgICAgICAgICAgICAgaWYgKHVybCA9PT0gXCIvYmxhbmtcIiB8fCByZXNwb25zZVsnY29sbGVjdGlvbk93bmVyJ10gPT0gJ0RBVEFfVklTVUFMSVNBVElPTicpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJlZU5vZGVTZWxlY3QoJy8nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0cmVlTm9kZVNlbGVjdCh1cmwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdHJlZU5vZGVTZWxlY3QoJy8nKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTd2l0Y2ggdG8gYnJvd3NlIHRhYiAoaWYgbm90IGFscmVhZHkpXG4gICAgICAgICAgICB2YXIgJGJyb3dzZVRhYiA9ICQoJyNicm93c2UnKTtcbiAgICAgICAgICAgIGlmICghJGJyb3dzZVRhYi5oYXNDbGFzcygnc2VsZWN0ZWQnKSkge1xuICAgICAgICAgICAgICAgICQoJy5qcy13b3Jrc3BhY2UtbmF2IC5qcy13b3Jrc3BhY2UtbmF2X19pdGVtJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgJGJyb3dzZVRhYi5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb3BlblZpc0RpcmVjdG9yeU9uTG9hZCgpO1xuXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG59XG5cbi8vIEJpbmQgdGhlIGFjdGlvbnMgZm9yIGEgY2xpY2sgb24gYSBicm93c2UgdHJlZSBpdGVtXG5mdW5jdGlvbiBiaW5kQnJvd3NlVHJlZUNsaWNrKCkge1xuICAgICQoJy5qcy1icm93c2VfX2l0ZW0tdGl0bGUnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICAkdGhpc0l0ZW0gPSAkdGhpcy5jbG9zZXN0KCcuanMtYnJvd3NlX19pdGVtJyksXG4gICAgICAgICAgICB1cmkgPSAkdGhpc0l0ZW0uYXR0cignZGF0YS11cmwnKSxcbiAgICAgICAgICAgIGJhc2VVUkwgPSBGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCxcbiAgICAgICAgICAgIGlzRGF0YVZpcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVHlwZScpID09ICdEQVRBX1ZJU1VBTElTQVRJT04nO1xuXG4gICAgICAgIGlmICh1cmkpIHtcbiAgICAgICAgICAgIHZhciBuZXdVUkwgPSBiYXNlVVJMICsgdXJpO1xuXG4gICAgICAgICAgICB0cmVlTm9kZVNlbGVjdChuZXdVUkwpO1xuXG4gICAgICAgICAgICAvLyBEYXRhIHZpcyBicm93c2luZyBkb2Vzbid0IHVwZGF0ZSBpZnJhbWVcbiAgICAgICAgICAgIGlmIChpc0RhdGFWaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIGlmcmFtZSBsb2NhdGlvbiB3aGljaCB3aWxsIHNlbmQgY2hhbmdlIGV2ZW50IGZvciBpZnJhbWUgdG8gdXBkYXRlIHRvb1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZiA9IG5ld1VSTDtcbiAgICAgICAgICAgICQoJy5icm93c2VyLWxvY2F0aW9uJykudmFsKG5ld1VSTCk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgLy8gU2V0IGFsbCBkaXJlY3RvcmllcyBhYm92ZSBpdCBpbiB0aGUgdHJlZSB0byBiZSBhY3RpdmUgd2hlbiBhIGRpcmVjdG9yeSBjbGlja2VkXG4gICAgICAgICAgICBzZWxlY3RQYXJlbnREaXJlY3RvcmllcygkdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPcGVuIGFjdGl2ZSBicmFuY2hlcyBpbiBicm93c2UgdHJlZVxuICAgICAgICBvcGVuQnJvd3NlQnJhbmNoKCR0aGlzKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gb3BlbkJyb3dzZUJyYW5jaCgkdGhpcykge1xuICAgICQoJy50cmVlLW5hdi1ob2xkZXIgdWwnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgJHRoaXMucGFyZW50cygndWwnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgJHRoaXMuY2xvc2VzdCgnbGknKS5jaGlsZHJlbigndWwnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG59XG5cbmZ1bmN0aW9uIG9wZW5WaXNEaXJlY3RvcnlPbkxvYWQoKSB7XG4gICAgdmFyIHVzZXJUeXBlID0gRmxvcmVuY2UuQXV0aGVudGljYXRpb24udXNlclR5cGUoKTtcblxuICAgIGlmICh1c2VyVHlwZSA9PSAnREFUQV9WSVNVQUxJU0FUSU9OJykge1xuICAgICAgICAkKCcuanMtYnJvd3NlX19pdGVtIC5wYWdlX19jb250YWluZXInKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgJCgnLnBhZ2VfX2J1dHRvbnMtLWxpc3Quc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgdmFyICR0aGlzID0gJCgnLmRhdGF2aXMtZGlyZWN0b3J5Jyk7XG4gICAgICAgICR0aGlzLm5leHQoJy5wYWdlX19idXR0b25zLS1saXN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJylcbiAgICAgICAgICAgIC5jbG9zZXN0KCcucGFnZV9fY29udGFpbmVyJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJylcbiAgICAgICAgICAgIC5uZXh0KCcuanMtYnJvd3NlX19jaGlsZHJlbicpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG59XG5cbi8vIHJlY3Vyc2l2ZWx5IGFkZCBpc0RlbGV0YWJsZSBhbmQgZGVsZXRlSXNJbkNvbGxlY3Rpb24gZmxhZ3MgdG8gYWxsIGJyb3dzZSB0cmVlIG5vZGVzXG5mdW5jdGlvbiBjaGVja0FuZEFkZERlbGV0ZUZsYWcoYnJvd3NlVHJlZSwgY29sbGVjdGlvbkRhdGEpIHtcbiAgICBicm93c2VUcmVlWydpc0RlbGV0YWJsZSddID0gaXNEZWxldGFibGUoYnJvd3NlVHJlZS50eXBlKTtcbiAgICBicm93c2VUcmVlWydkZWxldGVJc0luQ29sbGVjdGlvbiddID0gZGVsZXRlSXNJbkNvbGxlY3Rpb24oYnJvd3NlVHJlZS5jb250ZW50UGF0aCwgY29sbGVjdGlvbkRhdGEpO1xuXG4gICAgJC5lYWNoKGJyb3dzZVRyZWUuY2hpbGRyZW4sIGZ1bmN0aW9uKCBrZXksIGJyb3dzZVRyZWVOb2RlICkge1xuICAgICAgICBpZiAoYnJvd3NlVHJlZU5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGNoZWNrQW5kQWRkRGVsZXRlRmxhZyhicm93c2VUcmVlTm9kZSwgY29sbGVjdGlvbkRhdGEpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8vIHNldCBkZWxldGFibGUgZmxhZyB0byBmYWxzZSBmb3IgY2VydGFpbiBwYWdlIHR5cGVzXG5mdW5jdGlvbiBpc0RlbGV0YWJsZSh0eXBlKSB7XG4gICAgaWYgKHR5cGUgPT0gJ2hvbWVfcGFnZScgfHwgdHlwZSA9PSAndGF4b25vbXlfbGFuZGluZ19wYWdlJyB8fCB0eXBlID09ICdwcm9kdWN0X3BhZ2UnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5cbi8vIGNoZWNrIGlmIGdpdmVuIHVyaSBpcyBtYXJrZWQgZm9yIGRlbGV0aW9uIGluIGN1cnJlbnQgY29sbGVjdGlvblxuZnVuY3Rpb24gZGVsZXRlSXNJbkNvbGxlY3Rpb24odXJpLCBjb2xsZWN0aW9uRGF0YSkge1xuICAgIHZhciBib29sO1xuICAgIGlmIChjb2xsZWN0aW9uRGF0YS5wZW5kaW5nRGVsZXRlcykge1xuICAgICAgICAkLmVhY2goY29sbGVjdGlvbkRhdGEucGVuZGluZ0RlbGV0ZXMsIGZ1bmN0aW9uIChrZXksIGRlbGV0ZU1hcmtlcikge1xuICAgICAgICAgICAgaWYgKHVyaSA9PSBkZWxldGVNYXJrZXIucm9vdC51cmkpIHtcbiAgICAgICAgICAgICAgICBib29sID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJvb2wgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBib29sO1xufVxuXG4vLyBkaXNwbGF5IG9wZW4gZGlyZWN0b3J5IGljb24gZm9yIHBhcmVudHMgZGlyZWN0b3JpZXNcbmZ1bmN0aW9uIHNlbGVjdFBhcmVudERpcmVjdG9yaWVzKCR0aGlzKSB7XG4gICAgJCgnLnBhZ2VfX2l0ZW0tLWRpcmVjdG9yeScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOyAvLyByZW1vdmUgcHJldmlvdXMgc2VsZWN0aW9uc1xuICAgICR0aGlzLnBhcmVudHMoJy5qcy1icm93c2VfX2l0ZW0tLWRpcmVjdG9yeScpLmZpbmQoJy5wYWdlX19pdGVtLS1kaXJlY3Rvcnk6Zmlyc3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsgLy8gc2VsZWN0IGRpcmVjdG9yaWVzIGFsb25nIHBhcmVudCBwYXRoXG59XG5cbmZ1bmN0aW9uIGxvYWRDaGFydEJ1aWxkZXIocGFnZURhdGEsIG9uU2F2ZSwgY2hhcnQpIHtcbiAgICB2YXIgY2hhcnQgPSBjaGFydDtcbiAgICB2YXIgcGFnZVVybCA9IHBhZ2VEYXRhLnVyaTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5jaGFydEJ1aWxkZXIoY2hhcnQpO1xuICAgICQoJ2JvZHknKS5hcHBlbmQoaHRtbCk7XG4gICAgJCgnLmpzLWNoYXJ0LWJ1aWxkZXInKS5jc3MoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIik7XG5cbiAgICBpZiAoY2hhcnQpIHtcbiAgICAgICAgJCgnI2NoYXJ0LWRhdGEnKS52YWwodG9Uc3YoY2hhcnQpKTtcbiAgICAgICAgcmVmcmVzaEV4dHJhT3B0aW9ucygpO1xuICAgIH1cblxuICAgIHJlbmRlclRleHQoKTtcbiAgICByZW5kZXJDaGFydCgpO1xuXG4gICAgZnVuY3Rpb24gcmVmcmVzaEV4dHJhT3B0aW9ucygpIHtcbiAgICAgICAgdmFyIHRlbXBsYXRlID0gZ2V0RXh0cmFPcHRpb25zVGVtcGxhdGUoY2hhcnQuY2hhcnRUeXBlKTtcbiAgICAgICAgaWYgKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlKGNoYXJ0KTtcbiAgICAgICAgICAgICQoJyNleHRyYXMnKS5odG1sKGh0bWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnI2V4dHJhcycpLmVtcHR5KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRFeHRyYU9wdGlvbnNUZW1wbGF0ZShjaGFydFR5cGUpIHtcbiAgICAgICAgc3dpdGNoIChjaGFydFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2JhcmxpbmUnOlxuICAgICAgICAgICAgY2FzZSAncm90YXRlZC1iYXJsaW5lJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmNoYXJ0RWRpdEJhcmxpbmVFeHRyYXM7XG4gICAgICAgICAgICBjYXNlICdkdWFsLWF4aXMnOlxuICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZXMuY2hhcnRFZGl0RHVhbEF4aXNFeHRyYXM7XG4gICAgICAgICAgICBjYXNlICdsaW5lJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmNoYXJ0RWRpdExpbmVDaGFydEV4dHJhcztcbiAgICAgICAgICAgIGNhc2UgJ2Jhcic6XG4gICAgICAgICAgICBjYXNlICdyb3RhdGVkJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmNoYXJ0RWRpdEJhckNoYXJ0RXh0cmFzO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkKCcucmVmcmVzaC1jaGFydCcpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2hhcnQgPSBidWlsZENoYXJ0T2JqZWN0KCk7XG4gICAgICAgIHJlZnJlc2hFeHRyYU9wdGlvbnMoKTtcbiAgICAgICAgcmVuZGVyQ2hhcnQoKTtcbiAgICB9KTtcblxuICAgICQoJy5yZWZyZXNoLWNoYXJ0Jykub24oJ2NoYW5nZScsICc6Y2hlY2tib3gnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNoYXJ0ID0gYnVpbGRDaGFydE9iamVjdCgpO1xuICAgICAgICByZWZyZXNoRXh0cmFPcHRpb25zKCk7XG4gICAgICAgIHJlbmRlckNoYXJ0KCk7XG4gICAgfSk7XG5cblxuICAgICQoJy5yZWZyZXNoLXRleHQnKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlbmRlclRleHQoKTtcbiAgICB9KTtcblxuICAgICQoJy5idG4tY2hhcnQtYnVpbGRlci1jYW5jZWwnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoJy5qcy1jaGFydC1idWlsZGVyJykuc3RvcCgpLmZhZGVPdXQoMjAwKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgICQoJy5idG4tY2hhcnQtYnVpbGRlci1jcmVhdGUnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgY2hhcnQgPSBidWlsZENoYXJ0T2JqZWN0KCk7XG5cbiAgICAgICAgdmFyIGpzb25QYXRoID0gY2hhcnQudXJpICsgXCIuanNvblwiO1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsganNvblBhdGgsXG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShjaGFydCksXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFwYWdlRGF0YS5jaGFydHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZURhdGEuY2hhcnRzID0gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZXhpc3RpbmdDaGFydCA9IF8uZmluZChwYWdlRGF0YS5jaGFydHMsIGZ1bmN0aW9uIChleGlzdGluZ0NoYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleGlzdGluZ0NoYXJ0LmZpbGVuYW1lID09PSBjaGFydC5maWxlbmFtZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0NoYXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nQ2hhcnQudGl0bGUgPSBjaGFydC50aXRsZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYWdlRGF0YS5jaGFydHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY2hhcnQudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTogY2hhcnQuZmlsZW5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmk6IGNoYXJ0LnVyaVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob25TYXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uU2F2ZShjaGFydC5maWxlbmFtZSwgJzxvbnMtY2hhcnQgcGF0aD1cIicgKyBjaGFydC5maWxlbmFtZSArICdcIiAvPicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKCcuanMtY2hhcnQtYnVpbGRlcicpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc2V0U2hvcnRjdXRzKCcjY2hhcnQtdGl0bGUnLCByZW5kZXJUZXh0KTtcbiAgICBzZXRTaG9ydGN1dHMoJyNjaGFydC1zdWJ0aXRsZScsIHJlbmRlclRleHQpO1xuICAgIHNldFNob3J0Y3V0cygnI2NoYXJ0LWRhdGEnLCByZW5kZXJDaGFydCk7XG4gICAgc2V0U2hvcnRjdXRzKCcjY2hhcnQteC1heGlzLWxhYmVsJywgcmVuZGVyQ2hhcnQpO1xuICAgIHNldFNob3J0Y3V0cygnI2NoYXJ0LW5vdGVzJywgcmVuZGVyVGV4dCk7XG5cbiAgICAvL1JlbmRlcnMgaHRtbCBvdXRzaWRlIGFjdHVhbCBjaGFydCBhcmVhICh0aXRsZSwgc3VidGl0bGUsIHNvdXJjZSwgbm90ZXMgZXRjLilcbiAgICBmdW5jdGlvbiByZW5kZXJUZXh0KCkge1xuICAgICAgICB2YXIgdGl0bGUgPSBkb1N1cGVyc2NyaXB0QW5kU3Vic2NyaXB0KCQoJyNjaGFydC10aXRsZScpLnZhbCgpKTtcbiAgICAgICAgdmFyIHN1YnRpdGxlID0gZG9TdXBlcnNjcmlwdEFuZFN1YnNjcmlwdCgkKCcjY2hhcnQtc3VidGl0bGUnKS52YWwoKSk7XG4gICAgICAgICQoJyNjaGFydC1zb3VyY2UtcHJldmlldycpLmh0bWwoJCgnI2NoYXJ0LXNvdXJjZScpLnZhbCgpKTtcbiAgICAgICAgJCgnI2NoYXJ0LXRpdGxlLXByZXZpZXcnKS5odG1sKHRpdGxlKTtcbiAgICAgICAgJCgnI2NoYXJ0LXN1YnRpdGxlLXByZXZpZXcnKS5odG1sKHN1YnRpdGxlKTtcbiAgICAgICAgJCgnI2NoYXJ0LW5vdGVzLXByZXZpZXcnKS5odG1sKHRvTWFya2Rvd24oJCgnI2NoYXJ0LW5vdGVzJykudmFsKCkpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b01hcmtkb3duKHRleHQpIHtcbiAgICAgICAgaWYgKHRleHQgJiYgaXNNYXJrZG93bkF2YWlsYWJsZSkge1xuICAgICAgICAgICAgdmFyIGNvbnZlcnRlciA9IG5ldyBNYXJrZG93bi5nZXRTYW5pdGl6aW5nQ29udmVydGVyKCk7XG4gICAgICAgICAgICBNYXJrZG93bi5FeHRyYS5pbml0KGNvbnZlcnRlciwge1xuICAgICAgICAgICAgICAgIGV4dGVuc2lvbnM6IFwiYWxsXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnRlci5tYWtlSHRtbCh0ZXh0KVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc01hcmtkb3duQXZhaWxhYmxlKCkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIE1hcmtkb3duICE9PSAndW5kZWZpbmVkJ1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvU3VwZXJzY3JpcHRBbmRTdWJzY3JpcHQodGV4dCkge1xuICAgICAgICBpZiAodGV4dCAmJiBpc01hcmtkb3duQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICB2YXIgY29udmVydGVyID0gbmV3IE1hcmtkb3duLkNvbnZlcnRlcigpO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnRlci5fRG9TdWJzY3JpcHQoY29udmVydGVyLl9Eb1N1cGVyc2NyaXB0KHRleHQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGV4dDtcblxuICAgIH1cblxuICAgIC8vIEJ1aWxkcywgcGFyc2VzLCBhbmQgcmVuZGVycyBvdXIgY2hhcnQgaW4gdGhlIGNoYXJ0IGVkaXRvclxuICAgIGZ1bmN0aW9uIHJlbmRlckNoYXJ0KCkge1xuICAgICAgICBjaGFydCA9IGJ1aWxkQ2hhcnRPYmplY3QoKTtcbiAgICAgICAgdmFyIHByZXZpZXcgPSAkKCcjY2hhcnQnKTtcbiAgICAgICAgdmFyIGNoYXJ0SGVpZ2h0ID0gcHJldmlldy53aWR0aCgpICogY2hhcnQuYXNwZWN0UmF0aW87XG4gICAgICAgIHZhciBjaGFydFdpZHRoID0gcHJldmlldy53aWR0aCgpO1xuICAgICAgICByZW5kZXJDaGFydE9iamVjdCgnY2hhcnQnLCBjaGFydCwgY2hhcnRIZWlnaHQsIGNoYXJ0V2lkdGgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkQ2hhcnRPYmplY3QoKSB7XG4gICAgICAgIHZhciBqc29uID0gJCgnI2NoYXJ0LWRhdGEnKS52YWwoKTtcbiAgICAgICAgaWYgKCFjaGFydCkge1xuICAgICAgICAgICAgY2hhcnQgPSB7fTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNoYXJ0LnR5cGUgPSBcImNoYXJ0XCI7XG4gICAgICAgIGNoYXJ0LnRpdGxlID0gJCgnI2NoYXJ0LXRpdGxlJykudmFsKCk7XG4gICAgICAgIGNoYXJ0LmZpbGVuYW1lID0gY2hhcnQuZmlsZW5hbWUgPyBjaGFydC5maWxlbmFtZSA6IFN0cmluZ1V0aWxzLnJhbmRvbUlkKCk7IC8vICBjaGFydC50aXRsZS5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjaGFydC51cmkgPSBwYWdlVXJsICsgXCIvXCIgKyBjaGFydC5maWxlbmFtZTtcbiAgICAgICAgY2hhcnQuc3VidGl0bGUgPSAkKCcjY2hhcnQtc3VidGl0bGUnKS52YWwoKTtcbiAgICAgICAgY2hhcnQudW5pdCA9ICQoJyNjaGFydC11bml0JykudmFsKCk7XG4gICAgICAgIGNoYXJ0LnNvdXJjZSA9ICQoJyNjaGFydC1zb3VyY2UnKS52YWwoKTtcblxuICAgICAgICBjaGFydC5kZWNpbWFsUGxhY2VzID0gJCgnI2NoYXJ0LWRlY2ltYWwtcGxhY2VzJykudmFsKCk7XG4gICAgICAgIGNoYXJ0LmxhYmVsSW50ZXJ2YWwgPSAkKCcjY2hhcnQtbGFiZWwtaW50ZXJ2YWwnKS52YWwoKTtcblxuICAgICAgICBjaGFydC5ub3RlcyA9ICQoJyNjaGFydC1ub3RlcycpLnZhbCgpO1xuICAgICAgICBjaGFydC5hbHRUZXh0ID0gJCgnI2NoYXJ0LWFsdC10ZXh0JykudmFsKCk7XG4gICAgICAgIGNoYXJ0LnhBeGlzTGFiZWwgPSAkKCcjY2hhcnQteC1heGlzLWxhYmVsJykudmFsKCk7XG4gICAgICAgIGNoYXJ0LnN0YXJ0RnJvbVplcm8gPSAkKCcjc3RhcnQtZnJvbS16ZXJvJykucHJvcCgnY2hlY2tlZCcpO1xuICAgICAgICBjaGFydC5maW5pc2hBdEh1bmRyZWQgPSAkKCcjZmluaXNoLWF0LWh1bmRyZWQnKS5wcm9wKCdjaGVja2VkJyk7XG5cbiAgICAgICAgaWYgKGNoYXJ0LnRpdGxlID09PSAnJykge1xuICAgICAgICAgICAgY2hhcnQudGl0bGUgPSAnW1RpdGxlXSdcbiAgICAgICAgfVxuXG4gICAgICAgIGNoYXJ0LmRhdGEgPSB0c3ZKU09OKGpzb24pO1xuICAgICAgICBjaGFydC5oZWFkZXJzID0gdHN2SlNPTkhlYWRlcnMoanNvbik7XG4gICAgICAgIGNoYXJ0LnNlcmllcyA9IHRzdkpTT05Db2xOYW1lcyhqc29uKTtcbiAgICAgICAgY2hhcnQuY2F0ZWdvcmllcyA9IHRzdkpTT05Sb3dOYW1lcyhqc29uKTtcblxuICAgICAgICBjaGFydC5hc3BlY3RSYXRpbyA9ICQoJyNhc3BlY3QtcmF0aW8nKS52YWwoKTtcblxuICAgICAgICBpZiAoaXNTaG93QmFyTGluZVNlbGVjdGlvbihjaGFydC5jaGFydFR5cGUpKSB7XG4gICAgICAgICAgICB2YXIgdHlwZXMgPSB7fTtcbiAgICAgICAgICAgIHZhciBncm91cHMgPSBbXTtcbiAgICAgICAgICAgIHZhciBncm91cCA9IFtdO1xuICAgICAgICAgICAgdmFyIHNlcmllc0RhdGEgPSBjaGFydC5zZXJpZXM7XG4gICAgICAgICAgICAkLmVhY2goc2VyaWVzRGF0YSwgZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgdHlwZXNbc2VyaWVzRGF0YVtpbmRleF1dID0gJCgnI3R5cGVzXycgKyBpbmRleCkudmFsKCkgfHwgJ2Jhcic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnI2V4dHJhcyBpbnB1dDpjaGVja2JveDpjaGVja2VkJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwLnB1c2goJCh0aGlzKS52YWwoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goZ3JvdXApO1xuICAgICAgICAgICAgICAgIHJldHVybiBncm91cHM7XG4gICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgY2hhcnQuY2hhcnRUeXBlcyA9IHR5cGVzO1xuICAgICAgICAgICAgY2hhcnQuZ3JvdXBzID0gZ3JvdXBzO1xuICAgICAgICB9XG5cbiAgICAgICAgY2hhcnQuY2hhcnRUeXBlID0gJCgnI2NoYXJ0LXR5cGUnKS52YWwoKTtcblxuICAgICAgICAvL2NvbnNvbGUubG9nKGNoYXJ0KTtcbiAgICAgICAgcGFyc2VDaGFydE9iamVjdChjaGFydCk7XG5cbiAgICAgICAgY2hhcnQuZmlsZXMgPSBbXTtcbiAgICAgICAgLy9jaGFydC5maWxlcy5wdXNoKHsgdHlwZTonZG93bmxvYWQtcG5nJywgZmlsZW5hbWU6Y2hhcnQuZmlsZW5hbWUgKyAnLWRvd25sb2FkLnBuZycgfSk7XG4gICAgICAgIC8vY2hhcnQuZmlsZXMucHVzaCh7IHR5cGU6J3BuZycsIGZpbGVuYW1lOmNoYXJ0LmZpbGVuYW1lICsgJy5wbmcnIH0pO1xuXG4gICAgICAgIHJldHVybiBjaGFydDtcbiAgICB9XG5cbiAgICAvL0RldGVybWluZXMgaWYgc2VsZWN0ZWQgY2hhcnQgdHlwZSBpcyBiYXJsaW5lIG9yIHJvdGF0ZWQgYmFyIGxpbmVcbiAgICBmdW5jdGlvbiBpc1Nob3dCYXJMaW5lU2VsZWN0aW9uKGNoYXJ0VHlwZSkge1xuICAgICAgICByZXR1cm4gKGNoYXJ0VHlwZSA9PT0gJ2JhcmxpbmUnIHx8IGNoYXJ0VHlwZSA9PT0gXCJyb3RhdGVkLWJhcmxpbmVcIiB8fCBjaGFydFR5cGUgPT09IFwiZHVhbC1heGlzXCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhcnNlQ2hhcnRPYmplY3QoY2hhcnQpIHtcblxuICAgICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgaGF2ZSBhIHRpbWUgc2VyaWVzXG4gICAgICAgIHZhciB0aW1lU2VyaWVzID0gYXhpc0FzVGltZVNlcmllcyhjaGFydC5jYXRlZ29yaWVzKTtcbiAgICAgICAgaWYgKHRpbWVTZXJpZXMgJiYgdGltZVNlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjaGFydC5pc1RpbWVTZXJpZXMgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBXZSBjcmVhdGUgZGF0YSBzcGVjaWZpYyB0byB0aW1lXG4gICAgICAgICAgICB0aW1lRGF0YSA9IFtdO1xuICAgICAgICAgICAgXy5lYWNoKHRpbWVTZXJpZXMsIGZ1bmN0aW9uICh0aW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBjaGFydC5kYXRhW3RpbWVbJ3JvdyddXTtcbiAgICAgICAgICAgICAgICBpdGVtLmRhdGUgPSB0aW1lWydkYXRlJ107XG4gICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IHRpbWVbJ2xhYmVsJ107XG4gICAgICAgICAgICAgICAgdGltZURhdGEucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjaGFydC50aW1lU2VyaWVzID0gdGltZURhdGE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLy8vIENvbnZlcnRzIGNoYXJ0IHRvIGhpZ2hjaGFydHMgY29uZmlndXJhdGlvbiBieSBwb3N0aW5nIEJhYmJhZ2UgL2NoYXJ0Y29uZmlnIGVuZHBvaW50IGFuZCB0byB0aGUgcmVuZGVyaW5nIHdpdGggZmV0Y2hlZCBjb25maWd1cmF0aW9uXG4gICAgZnVuY3Rpb24gcmVuZGVyQ2hhcnRPYmplY3QoYmluZFRhZywgY2hhcnQsIGNoYXJ0SGVpZ2h0LCBjaGFydFdpZHRoKSB7XG5cbiAgICAgICAgdmFyIGpxeGhyID0gJC5wb3N0KFwiL2NoYXJ0Y29uZmlnXCIsIHtcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShjaGFydCksXG4gICAgICAgICAgICAgICAgd2lkdGg6IGNoYXJ0V2lkdGhcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoYXJ0Q29uZmlnID0gd2luZG93W1wiY2hhcnQtXCIgKyBjaGFydC5maWxlbmFtZV07XG4gICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhcIlJlZnJlc2hpbmcgdGhlIGNoYXJ0LCBjb25maWc6XCIsIGNoYXJ0Q29uZmlnKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hhcnRDb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhcnRDb25maWcuY2hhcnQucmVuZGVyVG8gPSBcImNoYXJ0XCI7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBIaWdoY2hhcnRzLkNoYXJ0KGNoYXJ0Q29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvd1tcImNoYXJ0LVwiICsgY2hhcnQuZmlsZW5hbWVdOyAvL2NsZWFyIGRhdGEgZnJvbSB3aW5kb3cgb2JqZWN0IGFmdGVyIHJlbmRlcmluZ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIFwic2NyaXB0XCIpXG4gICAgICAgICAgICAuZmFpbChmdW5jdGlvbiAoZGF0YSwgZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmFpbGVkIHJlYWRpbmcgY2hhcnQgY29uZmlndXJhdGlvbiBmcm9tIHNlcnZlclwiLCBjaGFydCk7XG4gICAgICAgICAgICAgICAgJChcIiNjaGFydFwiKS5lbXB0eSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRGF0YSBsb2FkIGZyb20gdGV4dCBib3ggZnVuY3Rpb25zXG4gICAgZnVuY3Rpb24gdHN2SlNPTihpbnB1dCkge1xuICAgICAgICB2YXIgbGluZXMgPSBpbnB1dC5zcGxpdChcIlxcblwiKTtcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGxpbmVzWzBdLnNwbGl0KFwiXFx0XCIpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50bGluZSA9IGxpbmVzW2ldLnNwbGl0KFwiLFwiKS5qb2luKFwiXCIpLnNwbGl0KFwiXFx0XCIpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhlYWRlcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBvYmpbaGVhZGVyc1tqXV0gPSBjdXJyZW50bGluZVtqXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG9iaik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDsgLy9KU09OXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9Uc3YoZGF0YSkge1xuICAgICAgICB2YXIgb3V0cHV0ID0gXCJcIjtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEuaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGkgPT09IGRhdGEuaGVhZGVycy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ICs9IGRhdGEuaGVhZGVyc1tpXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ICs9IGRhdGEuaGVhZGVyc1tpXSArIFwiXFx0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEuY2F0ZWdvcmllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb3V0cHV0ICs9IFwiXFxuXCIgKyB0b1RzdkxpbmUoZGF0YS5kYXRhW2ldLCBkYXRhLmhlYWRlcnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b1RzdkxpbmUoZGF0YSwgaGVhZGVycykge1xuXG4gICAgICAgIHZhciBvdXRwdXQgPSBcIlwiO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGkgPT09IGhlYWRlcnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIG91dHB1dCArPSBkYXRhW2hlYWRlcnNbaV1dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gZGF0YVtoZWFkZXJzW2ldXSArIFwiXFx0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0c3ZKU09OUm93TmFtZXMoaW5wdXQpIHtcbiAgICAgICAgdmFyIGxpbmVzID0gaW5wdXQuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudGxpbmUgPSBsaW5lc1tpXS5zcGxpdChcIlxcdFwiKTtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnJlbnRsaW5lWzBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHN2SlNPTkNvbE5hbWVzKGlucHV0KSB7XG4gICAgICAgIHZhciBsaW5lcyA9IGlucHV0LnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGxpbmVzWzBdLnNwbGl0KFwiXFx0XCIpO1xuICAgICAgICBoZWFkZXJzLnNoaWZ0KCk7XG4gICAgICAgIHJldHVybiBoZWFkZXJzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRzdkpTT05IZWFkZXJzKGlucHV0KSB7XG4gICAgICAgIHZhciBsaW5lcyA9IGlucHV0LnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGxpbmVzWzBdLnNwbGl0KFwiXFx0XCIpO1xuICAgICAgICByZXR1cm4gaGVhZGVycztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBvcnRUb1NWRyhzb3VyY2VTZWxlY3Rvcikge1xuICAgICAgICB2YXIgc3ZnQ29udGFpbmVyID0gJChzb3VyY2VTZWxlY3Rvcik7XG4gICAgICAgIHZhciBzdmcgPSBzdmdDb250YWluZXIuZmluZCgnc3ZnJyk7XG5cbiAgICAgICAgdmFyIHN0eWxlQ29udGVudCA9IFwiXFxuXCI7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHN0ciA9IGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmhyZWYuc3BsaXQoXCIvXCIpO1xuICAgICAgICAgICAgaWYgKHN0cltzdHIubGVuZ3RoIC0gMV0gPT0gXCJjMy5jc3NcIikge1xuICAgICAgICAgICAgICAgIHZhciBydWxlcyA9IGRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLnJ1bGVzO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcnVsZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVDb250ZW50ICs9IChydWxlc1tqXS5jc3NUZXh0ICsgXCJcXG5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy92YXIgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInN0eWxlXCIpO1xuICAgICAgICAvLyQoc3R5bGUpLnRleHRDb250ZW50ICs9IFwiXFxuPCFbQ0RBVEFbXFxuXCIgKyBzdHlsZUNvbnRlbnQgKyBcIlxcbl1dPlxcblwiO1xuICAgICAgICAvL1xuICAgICAgICAvL3N2Zy5wcmVwZW5kKHN0eWxlKTtcbiAgICAgICAgLy9zdmdbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkZWZzXCIpWzBdLmFwcGVuZENoaWxkKHN0eWxlKTtcblxuXG4gICAgICAgIHN2Zy5wcmVwZW5kKFwiXFxuPHN0eWxlIHR5cGU9J3RleHQvY3NzJz48L3N0eWxlPlwiKTtcbiAgICAgICAgc3ZnLmZpbmQoXCJzdHlsZVwiKS50ZXh0Q29udGVudCArPSBcIlxcbjwhW0NEQVRBW1wiICsgc3R5bGVDb250ZW50ICsgXCJdXT5cXG5cIjtcblxuXG4gICAgICAgIC8vaWYgKCQoJyNjaGFydC10eXBlJykudmFsKCkgPT09ICdsaW5lJykge1xuICAgICAgICAvLyAgJCgnLmMzIGxpbmUnKS5jc3MoXCJmaWxsXCIsIFwibm9uZVwiKTtcbiAgICAgICAgLy8gIGNvbnNvbGUubG9nKCQoJy5jMyBsaW5lJykpXG4gICAgICAgIC8vfVxuXG4gICAgICAgIHZhciBzb3VyY2UgPSAobmV3IFhNTFNlcmlhbGl6ZXIpLnNlcmlhbGl6ZVRvU3RyaW5nKHN2Z1swXSk7XG4gICAgICAgIC8vY29uc29sZS5sb2coc291cmNlKTtcblxuICAgICAgICAvL2FkZCBuYW1lIHNwYWNlcy5cbiAgICAgICAgaWYgKCFzb3VyY2UubWF0Y2goL148c3ZnW14+XSt4bWxucz1cImh0dHBcXDpcXC9cXC93d3dcXC53M1xcLm9yZ1xcLzIwMDBcXC9zdmdcIi8pKSB7XG4gICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2UucmVwbGFjZSgvXjxzdmcvLCAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCInKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNvdXJjZS5tYXRjaCgvXjxzdmdbXj5dK1wiaHR0cFxcOlxcL1xcL3d3d1xcLnczXFwub3JnXFwvMTk5OVxcL3hsaW5rXCIvKSkge1xuICAgICAgICAgICAgc291cmNlID0gc291cmNlLnJlcGxhY2UoL148c3ZnLywgJzxzdmcgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCInKTtcbiAgICAgICAgfVxuICAgICAgICAvL2FkZCBwYWRkaW5nXG4gICAgICAgIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKC9zdHlsZT1cIm92ZXJmbG93OiBoaWRkZW47XCIvLCAnc3R5bGU9XCJvdmVyZmxvdzogaGlkZGVuOyBwYWRkaW5nOiA1MHB4O1wiJyk7XG5cbiAgICAgICAgLy9hZGQgeG1sIGRlY2xhcmF0aW9uXG4gICAgICAgIHNvdXJjZSA9ICc8P3htbCB2ZXJzaW9uPVwiMS4wXCIgc3RhbmRhbG9uZT1cIm5vXCI/PlxcclxcbicgKyBzb3VyY2U7XG5cbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cblxuICAgIC8vIFN0ZXBzIHRocm91Z2ggdGltZSBzZXJpZXMgcG9pbnRzXG4gICAgZnVuY3Rpb24gYXhpc0FzVGltZVNlcmllcyhheGlzKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgdmFyIHJvd051bWJlciA9IDA7XG5cbiAgICAgICAgXy5lYWNoKGF4aXMsIGZ1bmN0aW9uICh0cnlUaW1lU3RyaW5nKSB7XG4gICAgICAgICAgICB2YXIgdGltZSA9IGNvbnZlcnRUaW1lU3RyaW5nKHRyeVRpbWVTdHJpbmcpO1xuICAgICAgICAgICAgaWYgKHRpbWUpIHtcbiAgICAgICAgICAgICAgICB0aW1lLnJvdyA9IHJvd051bWJlcjtcbiAgICAgICAgICAgICAgICByb3dOdW1iZXIgPSByb3dOdW1iZXIgKyAxO1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGltZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb252ZXJ0VGltZVN0cmluZyh0aW1lU3RyaW5nKSB7XG4gICAgICAgIC8vIEZpcnN0IHRpbWUgYXJvdW5kIHBhcnNlIHRoZSB0aW1lIHN0cmluZyBhY2NvcmRpbmcgdG8gcnVsZXMgZnJvbSByZWd1bGFyIHRpbWVzZXJpZXNcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICByZXN1bHQubGFiZWwgPSB0aW1lU3RyaW5nO1xuXG4gICAgICAgIC8vIEZvcm1hdCB0aW1lIHN0cmluZ1xuICAgICAgICAvLyBDaGVjayBmb3Igc3RyaW5ncyB0aGF0IHdpbGwgdHVybiB0aGVtc2VsdmVzIGludG8gYSBzdHJhbmdlIGZvcm1hdFxuICAgICAgICB0d29EaWdpdFllYXJFbmQgPSB0aW1lU3RyaW5nLm1hdGNoKC9cXFdcXGRcXGQkLyk7XG4gICAgICAgIGlmICh0d29EaWdpdFllYXJFbmQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHllYXIgPSBwYXJzZUludCh0aW1lU3RyaW5nLnN1YnN0cih0aW1lU3RyaW5nLmxlbmd0aCAtIDIsIHRpbWVTdHJpbmcubGVuZ3RoKSk7XG4gICAgICAgICAgICBwcmVmaXggPSB0aW1lU3RyaW5nLnN1YnN0cigwLCB0aW1lU3RyaW5nLmxlbmd0aCAtIDIpLnRyaW0oKTtcblxuICAgICAgICAgICAgaWYgKHllYXIgPj0gNDApIHtcbiAgICAgICAgICAgICAgICB0aW1lU3RyaW5nID0gcHJlZml4ICsgXCIgMTlcIiArIHllYXI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRpbWVTdHJpbmcgPSBwcmVmaXggKyBcIiAyMFwiICsgeWVhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGZvciBxdWFydGVyc1xuICAgICAgICBxdWFydGVyID0gdGltZVN0cmluZy5tYXRjaCgvUVxcZC8pO1xuICAgICAgICB5ZWFyID0gdGltZVN0cmluZy5tYXRjaCgvXFxkXFxkXFxkXFxkLyk7XG4gICAgICAgIGlmICgocXVhcnRlciAhPT0gbnVsbCkgJiYgKHllYXIgIT09IG51bGwpKSB7XG4gICAgICAgICAgICBtb250aHMgPSBbXCJGZWJydWFyeSBcIiwgXCJNYXkgXCIsIFwiQXVndXN0IFwiLCBcIk5vdmVtYmVyIFwiXTtcbiAgICAgICAgICAgIHF1YXJ0ZXJNaWQgPSBwYXJzZUludChxdWFydGVyWzBdWzFdKTtcbiAgICAgICAgICAgIHRpbWVTdHJpbmcgPSBtb250aHNbcXVhcnRlck1pZCAtIDFdICsgeWVhclswXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdlIGFyZSBnb2luZyB3aXRoIGFsbCB0aW1lcyBpbiBhIGNvbW1vbiBmb3JtYXRcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aW1lU3RyaW5nKTtcbiAgICAgICAgaWYgKCFpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgIHJlc3VsdC5kYXRlID0gZGF0ZTtcbiAgICAgICAgICAgIHJlc3VsdC5wZXJpb2QgPSAnb3RoZXInO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAobnVsbCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2VuZXJhdGVQbmcoc291cmNlU2VsZWN0b3IsIGNhbnZhc1NlbGVjdG9yLCBmaWxlU3VmZml4KSB7XG5cbiAgICAgICAgdmFyIHByZXZpZXcgPSAkKHNvdXJjZVNlbGVjdG9yKTtcbiAgICAgICAgdmFyIGNoYXJ0SGVpZ2h0ID0gcHJldmlldy5oZWlnaHQoKTtcbiAgICAgICAgdmFyIGNoYXJ0V2lkdGggPSBwcmV2aWV3LndpZHRoKCk7XG5cbiAgICAgICAgdmFyIGNvbnRlbnQgPSBleHBvcnRUb1NWRyhzb3VyY2VTZWxlY3RvcikudHJpbSgpO1xuXG4gICAgICAgIHZhciAkY2FudmFzID0gJChjYW52YXNTZWxlY3Rvcik7XG4gICAgICAgICRjYW52YXMud2lkdGgoY2hhcnRXaWR0aCk7XG4gICAgICAgICRjYW52YXMuaGVpZ2h0KGNoYXJ0SGVpZ2h0KTtcblxuICAgICAgICB2YXIgY2FudmFzID0gJGNhbnZhcy5nZXQoMCk7XG5cbiAgICAgICAgLy8gRHJhdyBzdmcgb24gY2FudmFzXG4gICAgICAgIGNhbnZnKGNhbnZhcywgY29udGVudCk7XG5cbiAgICAgICAgLy8gZ2V0IGRhdGEgdXJsIGZyb20gY2FudmFzLlxuICAgICAgICB2YXIgZGF0YVVybCA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpO1xuICAgICAgICB2YXIgcG5nRGF0YSA9IGRhdGFVcmwucmVwbGFjZSgvXmRhdGE6aW1hZ2VcXC8ocG5nfGpwZyk7YmFzZTY0LC8sIFwiXCIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGFVcmwpO1xuXG4gICAgICAgIHZhciByYXcgPSB3aW5kb3cuYXRvYihwbmdEYXRhKTtcbiAgICAgICAgdmFyIHJhd0xlbmd0aCA9IHJhdy5sZW5ndGg7XG4gICAgICAgIHZhciBhcnJheSA9IG5ldyBVaW50OEFycmF5KG5ldyBBcnJheUJ1ZmZlcihyYXdMZW5ndGgpKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhd0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcnJheVtpXSA9IHJhdy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHN1ZmZpeCA9IFwiXCI7XG5cbiAgICAgICAgaWYgKGZpbGVTdWZmaXgpIHtcbiAgICAgICAgICAgIHN1ZmZpeCA9IGZpbGVTdWZmaXhcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwbmdVcmkgPSBwYWdlVXJsICsgXCIvXCIgKyBjaGFydC5maWxlbmFtZSArIHN1ZmZpeCArIFwiLnBuZ1wiO1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsgcG5nVXJpLFxuICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YTogbmV3IEJsb2IoW2FycmF5XSwge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdpbWFnZS9wbmcnXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImltYWdlL3BuZ1wiLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3BuZyB1cGxvYWRlZCEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufS8vIGZ1bGx5IGxvYWQgdGhlIGNoYXJ0cyBsaXN0IGZyb20gc2NyYXRjaFxuZnVuY3Rpb24gbG9hZENoYXJ0c0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKSB7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRDaGFydHMoZGF0YSk7XG4gICAgJCgnI2NoYXJ0cycpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAgIGluaXRpYWxpc2VDaGFydExpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICBpbml0aWFsaXNlQ2xpcGJvYXJkKCk7XG59XG5cbi8vIHJlZnJlc2ggb25seSB0aGUgbGlzdCBvZiBjaGFydHMgLSBsZWF2aW5nIHRoZSBjb250YWluZXIgZGl2IHRoYXQgYWNjb3JkaW9uIHdvcmtzIGZyb20uXG5mdW5jdGlvbiByZWZyZXNoQ2hhcnRMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0Q2hhcnRzKGRhdGEpO1xuICAgICQoJyNjaGFydC1saXN0JykucmVwbGFjZVdpdGgoJChodG1sKS5maW5kKCcjY2hhcnQtbGlzdCcpKTtcbiAgICBpbml0aWFsaXNlQ2hhcnRMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgaW5pdGlhbGlzZUNsaXBib2FyZCgpO1xufVxuXG4vLyBkbyBhbGwgdGhlIHdpcmluZyB1cCBvZiBidXR0b25zIGV0YyBvbmNlIHRoZSB0ZW1wbGF0ZSBoYXMgYmVlbiByZW5kZXJlZC5cbmZ1bmN0aW9uIGluaXRpYWxpc2VDaGFydExpc3QoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgICAkKCcjYWRkLWNoYXJ0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkQ2hhcnRCdWlsZGVyKGRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG5cbiAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaENoYXJ0TGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJChkYXRhLmNoYXJ0cykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGNoYXJ0KSB7XG5cbiAgICAgICAgdmFyIGJhc2VQYXRoID0gZGF0YS51cmk7XG4gICAgICAgIHZhciBjaGFydFBhdGggPSBiYXNlUGF0aCArICcvJyArIGNoYXJ0LmZpbGVuYW1lO1xuICAgICAgICB2YXIgY2hhcnRKc29uID0gY2hhcnRQYXRoO1xuXG4gICAgICAgICQoXCIjY2hhcnQtZWRpdF9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRQYWdlRGF0YShjb2xsZWN0aW9uSWQsIGNoYXJ0SnNvbixcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3MgPSBmdW5jdGlvbiAoY2hhcnREYXRhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbG9hZENoYXJ0QnVpbGRlcihkYXRhLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoUHJldmlldygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgYmFzZVBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hDaGFydExpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9LCBjaGFydERhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjY2hhcnQtZGVsZXRlX1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBjaGFydD9cIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmNoYXJ0cyA9IF8oZGF0YS5jaGFydHMpLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZmlsZW5hbWUgIT09IGNoYXJ0LmZpbGVuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgYmFzZVBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgY2hhcnRKc29uICsgJy5qc29uJywgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9uRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgY2hhcnQgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoQ2hhcnRMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIE1ha2Ugc2VjdGlvbnMgc29ydGFibGVcbiAgICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcbiAgICAgICAgJCgnI3NvcnRhYmxlLWNoYXJ0Jykuc29ydGFibGUoKTtcbiAgICB9XG5cbiAgICBzb3J0YWJsZSgpO1xufVxuXG5cbmZ1bmN0aW9uIGxvYWRDcmVhdGVTY3JlZW4ocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQsIHR5cGUsIGNvbGxlY3Rpb25EYXRhKSB7XG4gICAgdmFyIGlzRGF0YVZpcyA9IGZhbHNlOyAvLyBGbGFnIGZvciB0ZW1wbGF0ZSB0byBzaG93IGNvcnJlY3Qgb3B0aW9ucyBpbiBzZWxlY3RcblxuICAgIC8vIExvYWQgZGF0YSB2aXMgY3JlYXRvciBvciBvcmRpbmFyeSBwdWJsaXNoZXIgY3JlYXRvclxuICAgIGlmIChjb2xsZWN0aW9uRGF0YSAmJiBjb2xsZWN0aW9uRGF0YS5jb2xsZWN0aW9uT3duZXIgPT0gXCJEQVRBX1ZJU1VBTElTQVRJT05cIikge1xuICAgICAgICBpc0RhdGFWaXMgPSB0cnVlO1xuICAgICAgICB0eXBlID0gJ3Zpc3VhbGlzYXRpb24nO1xuICAgIH1cblxuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtDcmVhdGUoe1wiZGF0YVZpc1wiOiBpc0RhdGFWaXN9KTtcblxuICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgbG9hZENyZWF0b3IocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQsIHR5cGUsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAkKCcjcGFnZXR5cGUnKS5mb2N1cygpO1xufVxuZnVuY3Rpb24gbG9hZENyZWF0b3IocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQsIHR5cGUsIGNvbGxlY3Rpb25EYXRhKSB7XG4gICAgdmFyICR0eXBlU2VsZWN0ID0gJCgnI3BhZ2V0eXBlJyksXG4gICAgICAgIHBhZ2VUeXBlLFxuICAgICAgICByZWxlYXNlRGF0ZTtcblxuICAgIGdldENvbGxlY3Rpb24oY29sbGVjdGlvbklkLFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnB1Ymxpc2hEYXRlKSB7XG4gICAgICAgICAgICAgICAgcmVsZWFzZURhdGUgPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWxlYXNlRGF0ZSA9IHJlc3BvbnNlLnB1Ymxpc2hEYXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgKTtcblxuICAgIC8vcmVsZWFzZURhdGUgPSBGbG9yZW5jZS5jb2xsZWN0aW9uLmRhdGU7ICAgICAgICAgICAgIC8vdG8gYmUgYWRkZWQgYmFjayB0byBzY2hlZHVsZWQgY29sbGVjdGlvbnNcblxuICAgIGlmICh0eXBlID09PSAnYnVsbGV0aW4nIHx8IHR5cGUgPT09ICdhcnRpY2xlJykge1xuICAgICAgICAkdHlwZVNlbGVjdC52YWwodHlwZSkuY2hhbmdlKCk7XG4gICAgICAgIGxvYWRUNENyZWF0b3IoY29sbGVjdGlvbklkLCByZWxlYXNlRGF0ZSwgdHlwZSwgcGFyZW50VXJsKTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgJHR5cGVTZWxlY3QudmFsKHR5cGUpLmNoYW5nZSgpO1xuICAgICAgICBsb2FkVDZDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHR5cGUsIHBhcmVudFVybCk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAndmlzdWFsaXNhdGlvbicpIHtcbiAgICAgICAgJHR5cGVTZWxlY3QudmFsKHR5cGUpLmNoYW5nZSgpO1xuICAgICAgICBsb2FkVmlzdWFsaXNhdGlvbkNyZWF0b3IoY29sbGVjdGlvbklkLCB0eXBlLCBjb2xsZWN0aW9uRGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJHR5cGVTZWxlY3Qub2ZmKCkuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHBhZ2VUeXBlID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgICQoJy5lZGl0aW9uJykuZW1wdHkoKTtcbiAgICAgICAgICAgICQoJy5jcmVhdGUtcHVibGlzaGluZy1lcnJvcicpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICBpZiAocGFnZVR5cGUgPT09ICdidWxsZXRpbicgfHwgcGFnZVR5cGUgPT09ICdhcnRpY2xlJyB8fCBwYWdlVHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnKSB7XG4gICAgICAgICAgICAgICAgbG9hZFQ0Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhZ2VUeXBlLm1hdGNoKC9jb21wZW5kaXVtXy4rLykpIHtcbiAgICAgICAgICAgICAgICBsb2FkVDZDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHBhZ2VUeXBlLCBwYXJlbnRVcmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUubWF0Y2goL3N0YXRpY18uKy8pKSB7XG4gICAgICAgICAgICAgICAgbG9hZFQ3Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhZ2VUeXBlID09PSAnZGF0YXNldF9sYW5kaW5nX3BhZ2UnIHx8IHBhZ2VUeXBlID09PSAndGltZXNlcmllc19sYW5kaW5nX3BhZ2UnKSB7XG4gICAgICAgICAgICAgICAgbG9hZFQ4Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09ICd2aXN1YWxpc2F0aW9uJykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWaXN1YWxpc2F0aW9uJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09ICdyZWxlYXNlJykge1xuICAgICAgICAgICAgICAgIGxvYWRUMTZDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHBhZ2VUeXBlLCBwYXJlbnRVcmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsICdQYWdlIHR5cGUgbm90IHJlY29nbmlzZWQuIENvbnRhY3QgYW4gYWRtaW5pc3RyYXRvcicsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuXG5cbi8qXG4qICAgTG9hZHMgZGF0ZXBpY2tlciB3aXRoIGNvcnJlY3QgZm9ybWF0IGFuZCBtb3ZlcyBmb2N1cyB0byBuZXh0IGZvcm0gZWxlbWVudCBvbiBzZWxlY3Rpb25cbiAqL1xuXG5mdW5jdGlvbiBjcmVhdG9yRGF0ZVBpY2tlcigpIHtcbiAgICAkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKHtcbiAgICAgICAgZGF0ZUZvcm1hdDogJ2RkIE1NIHl5JyxcbiAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV4dEZvcm1FbGVtZW50KCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gbmV4dEZvcm1FbGVtZW50KCkge1xuICAgIHZhciAkZGF0ZUlucHV0ID0gJCgnI3JlbGVhc2VEYXRlJyk7XG5cbiAgICBpZiAoJGRhdGVJbnB1dC5uZXh0VW50aWwoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBidXR0b24nKS5sZW5ndGgpIHtcbiAgICAgICAgJGRhdGVJbnB1dC5uZXh0VW50aWwoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBidXR0b24nKS5mb2N1cygpO1xuICAgICAgICBjb25zb2xlLmxvZygnc2libGluZycsICRkYXRlSW5wdXQubmV4dFVudGlsKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSwgYnV0dG9uJykpO1xuICAgIH0gZWxzZSBpZiAoJGRhdGVJbnB1dC5jbG9zZXN0KCcuZWRpdGlvbicpLm5leHRVbnRpbCgnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEsIGJ1dHRvbicpLmxlbmd0aCkge1xuICAgICAgICAkZGF0ZUlucHV0LmNsb3Nlc3QoJy5lZGl0aW9uJykubmV4dFVudGlsKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSwgYnV0dG9uJykuZm9jdXMoKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3BhcmVudHMgc2libGluZycsICRkYXRlSW5wdXQuY2xvc2VzdCgnLmVkaXRpb24nKS5uZXh0VW50aWwoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBidXR0b24nKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ05vIGZvbGxvd2luZyBpbnB1dHMnKTtcbiAgICB9XG59XG4vKipcbiAqIENyZWF0ZWQgYnkgY3Jpc3BpbiBvbiAxMC8xMi8yMDE1LlxuICovXG5mdW5jdGlvbiBsb2FkRW1iZWRJZnJhbWUob25TYXZlKSB7XG4gICAgLy8gYWRkIG1vZGFsIHdpbmRvd1xuICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZCh0ZW1wbGF0ZXMuZW1iZWRJZnJhbWUoKSk7XG5cbiAgICAvLyB2YXJpYWJsZXNcbiAgICB2YXIgbW9kYWwgPSAkKFwiLm1vZGFsXCIpO1xuXG4gICAgLy8gbW9kYWwgZnVuY3Rpb25zXG4gICAgZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcbiAgICAgICAgbW9kYWwucmVtb3ZlKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNhdmVVcmwoKSB7XG4gICAgICAgIHZhciBlbWJlZFVybCA9ICQoJ2lucHV0I2VtYmVkLXVybCcpLnZhbCgpO1xuICAgICAgICBpZiAoIWVtYmVkVXJsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk5vIHVybCBhZGRlZFwiKTtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1VSTCBmaWVsZCBpcyBlbXB0eScsICdQbGVhc2UgYWRkIGEgdXJsIGFuZCBzYXZlIGFnYWluJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvblNhdmUoJzxvbnMtaW50ZXJhY3RpdmUgdXJsPVwiJyArIGVtYmVkVXJsICsgJ1wiIC8+Jyk7XG4gICAgICAgICAgICBtb2RhbC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGJpbmQgZXZlbnRzXG4gICAgJCgnLmJ0bi1lbWJlZC1jYW5jZWwnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgY2xvc2VNb2RhbCgpO1xuICAgIH0pO1xuICAgICQoJy5idG4tZW1iZWQtc2F2ZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBzYXZlVXJsKCk7XG4gICAgfSk7XG4gICAgbW9kYWwua2V5dXAoZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDI3KSB7IC8vY2xvc2Ugb24gZXNjIGtleVxuICAgICAgICAgICAgY2xvc2VNb2RhbCgpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAxMykgeyAvL3NhdmUgb24gZW50ZXIga2V5XG4gICAgICAgICAgICBzYXZlVXJsKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1mdW5jdGlvbiBsb2FkRXF1YXRpb25CdWlsZGVyKHBhZ2VEYXRhLCBvblNhdmUsIGVxdWF0aW9uKSB7XG4gIHZhciBlcXVhdGlvbiA9IGVxdWF0aW9uO1xuICB2YXIgcGFnZVVybCA9IHBhZ2VEYXRhLnVyaTtcbiAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuZXF1YXRpb25CdWlsZGVyKGVxdWF0aW9uKTtcblxuICB2YXIgcmVuZGVyaW5nUHJldmlldyA9IGZhbHNlO1xuXG4gICQoJ2JvZHknKS5hcHBlbmQoaHRtbCk7XG4gICQoJy5qcy1lcXVhdGlvbi1idWlsZGVyJykuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xuXG4gICQoJy5idG4tZXF1YXRpb24tYnVpbGRlci1jYW5jZWwnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmpzLWVxdWF0aW9uLWJ1aWxkZXInKS5zdG9wKCkuZmFkZU91dCgyMDApLnJlbW92ZSgpO1xuICB9KTtcblxuICAvLyBpZiBlZGl0aW5nIGV4aXN0aW5nIGVxdWF0aW9uIHJlbmRlciBwcmV2aWV3IHN0cmFpZ2h0IGF3YXlcbiAgaWYgKGVxdWF0aW9uKSB7XG4gICAgdmFyIGNvbnRlbnRTdHIgPSBlcXVhdGlvbi5jb250ZW50O1xuICAgIHJlbmRlclByZXZpZXcoY29udGVudFN0cik7XG4gIH1cblxuICAvLyBvbiBjaGFuZ2Ugb2YgY29udGVudCBmaWxlZCByZS1yZW5kZXIgcHJldmlld1xuICB2YXIgdGltZW91dDtcbiAgJCgnI2VxdWF0aW9uLWNvbnRlbnQnKS5rZXl1cChmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoIXJlbmRlcmluZ1ByZXZpZXcpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgIHZhciBjb250ZW50U3RyID0gJCh0aGlzKS52YWwoKTtcbiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVuZGVyUHJldmlldyhjb250ZW50U3RyKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuXG4gIH0pO1xuXG5cbiAgLy8gc2F2ZSBlcXVhdGlvblxuICAkKCcuYnRuLWVxdWF0aW9uLWJ1aWxkZXItY3JlYXRlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXG4gICAgZXF1YXRpb24gPSBidWlsZEVxdWF0aW9uT2JqZWN0KCk7XG5cbiAgICB2YXIganNvblBhdGggPSBlcXVhdGlvbi51cmkgKyBcIi5qc29uXCI7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogXCIvemViZWRlZS9lcXVhdGlvbi9cIiArIEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQgKyBcIj91cmk9XCIgKyBqc29uUGF0aCxcbiAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGVxdWF0aW9uKSxcbiAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaWYgKCFwYWdlRGF0YS5lcXVhdGlvbnMpIHtcbiAgICAgICAgICBwYWdlRGF0YS5lcXVhdGlvbnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGV4aXN0aW5nRXF1YXRpb24gPSBfLmZpbmQocGFnZURhdGEuZXF1YXRpb25zLCBmdW5jdGlvbiAoZXhpc3RpbmdFcXVhdGlvbikge1xuICAgICAgICAgIHJldHVybiBleGlzdGluZ0VxdWF0aW9uLmZpbGVuYW1lID09PSBlcXVhdGlvbi5maWxlbmFtZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nRXF1YXRpb24pIHtcbiAgICAgICAgICBleGlzdGluZ0VxdWF0aW9uLnRpdGxlID0gZXF1YXRpb24udGl0bGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFnZURhdGEuZXF1YXRpb25zLnB1c2goe1xuICAgICAgICAgICAgdGl0bGU6IGVxdWF0aW9uLnRpdGxlLFxuICAgICAgICAgICAgZmlsZW5hbWU6IGVxdWF0aW9uLmZpbGVuYW1lLFxuICAgICAgICAgICAgdXJpOiBlcXVhdGlvbi51cmlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvblNhdmUpIHtcbiAgICAgICAgICBvblNhdmUoZXF1YXRpb24uZmlsZW5hbWUsICc8b25zLWVxdWF0aW9uIHBhdGg9XCInICsgZXF1YXRpb24uZmlsZW5hbWUgKyAnXCIgLz4nKTtcbiAgICAgICAgfVxuICAgICAgICAkKCcuanMtZXF1YXRpb24tYnVpbGRlcicpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgICAgIHJlZnJlc2hFcXVhdGlvbnNMaXN0KEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQsIHBhZ2VEYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gYnVpbGRFcXVhdGlvbk9iamVjdCgpIHtcbiAgICBpZiAoIWVxdWF0aW9uKSB7XG4gICAgICBlcXVhdGlvbiA9IHt9O1xuICAgIH1cblxuICAgIGVxdWF0aW9uLnR5cGUgPSBcImVxdWF0aW9uXCI7XG4gICAgZXF1YXRpb24uZmlsZW5hbWUgPSBlcXVhdGlvbi5maWxlbmFtZSA/IGVxdWF0aW9uLmZpbGVuYW1lIDogU3RyaW5nVXRpbHMucmFuZG9tSWQoKTtcbiAgICBlcXVhdGlvbi51cmkgPSBwYWdlVXJsICsgXCIvXCIgKyBlcXVhdGlvbi5maWxlbmFtZTtcbiAgICBlcXVhdGlvbi50aXRsZSA9ICQoJyNlcXVhdGlvbi10aXRsZScpLnZhbCgpO1xuICAgIGVxdWF0aW9uLmNvbnRlbnQgPSAkKCcjZXF1YXRpb24tY29udGVudCcpLnZhbCgpO1xuXG4gICAgcmV0dXJuIGVxdWF0aW9uO1xuICB9XG5cblxuICBmdW5jdGlvbiByZW5kZXJQcmV2aWV3KGNvbnRlbnQpIHtcbiAgICByZW5kZXJpbmdQcmV2aWV3ID0gdHJ1ZTtcbiAgICB2YXIgc3ZnO1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6IFwiL3plYmVkZWUvZXF1YXRpb25wcmV2aWV3L1wiLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgY29udGVudFR5cGU6ICd0ZXh0L3BsYWluJyxcbiAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoY29udGVudCksXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBzdmcgPSBkYXRhO1xuICAgICAgICAkKFwiLmpzLWVxdWF0aW9uLXByZXZpZXdcIikuaHRtbChzdmcpO1xuICAgICAgICByZW5kZXJpbmdQcmV2aWV3ID0gZmFsc2U7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVuZGVyaW5nUHJldmlldyA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn0vLyBmdWxseSBsb2FkIHRoZSBlcXVhdGlvbnMgbGlzdCBmcm9tIHNjcmF0Y2hcbmZ1bmN0aW9uIGxvYWRFcXVhdGlvbnNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0RXF1YXRpb25zKGRhdGEpO1xuICAgICQoJyNlcXVhdGlvbnMnKS5yZXBsYWNlV2l0aChodG1sKTtcbiAgICBpbml0aWFsaXNlRXF1YXRpb25MaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgaW5pdGlhbGlzZUNsaXBib2FyZCgpO1xufVxuXG4vLyByZWZyZXNoIG9ubHkgdGhlIGxpc3Qgb2YgZXF1YXRpb25zIC0gbGVhdmluZyB0aGUgY29udGFpbmVyIGRpdiB0aGF0IGFjY29yZGlvbiB3b3JrcyBmcm9tLlxuZnVuY3Rpb24gcmVmcmVzaEVxdWF0aW9uc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKSB7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRFcXVhdGlvbnMoZGF0YSk7XG4gICAgJCgnI2VxdWF0aW9uLWxpc3QnKS5yZXBsYWNlV2l0aCgkKGh0bWwpLmZpbmQoJyNlcXVhdGlvbi1saXN0JykpO1xuICAgIGluaXRpYWxpc2VFcXVhdGlvbkxpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICBpbml0aWFsaXNlQ2xpcGJvYXJkKCk7XG59XG5cbi8vIGRvIGFsbCB0aGUgd2lyaW5nIHVwIG9mIGJ1dHRvbnMgZXRjIG9uY2UgdGhlIHRlbXBsYXRlIGhhcyBiZWVuIHJlbmRlcmVkLlxuZnVuY3Rpb24gaW5pdGlhbGlzZUVxdWF0aW9uTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICAgICQoJyNhZGQtZXF1YXRpb24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRFcXVhdGlvbkJ1aWxkZXIoZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoKTtcblxuICAgICAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZWZyZXNoUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICByZWZyZXNoRXF1YXRpb25zTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJChkYXRhLmVxdWF0aW9ucykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVxdWF0aW9uKSB7XG5cbiAgICAgICAgdmFyIGJhc2VQYXRoID0gZGF0YS51cmk7XG4gICAgICAgIHZhciBlcXVhdGlvblBhdGggPSBiYXNlUGF0aCArICcvJyArIGVxdWF0aW9uLmZpbGVuYW1lO1xuICAgICAgICB2YXIgZXF1YXRpb25Kc29uID0gZXF1YXRpb25QYXRoO1xuXG4gICAgICAgICQoXCIjZXF1YXRpb24tZWRpdF9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRQYWdlRGF0YShjb2xsZWN0aW9uSWQsIGVxdWF0aW9uSnNvbixcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3MgPSBmdW5jdGlvbiAoZXF1YXRpb25EYXRhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbG9hZEVxdWF0aW9uQnVpbGRlcihkYXRhLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoUHJldmlldygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgYmFzZVBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hFcXVhdGlvbkxpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9LCBlcXVhdGlvbkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjZXF1YXRpb24tZGVsZXRlX1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBlcXVhdGlvbj9cIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLmVxdWF0aW9ucyA9IF8oZGF0YS5lcXVhdGlvbnMpLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZmlsZW5hbWUgIT09IGVxdWF0aW9uLmZpbGVuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgYmFzZVBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVFcXVhdGlvbihjb2xsZWN0aW9uSWQsIGVxdWF0aW9uSnNvbiwgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9uRXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgZXF1YXRpb24gaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoRXF1YXRpb25zTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyBNYWtlIHNlY3Rpb25zIHNvcnRhYmxlXG4gICAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgICAgICQoJyNzb3J0YWJsZS1lcXVhdGlvbicpLnNvcnRhYmxlKCk7XG4gICAgfVxuXG4gICAgc29ydGFibGUoKTtcbn1cblxuXG4vKipcbiAqIExvYWQgdGhlIGltYWdlIGJ1aWxkZXIgc2NyZWVuLiBUaGlzIHNjcmVlbiBpcyBmb3IgYWRkaW5nIGltYWdlcyB0aGF0IGNhbm5vdCBiZSBidWlsdCB1c2luZyB0aGUgY2hhcnRcbiAqIGJ1aWxkZXIsIGhlbmNlIHRoZSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgaW4gdGhlIGJ1aWxkZXIgdGhhdCBpbWl0YXRlIGEgY2hhcnQuXG4gKiBAcGFyYW0gcGFnZURhdGEgLSBUaGUgZGF0YSBmb3IgdGhlIHBhZ2UgdGhlIGltYWdlIGlzIGJlaW5nIGFkZGVkIHRvLlxuICogQHBhcmFtIG9uU2F2ZSAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGltYWdlIGlzIHNhdmVkIGFuZCB0aGUgaW1hZ2UgYnVpbGRlciBpcyBjbG9zZWQuXG4gKiBAcGFyYW0gaW1hZ2UgLSBUaGUgZXhpc3RpbmcgaW1hZ2Ugb2JqZWN0IGlmIGFuIGV4aXN0aW5nIGltYWdlIGlzIGJlaW5nIGVkaXRlZC5cbiAqL1xuZnVuY3Rpb24gbG9hZEltYWdlQnVpbGRlcihwYWdlRGF0YSwgb25TYXZlLCBpbWFnZSkge1xuICB2YXIgcGFnZVVybCA9IHBhZ2VEYXRhLnVyaTtcbiAgdmFyIHByZXZpZXdJbWFnZTtcblxuICAvLyByZW5kZXIgdGhlIHRlbXBsYXRlIGZvciB0aGUgaW1hZ2UgYnVpbGRlciBzY3JlZW5cbiAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMuaW1hZ2VCdWlsZGVyKGltYWdlKTtcbiAgJCgnYm9keScpLmFwcGVuZChodG1sKTtcblxuICAvLyBUaGUgZmlsZXMgdXBsb2FkZWQgYXMgcGFydCBvZiB0aGUgaW1hZ2UgY3JlYXRpb24gYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBvbiB0aGUgaW1hZ2Ugb2JqZWN0LlxuICAvLyBUaGVzZSBrZXlzIGlkZW50aWZ5IHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgZmlsZXMgdGhhdCBjYW4gYmUgYWRkZWQuXG4gIHZhciBpbWFnZUZpbGVLZXkgPSBcInVwbG9hZGVkLWltYWdlXCI7IC8vIFRoZSBhY3R1YWwgaW1hZ2Ugc2hvd24gb24gc2NyZWVuXG4gIHZhciBkYXRhRmlsZUtleSA9IFwidXBsb2FkZWQtZGF0YVwiOyAvLyBUaGUgYXNzb2NpYXRlZCBkYXRhIGZpbGUgZm9yIHRoZSBpbWFnZS5cblxuICAvLyBpZiB3ZSBhcmUgcGFzc2luZyBhbiBleGlzdGluZyBpbWFnZSB0byB0aGUgYnVpbGRlciwgZ28gYWhlYWQgYW5kIHNob3cgaXQuXG4gIGlmIChpbWFnZSkge1xuICAgIHJlbmRlckltYWdlKGdldEltYWdlVXJpKGltYWdlKSk7XG4gICAgcmVuZGVyVGV4dCgpO1xuICB9XG5cbiAgLy8gSWYgYW55IHRleHQgZmllbGRzIG9uIHRoZSBmb3JtIGFyZSBjaGFuZ2VkLCB1cGRhdGUgdGhlbS5cbiAgJCgnLnJlZnJlc2gtdGV4dCcpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICByZW5kZXJUZXh0KCk7XG4gIH0pO1xuXG4gICQoJyN1cGxvYWQtaW1hZ2UtZm9ybScpLnN1Ym1pdChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCQodGhpcylbMF0pO1xuICAgIHZhciBmaWxlID0gdGhpc1swXS5maWxlc1swXTtcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHN3ZWV0QWxlcnQoJ1BsZWFzZSBzZWxlY3QgYSBmaWxlIHRvIHVwbG9hZC4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIS9cXC5wbmd8LmpwZWckfC5qcGckfC8udGVzdChmaWxlKSkge1xuICAgICAgc3dlZXRBbGVydCgnVGhlIGRhdGEgZmlsZSB1cGxvYWQgaXMgbGltaXRlZCB0byBQTkcgYW5kIEpQRUcuJywgXCJcIiwgXCJpbmZvXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBmaWxlRXh0ZW5zaW9uID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gICAgcHJldmlld0ltYWdlID0gYnVpbGRKc29uT2JqZWN0RnJvbUZvcm0ocHJldmlld0ltYWdlKTtcbiAgICB2YXIgaW1hZ2VQYXRoID0gcHJldmlld0ltYWdlLnVyaSArICcuJyArIGZpbGVFeHRlbnNpb247XG4gICAgdmFyIGltYWdlRmlsZU5hbWUgPSBwcmV2aWV3SW1hZ2UuZmlsZW5hbWUgKyAnLicgKyBmaWxlRXh0ZW5zaW9uO1xuICAgIHZhciBmaWxlRXhpc3RzID0gZ2V0RXhpc3RpbmdGaWxlTmFtZShwcmV2aWV3SW1hZ2UsIGltYWdlRmlsZUtleSk7XG5cbiAgICB1cGxvYWRGaWxlKFxuICAgICAgaW1hZ2VQYXRoLFxuICAgICAgZm9ybURhdGEsXG4gICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWZpbGVFeGlzdHMpIHtcbiAgICAgICAgICBwcmV2aWV3SW1hZ2UuZmlsZXMucHVzaCh7dHlwZTogaW1hZ2VGaWxlS2V5LCBmaWxlbmFtZTogaW1hZ2VGaWxlTmFtZSwgZmlsZVR5cGU6IGZpbGVFeHRlbnNpb259KTtcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJJbWFnZShnZXRJbWFnZVVyaShwcmV2aWV3SW1hZ2UpKTtcbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxuICAkKCcjdXBsb2FkLWRhdGEtZm9ybScpLnN1Ym1pdChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAkKHRoaXMpLmZpbmQoJzpzdWJtaXQnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoJCh0aGlzKVswXSk7XG4gICAgdmFyIGZpbGUgPSB0aGlzWzBdLmZpbGVzWzBdO1xuICAgIGlmICghZmlsZSkge1xuICAgICAgc3dlZXRBbGVydCgnUGxlYXNlIHNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkLicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghL1xcLmNzdiR8LnhscyR8Lnhsc3gkfC8udGVzdChmaWxlKSkge1xuICAgICAgc3dlZXRBbGVydCgnVGhlIGRhdGEgZmlsZSB1cGxvYWQgaXMgbGltaXRlZCB0byBDU1YsIFhMUywgb3IgWExTWC4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgIHByZXZpZXdJbWFnZSA9IGJ1aWxkSnNvbk9iamVjdEZyb21Gb3JtKHByZXZpZXdJbWFnZSk7XG4gICAgdmFyIGZpbGVQYXRoID0gcHJldmlld0ltYWdlLnVyaSArICcuJyArIGZpbGVFeHRlbnNpb247XG4gICAgdmFyIGZpbGVOYW1lID0gcHJldmlld0ltYWdlLmZpbGVuYW1lICsgJy4nICsgZmlsZUV4dGVuc2lvbjtcbiAgICB2YXIgZmlsZUV4aXN0cyA9IGdldEV4aXN0aW5nRmlsZU5hbWUocHJldmlld0ltYWdlLCBkYXRhRmlsZUtleSk7XG5cbiAgICB1cGxvYWRGaWxlKFxuICAgICAgZmlsZVBhdGgsXG4gICAgICBmb3JtRGF0YSxcbiAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghZmlsZUV4aXN0cykge1xuICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgdGl0bGU6IFwiVXBsb2FkIGNvbXBsZXRlXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIlVwbG9hZCBjb21wbGV0ZVwiLFxuICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHByZXZpZXdJbWFnZS5maWxlcy5wdXNoKHt0eXBlOiBkYXRhRmlsZUtleSwgZmlsZW5hbWU6IGZpbGVOYW1lLCBmaWxlVHlwZTogZmlsZUV4dGVuc2lvbn0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG5cblxuICBmdW5jdGlvbiBtYXBJbWFnZUpzb25WYWx1ZXMoZnJvbSwgdG8pIHtcbiAgICB0byA9IGJ1aWxkSnNvbk9iamVjdEZyb21Gb3JtKHRvKTtcblxuICAgICQoZnJvbS5maWxlcykuZWFjaChmdW5jdGlvbiAoZnJvbUluZGV4LCBmcm9tRmlsZSkge1xuICAgICAgdmFyIGZpbGVFeGlzdHNJbkltYWdlID0gZmFsc2U7XG5cbiAgICAgICQodG8uZmlsZXMpLmVhY2goZnVuY3Rpb24gKHRvSW5kZXgsIHRvRmlsZSkge1xuICAgICAgICBpZiAoZnJvbUZpbGUudHlwZSA9PSB0b0ZpbGUudHlwZSkge1xuICAgICAgICAgIGZpbGVFeGlzdHNJbkltYWdlID0gdHJ1ZTtcbiAgICAgICAgICB0b0ZpbGUuZmlsZU5hbWUgPSBmcm9tRmlsZS5maWxlTmFtZTtcbiAgICAgICAgICB0b0ZpbGUuZmlsZVR5cGUgPSBmcm9tRmlsZS5maWxlVHlwZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZmlsZUV4aXN0c0luSW1hZ2UpIHtcbiAgICAgICAgdG8uZmlsZXMucHVzaChmcm9tRmlsZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdG87XG4gIH1cblxuICAkKCcuYnRuLWltYWdlLWJ1aWxkZXItY3JlYXRlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXG4gICAgcHJldmlld0ltYWdlID0gYnVpbGRKc29uT2JqZWN0RnJvbUZvcm0ocHJldmlld0ltYWdlKTtcblxuICAgIGlmICghcHJldmlld0ltYWdlLnRpdGxlKSB7XG4gICAgICBzd2VldEFsZXJ0KFwiUGxlYXNlIGVudGVyIGEgdGl0bGUgZm9yIHRoZSBpbWFnZS5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGltYWdlRmlsZU5hbWUgPSBnZXRFeGlzdGluZ0ZpbGVOYW1lKHByZXZpZXdJbWFnZSwgaW1hZ2VGaWxlS2V5KTtcbiAgICBpZiAoIWltYWdlRmlsZU5hbWUgJiYgaW1hZ2UpXG4gICAgICBpbWFnZUZpbGVOYW1lID0gZ2V0RXhpc3RpbmdGaWxlTmFtZShpbWFnZSwgaW1hZ2VGaWxlS2V5KTtcbiAgICBpZiAoIWltYWdlRmlsZU5hbWUpIHtcbiAgICAgIHN3ZWV0QWxlcnQoXCJQbGVhc2UgdXBsb2FkIGFuIGltYWdlXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBpbWFnZUV4aXN0cyA9IGZhbHNlO1xuICAgIGlmIChpbWFnZSkge1xuICAgICAgaW1hZ2VFeGlzdHMgPSB0cnVlO1xuICAgICAgLy8gbWFwIHByZXZpZXcgaW1hZ2UgdmFsdWVzIG9udG8gaW1hZ2VcbiAgICAgIGltYWdlID0gbWFwSW1hZ2VKc29uVmFsdWVzKHByZXZpZXdJbWFnZSwgaW1hZ2UpO1xuICAgIH0gZWxzZSB7IC8vIGp1c3QgdXNlIHRoZSBwcmV2aWV3IGZpbGVzXG4gICAgICBpbWFnZSA9IHByZXZpZXdJbWFnZTtcbiAgICAgIGFkZEltYWdlVG9QYWdlSnNvbihpbWFnZSk7XG4gICAgfVxuXG4gICAgc2F2ZUltYWdlSnNvbihpbWFnZSwgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgLy8gaWYgdGhlcmUgaXMgYW4gaW1hZ2UgdGhhdCBleGlzdHMgYWxyZWFkeSwgb3ZlcndyaXRlIGl0LlxuICAgICAgaWYgKGltYWdlRXhpc3RzKSB7XG4gICAgICAgICQocHJldmlld0ltYWdlLmZpbGVzKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZmlsZSkge1xuICAgICAgICAgIHZhciBmcm9tRmlsZSA9IHBhZ2VVcmwgKyAnLycgKyBmaWxlLmZpbGVuYW1lO1xuICAgICAgICAgIHZhciB0b0ZpbGUgPSBwYWdlVXJsICsgJy8nICsgZmlsZS5maWxlbmFtZS5yZXBsYWNlKHByZXZpZXdJbWFnZS5maWxlbmFtZSwgaW1hZ2UuZmlsZW5hbWUpO1xuICAgICAgICAgIGlmIChmcm9tRmlsZSAhPSB0b0ZpbGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibW92aW5nLi4uIHRhYmxlIGZpbGU6IFwiICsgZnJvbUZpbGUgKyBcIiB0bzogXCIgKyB0b0ZpbGUpO1xuICAgICAgICAgICAgcmVuYW1lQ29udGVudChGbG9yZW5jZS5jb2xsZWN0aW9uLmlkLCBmcm9tRmlsZSwgdG9GaWxlLFxuICAgICAgICAgICAgICBvblN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJNb3ZlZCB0YWJsZSBmaWxlOiBcIiArIGZyb21GaWxlICsgXCIgdG86IFwiICsgdG9GaWxlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9uU2F2ZSkge1xuICAgICAgICBvblNhdmUoaW1hZ2UuZmlsZW5hbWUsICc8b25zLWltYWdlIHBhdGg9XCInICsgaW1hZ2UuZmlsZW5hbWUgKyAnXCIgLz4nLCBwYWdlRGF0YSk7XG4gICAgICB9XG4gICAgICBjbG9zZUltYWdlQnVpbGRlclNjcmVlbigpO1xuICAgIH0pO1xuICB9KTtcblxuICAkKCcuYnRuLWltYWdlLWJ1aWxkZXItY2FuY2VsJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXG4gICAgY2xvc2VJbWFnZUJ1aWxkZXJTY3JlZW4oKTtcblxuICAgIGlmIChwcmV2aWV3SW1hZ2UpIHtcbiAgICAgICQocHJldmlld0ltYWdlLmZpbGVzKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZmlsZSkge1xuXG4gICAgICAgIHZhciBmaWxlVG9EZWxldGUgPSBwYWdlVXJsICsgJy8nICsgZmlsZS5maWxlbmFtZTtcbiAgICAgICAgZGVsZXRlQ29udGVudChGbG9yZW5jZS5jb2xsZWN0aW9uLmlkLCBmaWxlVG9EZWxldGUsXG4gICAgICAgICAgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkZWxldGVkIGltYWdlIGZpbGU6IFwiICsgZmlsZVRvRGVsZXRlKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gY2xvc2VJbWFnZUJ1aWxkZXJTY3JlZW4oKSB7XG4gICAgJCgnLmltYWdlLWJ1aWxkZXInKS5zdG9wKCkuZmFkZU91dCgyMDApLnJlbW92ZSgpO1xuICB9XG5cbiAgc2V0U2hvcnRjdXRzKCcjaW1hZ2UtdGl0bGUnKTtcbiAgc2V0U2hvcnRjdXRzKCcjaW1hZ2Utc3VidGl0bGUnKTtcblxuICBmdW5jdGlvbiByZW5kZXJUZXh0KCkge1xuICAgIHZhciB0aXRsZSA9IGRvU3VwZXJzY3JpcHRBbmRTdWJzY3JpcHQoJCgnI2ltYWdlLXRpdGxlJykudmFsKCkpO1xuICAgIHZhciBzdWJ0aXRsZSA9IGRvU3VwZXJzY3JpcHRBbmRTdWJzY3JpcHQoJCgnI2ltYWdlLXN1YnRpdGxlJykudmFsKCkpO1xuICAgICQoJyNpbWFnZS10aXRsZS1wcmV2aWV3JykuaHRtbCh0aXRsZSk7XG4gICAgJCgnI2ltYWdlLXN1YnRpdGxlLXByZXZpZXcnKS5odG1sKHN1YnRpdGxlKTtcbiAgICAkKCcjaW1hZ2Utc291cmNlLXByZXZpZXcnKS5odG1sKCQoJyNpbWFnZS1zb3VyY2UnKS52YWwoKSk7XG4gICAgJCgnI2ltYWdlLW5vdGVzLXByZXZpZXcnKS5odG1sKHRvTWFya2Rvd24oJCgnI2ltYWdlLW5vdGVzJykudmFsKCkpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckltYWdlKGltYWdlVXJpKSB7XG4gICAgdmFyIGlmcmFtZU1hcmt1cCA9ICc8aWZyYW1lIGlkPVwicHJldmlldy1mcmFtZVwiIGZyYW1lQm9yZGVyID1cIjBcIiBzY3JvbGxpbmcgPSBcInllc1wiIHNyYz1cIicgKyAnL3plYmVkZWUvcmVzb3VyY2UvJyArIEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQgKyAnP3VyaT0nICsgaW1hZ2VVcmkgKyAnXCI+PC9pZnJhbWU+JztcbiAgICAkKCcjaW1hZ2UnKS5odG1sKGlmcmFtZU1hcmt1cCk7XG4gICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aWV3LWZyYW1lJyk7XG4gICAgaWZyYW1lLmhlaWdodCA9IFwiNTAwcHhcIjtcbiAgICBpZnJhbWUud2lkdGggPSBcIjEwMCVcIjtcbiAgICBzZXRUaW1lb3V0KFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICBib2R5ID0gJCgnI3ByZXZpZXctZnJhbWUnKS5jb250ZW50cygpLmZpbmQoJ2JvZHknKTtcbiAgICAgICAgJChib2R5KS5jaGlsZHJlbigpLmNzcygnaGVpZ2h0JywgJzEwMCUnKTtcbiAgICAgIH0sIDEwMCk7XG4gIH1cblxuICBmdW5jdGlvbiB0b01hcmtkb3duKHRleHQpIHtcbiAgICBpZiAodGV4dCAmJiBpc01hcmtkb3duQXZhaWxhYmxlKSB7XG4gICAgICB2YXIgY29udmVydGVyID0gbmV3IE1hcmtkb3duLmdldFNhbml0aXppbmdDb252ZXJ0ZXIoKTtcbiAgICAgIE1hcmtkb3duLkV4dHJhLmluaXQoY29udmVydGVyLCB7XG4gICAgICAgIGV4dGVuc2lvbnM6IFwiYWxsXCJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbnZlcnRlci5tYWtlSHRtbCh0ZXh0KVxuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBmdW5jdGlvbiBpc01hcmtkb3duQXZhaWxhYmxlKCkge1xuICAgIHJldHVybiB0eXBlb2YgTWFya2Rvd24gIT09ICd1bmRlZmluZWQnXG4gIH1cblxuICBmdW5jdGlvbiBkb1N1cGVyc2NyaXB0QW5kU3Vic2NyaXB0KHRleHQpIHtcbiAgICBpZiAodGV4dCAmJiBpc01hcmtkb3duQXZhaWxhYmxlKSB7XG4gICAgICB2YXIgY29udmVydGVyID0gbmV3IE1hcmtkb3duLkNvbnZlcnRlcigpO1xuICAgICAgcmV0dXJuIGNvbnZlcnRlci5fRG9TdWJzY3JpcHQoY29udmVydGVyLl9Eb1N1cGVyc2NyaXB0KHRleHQpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRleHQ7XG5cbiAgfVxuXG5cbiAgZnVuY3Rpb24gdXBsb2FkRmlsZShwYXRoLCBmb3JtRGF0YSwgc3VjY2Vzcykge1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6IFwiL3plYmVkZWUvY29udGVudC9cIiArIEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQgKyBcIj91cmk9XCIgKyBwYXRoLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgZGF0YTogZm9ybURhdGEsXG4gICAgICBhc3luYzogZmFsc2UsXG4gICAgICBjYWNoZTogZmFsc2UsXG4gICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgc3VjY2VzcygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRJbWFnZVVyaShpbWFnZSkge1xuICAgIGlmIChwYWdlVXJsID09PSAnLycpIHtcbiAgICAgIHJldHVybiAnLycgKyBnZXRJbWFnZUZpbGVuYW1lKGltYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHBhZ2VEYXRhLnVyaSArICcvJyArIGdldEltYWdlRmlsZW5hbWUoaW1hZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEltYWdlRmlsZW5hbWUoaW1hZ2UpIHtcbiAgICByZXR1cm4gZ2V0RXhpc3RpbmdGaWxlTmFtZShpbWFnZSwgaW1hZ2VGaWxlS2V5KVxuICB9XG5cbiAgLy8gZm9yIGFueSBmaWd1cmUgb2JqZWN0LCBpdGVyYXRlIHRoZSBmaWxlcyBhbmQgcmV0dXJuIHRoZSBmaWxlIHBhdGggZm9yIHRoZSBnaXZlbiBrZXkuXG4gIGZ1bmN0aW9uIGdldEV4aXN0aW5nRmlsZU5hbWUob2JqZWN0LCBrZXkpIHtcbiAgICB2YXIgcmVzdWx0O1xuICAgIF8uZWFjaChvYmplY3QuZmlsZXMsIGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICBpZiAoa2V5ID09PSBmaWxlLnR5cGUpIHtcbiAgICAgICAgcmVzdWx0ID0gZmlsZS5maWxlbmFtZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gc2F2ZUltYWdlSnNvbihpbWFnZSwgc3VjY2VzcywgZXJyb3IpIHtcbiAgICB2YXIgbm9FeHRlbnNpb24gPSBpbWFnZS51cmkubWF0Y2goL14oLis/KShcXC5bXi5dKiR8JCkvKTtcbiAgICB2YXIgaW1hZ2VKc29uID0gbm9FeHRlbnNpb25bMV0gKyBcIi5qc29uXCI7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsgaW1hZ2VKc29uLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoaW1hZ2UpLFxuICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBpZiAoc3VjY2VzcylcbiAgICAgICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZEltYWdlVG9QYWdlSnNvbihpbWFnZSkge1xuICAgIGlmICghcGFnZURhdGEuaW1hZ2VzKSB7XG4gICAgICBwYWdlRGF0YS5pbWFnZXMgPSBbXTtcbiAgICB9IGVsc2Uge1xuXG4gICAgICB2YXIgZXhpc3RpbmdJbWFnZSA9IF8uZmluZChwYWdlRGF0YS5pbWFnZXMsIGZ1bmN0aW9uIChleGlzdGluZ0ltYWdlKSB7XG4gICAgICAgIHJldHVybiBleGlzdGluZ0ltYWdlLmZpbGVuYW1lID09PSBpbWFnZS5maWxlbmFtZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXhpc3RpbmdJbWFnZSkge1xuICAgICAgICBleGlzdGluZ0ltYWdlLnRpdGxlID0gaW1hZ2UudGl0bGU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwYWdlRGF0YS5pbWFnZXMucHVzaCh7dGl0bGU6IGltYWdlLnRpdGxlLCBmaWxlbmFtZTogaW1hZ2UuZmlsZW5hbWUsIHVyaTogaW1hZ2UudXJpfSk7XG4gIH1cblxuICBmdW5jdGlvbiBidWlsZEpzb25PYmplY3RGcm9tRm9ybShpbWFnZSkge1xuICAgIGlmICghaW1hZ2UpIHtcbiAgICAgIGltYWdlID0ge307XG4gICAgfVxuXG4gICAgaW1hZ2UudHlwZSA9IFwiaW1hZ2VcIjtcbiAgICAvLyBnaXZlIHRoZSBpbWFnZSBhIHVuaXF1ZSBJRCBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGhhdmUgb25lLlxuICAgIGltYWdlLmZpbGVuYW1lID0gaW1hZ2UuZmlsZW5hbWUgPyBpbWFnZS5maWxlbmFtZSA6IFN0cmluZ1V0aWxzLnJhbmRvbUlkKCk7XG4gICAgaW1hZ2UudGl0bGUgPSAkKCcjaW1hZ2UtdGl0bGUnKS52YWwoKTtcbiAgICBpZiAocGFnZVVybCA9PT0gJy8nKSB7XG4gICAgICBpbWFnZS51cmkgPSBcIi9cIiArIGltYWdlLmZpbGVuYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbWFnZS51cmkgPSBwYWdlVXJsICsgXCIvXCIgKyBpbWFnZS5maWxlbmFtZTtcbiAgICB9XG4gICAgaW1hZ2Uuc3VidGl0bGUgPSAkKCcjaW1hZ2Utc3VidGl0bGUnKS52YWwoKTtcbiAgICBpbWFnZS5zb3VyY2UgPSAkKCcjaW1hZ2Utc291cmNlJykudmFsKCk7XG4gICAgaW1hZ2Uubm90ZXMgPSAkKCcjaW1hZ2Utbm90ZXMnKS52YWwoKTtcbiAgICBpbWFnZS5hbHRUZXh0ID0gJCgnI2ltYWdlLWFsdC10ZXh0JykudmFsKCk7XG5cbiAgICBpZiAoIWltYWdlLmZpbGVzKSB7XG4gICAgICBpbWFnZS5maWxlcyA9IFtdO1xuICAgIH1cblxuICAgIHJldHVybiBpbWFnZTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIGxvYWRJbWFnZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0SW1hZ2VzKGRhdGEpO1xuICAgICQoJyNpbWFnZXMnKS5yZXBsYWNlV2l0aChodG1sKTtcbiAgICBpbml0aWFsaXNlSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgIGluaXRpYWxpc2VDbGlwYm9hcmQoKTtcbn1cblxuZnVuY3Rpb24gcmVmcmVzaEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKSB7XG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRJbWFnZXMoZGF0YSk7XG4gICAgJCgnI2ltYWdlLWxpc3QnKS5yZXBsYWNlV2l0aCgkKGh0bWwpLmZpbmQoJyNpbWFnZS1saXN0JykpO1xuICAgIGluaXRpYWxpc2VJbWFnZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgaW5pdGlhbGlzZUNsaXBib2FyZCgpO1xufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICAgICQoJyNhZGQtaW1hZ2UnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRJbWFnZUJ1aWxkZXIoZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlZnJlc2hJbWFnZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgJChkYXRhLmltYWdlcykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGltYWdlKSB7XG4gICAgICAgIHZhciBiYXNlUGF0aCA9IGRhdGEudXJpO1xuICAgICAgICB2YXIgbm9FeHRlbnNpb24gPSBpbWFnZS51cmkubWF0Y2goL14oLis/KShcXC5bXi5dKiR8JCkvKTtcbiAgICAgICAgdmFyIGltYWdlSnNvbiA9IG5vRXh0ZW5zaW9uWzFdICsgJy5qc29uJztcblxuICAgICAgICAkKFwiI2ltYWdlLWVkaXRfXCIgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0UGFnZVJlc291cmNlKGNvbGxlY3Rpb25JZCwgaW1hZ2VKc29uLFxuICAgICAgICAgICAgICAgIG9uU3VjY2VzcyA9IGZ1bmN0aW9uIChpbWFnZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZEltYWdlQnVpbGRlcihkYXRhLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9yZWZyZXNoUHJldmlldygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgaW1hZ2VEYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiI2ltYWdlLWRlbGV0ZV9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgaW1hZ2U/XCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGFueSBmaWxlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGltYWdlLlxuICAgICAgICAgICAgICAgICAgICBnZXRQYWdlUmVzb3VyY2UoY29sbGVjdGlvbklkLCBpbWFnZUpzb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3MgPSBmdW5jdGlvbiAoaW1hZ2VEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGltYWdlRGF0YS5maWxlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goaW1hZ2VEYXRhLmZpbGVzLCBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVVcmkgPSBiYXNlUGF0aCArICcvJyArIGZpbGUuZmlsZW5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdkZWxldGluZyAnICsgZmlsZVVyaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZmlsZVVyaSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2RlbGV0aW5nICcgKyBpbWFnZS51cmkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgaW1hZ2UudXJpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIGltYWdlIGZyb20gdGhlIHBhZ2UganNvbiB3aGVuIGl0cyBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW1hZ2VzID0gXyhkYXRhLmltYWdlcykuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5maWxlbmFtZSAhPT0gaW1hZ2UuZmlsZW5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgdGhlIHVwZGF0ZWQgcGFnZSBqc29uXG4gICAgICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBiYXNlUGF0aCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgaW1hZ2UgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hJbWFnZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgdGhlIGltYWdlIGpzb24gZmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBpbWFnZUpzb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDQwNClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyBNYWtlIHNlY3Rpb25zIHNvcnRhYmxlXG4gICAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgICAgICQoJyNzb3J0YWJsZS1pbWFnZScpLnNvcnRhYmxlKCk7XG4gICAgfVxuXG4gICAgc29ydGFibGUoKTtcbn1cbmZ1bmN0aW9uIGxvYWRJbXBvcnRTY3JlZW4gKGNvbGxlY3Rpb25JZCkge1xuXG4gIGdldENvbGxlY3Rpb24oY29sbGVjdGlvbklkLFxuICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoY29sbGVjdGlvbikge1xuICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0ltcG9ydDtcbiAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG5cbiAgICAgICQoJyNVcGxvYWRGb3JtJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuICAgICAgICB2YXIgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTtcblxuICAgICAgICBmdW5jdGlvbiBzaG93VXBsb2FkZWRJdGVtKHNvdXJjZSkge1xuICAgICAgICAgICQoJyNsaXN0JykuYXBwZW5kKHNvdXJjZSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZmlsZSA9IHRoaXNbMF0uZmlsZXNbMF07XG4gICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgIHN3ZWV0QWxlcnQoXCJQbGVhc2Ugc2VsZWN0IGEgZmlsZSB0byB1cGxvYWRcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNwb25zZVwiKS5pbm5lckhUTUwgPSBcIlVwbG9hZGluZyAuIC4gLlwiO1xuXG4gICAgICAgIHZhciBmaWxlTmFtZU5vU3BhY2UgPSBmaWxlLm5hbWUucmVwbGFjZSgvW15hLXpBLVowLTlcXC5dL2csIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciB1cmlVcGxvYWQgPSBcIi9cIiArIGZpbGVOYW1lTm9TcGFjZTtcblxuICAgICAgICAvLyBjaGVjayBpZiB0aGUgZmlsZSBhbHJlYWR5IGV4aXN0cy5cbiAgICAgICAgLy9pZiAoZGF0YVtmaWVsZF0gJiYgZGF0YVtmaWVsZF0ubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaSwgZmlsZXNVcGxvYWRlZCkge1xuICAgICAgICAvLyAgICBpZiAoZmlsZXNVcGxvYWRlZC5maWxlID09PSBmaWxlTmFtZU5vU3BhY2UgfHwgZmlsZXNVcGxvYWRlZC5maWxlID09PSBmaWxlTmFtZU5vU3BhY2UgKSB7XG4gICAgICAgIC8vICAgICAgc3dlZXRBbGVydCgnVGhpcyBmaWxlIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgICAgIC8vICAgICAgJCgnIycgKyBsYXN0SW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAvLyAgICAgIGZvcm1kYXRhID0gZmFsc2U7ICAvLyBpZiBub3QgcHJlc2VudCB0aGUgZXhpc3RpbmcgZmlsZSB3YXMgYmVpbmcgb3ZlcndyaXR0ZW5cbiAgICAgICAgLy8gICAgICByZXR1cm47XG4gICAgICAgIC8vICAgIH1cbiAgICAgICAgLy8gIH0pO1xuICAgICAgICAvL31cblxuICAgICAgICBpZiAoZmlsZS5uYW1lLm1hdGNoKFwiLmNzdlwiKSkge1xuICAgICAgICAgIHNob3dVcGxvYWRlZEl0ZW0oZmlsZU5hbWVOb1NwYWNlKTtcbiAgICAgICAgICBpZiAoZm9ybWRhdGEpIHtcbiAgICAgICAgICAgIGZvcm1kYXRhLmFwcGVuZChcIm5hbWVcIiwgZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGZpbGUgdHlwZSBpcyBub3Qgc3VwcG9ydGVkXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmb3JtZGF0YSkge1xuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvdGltZXNlcmllc2ltcG9ydC9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHVyaVVwbG9hZCxcbiAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IGZvcm1kYXRhLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3BvbnNlXCIpLmlubmVySFRNTCA9IFwiRmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHlcIjtcbiAgICAgICAgICAgICAgLy9pZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgIC8vICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICAgICAgICAvL31cbiAgICAgICAgICAgICAgLy9kYXRhW2ZpZWxkXS5wdXNoKHt0aXRsZTogJycsIGZpbGU6IGZpbGVOYW1lTm9TcGFjZX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgfVxuICApO1xuXG5cblxuXG59XG5cbi8qKlxuICogTWFuYWdlcyBtYXJrZG93biBlZGl0b3JcbiAqIEBwYXJhbSBjb250ZW50XG4gKiBAcGFyYW0gb25TYXZlXG4gKiBAcGFyYW0gcGFnZURhdGFcbiAqIEBwYXJhbSBub3RFbXB0eSAtIGlmIHByZXNlbnQsIG1hcmtkb3duIGNhbm5vdCBiZSBsZWZ0IGVtcHR5XG4gKi9cblxuZnVuY3Rpb24gbG9hZE1hcmtkb3duRWRpdG9yKGNvbnRlbnQsIG9uU2F2ZSwgcGFnZURhdGEsIG5vdEVtcHR5KSB7XG5cbiAgICBpZiAoY29udGVudC50aXRsZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMubWFya2Rvd25FZGl0b3JOb1RpdGxlKGNvbnRlbnQpO1xuICAgICAgICAkKCdib2R5JykuYXBwZW5kKGh0bWwpO1xuICAgICAgICAkKCcubWFya2Rvd24tZWRpdG9yJykuc3RvcCgpLmZhZGVJbigyMDApO1xuICAgICAgICAkKCcjd21kLWlucHV0JykuZm9jdXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5tYXJrZG93bkVkaXRvcihjb250ZW50KTtcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZChodG1sKTtcbiAgICAgICAgJCgnLm1hcmtkb3duLWVkaXRvcicpLnN0b3AoKS5mYWRlSW4oMjAwKTtcbiAgICAgICAgJCgnI3dtZC1pbnB1dCcpLmZvY3VzKCk7XG4gICAgfVxuXG4gICAgbWFya2Rvd25FZGl0b3IoKTtcblxuICAgIHZhciBtYXJrZG93biA9ICQoJyN3bWQtaW5wdXQnKS52YWwoKTtcblxuICAgIC8vIERldGVjdCBpZiBtYXJrZG93biB1cGRhdGVkIGFuZCB1cGRhdGUgdmFyaWFibGVcbiAgICAkKCcjd21kLWlucHV0Jykub24oJ2lucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIG1hcmtkb3duID0gJCgnI3dtZC1pbnB1dCcpLnZhbCgpO1xuICAgIH0pO1xuXG4gICAgaWYgKG5vdEVtcHR5ID09PSB0cnVlIHx8IG1hcmtkb3duID09PSAnJykge1xuICAgICAgICAkKCcuYnRuLW1hcmtkb3duLWVkaXRvci1jYW5jZWwnKS5oaWRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJCgnLmJ0bi1tYXJrZG93bi1lZGl0b3ItY2FuY2VsJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLm1hcmtkb3duLWVkaXRvcicpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICQoXCIuYnRuLW1hcmtkb3duLWVkaXRvci1zYXZlXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb25TYXZlKG1hcmtkb3duKTtcbiAgICB9KTtcblxuICAgIGlmIChub3RFbXB0eSkge1xuICAgICAgICAkKFwiLmJ0bi1tYXJrZG93bi1lZGl0b3ItZXhpdFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAobWFya2Rvd24gPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnUGxlYXNlIGFkZCBzb21lIHRleHQnLCBcIlRoaXMgY2FuJ3QgYmUgbGVmdCBlbXB0eVwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb25TYXZlKG1hcmtkb3duKTtcbiAgICAgICAgICAgICAgICAkKCcubWFya2Rvd24tZWRpdG9yJykuc3RvcCgpLmZhZGVPdXQoMjAwKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIi5idG4tbWFya2Rvd24tZWRpdG9yLWV4aXRcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gSnVzdCBhIGxpdHRsZSB0ZXN0IHRvIHNlZSBpZiB0aGUgbWFya2Rvd24gaXMgZXZlciBnZXR0aW5nIHNldCB0byBudWxsIC0gY2FuIGRlbGV0ZSBpdCBsYXRlciBpZiB0aGlzIGlzIG5ldmVyIGZpcmVkXG4gICAgICAgICAgICBpZiAoIW1hcmtkb3duIHx8IG1hcmtkb3duID09IFwibnVsbFwiKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciwgdW5kZWZpbmVkIG9yIG51bGwgbWFya2Rvd24gdmFsdWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvblNhdmUobWFya2Rvd24pO1xuICAgICAgICAgICAgJCgnLm1hcmtkb3duLWVkaXRvcicpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBvbkluc2VydFNhdmUgPSBmdW5jdGlvbiAobmFtZSwgbWFya2Rvd24pIHtcbiAgICAgICAgaW5zZXJ0QXRDdXJzb3IoJCgnI3dtZC1pbnB1dCcpWzBdLCBtYXJrZG93bik7XG4gICAgICAgICQoJyN3bWQtaW5wdXQnKS50cmlnZ2VyKCdpbnB1dCcpO1xuICAgICAgICBGbG9yZW5jZS5FZGl0b3IubWFya2Rvd25FZGl0b3IucmVmcmVzaFByZXZpZXcoKTtcbiAgICB9O1xuXG4gICAgJChcIiNqcy1lZGl0b3ItLWNoYXJ0XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZENoYXJ0QnVpbGRlcihwYWdlRGF0YSwgb25JbnNlcnRTYXZlKTtcbiAgICB9KTtcblxuICAgICQoXCIjanMtZWRpdG9yLS10YWJsZVwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRUYWJsZUJ1aWxkZXIocGFnZURhdGEsIG9uSW5zZXJ0U2F2ZSk7XG4gICAgfSk7XG5cbiAgICAkKFwiI2pzLWVkaXRvci0tZXF1YXRpb25cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkRXF1YXRpb25CdWlsZGVyKHBhZ2VEYXRhLCBvbkluc2VydFNhdmUpO1xuICAgIH0pO1xuXG4gICAgJChcIiNqcy1lZGl0b3ItLWltYWdlXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9hZEltYWdlQnVpbGRlcihwYWdlRGF0YSwgZnVuY3Rpb24gKG5hbWUsIG1hcmtkb3duLCBwYWdlRGF0YSkge1xuICAgICAgICAgICAgb25JbnNlcnRTYXZlKG5hbWUsIG1hcmtkb3duKTtcbiAgICAgICAgICAgIHJlZnJlc2hJbWFnZXNMaXN0KEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQsIHBhZ2VEYXRhKVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICQoXCIjanMtZWRpdG9yLS1lbWJlZFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvYWRFbWJlZElmcmFtZShmdW5jdGlvbiAobWFya2Rvd24pIHtcbiAgICAgICAgICAgIG9uSW5zZXJ0U2F2ZSgnJywgbWFya2Rvd24pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgICQoXCIjd21kLWlucHV0XCIpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbWFya0Rvd25FZGl0b3JTZXRMaW5lcygpO1xuICAgIH0pO1xuXG4gICAgJChcIiN3bWQtaW5wdXRcIikub24oJ2tleXVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBtYXJrRG93bkVkaXRvclNldExpbmVzKCk7XG4gICAgfSk7XG5cbiAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzYxNDA2MzIvaG93LXRvLWhhbmRsZS10YWItaW4tdGV4dGFyZWFcbiAgICAkKFwiI3dtZC1pbnB1dFwiKS5rZXlkb3duKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDkpIHsgLy8gdGFiIHdhcyBwcmVzc2VkXG4gICAgICAgICAgICAvLyBnZXQgY2FyZXQgcG9zaXRpb24vc2VsZWN0aW9uXG4gICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gJHRoaXMudmFsKCk7XG5cbiAgICAgICAgICAgIC8vIHNldCB0ZXh0YXJlYSB2YWx1ZSB0bzogdGV4dCBiZWZvcmUgY2FyZXQgKyB0YWIgKyB0ZXh0IGFmdGVyIGNhcmV0XG4gICAgICAgICAgICAkdGhpcy52YWwodmFsdWUuc3Vic3RyaW5nKDAsIHN0YXJ0KVxuICAgICAgICAgICAgICAgICsgXCJcXHRcIlxuICAgICAgICAgICAgICAgICsgdmFsdWUuc3Vic3RyaW5nKGVuZCkpO1xuXG4gICAgICAgICAgICAvLyBwdXQgY2FyZXQgYXQgcmlnaHQgcG9zaXRpb24gYWdhaW4gKGFkZCBvbmUgZm9yIHRoZSB0YWIpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25FbmQgPSBzdGFydCArIDE7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgdGhlIGZvY3VzIGxvc2VcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMTA3Njk3NS9pbnNlcnQtdGV4dC1pbnRvLXRleHRhcmVhLWF0LWN1cnNvci1wb3NpdGlvbi1qYXZhc2NyaXB0XG4gICAgZnVuY3Rpb24gaW5zZXJ0QXRDdXJzb3IoZmllbGQsIHZhbHVlKSB7XG4gICAgICAgIC8vSUUgc3VwcG9ydFxuICAgICAgICBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICBmaWVsZC5mb2N1cygpO1xuICAgICAgICAgICAgc2VsID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgICBzZWwudGV4dCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIC8vTU9aSUxMQSBhbmQgb3RoZXJzXG4gICAgICAgIGVsc2UgaWYgKGZpZWxkLnNlbGVjdGlvblN0YXJ0IHx8IGZpZWxkLnNlbGVjdGlvblN0YXJ0ID09ICcwJykge1xuICAgICAgICAgICAgdmFyIHN0YXJ0UG9zID0gZmllbGQuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgICB2YXIgZW5kUG9zID0gZmllbGQuc2VsZWN0aW9uRW5kO1xuICAgICAgICAgICAgZmllbGQudmFsdWUgPSBmaWVsZC52YWx1ZS5zdWJzdHJpbmcoMCwgc3RhcnRQb3MpXG4gICAgICAgICAgICAgICAgKyB2YWx1ZVxuICAgICAgICAgICAgICAgICsgZmllbGQudmFsdWUuc3Vic3RyaW5nKGVuZFBvcywgZmllbGQudmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICAgIGZpZWxkLnNlbGVjdGlvblN0YXJ0ID0gc3RhcnRQb3MgKyB2YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgICBmaWVsZC5zZWxlY3Rpb25FbmQgPSBzdGFydFBvcyArIHZhbHVlLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpZWxkLnZhbHVlICs9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIG1hcmtkb3duRWRpdG9yKCkge1xuXG4gICAgdmFyIGNvbnZlcnRlciA9IG5ldyBNYXJrZG93bi5nZXRTYW5pdGl6aW5nQ29udmVydGVyKCk7XG5cbiAgICAvLyBvdXRwdXQgY2hhcnQgdGFnIGFzIHRleHQgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHRhZy5cbiAgICBjb252ZXJ0ZXIuaG9va3MuY2hhaW4oXCJwcmVCbG9ja0dhbXV0XCIsIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHZhciBuZXdUZXh0ID0gdGV4dC5yZXBsYWNlKC8oPG9ucy1jaGFydFxcc3BhdGg9XCJbLUEtWmEtejAtOSsmQCNcXC8lPz1+X3whOiwuO1xcKFxcKSpbXFxdJF0rXCI/XFxzP1xcLz4pL2lnLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICAgIHZhciBwYXRoID0gJChtYXRjaCkuYXR0cigncGF0aCcpO1xuICAgICAgICAgICAgcmV0dXJuICdbY2hhcnQgcGF0aD1cIicgKyBwYXRoICsgJ1wiIF0nO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ld1RleHQ7XG4gICAgfSk7XG5cbiAgICAvLyBvdXRwdXQgdGFibGUgdGFnIGFzIHRleHQgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHRhZy5cbiAgICBjb252ZXJ0ZXIuaG9va3MuY2hhaW4oXCJwcmVCbG9ja0dhbXV0XCIsIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHZhciBuZXdUZXh0ID0gdGV4dC5yZXBsYWNlKC8oPG9ucy10YWJsZVxcc3BhdGg9XCJbLUEtWmEtejAtOSsmQCNcXC8lPz1+X3whOiwuO1xcKFxcKSpbXFxdJF0rXCI/XFxzP1xcLz4pL2lnLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICAgIHZhciBwYXRoID0gJChtYXRjaCkuYXR0cigncGF0aCcpO1xuICAgICAgICAgICAgcmV0dXJuICdbdGFibGUgcGF0aD1cIicgKyBwYXRoICsgJ1wiIF0nO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ld1RleHQ7XG4gICAgfSk7XG5cbiAgICAvLyBvdXRwdXQgZXF1YXRpb24gdGFnIGFzIHRleHQgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHRhZy5cbiAgICBjb252ZXJ0ZXIuaG9va3MuY2hhaW4oXCJwcmVCbG9ja0dhbXV0XCIsIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHZhciBuZXdUZXh0ID0gdGV4dC5yZXBsYWNlKC8oPG9ucy1lcXVhdGlvblxcc3BhdGg9XCJbLUEtWmEtejAtOSsmQCNcXC8lPz1+X3whOiwuO1xcKFxcKSpbXFxdJF0rXCI/XFxzP1xcLz4pL2lnLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICAgIHZhciBwYXRoID0gJChtYXRjaCkuYXR0cigncGF0aCcpO1xuICAgICAgICAgICAgcmV0dXJuICdbZXF1YXRpb24gcGF0aD1cIicgKyBwYXRoICsgJ1wiIF0nO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ld1RleHQ7XG4gICAgfSk7XG5cbiAgICAvLyBvdXRwdXQgaW50ZXJhY3RpdmUgdGFnIGFzIHRleHQgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHRhZy5cbiAgICBjb252ZXJ0ZXIuaG9va3MuY2hhaW4oXCJwcmVCbG9ja0dhbXV0XCIsIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHZhciBuZXdUZXh0ID0gdGV4dC5yZXBsYWNlKC8oPG9ucy1pbnRlcmFjdGl2ZVxcc3VybD1cIlstQS1aYS16MC05KyZAI1xcLyU/PX5ffCE6LC47XFwoXFwpKltcXF0kXStcIj9cXHM/XFwvPikvaWcsIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgICAgdmFyIHBhdGggPSAkKG1hdGNoKS5hdHRyKCd1cmwnKTtcbiAgICAgICAgICAgIHJldHVybiAnW2ludGVyYWN0aXZlIHVybD1cIicgKyBwYXRoICsgJ1wiIF0nO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ld1RleHQ7XG4gICAgfSk7XG5cbiAgICBjb252ZXJ0ZXIuaG9va3MuY2hhaW4oXCJwbGFpbkxpbmtUZXh0XCIsIGZ1bmN0aW9uIChsaW5rKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibGluayBkb25lLCBpbm5pdFwiKTtcbiAgICAgICAgY29uc29sZS5sb2cobGluayk7XG4gICAgfSk7XG5cbiAgICBNYXJrZG93bi5FeHRyYS5pbml0KGNvbnZlcnRlciwge1xuICAgICAgICBleHRlbnNpb25zOiBcImFsbFwiXG4gICAgfSk7XG5cbiAgICB2YXIgZWRpdG9yID0gbmV3IE1hcmtkb3duLkVkaXRvcihjb252ZXJ0ZXIpO1xuICAgIEZsb3JlbmNlLkVkaXRvci5tYXJrZG93bkVkaXRvciA9IGVkaXRvcjtcblxuICAgIGVkaXRvci5ob29rcy5jaGFpbihcIm9uUHJldmlld1JlZnJlc2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXRoSmF4Lkh1Yi5RdWV1ZShbXCJUeXBlc2V0XCIsIE1hdGhKYXguSHViXSk7XG4gICAgfSk7XG5cbiAgICBlZGl0b3IucnVuKCk7XG4gICAgbWFya0Rvd25FZGl0b3JTZXRMaW5lcygpO1xufVxuXG4vKipcbiAqIEVkaXRvciBkYXRhIGxvYWRlclxuICogQHBhcmFtIHBhdGhcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBjbGljayAtIGlmIHByZXNlbnQgY2hlY2tzIHRoZSBwYWdlIHVybCB0byBrZWVwIGluIHN5bmMgd2l0aCBpZnJhbWVcbiAqL1xuXG5mdW5jdGlvbiBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKHBhdGgsIGNvbGxlY3Rpb25JZCwgY2xpY2spIHtcblxuICAgIGlmIChGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgIGlmIChwYXRoID09PSAnLycpIHsgICAgICAgLy9hZGQgd2hhdGV2ZXIgbmVlZGVkIHRvIHJlYWQgY29udGVudCBpbiBXZWxzaFxuICAgICAgICAgICAgdmFyIHBhZ2VVcmxEYXRhID0gcGF0aCArICcmbGFuZz1jeSc7XG4gICAgICAgICAgICB2YXIgdG9BcHByb3ZlVXJsRGF0YSA9ICcvZGF0YV9jeS5qc29uJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwYWdlVXJsRGF0YSA9IHBhdGggKyAnJmxhbmc9Y3knO1xuICAgICAgICAgICAgdmFyIHRvQXBwcm92ZVVybERhdGEgPSBwYXRoICsgJy9kYXRhX2N5Lmpzb24nO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHBhdGggPT09ICcvJykgeyAgICAgICAvL2FkZCB3aGF0ZXZlciBuZWVkZWQgdG8gcmVhZCBjb250ZW50IGluIEVuZ2xpc2hcbiAgICAgICAgICAgIHZhciBwYWdlVXJsRGF0YSA9IHBhdGg7XG4gICAgICAgICAgICB2YXIgdG9BcHByb3ZlVXJsRGF0YSA9ICcvZGF0YS5qc29uJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwYWdlVXJsRGF0YSA9IHBhdGg7XG4gICAgICAgICAgICB2YXIgdG9BcHByb3ZlVXJsRGF0YSA9IHBhdGggKyAnL2RhdGEuanNvbic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgcGFnZURhdGEsIGlzUGFnZUNvbXBsZXRlO1xuICAgIHZhciBhamF4UmVxdWVzdHMgPSBbXTtcblxuICAgIGFqYXhSZXF1ZXN0cy5wdXNoKFxuICAgICAgICBnZXRQYWdlRGF0YShjb2xsZWN0aW9uSWQsIHBhZ2VVcmxEYXRhLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhID0gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICApO1xuXG4gICAgYWpheFJlcXVlc3RzLnB1c2goXG4gICAgICAgIGdldENvbGxlY3Rpb24oY29sbGVjdGlvbklkLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBsYXN0Q29tcGxldGVkRXZlbnQgPSBnZXRMYXN0Q29tcGxldGVkRXZlbnQocmVzcG9uc2UsIHRvQXBwcm92ZVVybERhdGEpO1xuICAgICAgICAgICAgICAgIGlzUGFnZUNvbXBsZXRlID0gISghbGFzdENvbXBsZXRlZEV2ZW50IHx8IGxhc3RDb21wbGV0ZWRFdmVudC5lbWFpbCA9PT0gRmxvcmVuY2UuQXV0aGVudGljYXRpb24ubG9nZ2VkSW5FbWFpbCgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pXG4gICAgKTtcblxuICAgICQud2hlbi5hcHBseSgkLCBhamF4UmVxdWVzdHMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2xpY2spIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWUgPSBnZXRQcmV2aWV3VXJsKCk7XG4gICAgICAgICAgICBpZiAoaWZyYW1lICE9PSBwYWdlRGF0YS51cmkpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWRQYWdlRGF0YUludG9FZGl0b3IocGF0aCwgY29sbGVjdGlvbklkKSwgMjAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyQWNjb3JkaW9uU2VjdGlvbnMoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgaXNQYWdlQ29tcGxldGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVuZGVyQWNjb3JkaW9uU2VjdGlvbnMoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgaXNQYWdlQ29tcGxldGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2FkUGFyZW50TGluayhjb2xsZWN0aW9uSWQsIGRhdGEsIHBhcmVudFVybCkge1xuXG4gIGdldFBhZ2VEYXRhVGl0bGUoY29sbGVjdGlvbklkLCBwYXJlbnRVcmwsXG4gICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIHBhcmVudFRpdGxlID0gcmVzcG9uc2UudGl0bGU7XG4gICAgICAgICQoJy5jaGlsZC1wYWdlX190aXRsZScpLmFwcGVuZChwYXJlbnRUaXRsZSk7XG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICBzd2VldEFsZXJ0KFwiRXJyb3JcIiwgXCJDb3VsZCBub3QgZmluZCBwYXJlbnQgdGhhdCB0aGlzIGlzIGEgc3ViIHBhZ2Ugb2ZcIiwgXCJlcnJvclwiKTtcbiAgICAgIH1cbiAgKTtcblxuICAvL0FkZCBsaW5rIGJhY2sgdG8gcGFyZW50IHBhZ2VcbiAgJCgnLmNoaWxkLXBhZ2UnKS5hcHBlbmQoXCI8YSBjbGFzcz0nY2hpbGQtcGFnZV9fbGluayc+QmFjayB0byBwYXJlbnQgcGFnZTwvYT5cIik7XG5cbiAgLy9UYWtlIHVzZXIgdG8gcGFyZW50IGVkaXQgc2NyZWVuIG9uIGxpbmsgY2xpY2tcbiAgJCgnLmNoaWxkLXBhZ2VfX2xpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgLy9JZiB0aGVyZSBhcmUgZWRpdHMgY2hlY2sgd2hldGhlciB1c2VyIHdhbnRzIHRvIGNvbnRpbnVlXG4gICAgaWYgKEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5KSB7XG4gICAgICBzd2FsICh7XG4gICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgdGV4dDogXCJZb3UgaGF2ZSB1bnNhdmVkIGNoYW5nZXMuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjb250aW51ZT9cIixcbiAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCJcbiAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgLy9SZXR1cm4gdG8gcGFyZW50IGlmIHVzZXIgY29uZmlybXMgaXRcbiAgICAgICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLCBwYXJlbnRVcmwpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9SZXR1cm4gdG8gcGFyZW50IHdpdGhvdXQgc2F2aW5nXG4gICAgICBjcmVhdGVXb3Jrc3BhY2UocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgfVxuICB9KTtcblxufS8qKlxuICogQ3JlYXRlcyByZWxlYXNlcycgSlNPTlxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHJlbGVhc2VEYXRlXG4gKiBAcGFyYW0gcGFnZVR5cGVcbiAqIEBwYXJhbSBwYXJlbnRVcmxcbiAqL1xuXG5mdW5jdGlvbiBsb2FkVDE2Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKSB7XG4gICAgdmFyIHJlbGVhc2VEYXRlID0gbnVsbDsgICAgICAgICAgICAgLy9vdmVyd3JpdGUgc2NoZWR1bGVkIGNvbGxlY3Rpb24gZGF0ZVxuICAgIHZhciBwYWdlVHlwZSwgcGFnZVRpdGxlLCB1cmlTZWN0aW9uLCBwYWdlVGl0bGVUcmltbWVkLCBuZXdVcmksIHBhZ2VEYXRhLCBzYWZlTmV3VXJpO1xuICAgIHZhciBwYXJlbnRVcmxEYXRhID0gXCIvZGF0YVwiOyAvL2hvbWUgcGFnZVxuICAgICQuYWpheCh7XG4gICAgICAgIHVybDogcGFyZW50VXJsRGF0YSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjaGVja0RhdGEpIHtcbiAgICAgICAgICAgIC8vQ2hlY2tzIHBhZ2UgaXMgYnVpbHQgaW4gY29ycmVjdCBsb2NhdGlvblxuICAgICAgICAgICAgaWYgKGNoZWNrRGF0YS50eXBlID09PSAnaG9tZV9wYWdlJykge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEZvcm1IYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGlzIG5vdCBhIHZhbGlkIHBsYWNlIHRvIGNyZWF0ZSB0aGlzIHBhZ2UuXCIpO1xuICAgICAgICAgICAgICAgIGxvYWRDcmVhdGVTY3JlZW4ocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ05vIHBhZ2UgZGF0YSByZXR1cm5lZCcpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzdWJtaXRGb3JtSGFuZGxlcigpIHtcbiAgICAgICAgJCgnLmVkaXRpb24nKS5hcHBlbmQoXG4gICAgICAgICAgICAnPGxhYmVsIGZvcj1cInJlbGVhc2VEYXRlXCI+UmVsZWFzZSBkYXRlPC9sYWJlbD4nICtcbiAgICAgICAgICAgICc8aW5wdXQgaWQ9XCJyZWxlYXNlRGF0ZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJkYXkgbW9udGggeWVhclwiIC8+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cInNlbGVjdC13cmFwIHNlbGVjdC13cmFwLS1oYWxmXCI+JyArXG4gICAgICAgICAgICAnPHNlbGVjdCBpZD1cImhvdXJcIj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIwXCI+MDA8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIzNjAwMDAwXCI+MDE8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCI3MjAwMDAwXCI+MDI8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIxMDgwMDAwMFwiPjAzPC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiMTQ0MDAwMDBcIj4wNDwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjE4MDAwMDAwXCI+MDU8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIyMTYwMDAwMFwiPjA2PC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiMjUyMDAwMDBcIj4wNzwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjI4ODAwMDAwXCI+MDg8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIzMjQwMDAwMFwiIHNlbGVjdGVkPVwic2VsZWN0ZWRcIj4wOTwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjM2MDAwMDAwXCI+MTA8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCIzOTYwMDAwMFwiPjExPC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiNDMyMDAwMDBcIj4xMjwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjQ2ODAwMDAwXCI+MTM8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCI1MDQwMDAwMFwiPjE0PC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiNTQwMDAwMDBcIj4xNTwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjU3NjAwMDAwXCI+MTY8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCI2MTIwMDAwMFwiPjE3PC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiNjQ4MDAwMDBcIj4xODwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjY4NDAwMDAwXCI+MTk8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCI3MjAwMDAwMFwiPjIwPC9vcHRpb24+JyArXG4gICAgICAgICAgICAnICA8b3B0aW9uIHZhbHVlPVwiNzU2MDAwMDBcIj4yMTwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjc5MjAwMDAwXCI+MjI8L29wdGlvbj4nICtcbiAgICAgICAgICAgICcgIDxvcHRpb24gdmFsdWU9XCI4MjgwMDAwMFwiPjIzPC9vcHRpb24+JyArXG4gICAgICAgICAgICAnPC9zZWxlY3Q+JyArXG4gICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cInNlbGVjdC13cmFwIHNlbGVjdC13cmFwLS1oYWxmXCI+JyArXG4gICAgICAgICAgICAnPHNlbGVjdCBpZD1cIm1pblwiPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjBcIj4wMDwvb3B0aW9uPicgK1xuICAgICAgICAgICAgJyAgPG9wdGlvbiB2YWx1ZT1cIjE4MDAwMDBcIiBzZWxlY3RlZD1cInNlbGVjdGVkXCI+MzA8L29wdGlvbj4nICtcbiAgICAgICAgICAgICc8L3NlbGVjdD4nICtcbiAgICAgICAgICAgICc8L2Rpdj4nXG4gICAgICAgICk7XG4gICAgICAgIC8vICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe1xuICAgICAgICAvLyAgICAgZGF0ZUZvcm1hdDogJ2RkIE1NIHl5JyxcbiAgICAgICAgLy8gICAgIG9uU2VsZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gICAgICAgICAkKCdzZWxlY3QjaG91cicpLmZvY3VzKCk7XG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vIH0pO1xuICAgICAgICBjcmVhdG9yRGF0ZVBpY2tlcigpO1xuXG4gICAgICAgIC8vU3VibWl0cyBpbmhlcml0ZWQgYW5kIGFkZGVkIGluZm9ybWF0aW9uIHRvIEpTT05cbiAgICAgICAgJCgnZm9ybScpLm9mZigpLnN1Ym1pdChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIG5hbWVWYWxpZCA9IHZhbGlkYXRlUGFnZU5hbWUoKTtcbiAgICAgICAgICAgIGlmICghbmFtZVZhbGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFnZURhdGEgPSBwYWdlVHlwZURhdGFUMTYocGFnZVR5cGUpO1xuICAgICAgICAgICAgdmFyIHB1Ymxpc2hUaW1lID0gcGFyc2VJbnQoJCgnI2hvdXInKS52YWwoKSkgKyBwYXJzZUludCgkKCcjbWluJykudmFsKCkpO1xuICAgICAgICAgICAgdmFyIHRvSXNvRGF0ZSA9ICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoXCJnZXREYXRlXCIpO1xuICAgICAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZShwYXJzZUludChuZXcgRGF0ZSh0b0lzb0RhdGUpLmdldFRpbWUoKSkgKyBwdWJsaXNoVGltZSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24gPSAkKCcjZWRpdGlvbicpLnZhbCgpO1xuICAgICAgICAgICAgcGFnZVRpdGxlID0gJCgnI3BhZ2VuYW1lJykudmFsKCk7XG4gICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9IHBhZ2VUaXRsZTtcbiAgICAgICAgICAgIHVyaVNlY3Rpb24gPSBcInJlbGVhc2VzXCI7XG4gICAgICAgICAgICBwYWdlVGl0bGVUcmltbWVkID0gcGFnZVRpdGxlLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBuZXdVcmkgPSBtYWtlVXJsKHVyaVNlY3Rpb24sIHBhZ2VUaXRsZVRyaW1tZWQpO1xuICAgICAgICAgICAgc2FmZU5ld1VyaSA9IGNoZWNrUGF0aFNsYXNoZXMobmV3VXJpKTtcblxuICAgICAgICAgICAgaWYgKCFwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1JlbGVhc2UgZGF0ZSBjYW4gbm90IGJlIGVtcHR5Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFnZVRpdGxlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoID0gc2FmZU5ld1VyaTtcbiAgICAgICAgICAgICAgICBzYXZlQ29udGVudChjb2xsZWN0aW9uSWQsIHNhZmVOZXdVcmksIHBhZ2VEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwYWdlVHlwZURhdGFUMTYocGFnZVR5cGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgIFwicHJvdmlzaW9uYWxEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICBcImZpbmFsaXNlZFwiOiBmYWxzZSxcbiAgICAgICAgICAgIFwibmV4dFJlbGVhc2VcIjogXCJcIiwgLy9kb2VzIG5vdCBtYWtlIHNlbnNlXG4gICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwiZW1haWxcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzdW1tYXJ5XCI6IFwiXCIsXG4gICAgICAgICAgICBcInRpdGxlXCI6IFwiXCIsXG4gICAgICAgICAgICBcIm5hdGlvbmFsU3RhdGlzdGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgXCJjYW5jZWxsZWRcIjogZmFsc2UsXG4gICAgICAgICAgICBcImNhbmNlbGxhdGlvbk5vdGljZVwiOiBbXSxcbiAgICAgICAgICAgIFwicHVibGlzaGVkXCI6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIFwibWFya2Rvd25cIjogW10sXG4gICAgICAgIFwicmVsYXRlZERhdGFzZXRzXCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWREb2N1bWVudHNcIjogW10sXG4gICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5XCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neUFydGljbGVcIjogW10sXG4gICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgIHR5cGU6IHBhZ2VUeXBlLFxuICAgICAgICBcImRhdGVDaGFuZ2VzXCI6IFtdXG4gICAgfTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFydGljbGUgYW5kIGJ1bGxldGluIEpTT05cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSByZWxlYXNlRGF0ZVxuICogQHBhcmFtIHBhZ2VUeXBlXG4gKiBAcGFyYW0gcGFyZW50VXJsXG4gKi9cblxuZnVuY3Rpb24gbG9hZFQ0Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKSB7XG4gICAgdmFyIHJlbGVhc2VEYXRlID0gbnVsbDsgICAgICAgICAgICAgLy9vdmVyd3JpdGUgc2NoZWR1bGVkIGNvbGxlY3Rpb24gZGF0ZVxuICAgIHZhciBjb25kaXRpb25zID0gdHJ1ZTtcbiAgICB2YXIgcGFnZVR5cGUsIHBhZ2VUaXRsZSwgdXJpU2VjdGlvbiwgcGFnZVRpdGxlVHJpbW1lZCwgcGFnZUVkaXRpb25UcmltbWVkLCByZWxlYXNlRGF0ZU1hbnVhbCxcbiAgICAgICAgaXNJbmhlcml0aW5nLCBuZXdVcmksIHBhZ2VEYXRhLCBuYXRTdGF0LCBjb250YWN0TmFtZSwgY29udGFjdEVtYWlsLFxuICAgICAgICBjb250YWN0VGVsLCBrZXlXb3JkcywgbWV0YURlc2NyLCByZWxhdGVkRGF0YSwgc3VtbWFyeSwgcmVsYXRlZE1ldGhvZG9sb2d5O1xuICAgIHZhciBwYXJlbnRVcmxEYXRhID0gcGFyZW50VXJsICsgXCIvZGF0YVwiO1xuICAgICQuYWpheCh7XG4gICAgICAgIHVybDogcGFyZW50VXJsRGF0YSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjaGVja0RhdGEpIHtcbiAgICAgICAgICAgIGlmIChjaGVja0RhdGEudHlwZSA9PT0gJ3Byb2R1Y3RfcGFnZScgJiYgIUZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2gpIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZFVybCA9IGNoZWNrUGF0aFNsYXNoZXMoY2hlY2tEYXRhLnVyaSk7XG4gICAgICAgICAgICAgICAgc3VibWl0Rm9ybUhhbmRsZXIoY2hlY2tlZFVybCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGNoZWNrRGF0YS50eXBlID09PSAnYnVsbGV0aW4nICYmIHBhZ2VUeXBlID09PSAnYnVsbGV0aW4nKSB8fCAoY2hlY2tEYXRhLnR5cGUgPT09ICdhcnRpY2xlJyAmJiBwYWdlVHlwZSA9PT0gJ2FydGljbGUnKSB8fCAoY2hlY2tEYXRhLnR5cGUgPT09ICdhcnRpY2xlX2Rvd25sb2FkJyAmJiBwYWdlVHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnKSkge1xuICAgICAgICAgICAgICAgIHZhciBjaGVja2VkVXJsID0gY2hlY2tQYXRoU2xhc2hlcyhjaGVja0RhdGEudXJpKTtcbiAgICAgICAgICAgICAgICB2YXIgc2FmZVBhcmVudFVybCA9IGdldFBhcmVudFBhZ2UoY2hlY2tlZFVybCk7XG4gICAgICAgICAgICAgICAgbmF0U3RhdCA9IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYztcbiAgICAgICAgICAgICAgICBjb250YWN0TmFtZSA9IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWU7XG4gICAgICAgICAgICAgICAgY29udGFjdEVtYWlsID0gY2hlY2tEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWw7XG4gICAgICAgICAgICAgICAgY29udGFjdFRlbCA9IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LnRlbGVwaG9uZTtcbiAgICAgICAgICAgICAgICBwYWdlVGl0bGUgPSBjaGVja0RhdGEuZGVzY3JpcHRpb24udGl0bGU7XG4gICAgICAgICAgICAgICAga2V5V29yZHMgPSBjaGVja0RhdGEuZGVzY3JpcHRpb24ua2V5d29yZHM7XG4gICAgICAgICAgICAgICAgc3VtbWFyeSA9IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5O1xuICAgICAgICAgICAgICAgIG1ldGFEZXNjciA9IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgcmVsYXRlZE1ldGhvZG9sb2d5ID0gY2hlY2tEYXRhLnJlbGF0ZWRNZXRob2RvbG9neTtcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tEYXRhLnR5cGUgPT09ICdidWxsZXRpbicgJiYgcGFnZVR5cGUgPT09ICdidWxsZXRpbicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRlZERhdGEgPSBjaGVja0RhdGEucmVsYXRlZERhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlzSW5oZXJpdGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgc3VibWl0Rm9ybUhhbmRsZXIoc2FmZVBhcmVudFVybCwgcGFnZVRpdGxlLCBpc0luaGVyaXRpbmcpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBwbGFjZSB0byBjcmVhdGUgdGhpcyBwYWdlLlwiKTtcbiAgICAgICAgICAgICAgICBsb2FkQ3JlYXRlU2NyZWVuKHBhcmVudFVybCwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBwYWdlIGRhdGEgcmV0dXJuZWQnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc3VibWl0Rm9ybUhhbmRsZXIocGFyZW50VXJsLCB0aXRsZSwgaXNJbmhlcml0aW5nKSB7XG5cbiAgICAgICAgJCgnLmVkaXRpb24nKS5hcHBlbmQoXG4gICAgICAgICAgICAnPGRpdiBpZD1cImVkaXRpb24tZGl2XCI+JyArXG4gICAgICAgICAgICAnICA8bGFiZWwgZm9yPVwiZWRpdGlvblwiPkVkaXRpb248L2xhYmVsPicgK1xuICAgICAgICAgICAgJyAgPGlucHV0IGlkPVwiZWRpdGlvblwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJBdWd1c3QgMjAxMCwgUTMgMjAxNSwgMTk3OCwgZXRjLlwiIC8+JyArXG4gICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICApO1xuICAgICAgICBpZiAoIXJlbGVhc2VEYXRlKSB7XG4gICAgICAgICAgICAkKCcuZWRpdGlvbicpLmFwcGVuZChcbiAgICAgICAgICAgICAgICAnPGRpdiBpZD1cInJlbGVhc2UtZGl2XCI+JyArXG4gICAgICAgICAgICAgICAgJyAgPGxhYmVsIGZvcj1cInJlbGVhc2VEYXRlXCI+UmVsZWFzZSBkYXRlPC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAnICA8aW5wdXQgaWQ9XCJyZWxlYXNlRGF0ZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJkYXkgbW9udGggeWVhclwiIC8+JyArXG4gICAgICAgICAgICAgICAgJzwvZGl2PidcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjcmVhdG9yRGF0ZVBpY2tlcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFpc0luaGVyaXRpbmcpIHtcbiAgICAgICAgICAgICQoJy5idG4tcGFnZS1jcmVhdGUnKS5iZWZvcmUoXG4gICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwiY3JlYXRlLXB1Ymxpc2hpbmctZXJyb3JcIj5DcmVhdGluZyBhIHB1YmxpY2F0aW9uIGhlcmUgd2lsbCBjcmVhdGUgYSBuZXcgc2VyaWVzLjwvcD4nXG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICBwYWdlVGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgICQoJyNwYWdlbmFtZScpLnZhbCh0aXRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCdmb3JtJykub2ZmKCkuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZWxlYXNlRGF0ZU1hbnVhbCA9ICQoJyNyZWxlYXNlRGF0ZScpLnZhbCgpO1xuICAgICAgICAgICAgdmFyIHBhZ2VFZGl0aW9uID0gJCgnI2VkaXRpb24nKS52YWwoKTtcblxuICAgICAgICAgICAgLy8gRG8gaW5wdXQgdmFsaWRhdGlvblxuICAgICAgICAgICAgdmFyIG5hbWVWYWxpZCA9IHZhbGlkYXRlUGFnZU5hbWUoKTtcbiAgICAgICAgICAgIGlmICghbmFtZVZhbGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBCdWxsZXRpbiBwYWdlIHRpdGxlIHZhbGlkYXRpb25cbiAgICAgICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ2J1bGxldGluJyAmJiAhdmFsaWRhdGVQYWdlTmFtZSgnI2VkaXRpb24nKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXJ0aWNsZSBwYWdlIHZhbGlkYXRpb24gLSByZW1vdmUgZW1wdHkgc3BhY2VcbiAgICAgICAgICAgIGlmICgocGFnZVR5cGUgPT09ICdhcnRpY2xlJyB8fCBwYWdlVHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnKSAmJiBwYWdlRWRpdGlvbiA9PT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICBwYWdlRWRpdGlvbiA9IFwiXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhZ2VEYXRhID0gcGFnZVR5cGVEYXRhVDQocGFnZVR5cGUpO1xuICAgICAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24uZWRpdGlvbiA9IHBhZ2VFZGl0aW9uO1xuICAgICAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICAgICAgLy9kbyBub3RoaW5nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYWdlVGl0bGUgPSAkKCcjcGFnZW5hbWUnKS52YWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gcGFnZVRpdGxlO1xuICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09PSAnYXJ0aWNsZV9kb3dubG9hZCcpIHtcbiAgICAgICAgICAgICAgICB1cmlTZWN0aW9uID0gJ2FydGljbGVzJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXJpU2VjdGlvbiA9IHBhZ2VUeXBlICsgXCJzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYWdlVGl0bGVUcmltbWVkID0gcGFnZVRpdGxlLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAocGFnZURhdGEuZGVzY3JpcHRpb24uZWRpdGlvbikge1xuICAgICAgICAgICAgICAgIHBhZ2VFZGl0aW9uVHJpbW1lZCA9IHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24ucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVsZWFzZVVyaSA9IHBhZ2VFZGl0aW9uVHJpbW1lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uICYmIHJlbGVhc2VEYXRlTWFudWFsKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAvL01hbnVhbCBjb2xsZWN0aW9uc1xuICAgICAgICAgICAgICAgIGRhdGUgPSAkLmRhdGVwaWNrZXIucGFyc2VEYXRlKFwiZGQgTU0geXlcIiwgcmVsZWFzZURhdGVNYW51YWwpO1xuICAgICAgICAgICAgICAgIHJlbGVhc2VVcmkgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgneXktbW0tZGQnLCBkYXRlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24gJiYgIXJlbGVhc2VEYXRlTWFudWFsKSB7XG4gICAgICAgICAgICAgICAgcmVsZWFzZVVyaSA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCd5eS1tbS1kZCcsIG5ldyBEYXRlKHJlbGVhc2VEYXRlKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghcmVsZWFzZURhdGUpIHtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLnZhbCgpKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IHJlbGVhc2VEYXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzSW5oZXJpdGluZykge1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gbmF0U3RhdDtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgPSBjb250YWN0TmFtZTtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LmVtYWlsID0gY29udGFjdEVtYWlsO1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gY29udGFjdFRlbDtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9IGtleVdvcmRzO1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9IG1ldGFEZXNjcjtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3kgPSByZWxhdGVkTWV0aG9kb2xvZ3k7XG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09PSAnYnVsbGV0aW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnN1bW1hcnkgPSBzdW1tYXJ5O1xuICAgICAgICAgICAgICAgICAgICBwYWdlRGF0YS5yZWxhdGVkRGF0YSA9IHJlbGF0ZWREYXRhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdVcmkgPSBtYWtlVXJsKHBhcmVudFVybCwgcmVsZWFzZVVyaSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1VyaSA9IG1ha2VVcmwocGFyZW50VXJsLCB1cmlTZWN0aW9uLCBwYWdlVGl0bGVUcmltbWVkLCByZWxlYXNlVXJpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzYWZlTmV3VXJpID0gY2hlY2tQYXRoU2xhc2hlcyhuZXdVcmkpO1xuXG4gICAgICAgICAgICBpZiAocGFnZVR5cGUgPT09ICdidWxsZXRpbicgJiYgIXBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KCdFZGl0aW9uIGNhbiBub3QgYmUgZW1wdHknKTtcbiAgICAgICAgICAgICAgICAkKCcuc2VsZWN0LXdyYXAnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcjZWRpdGlvbi1kaXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcjcmVsZWFzZS1kaXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBsb2FkVDRDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHBhZ2VUeXBlLCBwYXJlbnRVcmwpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXBhZ2VEYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnUmVsZWFzZSBkYXRlIGNhbiBub3QgYmUgZW1wdHknKTtcbiAgICAgICAgICAgICAgICAkKCcuc2VsZWN0LXdyYXAnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcjZWRpdGlvbi1kaXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcjcmVsZWFzZS1kaXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBsb2FkVDRDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHBhZ2VUeXBlLCBwYXJlbnRVcmwpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25kaXRpb25zID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFnZVRpdGxlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgICQoJy5zZWxlY3Qtd3JhcCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJyNlZGl0aW9uLWRpdicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJyNyZWxlYXNlLWRpdicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGxvYWRUNENyZWF0b3IoY29sbGVjdGlvbklkLCByZWxlYXNlRGF0ZSwgcGFnZVR5cGUsIHBhcmVudFVybCk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvbnMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbmRpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBzYXZlQ29udGVudChjb2xsZWN0aW9uSWQsIHNhZmVOZXdVcmksIHBhZ2VEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFnZVR5cGVEYXRhVDQocGFnZVR5cGUpIHtcblxuICAgICAgICBpZiAocGFnZVR5cGUgPT09IFwiYnVsbGV0aW5cIikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImVkaXRpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzdW1tYXJ5XCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuZXh0UmVsZWFzZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwibmF0aW9uYWxTdGF0aXN0aWNcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIFwiaGVhZGxpbmUxXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaGVhZGxpbmUyXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaGVhZGxpbmUzXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwia2V5d29yZHNcIjogW10sXG4gICAgICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInNlY3Rpb25zXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiYWNjb3JkaW9uXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZERvY3VtZW50c1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWREYXRhXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5XCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInRvcGljc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidGFibGVzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiZXF1YXRpb25zXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicGRmVGFibGVcIjogW10sXG4gICAgICAgICAgICAgICAgXCJpbWFnZXNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJhbGVydHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJ2ZXJzaW9uc1wiOiBbXSxcbiAgICAgICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKHBhZ2VUeXBlID09PSBcImFydGljbGVcIikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImVkaXRpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJfYWJzdHJhY3RcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlRGF0ZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcIm5leHRSZWxlYXNlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiY29udGFjdFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVsZXBob25lXCI6IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCJuYXRpb25hbFN0YXRpc3RpY1wiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgXCJtZXRhRGVzY3JpcHRpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic2VjdGlvbnNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJhY2NvcmRpb25cIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkRG9jdW1lbnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZERhdGFcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidG9waWNzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgICAgICAgICAgXCJjaGFydHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJ0YWJsZXNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJlcXVhdGlvbnNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJwZGZUYWJsZVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcImltYWdlc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcImFsZXJ0c1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInZlcnNpb25zXCI6IFtdLFxuICAgICAgICAgICAgICAgIHR5cGU6IHBhZ2VUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUgPT09IFwiYXJ0aWNsZV9kb3dubG9hZFwiKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiX2Fic3RyYWN0XCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWRpdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibmV4dFJlbGVhc2VcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjb250YWN0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZWxlcGhvbmVcIjogXCJcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcIm5hdGlvbmFsU3RhdGlzdGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcIm1hcmtkb3duXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiZG93bmxvYWRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZERvY3VtZW50c1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWREYXRhXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5XCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInRvcGljc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidGFibGVzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiZXF1YXRpb25zXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiaW1hZ2VzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiYWxlcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidmVyc2lvbnNcIjogW10sXG4gICAgICAgICAgICAgICAgdHlwZTogcGFnZVR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1Vuc3VwcG9ydGVkIHBhZ2UgdHlwZS4gVGhpcyBpcyBub3QgYW4gYXJ0aWNsZSBvciBhIGJ1bGxldGluJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBjb21wZW5kaXVtIGRvY3VtZW50c1xuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHJlbGVhc2VEYXRlXG4gKiBAcGFyYW0gcGFnZVR5cGVcbiAqIEBwYXJhbSBwYXJlbnRVcmxcbiAqIEBwYXJhbSBwYWdlVGl0bGVcbiAqL1xuXG5mdW5jdGlvbiBsb2FkVDZDcmVhdG9yKGNvbGxlY3Rpb25JZCwgcmVsZWFzZURhdGUsIHBhZ2VUeXBlLCBwYXJlbnRVcmwsIHBhZ2VUaXRsZSkge1xuICAgIHZhciByZWxlYXNlRGF0ZSA9IG51bGw7ICAgICAgICAgICAgIC8vb3ZlcndyaXRlIHNjaGVkdWxlZCBjb2xsZWN0aW9uIGRhdGVcbiAgICB2YXIgcGFnZVR5cGUsIHBhZ2VUaXRsZSwgcGFnZUVkaXRpb24sIHVyaVNlY3Rpb24sIHBhZ2VUaXRsZVRyaW1tZWQsIHBhZ2VFZGl0aW9uVHJpbW1lZCwgcmVsZWFzZURhdGVNYW51YWwsIGlzSW5oZXJpdGluZywgbmV3VXJpLCBwYWdlRGF0YSwgcGFyZW50RGF0YTtcbiAgICB2YXIgcGFyZW50VXJsRGF0YSA9IHBhcmVudFVybCArIFwiL2RhdGFcIjtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHBhcmVudFVybERhdGEsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoY2hlY2tEYXRhKSB7XG4gICAgICAgICAgICBwYXJlbnREYXRhID0gJC5leHRlbmQodHJ1ZSwge30sIGNoZWNrRGF0YSk7XG4gICAgICAgICAgICBpZiAoKGNoZWNrRGF0YS50eXBlID09PSAncHJvZHVjdF9wYWdlJyAmJiBwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJyAmJiAhRmxvcmVuY2UuZ2xvYmFsVmFycy53ZWxzaCkgfHxcbiAgICAgICAgICAgICAgICAoY2hlY2tEYXRhLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScgJiYgcGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2NoYXB0ZXInKSB8fFxuICAgICAgICAgICAgICAgIChjaGVja0RhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJyAmJiBwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fZGF0YScpKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50VXJsID0gY2hlY2tEYXRhLnVyaTtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YSA9IHBhZ2VUeXBlRGF0YVQ2KHBhZ2VUeXBlLCBjaGVja0RhdGEpO1xuICAgICAgICAgICAgICAgIGlmIChwYWdlVGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0Tm9Gb3JtKHBhcmVudFVybCwgcGFnZVRpdGxlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzdWJtaXRGb3JtSGFuZGxlcihwYXJlbnRVcmwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjaGVja0RhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJyAmJiBwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICAgICAgICAgIHBhcmVudFVybCA9IGdldFBhcmVudFBhZ2UoY2hlY2tEYXRhLnVyaSk7XG4gICAgICAgICAgICAgICAgcGFnZVRpdGxlID0gY2hlY2tEYXRhLmRlc2NyaXB0aW9uLnRpdGxlO1xuICAgICAgICAgICAgICAgIGlzSW5oZXJpdGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGFnZURhdGEgPSBwYWdlVHlwZURhdGFUNihwYWdlVHlwZSwgY2hlY2tEYXRhKTtcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtSGFuZGxlcihwYXJlbnRVcmwsIHBhZ2VUaXRsZSwgaXNJbmhlcml0aW5nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgcGxhY2UgdG8gY3JlYXRlIHRoaXMgcGFnZS5cIik7XG4gICAgICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihwYXJlbnRVcmwsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gcGFnZSBkYXRhIHJldHVybmVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHN1Ym1pdEZvcm1IYW5kbGVyKHBhcmVudFVybCwgdGl0bGUsIGlzSW5oZXJpdGluZykge1xuICAgICAgICAkKCcuZWRpdGlvbicpLmVtcHR5KCk7XG4gICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICAgICAgJCgnLmVkaXRpb24nKS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9XCJlZGl0aW9uXCI+RWRpdGlvbjwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgJzxpbnB1dCBpZD1cImVkaXRpb25cIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiQXVndXN0IDIwMTAsIFEzIDIwMTUsIDE5NzgsIGV0Yy5cIiAvPicgK1xuICAgICAgICAgICAgICAgICc8YnI+JyArXG4gICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9XCJyZWxlYXNlRGF0ZVwiPlJlbGVhc2UgZGF0ZTwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgJzxpbnB1dCBpZD1cInJlbGVhc2VEYXRlXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cImRheSBtb250aCB5ZWFyXCIgLz4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY3JlYXRvckRhdGVQaWNrZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgIHBhZ2VUaXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgJCgnI3BhZ2VuYW1lJykudmFsKHRpdGxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJ2Zvcm0nKS5vZmYoKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJlbGVhc2VEYXRlTWFudWFsID0gJCgnI3JlbGVhc2VEYXRlJykudmFsKCk7XG5cbiAgICAgICAgICAgIC8vIElucHV0IHZhbGlkYXRpb25cbiAgICAgICAgICAgIHZhciBuYW1lVmFsaWQgPSB2YWxpZGF0ZVBhZ2VOYW1lKCk7XG4gICAgICAgICAgICB2YXIgZWRpdGlvblZhbGlkID0gdmFsaWRhdGVQYWdlTmFtZSgnI2VkaXRpb24nKTtcbiAgICAgICAgICAgIGlmICghbmFtZVZhbGlkIHx8ICFlZGl0aW9uVmFsaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24gPSAkKCcjZWRpdGlvbicpLnZhbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aXRsZSkge1xuICAgICAgICAgICAgICAgIHBhZ2VUaXRsZSA9ICQoJyNwYWdlbmFtZScpLnZhbCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9IHBhZ2VUaXRsZTtcbiAgICAgICAgICAgIHBhZ2VUaXRsZVRyaW1tZWQgPSBwYWdlVGl0bGUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgcGFnZUVkaXRpb24gPSBwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uO1xuICAgICAgICAgICAgcGFnZUVkaXRpb25UcmltbWVkID0gcGFnZUVkaXRpb24ucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09PSAnY29tcGVuZGl1bV9sYW5kaW5nX3BhZ2UnICYmIHJlbGVhc2VEYXRlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLnZhbCgpKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScgJiYgcmVsZWFzZURhdGUpIHtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IHJlbGVhc2VEYXRlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNJbmhlcml0aW5nICYmIHBhZ2VUeXBlID09PSAnY29tcGVuZGl1bV9sYW5kaW5nX3BhZ2UnKSB7XG4gICAgICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsIHBhZ2VFZGl0aW9uVHJpbW1lZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICAgICAgICAgIHVyaVNlY3Rpb24gPSBcImNvbXBlbmRpdW1cIjtcbiAgICAgICAgICAgICAgICBuZXdVcmkgPSBtYWtlVXJsKHBhcmVudFVybCwgdXJpU2VjdGlvbiwgcGFnZVRpdGxlVHJpbW1lZCwgcGFnZUVkaXRpb25UcmltbWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fY2hhcHRlcicpIHx8IChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fZGF0YScpKSB7XG4gICAgICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsIHBhZ2VUaXRsZVRyaW1tZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnT29wcyEgU29tZXRoaW5nIHdlbnQgdGhlIHdyb25nLicsIFwiXCIsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihwYXJlbnRVcmwsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2FmZU5ld1VyaSA9IGNoZWNrUGF0aFNsYXNoZXMobmV3VXJpKTtcblxuICAgICAgICAgICAgaWYgKChwYWdlVHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykgJiYgKCFwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uKSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ0VkaXRpb24gY2FuIG5vdCBiZSBlbXB0eScpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpICYmICghcGFnZURhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUpKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnUmVsZWFzZSBkYXRlIGNhbiBub3QgYmUgZW1wdHknKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFnZVRpdGxlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYWdlVGl0bGUudG9Mb3dlckNhc2UoKSA9PT0gJ2N1cnJlbnQnIHx8IHBhZ2VUaXRsZS50b0xvd2VyQ2FzZSgpID09PSAnbGF0ZXN0Jykge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBzYWZlTmV3VXJpLCBKU09OLnN0cmluZ2lmeShwYWdlRGF0YSksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjb21wbGV0ZWQgXCIgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYWdlRGF0YS50eXBlID09PSAnY29tcGVuZGl1bV9sYW5kaW5nX3BhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld1dvcmtzcGFjZShzYWZlTmV3VXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoc2FmZU5ld1VyaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2NoYXB0ZXInKSB8fCAocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2RhdGEnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVBhcmVudExpbmsoc2FmZU5ld1VyaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGNyZWF0ZSB0aGlzIHBhZ2VcIiwgXCJJdCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWJtaXROb0Zvcm0ocGFyZW50VXJsLCB0aXRsZSkge1xuXG4gICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHBhZ2VUaXRsZVRyaW1tZWQgPSB0aXRsZS5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIGlmICgocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2NoYXB0ZXInKSB8fCAocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2RhdGEnKSkge1xuICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsIHBhZ2VUaXRsZVRyaW1tZWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydCgnT29wcyEgU29tZXRoaW5nIHdlbnQgdGhlIHdyb25nIHdheS4nKTtcbiAgICAgICAgICAgIGxvYWRDcmVhdGVTY3JlZW4ocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNhZmVOZXdVcmkgPSBjaGVja1BhdGhTbGFzaGVzKG5ld1VyaSk7XG5cbiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHBhZ2UgZXhpc3RzXG4gICAgICAgIGdldFBhZ2VEYXRhKGNvbGxlY3Rpb25JZCwgc2FmZU5ld1VyaSxcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydCgnVGhpcyBwYWdlIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gaWYgdGhlIHBhZ2UgZG9lcyBub3QgZXhpc3QsIGNyZWF0ZSBpdFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHNhZmVOZXdVcmksIEpTT04uc3RyaW5naWZ5KHBhZ2VEYXRhKSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0aW5nIGNvbXBsZXRlZCBcIiArIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlUGFyZW50TGluayhzYWZlTmV3VXJpKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2UuIEl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwYWdlVHlwZURhdGFUNihwYWdlVHlwZSwgY2hlY2tEYXRhKSB7XG5cbiAgICAgICAgaWYgKHBhZ2VUeXBlID09PSBcImNvbXBlbmRpdW1fbGFuZGluZ19wYWdlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuZXh0UmVsZWFzZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwic3VtbWFyeVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcIm5hdGlvbmFsU3RhdGlzdGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWRpdGlvblwiOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcImRhdGFzZXRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiY2hhcHRlcnNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkRG9jdW1lbnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwicmVsYXRlZERhdGFcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidG9waWNzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiYWxlcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIHR5cGU6IHBhZ2VUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2NoYXB0ZXInKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcIm5leHRSZWxlYXNlXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5uZXh0UmVsZWFzZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjogY2hlY2tEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVsZXBob25lXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LnRlbGVwaG9uZSB8fCBcIlwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwiX2Fic3RyYWN0XCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYXV0aG9yc1wiOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuYXRpb25hbFN0YXRpc3RpY1wiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMsXG4gICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJoZWFkbGluZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJzZWN0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcImFjY29yZGlvblwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWREb2N1bWVudHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkRGF0YVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neUFydGljbGVcIjogW10sXG4gICAgICAgICAgICAgICAgXCJleHRlcm5hbExpbmtzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiY2hhcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidGFibGVzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiaW1hZ2VzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidmVyc2lvbnNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJhbGVydHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJwZGZUYWJsZVwiOiBbXSxcbiAgICAgICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKHBhZ2VUeXBlID09PSAnY29tcGVuZGl1bV9kYXRhJykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlRGF0ZVwiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuZXh0UmVsZWFzZVwiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ubmV4dFJlbGVhc2UgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjb250YWN0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LmVtYWlsIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmUgfHwgXCJcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcInN1bW1hcnlcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkYXRhc2V0SWRcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IGNoZWNrRGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuYXRpb25hbFN0YXRpc3RpY1wiOiBjaGVja0RhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMsXG4gICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJkb3dubG9hZHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJ2ZXJzaW9uc1wiOiBbXSwgLy97ZGF0ZSwgdXJpLCBjb3JyZWN0aW9uTm90aWNlfVxuICAgICAgICAgICAgICAgIFwicmVsYXRlZERvY3VtZW50c1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neUFydGljbGVcIjogW10sXG4gICAgICAgICAgICAgICAgdHlwZTogcGFnZVR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1Vuc3VwcG9ydGVkIHBhZ2UgdHlwZS4gVGhpcyBpcyBub3QgYSBjb21wZW5kaXVtIGZpbGUgdHlwZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlUGFyZW50TGluayhjaGlsZFVyaSkge1xuICAgICAgICBpZiAocGFnZVR5cGUgPT09IFwiY29tcGVuZGl1bV9jaGFwdGVyXCIpIHtcbiAgICAgICAgICAgIHBhcmVudERhdGEuY2hhcHRlcnMucHVzaCh7dXJpOiBjaGlsZFVyaX0pXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUgPT09ICdjb21wZW5kaXVtX2RhdGEnKSB7XG4gICAgICAgICAgICBwYXJlbnREYXRhLmRhdGFzZXRzLnB1c2goe3VyaTogY2hpbGRVcml9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydCgnT29wcyEgU29tZXRoaW5nIHdlbnQgdGhlIHdyb25nIHdheS4nKTtcbiAgICAgICAgICAgIGxvYWRDcmVhdGVTY3JlZW4ocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICB9XG4gICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXJlbnRVcmwsIEpTT04uc3RyaW5naWZ5KHBhcmVudERhdGEpLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdmlld1dvcmtzcGFjZShjaGlsZFVyaSwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGNoaWxkVXJpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBhcmVudCBsaW5rIHVwZGF0aW5nIGNvbXBsZXRlZCBcIiArIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2UuIEl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBzdGF0aWMgcGFnZXMnIEpTT05cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSByZWxlYXNlRGF0ZVxuICogQHBhcmFtIHBhZ2VUeXBlXG4gKiBAcGFyYW0gcGFyZW50VXJsXG4gKi9cblxuZnVuY3Rpb24gbG9hZFQ3Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsKSB7XG4gICAgdmFyIHJlbGVhc2VEYXRlID0gbnVsbDsgICAgICAgICAgICAgLy9vdmVyd3JpdGUgc2NoZWR1bGVkIGNvbGxlY3Rpb24gZGF0ZVxuICAgIHZhciBwYWdlTmFtZSwgcGFnZU5hbWVUcmltbWVkLCBuZXdVcmksIHBhZ2VEYXRhLCBpc051bWJlcjtcbiAgICBpZiAocGFyZW50VXJsID09PSAnLycpIHsgICAgICAgIC8vdG8gY2hlY2sgaG9tZSBwYWdlXG4gICAgICAgIHBhcmVudFVybCA9ICcnO1xuICAgIH1cbiAgICB2YXIgcGFyZW50VXJsRGF0YSA9IHBhcmVudFVybCArIFwiL2RhdGFcIjtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHBhcmVudFVybERhdGEsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoY2hlY2tEYXRhKSB7XG4gICAgICAgICAgICBpZiAocGFnZVR5cGUgPT09ICdzdGF0aWNfbGFuZGluZ19wYWdlJyAmJiBjaGVja0RhdGEudHlwZSA9PT0gJ2hvbWVfcGFnZScgfHxcbiAgICAgICAgICAgICAgICAocGFnZVR5cGUgPT09ICdzdGF0aWNfcW1pJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19hZGhvYycgfHwgcGFnZVR5cGUgPT09ICdzdGF0aWNfbWV0aG9kb2xvZ3knIHx8IHBhZ2VUeXBlID09PSAnc3RhdGljX21ldGhvZG9sb2d5X2Rvd25sb2FkJykgJiYgY2hlY2tEYXRhLnR5cGUgPT09ICdwcm9kdWN0X3BhZ2UnIHx8XG4gICAgICAgICAgICAgICAgKHBhZ2VUeXBlID09PSAnc3RhdGljX2xhbmRpbmdfcGFnZScgfHwgcGFnZVR5cGUgPT09ICdzdGF0aWNfcGFnZScgfHwgcGFnZVR5cGUgPT09ICdzdGF0aWNfYXJ0aWNsZScpICYmIGNoZWNrRGF0YS50eXBlID09PSAnaG9tZV9wYWdlX2NlbnN1cycpIHtcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgocGFnZVR5cGUgPT09ICdzdGF0aWNfZm9pJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19wYWdlJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19hcnRpY2xlJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19sYW5kaW5nX3BhZ2UnKSAmJiBjaGVja0RhdGEudHlwZS5tYXRjaCgvc3RhdGljXy4rLykpIHtcbiAgICAgICAgICAgICAgICBzdWJtaXRGb3JtSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBwbGFjZSB0byBjcmVhdGUgdGhpcyBwYWdlLlwiKTtcbiAgICAgICAgICAgICAgICBsb2FkQ3JlYXRlU2NyZWVuKHBhcmVudFVybCwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBwYWdlIGRhdGEgcmV0dXJuZWQnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc3VibWl0Rm9ybUhhbmRsZXIoKSB7XG4gICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ3N0YXRpY19xbWknKSB7XG4gICAgICAgICAgICAkKCcuZWRpdGlvbicpLmFwcGVuZChcbiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj1cInJlbGVhc2VEYXRlXCI+TGFzdCByZXZpc2VkPC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAnPGlucHV0IGlkPVwicmVsZWFzZURhdGVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiZGF5IG1vbnRoIHllYXJcIiAvPidcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNyZWF0b3JEYXRlUGlja2VyKCk7XG4gICAgICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09ICdzdGF0aWNfYWRob2MnKSB7XG4gICAgICAgICAgICAkKCcuZWRpdGlvbicpLmFwcGVuZChcbiAgICAgICAgICAgICAgICAnPGxhYmVsIGZvcj1cInJlbGVhc2VEYXRlXCI+UmVsZWFzZSBkYXRlPC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAnPGlucHV0IGlkPVwicmVsZWFzZURhdGVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiZGF5IG1vbnRoIHllYXJcIiAvPicgK1xuICAgICAgICAgICAgICAgICc8YnI+JyArXG4gICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9XCJhZGhvYy1yZWZlcmVuY2VcIj5SZWZlcmVuY2U8L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICc8aW5wdXQgaWQ9XCJhZGhvYy1yZWZlcmVuY2VcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiUmVmZXJlbmNlIG51bWJlclwiIC8+J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNyZWF0b3JEYXRlUGlja2VyKCk7XG4gICAgICAgICAgICAkKCcjYWRob2MtcmVmZXJlbmNlJykub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlzTnVtYmVyID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTnVtYmVyLm1hdGNoKC9eXFxkKyQvKSkge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KCdUaGlzIG5lZWRzIHRvIGJlIGEgbnVtYmVyJyk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKCcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghcmVsZWFzZURhdGUgJiYgIShwYWdlVHlwZSA9PT0gJ3N0YXRpY19wYWdlJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19sYW5kaW5nX3BhZ2UnKSkge1xuICAgICAgICAgICAgJCgnLmVkaXRpb24nKS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJzxsYWJlbCBmb3I9XCJyZWxlYXNlRGF0ZVwiPlJlbGVhc2UgZGF0ZTwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgJzxpbnB1dCBpZD1cInJlbGVhc2VEYXRlXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cImRheSBtb250aCB5ZWFyXCIgLz4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY3JlYXRvckRhdGVQaWNrZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJ2Zvcm0nKS5vZmYoKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBuYW1lVmFsaWQgPSB2YWxpZGF0ZVBhZ2VOYW1lKCk7XG4gICAgICAgICAgICBpZiAoIW5hbWVWYWxpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhZ2VEYXRhID0gcGFnZVR5cGVEYXRhVDcocGFnZVR5cGUpO1xuICAgICAgICAgICAgcGFnZU5hbWUgPSAkKCcjcGFnZW5hbWUnKS52YWwoKS50cmltKCk7XG4gICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9IHBhZ2VOYW1lO1xuICAgICAgICAgICAgcGFnZU5hbWVUcmltbWVkID0gcGFnZU5hbWUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHBhZ2VEYXRhLmZpbGVOYW1lID0gcGFnZU5hbWVUcmltbWVkO1xuICAgICAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24ucmVmZXJlbmNlID0gaXNOdW1iZXI7XG4gICAgICAgICAgICB2YXIgYWRIb2NVcmwgPSBpc051bWJlciArIHBhZ2VOYW1lVHJpbW1lZDtcbiAgICAgICAgICAgIGlmIChwYWdlVHlwZSA9PT0gJ3N0YXRpY19xbWknICYmICFGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsICdxbWlzJywgcGFnZU5hbWVUcmltbWVkKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09ICdzdGF0aWNfYWRob2MnICYmICFGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsICdhZGhvY3MnLCBhZEhvY1VybCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKChwYWdlVHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neScgfHwgcGFnZVR5cGUgPT09ICdzdGF0aWNfbWV0aG9kb2xvZ3lfZG93bmxvYWQnKSAmJiAhRmxvcmVuY2UuZ2xvYmFsVmFycy53ZWxzaCkge1xuICAgICAgICAgICAgICAgIG5ld1VyaSA9IG1ha2VVcmwocGFyZW50VXJsLCAnbWV0aG9kb2xvZ2llcycsIHBhZ2VOYW1lVHJpbW1lZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybChwYXJlbnRVcmwsIHBhZ2VOYW1lVHJpbW1lZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1lvdSBjYW4gbm90IHBlcmZvcm0gdGhhdCBvcGVyYXRpb24gaW4gV2Vsc2guJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2FmZU5ld1VyaSA9IGNoZWNrUGF0aFNsYXNoZXMobmV3VXJpKTtcbiAgICAgICAgICAgIGlmIChyZWxlYXNlRGF0ZSAmJiAocGFnZVR5cGUgPT09ICdzdGF0aWNfcW1pJykpIHtcbiAgICAgICAgICAgICAgICBkYXRlID0gbmV3IERhdGUocmVsZWFzZURhdGUpO1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmxhc3RSZXZpc2VkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkL21tL3l5JywgZGF0ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlbGVhc2VEYXRlKSB7XG4gICAgICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKHJlbGVhc2VEYXRlKTtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9ICQuZGF0ZXBpY2tlci5mb3JtYXREYXRlKCdkZC9tbS95eScsIGRhdGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghcmVsZWFzZURhdGUgJiYgKHBhZ2VUeXBlID09PSAnc3RhdGljX3FtaScpKSB7XG4gICAgICAgICAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24ubGFzdFJldmlzZWQgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS52YWwoKSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAvL30gZWxzZSBpZiAoIXJlbGVhc2VEYXRlICYmIChwYWdlVHlwZSA9PT0gJ3N0YXRpY19wYWdlJyB8fCBwYWdlVHlwZSA9PT0gJ3N0YXRpY19hcnRpY2xlJykpIHtcbiAgICAgICAgICAgICAgICAvLyAgcGFnZURhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBcIjE5NzAtMDEtMDFUMDA6MDA6MDAuMDAwWlwiOyAgLy8gemViZWRlZSB0aHJvd3MgYSBKc29uU3ludGF4RXhjZXB0aW9uXG4gICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0ZSBpcyBwcmVzZW50XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFyZWxlYXNlRGF0ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkKCcjcmVsZWFzZURhdGUnKS52YWwoKSkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLnZhbCgpKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhZ2VOYW1lLmxlbmd0aCA8IDQpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiVGhpcyBpcyBub3QgYSB2YWxpZCBwYWdlIG5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJQYWdlIG5hbWVzIG11c3QgYmUgNCBjaGFyYWN0ZXJzIG9yIGxvbmdlclwiLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxvYWRDcmVhdGVTY3JlZW4ocGFyZW50VXJsLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzYXZlQ29udGVudChjb2xsZWN0aW9uSWQsIHNhZmVOZXdVcmksIHBhZ2VEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwYWdlVHlwZURhdGFUNyhwYWdlVHlwZSkge1xuXG4gICAgaWYgKHBhZ2VUeXBlID09PSBcInN0YXRpY19wYWdlXCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInN1bW1hcnlcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtYXJrZG93blwiOiBbXSxcbiAgICAgICAgICAgIFwiY2hhcnRzXCI6IFtdLFxuICAgICAgICAgICAgXCJ0YWJsZXNcIjogW10sXG4gICAgICAgICAgICBcImVxdWF0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgIFwiaW1hZ2VzXCI6IFtdLFxuICAgICAgICAgICAgXCJkb3dubG9hZHNcIjogW10sXG4gICAgICAgICAgICB0eXBlOiBwYWdlVHlwZSxcbiAgICAgICAgICAgIFwiYW5jaG9yc1wiOiBbXSxcbiAgICAgICAgICAgIFwibGlua3NcIjogW11cbiAgICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHBhZ2VUeXBlID09PSBcInN0YXRpY19sYW5kaW5nX3BhZ2VcIikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwic3VtbWFyeVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IFwiXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzZWN0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgIFwibWFya2Rvd25cIjogW10sXG4gICAgICAgICAgICB0eXBlOiBwYWdlVHlwZSxcbiAgICAgICAgICAgIFwibGlua3NcIjogW11cbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAocGFnZVR5cGUgPT09IFwic3RhdGljX2FydGljbGVcIikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwic3VtbWFyeVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IFwiXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInNlY3Rpb25zXCI6IFtdLFxuICAgICAgICAgICAgXCJjaGFydHNcIjogW10sXG4gICAgICAgICAgICBcInRhYmxlc1wiOiBbXSxcbiAgICAgICAgICAgIFwiZXF1YXRpb25zXCI6IFtdLFxuICAgICAgICAgICAgXCJpbWFnZXNcIjogW10sXG4gICAgICAgICAgICBcImFuY2hvcnNcIjogW10sXG4gICAgICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICAgICAgXCJhbGVydHNcIjogW10sXG4gICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICB9O1xuICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09IFwic3RhdGljX21ldGhvZG9sb2d5XCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInN1bW1hcnlcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJjb250YWN0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0ZWxlcGhvbmVcIjogXCJcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzZWN0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgIFwiYWNjb3JkaW9uXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRG9jdW1lbnRzXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRGF0YXNldHNcIjogW10sXG4gICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neVwiOiBbXSxcbiAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZVwiOiBbXSxcbiAgICAgICAgICAgIFwiY2hhcnRzXCI6IFtdLFxuICAgICAgICAgICAgXCJ0YWJsZXNcIjogW10sXG4gICAgICAgICAgICBcImVxdWF0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgIFwiaW1hZ2VzXCI6IFtdLFxuICAgICAgICAgICAgXCJkb3dubG9hZHNcIjogW10sXG4gICAgICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICAgICAgXCJwZGZUYWJsZVwiOiBbXSxcbiAgICAgICAgICAgIFwiYWxlcnRzXCI6IFtdLFxuICAgICAgICAgICAgdHlwZTogcGFnZVR5cGVcbiAgICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHBhZ2VUeXBlID09PSBcInN0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZFwiKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJjb250YWN0XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtYXJrZG93blwiOiBbXSxcbiAgICAgICAgICAgIFwiZG93bmxvYWRzXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRG9jdW1lbnRzXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRGF0YXNldHNcIjogW10sXG4gICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neVwiOiBbXSxcbiAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZVwiOiBbXSxcbiAgICAgICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgICAgICBcImFsZXJ0c1wiOiBbXSxcbiAgICAgICAgICAgIHR5cGU6IHBhZ2VUeXBlXG4gICAgICAgIH07XG4gICAgfSBlbHNlIGlmIChwYWdlVHlwZSA9PT0gXCJzdGF0aWNfcW1pXCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJlbWFpbFwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcInBob25lXCI6IFwiXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic3VydmV5TmFtZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwiZnJlcXVlbmN5XCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJjb21waWxhdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwiZ2VvZ3JhcGhpY0NvdmVyYWdlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJzYW1wbGVTaXplXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJsYXN0UmV2aXNlZFwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwibmF0aW9uYWxTdGF0aXN0aWNcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtYXJrZG93blwiOiBbXSxcbiAgICAgICAgICAgIFwiZG93bmxvYWRzXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRG9jdW1lbnRzXCI6IFtdLFxuICAgICAgICAgICAgXCJyZWxhdGVkRGF0YXNldHNcIjogW10sXG4gICAgICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neVwiOiBbXSxcbiAgICAgICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZVwiOiBbXSxcbiAgICAgICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICB9O1xuICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09IFwic3RhdGljX2ZvaVwiKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxlYXNlRGF0ZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwia2V5d29yZHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJtZXRhRGVzY3JpcHRpb25cIjogXCJcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZG93bmxvYWRzXCI6IFtdLFxuICAgICAgICAgICAgXCJtYXJrZG93blwiOiBbXSxcbiAgICAgICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICB9O1xuICAgIH0gZWxzZSBpZiAocGFnZVR5cGUgPT09IFwic3RhdGljX2FkaG9jXCIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjoge1xuICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJyZWZlcmVuY2VcIjogbnVsbCxcbiAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IFwiXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImRvd25sb2Fkc1wiOiBbXSxcbiAgICAgICAgICAgIFwibWFya2Rvd25cIjogW10sXG4gICAgICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICAgICAgdHlwZTogcGFnZVR5cGVcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBzd2VldEFsZXJ0KCdVbnN1cHBvcnRlZCBwYWdlIHR5cGUnLCAnVGhpcyBpcyBub3QgYSBzdGF0aWMgcGFnZScsIFwiaW5mb1wiKTtcbiAgICB9XG59LyoqXG4gKiBDcmVhdGVzIGRhdGEgSlNPTlxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSBwYWdlVHlwZVxuICogQHBhcmFtIHBhZ2VFZGl0aW9uXG4gKiBAcGFyYW0gZG93bmxvYWRVcmxcbiAqL1xuXG5mdW5jdGlvbiBsb2FkVDhFZGl0aW9uQ3JlYXRvcihjb2xsZWN0aW9uSWQsIGRhdGEsIHBhZ2VUeXBlLCBwYWdlRWRpdGlvbiwgZG93bmxvYWRVcmwsIHZlcnNpb25MYWJlbCkge1xuICAgIHZhciByZWxlYXNlRGF0ZSA9IG51bGw7ICAgICAgICAgICAgIC8vb3ZlcndyaXRlIHNjaGVkdWxlZCBjb2xsZWN0aW9uIGRhdGVcbiAgICB2YXIgcGFnZUVkaXRpb25UcmltbWVkLCBuZXdVcmksIHBhZ2VEYXRhO1xuXG4gICAgcGFnZURhdGEgPSBwYWdlVHlwZURhdGFUOChwYWdlVHlwZSwgZGF0YSk7XG4gICAgc3VibWl0Tm9Gb3JtKGRhdGEudXJpLCBwYWdlRWRpdGlvbiwgZG93bmxvYWRVcmwsIHZlcnNpb25MYWJlbCk7XG5cbiAgICBmdW5jdGlvbiBzdWJtaXROb0Zvcm0ocGFyZW50VXJsLCBlZGl0aW9uLCBkb3dubG9hZFVybCkge1xuICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gZWRpdGlvbjtcbiAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24udmVyc2lvbkxhYmVsID0gdmVyc2lvbkxhYmVsO1xuICAgICAgICBwYWdlRGF0YS5kb3dubG9hZHMucHVzaCh7ZmlsZTogZG93bmxvYWRVcmx9KTtcbiAgICAgICAgcGFnZUVkaXRpb25UcmltbWVkID0gZWRpdGlvbi5yZXBsYWNlKC9bXkEtWjAtOV0rL2lnLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIGlmICgocGFnZVR5cGUgPT09ICdkYXRhc2V0JykgfHwgKHBhZ2VUeXBlID09PSAndGltZXNlcmllc19kYXRhc2V0JykpIHtcbiAgICAgICAgICAgIG5ld1VyaSA9IG1ha2VVcmwocGFyZW50VXJsLCBwYWdlRWRpdGlvblRyaW1tZWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydCgnT29wcyEgU29tZXRoaW5nIHdlbnQgdGhlIHdyb25nLicpO1xuICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihwYXJlbnRVcmwsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2FmZU5ld1VyaSA9IGNoZWNrUGF0aFNsYXNoZXMobmV3VXJpKTtcblxuICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgc2FmZU5ld1VyaSwgSlNPTi5zdHJpbmdpZnkocGFnZURhdGEpLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGNyZWF0ZSB0aGlzIHBhZ2VcIiwgXCJJdCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhZ2VUeXBlRGF0YVQ4KHBhZ2VUeXBlLCBwYXJlbnREYXRhKSB7XG5cbiAgICAgICAgaWYgKHBhZ2VUeXBlID09PSBcImRhdGFzZXRcIikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlRGF0ZVwiOiBwYXJlbnREYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZWRpdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcInZlcnNpb25MYWJlbFwiOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInZlcnNpb25zXCI6IFtdLCAvL3t1cGRhdGVEYXRlLCB1cmksIGNvcnJlY3Rpb25Ob3RpY2UsIGxhYmVsfVxuICAgICAgICAgICAgICAgIFwiZG93bmxvYWRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwic3VwcGxlbWVudGFyeUZpbGVzXCI6IFtdLFxuICAgICAgICAgICAgICAgIHR5cGU6IHBhZ2VUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAocGFnZVR5cGUgPT09IFwidGltZXNlcmllc19kYXRhc2V0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogcGFyZW50RGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImVkaXRpb25cIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ2ZXJzaW9uTGFiZWxcIjogXCJcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJ2ZXJzaW9uc1wiOiBbXSwgLy97dXBkYXRlRGF0ZSwgdXJpLCBjb3JyZWN0aW9uTm90aWNlLCBsYWJlbH1cbiAgICAgICAgICAgICAgICBcImRvd25sb2Fkc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInN1cHBsZW1lbnRhcnlGaWxlc1wiOiBbXSxcbiAgICAgICAgICAgICAgICB0eXBlOiBwYWdlVHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydCgnVW5zdXBwb3J0ZWQgcGFnZSB0eXBlJywgJ1RoaXMgaXMgbm90IGEgZGF0YXNldCB0eXBlJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBkYXRhIEpTT05cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSByZWxlYXNlRGF0ZVxuICogQHBhcmFtIHBhZ2VUeXBlXG4gKiBAcGFyYW0gcGFyZW50VXJsXG4gKi9cblxuZnVuY3Rpb24gbG9hZFQ4Q3JlYXRvcihjb2xsZWN0aW9uSWQsIHJlbGVhc2VEYXRlLCBwYWdlVHlwZSwgcGFyZW50VXJsLCBwYWdlVGl0bGUpIHtcbiAgICB2YXIgcmVsZWFzZURhdGUgPSBudWxsOyAgICAgICAgICAgICAvL292ZXJ3cml0ZSBzY2hlZHVsZWQgY29sbGVjdGlvbiBkYXRlXG4gICAgdmFyIHVyaVNlY3Rpb24sIHBhZ2VUaXRsZVRyaW1tZWQsIHJlbGVhc2VEYXRlTWFudWFsLCBuZXdVcmksIHBhZ2VEYXRhO1xuICAgIHZhciBwYXJlbnRVcmxEYXRhID0gcGFyZW50VXJsICsgXCIvZGF0YVwiO1xuICAgIC8vIHdpbGwgYWRkIHRoaXMgdmFyIGluIGRhdGFzZXRfbGFuZGluZ19wYWdlXG4gICAgdmFyIHRpbWVzZXJpZXMgPSBmYWxzZTtcbiAgICBpZiAocGFnZVR5cGUgPT09ICd0aW1lc2VyaWVzX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgdGltZXNlcmllcyA9IHRydWU7XG4gICAgICAgIHBhZ2VUeXBlID0gJ2RhdGFzZXRfbGFuZGluZ19wYWdlJztcbiAgICB9XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHBhcmVudFVybERhdGEsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoY2hlY2tEYXRhKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2tEYXRhLnR5cGUgPT09ICdwcm9kdWN0X3BhZ2UnICYmICFGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0Rm9ybUhhbmRsZXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgcGxhY2UgdG8gY3JlYXRlIHRoaXMgcGFnZS5cIik7XG4gICAgICAgICAgICAgICAgbG9hZENyZWF0ZVNjcmVlbihwYXJlbnRVcmwsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gcGFnZSBkYXRhIHJldHVybmVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHN1Ym1pdEZvcm1IYW5kbGVyKCkge1xuXG4gICAgICAgIGlmICghcmVsZWFzZURhdGUpIHtcbiAgICAgICAgICAgICQoJy5lZGl0aW9uJykuYXBwZW5kKFxuICAgICAgICAgICAgICAgICc8bGFiZWwgZm9yPVwicmVsZWFzZURhdGVcIj5SZWxlYXNlIGRhdGU8L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICc8aW5wdXQgaWQ9XCJyZWxlYXNlRGF0ZVwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJkYXkgbW9udGggeWVhclwiIC8+J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNyZWF0b3JEYXRlUGlja2VyKCk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCdmb3JtJykub2ZmKCkuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgbmFtZVZhbGlkID0gdmFsaWRhdGVQYWdlTmFtZSgpO1xuICAgICAgICAgICAgaWYgKCFuYW1lVmFsaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlbGVhc2VEYXRlTWFudWFsID0gJCgnI3JlbGVhc2VEYXRlJykudmFsKClcbiAgICAgICAgICAgIHBhZ2VEYXRhID0gcGFnZVR5cGVEYXRhVDgocGFnZVR5cGUpO1xuICAgICAgICAgICAgcGFnZVRpdGxlID0gJCgnI3BhZ2VuYW1lJykudmFsKCk7XG4gICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9IHBhZ2VUaXRsZTtcbiAgICAgICAgICAgIHBhZ2VEYXRhLnRpbWVzZXJpZXMgPSB0aW1lc2VyaWVzO1xuICAgICAgICAgICAgdXJpU2VjdGlvbiA9IFwiZGF0YXNldHNcIjtcbiAgICAgICAgICAgIHBhZ2VUaXRsZVRyaW1tZWQgPSBwYWdlVGl0bGUucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKCFyZWxlYXNlRGF0ZSkge1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCgnI3JlbGVhc2VEYXRlJykudmFsKCkpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gcmVsZWFzZURhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdVcmkgPSBtYWtlVXJsKHBhcmVudFVybCwgdXJpU2VjdGlvbiwgcGFnZVRpdGxlVHJpbW1lZCk7XG4gICAgICAgICAgICB2YXIgc2FmZU5ld1VyaSA9IGNoZWNrUGF0aFNsYXNoZXMobmV3VXJpKTtcblxuICAgICAgICAgICAgaWYgKCFwYWdlRGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1JlbGVhc2UgZGF0ZSBjYW4gbm90IGJlIGVtcHR5Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGFnZVRpdGxlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhpcyBpcyBub3QgYSB2YWxpZCBmaWxlIHRpdGxlXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2F2ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBzYWZlTmV3VXJpLCBwYWdlRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhZ2VUeXBlRGF0YVQ4KHBhZ2VUeXBlKSB7XG5cbiAgICAgICAgaWYgKHBhZ2VUeXBlID09PSBcImRhdGFzZXRfbGFuZGluZ19wYWdlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuZXh0UmVsZWFzZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImVtYWlsXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFwic3VtbWFyeVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImRhdGFzZXRJZFwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcImtleXdvcmRzXCI6IFtdLFxuICAgICAgICAgICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBcIm5hdGlvbmFsU3RhdGlzdGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwidGltZXNlcmllc1wiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBcImRhdGFzZXRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwic2VjdGlvblwiOiB7fSwgICAgICAvL25vdGVzXG4gICAgICAgICAgICAgICAgXCJjb3JyZWN0aW9uc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWREYXRhc2V0c1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcInJlbGF0ZWREb2N1bWVudHNcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lcIjogW10sXG4gICAgICAgICAgICAgICAgXCJyZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwidG9waWNzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiYWxlcnRzXCI6IFtdLFxuICAgICAgICAgICAgICAgIFwibGlua3NcIjogW10sXG4gICAgICAgICAgICAgICAgdHlwZTogcGFnZVR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KCdVbnN1cHBvcnRlZCBwYWdlIHR5cGUuIFRoaXMgaXMgbm90IGEgZGF0YXNldCB0eXBlJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGxvYWRUYWJsZUJ1aWxkZXIocGFnZURhdGEsIG9uU2F2ZSwgdGFibGUpIHtcbiAgdmFyIHBhZ2VVcmwgPSBwYWdlRGF0YS51cmk7XG4gIHZhciBodG1sID0gdGVtcGxhdGVzLnRhYmxlQnVpbGRlcih0YWJsZSk7XG4gIHZhciBwcmV2aWV3VGFibGU7XG4gIHZhciBwYXRoO1xuICB2YXIgeGxzUGF0aDtcbiAgdmFyIGh0bWxQYXRoO1xuICB2YXIgY3VycmVudFRhYmxlID0gdGFibGU7XG5cbiAgJCgnYm9keScpLmFwcGVuZChodG1sKTtcblxuICBpZiAodGFibGUpIHtcbiAgICByZW5kZXJUYWJsZSh0YWJsZS51cmkpO1xuICAgICQoJyN0YWJsZS1tb2RpZnktZm9ybScpLnNob3coKTtcbiAgfVxuXG4gIC8qKiBVcGxvYWQgYSBYTFMgZmlsZSAqKi9cbiAgJCgnI3VwbG9hZC10YWJsZS1mb3JtJykuc3VibWl0KGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgkKHRoaXMpWzBdKTtcbiAgICBwcmV2aWV3VGFibGUgPSBidWlsZEpzb25PYmplY3RGcm9tRm9ybShwcmV2aWV3VGFibGUpO1xuXG4gICAgaWYgKCAkKFwiI2ZpbGVzXCIpLnZhbCgpICkge1xuICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlVGFibGVNb2RpZmljYXRpb25zKHByZXZpZXdUYWJsZSk7XG4gICAgICBpZiAoIWVycm9ycy5leGlzdCgpKSB7XG4gICAgICAgIHVwbG9hZEZpbGUocHJldmlld1RhYmxlLCBmb3JtRGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlcnJvcnMuc2hvdygpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJWYWxpZGF0aW9uIGVycm9yXCIsIFwiUGxlYXNlIHNlbGVjdCBhIC54bHMgZmlsZSB0byB1cGxvYWQuXCIpO1xuICAgIH1cbiAgfSk7XG5cbiAgICAvKiogVXBsb2FkIHRoZSBmaWxlLiAqKi9cbiAgZnVuY3Rpb24gdXBsb2FkRmlsZShwcmV2aWV3VGFibGUsIGZvcm1EYXRhKSB7XG4gICAgcGF0aCA9IHByZXZpZXdUYWJsZS51cmk7XG4gICAgeGxzUGF0aCA9IHBhdGggKyBcIi54bHNcIjtcbiAgICBodG1sUGF0aCA9IHBhdGggKyBcIi5odG1sXCI7XG5cbiAgICAvLyBzZW5kIHhscyBmaWxlIHRvIHplYmVkZWVcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsgeGxzUGF0aCxcbiAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICBjcmVhdGVUYWJsZUh0bWwocHJldmlld1RhYmxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjdXJyZW50VGFibGUgPSBwcmV2aWV3VGFibGU7XG4gICAgJCgnI3RhYmxlLW1vZGlmeS1mb3JtJykuc2hvdygpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gICAgLyoqIENyZWF0ZSBIVE1MICoqL1xuICBmdW5jdGlvbiBjcmVhdGVUYWJsZUh0bWwocHJldmlld1RhYmxlKSB7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogXCIvemViZWRlZS90YWJsZS9cIiArIEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQgKyBcIj91cmk9XCIgKyB4bHNQYXRoLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkocHJldmlld1RhYmxlKSxcbiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGh0bWwpIHtcbiAgICAgICAgc2F2ZVRhYmxlSnNvbihwcmV2aWV3VGFibGUsIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2F2ZVRhYmxlSHRtbChodG1sKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzYXZlVGFibGVKc29uKHRhYmxlLCBzdWNjZXNzKSB7XG4gICAgdmFyIHRhYmxlSnNvbiA9IHRhYmxlLnVyaSArIFwiLmpzb25cIjtcblxuICAgICQuYWpheCh7XG4gICAgICB1cmw6IFwiL3plYmVkZWUvY29udGVudC9cIiArIEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQgKyBcIj91cmk9XCIgKyB0YWJsZUpzb24sXG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh0YWJsZSksXG4gICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgIHN1Y2Nlc3MoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqIFNhdmUgSFRNTCAqKi9cbiAgZnVuY3Rpb24gc2F2ZVRhYmxlSHRtbChkYXRhKSB7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogXCIvemViZWRlZS9jb250ZW50L1wiICsgRmxvcmVuY2UuY29sbGVjdGlvbi5pZCArIFwiP3VyaT1cIiArIGh0bWxQYXRoICsgXCImdmFsaWRhdGVKc29uPWZhbHNlXCIsXG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICBhZGRGaWxlc1RvUHJldmlldygpO1xuICAgICAgICByZW5kZXJUYWJsZShwYXRoKTtcbiAgICAgICAgJCgnI3RhYmxlLW1ldGFkYXRhLWZvcm0nKS5zbGlkZURvd24oXCJzbG93XCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkRmlsZXNUb1ByZXZpZXcoKSB7XG4gICAgcHJldmlld1RhYmxlLmZpbGVzID0gW107XG4gICAgcHJldmlld1RhYmxlLmZpbGVzLnB1c2goe3R5cGU6ICdkb3dubG9hZC14bHMnLCBmaWxlbmFtZTogcHJldmlld1RhYmxlLmZpbGVuYW1lICsgJy54bHMnfSk7XG4gICAgcHJldmlld1RhYmxlLmZpbGVzLnB1c2goe3R5cGU6ICdodG1sJywgZmlsZW5hbWU6IHByZXZpZXdUYWJsZS5maWxlbmFtZSArICcuaHRtbCd9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlclRhYmxlKHBhdGgpIHtcbiAgICB2YXIgaWZyYW1lTWFya3VwID0gJzxpZnJhbWUgaWQ9XCJwcmV2aWV3LWZyYW1lXCIgc3R5bGU9XCJvcGFjaXR5OjBcIiBmcmFtZUJvcmRlciA9XCIwXCIgc2Nyb2xsaW5nID0gXCJ5ZXNcIiBzcmM9XCInICsgcGF0aCArICdcIj48L2lmcmFtZT4nO1xuICAgICQoJyNwcmV2aWV3LXRhYmxlJykuaHRtbChpZnJhbWVNYXJrdXApO1xuICAgIHZhciBpZnJhbWUgPSAkKCcjcHJldmlldy1mcmFtZScpO1xuICAgIGlmcmFtZS5sb2FkKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjb250ZW50cyA9IGlmcmFtZS5jb250ZW50cygpO1xuICAgICAgY29udGVudHMuZmluZCgnYm9keScpLmNzcyhcImJhY2tncm91bmRcIiwgXCJ0cmFuc3BhcmVudFwiKTtcbiAgICAgIGNvbnRlbnRzLmZpbmQoJ2JvZHknKS5jc3MoXCJ3aWR0aFwiLCBcIjQ4MHB4XCIpO1xuICAgICAgY29udGVudHMuZmluZCgnLm1hcmtkb3duLXRhYmxlLXdyYXAnKS5jc3MoJ3dpZHRoJywgJzcwMHB4Jyk7XG4gICAgICBpZnJhbWUuaGVpZ2h0KGNvbnRlbnRzLmZpbmQoJ2h0bWwnKS5oZWlnaHQoKSk7XG4gICAgICBpZnJhbWUuY3NzKFwib3BhY2l0eVwiLCBcIjFcIik7XG4gICAgfSk7XG4gIH1cblxuICAvKiogU3VibWl0IG1vZGlmaWNhdGlvbnMgZGV0YWlscy4gKiovXG4gICQoJyN0YWJsZS1tb2RpZnktZm9ybScpLnN1Ym1pdChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHByZXZpZXdNb2RpZmljYXRpb25zKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHByZXZpZXdNb2RpZmljYXRpb25zKCkge1xuICAgIHByZXZpZXdUYWJsZSA9IGJ1aWxkSnNvbk9iamVjdEZyb21Gb3JtKHByZXZpZXdUYWJsZSk7XG4gICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlVGFibGVNb2RpZmljYXRpb25zKHByZXZpZXdUYWJsZSk7XG5cbiAgICBpZiAoIWVycm9ycy5leGlzdCgpKSB7XG4gICAgICAgIHBvc3RNb2RpZnlUYWJsZUZvcm0ocHJldmlld1RhYmxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBlcnJvcnMuc2hvdygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBWYWxpZGF0ZSB0aGUgZm9ybSBjb250YWlucyBjb3JyZWN0IGRhdGEuICoqL1xuICBmdW5jdGlvbiB2YWxpZGF0ZVRhYmxlTW9kaWZpY2F0aW9ucyh0YWJsZURhdGEpIHtcbiAgICB2YXIgZXJyb3JzID0ge1xuICAgICAgICBtZXNzYWdlczogW10sXG4gICAgICAgIGV4aXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5sZW5ndGggPiAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgbXNnID0gXCJcIjtcbiAgICAgICAgICB0aGlzLm1lc3NhZ2VzLmZvckVhY2goIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICBtc2cgPSBtc2cgKyBpdGVtICsgXCJcXG5cIjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzd2VldEFsZXJ0KFwiVmFsaWRhdGlvbiBlcnJvclwiLCBtc2cpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIG1vZHMgPSB0YWJsZURhdGEubW9kaWZpY2F0aW9ucztcbiAgICB2YWxpZGF0ZUxpc3QobW9kcy5yb3dzRXhjbHVkZWQsIFwiUm93cyBFeGNsdWRlZFwiLCBlcnJvcnMpO1xuICAgIHZhbGlkYXRlTGlzdChtb2RzLmhlYWRlclJvd3MsIFwiVGFibGUgSGVhZGVyIFJvd3NcIiwgZXJyb3JzKTtcbiAgICB2YWxpZGF0ZUxpc3QobW9kcy5oZWFkZXJDb2x1bW5zLCBcIlRhYmxlIEhlYWRlciBDb2x1bW5zXCIsIGVycm9ycyk7XG5cbiAgICBpZiAobW9kcy5yb3dzRXhjbHVkZWQubGVuZ3RoID4gMCAmJiBtb2RzLmhlYWRlclJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICBtb2RzLmhlYWRlclJvd3MuZm9yRWFjaCggZnVuY3Rpb24gKGhlYWRlcikge1xuICAgICAgICAgICAgaWYgKCQuaW5BcnJheShoZWFkZXIsIG1vZHMucm93c0V4Y2x1ZGVkKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JzLm1lc3NhZ2VzLnB1c2goXCJSb3cgXCIgKyBoZWFkZXIgKyBcIiBpcyBleGNsdWRlZCBhbmQgY2Fubm90IGJlIHNldCBhcyBhIEhlYWRlciBSb3cuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfVxuXG4gIC8qKiBQb3N0IHRoZSBtb2RpZnkgdGFibGUgZm9ybS4gKiovXG4gIGZ1bmN0aW9uIHBvc3RNb2RpZnlUYWJsZUZvcm0odGFibGVEYXRhKSB7XG4gICAgdmFyIGN1cnJlbnRVcmkgPSBjdXJyZW50VGFibGUgPyBjdXJyZW50VGFibGUudXJpIDogdGFibGVEYXRhLnVyaTtcbiAgICB2YXIgdGFibGVNZXRhZGF0YVVybCA9IFwiL3plYmVkZWUvbW9kaWZ5dGFibGUvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/Y3VycmVudFVyaT1cIiArIGN1cnJlbnRVcmkgKyBcIiZuZXdVcmk9XCIgKyB0YWJsZURhdGEudXJpICsgXCImdmFsaWRhdGVKc29uPWZhbHNlXCI7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiB0YWJsZU1ldGFkYXRhVXJsLFxuICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh0YWJsZURhdGEpLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgZ2V0U2F2ZWRUYWJsZU1vZGlmaWNhdGlvbnModGFibGVEYXRhLnVyaSk7XG4gICAgICAgIGFkZEZpbGVzVG9QcmV2aWV3KCk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBnZXRTYXZlZFRhYmxlTW9kaWZpY2F0aW9ucyh0YWJsZURhdGEudXJpKTtcbiAgICAgICAgYWRkRmlsZXNUb1ByZXZpZXcoKTtcbiAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqIEdldCB0aGUgY3VycmVudCBzYXZlZCB2YWx1ZXMgb2YgdGhlIHRhYmxlIG1vZGlmaWNhdGlvbnMuICoqL1xuICBmdW5jdGlvbiBnZXRTYXZlZFRhYmxlTW9kaWZpY2F0aW9ucyh1cmkpIHtcbiAgICB2YXIgdXBkYXRlZENvbnRlbnRVcmkgPSBcIi96ZWJlZGVlL21vZGlmeXRhYmxlL1wiICsgRmxvcmVuY2UuY29sbGVjdGlvbi5pZCArIFwiP3VyaT1cIiArIHVyaSArIFwiLmpzb25cIjtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiB1cGRhdGVkQ29udGVudFVyaSxcbiAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHVwZGF0ZVRhYmxlTW9kaWZpY2F0aW9uRm9ybShqc29uKTtcbiAgICAgICAgcmVuZGVyVGFibGUodXJpKTtcbiAgICAgICAgJCgnI3RhYmxlLW1vZGlmeS1mb3JtJykuc2xpZGVEb3duKFwic2xvd1wiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBVcGRhdGUgdGhlIHRhYmxlIG1vZGlmaWNhdGlvbnMgZm9ybS4gKiovXG4gIGZ1bmN0aW9uIHVwZGF0ZVRhYmxlTW9kaWZpY2F0aW9uRm9ybSh0YWJsZUpzb24pIHtcbiAgICAkKFwiI3Jvd3MtZXhjbHVkZWRcIikudmFsKFwiXCIpO1xuICAgICQoXCIjaGVhZGVyLXJvd3NcIikudmFsKFwiXCIpO1xuICAgICQoXCIjaGVhZGVyLWNvbHVtbnNcIikudmFsKFwiXCIpO1xuICAgICQoXCIjcm93cy1leGNsdWRlZFwiKS52YWwoYXNDb21tYVNlcGFyYXRlZFN0cih0YWJsZUpzb24ubW9kaWZpY2F0aW9ucy5yb3dzRXhjbHVkZWQpKTtcbiAgICAkKFwiI2hlYWRlci1yb3dzXCIpLnZhbChhc0NvbW1hU2VwYXJhdGVkU3RyKHRhYmxlSnNvbi5tb2RpZmljYXRpb25zLmhlYWRlclJvd3MpKTtcbiAgICAkKFwiI2hlYWRlci1jb2x1bW5zXCIpLnZhbChhc0NvbW1hU2VwYXJhdGVkU3RyKHRhYmxlSnNvbi5tb2RpZmljYXRpb25zLmhlYWRlckNvbHVtbnMpKTtcbiAgfVxuXG4gIC8qKiBEZWxldGUgLyBDYW5jZWwgKiovXG4gICQoJy5idG4tdGFibGUtYnVpbGRlci1jYW5jZWwnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgJCgnLnRhYmxlLWJ1aWxkZXInKS5zdG9wKCkuZmFkZU91dCgyMDApLnJlbW92ZSgpO1xuXG4gICAgLy8gZGVsZXRlIHRoZSBwcmV2aWV3IHRhYmxlXG4gICAgaWYgKHByZXZpZXdUYWJsZSkge1xuICAgICAgJChwcmV2aWV3VGFibGUuZmlsZXMpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBmaWxlKSB7XG4gICAgICAgIHZhciBmaWxlVG9EZWxldGUgPSBwYWdlVXJsICsgJy8nICsgZmlsZS5maWxlbmFtZTtcbiAgICAgICAgZGVsZXRlQ29udGVudChGbG9yZW5jZS5jb2xsZWN0aW9uLmlkLCBmaWxlVG9EZWxldGUsXG4gICAgICAgICAgb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJkZWxldGVkIHRhYmxlIGZpbGU6IFwiICsgZmlsZVRvRGVsZXRlKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZWxldGVDb250ZW50KEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQsIHByZXZpZXdUYWJsZS51cmkgKyBcIi5qc29uXCIsIGZ1bmN0aW9uKCl7fSwgZnVuY3Rpb24oKXt9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKiBTYXZlICoqL1xuICAkKCcuYnRuLXRhYmxlLWJ1aWxkZXItY3JlYXRlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIC8vIGlmIHVwbG9hZGVkID0gdHJ1ZSByZW5hbWUgdGhlIHByZXZpZXcgdGFibGVcbiAgICBwcmV2aWV3VGFibGUgPSBidWlsZEpzb25PYmplY3RGcm9tRm9ybShwcmV2aWV3VGFibGUpO1xuICAgIHZhciB0YWJsZUV4aXN0cyA9IGZhbHNlO1xuXG4gICAgaWYgKHRhYmxlKSB7XG4gICAgICB0YWJsZUV4aXN0cyA9IHRydWU7XG4gICAgICB0YWJsZSA9IG1hcEpzb25WYWx1ZXMocHJldmlld1RhYmxlLCB0YWJsZSk7XG4gICAgfSBlbHNlIHsgLy8ganVzdCBrZWVwIHRoZSBwcmV2aWV3IGZpbGVzXG4gICAgICB0YWJsZSA9IHByZXZpZXdUYWJsZTtcbiAgICAgIGFkZFRhYmxlVG9QYWdlSnNvbih0YWJsZSk7XG4gICAgfVxuXG4gICAgc2F2ZVRhYmxlSnNvbih0YWJsZSwgc3VjY2Vzcz1mdW5jdGlvbigpIHtcbiAgICAgIGlmICh0YWJsZUV4aXN0cykge1xuXG4gICAgICAgIGlmIChwcmV2aWV3VGFibGUuZmlsZXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGFkZEZpbGVzVG9QcmV2aWV3KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiBhIHRhYmxlIGV4aXN0cywgcmVuYW1lIHRoZSBwcmV2aWV3IHRvIGl0cyBuYW1lXG4gICAgICAgICQocHJldmlld1RhYmxlLmZpbGVzKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZmlsZSkge1xuICAgICAgICAgIHZhciBmcm9tRmlsZSA9IHBhZ2VVcmwgKyAnLycgKyBmaWxlLmZpbGVuYW1lO1xuICAgICAgICAgIHZhciB0b0ZpbGUgPSBwYWdlVXJsICsgJy8nICsgZmlsZS5maWxlbmFtZS5yZXBsYWNlKHByZXZpZXdUYWJsZS5maWxlbmFtZSwgdGFibGUuZmlsZW5hbWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwibW92aW5nLi4uIHRhYmxlIGZpbGU6IFwiICsgZnJvbUZpbGUgKyBcIiB0bzogXCIgKyB0b0ZpbGUpO1xuICAgICAgICAgIHJlbmFtZUNvbnRlbnQoRmxvcmVuY2UuY29sbGVjdGlvbi5pZCwgZnJvbUZpbGUsIHRvRmlsZSxcbiAgICAgICAgICAgIG9uU3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJNb3ZlZCB0YWJsZSBmaWxlOiBcIiArIGZyb21GaWxlICsgXCIgdG86IFwiICsgdG9GaWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZGVsZXRlQ29udGVudChGbG9yZW5jZS5jb2xsZWN0aW9uLmlkLCBwcmV2aWV3VGFibGUudXJpICsgXCIuanNvblwiLCBmdW5jdGlvbigpe30sIGZ1bmN0aW9uKCl7fSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvblNhdmUpIHtcbiAgICAgICAgb25TYXZlKHRhYmxlLmZpbGVuYW1lLCAnPG9ucy10YWJsZSBwYXRoPVwiJyArIHRhYmxlLmZpbGVuYW1lICsgJ1wiIC8+Jyk7XG4gICAgICB9XG4gICAgICAkKCcudGFibGUtYnVpbGRlcicpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHNldFNob3J0Y3V0cygnI3RhYmxlLXRpdGxlJyk7XG5cbiAgZnVuY3Rpb24gYWRkVGFibGVUb1BhZ2VKc29uKHRhYmxlKSB7XG4gICAgaWYgKCFwYWdlRGF0YS50YWJsZXMpIHtcbiAgICAgIHBhZ2VEYXRhLnRhYmxlcyA9IFtdO1xuICAgIH0gZWxzZSB7XG5cbiAgICAgIHZhciBleGlzdGluZ1RhYmxlID0gXy5maW5kKHBhZ2VEYXRhLnRhYmxlcywgZnVuY3Rpb24gKGV4aXN0aW5nVGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nVGFibGUuZmlsZW5hbWUgPT09IHRhYmxlLmZpbGVuYW1lO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChleGlzdGluZ1RhYmxlKSB7XG4gICAgICAgIGV4aXN0aW5nVGFibGUudGl0bGUgPSB0YWJsZS50aXRsZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHBhZ2VEYXRhLnRhYmxlcy5wdXNoKHt0aXRsZTogdGFibGUudGl0bGUsIGZpbGVuYW1lOiB0YWJsZS5maWxlbmFtZSwgdXJpOiB0YWJsZS51cml9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1hcEpzb25WYWx1ZXMoZnJvbSwgdG8pIHtcbiAgICB0byA9IGJ1aWxkSnNvbk9iamVjdEZyb21Gb3JtKHRvKTtcblxuICAgICQoZnJvbS5maWxlcykuZWFjaChmdW5jdGlvbiAoZnJvbUluZGV4LCBmcm9tRmlsZSkge1xuICAgICAgdmFyIGZpbGVFeGlzdHNJbkltYWdlID0gZmFsc2U7XG5cbiAgICAgICQodG8uZmlsZXMpLmVhY2goZnVuY3Rpb24gKHRvSW5kZXgsIHRvRmlsZSkge1xuICAgICAgICBpZiAoZnJvbUZpbGUudHlwZSA9PSB0b0ZpbGUudHlwZSkge1xuICAgICAgICAgIGZpbGVFeGlzdHNJbkltYWdlID0gdHJ1ZTtcbiAgICAgICAgICB0b0ZpbGUuZmlsZU5hbWUgPSBmcm9tRmlsZS5maWxlTmFtZTtcbiAgICAgICAgICB0b0ZpbGUuZmlsZVR5cGUgPSBmcm9tRmlsZS5maWxlVHlwZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmKCFmaWxlRXhpc3RzSW5JbWFnZSkge1xuICAgICAgICB0by5maWxlcy5wdXNoKGZyb21GaWxlKTtcbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRvO1xuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRKc29uT2JqZWN0RnJvbUZvcm0odGFibGUpIHtcbiAgICBpZiAoIXRhYmxlKSB7XG4gICAgICB0YWJsZSA9IHt9O1xuICAgIH1cblxuICAgIHRhYmxlLnR5cGUgPSAndGFibGUnO1xuICAgIHRhYmxlLnRpdGxlID0gJCgnI3RhYmxlLXRpdGxlJykudmFsKCk7XG5cbiAgICBpZiAoIXRhYmxlLmZpbGVuYW1lKSB7XG4gICAgICAgIHRhYmxlLmZpbGVuYW1lID0gU3RyaW5nVXRpbHMucmFuZG9tSWQoKTtcbiAgICB9XG5cbiAgICB0YWJsZS51cmkgPSBwYWdlVXJsICsgXCIvXCIgKyB0YWJsZS5maWxlbmFtZTtcblxuICAgIGlmICh0YWJsZS50aXRsZSA9PT0gJycpIHtcbiAgICAgIHRhYmxlLnRpdGxlID0gJ1tUaXRsZV0nO1xuICAgIH1cblxuICAgIGlmICghdGFibGUuZmlsZXMpIHtcbiAgICAgIHRhYmxlLmZpbGVzID0gW107XG4gICAgfVxuXG4gICAgdGFibGUubW9kaWZpY2F0aW9ucyA9IHt9O1xuICAgIHRhYmxlLm1vZGlmaWNhdGlvbnMucm93c0V4Y2x1ZGVkID0gaW5wdXRBc0xpc3QoXCIjcm93cy1leGNsdWRlZFwiLCBbXSk7XG4gICAgdGFibGUubW9kaWZpY2F0aW9ucy5oZWFkZXJSb3dzID0gaW5wdXRBc0xpc3QoXCIjaGVhZGVyLXJvd3NcIiwgW10pO1xuICAgIHRhYmxlLm1vZGlmaWNhdGlvbnMuaGVhZGVyQ29sdW1ucyA9IGlucHV0QXNMaXN0KFwiI2hlYWRlci1jb2x1bW5zXCIsIFtdKTtcbiAgICByZXR1cm4gdGFibGU7XG4gIH1cblxuICBmdW5jdGlvbiBhc0NvbW1hU2VwYXJhdGVkU3RyKF9saXN0KSB7XG4gICAgdmFyIGN1cnJlbnRWYWx1ZXMgPSBcIlwiO1xuICAgIF9saXN0LmZvckVhY2goIGZ1bmN0aW9uKCBpdGVtKSB7XG4gICAgICBjdXJyZW50VmFsdWVzID0gaXRlbSArIFwiLCBcIiArIGN1cnJlbnRWYWx1ZXM7XG4gICAgfSk7XG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZXMuc3Vic3RyaW5nKDAsIGN1cnJlbnRWYWx1ZXMubGFzdEluZGV4T2YoXCIsXCIpKTtcbiAgfVxuXG4gIC8qKiBDb252ZXJ0cyBhIGNvbW1hIHNlcGFyYXRlZCBzdHJpbmcgdG8gYSBsaXN0ICoqL1xuICBmdW5jdGlvbiBpbnB1dEFzTGlzdChfZWxlbUlkLCBfbGlzdCkge1xuICAgIGlmICggJChfZWxlbUlkKS52YWwoKSApIHtcbiAgICAgIHZhciB2YWx1ZXNTdHJpbmcgPSAkKF9lbGVtSWQpLnZhbCgpLnNwbGl0KFwiLFwiKTtcbiAgICAgIHZhbHVlc1N0cmluZy5mb3JFYWNoKCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGl0ZW0udHJpbSgpO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICBfbGlzdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBfbGlzdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZhbGlkYXRlTGlzdChfbGlzdCwgZmllbGROYW1lLCBlcnJvcnMpIHtcbiAgICBpZiAoX2xpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICB9XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgX2xpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB2YWx1ZSA9IF9saXN0W2ldO1xuICAgICAgaWYgKGlzTmFOKHZhbHVlKSB8fCAoIXZhbHVlKSkge1xuICAgICAgICBlcnJvcnMubWVzc2FnZXMucHVzaChmaWVsZE5hbWUgKyBcIiBpcyBpbnZhbGlkLlwiKTtcbiAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVycm9ycztcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkVGFibGVzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpIHtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFRhYmxlcyhkYXRhKTtcbiAgICAkKCcjdGFibGVzJykucmVwbGFjZVdpdGgoaHRtbCk7XG4gICAgaW5pdGlhbGlzZVRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICBpbml0aWFsaXNlQ2xpcGJvYXJkKCk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hUYWJsZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VGFibGVzKGRhdGEpO1xuICAgICQoJyN0YWJsZS1saXN0JykucmVwbGFjZVdpdGgoJChodG1sKS5maW5kKCcjdGFibGUtbGlzdCcpKTtcbiAgICBpbml0aWFsaXNlVGFibGVzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgIGluaXRpYWxpc2VDbGlwYm9hcmQoKTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZVRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgICAkKCcjYWRkLXRhYmxlJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2FkVGFibGVCdWlsZGVyKGRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICByZWZyZXNoUHJldmlldygpO1xuICAgICAgICAgICAgcmVmcmVzaFRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAkKGRhdGEudGFibGVzKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdGFibGUpIHtcbiAgICAgICAgdmFyIGJhc2VQYXRoID0gZGF0YS51cmk7XG4gICAgICAgIHZhciB0YWJsZVBhdGggPSBiYXNlUGF0aCArICcvJyArIHRhYmxlLmZpbGVuYW1lO1xuICAgICAgICB2YXIgdGFibGVKc29uID0gdGFibGVQYXRoO1xuXG4gICAgICAgICQoXCIjdGFibGUtZWRpdF9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRQYWdlRGF0YShjb2xsZWN0aW9uSWQsIHRhYmxlSnNvbixcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3MgPSBmdW5jdGlvbiAodGFibGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRUYWJsZUJ1aWxkZXIoZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoVGFibGVzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0YWJsZURhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjdGFibGUtZGVsZXRlX1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyB0YWJsZT9cIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgYW55IGZpbGVzIGFzc29jaWF0ZWQgd2l0aCB0aGUgdGFibGUuXG4gICAgICAgICAgICAgICAgICAgIHZhciBleHRyYUZpbGVzID0gW3RhYmxlLmZpbGVuYW1lICsgJy5odG1sJywgdGFibGUuZmlsZW5hbWUgKyAnLnhscyddO1xuICAgICAgICAgICAgICAgICAgICBfKGV4dHJhRmlsZXMpLmVhY2goZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlVG9EZWxldGUgPSBiYXNlUGF0aCArICcvJyArIGZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZmlsZVRvRGVsZXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSB0YWJsZSBmcm9tIHRoZSBwYWdlIGpzb24gd2hlbiBpdHMgZGVsZXRlZFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRhYmxlcyA9IF8oZGF0YS50YWJsZXMpLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZmlsZW5hbWUgIT09IHRhYmxlLmZpbGVuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSB1cGRhdGVkIHBhZ2UganNvblxuICAgICAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgYmFzZVBhdGgsIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgdGFibGUganNvbiBmaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHRhYmxlSnNvbiArICcuanNvbicsIG9uU3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBvbkVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUYWJsZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgdGFibGUgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDQwNClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuXG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8gTWFrZSBzZWN0aW9ucyBzb3J0YWJsZVxuICAgIGZ1bmN0aW9uIHNvcnRhYmxlKCkge1xuICAgICAgICAkKCcjc29ydGFibGUtdGFibGUnKS5zb3J0YWJsZSgpO1xuICAgIH1cblxuICAgIHNvcnRhYmxlKCk7XG59LyoqXG4gKiBDcmVhdGVzIGRhdGEgdmlzdWFsaXNhdGlvbidzIEpTT05cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBwYWdlVHlwZVxuICogQHBhcmFtIGNvbGxlY3Rpb25EYXRhXG4gKi9cblxuZnVuY3Rpb24gbG9hZFZpc3VhbGlzYXRpb25DcmVhdG9yKGNvbGxlY3Rpb25JZCwgcGFnZVR5cGUsIGNvbGxlY3Rpb25EYXRhKSB7XG4gICAgdmFyIHBhZ2VEYXRhLCBwYWdlVGl0bGUsIHBhZ2VJZCwgbmV3VXJpLCBzYWZlTmV3VXJpLCB1cmlTZWN0aW9uLCBwYWdlSWRUcmltbWVkO1xuICAgIHZhciBwYXJlbnRVcmxEYXRhID0gXCIvZGF0YVwiO1xuICAgICQuYWpheCh7XG4gICAgICAgIHVybDogcGFyZW50VXJsRGF0YSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjaGVja0RhdGEpIHtcbiAgICAgICAgICAgIC8vQ2hlY2tzIHBhZ2UgaXMgYmVpbmcgYnVpbHQgaW4gcm9vdCAtIHRoZSBkaXJlY3RvcnkgaXMgbm90IHJlY29nbmlzZWQsIHNvIHdlJ3JlIGxvb2tpbmcgZm9yIHRoZSBob21lX3BhZ2UgcGFnZSB0eXBlXG4gICAgICAgICAgICBpZiAoY2hlY2tEYXRhLnR5cGUgPT09ICdob21lX3BhZ2UnKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0Rm9ybUhhbmRsZXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgcGxhY2UgdG8gY3JlYXRlIHRoaXMgcGFnZS5cIik7XG4gICAgICAgICAgICAgICAgLy9UT0RPIGxvYWQgZGF0YSB2aXMgZGlyZWN0b3J5XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gcGFnZSBkYXRhIHJldHVybmVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHN1Ym1pdEZvcm1IYW5kbGVyKCkge1xuICAgICAgICBwYWdlRGF0YSA9IHBhZ2VUeXBlRGF0YVZpc3VhbGlzYXRpb24ocGFnZVR5cGUpO1xuXG4gICAgICAgIC8vIFByZXBlbmQgdW5pcXVlIGNvZGUgZmllbGQgaW50byBjcmVhdGUgZm9ybVxuICAgICAgICB2YXIgY29kZUlucHV0ID0gXCI8bGFiZWwgZm9yPSd2aXN1YWxpc2F0aW9uLXVpZCc+VW5pcXVlIElEPC9sYWJlbD48aW5wdXQgcGxhY2Vob2xkZXI9J0VnIERWQzEyNicgdHlwZT0ndGV4dCcgaWQ9J3Zpc3VhbGlzYXRpb24tdWlkJz5cIjtcbiAgICAgICAgJCgnLmVkaXRpb24nKS5hZnRlcihjb2RlSW5wdXQpO1xuXG4gICAgICAgICQoJ2Zvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIG5hbWVWYWxpZCA9IHZhbGlkYXRlUGFnZU5hbWUoKTtcbiAgICAgICAgICAgIGlmICghbmFtZVZhbGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgcGFnZSB0aXRsZSBhbmQgVUlEXG4gICAgICAgICAgICBwYWdlVGl0bGUgPSAkKCcjcGFnZW5hbWUnKS52YWwoKTtcbiAgICAgICAgICAgIHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gcGFnZVRpdGxlO1xuICAgICAgICAgICAgcGFnZUlkID0gJCgnI3Zpc3VhbGlzYXRpb24tdWlkJykudmFsKCk7XG4gICAgICAgICAgICBwYWdlRGF0YS51aWQgPSBwYWdlSWQ7XG5cbiAgICAgICAgICAgIC8vIFNhdmUgdGhlIG5ldyBwYWdlXG4gICAgICAgICAgICBwYWdlSWRUcmltbWVkID0gcGFnZUlkLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB1cmlTZWN0aW9uID0gXCJ2aXN1YWxpc2F0aW9uc1wiO1xuICAgICAgICAgICAgbmV3VXJpID0gbWFrZVVybCh1cmlTZWN0aW9uLCBwYWdlSWRUcmltbWVkKTtcbiAgICAgICAgICAgIHNhZmVOZXdVcmkgPSBjaGVja1BhdGhTbGFzaGVzKG5ld1VyaSk7XG4gICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoID0gc2FmZU5ld1VyaTtcbiAgICAgICAgICAgIHNhdmVDb250ZW50KGNvbGxlY3Rpb25JZCwgc2FmZU5ld1VyaSwgcGFnZURhdGEsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHBhZ2VUeXBlRGF0YVZpc3VhbGlzYXRpb24ocGFnZVR5cGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICAgICAgdGl0bGU6IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgdWlkOiBcIlwiLFxuICAgICAgICB0eXBlOiBwYWdlVHlwZSxcbiAgICAgICAgemlwVGl0bGU6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lczogW10sXG4gICAgICAgIGluZGV4UGFnZTogXCJcIlxuXG4gICAgfTtcbn1cblxuXG4vKipcbiAqIExvZ291dCB0aGUgY3VycmVudCB1c2VyIGFuZCByZXR1cm4gdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAqL1xuZnVuY3Rpb24gbG9nb3V0KCkge1xuICBkZWxldGVfY29va2llKCdhY2Nlc3NfdG9rZW4nKTtcbiAgZGVsZXRlX2Nvb2tpZSgnY29sbGVjdGlvbicpO1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxvZ2dlZEluQXNcIiwgXCJcIik7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwidXNlclR5cGVcIiwgXCJcIik7XG4gIEZsb3JlbmNlLnJlZnJlc2hBZG1pbk1lbnUoKTtcbiAgdmlld0NvbnRyb2xsZXIoKTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlX2Nvb2tpZShuYW1lKSB7XG4gIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPTsgcGF0aD0vOyBleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDEgR01UOyc7XG59ZnVuY3Rpb24gbWFrZVVybChhcmdzKSB7XG4gIHZhciBhY2N1bXVsYXRvcjtcbiAgYWNjdW11bGF0b3IgPSBbXTtcbiAgZm9yKHZhciBpPTA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBhY2N1bXVsYXRvciA9ICBhY2N1bXVsYXRvci5jb25jYXQoYXJndW1lbnRzW2ldXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoJy8nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihhcmd1bWVudCl7cmV0dXJuIGFyZ3VtZW50ICE9PSBcIlwiO30pKTtcbiAgfVxuICByZXR1cm4gYWNjdW11bGF0b3Iuam9pbignLycpO1xufVxuXG4vKipcbiAqIE1hbmFnZXMgbWFya2Rvd24gY29udGVudFxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIGRhdGFcbiAqIEBwYXJhbSBmaWVsZCAtIEpTT04gZGF0YSBrZXlcbiAqIEBwYXJhbSBpZEZpZWxkIC0gSFRNTCBpZCBmb3IgdGhlIHRlbXBsYXRlXG4gKi9cbmZ1bmN0aW9uIHJlbmRlck1hcmtkb3duQ29udGVudEFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuXG4gICAgLy8gdGhlIGxpc3Qgb2YgY29udGVudCBzZWN0aW9ucyB0byByZW5kZXIgaW4gYWNjb3JkaW9uIHNlY3Rpb24uXG4gICAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcblxuICAgIC8vIGEgdmlldyBtb2RlbCBpbmNsdWRpbmcgdGhlIGxpc3QgYW5kIGZpZWxkIG5hbWUgdGhlIGxpc3QgaXMgY29udGFpbmVkIGluLlxuICAgIHZhciBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZH07XG5cbiAgICAvLyByZW5kZXIgdGhlIEhUTUwgZm9yIHRoZSBhY2NvcmRpb24gc2VjdGlvbi5cbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JDb250ZW50KGRhdGFUZW1wbGF0ZSk7XG5cbiAgICAvLyBpbmplY3QgdGhlIEhUTUwgaW50byB0aGUgYWNjb3JkaW9uIHNlY3Rpb25cbiAgICAkKCcjJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKGh0bWwpO1xuXG4gICAgLy8gYXR0YWNoIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgYnV0dG9ucy5cbiAgICBpbml0aWFsaXNlTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKVxufVxuXG5mdW5jdGlvbiByZWZyZXNoTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgdmFyIGxpc3QgPSBkYXRhW2ZpZWxkXTtcbiAgICB2YXIgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGR9O1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLmVkaXRvckNvbnRlbnQoZGF0YVRlbXBsYXRlKTtcbiAgICAkKCcjc29ydGFibGUtJyArIGlkRmllbGQpLnJlcGxhY2VXaXRoKCQoaHRtbCkuZmluZCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKSk7XG4gICAgaW5pdGlhbGlzZU1hcmtkb3duQ29udGVudEFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZClcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZU1hcmtkb3duQ29udGVudEFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuXG4gICAgLy8gZm9yIGVhY2ggZW50cnkgaW4gdGhlIGxpc3RcbiAgICBmdW5jdGlvbiBkZWJ1Z0xvZ0FjY29yZGlvblNlY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YVtmaWVsZF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFbZmllbGRdW2ldLnRpdGxlKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgJChkYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcblxuICAgICAgICAkKCcjJyArIGlkRmllbGQgKyAnLXRpdGxlXycgKyBpbmRleCkub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZGF0YVtmaWVsZF1baW5kZXhdLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgIC8vZGVidWdMb2dBY2NvcmRpb25TZWN0aW9uKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGF0dGFjaCBlZGl0IGhhbmRsZXJcbiAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1lZGl0XycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgdmlldyBtb2RlbCB0byBwYXNzIHRvIHRoZSBtYXJrZG93biBlZGl0b3JcbiAgICAgICAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7XG4gICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBkYXRhW2ZpZWxkXVtpbmRleF0udGl0bGUsXG4gICAgICAgICAgICAgICAgXCJtYXJrZG93blwiOiBkYXRhW2ZpZWxkXVtpbmRleF0ubWFya2Rvd25cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgZnVuY3Rpb24gdG8gZGVmaW5lIHdoYXQgaGFwcGVucyBvbiBzYXZlIGluIHRoZSBtYXJrZG93biBlZGl0b3JcbiAgICAgICAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdW2luZGV4XS5tYXJrZG93biA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICAgICAgICAgIHNhdmVDb250ZW50VGhlblJlZnJlc2hTZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcblxuICAgICAgICAgICAgICAgIC8vIHdoZW4gZmluaXNoZWQgaW4gdGhlIG1hcmtkb3duIGVkaXRvciBiZSBzdXJlIHRvIHJlZnJlc2ggdGhlIGNoYXJ0cyAvIHRhYmxlcyAvIGltYWdlcyBsaXN0IHRvIHNob3cgYW55IG5ld2x5IGFkZGVkXG4gICAgICAgICAgICAgICAgcmVmcmVzaENoYXJ0TGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgICAgIHJlZnJlc2hUYWJsZXNMaXN0KGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgcmVmcmVzaEVxdWF0aW9uc0xpc3QoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICAgICAgICAgICAgICByZWZyZXNoSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIGRhdGEpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhdHRhY2ggZGVsZXRlIGhhbmRsZXJcbiAgICAgICAgJCgnIycgKyBpZEZpZWxkICsgJy1kZWxldGVfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlP1wiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIHRoZSBpdGVtIGZyb20gdGhlIGRhdGEgbW9kZWxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0uc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBwb3N0IGNvbnRlbnQgdG8gdGhlIHNlcnZlciBhbmQgcmVmcmVzaCBhY2NvcmRpb24gc2VjdGlvbiB2aWV3LlxuICAgICAgICAgICAgICAgICAgICBzYXZlQ29udGVudFRoZW5SZWZyZXNoU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJEZWxldGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgXCIgKyBpZEZpZWxkICsgXCIgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBBdHRhY2ggYWRkIG5ldyBoYW5kbGVyLlxuICAgICQoJyNhZGQtJyArIGlkRmllbGQpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGFbZmllbGRdLnB1c2goe21hcmtkb3duOiBcIlwiLCB0aXRsZTogXCJcIn0pO1xuICAgICAgICBzYXZlQ29udGVudFRoZW5SZWZyZXNoU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzb3J0YWJsZSgpIHtcblxuICAgICAgICB2YXIgc29ydGFibGVTdGFydFBvc2l0aW9uO1xuXG4gICAgICAgICQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkuc29ydGFibGUoe1xuICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcblxuICAgICAgICAgICAgICAgIC8vIHJlbWVtYmVyIHRoZSBpbmRleCBvZiB0aGUgaXRlbSBhdCB0aGUgc3RhcnQgb2YgZHJhZyArIGRyb3BcbiAgICAgICAgICAgICAgICBzb3J0YWJsZVN0YXJ0UG9zaXRpb24gPSB1aS5pdGVtLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcInNvcnRhYmxlIHN0YXJ0OiBcIiArIHNvcnRhYmxlU3RhcnRQb3NpdGlvbik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuXG4gICAgICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBuZXcgaW5kZXggb2YgdGhlIGl0ZW0gYWZ0ZXIgYmVpbmcgZHJvcHBlZC5cbiAgICAgICAgICAgICAgICB2YXIgc29ydGFibGVFbmRQb3NpdGlvbiA9IHVpLml0ZW0uaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwic29ydGFibGUgdXBkYXRlOiBTdGFydDogXCIgKyBzb3J0YWJsZVN0YXJ0UG9zaXRpb24gKyBcIiBub3c6IFwiICsgc29ydGFibGVFbmRQb3NpdGlvbikgO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25zQXJyYXkgPSBkYXRhW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRhdGFbZmllbGRdW3NvcnRhYmxlU3RhcnRQb3NpdGlvbl07XG5cbiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBpdGVtIGZyb20gdGhlIHN0YXJ0IGRyYWcgcG9zaXRpb24gdG8gdGhlIGVuZCBkcm9wIHBvc2l0aW9uIGluIHRoZSBkYXRhIG1vZGVsLlxuICAgICAgICAgICAgICAgIHNlY3Rpb25zQXJyYXkuc3BsaWNlKHNvcnRhYmxlU3RhcnRQb3NpdGlvbiwgMSk7XG4gICAgICAgICAgICAgICAgc2VjdGlvbnNBcnJheS5zcGxpY2Uoc29ydGFibGVFbmRQb3NpdGlvbiwgMCwgaXRlbSk7XG5cbiAgICAgICAgICAgICAgICBzYXZlQ29udGVudFRoZW5SZWZyZXNoU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBkYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNvcnRhYmxlKCk7XG5cbiAgICBmdW5jdGlvbiBzYXZlQ29udGVudFRoZW5SZWZyZXNoU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhdGgsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKSB7XG4gICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZWZyZXNoTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbiAgICAgICAgICAgICAgICByZWZyZXNoUHJldmlldyhkYXRhLnVyaSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1hcmtEb3duRWRpdG9yU2V0TGluZXMoKSB7XG4gIHZhciB0ZXh0YXJlYSA9ICQoXCIjd21kLWlucHV0XCIpO1xuICAvLyB2YXIgbGluZXNIb2xkZXIgPSAkKCcubWFya2Rvd24tZWRpdG9yLWxpbmUtbnVtYmVycycpO1xuICB2YXIgdGV4dGFyZWFXaWR0aCA9IHRleHRhcmVhLndpZHRoKCk7XG4gIHZhciBjaGFyV2lkdGggPSA3O1xuICB2YXIgbGluZUhlaWdodCA9IDIxO1xuICB2YXIgdGV4dGFyZWFNYXhDaGFycyA9IE1hdGguZmxvb3IodGV4dGFyZWFXaWR0aCAvIGNoYXJXaWR0aCk7XG4gIHZhciBsaW5lcyA9IHRleHRhcmVhLnZhbCgpLnNwbGl0KCdcXG4nKTtcbiAgdmFyIGxpbmVzTGkgPSAnJztcbiAgdmFyIGN1cnNvckVuZFBvcyA9IHRleHRhcmVhLnByb3AoJ3NlbGVjdGlvbkVuZCcpO1xuICB2YXIgY2hhck1hcEFycmF5ID0gW107XG4gIHZhciBjaGFyTWFwQXJyYXlKb2luID0gW107XG4gIHZhciBsaW5lTGVuZ3RoQXJyYXkgPSBbXTtcbiAgdmFyIGNvbnRlbnRMZW5ndGggPSB0ZXh0YXJlYS52YWwoKS5sZW5ndGg7XG4gIHZhciBjdW11bGF0aXZlTGluZUxlbmd0aCA9IDA7XG4gIC8vIHZhciBjdXJzb3JMaW5lID0gdGV4dGFyZWEucHJvcCgnc2VsZWN0aW9uU3RhcnQnKS5zcGxpdCgnXFxuJykubGVuZ3RoO1xuICAkLmVhY2gobGluZXMsIGZ1bmN0aW9uKGluZGV4KXtcbiAgICB2YXIgbGluZU51bWJlciA9IGluZGV4ICsgMTtcbiAgICB2YXIgbGluZUxlbmd0aCA9IHRoaXMubGVuZ3RoO1xuICAgIHZhciBsaW5lV3JhcCA9IE1hdGgucm91bmQobGluZUxlbmd0aCAvIHRleHRhcmVhTWF4Q2hhcnMpO1xuICAgIC8vIHZhciBsaW5lV3JhcCA9IE1hdGguZmxvb3IobGluZUxlbmd0aCAvIHRleHRhcmVhTWF4Q2hhcnMpO1xuICAgIC8vIHZhciBsaW5lV3JhcCA9IE1hdGguY2VpbChsaW5lTGVuZ3RoIC8gdGV4dGFyZWFNYXhDaGFycyk7XG5cbiAgICAvL2NvbnNvbGUubG9nKCdtYXggY2hhcnM6ICcgKyB0ZXh0YXJlYU1heENoYXJzKTtcbiAgICAvL2NvbnNvbGUubG9nKCdsaW5lIGxlbmd0aDogJyArIGxpbmVMZW5ndGgpO1xuXG4gICAgdmFyIG51bWJlck9mTGluZXNDb3ZlcmVkID0gU3RyaW5nVXRpbHMudGV4dGFyZWFMaW5lcyh0aGlzLCB0ZXh0YXJlYU1heENoYXJzLCAwLCAwKTtcbiAgICB2YXIgbGlQYWRkaW5nQm90dG9tID0gbnVtYmVyT2ZMaW5lc0NvdmVyZWQgKiBsaW5lSGVpZ2h0O1xuXG4gICAgaWYobGluZU51bWJlciA9PT0gMSkge1xuICAgICAgY3VtdWxhdGl2ZUxpbmVMZW5ndGggKz0gbGluZUxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VtdWxhdGl2ZUxpbmVMZW5ndGggKz0gbGluZUxlbmd0aCArIDE7XG4gICAgICAvLyBjb25zb2xlLmxvZygnKzEnKTtcbiAgICB9XG5cbiAgICBsaW5lc0xpICs9ICc8bGkgaWQ9XCJtYXJrZG93bkVkaXRvckxpbmUtJyArIGxpbmVOdW1iZXIgKyAnXCIgc3R5bGU9XCJwYWRkaW5nLWJvdHRvbTonICsgbGlQYWRkaW5nQm90dG9tICsncHhcIj4mbmJzcDs8L2xpPic7XG4gICAgbGluZUxlbmd0aEFycmF5LnB1c2goY3VtdWxhdGl2ZUxpbmVMZW5ndGgpO1xuXG4gICAgLy9wdXNoIHRvIGNoYXJtYXBcbiAgICAvLyBjaGFyTWFwQXJyYXkucHVzaCh0aGlzLnJlcGxhY2UodGhpcy5zcGxpdCgnJyksIGxpbmVOdW1iZXIpKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdGlvblN0YXJ0KTtcbiAgICAvL2NvbnNvbGUubG9nKCdsaW5lIHdyYXA6ICcgKyBsaW5lV3JhcCArICcgKCcgKyBsaW5lTGVuZ3RoIC8gdGV4dGFyZWFNYXhDaGFycyArICcpJyk7XG4gIH0pO1xuXG4gIGlmKGxpbmVzTGkpIHtcbiAgICB2YXIgbGluZXNPbCA9ICc8b2w+JyArIGxpbmVzTGkgKyAnPC9vbD4nO1xuICAgICQoJyNtYXJrZG93bi1lZGl0b3ItbGluZS1udW1iZXJzJykuaHRtbChsaW5lc09sKTtcbiAgICAvLyBjb25zb2xlLmxvZyhsaW5lc09sKTtcbiAgfVxuXG4gIC8vc3luYyBzY3JvbGxcbiAgLy8gJCgnLm1hcmtkb3duLWVkaXRvci1saW5lLW51bWJlcnMgb2wnKS5jc3MoJ21hcmdpbi10b3AnLCAtdGV4dGFyZWEuc2Nyb2xsVG9wKCkpO1xuICAvLyB0ZXh0YXJlYS5vbignc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAvLyAgIC8vIHZhciBlZGl0b3JIZWlnaHQgPSAkKCcud21kLWlucHV0JykuaGVpZ2h0KCk7XG4gIC8vICAgLy8gdmFyIHByZXZpZXdIZWlnaHQgPSAkKCcud21kLXByZXZpZXcnKS5oZWlnaHQoKTtcbiAgLy8gICAvLyBjb25zb2xlLmxvZyhlZGl0b3JIZWlnaHQpO1xuICAvLyAgIHZhciBtYXJnaW5Ub3AgPSAkKHRoaXMpLnNjcm9sbFRvcCgpO1xuICAvLyAgICQoJy5tYXJrZG93bi1lZGl0b3ItbGluZS1udW1iZXJzIG9sJykuY3NzKCdtYXJnaW4tdG9wJywgLW1hcmdpblRvcCk7XG4gIC8vICAgJCgnLndtZC1wcmV2aWV3Jykuc2Nyb2xsVG9wKG1hcmdpblRvcCk7XG4gIC8vIH0pO1xuXG5cbiAgLy9wcm9wb3J0aW9uYWwgc2Nyb2xsXG4gIC8vdmFyICR3bWRzY3JvbGxzeW5jID0gJCgnLndtZC1pbnB1dCwgLndtZC1wcmV2aWV3Jyk7XG4gIC8vdmFyIHdtZHN5bmMgPSBmdW5jdGlvbihlKXtcbiAgLy8gICAgdmFyICRvdGhlciA9ICR3bWRzY3JvbGxzeW5jLm5vdCh0aGlzKS5vZmYoJ3Njcm9sbCcpLCBvdGhlciA9ICRvdGhlci5nZXQoMCk7XG4gIC8vICAgIHZhciBwZXJjZW50YWdlID0gdGhpcy5zY3JvbGxUb3AgLyAodGhpcy5zY3JvbGxIZWlnaHQgLSB0aGlzLm9mZnNldEhlaWdodCk7XG4gIC8vICAgIG90aGVyLnNjcm9sbFRvcCA9IHBlcmNlbnRhZ2UgKiAob3RoZXIuc2Nyb2xsSGVpZ2h0IC0gb3RoZXIub2Zmc2V0SGVpZ2h0KTtcbiAgLy8gICAgc2V0VGltZW91dCggZnVuY3Rpb24oKXsgJG90aGVyLm9uKCdzY3JvbGwnLCB3bWRzeW5jICk7IH0sMTApO1xuICAvL31cbiAgLy8kd21kc2Nyb2xsc3luYy5vbiggJ3Njcm9sbCcsIHdtZHN5bmMpO1xuXG5cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVMZW5ndGhBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGlmKGN1cnNvckVuZFBvcyA8PSBsaW5lTGVuZ3RoQXJyYXlbaV0pIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGkgKyAxKTtcbiAgICAgIHZhciBhY3RpdmVMaW5lID0gaSArIDE7XG4gICAgICAkKCcjbWFya2Rvd25FZGl0b3JMaW5lLScgKyBhY3RpdmVMaW5lKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2cobGluZUxlbmd0aEFycmF5W2ldKTtcbiAgICAvL0RvIHNvbWV0aGluZ1xuICB9XG5cblxuXG59XG5mdW5jdGlvbiBtZW51c2VsZWN0KGNsYXNzSWQpIHtcbiAgJC53aWRnZXQoXCJjdXN0b20uaWNvbnNlbGVjdG1lbnVcIiwgJC51aS5zZWxlY3RtZW51LCB7XG4gICAgX3JlbmRlckl0ZW06IGZ1bmN0aW9uKHVsLCBpdGVtKSB7XG4gICAgICB2YXIgbGkgPSAkKFwiPGxpPlwiLCB7XG4gICAgICAgIHRleHQ6IGl0ZW0ubGFiZWxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoaXRlbS5kaXNhYmxlZCkge1xuICAgICAgICBsaS5hZGRDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpO1xuICAgICAgfVxuXG4gICAgICAkKFwiPHNwYW4+XCIsIHtcbiAgICAgICAgc3R5bGU6IGl0ZW0uZWxlbWVudC5hdHRyKFwiZGF0YS1zdHlsZVwiKSxcbiAgICAgICAgXCJjbGFzc1wiOiBcInVpLWljb24gXCIgKyBpdGVtLmVsZW1lbnQuYXR0cihcImRhdGEtY2xhc3NcIilcbiAgICAgIH0pXG4gICAgICAgIC5hcHBlbmRUbyhsaSk7XG5cbiAgICAgIHJldHVybiBsaS5hcHBlbmRUbyh1bCk7XG4gICAgfVxuICB9KTtcblxuICAkKGNsYXNzSWQpXG4gICAgLmljb25zZWxlY3RtZW51KClcbiAgICAuaWNvbnNlbGVjdG1lbnUoXCJtZW51V2lkZ2V0XCIpXG4gICAgLmFkZENsYXNzKFwidWktbWVudS1pY29ucyBjdXN0b21pY29uc1wiKTtcbn0vKipcbiAqIE92ZXJsYXlzIG1vZGFsIGZvciBzZWxlY3Rpbmcgd2hlcmUgYSBub2RlIG9mIHRoZSBicm93c2UgdHJlZSBpcyBiZWluZyBtb3ZlZCB0b1xuICogQHBhcmFtIGZyb21VcmwgLSB3aGVyZSB0aGUgbm9kZSBpcyBiZWluZyBtb3ZlZCBmcm9tXG4gKi9cblxuZnVuY3Rpb24gbW92ZUJyb3dzZU5vZGUoZnJvbVVybCkge1xuICAgIHZhciBtb3ZlVG9CdG4gPSBcIjxidXR0b24gY2xhc3M9J2J0biBidG4tLXBvc2l0aXZlIGJ0bi1icm93c2UtbW92ZS10byc+TW92ZSBoZXJlPC9idXR0b24+XCIsXG4gICAgICAgIG1vdmVJblByb2dyZXNzID0gdHJ1ZSwgLy8gZmxhZyB0byB1c2UgdG8gc2VlIHN0YXRlIG9mIG1vdmUgcHJvY2Vzc1xuICAgICAgICBoZWFkZXJIZWlnaHQgPSA5OCxcbiAgICAgICAgJGJyb3dzZVRyZWUgPSAkKCcjYnJvd3NlLXRyZWUnKSxcbiAgICAgICAgJHdyYXBwZXIgPSAkKCcud3JhcHBlcicpLFxuICAgICAgICBvdmVybGF5ID0gJCgnPGRpdiBjbGFzcz1cIm92ZXJsYXlcIj48L2Rpdj4nKSxcbiAgICAgICAgYnJvd3NlVHJlZU1vdmVIZWFkZXIgPSAkKCc8ZGl2IGNsYXNzPVwid29ya3NwYWNlLW1lbnVfX2hlYWRlclwiPjxoMj5TZWxlY3QgYSBsb2NhdGlvbjwvaDI+PC9kaXY+JyksXG4gICAgICAgICR0cmVlQnJvd3NlciA9ICQoJy53b3Jrc3BhY2UtYnJvd3NlJyk7XG5cbiAgICAvLyBUb2dnbGUgYnV0dG9ucyBvbiBzZWxlY3RlZCBpdGVtXG4gICAgc2hvd0Jyb3dzZVRyZWVNb2RhbCgpO1xuICAgIHRvZ2dsZU1vdmVIZXJlQnV0dG9uKCk7XG5cbiAgICAvLyBTd2l0Y2ggb2ZmIGJyb3dzZSB0cmVlIGNoYW5nZXMgdXBkYXRpbmcgdGhlIHByZXZpZXcgb3IgZ2xvYmFsIHBhZ2VQYXRoXG4gICAgJCgnLmpzLWJyb3dzZV9faXRlbS10aXRsZScpLm9mZigpLmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICBpdGVtVXJsID0gJHRoaXMuY2xvc2VzdCgnLmpzLWJyb3dzZV9faXRlbScpLmF0dHIoJ2RhdGEtdXJsJyk7XG5cbiAgICAgICAgLy8gU2V0IHByZXZpb3VzbHkgc2VsZWN0ZWQgaXRlbSB0byBub3JtYWxcbiAgICAgICAgdG9nZ2xlTW92ZUhlcmVCdXR0b24oKTtcblxuICAgICAgICBpZiAoaXRlbVVybCkge1xuICAgICAgICAgICAgdHJlZU5vZGVTZWxlY3QoaXRlbVVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZWxlY3RQYXJlbnREaXJlY3RvcmllcygkdGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBvcGVuQnJvd3NlQnJhbmNoKCR0aGlzKTtcblxuICAgICAgICAvLyBUb2dnbGUgYnV0dG9ucyBvbiBuZXdseSBzZWxlY3RlZCBpdGVtXG4gICAgICAgIHRvZ2dsZU1vdmVIZXJlQnV0dG9uKCk7XG5cbiAgICAgICAgJCgnLmJ0bi1icm93c2UtbW92ZS10bycpLmNsaWNrKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBEYXRhIHRvIGJlIHNlbnQgdG8gWmViZWRlZVxuICAgICAgICAgICAgdmFyIHRvVXJsID0gJCh0aGlzKS5jbG9zZXN0KCcuanMtYnJvd3NlX19pdGVtJykuYXR0cignZGF0YS11cmwnKSxcbiAgICAgICAgICAgICAgICBtb3ZlRGF0YSA9IHtmcm9tVXJsOiBmcm9tVXJsLCB0b1VybDogdG9Vcmx9O1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ01vdmUgZGF0YTogJywgbW92ZURhdGEpO1xuXG4gICAgICAgICAgICAvLyBSZW1vdmUgY3VycmVudCBldmVudCBiaW5kaW5nIGFuZCByZXR1cm4gb3JkaW5hcnkgYnJvd3NlIHRyZWUgZnVuY3Rpb25hbGl0eVxuICAgICAgICAgICAgJCgnLmpzLWJyb3dzZV9faXRlbS10aXRsZScpLm9mZigpO1xuICAgICAgICAgICAgYmluZEJyb3dzZVRyZWVDbGljaygpO1xuXG4gICAgICAgICAgICAvLyBTZXQgc3RhdGUgb2YgbW92ZSB0byBmaW5pc2hlZFxuICAgICAgICAgICAgbW92ZUluUHJvZ3Jlc3MgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy8gU2hvdyBvcmRpbmFyeSBicm93c2UgdHJlZSBidXR0b25zXG4gICAgICAgICAgICB0b2dnbGVNb3ZlSGVyZUJ1dHRvbigpO1xuICAgICAgICAgICAgaGlkZUJyb3dzZVRyZWVNb2RhbCgpO1xuXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmVzIHRoZSB1c3VhbCBidXR0b25zIG9uIGJyb3dzZSB0cmVlIGl0ZW1zIGFuZCByZXBsYWNlcyB0aGVtIHdpdGggYSBzaW5nbGUgJ01vdmUgaGVyZScgYnV0dG9uXG4gICAgZnVuY3Rpb24gdG9nZ2xlTW92ZUhlcmVCdXR0b24oKSB7XG4gICAgICAgIHZhciAkdGhpc0J1dHRvbnMgPSAkKCcucGFnZV9fYnV0dG9ucy0tbGlzdC5zZWxlY3RlZCcpLFxuICAgICAgICAgICAgJG1vdmVUb0J1dHRvbiA9ICQoJy5idG4tYnJvd3NlLW1vdmUtdG8nKTtcblxuICAgICAgICAvLyBSZW1vdmUgcHJldmlvdXMsIHNvIHRoZXkncmUgbm90IGxpdHRlcmVkIGFyb3VuZCB0aGUgRE9NIG9yIGlmIG1vdmUgaXMgZmluaXNoZWRcbiAgICAgICAgJG1vdmVUb0J1dHRvbi5yZW1vdmUoKTtcblxuICAgICAgICAvLyBUb2dnbGUgY3VycmVudCBidXR0b25zIChzaG93IGlmIG1vdmUgaXMgZmluaXNoZWQgb3IgaGlkZSBpZiBtb3ZlIGlzIGluIHByb2dyZXNzXG4gICAgICAgICR0aGlzQnV0dG9ucy5maW5kKCcuanMtYnJvd3NlX19idXR0b25zLS1wcmltYXJ5LCAuanMtYnJvd3NlX19idXR0b25zLS1zZWNvbmRhcnknKS50b2dnbGUoKTtcblxuICAgICAgICBpZiAobW92ZUluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIC8vIEhpZGUgZXhpc3RpbmcgYnV0dG9ucyBpbiBzZWxlY3RlZCBpdGVtIGFuZCBhZGQgaW4gbmV3ICdNb3ZlIGhlcmUnIGJ1dHRvblxuICAgICAgICAgICAgJHRoaXNCdXR0b25zLmFwcGVuZChtb3ZlVG9CdG4pO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93QnJvd3NlVHJlZU1vZGFsKCkge1xuICAgICAgICAvLyBnaXZlIGJsYWNrZWQgcHV0IGFwcGVhcmFuY2UgdG8gcGFnZVxuICAgICAgICAkd3JhcHBlci5hcHBlbmQob3ZlcmxheSk7XG4gICAgICAgIC8vIGFkZCBtb3ZlIGhlYWRlciB0byBicm93c2UgdHJlZVxuICAgICAgICAkYnJvd3NlVHJlZS5wcmVwZW5kKGJyb3dzZVRyZWVNb3ZlSGVhZGVyKTtcbiAgICAgICAgLy8gYnJpbmcgYnJvd3NlIHRyZWUgZWxlbWVudCBpbiBmcm9udCBvZiBvdmVybGF5XG4gICAgICAgICRicm93c2VUcmVlLmNzcyh7J3otaW5kZXgnOiAxMDAxLCAncG9zaXRpb24nOiAncmVsYXRpdmUnfSk7XG4gICAgICAgIC8vIHJlc2l6ZSBicm93c2VyIGhlaWdodCBiZWNhdXNlIGFkZGluZyBoZWFkZXIgaGFzIHRha2VuIHVwIHNwYWNlXG4gICAgICAgICR0cmVlQnJvd3Nlci5oZWlnaHQoJHRyZWVCcm93c2VyWzBdLm9mZnNldEhlaWdodCAtIGhlYWRlckhlaWdodCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGlkZUJyb3dzZVRyZWVNb2RhbCgpIHtcbiAgICAgICAgLy9yZW1vdmUgb3ZlcmxheSAmIGhlYWRlclxuICAgICAgICBvdmVybGF5LnJlbW92ZSgpO1xuICAgICAgICBicm93c2VUcmVlTW92ZUhlYWRlci5yZW1vdmUoKTtcbiAgICAgICAgLy8gJ3Jlc2V0JyB6LWluZGV4XG4gICAgICAgICRicm93c2VUcmVlLmNzcyh7J3otaW5kZXgnOiAxLCAncG9zaXRpb24nOiAncmVsYXRpdmUnfSk7XG4gICAgICAgIC8vIGNhbGN1bGF0ZSBzaXplIGFmdGVyIHJlbW92aW5nIGhlYWRlclxuICAgICAgICAkdHJlZUJyb3dzZXIuaGVpZ2h0KCR0cmVlQnJvd3NlclswXS5vZmZzZXRIZWlnaHQgKyBoZWFkZXJIZWlnaHQpO1xuICAgIH1cblxufVxuZnVuY3Rpb24gcGFyc2VVUkwodXJsKSB7XG4gICAgdmFyIHBhcnNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSxcbiAgICAgICAgc2VhcmNoT2JqZWN0ID0ge30sXG4gICAgICAgIHF1ZXJpZXMsIHNwbGl0LCBpO1xuICAgIC8vIExldCB0aGUgYnJvd3NlciBkbyB0aGUgd29ya1xuICAgIHBhcnNlci5ocmVmID0gdXJsO1xuICAgIC8vIENvbnZlcnQgcXVlcnkgc3RyaW5nIHRvIG9iamVjdFxuICAgIHF1ZXJpZXMgPSBwYXJzZXIuc2VhcmNoLnJlcGxhY2UoL15cXD8vLCAnJykuc3BsaXQoJyYnKTtcbiAgICBmb3IoIGkgPSAwOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgc3BsaXQgPSBxdWVyaWVzW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgIHNlYXJjaE9iamVjdFtzcGxpdFswXV0gPSBzcGxpdFsxXTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvdG9jb2w6IHBhcnNlci5wcm90b2NvbCxcbiAgICAgICAgaG9zdDogcGFyc2VyLmhvc3QsXG4gICAgICAgIGhvc3RuYW1lOiBwYXJzZXIuaG9zdG5hbWUsXG4gICAgICAgIHBvcnQ6IHBhcnNlci5wb3J0LFxuICAgICAgICBwYXRobmFtZTogcGFyc2VyLnBhdGhuYW1lLFxuICAgICAgICBzZWFyY2g6IHBhcnNlci5zZWFyY2gsXG4gICAgICAgIHNlYXJjaE9iamVjdDogc2VhcmNoT2JqZWN0LFxuICAgICAgICBoYXNoOiBwYXJzZXIuaGFzaFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHBvc3RBcHByb3ZlQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQpIHtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvYXBwcm92ZS9cIiArIGNvbGxlY3Rpb25JZCxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gJCgnLm92ZXInKS5yZW1vdmUoKTsgLy8gQ29tbWVudGVkIGJlY2F1c2UgSSBjYW4ndCBzZWUgd2hhdCB0aGlzIGRvZXMgYXQgdGhlIG1vbWVudD9cbiAgICAgICAgICAgIGhpZGVQYW5lbCh7b25IaWRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QgY29sbGVjdGlvbnMgdGFiXG4gICAgICAgICAgICAgICAgICAgIHZpZXdDb250cm9sbGVyKCdjb2xsZWN0aW9ucycpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIC8vICQoJy5vdmVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGFwcHJvdmUgdGhpcyBjb2xsZWN0aW9uXCIsIFwiSXQgY29udGFpbnMgZmlsZXMgdGhhdCBoYXZlIG5vdCBiZWVuIGFwcHJvdmVkLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gc2F2ZUFuZENvbXBsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIGNvbnRlbnQsIHJlY3Vyc2l2ZSwgcmVkaXJlY3RUb1BhdGgpIHtcblxuICAgIGlmICghcmVjdXJzaXZlKSB7XG4gICAgICAgIHJlY3Vyc2l2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50LFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChyZWRpcmVjdFRvUGF0aCkge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIHJlY3Vyc2l2ZSwgcmVkaXJlY3RUb1BhdGgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCByZWN1cnNpdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZWN1cnNpdmUpO1xufVxuXG5mdW5jdGlvbiBjb21wbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCByZWN1cnNpdmUsIHJlZGlyZWN0VG9QYXRoKSB7XG4gICAgdmFyIHJlZGlyZWN0ID0gcmVkaXJlY3RUb1BhdGg7XG4gICAgdmFyIHNhZmVQYXRoID0gY2hlY2tQYXRoU2xhc2hlcyhwYXRoKTtcbiAgICBpZiAoc2FmZVBhdGggPT09ICcvJykge1xuICAgICAgICBzYWZlUGF0aCA9ICcnOyAgICAgICAgICAvLyBlZGdlIGNhc2UgZm9yIGhvbWVcbiAgICB9XG5cbiAgICBpZiAoRmxvcmVuY2UuZ2xvYmFsVmFycy53ZWxzaCkge1xuICAgICAgICB2YXIgdXJsID0gXCIvemViZWRlZS9jb21wbGV0ZS9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVQYXRoICsgXCIvZGF0YV9jeS5qc29uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHVybCA9IFwiL3plYmVkZWUvY29tcGxldGUvXCIgKyBjb2xsZWN0aW9uSWQgKyBcIj91cmk9XCIgKyBzYWZlUGF0aCArIFwiL2RhdGEuanNvblwiO1xuICAgIH1cblxuICAgIHZhciB1cmwgPSB1cmwgKyAnJnJlY3Vyc2l2ZT0nICsgcmVjdXJzaXZlO1xuXG4gICAgLy8gVXBkYXRlIGNvbnRlbnRcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAocmVkaXJlY3QpIHtcbiAgICAgICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UocmVkaXJlY3QsIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3Rpb24gZnJvbSAnd29ya2luZyBvbjogY29sbGVjdGlvbicgdGFiXG4gICAgICAgICAgICAgICAgJCgnLmpzLW5hdi1pdGVtLS1jb2xsZWN0aW9uJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1uYXYtaXRlbScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1uYXYtaXRlbS0tY29sbGVjdGlvbnMnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAgICAgICAgIHZpZXdDb2xsZWN0aW9ucyhjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbi8qKlxuICogc2F2ZSBjb250ZW50IHRvIHplYmVkZWUsIG1ha2luZyBpdCBpbiBwcm9ncmVzcyBpbiBhIGNvbGxlY3Rpb24uXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gcGF0aFxuICogQHBhcmFtIGNvbnRlbnRcbiAqIEBwYXJhbSBvdmVyd3JpdGVFeGlzdGluZyAtIHNob3VsZCB0aGUgY29udGVudCBiZSBvdmVyd3JpdHRlbiBpZiBpdCBhbHJlYWR5IGV4aXN0cz9cbiAqIEBwYXJhbSByZWN1cnNpdmUgLSBzaG91bGQgd2UgcmVjdXJzZSB0aGUgZGlyZWN0b3J5IG9mIHRoZSBmaWxlIGFuZCBtYWtlIGFsbCBmaWxlcyB1bmRlciBpdCBpbiBwcm9ncmVzcz9cbiAqIEBwYXJhbSBzdWNjZXNzXG4gKiBAcGFyYW0gZXJyb3JcbiAqL1xuZnVuY3Rpb24gcG9zdENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50LCBvdmVyd3JpdGVFeGlzdGluZywgcmVjdXJzaXZlLCBzdWNjZXNzLCBlcnJvcikge1xuICAgIC8vIFRlbXBvcmFyeSB3b3JrYXJvdW5kIGZvciBjb250ZW50IGRpc2FwcGVhcmluZyBmcm9tIGJ1bGxldGlucyAtIHN0b3JlIGxhc3QgMTAgc2F2ZXMgdG8gbG9jYWwgc3RvcmFnZSBhbmQgdXBkYXRlIHdpdGggc2VydmVyIHJlc3BvbnNlIGxhdGVyXG4gICAgcG9zdFRvTG9jYWxTdG9yYWdlKGNvbGxlY3Rpb25JZCwgcGF0aCwgY29udGVudCk7XG5cblxuICAgIHZhciBzYWZlUGF0aCA9IGNoZWNrUGF0aFNsYXNoZXMocGF0aCk7XG4gICAgaWYgKHNhZmVQYXRoID09PSAnLycpIHtcbiAgICAgICAgc2FmZVBhdGggPSAnJzsgICAgICAgICAgLy8gZWRnZSBjYXNlIGZvciBob21lXG4gICAgfVxuXG4gICAgaWYgKEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2gpIHtcbiAgICAgICAgdmFyIHVybCA9IFwiL3plYmVkZWUvY29udGVudC9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVQYXRoICsgXCIvZGF0YV9jeS5qc29uXCI7XG4gICAgICAgIHZhciB0b0FkZExhbmcgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICB0b0FkZExhbmcuZGVzY3JpcHRpb24ubGFuZ3VhZ2UgPSAnY3knO1xuICAgICAgICBjb250ZW50ID0gSlNPTi5zdHJpbmdpZnkodG9BZGRMYW5nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXJsID0gXCIvemViZWRlZS9jb250ZW50L1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgc2FmZVBhdGggKyBcIi9kYXRhLmpzb25cIjtcbiAgICB9XG5cbiAgICB2YXIgdXJsID0gdXJsICsgJyZvdmVyd3JpdGVFeGlzdGluZz0nICsgb3ZlcndyaXRlRXhpc3Rpbmc7XG4gICAgdmFyIHVybCA9IHVybCArICcmcmVjdXJzaXZlPScgKyByZWN1cnNpdmU7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBjb250ZW50LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGFkZExvY2FsUG9zdFJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBhZGRMb2NhbFBvc3RSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBlcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBwb3N0VG9Mb2NhbFN0b3JhZ2UoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50KSB7XG4gICAgdmFyIG5ld1NhdmVUaW1lID0gbmV3IERhdGUoKTtcbiAgICB2YXIgbmV3SWQgPSBjb2xsZWN0aW9uSWQ7XG4gICAgdmFyIG5ld1BhdGggPSBwYXRoO1xuICAgIHZhciBuZXdDb250ZW50ID0gSlNPTi5wYXJzZShjb250ZW50KTtcblxuICAgIGNvbnNvbGUubG9nKG5ld0NvbnRlbnQpO1xuICAgIFxuICAgIHZhciBsb2NhbEJhY2t1cCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2NhbEJhY2t1cCcpO1xuXG4gICAgaWYgKGxvY2FsQmFja3VwID09IG51bGwpIHtcbiAgICAgICAgLy8gSWYgc3RvcmFnZSBpdGVtIGRvZXNuJ3QgZXhpc3QgeWV0IGluaXRpYWxpc2UgaXQgd2l0aCBmaXJzdCBzYXZlXG4gICAgICAgIGxvY2FsQmFja3VwID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogbmV3SWQsXG4gICAgICAgICAgICAgICAgY29udGVudDogbmV3Q29udGVudCxcbiAgICAgICAgICAgICAgICBwYXRoOiBuZXdQYXRoLFxuICAgICAgICAgICAgICAgIHNhdmVUaW1lOiBuZXdTYXZlVGltZSxcbiAgICAgICAgICAgICAgICBwb3N0UmVzcG9uc2U6ICcnXG4gICAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBQYXJzZSBzdHJpbmcgYmFjayBpbnRvIEpTT04gZm9yIHJlYWRpbmcgYW5kIHdyaXRpbmdcbiAgICAgICAgbG9jYWxCYWNrdXAgPSBKU09OLnBhcnNlKGxvY2FsQmFja3VwKTtcblxuICAgICAgICB2YXIgYmFja3VwTGVuZ3RoID0gbG9jYWxCYWNrdXAubGVuZ3RoO1xuXG4gICAgICAgIC8vIFJlbW92ZSBvbGRlc3QgZW50cnkgaWYgYXJyYXkgaXMgZnVsbFxuICAgICAgICBpZiAoYmFja3VwTGVuZ3RoID09IDEwKSB7XG4gICAgICAgICAgICBsb2NhbEJhY2t1cC5wb3AoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBuZXcgZW50cnkgdG8gdGhlIHRvcCBvZiB0aGUgYXJyYXlcbiAgICAgICAgbG9jYWxCYWNrdXAudW5zaGlmdChcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSWQ6IG5ld0lkLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG5ld0NvbnRlbnQsXG4gICAgICAgICAgICAgICAgcGF0aDogbmV3UGF0aCxcbiAgICAgICAgICAgICAgICBzYXZlVGltZTogbmV3U2F2ZVRpbWUsXG4gICAgICAgICAgICAgICAgcG9zdFJlc3BvbnNlOiAnJ1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGxvY2FsQmFja3VwID0gSlNPTi5zdHJpbmdpZnkobG9jYWxCYWNrdXApO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsb2NhbEJhY2t1cCcsIGxvY2FsQmFja3VwKTtcbn1cblxuZnVuY3Rpb24gYWRkTG9jYWxQb3N0UmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICB2YXIgbG9jYWxCYWNrdXAgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2NhbEJhY2t1cCcpKTtcbiAgICBsb2NhbEJhY2t1cFswXS5wb3N0UmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbG9jYWxCYWNrdXAnLCBKU09OLnN0cmluZ2lmeShsb2NhbEJhY2t1cCkpO1xufVxuLyoqXG4gKiBIdHRwIHBvc3QgdG8gdGhlIHplYmVkZWUgQVBJIHRvIGF1dGhlbnRpY2F0ZSBhIHVzZXIuXG4gKiBAcGFyYW0gZW1haWwgLSB0aGUgZW1haWwgb2YgdGhlIHVzZXIgdG8gYXV0aGVudGljYXRlXG4gKiBAcGFyYW0gcGFzc3dvcmQgLSB0aGUgcGFzc3dvcmQgb2YgdGhlIHVzZXJcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBwb3N0TG9naW4oZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2xvZ2luXCIsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICB9KSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBcImFjY2Vzc190b2tlbj1cIiArIHJlc3BvbnNlICsgXCI7cGF0aD0vXCI7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImxvZ2dlZEluQXNcIiwgZW1haWwpO1xuXG4gICAgICAgICAgICAvLyBTdG9yaW5nIGluIFJlZHV4IGZvciB1c2UgaW4gcmVmYWN0b3JlZCBKU1xuICAgICAgICAgICAgdmFyIHVzZXJTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS91c2VyU3RhdGUuanMnKTtcbiAgICAgICAgICAgIHVzZXJTdGF0ZS5lbWFpbC5zZXQoZW1haWwpO1xuXG4gICAgICAgICAgICBnZXRVc2VyUGVybWlzc2lvbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocGVybWlzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwZXJtaXNzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhbGxvdyBhY2Nlc3MgdG8gZWRpdG9ycyBhbmQgYWRtaW5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlcm1pc3Npb24uYWRtaW4gfHwgcGVybWlzc2lvbi5lZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFB1Ymxpc2hlclR5cGUocGVybWlzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5yZWZyZXNoQWRtaW5NZW51KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3Q29udHJvbGxlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgZG8gbm90IGhhdmUgdGhlIHBlcm1pc3Npb25zIHRvIGVudGVyIGhlcmUuIFBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBsb2dvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlRoZXJlIGlzIGEgcHJvYmxlbSB3aXRoIHBlcm1pc3Npb25zLiBQbGVhc2UgY29udGFjdCBhbiBhZG1pbmlzdHJhdG9yXCIpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW1haWxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQxNykge1xuICAgICAgICAgICAgICAgIHZpZXdDaGFuZ2VQYXNzd29yZChlbWFpbCwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUxvZ2luQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGdldFB1Ymxpc2hlclR5cGUocGVybWlzc2lvbikge1xuICAgIC8vIFZhcmlhYmxlIGZvciB1c2VyIHR5cGUgdG8gYmUgZGlzcGF0Y2hlZCB0byBSZWR1eCBsYXRlclxuICAgIHZhciB1c2VyU3RhdGUgPSByZXF1aXJlKCdzaGFyZWQvc3RhdGUvdXNlclN0YXRlLmpzJyksXG4gICAgICAgIHVzZXJUeXBlO1xuXG4gICAgLy8gU3RvcmUgaW4gbG9jYWxTdG9yYWdlIHB1Ymxpc2hlciB0eXBlXG4gICAgaWYgKHBlcm1pc3Npb24uYWRtaW4pIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyVHlwZVwiLCBcIlBVQkxJU0hJTkdfU1VQUE9SVFwiKTtcbiAgICAgICAgdXNlclR5cGUgPSBcIlBVQkxJU0hJTkdfU1VQUE9SVFwiXG4gICAgfSBlbHNlIGlmIChwZXJtaXNzaW9uLmVkaXRvciAmJiAhcGVybWlzc2lvbi5kYXRhVmlzUHVibGlzaGVyKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwidXNlclR5cGVcIiwgXCJQVUJMSVNISU5HX1NVUFBPUlRcIik7XG4gICAgICAgIHVzZXJUeXBlID0gXCJQVUJMSVNISU5HX1NVUFBPUlRcIjtcbiAgICB9IGVsc2UgaWYgKHBlcm1pc3Npb24uZWRpdG9yICYmIHBlcm1pc3Npb24uZGF0YVZpc1B1Ymxpc2hlcikge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJUeXBlXCIsIFwiREFUQV9WSVNVQUxJU0FUSU9OXCIpO1xuICAgICAgICB1c2VyVHlwZSA9IFwiREFUQV9WSVNVQUxJU0FUSU9OXCI7XG4gICAgfSBlbHNlIGlmICghcGVybWlzc2lvbi5hZG1pbiAmJiAhcGVybWlzc2lvbi5lZGl0b3IgJiYgIXBlcm1pc3Npb24uZGF0YVZpc1B1Ymxpc2hlcikge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJUeXBlXCIsIFwiVklFV0VSXCIpO1xuICAgICAgICB1c2VyVHlwZSA9IFwiVklFV0VSXCI7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIFJlZHV4IHdpdGggdXNlciB0eXBlXG4gICAgdXNlclN0YXRlLnR5cGUuc2V0KHVzZXJUeXBlKTtcbn1cbmZ1bmN0aW9uIHNhdmVBbmRSZXZpZXdDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aCwgY29udGVudCwgcmVjdXJzaXZlLCByZWRpcmVjdFRvUGF0aCkge1xuXG4gICAgaWYgKCFyZWN1cnNpdmUpIHtcbiAgICAgICAgcmVjdXJzaXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIGNvbnRlbnQsXG4gICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHJlZGlyZWN0VG9QYXRoKSB7XG4gICAgICAgICAgICAgICAgcG9zdFJldmlldyhjb2xsZWN0aW9uSWQsIHBhdGgsIHJlY3Vyc2l2ZSwgcmVkaXJlY3RUb1BhdGgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwb3N0UmV2aWV3KGNvbGxlY3Rpb25JZCwgcGF0aCwgcmVjdXJzaXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVjdXJzaXZlKTtcbn1cblxuZnVuY3Rpb24gcG9zdFJldmlldyhjb2xsZWN0aW9uSWQsIHBhdGgsIHJlY3Vyc2l2ZSwgcmVkaXJlY3RUb1BhdGgpIHtcbiAgICB2YXIgcmVkaXJlY3QgPSByZWRpcmVjdFRvUGF0aDtcbiAgICB2YXIgc2FmZVBhdGggPSBjaGVja1BhdGhTbGFzaGVzKHBhdGgpO1xuICAgIGlmIChzYWZlUGF0aCA9PT0gJy8nKSB7XG4gICAgICAgIHNhZmVQYXRoID0gJyc7ICAgICAgICAgIC8vIGVkZ2UgY2FzZSBmb3IgaG9tZVxuICAgIH1cblxuICAgIGlmIChGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICAgIHZhciB1cmwgPSBcIi96ZWJlZGVlL3Jldmlldy9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVQYXRoICsgXCIvZGF0YV9jeS5qc29uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHVybCA9IFwiL3plYmVkZWUvcmV2aWV3L1wiICsgY29sbGVjdGlvbklkICsgXCI/dXJpPVwiICsgc2FmZVBhdGggKyBcIi9kYXRhLmpzb25cIjtcbiAgICB9XG5cbiAgICB2YXIgdXJsID0gdXJsICsgJyZyZWN1cnNpdmU9JyArIHJlY3Vyc2l2ZTtcblxuICAgIC8vIE9wZW4gdGhlIGZpbGUgZm9yIGVkaXRpbmdcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAocmVkaXJlY3QpIHtcbiAgICAgICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UocmVkaXJlY3QsIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3Rpb24gZnJvbSAnd29ya2luZyBvbjogY29sbGVjdGlvbicgdGFiXG4gICAgICAgICAgICAgICAgJCgnLmpzLW5hdi1pdGVtLS1jb2xsZWN0aW9uJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1uYXYtaXRlbScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1uYXYtaXRlbS0tY29sbGVjdGlvbnMnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAgICAgICAgIHZpZXdDb2xsZWN0aW9ucyhjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmZ1bmN0aW9uIHBvc3RUZWFtKG5hbWUpIHtcblxuICAgIHZhciBlbmNvZGVkTmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChuYW1lKTtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvdGVhbXMvXCIgKyBlbmNvZGVkTmFtZSxcbiAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBuYW1lOiBlbmNvZGVkTmFtZVxuICAgICAgICB9KSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2aWV3VGVhbXMoc2VsZWN0VGFibGVSb3dBbmREaXNwbGF5VGVhbURldGFpbHMpO1xuXG4gICAgICAgICAgICAvLyBvbiBzdWNjZXNzIG9mIHZpZXcgdGVhbXMsIGRpc3BsYXkgbmV3IHRlYW0gZGV0YWlscyBhbmQgaGlnaGxpZ2h0IHRlYW0gaW4gdGFibGVcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNlbGVjdFRhYmxlUm93QW5kRGlzcGxheVRlYW1EZXRhaWxzKCkge1xuICAgICAgICAgICAgICAgIHZhciByb3dUb1NlbGVjdCA9ICQoXCJ0YWJsZVwiKS5maW5kKFwiW2RhdGEtaWQ9J1wiICsgbmFtZSArIFwiJ11cIik7XG4gICAgICAgICAgICAgICAgdmlld1RlYW1EZXRhaWxzKG5hbWUsIHJvd1RvU2VsZWN0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBoYW5kbGVVc2VyUG9zdEVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGVycm9yIHJlc3BvbnNlIGZyb20gY3JlYXRpbmcgdGhlIHRlYW0uXG4gICAgICogQHBhcmFtIHJlc3BvbnNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFuZGxlVXNlclBvc3RFcnJvcihyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJZb3UgYXJlIG5vdCBwZXJtaXR0ZWQgdG8gY3JlYXRlIHRlYW1zLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5tZXNzYWdlLCBcImVycm9yXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwb3N0VGVhbU1lbWJlcihuYW1lLCBlbWFpbCkge1xuICAgIHZhciBlbmNvZGVkTmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChuYW1lKTtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvdGVhbXMvXCIgKyBlbmNvZGVkTmFtZSArIFwiP2VtYWlsPVwiICsgZW1haWwsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgbmFtZTogZW1haWxcbiAgICAgICAgfSksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUZWFtIG1lbWJlciBhZGRlZDogJyArIGVtYWlsKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlVXNlclBvc3RFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBlcnJvciByZXNwb25zZSBmcm9tIGNyZWF0aW5nIHRoZSB0ZWFtLlxuICAgICAqIEBwYXJhbSByZXNwb25zZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhhbmRsZVVzZXJQb3N0RXJyb3IocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KFwiWW91IGFyZSBub3QgcGVybWl0dGVkIHRvIGFkZCB1c2Vycy5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZSwgXCJlcnJvclwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIHBvc3RVc2VyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCwgaXNBZG1pbiwgaXNFZGl0b3IsIGlzRGF0YVZpc1B1Ymxpc2hlcikge1xuXG4gICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMubG9hZGluZ0FuaW1hdGlvbih7ZGFyazogdHJ1ZSwgbGFyZ2U6IHRydWV9KTtcbiAgICBzd2VldEFsZXJ0KHtcbiAgICAgICAgdGl0bGU6IFwiVXNlciBiZWluZyBjcmVhdGVkLi4uXCIsXG4gICAgICAgIHRleHQ6IGh0bWwsXG4gICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgaHRtbDogdHJ1ZVxuICAgIH0pO1xuXG4gICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiBcIi96ZWJlZGVlL3VzZXJzXCIsXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbFxuICAgICAgICB9KSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgY3JlYXRlZCcpO1xuICAgICAgICAgICAgc2V0UGFzc3dvcmQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlVXNlclBvc3RFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIE9uY2UgdGhlIHVzZXIgaXMgY3JlYXRlZCBkbyBhIHNlcGFyYXRlIHBvc3QgdG8gdGhlIHplYmVkZWUgQVBJXG4gICAgICogdG8gc2V0IHRoZSBwYXNzd29yZC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZXRQYXNzd29yZCgpIHtcbiAgICAgICAgcG9zdFBhc3N3b3JkKFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUGFzc3dvcmQgc2V0Jyk7XG4gICAgICAgICAgICAgICAgc2V0UGVybWlzc2lvbnMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9IG51bGwsXG4gICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbmNlIHRoZSB1c2VyIGlzIGNyZWF0ZWQgYW5kIHRoZSBwYXNzd29yZCBpcyBzZXQsIHNldCB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldFBlcm1pc3Npb25zKCkge1xuICAgICAgICBwb3N0UGVybWlzc2lvbihcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlVzZXIgY3JlYXRlZFwiLCBcIlVzZXIgJ1wiICsgZW1haWwgKyBcIicgaGFzIGJlZW4gY3JlYXRlZFwiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgdmlld0NvbnRyb2xsZXIoJ3VzZXJzJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBudWxsLFxuICAgICAgICAgICAgZW1haWwgPSBlbWFpbCxcbiAgICAgICAgICAgIGFkbWluID0gaXNBZG1pbixcbiAgICAgICAgICAgIGVkaXRvciA9IGlzRWRpdG9yLFxuICAgICAgICAgICAgZGF0YVZpc1B1Ymxpc2hlciA9IGlzRGF0YVZpc1B1Ymxpc2hlclxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgZXJyb3IgcmVzcG9uc2UgZnJvbSBjcmVhdGluZyB0aGUgdXNlci5cbiAgICAgKiBAcGFyYW0gcmVzcG9uc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYW5kbGVVc2VyUG9zdEVycm9yKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgICAgc3dlZXRBbGVydChcIllvdSBhcmUgbm90IHBlcm1pdHRlZCB0byBjcmVhdGUgdXNlcnMuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KFwiRXJyb3JcIiwgcmVzcG9uc2UucmVzcG9uc2VKU09OLm1lc3NhZ2UsIFwiZXJyb3JcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2goY29sbGVjdGlvbklkKSB7XG5cbiAgLy8gT3BlbiB0aGUgZmlsZSBmb3IgZWRpdGluZ1xuICAkLmFqYXgoe1xuICAgIHVybDogXCIvemViZWRlZS9wdWJsaXNoL1wiICsgY29sbGVjdGlvbklkLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBjcm9zc0RvbWFpbjogdHJ1ZSxcbiAgICB0eXBlOiAnUE9TVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAkKCcub3ZlcicpLnJlbW92ZSgpO1xuXG4gICAgICBpZihyZXNwb25zZSkge1xuICAgICAgICBzd2VldEFsZXJ0KFwiUHVibGlzaGVkIVwiLCBcIllvdXIgY29sbGVjdGlvbiBoYXMgc3VjY2Vzc2Z1bGx5IHB1Ymxpc2hlZFwiLCBcInN1Y2Nlc3NcIik7XG5cbiAgICAgICAgJCgnLnB1Ymxpc2gtc2VsZWN0ZWQnKS5hbmltYXRlKHtyaWdodDogXCItNTAlXCJ9LCA1MDApO1xuICAgICAgICAvLyBXYWl0IHVudGlsIHRoZSBhbmltYXRpb24gZW5kc1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2aWV3Q29udHJvbGxlcigncHVibGlzaCcpO1xuICAgICAgICB9LCA1MDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FuIGVycm9yIGhhcyBvY2N1cnJlZCBkdXJpbmcgdGhlIHB1Ymxpc2ggcHJvY2VzcywgcGxlYXNlIGNvbnRhY3QgYW4gYWRtaW5pc3RyYXRvci4gJyArIHJlc3BvbnNlKTtcbiAgICAgICAgc3dlZXRBbGVydChcIk9vcHMhXCIsICdBbiBlcnJvciBoYXMgb2NjdXJyZWQgZHVyaW5nIHRoZSBwdWJsaXNoIHByb2Nlc3MsIHBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3IuJywgXCJlcnJvclwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICQoJy5vdmVyJykucmVtb3ZlKCk7XG4gICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gdW5sb2NrKGNvbGxlY3Rpb25JZCkge1xuXG4gIC8vIE9wZW4gdGhlIGZpbGUgZm9yIGVkaXRpbmdcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvdW5sb2NrL1wiICsgY29sbGVjdGlvbklkLFxuICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBjcm9zc0RvbWFpbjogdHJ1ZSxcbiAgICB0eXBlOiAnUE9TVCcsXG4gICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgc3dlZXRBbGVydChcIlVubG9ja2VkIVwiLCBcIllvdXIgY29sbGVjdGlvbiBoYXMgYmUgdW5sb2NrZWQgZnJvbSBwdWJsaXNoaW5nXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICQoJy5wdWJsaXNoLXNlbGVjdGVkJykuYW5pbWF0ZSh7cmlnaHQ6IFwiLTUwJVwifSwgNTAwKTtcbiAgICAgIC8vIFdhaXQgdW50aWwgdGhlIGFuaW1hdGlvbiBlbmRzXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmlld0NvbnRyb2xsZXIoJ3B1Ymxpc2gnKTtcbiAgICAgIH0sIDUwMCk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVmcmVzaFByZXZpZXcodXJsKSB7XG5cbiAgaWYgKHVybCkge1xuICAgIHZhciBzYWZlVXJsID0gY2hlY2tQYXRoU2xhc2hlcyh1cmwpO1xuICAgIHZhciBuZXdVcmwgPSBGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCArIHNhZmVVcmw7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZiA9IG5ld1VybDtcbiAgICAkKCcuYnJvd3Nlci1sb2NhdGlvbicpLnZhbChuZXdVcmwpO1xuICB9XG4gIGVsc2Uge1xuICAgIHZhciB1cmxTdG9yZWQgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQYXRoO1xuICAgIHZhciBzYWZlVXJsID0gY2hlY2tQYXRoU2xhc2hlcyh1cmxTdG9yZWQpO1xuICAgIHZhciBuZXdVcmwgPSBGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCArIHNhZmVVcmw7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZiA9IG5ld1VybDtcbiAgICAkKCcuYnJvd3Nlci1sb2NhdGlvbicpLnZhbChuZXdVcmwpO1xuICB9XG59XG5cbi8qKlxuICogTWFuYWdlcyByZWxhdGVkIGRhdGFcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWRcbiAqIEBwYXJhbSBkYXRhXG4gKiBAcGFyYW0gdGVtcGxhdGVEYXRhXG4gKiBAcGFyYW0gZmllbGQgLSBKU09OIGRhdGEga2V5XG4gKiBAcGFyYW0gaWRGaWVsZCAtIEhUTUwgaWQgZm9yIHRoZSB0ZW1wbGF0ZVxuICovXG5cbmZ1bmN0aW9uIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gICAgdmFyIGRhdGFUZW1wbGF0ZSA9IGNyZWF0ZVJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvblZpZXdNb2RlbChpZEZpZWxkLCBsaXN0LCBkYXRhKTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JSZWxhdGVkKGRhdGFUZW1wbGF0ZSk7XG4gICAgJCgnIycgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aChodG1sKTtcbiAgICByZXNvbHZlUGFnZVRpdGxlc1RoZW5SZWZyZXNoKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zKTtcbn1cblxuZnVuY3Rpb24gcmVmcmVzaFJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcbiAgICB2YXIgbGlzdCA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gICAgdmFyIGRhdGFUZW1wbGF0ZSA9IGNyZWF0ZVJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvblZpZXdNb2RlbChpZEZpZWxkLCBsaXN0LCBkYXRhKTtcbiAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy5lZGl0b3JSZWxhdGVkKGRhdGFUZW1wbGF0ZSk7XG4gICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5yZXBsYWNlV2l0aCgkKGh0bWwpLmZpbmQoJyNzb3J0YWJsZS0nICsgaWRGaWVsZCkpO1xuICAgIGluaXRpYWxpc2VSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCB0ZW1wbGF0ZURhdGEsIGZpZWxkLCBpZEZpZWxkKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uVmlld01vZGVsKGlkRmllbGQsIGxpc3QsIGRhdGEpIHtcbiAgICB2YXIgZGF0YVRlbXBsYXRlO1xuICAgIHZhciBpc1B1YmxpY2F0aW9uID0gKGRhdGEudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBkYXRhLnR5cGUgPT09ICdhcnRpY2xlJyB8fCBkYXRhLnR5cGUgPT09ICdjb21wZW5kaXVtX2NoYXB0ZXInKTtcblxuICAgIGlmIChpZEZpZWxkID09PSAnYXJ0aWNsZScpIHtcbiAgICAgICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGlkUGx1cmFsOiAnYXJ0aWNsZXMgKERPIE5PVCBVU0UuIFRPIEJFIERFTEVURUQpJ307XG4gICAgfSBlbHNlIGlmIChpZEZpZWxkID09PSAnYnVsbGV0aW4nKSB7XG4gICAgICAgIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkLCBpZFBsdXJhbDogJ2J1bGxldGlucyAoRE8gTk9UIFVTRS4gVE8gQkUgREVMRVRFRCknfTtcbiAgICB9IGVsc2UgaWYgKGlkRmllbGQgPT09ICdkYXRhc2V0Jykge1xuICAgICAgICBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZCwgaWRQbHVyYWw6ICdkYXRhc2V0cyd9O1xuICAgIH0gZWxzZSBpZiAoaWRGaWVsZCA9PT0gJ2RvY3VtZW50Jykge1xuICAgICAgICBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZCwgaWRQbHVyYWw6ICdidWxsZXRpbnMgfCBhcnRpY2xlcyB8IGNvbXBlbmRpYSd9O1xuICAgIH0gZWxzZSBpZiAoaWRGaWVsZCA9PT0gJ3FtaScgJiYgaXNQdWJsaWNhdGlvbikge1xuICAgICAgICAvLyBUZWxsIHVzZXJzIG5vdCB0byB1c2UgcmVsYXRlZCBRTUlzIGlmIGVkaXRpbmcgYSBwdWJsaWNhdGlvbiAoaW5wdXQgYmVpbmcgcGhhc2VkIG91dClcbiAgICAgICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGlkUGx1cmFsOiAnUU1JcyAoRE8gTk9UIFVTRS4gVE8gQkUgREVMRVRFRCknfVxuICAgIH0gZWxzZSBpZiAoaWRGaWVsZCA9PT0gJ3FtaScpIHtcbiAgICAgICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGlkUGx1cmFsOiAnUU1Jcyd9XG4gICAgfSBlbHNlIGlmIChpZEZpZWxkID09PSAnbWV0aG9kb2xvZ3knICYmIGlzUHVibGljYXRpb24pIHtcbiAgICAgICAgLy8gVGVsbCB1c2VycyBub3QgdG8gdXNlIHJlbGF0ZWQgbWV0aG9kb2xvZ3kgaWYgZWRpdGluZyBhIHB1YmxpY2F0aW9uIChpbnB1dCBiZWluZyBwaGFzZWQgb3V0KVxuICAgICAgICBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZCwgaWRQbHVyYWw6ICdtZXRob2RvbG9neSAoRE8gTk9UIFVTRS4gVE8gQkUgREVMRVRFRCknfTtcbiAgICB9IGVsc2UgaWYgKGlkRmllbGQgPT09ICdtZXRob2RvbG9neScpIHtcbiAgICAgICAgZGF0YVRlbXBsYXRlID0ge2xpc3Q6IGxpc3QsIGlkRmllbGQ6IGlkRmllbGQsIGlkUGx1cmFsOiAnbWV0aG9kb2xvZ3knfTtcbiAgICB9IGVsc2UgaWYgKGlkRmllbGQgPT09ICdsaW5rJykge1xuICAgICAgICBkYXRhVGVtcGxhdGUgPSB7bGlzdDogbGlzdCwgaWRGaWVsZDogaWRGaWVsZCwgaWRQbHVyYWw6ICdsaW5rcyd9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGFUZW1wbGF0ZSA9IHtsaXN0OiBsaXN0LCBpZEZpZWxkOiBpZEZpZWxkfTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGFUZW1wbGF0ZTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZVJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpIHtcblxuICAgIGlmIChkYXRhW2ZpZWxkXSkge1xuICAgICAgICAkKGRhdGFbZmllbGRdKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgLy8gQXR0YWNoIGRlbGV0ZSBidXR0b24gaGFuZGxlci5cbiAgICAgICAgICAgICQoJyMnICsgaWRGaWVsZCArICctZGVsZXRlXycgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZUl0ZW0oaW5kZXgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGF0dGFjaCBhZGQgYnV0dG9uIGhhbmRsZXIuXG4gICAgJCgnI2FkZC0nICsgaWRGaWVsZCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbU1vZGFsKCk7XG4gICAgfSk7XG5cbiAgICAvLyBNYWtlIHNlY3Rpb25zIHNvcnRhYmxlXG4gICAgZnVuY3Rpb24gc29ydGFibGUoKSB7XG4gICAgICAgIHZhciBzb3J0YWJsZVN0YXJ0UG9zaXRpb247XG5cbiAgICAgICAgJCgnI3NvcnRhYmxlLScgKyBpZEZpZWxkKS5zb3J0YWJsZSh7XG4gICAgICAgICAgICBzdGFydDogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuXG4gICAgICAgICAgICAgICAgLy8gcmVtZW1iZXIgdGhlIGluZGV4IG9mIHRoZSBpdGVtIGF0IHRoZSBzdGFydCBvZiBkcmFnICsgZHJvcFxuICAgICAgICAgICAgICAgIHNvcnRhYmxlU3RhcnRQb3NpdGlvbiA9IHVpLml0ZW0uaW5kZXgoKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvcnRhYmxlIHN0YXJ0OiBcIiArIHNvcnRhYmxlU3RhcnRQb3NpdGlvbik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuXG4gICAgICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBuZXcgaW5kZXggb2YgdGhlIGl0ZW0gYWZ0ZXIgYmVpbmcgZHJvcHBlZC5cbiAgICAgICAgICAgICAgICB2YXIgc29ydGFibGVFbmRQb3NpdGlvbiA9IHVpLml0ZW0uaW5kZXgoKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvcnRhYmxlIHVwZGF0ZTogU3RhcnQ6IFwiICsgc29ydGFibGVTdGFydFBvc2l0aW9uICsgXCIgbm93OiBcIiArIHNvcnRhYmxlRW5kUG9zaXRpb24pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25zQXJyYXkgPSBkYXRhW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRhdGFbZmllbGRdW3NvcnRhYmxlU3RhcnRQb3NpdGlvbl07XG5cbiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBpdGVtIGZyb20gdGhlIHN0YXJ0IGRyYWcgcG9zaXRpb24gdG8gdGhlIGVuZCBkcm9wIHBvc2l0aW9uIGluIHRoZSBkYXRhIG1vZGVsLlxuICAgICAgICAgICAgICAgIHNlY3Rpb25zQXJyYXkuc3BsaWNlKHNvcnRhYmxlU3RhcnRQb3NpdGlvbiwgMSk7XG4gICAgICAgICAgICAgICAgc2VjdGlvbnNBcnJheS5zcGxpY2Uoc29ydGFibGVFbmRQb3NpdGlvbiwgMCwgaXRlbSk7XG5cbiAgICAgICAgICAgICAgICBzYXZlQ29udGVudEFuZFJlZnJlc2hTZWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNvcnRhYmxlKCk7XG5cbiAgICBmdW5jdGlvbiBkZWxldGVJdGVtKGluZGV4KSB7XG4gICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgdGl0bGU6IFwiV2FybmluZ1wiLFxuICAgICAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgbGluaz9cIixcbiAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICBzaG93RGVsZXRlZE1lc3NhZ2UoKTtcblxuICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgaXRlbSBmcm9tIHRoZSBkYXRhIG1vZGVsLlxuICAgICAgICAgICAgICAgIGRhdGFbZmllbGRdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXS5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgICAgICAgc2F2ZUNvbnRlbnRBbmRSZWZyZXNoU2VjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYXZlQ29udGVudEFuZFJlZnJlc2hTZWN0aW9uKCkge1xuICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgICAgICAgICAgICByZWZyZXNoUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0RlbGV0ZWRNZXNzYWdlKCkge1xuICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBcIiArIGlkRmllbGQgKyBcIiBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgIHRpbWVyOiAyMDAwXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbmRlclJlbGF0ZWRJdGVtTW9kYWwoKSB7XG5cbiAgICAgICAgdmFyIHZpZXdNb2RlbCA9IHtoYXNMYXRlc3Q6IGZhbHNlfTsgLy9TZXQgdG8gdHJ1ZSBpZiAnbGF0ZXN0JyBjaGVja2JveCBzaG91bGQgc2hvd1xuICAgICAgICB2YXIgbGF0ZXN0Q2hlY2s7IC8vUG9wdWxhdGVkIHdpdGggdHJ1ZS9mYWxzZSBsYXRlciB0byBjaGVjayBzdGF0ZSBvZiBjaGVja2JveFxuXG4gICAgICAgIGlmIChpZEZpZWxkID09PSAnYXJ0aWNsZScgfHwgaWRGaWVsZCA9PT0gJ2J1bGxldGluJyB8fCBpZEZpZWxkID09PSAnYXJ0aWNsZXMnIHx8IGlkRmllbGQgPT09ICdidWxsZXRpbnMnIHx8IGlkRmllbGQgPT09ICdkb2N1bWVudCcgfHwgaWRGaWVsZCA9PT0gJ2hpZ2hsaWdodHMnKSB7XG4gICAgICAgICAgICB2aWV3TW9kZWwgPSB7aGFzTGF0ZXN0OiB0cnVlfTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJy5tb2RhbCcpLnJlbW92ZSgpO1xuICAgICAgICB2YXIgbW9kYWwgPSB0ZW1wbGF0ZXMucmVsYXRlZE1vZGFsKHZpZXdNb2RlbCk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmFwcGVuZChtb2RhbCk7XG4gICAgICAgICQoJy5tb2RhbC1ib3ggaW5wdXRbdHlwZT10ZXh0XScpLmZvY3VzKCk7XG5cbiAgICAgICAgLy9Nb2RhbCBjbGljayBldmVudHNcbiAgICAgICAgJCgnLmJ0bi11cmktY2FuY2VsJykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoJy5tb2RhbCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgLy9jcmVhdGVXb3Jrc3BhY2UoZGF0YS51cmksIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ0bi11cmktZ2V0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHBhc3RlZFVybCA9ICQoJyN1cmktaW5wdXQnKS52YWwoKTtcbiAgICAgICAgICAgIHZhciBkYXRhVXJsID0gY2hlY2tQYXRoUGFyc2VkKHBhc3RlZFVybCk7XG4gICAgICAgICAgICB2YXIgbGF0ZXN0Q2hlY2sgPSAkKCdpbnB1dFtpZD1cImxhdGVzdFwiXScpLnByb3AoJ2NoZWNrZWQnKTtcbiAgICAgICAgICAgIGdldFBhZ2UoZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgbGF0ZXN0Q2hlY2ssIGRhdGFVcmwpO1xuICAgICAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idG4tdXJpLWJyb3dzZScpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaWZyYW1lRXZlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdztcbiAgICAgICAgICAgIGlmcmFtZUV2ZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgRmxvcmVuY2UuSGFuZGxlciwgdHJ1ZSk7XG4gICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoZGF0YS51cmksIGNvbGxlY3Rpb25JZCwgJycsIG51bGwsIHRydWUpO1xuICAgICAgICAgICAgJCgnLm1vZGFsJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vRGlzYWJsZSB0aGUgZWRpdG9yXG4gICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKFxuICAgICAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0nY29sIGNvbC0tNSBwYW5lbCBtb2RhbC1iYWNrZ3JvdW5kJz48L2Rpdj5cIlxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy9BZGQgYnV0dG9ucyB0byBpZnJhbWUgd2luZG93XG4gICAgICAgICAgICB2YXIgaWZyYW1lTmF2ID0gdGVtcGxhdGVzLmlmcmFtZU5hdih2aWV3TW9kZWwpO1xuICAgICAgICAgICAgJChpZnJhbWVOYXYpLmhpZGUoKS5hcHBlbmRUbygnLmJyb3dzZXInKS5mYWRlSW4oNjAwKTtcblxuICAgICAgICAgICAgLy9UYWtlIGlmcmFtZSB3aW5kb3cgdG8gaG9tZXBhZ2Uvcm9vdFxuICAgICAgICAgICAgJCgnI2lmcmFtZScpLmF0dHIoJ3NyYycsICcvJyk7XG5cbiAgICAgICAgICAgICQoJy5idG4tYnJvd3NlLWNhbmNlbCcpLm9mZigpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQsICdlZGl0Jyk7XG4gICAgICAgICAgICAgICAgJCgnLmlmcmFtZS1uYXYnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwtYmFja2dyb3VuZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vUmVtb3ZlIGFkZGVkIG1hcmt1cCBpZiB1c2VyIG5hdmlnYXRlcyBhd2F5IGZyb20gZWRpdG9yIHNjcmVlblxuICAgICAgICAgICAgJCgnYTpub3QoLmJ0bi1icm93c2UtZ2V0KScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCcuaWZyYW1lLW5hdicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJy5tb2RhbC1iYWNrZ3JvdW5kJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCgnLmJ0bi1icm93c2UtZ2V0Jykub2ZmKCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVVybCA9IGdldFBhdGhOYW1lVHJpbUxhc3QoKTtcbiAgICAgICAgICAgICAgICBsYXRlc3RDaGVjayA9ICQoJ2lucHV0W2lkPVwibGF0ZXN0XCJdJykucHJvcCgnY2hlY2tlZCcpO1xuICAgICAgICAgICAgICAgICQoJy5pZnJhbWUtbmF2JykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tncm91bmQnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBnZXRQYWdlKGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGxhdGVzdENoZWNrLCBkYXRhVXJsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQYWdlKGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGxhdGVzdENoZWNrLCBkYXRhVXJsKSB7XG5cbiAgICAgICAgdmFyIGRhdGFVcmxEYXRhID0gZGF0YVVybCArIFwiL2RhdGFcIjtcbiAgICAgICAgdmFyIGxhdGVzdFVybDtcbiAgICAgICAgaWYgKGxhdGVzdENoZWNrKSB7XG4gICAgICAgICAgICB2YXIgdGVtcFVybCA9IGRhdGFVcmwuc3BsaXQoJy8nKTtcbiAgICAgICAgICAgIHRlbXBVcmwucG9wKCk7XG4gICAgICAgICAgICB0ZW1wVXJsLnB1c2goJ2xhdGVzdCcpO1xuICAgICAgICAgICAgbGF0ZXN0VXJsID0gdGVtcFVybC5qb2luKCcvJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsYXRlc3RVcmwgPSBkYXRhVXJsO1xuICAgICAgICB9XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogZGF0YVVybERhdGEsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocGFnZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKChmaWVsZCA9PT0gJ3JlbGF0ZWRCdWxsZXRpbnMnIHx8IGZpZWxkID09PSAnc3RhdHNCdWxsZXRpbnMnKSAmJiBwYWdlLnR5cGUgPT09ICdidWxsZXRpbicpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGlzZUZpZWxkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKChmaWVsZCA9PT0gJ3JlbGF0ZWREYXRhc2V0cycgfHwgZmllbGQgPT09ICdkYXRhc2V0cycpICYmIChwYWdlLnR5cGUgPT09ICdkYXRhc2V0JyB8fCBwYWdlLnR5cGUgPT09ICd0aW1lc2VyaWVzX2RhdGFzZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXNlRmllbGQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGQgPT09ICdyZWxhdGVkQXJ0aWNsZXMnICYmIChwYWdlLnR5cGUgPT09ICdhcnRpY2xlJyB8fCBwYWdlLnR5cGUgPT09ICdhcnRpY2xlX2Rvd25sb2FkJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpc2VGaWVsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZmllbGQgPT09ICdyZWxhdGVkRG9jdW1lbnRzJykgJiYgKHBhZ2UudHlwZSA9PT0gJ2FydGljbGUnIHx8IHBhZ2UudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnIHx8IHBhZ2UudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpc2VGaWVsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZmllbGQgPT09ICdyZWxhdGVkRGF0YXNldHMnIHx8IGZpZWxkID09PSAnZGF0YXNldHMnKSAmJiAocGFnZS50eXBlID09PSAnZGF0YXNldF9sYW5kaW5nX3BhZ2UnIHx8IHBhZ2UudHlwZSA9PT0gJ2NvbXBlbmRpdW1fZGF0YScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpc2VGaWVsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZmllbGQgPT09ICdpdGVtcycpICYmIChwYWdlLnR5cGUgPT09ICd0aW1lc2VyaWVzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGlzZUZpZWxkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKChmaWVsZCA9PT0gJ3JlbGF0ZWREYXRhJykgJiYgKHBhZ2UudHlwZSA9PT0gJ2RhdGFzZXRfbGFuZGluZ19wYWdlJyB8fCBwYWdlLnR5cGUgPT09ICd0aW1lc2VyaWVzJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2RhdGEnKSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXNlRmllbGQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGQgPT09ICdyZWxhdGVkTWV0aG9kb2xvZ3knICYmIChwYWdlLnR5cGUgPT09ICdzdGF0aWNfcW1pJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGlzZUZpZWxkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkID09PSAncmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZScgJiYgKHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neScgfHwgcGFnZS50eXBlID09PSAnc3RhdGljX21ldGhvZG9sb2d5X2Rvd25sb2FkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGlzZUZpZWxkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkID09PSAnaGlnaGxpZ2h0ZWRMaW5rcycgJiYgKHBhZ2UudHlwZSA9PT0gJ2FydGljbGUnIHx8IHBhZ2UudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnIHx8IHBhZ2UudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpc2VGaWVsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWVsZCA9PT0gJ2xpbmtzJykge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXNlRmllbGQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGlzIG5vdCBhIHZhbGlkIGRvY3VtZW50XCIpO1xuICAgICAgICAgICAgICAgICAgICAvL2NyZWF0ZVdvcmtzcGFjZShkYXRhLnVyaSwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGlzZUZpZWxkKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGFbZmllbGRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGF0YVtmaWVsZF0ucHVzaCh7dXJpOiBsYXRlc3RVcmx9KTtcblxuICAgICAgICAgICAgICAgIHZhciB2aWV3TW9kZWxUaXRsZSA9IGxhdGVzdENoZWNrID8gJyhMYXRlc3QpICcgKyBwYWdlLmRlc2NyaXB0aW9uLnRpdGxlIDogcGFnZS5kZXNjcmlwdGlvbi50aXRsZTtcbiAgICAgICAgICAgICAgICB2YXIgdmlld01vZGVsID0ge3VyaTogbGF0ZXN0VXJsLCBkZXNjcmlwdGlvbjoge3RpdGxlOiB2aWV3TW9kZWxUaXRsZX19O1xuICAgICAgICAgICAgICAgIGlmIChwYWdlLmRlc2NyaXB0aW9uLmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLmRlc2NyaXB0aW9uLmVkaXRpb24gPSBwYWdlLmRlc2NyaXB0aW9uLmVkaXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRlbXBsYXRlRGF0YVtmaWVsZF0ucHVzaCh2aWV3TW9kZWwpO1xuXG4gICAgICAgICAgICAgICAgc2F2ZUNvbnRlbnRBbmRSZWZyZXNoU2VjdGlvbigpO1xuICAgICAgICAgICAgICAgIC8vc2F2ZVJlbGF0ZWQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBwYWdlIGRhdGEgcmV0dXJuZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByZXNvbHZlUGFnZVRpdGxlc1RoZW5SZWZyZXNoKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCBmaWVsZCwgaWRGaWVsZCkge1xuICAgIHZhciBhamF4UmVxdWVzdCA9IFtdO1xuICAgICQodGVtcGxhdGVEYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhdGgpIHtcbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uZGVzY3JpcHRpb24gPSB7fTtcbiAgICAgICAgdmFyIGVhY2hVcmkgPSBwYXRoLnVyaTtcbiAgICAgICAgdmFyIGxhdGVzdCA9IGVhY2hVcmkubWF0Y2goL1xcL2xhdGVzdFxcLz8kLykgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIHZhciBkZmQgPSAkLkRlZmVycmVkKCk7XG4gICAgICAgIGdldEJhYmJhZ2VQYWdlRGF0YShjb2xsZWN0aW9uSWQsIGVhY2hVcmksXG4gICAgICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uZGVzY3JpcHRpb24udGl0bGUgPSBsYXRlc3QgPyAnKExhdGVzdCkgJyArIHJlc3BvbnNlLmRlc2NyaXB0aW9uLnRpdGxlIDogcmVzcG9uc2UuZGVzY3JpcHRpb24udGl0bGU7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRlc2NyaXB0aW9uLmVkaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0uZGVzY3JpcHRpb24uZWRpdGlvbiA9IHJlc3BvbnNlLmRlc2NyaXB0aW9uLmVkaXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIGZpZWxkICsgJyBhZGRyZXNzOiAnICsgZWFjaFVyaSArICcgaXMgbm90IGZvdW5kLicsIFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgYWpheFJlcXVlc3QucHVzaChkZmQpO1xuICAgIH0pO1xuXG4gICAgJC53aGVuLmFwcGx5KCQsIGFqYXhSZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVmcmVzaFJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQsIGlkRmllbGQpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVuYW1lQ29tcGVuZGl1bUNoaWxkcmVuIChhcnJheVRvUmVuYW1lLCB0aXRsZU5vU3BhY2UsIGVkaXRpb25Ob1NwYWNlKSB7XG4gIGFycmF5VG9SZW5hbWUuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSwgaW5kZXgsIGFycmF5KSB7XG4gICAgdmFyIHggPSBlbGVtLnVyaS5zcGxpdChcIi9cIik7XG4gICAgeC5zcGxpY2UoW3gubGVuZ3RoIC0gM10sIDIsIHRpdGxlTm9TcGFjZSwgZWRpdGlvbk5vU3BhY2UpO1xuICAgIGVsZW0udXJpID0geC5qb2luKFwiL1wiKTtcbiAgfSk7XG4gIHJldHVybiBhcnJheVRvUmVuYW1lO1xufVxuXG5mdW5jdGlvbiByZW5hbWVEYXRhc2V0Q2hpbGRyZW4gKGFycmF5VG9SZW5hbWUsIHRpdGxlTm9TcGFjZSkge1xuICBhcnJheVRvUmVuYW1lLmZvckVhY2goZnVuY3Rpb24gKGVsZW0sIGluZGV4LCBhcnJheSkge1xuICAgIHZhciB4ID0gZWxlbS51cmkuc3BsaXQoXCIvXCIpO1xuICAgIHguc3BsaWNlKFt4Lmxlbmd0aCAtIDJdLCAxLCB0aXRsZU5vU3BhY2UpO1xuICAgIGVsZW0udXJpID0geC5qb2luKFwiL1wiKTtcbiAgfSk7XG4gIHJldHVybiBhcnJheVRvUmVuYW1lO1xufVxuXG5mdW5jdGlvbiByZW5hbWVDb250ZW50KGNvbGxlY3Rpb25JZCwgcGF0aCwgbmV3UGF0aCwgc3VjY2VzcywgZXJyb3IpIHtcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvY29udGVudHJlbmFtZS9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIGNoZWNrUGF0aFNsYXNoZXMocGF0aCkgKyBcIiZ0b1VyaT1cIiArIGNoZWNrUGF0aFNsYXNoZXMobmV3UGF0aCksXG4gICAgdHlwZTogJ1BPU1QnLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKHN1Y2Nlc3MpXG4gICAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIE1hbmFnZXMgdGhlIGVkaXRvciBtZW51c1xuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHBhZ2VEYXRhXG4gKiBAcGFyYW0gaXNQYWdlQ29tcGxldGUgLSBpZiBwcmVzZW50IHBhZ2UgaGFzIGJlZW4gYXBwcm92ZWRcbiAqL1xuXG5mdW5jdGlvbiByZW5kZXJBY2NvcmRpb25TZWN0aW9ucyhjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCBpc1BhZ2VDb21wbGV0ZSkge1xuXG4gICAgdmFyIHRlbXBsYXRlRGF0YSA9IGpRdWVyeS5leHRlbmQodHJ1ZSwge30sIHBhZ2VEYXRhKTsgLy8gY2xvbmUgcGFnZSBkYXRhIHRvIGFkZCB0ZW1wbGF0ZSByZWxhdGVkIHByb3BlcnRpZXMuXG4gICAgdGVtcGxhdGVEYXRhLmlzUGFnZUNvbXBsZXRlID0gaXNQYWdlQ29tcGxldGU7XG5cbiAgICBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2hvbWVfcGFnZScpIHtcbiAgICAgICAgdmFyIGVtYWlsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvZ2dlZEluQXMnKTsgICAvLyBnZXQgdXNlciBwZXJtaXNzaW9uc1xuICAgICAgICBnZXRVc2VyUGVybWlzc2lvbihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBlcm1pc3Npb24uYWRtaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUMSh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0U2VydmljZU1lc3NhZ2UoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0MUVkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEpOyAgIC8vdGVtcGxhdGVEYXRhIHVzZWQgdG8gcmVzb2x2ZSBzZWN0aW9uIHRpdGxlc1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoXCI8c2VjdGlvbiBjbGFzcz0ncGFuZWwgd29ya3NwYWNlLWVkaXQnPjxkaXYgY2xhc3M9J2VkaXQtc2VjdGlvbic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPSdlZGl0LXNlY3Rpb25fX2hlYWQnPjxoMT5Zb3UgY2Fubm90IGVkaXQgdGhpcyBwYWdlLiBQbGVhc2UgY29udGFjdCBhbiBhZG1pbmlzdHJhdG9yPC9oMT48L2Rpdj48L2Rpdj48L3NlY3Rpb24+XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhlcmUgaXMgYSBwcm9ibGVtIHdpdGggcGVybWlzc2lvbnMuIFBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3JcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW1haWxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnaG9tZV9wYWdlX2NlbnN1cycpIHtcbiAgICAgICAgdmFyIGVtYWlsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvZ2dlZEluQXMnKTsgICAvLyBnZXQgdXNlciBwZXJtaXNzaW9uc1xuICAgICAgICBnZXRVc2VyUGVybWlzc2lvbihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBlcm1pc3Npb24uYWRtaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUMUNlbnN1cyh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFnZURhdGEuaW1hZ2VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2FkSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlZGl0QmxvY2tzKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3NlY3Rpb25zJywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0MUVkaXRvckNlbnN1cyhjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEpOyAgIC8vdGVtcGxhdGVEYXRhIHVzZWQgdG8gcmVzb2x2ZSBzZWN0aW9uIHRpdGxlc1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoXCI8c2VjdGlvbiBjbGFzcz0ncGFuZWwgd29ya3NwYWNlLWVkaXQnPjxkaXYgY2xhc3M9J2VkaXQtc2VjdGlvbic+XCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPSdlZGl0LXNlY3Rpb25fX2hlYWQnPjxoMT5Zb3UgY2Fubm90IGVkaXQgdGhpcyBwYWdlLiBQbGVhc2UgY29udGFjdCBhbiBhZG1pbmlzdHJhdG9yPC9oMT48L2Rpdj48L2Rpdj48L3NlY3Rpb24+XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiVGhlcmUgaXMgYSBwcm9ibGVtIHdpdGggcGVybWlzc2lvbnMuIFBsZWFzZSBjb250YWN0IGFuIGFkbWluaXN0cmF0b3JcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW1haWxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAndGF4b25vbXlfbGFuZGluZ19wYWdlJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQyKHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdoaWdobGlnaHRlZExpbmtzJywgJ2hpZ2hsaWdodHMnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIHQyRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICdwcm9kdWN0X3BhZ2UnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDModGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2l0ZW1zJywgJ3RpbWVzZXJpZXMnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3N0YXRzQnVsbGV0aW5zJywgJ2J1bGxldGlucycpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZEFydGljbGVzJywgJ2FydGljbGVzJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdkYXRhc2V0cycsICdkYXRhc2V0cycpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5JywgJ3FtaScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZScsICdtZXRob2RvbG9neScpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgdDNFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2J1bGxldGluJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ0QnVsbGV0aW4odGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgaWYgKHBhZ2VEYXRhLmNoYXJ0cykge1xuICAgICAgICAgICAgbG9hZENoYXJ0c0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLnRhYmxlcykge1xuICAgICAgICAgICAgbG9hZFRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmVxdWF0aW9ucykge1xuICAgICAgICAgICAgbG9hZEVxdWF0aW9uc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmltYWdlcykge1xuICAgICAgICAgICAgbG9hZEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnc2VjdGlvbnMnLCAnc2VjdGlvbicpO1xuICAgICAgICByZW5kZXJNYXJrZG93bkNvbnRlbnRBY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdhY2NvcmRpb24nLCAndGFiJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRG9jdW1lbnRzJywgJ2RvY3VtZW50Jyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRGF0YScsICdkYXRhJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkTWV0aG9kb2xvZ3knLCAncW1pJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlJywgJ21ldGhvZG9sb2d5Jyk7XG4gICAgICAgIGVkaXRUb3BpY3MoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAndG9waWNzJywgJ3RvcGljcycpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdwZGZUYWJsZScsICdwZGYnKTtcbiAgICAgICAgcmVuZGVyRXh0ZXJuYWxMaW5rQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICBlZGl0RG9jdW1lbnRDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3ZlcnNpb25zJywgJ2NvcnJlY3Rpb24nKTtcbiAgICAgICAgZWRpdEFsZXJ0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2FsZXJ0cycsICdhbGVydCcpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgYnVsbGV0aW5FZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2FydGljbGUnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDRBcnRpY2xlKHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGlmIChwYWdlRGF0YS5jaGFydHMpIHtcbiAgICAgICAgICAgIGxvYWRDaGFydHNMaXN0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlRGF0YS50YWJsZXMpIHtcbiAgICAgICAgICAgIGxvYWRUYWJsZXNMaXN0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlRGF0YS5lcXVhdGlvbnMpIHtcbiAgICAgICAgICAgIGxvYWRFcXVhdGlvbnNMaXN0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYWdlRGF0YS5pbWFnZXMpIHtcbiAgICAgICAgICAgIGxvYWRJbWFnZXNMaXN0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgICAgICB9XG4gICAgICAgIHJlbmRlck1hcmtkb3duQ29udGVudEFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ3NlY3Rpb25zJywgJ3NlY3Rpb24nKTtcbiAgICAgICAgcmVuZGVyTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnYWNjb3JkaW9uJywgJ3RhYicpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERvY3VtZW50cycsICdkb2N1bWVudCcpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGEnLCAnZGF0YScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5JywgJ3FtaScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZScsICdtZXRob2RvbG9neScpO1xuICAgICAgICBlZGl0VG9waWNzKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3RvcGljcycsICd0b3BpY3MnKTtcbiAgICAgICAgYWRkRmlsZShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAncGRmVGFibGUnLCAncGRmJyk7XG4gICAgICAgIHJlbmRlckV4dGVybmFsTGlua0FjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2xpbmtzJywgJ2xpbmsnKTtcbiAgICAgICAgZWRpdERvY3VtZW50Q29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICd2ZXJzaW9ucycsICdjb3JyZWN0aW9uJyk7XG4gICAgICAgIGVkaXRBbGVydChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdhbGVydHMnLCAnYWxlcnQnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIGFydGljbGVFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDRBcnRpY2xlRG93bmxvYWQodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgaWYgKHBhZ2VEYXRhLmNoYXJ0cykge1xuICAgICAgICAgICAgbG9hZENoYXJ0c0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLnRhYmxlcykge1xuICAgICAgICAgICAgbG9hZFRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmltYWdlcykge1xuICAgICAgICAgICAgbG9hZEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWRpdE1hcmtkb3duV2l0aE5vVGl0bGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ21hcmtkb3duJywgJ2NvbnRlbnQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWREb2N1bWVudHMnLCAnZG9jdW1lbnQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWREYXRhJywgJ2RhdGEnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neScsICdxbWknKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neUFydGljbGUnLCAnbWV0aG9kb2xvZ3knKTtcbiAgICAgICAgZWRpdFRvcGljcyhjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICd0b3BpY3MnLCAndG9waWNzJyk7XG4gICAgICAgIGFkZEZpbGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2Rvd25sb2FkcycsICdmaWxlJyk7XG4gICAgICAgIHJlbmRlckV4dGVybmFsTGlua0FjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2xpbmtzJywgJ2xpbmsnKTtcbiAgICAgICAgZWRpdEFsZXJ0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2FsZXJ0cycsICdhbGVydCcpO1xuICAgICAgICBlZGl0RG9jV2l0aEZpbGVzQ29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAndmVyc2lvbnMnLCAnY29ycmVjdGlvbicpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgQXJ0aWNsZURvd25sb2FkRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICd0aW1lc2VyaWVzJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ1KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGVkaXRNYXJrZG93bk9uZU9iamVjdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnc2VjdGlvbicpO1xuICAgICAgICBlZGl0TWFya2Rvd25XaXRoTm9UaXRsZShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbm90ZXMnLCAnbm90ZScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERvY3VtZW50cycsICdkb2N1bWVudCcpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGEnLCAndGltZXNlcmllcycpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGFzZXRzJywgJ2RhdGFzZXQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neScsICdxbWknKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neUFydGljbGUnLCAnbWV0aG9kb2xvZ3knKTtcbiAgICAgICAgZWRpdFRvcGljcyhjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICd0b3BpY3MnLCAndG9waWNzJyk7XG4gICAgICAgIGVkaXRBbGVydChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdhbGVydHMnLCAnYWxlcnQnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIHRpbWVzZXJpZXNFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2NvbXBlbmRpdW1fbGFuZGluZ19wYWdlJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ2KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRG9jdW1lbnRzJywgJ2RvY3VtZW50Jyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRGF0YScsICdkYXRhJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkTWV0aG9kb2xvZ3knLCAncW1pJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlJywgJ21ldGhvZG9sb2d5Jyk7XG4gICAgICAgIGVkaXRUb3BpY3MoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAndG9waWNzJywgJ3RvcGljcycpO1xuICAgICAgICBlZGl0QWxlcnQoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAnYWxlcnRzJywgJ2FsZXJ0Jyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBjb21wZW5kaXVtRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSk7ICAgICAvL3RlbXBsYXRlRGF0YSB1c2VkIHRvIHJlc29sdmUgY2hhcHRlciB0aXRsZXNcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnY29tcGVuZGl1bV9jaGFwdGVyJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ0Q29tcGVuZGl1bSh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICBpZiAocGFnZURhdGEuY2hhcnRzKSB7XG4gICAgICAgICAgICBsb2FkQ2hhcnRzTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFnZURhdGEudGFibGVzKSB7XG4gICAgICAgICAgICBsb2FkVGFibGVzTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFnZURhdGEuZXF1YXRpb25zKSB7XG4gICAgICAgICAgICBsb2FkRXF1YXRpb25zTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFnZURhdGEuaW1hZ2VzKSB7XG4gICAgICAgICAgICBsb2FkSW1hZ2VzTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJNYXJrZG93bkNvbnRlbnRBY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdzZWN0aW9ucycsICdzZWN0aW9uJyk7XG4gICAgICAgIHJlbmRlck1hcmtkb3duQ29udGVudEFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2FjY29yZGlvbicsICd0YWInKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWREb2N1bWVudHMnLCAnZG9jdW1lbnQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neScsICdxbWknKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neUFydGljbGUnLCAnbWV0aG9kb2xvZ3knKTtcbiAgICAgICAgcmVuZGVyRXh0ZXJuYWxMaW5rQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdwZGZUYWJsZScsICdwZGYnKTtcbiAgICAgICAgZWRpdERvY3VtZW50Q29ycmVjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICd2ZXJzaW9ucycsICdjb3JyZWN0aW9uJyk7XG4gICAgICAgIGVkaXRBbGVydChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdhbGVydHMnLCAnYWxlcnQnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIGNvbXBlbmRpdW1DaGFwdGVyRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICdjb21wZW5kaXVtX2RhdGEnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDhDb21wZW5kaXVtKHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRG9jdW1lbnRzJywgJ2RvY3VtZW50Jyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRGF0YXNldHMnLCAnZGF0YXNldCcpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5JywgJ3FtaScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZE1ldGhvZG9sb2d5QXJ0aWNsZScsICdtZXRob2RvbG9neScpO1xuICAgICAgICBhZGRGaWxlV2l0aERldGFpbHMoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2Rvd25sb2FkcycsICdmaWxlJyk7XG4gICAgICAgIGVkaXREb2NXaXRoRmlsZXNDb3JyZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICd2ZXJzaW9ucycsICdjb3JyZWN0aW9uJyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBjb21wZW5kaXVtRGF0YUVkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnc3RhdGljX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUN0xhbmRpbmcodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgZWRpdE1hcmtkb3duV2l0aE5vVGl0bGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ21hcmtkb3duJywgJ2NvbnRlbnQnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIHN0YXRpY0xhbmRpbmdQYWdlRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICdzdGF0aWNfcGFnZScpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUNyh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICBpZiAocGFnZURhdGEudGFibGVzKSB7XG4gICAgICAgICAgICBsb2FkVGFibGVzTGlzdChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVkaXRNYXJrZG93bldpdGhOb1RpdGxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdtYXJrZG93bicsICdjb250ZW50Jyk7XG4gICAgICAgIGFkZEZpbGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2Rvd25sb2FkcycsICdmaWxlJyk7XG4gICAgICAgIGVkaXRJbnRBbmRFeHRMaW5rcyhjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdsaW5rcycsICdsaW5rJyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBzdGF0aWNQYWdlRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICdzdGF0aWNfYXJ0aWNsZScpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUN1N0YXRpY0FydGljbGUodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgaWYgKHBhZ2VEYXRhLmNoYXJ0cykge1xuICAgICAgICAgICAgbG9hZENoYXJ0c0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLnRhYmxlcykge1xuICAgICAgICAgICAgbG9hZFRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmVxdWF0aW9ucykge1xuICAgICAgICAgICAgbG9hZEVxdWF0aW9uc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmltYWdlcykge1xuICAgICAgICAgICAgbG9hZEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnc2VjdGlvbnMnLCAnc2VjdGlvbicpO1xuICAgICAgICBlZGl0SW50QW5kRXh0TGlua3MoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdkb3dubG9hZHMnLCAnZmlsZScpO1xuICAgICAgICBlZGl0QWxlcnQoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAnYWxlcnRzJywgJ2FsZXJ0Jyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBzdGF0aWNBcnRpY2xlRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKHBhZ2VEYXRhLnR5cGUgPT09ICdzdGF0aWNfcW1pJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ3KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGVkaXRNYXJrZG93bldpdGhOb1RpdGxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdtYXJrZG93bicsICdjb250ZW50Jyk7XG4gICAgICAgIGFkZEZpbGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2Rvd25sb2FkcycsICdmaWxlJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRG9jdW1lbnRzJywgJ2RvY3VtZW50Jyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRGF0YXNldHMnLCAnZGF0YXNldCcpO1xuICAgICAgICByZW5kZXJFeHRlcm5hbExpbmtBY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdsaW5rcycsICdsaW5rJyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBxbWlFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ3N0YXRpY19mb2knKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDcodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgZWRpdE1hcmtkb3duV2l0aE5vVGl0bGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ21hcmtkb3duJywgJ2NvbnRlbnQnKTtcbiAgICAgICAgYWRkRmlsZShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnZG93bmxvYWRzJywgJ2ZpbGUnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIGZvaUVkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnc3RhdGljX2FkaG9jJykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ3KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGVkaXRNYXJrZG93bldpdGhOb1RpdGxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdtYXJrZG93bicsICdjb250ZW50Jyk7XG4gICAgICAgIGFkZEZpbGUoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ2Rvd25sb2FkcycsICdmaWxlJyk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICBhZEhvY0VkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnc3RhdGljX21ldGhvZG9sb2d5Jykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ0TWV0aG9kb2xvZ3kodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgaWYgKHBhZ2VEYXRhLmNoYXJ0cykge1xuICAgICAgICAgICAgbG9hZENoYXJ0c0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLnRhYmxlcykge1xuICAgICAgICAgICAgbG9hZFRhYmxlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmltYWdlcykge1xuICAgICAgICAgICAgbG9hZEltYWdlc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZ2VEYXRhLmVxdWF0aW9ucykge1xuICAgICAgICAgICAgbG9hZEVxdWF0aW9uc0xpc3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyTWFya2Rvd25Db250ZW50QWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnc2VjdGlvbnMnLCAnc2VjdGlvbicpO1xuICAgICAgICByZW5kZXJNYXJrZG93bkNvbnRlbnRBY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdhY2NvcmRpb24nLCAndGFiJyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRG9jdW1lbnRzJywgJ2RvY3VtZW50Jyk7XG4gICAgICAgIHJlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICdyZWxhdGVkRGF0YXNldHMnLCAnZGF0YXNldCcpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdkb3dubG9hZHMnLCAnZmlsZScpO1xuICAgICAgICBlZGl0SW50QW5kRXh0TGlua3MoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdwZGZUYWJsZScsICdwZGYnKTtcbiAgICAgICAgLy9lZGl0VG9waWNzIChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0ZW1wbGF0ZURhdGEsICd0b3BpY3MnLCAndG9waWNzJyk7ICAvL3JlYWR5IDJiIHVzZWRcbiAgICAgICAgZWRpdEFsZXJ0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2FsZXJ0cycsICdhbGVydCcpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgbWV0aG9kb2xvZ3lFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZCcpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRUNyh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICBlZGl0TWFya2Rvd25XaXRoTm9UaXRsZShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbWFya2Rvd24nLCAnY29udGVudCcpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdkb3dubG9hZHMnLCAnZmlsZScpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdwZGZEb3dubG9hZHMnLCAncGRmRmlsZScpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERvY3VtZW50cycsICdkb2N1bWVudCcpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGFzZXRzJywgJ2RhdGFzZXQnKTtcbiAgICAgICAgZWRpdEludEFuZEV4dExpbmtzKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2xpbmtzJywgJ2xpbmsnKTtcbiAgICAgICAgZWRpdEFsZXJ0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2FsZXJ0cycsICdhbGVydCcpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgbWV0aG9kb2xvZ3lEb3dubG9hZEVkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAnZGF0YXNldF9sYW5kaW5nX3BhZ2UnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDhMYW5kaW5nUGFnZSh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICAkKCcud29ya3NwYWNlLW1lbnUnKS5odG1sKGh0bWwpO1xuICAgICAgICBlZGl0TWFya2Rvd25PbmVPYmplY3QoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ3NlY3Rpb24nLCAnTm90ZXMnKTtcbiAgICAgICAgYWRkRGF0YXNldChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnZGF0YXNldHMnLCAnZWRpdGlvbicpO1xuICAgICAgICByZW5kZXJSZWxhdGVkSXRlbUFjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGFzZXRzJywgJ2RhdGFzZXQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWREb2N1bWVudHMnLCAnZG9jdW1lbnQnKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neScsICdxbWknKTtcbiAgICAgICAgcmVuZGVyUmVsYXRlZEl0ZW1BY2NvcmRpb25TZWN0aW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3JlbGF0ZWRNZXRob2RvbG9neUFydGljbGUnLCAnbWV0aG9kb2xvZ3knKTtcbiAgICAgICAgcmVuZGVyRXh0ZXJuYWxMaW5rQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICBlZGl0VG9waWNzKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ3RvcGljcycsICd0b3BpY3MnKTtcbiAgICAgICAgZWRpdEFsZXJ0KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2FsZXJ0cycsICdhbGVydCcpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgZGF0YXNldExhbmRpbmdFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ2RhdGFzZXQnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDgodGVtcGxhdGVEYXRhKTtcbiAgICAgICAgJCgnLndvcmtzcGFjZS1tZW51JykuaHRtbChodG1sKTtcbiAgICAgICAgZWRpdERhdGFzZXRWZXJzaW9uKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICd2ZXJzaW9ucycsICd2ZXJzaW9uJyk7XG4gICAgICAgIGVkaXREYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAndmVyc2lvbnMnLCAnY29ycmVjdGlvbicpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdzdXBwbGVtZW50YXJ5RmlsZXMnLCAnc3VwcGxlbWVudGFyeS1maWxlcycpO1xuICAgICAgICBhY2NvcmRpb24oKTtcbiAgICAgICAgZGF0YXNldEVkaXRvcihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAndGltZXNlcmllc19kYXRhc2V0Jykge1xuICAgICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ4KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGVkaXREYXRhc2V0VmVyc2lvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAndmVyc2lvbnMnLCAndmVyc2lvbicpO1xuICAgICAgICBhZGRGaWxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdzdXBwbGVtZW50YXJ5RmlsZXMnLCAnc3VwcGxlbWVudGFyeS1maWxlcycpO1xuICAgICAgICBlZGl0RGF0YXNldFZlcnNpb24oY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgJ3ZlcnNpb25zJywgJ2NvcnJlY3Rpb24nKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIGRhdGFzZXRFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSBpZiAocGFnZURhdGEudHlwZSA9PT0gJ3JlbGVhc2UnKSB7XG4gICAgICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDE2KHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGVkaXRNYXJrZG93bldpdGhOb1RpdGxlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsICdtYXJrZG93bicsICdwcmVyZWxlYXNlJyk7XG4gICAgICAgIGVkaXREYXRlKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSwgJ2RhdGVDaGFuZ2VzJywgJ2NoYW5nZURhdGUnKTtcbiAgICAgICAgcmVuZGVyRXh0ZXJuYWxMaW5rQWNjb3JkaW9uU2VjdGlvbihjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCAnbGlua3MnLCAnbGluaycpO1xuICAgICAgICAvL3JlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbiAoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERvY3VtZW50cycsICdkb2N1bWVudCcpO1xuICAgICAgICAvL3JlbmRlclJlbGF0ZWRJdGVtQWNjb3JkaW9uU2VjdGlvbiAoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhLCAncmVsYXRlZERhdGFzZXRzJywgJ2RhdGEnKTtcbiAgICAgICAgYWNjb3JkaW9uKCk7XG4gICAgICAgIHJlbGVhc2VFZGl0b3IoY29sbGVjdGlvbklkLCBwYWdlRGF0YSwgdGVtcGxhdGVEYXRhKTtcbiAgICB9XG5cbiAgICBlbHNlIGlmIChwYWdlRGF0YS50eXBlID09PSAndmlzdWFsaXNhdGlvbicpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB0ZW1wbGF0ZXMud29ya0VkaXRWaXN1YWxpc2F0aW9uKHRlbXBsYXRlRGF0YSk7XG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwoaHRtbCk7XG4gICAgICAgIGFjY29yZGlvbigpO1xuICAgICAgICB2aXN1YWxpc2F0aW9uRWRpdG9yKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRlbXBsYXRlRGF0YSk7XG4gICAgfVxuXG4gICAgZWxzZSB7XG5cbiAgICAgICAgdmFyIHdvcmtzcGFjZV9tZW51X3N1Yl9lZGl0ID1cbiAgICAgICAgICAgICc8c2VjdGlvbiBjbGFzcz1cIndvcmtzcGFjZS1lZGl0XCI+JyArXG4gICAgICAgICAgICAnICA8cCBzdHlsZT1cImZvbnQtc2l6ZToyMHB4OyBjb2xvcjpyZWQ7XCI+UGFnZTogJyArIHBhZ2VEYXRhLnR5cGUgKyAnIGlzIG5vdCBzdXBwb3J0ZWQuPC9wPicgK1xuICAgICAgICAgICAgJyAgPHRleHRhcmVhIGNsYXNzPVwiZmwtZWRpdG9yX19oZWFkbGluZVwiIG5hbWU9XCJmbC1lZGl0b3JfX2hlYWRsaW5lXCIgc3R5bGU9XCJoZWlnaHQ6IDcyOHB4XCIgY29scz1cIjEwNFwiPjwvdGV4dGFyZWE+JyArXG4gICAgICAgICAgICAnICA8bmF2IGNsYXNzPVwiZWRpdC1uYXZcIj4nICtcbiAgICAgICAgICAgICcgIDwvbmF2PicgK1xuICAgICAgICAgICAgJzwvc2VjdGlvbj4nO1xuXG4gICAgICAgICQoJy53b3Jrc3BhY2UtbWVudScpLmh0bWwod29ya3NwYWNlX21lbnVfc3ViX2VkaXQpO1xuICAgICAgICAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbChKU09OLnN0cmluZ2lmeShwYWdlRGF0YSwgbnVsbCwgMikpO1xuXG4gICAgICAgIHJlZnJlc2hFZGl0TmF2aWdhdGlvbigpO1xuXG4gICAgICAgIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gICAgICAgIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgICAgICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGFnZURhdGFUb1NhdmUgPSAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbCgpO1xuICAgICAgICAgICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLnVyaSwgcGFnZURhdGFUb1NhdmUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBjb21wbGV0ZVxuICAgICAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGFnZURhdGFUb1NhdmUgPSAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbCgpO1xuICAgICAgICAgICAgc2F2ZUFuZENvbXBsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLnVyaSwgcGFnZURhdGFUb1NhdmUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZXZpZXdcbiAgICAgICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGFnZURhdGFUb1NhdmUgPSAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbCgpO1xuICAgICAgICAgICAgc2F2ZUFuZFJldmlld0NvbnRlbnQoY29sbGVjdGlvbklkLCBwYWdlRGF0YS51cmksIHBhZ2VEYXRhVG9TYXZlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTGlzdGVuIG9uIGFsbCBpbnB1dCB3aXRoaW4gdGhlIHdvcmtzcGFjZSBlZGl0IHBhbmVsIGZvciBkaXJ0eSBjaGVja3MuXG4gICAgJCgnLndvcmtzcGFjZS1lZGl0IDppbnB1dCcpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSB0cnVlO1xuICAgICAgICAvLyByZW1vdmUgdGhlIGhhbmRsZXIgbm93IHdlIGtub3cgY29udGVudCBoYXMgY2hhbmdlZC5cbiAgICAgICAgLy8kKCc6aW5wdXQnKS51bmJpbmQoJ2lucHV0Jyk7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ0NoYW5nZXMgZGV0ZWN0ZWQuJyk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hFZGl0TmF2aWdhdGlvbigpIHtcbiAgICBnZXRDb2xsZWN0aW9uKEZsb3JlbmNlLmNvbGxlY3Rpb24uaWQsXG4gICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoY29sbGVjdGlvbikge1xuICAgICAgICAgICAgdmFyIHBhZ2VQYXRoID0gZ2V0UHJldmlld1VybCgpO1xuICAgICAgICAgICAgdmFyIHBhZ2VGaWxlID0gcGFnZVBhdGggKyAnL2RhdGEuanNvbic7XG4gICAgICAgICAgICB2YXIgbGFzdENvbXBsZXRlZEV2ZW50ID0gZ2V0TGFzdENvbXBsZXRlZEV2ZW50KGNvbGxlY3Rpb24sIHBhZ2VGaWxlKTtcbiAgICAgICAgICAgIHZhciBpc1BhZ2VDb21wbGV0ZSA9ICEoIWxhc3RDb21wbGV0ZWRFdmVudCB8fCBsYXN0Q29tcGxldGVkRXZlbnQuZW1haWwgPT09IEZsb3JlbmNlLkF1dGhlbnRpY2F0aW9uLmxvZ2dlZEluRW1haWwoKSk7XG5cbiAgICAgICAgICAgIHZhciBlZGl0TmF2ID0gdGVtcGxhdGVzLmVkaXROYXYoe2lzUGFnZUNvbXBsZXRlOiBpc1BhZ2VDb21wbGV0ZX0pO1xuICAgICAgICAgICAgJCgnLmVkaXQtbmF2JykuaHRtbChlZGl0TmF2KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfSlcbn1mdW5jdGlvbiByZXNldFBhZ2UoKSB7XG4gICAgLy8gUHJldmVudCBkZWZhdWx0IGJlaGF2aW91ciBvZiBhbGwgZm9ybSBzdWJtaXRzIHRocm91Z2h0IEZsb3JlbmNlXG4gICAgJChkb2N1bWVudCkub24oJ3N1Ym1pdCcsICdmb3JtJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICAvLyBGaXggZm9yIG1vZGFsIGZvcm0gc3VibWl0cyBub3QgYmVpbmcgZGV0ZWN0ZWRcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnYnV0dG9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkY2xvc2VzdEZvcm0gPSAkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKTtcbiAgICAgICAgJGNsb3Nlc3RGb3JtLnN1Ym1pdChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gU3RvcCBhbmNob3JzIGRvaW5nIGRlZmF1bHQgYmVoYXZpb3VyXG4gICAgLy8gJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2EnLCBmdW5jdGlvbihlKSB7XG4gICAgLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyAgICAgY29uc29sZS5sb2coJ0FuY2hvciBjbGljayBzdG9wcGVkIG9uOiAnLCBlKTtcbiAgICAvLyB9KTtcblxuICAgIC8vICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdmb3JtJywgZnVuY3Rpb24oZSkge1xuICAgIC8vICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKCdGb3JtIGNsaWNrZWQnKTtcbiAgICAvLyB9KTtcblxuICAgIC8vICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdidXR0b24nLCBmdW5jdGlvbiAoZSkge1xuICAgIC8vICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIC8vIH0pO1xuXG4gICAgLy8gJChkb2N1bWVudCkub24oJ3N1Ym1pdCcsICcjY2FuY2VsLWZvcm0nLCBmdW5jdGlvbihlKSB7XG4gICAgLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyAgICAgY29uc29sZS5sb2coZSk7XG4gICAgLy8gfSk7XG59LyoqXG4gKiBTYXZlIG5ldyBjb250ZW50LlxuICogQHBhcmFtIGNvbGxlY3Rpb25JZFxuICogQHBhcmFtIHVyaVxuICogQHBhcmFtIGRhdGEgLSBuZXcgY29udGVudCBiZWluZyBwb3N0ZWQgZm9yIHVwZGF0ZVxuICogQHBhcmFtIGNvbGxlY3Rpb25EYXRhIC0gSlNPTiBmb3IgY29sbGVjdGlvblxuICovXG5mdW5jdGlvbiBzYXZlQ29udGVudChjb2xsZWN0aW9uSWQsIHVyaSwgZGF0YSwgY29sbGVjdGlvbkRhdGEpIHtcbiAgICBwb3N0Q29udGVudChjb2xsZWN0aW9uSWQsIHVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIGZhbHNlLCBmYWxzZSxcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0aW5nIGNvbXBsZXRlZCBcIiArIG1lc3NhZ2UpO1xuICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKHVyaSwgY29sbGVjdGlvbklkLCAnZWRpdCcsIGNvbGxlY3Rpb25EYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgY3JlYXRlIHRoaXMgcGFnZVwiLCBcIkl0IGFscmVhZHkgZXhpc3RzLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5mdW5jdGlvbiBzYXZlTmV3Q29ycmVjdGlvbiAoY29sbGVjdGlvbklkLCBwYXRoLCBzdWNjZXNzLCBlcnJvcikge1xuICB2YXIgc2FmZVBhdGggPSBjaGVja1BhdGhTbGFzaGVzKHBhdGgpO1xuICBpZiAoc2FmZVBhdGggPT09ICcvJykge1xuICAgIHNhZmVQYXRoID0gJyc7ICAgICAgICAgIC8vIGVkZ2UgY2FzZSBmb3IgaG9tZVxuICB9XG5cbiAgdmFyIHVybCA9IFwiL3plYmVkZWUvdmVyc2lvbi9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIHNhZmVQYXRoO1xuXG4gIC8vIFVwZGF0ZSBjb250ZW50XG4gICQuYWpheCh7XG4gICAgdXJsOiB1cmwsXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIHR5cGU6ICdQT1NUJyxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBzZXRTaG9ydGN1dHMoZmllbGQsIGNhbGxiYWNrKSB7XG4gICQoZmllbGQpLnNlbGVjdChmdW5jdGlvbiAoZSkge1xuICAgICQoZmllbGQpLm9uKCdrZXlkb3duJywgbnVsbCwgJ2N0cmwrbScsIGZ1bmN0aW9uIChldikge1xuICAgICAgdmFyIGlucHV0VmFsdWUgPSAkKGZpZWxkKS52YWwoKTtcbiAgICAgIHZhciBzdGFydCA9IGUudGFyZ2V0LnNlbGVjdGlvblN0YXJ0O1xuICAgICAgdmFyIGVuZCA9IGUudGFyZ2V0LnNlbGVjdGlvbkVuZDtcbiAgICAgIHZhciBvdXRwdXRWYWx1ZSA9IFtpbnB1dFZhbHVlLnNsaWNlKDAsIHN0YXJ0KSwgXCJeXCIsIGlucHV0VmFsdWUuc2xpY2Uoc3RhcnQsIGVuZCksIFwiXlwiLCBpbnB1dFZhbHVlLnNsaWNlKGVuZCldLmpvaW4oJycpO1xuICAgICAgJChmaWVsZCkudmFsKG91dHB1dFZhbHVlKTtcbiAgICAgIGV2LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0pO1xuICAgICQoZmllbGQpLm9uKCdrZXl1cCcsIG51bGwsICdjdHJsK3EnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgIHZhciBpbnB1dFZhbHVlID0gJChmaWVsZCkudmFsKCk7XG4gICAgICB2YXIgc3RhcnQgPSBlLnRhcmdldC5zZWxlY3Rpb25TdGFydDtcbiAgICAgIHZhciBlbmQgPSBlLnRhcmdldC5zZWxlY3Rpb25FbmQ7XG4gICAgICB2YXIgb3V0cHV0VmFsdWUgPSBbaW5wdXRWYWx1ZS5zbGljZSgwLCBzdGFydCksIFwiflwiLCBpbnB1dFZhbHVlLnNsaWNlKHN0YXJ0LCBlbmQpLCBcIn5cIiwgaW5wdXRWYWx1ZS5zbGljZShlbmQpXS5qb2luKCcnKTtcbiAgICAgICQoZmllbGQpLnZhbChvdXRwdXRWYWx1ZSk7XG4gICAgICBldi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1mdW5jdGlvbiBzZXR1cEZsb3JlbmNlKCkge1xuICAgIHdpbmRvdy50ZW1wbGF0ZXMgPSBIYW5kbGViYXJzLnRlbXBsYXRlcztcbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVyUGFydGlhbChcImJyb3dzZU5vZGVcIiwgdGVtcGxhdGVzLmJyb3dzZU5vZGUpO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKFwiYnJvd3NlTm9kZURhdGFWaXNcIiwgdGVtcGxhdGVzLmJyb3dzZU5vZGVEYXRhVmlzKTtcbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVyUGFydGlhbChcImVkaXROYXZcIiwgdGVtcGxhdGVzLmVkaXROYXYpO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKFwiZWRpdE5hdkNoaWxkXCIsIHRlbXBsYXRlcy5lZGl0TmF2Q2hpbGQpO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKFwic2VsZWN0b3JIb3VyXCIsIHRlbXBsYXRlcy5zZWxlY3RvckhvdXIpO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKFwic2VsZWN0b3JNaW51dGVcIiwgdGVtcGxhdGVzLnNlbGVjdG9yTWludXRlKTtcbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVyUGFydGlhbChcInRpY2tBbmltYXRpb25cIiwgdGVtcGxhdGVzLnRpY2tBbmltYXRpb24pO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKFwibG9hZGluZ0FuaW1hdGlvblwiLCB0ZW1wbGF0ZXMubG9hZGluZ0FuaW1hdGlvbik7XG4gICAgSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwoXCJjaGlsZERlbGV0ZXNcIiwgdGVtcGxhdGVzLmNoaWxkRGVsZXRlcyk7XG4gICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2VsZWN0JywgZnVuY3Rpb24gKHZhbHVlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciAkZWwgPSAkKCc8c2VsZWN0IC8+JykuaHRtbChvcHRpb25zLmZuKHRoaXMpKTtcbiAgICAgICAgJGVsLmZpbmQoJ1t2YWx1ZT1cIicgKyB2YWx1ZSArICdcIl0nKS5hdHRyKHsnc2VsZWN0ZWQnOiAnc2VsZWN0ZWQnfSk7XG4gICAgICAgIHJldHVybiAkZWwuaHRtbCgpO1xuICAgIH0pO1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmQ29uZCcsIGZ1bmN0aW9uICh2MSwgb3BlcmF0b3IsIHYyLCBvcHRpb25zKSB7XG5cbiAgICAgICAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgICAgICAgICAgY2FzZSAnPT0nOlxuICAgICAgICAgICAgICAgIHJldHVybiAodjEgPT0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICAgIGNhc2UgJz09PSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICh2MSA9PT0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICAgIGNhc2UgJzwnOlxuICAgICAgICAgICAgICAgIHJldHVybiAodjEgPCB2MikgPyBvcHRpb25zLmZuKHRoaXMpIDogb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICAgICAgY2FzZSAnPD0nOlxuICAgICAgICAgICAgICAgIHJldHVybiAodjEgPD0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICAgIGNhc2UgJz4nOlxuICAgICAgICAgICAgICAgIHJldHVybiAodjEgPiB2MikgPyBvcHRpb25zLmZuKHRoaXMpIDogb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICAgICAgY2FzZSAnPj0nOlxuICAgICAgICAgICAgICAgIHJldHVybiAodjEgPj0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgICAgIGNhc2UgJyYmJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gKHYxICYmIHYyKSA/IG9wdGlvbnMuZm4odGhpcykgOiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgICAgICBjYXNlICd8fCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICh2MSB8fCB2MikgPyBvcHRpb25zLmZuKHRoaXMpIDogb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy9DaGVjayBpZiBhcnJheSBjb250YWlucyBlbGVtZW50XG4gICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZDb250YWlucycsIGZ1bmN0aW9uIChlbGVtLCBsaXN0LCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChsaXN0LmluZGV4T2YoZWxlbSkgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICB9KTtcbiAgICAvLyBBZGQgdHdvIHZhbHVlcyB0b2dldGhlci4gUHJpbWFyeSB1c2FnZSB3YXMgJ0BpbmRleCArIDEnIHRvIGNyZWF0ZSBudW1iZXJlZCBsaXN0c1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3BsdXMnLCBmdW5jdGlvbiAodmFsdWUxLCB2YWx1ZTIpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlMSArIHZhbHVlMjtcbiAgICB9KTtcbiAgICAvLyBBZGQgdHdvIHZhbHVlcyB0b2dldGhlci4gUHJpbWFyeSB1c2FnZSB3YXMgJ0BpbmRleCArIDEnIHRvIGNyZWF0ZSBudW1iZXJlZCBsaXN0c1xuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2xhc3RFZGl0ZWRCeScsIGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgICBpZiAoYXJyYXkpIHtcbiAgICAgICAgICAgIHZhciBldmVudCA9IGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdMYXN0IGVkaXRlZCAnICsgU3RyaW5nVXRpbHMuZm9ybWF0SXNvRGF0ZVN0cmluZyhuZXcgRGF0ZShldmVudC5kYXRlKSkgKyBcIiBieSBcIiArIGV2ZW50LmVtYWlsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9KTtcbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdjcmVhdGVkQnknLCBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgICAgaWYgKGFycmF5KSB7XG4gICAgICAgICAgICB2YXIgZXZlbnQgPSBnZXRDb2xsZWN0aW9uQ3JlYXRlZEV2ZW50KGFycmF5KTtcbiAgICAgICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnQ3JlYXRlZCAnICsgU3RyaW5nVXRpbHMuZm9ybWF0SXNvRGF0ZVN0cmluZyhuZXcgRGF0ZShldmVudC5kYXRlKSkgKyBcIiBieSBcIiArIGV2ZW50LmVtYWlsICsgJyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0pO1xuICAgIC8vIElmIHR3byBzdHJpbmdzIG1hdGNoXG4gICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZXEnLCBmdW5jdGlvbiAoYSwgYiwgb3B0cykge1xuICAgICAgICBpZiAoYSA9PSBiKVxuICAgICAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7XG4gICAgfSk7XG4gICAgLy8gSWYgdHdvIHN0cmluZ3MgZG9uJ3QgbWF0Y2hcbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZl9uZScsIGZ1bmN0aW9uIChhLCBiLCBvcHRzKSB7XG4gICAgICAgIGlmIChhICE9IGIpXG4gICAgICAgICAgICByZXR1cm4gb3B0cy5mbih0aGlzKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG9wdHMuaW52ZXJzZSh0aGlzKTtcbiAgICB9KTtcblxuICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2NvbW1hX3NlcGFyYXRlZF9saXN0JywgZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgIHZhciBhc1N0cmluZyA9IFwiXCI7XG5cbiAgICAgICAgaWYgKGFycmF5KSB7XG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgYXNTdHJpbmcgPSBhc1N0cmluZyArIGl0ZW0gKyBcIiwgXCI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBhc1N0cmluZy5zdWJzdHJpbmcoMCwgYXNTdHJpbmcubGFzdEluZGV4T2YoXCIsXCIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXNTdHJpbmc7XG4gICAgfSk7XG5cbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdwYXJlbnRfZGlyJywgZnVuY3Rpb24gKHVyaSkge1xuICAgICAgICB2YXIgcGF0aFNlY3Rpb25zID0gdXJpLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgaWYgKHBhdGhTZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIvXCIgKyBwYXRoU2VjdGlvbnNbcGF0aFNlY3Rpb25zLmxlbmd0aCAtMV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSk7XG5cbiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdkZWJ1ZycsIGZ1bmN0aW9uIChtZXNzYWdlLCBvYmplY3QpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJERUJVRzogXCIgKyBtZXNzYWdlICsgXCIgXCIgKyBKU09OLnN0cmluZ2lmeShvYmplY3QpKTtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSk7XG5cblxuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gZmFsc2U7XG5cbiAgICAvLyBsb2FkIG1haW4gZmxvcmVuY2UgdGVtcGxhdGVcbiAgICB2YXIgZmxvcmVuY2UgPSB0ZW1wbGF0ZXMuZmxvcmVuY2U7XG5cbiAgICAkKCdib2R5JykuYXBwZW5kKGZsb3JlbmNlKTtcbiAgICBGbG9yZW5jZS5yZWZyZXNoQWRtaW5NZW51KCk7XG5cbiAgICB2YXIgYWRtaW5NZW51ID0gJCgnLmpzLW5hdicpO1xuICAgIC8vIGRpcnR5IGNoZWNrcyBvbiBhZG1pbiBtZW51XG4gICAgYWRtaW5NZW51Lm9uKCdjbGljaycsICcuanMtbmF2LWl0ZW0nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSkge1xuICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiV2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHRleHQ6IFwiSWYgeW91IGRvIG5vdCBjb21lIGJhY2sgdG8gdGhpcyBwYWdlLCB5b3Ugd2lsbCBsb3NlIGFueSB1bnNhdmVkIGNoYW5nZXNcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIlxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc01lbnVDbGljayh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJvY2Vzc01lbnVDbGljayh0aGlzKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSkge1xuICAgICAgICAgICAgcmV0dXJuICdZb3UgaGF2ZSB1bnNhdmVkIGNoYW5nZXMuJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgdmlld0NvbnRyb2xsZXIoKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvY2Vzc01lbnVDbGljayhjbGlja2VkKSB7XG4gICAgICAgIEZsb3JlbmNlLmNvbGxlY3Rpb24gPSB7fTtcblxuICAgICAgICAkKCcuanMtbmF2LWl0ZW0tLWNvbGxlY3Rpb24nKS5oaWRlKCk7XG4gICAgICAgICQoJy5qcy1uYXYtaXRlbScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICB2YXIgbWVudUl0ZW0gPSAkKGNsaWNrZWQpO1xuXG4gICAgICAgIG1lbnVJdGVtLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuXG5cbiAgICAgICAgaWYgKG1lbnVJdGVtLmhhc0NsYXNzKFwianMtbmF2LWl0ZW0tLWNvbGxlY3Rpb25zXCIpKSB7XG4gICAgICAgICAgICB2aWV3Q29udHJvbGxlcignY29sbGVjdGlvbnMnKTtcbiAgICAgICAgfSBlbHNlIGlmIChtZW51SXRlbS5oYXNDbGFzcyhcImpzLW5hdi1pdGVtLS1jb2xsZWN0aW9uXCIpKSB7XG4gICAgICAgICAgICB2YXIgdGhpc0NvbGxlY3Rpb24gPSBDb29raWVVdGlscy5nZXRDb29raWVWYWx1ZShcImNvbGxlY3Rpb25cIik7XG4gICAgICAgICAgICB2aWV3Q29sbGVjdGlvbnModGhpc0NvbGxlY3Rpb24pO1xuICAgICAgICAgICAgJChcIi5qcy1uYXYtaXRlbS0tY29sbGVjdGlvbnNcIikuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uaGFzQ2xhc3MoXCJqcy1uYXYtaXRlbS0tdXNlcnNcIikpIHtcbiAgICAgICAgICAgIHZpZXdDb250cm9sbGVyKCd1c2VycycpO1xuICAgICAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLmhhc0NsYXNzKFwianMtbmF2LWl0ZW0tLXRlYW1zXCIpKSB7XG4gICAgICAgICAgICB2aWV3Q29udHJvbGxlcigndGVhbXMnKTtcbiAgICAgICAgfSBlbHNlIGlmIChtZW51SXRlbS5oYXNDbGFzcyhcImpzLW5hdi1pdGVtLS1wdWJsaXNoXCIpKSB7XG4gICAgICAgICAgICB2aWV3Q29udHJvbGxlcigncHVibGlzaCcpO1xuICAgICAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLmhhc0NsYXNzKFwianMtbmF2LWl0ZW0tLXJlcG9ydHNcIikpIHtcbiAgICAgICAgICAgIHZpZXdDb250cm9sbGVyKCdyZXBvcnRzJyk7XG4gICAgICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uaGFzQ2xhc3MoXCJqcy1uYXYtaXRlbS0tbG9naW5cIikpIHtcbiAgICAgICAgICAgIHZpZXdDb250cm9sbGVyKCdsb2dpbicpO1xuICAgICAgICB9IGVsc2UgaWYgKG1lbnVJdGVtLmhhc0NsYXNzKFwianMtbmF2LWl0ZW0tLWxvZ291dFwiKSkge1xuICAgICAgICAgICAgbG9nb3V0KCk7XG4gICAgICAgICAgICB2aWV3Q29udHJvbGxlcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gR2V0IHBpbmcgdGltZXMgdG8gemViZWRlZSBhbmQgc3VyZmFjZSBmb3IgdXNlclxuICAgIHZhciBsYXN0UGluZ1RpbWU7XG4gICAgdmFyIHBpbmdUaW1lcyA9IFtdO1xuXG4gICAgZnVuY3Rpb24gZG9QaW5nKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogXCIvemViZWRlZS9waW5nXCIsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBsYXN0UGluZ1RpbWU6IGxhc3RQaW5nVGltZVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBzZXNzaW9uIGluZm9ybWF0aW9uXG4gICAgICAgICAgICAgICAgY2hlY2tTZXNzaW9uVGltZW91dChyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZW5kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBlbmQgLSBzdGFydDtcblxuICAgICAgICAgICAgICAgIGxhc3RQaW5nVGltZSA9IHRpbWU7XG4gICAgICAgICAgICAgICAgcGluZ1RpbWVzLnB1c2godGltZSk7XG4gICAgICAgICAgICAgICAgaWYgKHBpbmdUaW1lcy5sZW5ndGggPiA1KVxuICAgICAgICAgICAgICAgICAgICBwaW5nVGltZXMuc2hpZnQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGluZ1RpbWVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaW5nVGltZXNbaV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2VQaW5nVGltZSA9IHN1bSAvIHBpbmdUaW1lcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBuZXR3b3JrU3RhdHVzKGxhc3RQaW5nVGltZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXZlcmFnZVBpbmdUaW1lIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicGluZyB0aW1lOiBwcmV0dHkgZ29vZCEgXCIgKyB0aW1lICsgXCIgYXZlcmFnZTogXCIgKyBhdmVyYWdlUGluZ1RpbWUgKyBcIiBcIiArIHBpbmdUaW1lcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdmVyYWdlUGluZ1RpbWUgPCAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJwaW5nIHRpbWU6IG5vdCBzbyBnb29kISBcIiArIHRpbWUgKyBcIiBhdmVyYWdlOiBcIiArIGF2ZXJhZ2VQaW5nVGltZSArIFwiIFwiICsgcGluZ1RpbWVzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInBpbmcgdGltZTogcmVhbGx5IGJhZCEgXCIgKyB0aW1lKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwaW5nVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9QaW5nKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgcGluZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvUGluZygpO1xuICAgIH0sIDEwMDAwKTtcblxuICAgIC8vIEFsZXJ0IHVzZXIgaWYgcGluZyBzdGF0ZXMgdGhhdCB0aGVpciBzZXNzaW9uIGlzIGdvaW5nIHRvIGxvZyBvdXQgKGxvZyBvdXQgaWYgaXQncyBydW4gb3V0IHRvbylcbiAgICB2YXIgY291bnRkb3duSXNTaG93biA9IGZhbHNlLFxuICAgICAgICBzZWNvbmRDb3VudGVyID0gMDtcblxuICAgIGZ1bmN0aW9uIGNoZWNrU2Vzc2lvblRpbWVvdXQoc2Vzc2lvbkRhdGEpIHtcbiAgICAgICAgdmFyIGN1cnJlbnREYXRlVGltZSA9IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBzZXNzaW9uRXhwaXJ5ID0gbmV3IERhdGUoc2Vzc2lvbkRhdGEuc2Vzc2lvbkV4cGlyeURhdGUpLFxuICAgICAgICAgICAgdGltZUxlZnRJblNlc3Npb24gPSBwYXJzZUludCgoc2Vzc2lvbkV4cGlyeSAtIGN1cnJlbnREYXRlVGltZSkvMTAwMCk7XG5cbiAgICAgICAgaWYgKHRpbWVMZWZ0SW5TZXNzaW9uIDw9IDMxICYmICFjb3VudGRvd25Jc1Nob3duKSB7XG4gICAgICAgICAgICAvLyBTZXNzaW9uIGlzIGdvaW5nIHRvIGV4cGlyZSBzb29uLCB3YXJuIHVzZXIgYW5kIGdpdmUgdGhlbSBvcHRpb24gdG8gcmVzZXQgc2Vzc2lvbiB0aW1lclxuICAgICAgICAgICAgY291bnRkb3duSXNTaG93biA9IHRydWU7XG4gICAgICAgICAgICBzZWNvbmRDb3VudGVyID0gdGltZUxlZnRJblNlc3Npb247XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlc3Npb24gdG8gZXhwaXJlIGluIFwiICsgdGltZUxlZnRJblNlc3Npb24gKyBcIiBzZWNvbmRzXCIpO1xuICAgICAgICAgICAgc3dlZXRBbGVydCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiU2Vzc2lvbiBleHBpcmluZyBpbiA8c3BhbiBpZD0nc2Vzc2lvbi1leHBpcnknPlwiICsgdGltZUxlZnRJblNlc3Npb24gKyBcIjwvc3Bhbj4gc2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIHRleHQ6IFwiWW91J3ZlIG5vdCBiZWVuIGFjdGl2ZSBmb3Igc29tZXRpbWUgbm93LCBhcmUgeW91IHN0aWxsIHVzaW5nIEZsb3JlbmNlP1wiLFxuICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiSSdtIHN0aWxsIHVzaW5nIEZsb3JlbmNlIVwiXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAkLmdldChcIi96ZWJlZGVlL3VzZXJzP2VtYWlsPVwiICsgRmxvcmVuY2UuQXV0aGVudGljYXRpb24ubG9nZ2VkSW5FbWFpbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgY291bnRkb3duSXNTaG93biA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlc3Npb24gdGltZXIgcmVzZXRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgYWxlcnQgd2l0aCBhbW91bnQgb2YgdGltZSB1c2VyIGhhcyBsZWZ0IHVudGlsIHRoZXkncmUgbG9nZ2VkIG91dFxuICAgICAgICAgICAgdmFyIHNlc3Npb25Db3VudGRvd24gPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzZWNvbmRDb3VudGVyIC09IDE7XG4gICAgICAgICAgICAgICAgJCgnI3Nlc3Npb24tZXhwaXJ5JykuaHRtbChzZWNvbmRDb3VudGVyKTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHNlc3Npb24gaGFzIHRpbWVkIG91dCAmIHRoZSB3YXJuaW5nIGhhc24ndCBiZWVuIGNsb3NlZCB5ZXQsIGxvZyBvdXQgdGhlIHVzZXIgYW5kIGluZm9ybSB0aGVtIHdoeSB0aGV5J3ZlIGJlZW4gbG9nZ2VkIG91dFxuICAgICAgICAgICAgICAgIGlmIChzZWNvbmRDb3VudGVyID09PSAwICYmIGNvdW50ZG93bklzU2hvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIllvdXIgc2Vzc2lvbiBoYXMgZXhwaXJlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJGbG9yZW5jZSB3YXMgbGVmdCBpbmFjdGl2ZSBmb3IgdG9vIGxvbmcgc28geW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0XCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxvZ291dCgpO1xuICAgICAgICAgICAgICAgICAgICBjb3VudGRvd25Jc1Nob3duID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2Vzc2lvbkNvdW50ZG93bik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghY291bnRkb3duSXNTaG93bikge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2VyIHJlc3BvbmRlZCB0byB3YXJuaW5nIHNvIEZsb3JlbmNlIGlzIGFjdGl2ZSBub3csIGNsZWFyIHRoZSBjb3VudGRvd25cbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzZXNzaW9uQ291bnRkb3duKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlc2V0IGRlZmF1bHQgZnVuY3Rpb25zIGZyb20gY2VydGFpbiBlbGVtZW50cyAtIGVnIGZvcm0gc3VibWl0c1xuICAgIHJlc2V0UGFnZSgpO1xuXG4gICAgLy8gTG9nIGV2ZXJ5IGNsaWNrIHRoYXQgd2lsbCBiZSBjaGFuZ2luZyB0aGUgc3RhdGUgb3IgZGF0YSBpbiBGbG9yZW5jZVxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdhLCBidXR0b24sIGlucHV0W3R5cGU9XCJidXR0b25cIl0sIGlmcmFtZSwgLnRhYmxlLS1wcmltYXJ5IHRyLCAuanMtbmF2LWl0ZW0sIC5wYWdlX19pdGVtJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZGlhZ25vc3RpY0pTT04gPSBKU09OLnN0cmluZ2lmeShuZXcgY2xpY2tFdmVudE9iamVjdChlKSk7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvY2xpY2tFdmVudExvZ1wiLFxuICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgZGF0YTogZGlhZ25vc3RpY0pTT04sXG4gICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBjbGlja0V2ZW50T2JqZWN0KGV2ZW50KSB7XG4gICAgICAgIHRoaXMudXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsb2dnZWRJbkFzJyk7XG4gICAgICAgIHRyaWdnZXJUZW1wID0ge307XG4gICAgICAgIGNvbGxlY3Rpb25UZW1wID0ge307XG5cbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCkge1xuICAgICAgICAgICAgdHJpZ2dlclRlbXAuZWxlbWVudElkID0gZXZlbnQudGFyZ2V0LmlkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5hdHRyKCdjbGFzcycpKSB7XG4gICAgICAgICAgICBjbGFzc2VzID0gW107XG4gICAgICAgICAgICAkLmVhY2goJChldmVudC50YXJnZXQpLmF0dHIoJ2NsYXNzJykuc3BsaXQoXCIgXCIpLCBmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyVGVtcC5lbGVtZW50Q2xhc3NlcyA9IGNsYXNzZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoRmxvcmVuY2UuY29sbGVjdGlvbi5pZCkge1xuICAgICAgICAgICAgY29sbGVjdGlvblRlbXAuaWQgPSBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEZsb3JlbmNlLmNvbGxlY3Rpb24ubmFtZSkge1xuICAgICAgICAgICAgY29sbGVjdGlvblRlbXAubmFtZSA9IEZsb3JlbmNlLmNvbGxlY3Rpb24ubmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChGbG9yZW5jZS5jb2xsZWN0aW9uLnR5cGUpIHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb25UZW1wLnR5cGUgPSBGbG9yZW5jZS5jb2xsZWN0aW9uLnR5cGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHJpZ2dlclRlbXAuZWxlbWVudElkIHx8IHRyaWdnZXJUZW1wLmVsZW1lbnRDbGFzc2VzKSB7XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyVGVtcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb2xsZWN0aW9uVGVtcC5pZCB8fCBjb2xsZWN0aW9uVGVtcC5uYW1lIHx8IGNvbGxlY3Rpb25UZW1wLnR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25UZW1wXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBydW5uaW5nIHZlcnNpb24gdmVyc3VzIGxhdGVzdCBhbmQgbm90aWZ5IHVzZXIgaWYgdGhleSBkb24ndCBtYXRjaFxuICAgIHZhciBydW5uaW5nVmVyc2lvbixcbiAgICAgICAgdXNlcldhcm5lZCA9IGZhbHNlO1xuICAgIGZ1bmN0aW9uIGNoZWNrVmVyc2lvbigpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKCdhc3NldHMvdmVyc2lvbi5qc29uJylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZUpzb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VKc29uO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGdldHRpbmcgbGF0ZXN0IEZsb3JlbmNlIHZlcnNpb246IFwiLCBlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNoZWNrVmVyc2lvbigpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgcnVubmluZ1ZlcnNpb24gPSByZXNwb25zZTtcbiAgICB9KTtcblxuICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBHZXQgdGhlIGxhdGVzdCB2ZXJzaW9uIGFuZCBhbGVydCB1c2VyIGlmIGl0IGRpZmZlcnMgZnJvbSB2ZXJzaW9uIHN0b3JlZCBvbiBsb2FkIChidXQgb25seSBpZiB0aGUgdXNlciBoYXNuJ3QgYmVlbiB3YXJuZWQgYWxyZWFkeSwgc28gdGhleSBkb24ndCBnZXQgc3BhbW1lZCBhZnRlciBiZWluZyB3YXJuZWQgYWxyZWFkeSlcbiAgICAgICAgaWYgKCF1c2VyV2FybmVkKSB7XG4gICAgICAgICAgICBjaGVja1ZlcnNpb24oKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tYWpvciAhPT0gcnVubmluZ1ZlcnNpb24ubWFqb3IgfHwgcmVzcG9uc2UubWlub3IgIT09IHJ1bm5pbmdWZXJzaW9uLm1pbm9yIHx8IHJlc3BvbnNlLmJ1aWxkICE9PSBydW5uaW5nVmVyc2lvbi5idWlsZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk5ldyB2ZXJzaW9uIG9mIEZsb3JlbmNlIGF2YWlsYWJsZTogXCIsIHJlc3BvbnNlLm1ham9yICsgXCIuXCIgKyByZXNwb25zZS5taW5vciArIFwiLlwiICsgcmVzcG9uc2UuYnVpbGQpO1xuICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIk5ldyB2ZXJzaW9uIG9mIEZsb3JlbmNlIGF2YWlsYWJsZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbmZvXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkNhbmNlbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJSZWZyZXNoIEZsb3JlbmNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkRvbid0IHJlZnJlc2hcIlxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoaXNDb25maXJtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyV2FybmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dhbChcIldhcm5pbmdcIiwgXCJGbG9yZW5jZSBjb3VsZCBiZSB1bnN0YWJsZSB3aXRob3V0IHRoZSBsYXRlc3QgdmVyc2lvblwiLCBcIndhcm5pbmdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJ1bm5pbmdWZXJzaW9uID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LCAxMDAwMClcbn1cblxuZnVuY3Rpb24gcmVsZWFzZUVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcbiAgICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gICAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuICAgIHZhciBwYWdlRGF0YVJlcXVlc3RzID0gW107XG4gICAgdmFyIHBhZ2VzID0ge307XG5cbiAgICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gICAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG4gICAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgICBwcm9jZXNzQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQsICdub1NhdmUnKTtcblxuICAgICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZW5hbWVVcmkgPSB0cnVlO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI3Byb3Zpc2lvbmFsRGF0ZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucHJvdmlzaW9uYWxEYXRlID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICB2YXIgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KTtcbiAgICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uZmluYWxpc2VkKSB7XG4gICAgICAgICQoJy5yZWxlYXNlLWRhdGUnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHB1Ymxpc2hUaW1lID0gcGFyc2VJbnQoJCgnI3JlbGVhc2UtaG91cicpLnZhbCgpKSArIHBhcnNlSW50KCQoJyNyZWxlYXNlLW1pbicpLnZhbCgpKTtcbiAgICAgICAgICAgIHZhciB0b0lzb0RhdGUgPSAkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKFwiZ2V0RGF0ZVwiKTtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZShwYXJzZUludChuZXcgRGF0ZSh0b0lzb0RhdGUpLmdldFRpbWUoKSkgKyBwdWJsaXNoVGltZSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJCgnLnJlbGVhc2UtZGF0ZScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgdGV4dDogXCJZb3Ugd2lsbCBuZWVkIHRvIGFkZCBhbiBleHBsYW5hdGlvbiBmb3IgdGhpcyBjaGFuZ2UuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBwcm9jZWVkP1wiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiQ29udGludWVcIixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzYXZlT2xkRGF0ZShjb2xsZWN0aW9uSWQsIGRhdGEsIGRhdGVUbXApO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHVibGlzaFRpbWUgPSBwYXJzZUludCgkKCcjcmVsZWFzZS1ob3VyJykudmFsKCkpICsgcGFyc2VJbnQoJCgnI3JlbGVhc2UtbWluJykudmFsKCkpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG9Jc29EYXRlID0gJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcihcImdldERhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZShwYXJzZUludChuZXcgRGF0ZSh0b0lzb0RhdGUpLmdldFRpbWUoKSkgKyBwdWJsaXNoVGltZSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCcjcmVsZWFzZURhdGUnKS52YWwoZGF0ZVRtcEZvcm1hdHRlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBkYXRlID0gbmV3IERhdGUoZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSk7XG4gICAgdmFyIGhvdXIgPSBkYXRlLmdldEhvdXJzKCk7XG4gICAgJCgnI3JlbGVhc2UtaG91cicpLnZhbChob3VyICogMzYwMDAwMCk7XG5cbiAgICB2YXIgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpO1xuICAgICQoJyNyZWxlYXNlLW1pbicpLnZhbChtaW51dGVzICogNjAwMDApO1xuXG4gICAgJChcIiNuZXh0UmVsZWFzZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubmV4dFJlbGVhc2UgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICBcbiAgICB9KTtcbiAgICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uY29udGFjdCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QgPSB7fTtcbiAgICB9XG4gICAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgXG4gICAgfSk7XG4gICAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICBcbiAgICB9KTtcbiAgICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgXG4gICAgfSk7XG4gICAgJChcIiNzdW1tYXJ5XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgXG4gICAgfSk7XG5cbiAgICAvKiBUaGUgY2hlY2tlZCBhdHRyaWJ1dGUgaXMgYSBib29sZWFuIGF0dHJpYnV0ZSwgd2hpY2ggbWVhbnMgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgaXMgdHJ1ZSBpZiB0aGUgYXR0cmlidXRlIGlzIHByZXNlbnQgYXQgYWxs4oCUZXZlbiBpZiwgZm9yIGV4YW1wbGUsIHRoZSBhdHRyaWJ1dGUgaGFzIG5vIHZhbHVlIG9yIGlzIHNldCB0byBlbXB0eSBzdHJpbmcgdmFsdWUgb3IgZXZlbiBcImZhbHNlXCIgKi9cbiAgICB2YXIgY2hlY2tCb3hTdGF0dXMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgaWYgKGlkID09PSAnbmF0U3RhdCcpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID09PSBcImZhbHNlXCIgfHwgZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnY2FuY2VsbGVkJykge1xuICAgICAgICAgICAgaWYgKGRhdGEuZGVzY3JpcHRpb24uY2FuY2VsbGVkID09PSBcImZhbHNlXCIgfHwgZGF0YS5kZXNjcmlwdGlvbi5jYW5jZWxsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ2ZpbmFsaXNlZCcpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLmZpbmFsaXNlZCA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24uZmluYWxpc2VkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gR2V0cyBzdGF0dXMgb2YgY2hlY2tib3ggYW5kIHNldHMgSlNPTiB0byBtYXRjaFxuICAgICQoXCIjbmF0U3RhdCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cygkKCcjbmF0U3RhdCcpLmF0dHIoJ2lkJykpKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPSAkKFwiI25hdFN0YXQgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIFxuICAgIH0pO1xuXG4gICAgJChcIiNjYW5jZWxsZWQgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgY2hlY2tCb3hTdGF0dXMoJCgnI2NhbmNlbGxlZCcpLmF0dHIoJ2lkJykpKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY2FuY2VsbGVkID0gJChcIiNjYW5jZWxsZWQgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgdmFyIGVkaXRlZFNlY3Rpb25WYWx1ZSA9IHt9O1xuICAgICAgICAgICAgZWRpdGVkU2VjdGlvblZhbHVlLnRpdGxlID0gXCJQbGVhc2UgZW50ZXIgdGhlIHJlYXNvbiBmb3IgdGhlIGNhbmNlbGxhdGlvblwiO1xuICAgICAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5jYW5jZWxsYXRpb25Ob3RpY2UgPSBbdXBkYXRlZENvbnRlbnRdO1xuICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFBhZ2VEYXRhSW50b0VkaXRvcihkYXRhLnVyaSwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KGRhdGEudXJpKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEsICdub3RFbXB0eScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5jYW5jZWxsYXRpb25Ob3RpY2UgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KTtcblxuICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLmZpbmFsaXNlZCkge1xuICAgICAgICAkKFwiI2ZpbmFsaXNlZCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cygkKCcjZmluYWxpc2VkJykuYXR0cignaWQnKSkpLmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBzd2VldEFsZXJ0KCdZb3UgY2Fubm90IGNoYW5nZSB0aGlzIGZpZWxkIG9uY2UgaXQgaXMgZmluYWxpc2VkLicpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2ZpbmFsaXNlZCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cygkKCcjZmluYWxpc2VkJykuYXR0cignaWQnKSkpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIllvdSB3aWxsIG5vdCBiZSBhYmxlIHJlc2V0IHRoZSBkYXRlIHRvIHByb3Zpc2lvbmFsIG9uY2UgeW91J3ZlIGRvbmUgdGhpcy4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHByb2NlZWQ/XCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJDb250aW51ZVwiLFxuICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24uZmluYWxpc2VkID0gJChcIiNmaW5hbGlzZWQgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLmZpbmFsaXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHByb3Zpc2lvbmFsIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucHJvdmlzaW9uYWxEYXRlID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wcm92aXNpb25hbC1kYXRlJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjZmluYWxpc2VkJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKFwiI2ZpbmFsaXNlZCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICQoXCIjZGF0ZUNoYW5nZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGF0ZUNoYW5nZXMucHJldmlvdXNEYXRlID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgXG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzYXZlT2xkRGF0ZShjb2xsZWN0aW9uSWQsIGRhdGEsIG9sZERhdGUpIHtcbiAgICAgICAgZGF0YS5kYXRlQ2hhbmdlcy5wdXNoKHtwcmV2aW91c0RhdGU6IG9sZERhdGUsIGNoYW5nZU5vdGljZTogXCJcIn0pO1xuICAgICAgICBpbml0aWFsaXNlTGFzdE5vdGVNYXJrZG93bihjb2xsZWN0aW9uSWQsIGRhdGEsICdkYXRlQ2hhbmdlcycsICdjaGFuZ2VOb3RpY2UnKTtcbiAgICB9XG5cbiAgICAkKCcjYWRkLXByZXZpZXcnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vQ2hlY2sgaWYgaXQgaXMgYXJ0aWNsZSwgYnVsbGV0aW4gb3IgZGF0YXNldFxuICAgICAgICBwcm9jZXNzQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJvY2Vzc0NvbGxlY3Rpb24oY29sbGVjdGlvbklkLCBub1NhdmUpIHtcbiAgICAgICAgcGFnZURhdGFSZXF1ZXN0cy5wdXNoKFxuICAgICAgICAgICAgZ2V0Q29sbGVjdGlvbkRldGFpbHMoY29sbGVjdGlvbklkLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZXMgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICAgICQud2hlbi5hcHBseSgkLCBwYWdlRGF0YVJlcXVlc3RzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKHBhZ2VzLnJlbGVhc2VVcmkgJiYgcGFnZXMucmVsZWFzZVVyaSA9PSBkYXRhLnVyaSkge1xuICAgICAgICAgICAgICAgIHByb2Nlc3NQcmV2aWV3KGRhdGEsIHBhZ2VzKTtcbiAgICAgICAgICAgICAgICBpZiAobm9TYXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvL0FkZCB1cmkgdG8gcmVsYXRlZERvY3VtZW50cyBvciByZWxhdGVkRGF0YXNldHNcbiAgICBmdW5jdGlvbiBwcm9jZXNzUHJldmlldyhkYXRhLCBwYWdlcykge1xuICAgICAgICBkYXRhLnJlbGF0ZWREb2N1bWVudHMgPSBbXTtcbiAgICAgICAgZGF0YS5yZWxhdGVkRGF0YXNldHMgPSBbXTtcbiAgICAgICAgZGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3kgPSBbXTtcbiAgICAgICAgZGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3lBcnRpY2xlID0gW107XG4gICAgICAgIF8uZWFjaChwYWdlcy5pblByb2dyZXNzLCBmdW5jdGlvbiAocGFnZSkge1xuICAgICAgICAgICAgaWYgKHBhZ2UudHlwZSA9PT0gJ2FydGljbGUnIHx8IHBhZ2UudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnIHx8IHBhZ2UudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREb2N1bWVudHMucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGFnZS51cmkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdkYXRhc2V0X2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREYXRhc2V0cy5wdXNoKHt1cmk6IHBhZ2UudXJpfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19xbWknKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3kucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdzdGF0aWNfbWV0aG9kb2xvZ3knIHx8IHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZCcpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWRNZXRob2RvbG9neUFydGljbGUucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXy5lYWNoKHBhZ2VzLmNvbXBsZXRlLCBmdW5jdGlvbiAocGFnZSkge1xuICAgICAgICAgICAgaWYgKHBhZ2UudHlwZSA9PT0gJ2FydGljbGUnIHx8IHBhZ2UudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnIHx8IHBhZ2UudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREb2N1bWVudHMucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGFnZS51cmkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdkYXRhc2V0X2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREYXRhc2V0cy5wdXNoKHt1cmk6IHBhZ2UudXJpfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19xbWknKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3kucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdzdGF0aWNfbWV0aG9kb2xvZ3knIHx8IHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZCcpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWRNZXRob2RvbG9neUFydGljbGUucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXy5lYWNoKHBhZ2VzLnJldmlld2VkLCBmdW5jdGlvbiAocGFnZSkge1xuICAgICAgICAgICAgaWYgKHBhZ2UudHlwZSA9PT0gJ2FydGljbGUnIHx8IHBhZ2UudHlwZSA9PT0gJ2FydGljbGVfZG93bmxvYWQnIHx8IHBhZ2UudHlwZSA9PT0gJ2J1bGxldGluJyB8fCBwYWdlLnR5cGUgPT09ICdjb21wZW5kaXVtX2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREb2N1bWVudHMucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGFnZS51cmkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdkYXRhc2V0X2xhbmRpbmdfcGFnZScpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWREYXRhc2V0cy5wdXNoKHt1cmk6IHBhZ2UudXJpfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19xbWknKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5yZWxhdGVkTWV0aG9kb2xvZ3kucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlLnR5cGUgPT09ICdzdGF0aWNfbWV0aG9kb2xvZ3knIHx8IHBhZ2UudHlwZSA9PT0gJ3N0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZCcpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbGF0ZWRNZXRob2RvbG9neUFydGljbGUucHVzaCh7dXJpOiBwYWdlLnVyaX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayB3aGV0aGVyIHJlbGVhc2UgaXMgYmVpbmcgYWRkZWQgYmFjayBpbnRvIGNvbGxlY3Rpb24gYW5kIHRoZSBwdWJsaXNoZWQgZmxhZyBzaG91bGQgYmUgdG9nZ2xlZCB0byB0cnV0aHlcbiAgICBmdW5jdGlvbiBjaGVja1B1Ymxpc2hlZEZsYWcoZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UgKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnB1Ymxpc2hlZCkge1xuICAgICAgICAgICAgICAgIGdldENvbGxlY3Rpb24oY29sbGVjdGlvbklkLCBzdWNjZXNzID0gZnVuY3Rpb24gKGNvbGxlY3Rpb25EYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uRGF0YS5yZWxlYXNlVXJpID09IGRhdGEudXJpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnB1Ymxpc2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICAgICAgfSwgZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvL1NhdmUgYW5kIHVwZGF0ZSBwcmV2aWV3IHBhZ2VcbiAgICAvL0dldCBjb2xsZWN0aW9uIGNvbnRlbnRcblxuICAgIC8vIFNhdmVcbiAgICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICAgIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgICB9KTtcblxuICAgIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gICAgfSk7XG5cbiAgICAvLyByZXZpZXdlZCB0byBhcHByb3ZlXG4gICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNhdmUoc2F2ZUFuZFJldmlld0NvbnRlbnQpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcbiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgcHVibGlzaCBmbGFnIG5lZWRzIHRvIGJlIHRvZ2dsZSAtIHRoaXMgaXMgYXN5bmMgc28gbmVlZHMgdG8gYmUgYSBwcm9taXNlXG4gICAgICAgIGNoZWNrUHVibGlzaGVkRmxhZyhkYXRhKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gT25jZSBwdWJsaXNoIGZsYWcgaXMgY2hlY2tlZCB0aGVuIGNvbnRpbnVlIHdpdGggcmVzdCBvZiBzYXZlXG4gICAgICAgICAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIGRhdGEsIHJlbmFtZVVyaSwgb25TYXZlKTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgZ2V0dGluZyBjb2xsZWN0aW9uIGRhdGE6IFwiLCBlcnJvcik7XG4gICAgICAgIH0pO1xuXG4gICAgfVxufVxuXG5mdW5jdGlvbiB0MUVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSkge1xuXG4gIHZhciBuZXdTZWN0aW9ucyA9IFtdO1xuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuXG4gIHJlc29sdmVUaXRsZVQxKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCAnc2VjdGlvbnMnKTtcblxuICAvLyBNZXRhZGF0YSBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgaWYgKEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2gpIHtcbiAgICAkKFwiI3RpdGxlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgJChcIi50aXRsZVwiKS5yZW1vdmUoKTtcbiAgfVxuICAkKFwiI3N1bW1hcnlcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uc3VtbWFyeSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKCk7XG4gICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsICcnLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIC8vcGFnZURhdGEgPSAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbCgpO1xuICAgIHNhdmUoKTtcbiAgICBzYXZlQW5kQ29tcGxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgJycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKCk7XG4gICAgc2F2ZUFuZFJldmlld0NvbnRlbnQoY29sbGVjdGlvbklkLCAnJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICB9KTtcblxuICBmdW5jdGlvbiBzYXZlKCkge1xuICAgIC8vIHNlY3Rpb25zXG4gICAgdmFyIG9yZGVyU2VjdGlvbnMgPSAkKFwiI3NvcnRhYmxlLXNlY3Rpb25cIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyU2VjdGlvbnMpLmVhY2goZnVuY3Rpb24gKGluZGV4UywgbmFtZVMpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLnNlY3Rpb25zW3BhcnNlSW50KG5hbWVTKV0uc3RhdGlzdGljcy51cmk7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIHZhciBsaW5rID0gZGF0YS5zZWN0aW9uc1twYXJzZUludChuYW1lUyldLnRoZW1lLnVyaTtcbiAgICAgIG5ld1NlY3Rpb25zW3BhcnNlSW50KGluZGV4UyldID0ge1xuICAgICAgICB0aGVtZToge3VyaTogbGlua30sXG4gICAgICAgIHN0YXRpc3RpY3M6IHt1cmk6IHNhZmVVcml9XG4gICAgICB9O1xuICAgIH0pO1xuICAgIGRhdGEuc2VjdGlvbnMgPSBuZXdTZWN0aW9ucztcbiAgfVxufVxuXG5mdW5jdGlvbiByZXNvbHZlVGl0bGVUMShjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQpIHtcbiAgdmFyIGFqYXhSZXF1ZXN0ID0gW107XG4gICQodGVtcGxhdGVEYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhdGgpIHtcbiAgICB2YXIgZWFjaFVyaSA9IHBhdGguc3RhdGlzdGljcy51cmk7XG4gICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBnZXRCYWJiYWdlUGFnZURhdGEoY29sbGVjdGlvbklkLCBlYWNoVXJpLFxuICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5zdGF0aXN0aWNzLnRpdGxlID0gcmVzcG9uc2UuZGVzY3JpcHRpb24udGl0bGU7XG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICB9LFxuICAgICAgZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCBmaWVsZCArICcgYWRkcmVzczogJyArIGVhY2hVcmkgKyAnIGlzIG5vdCBmb3VuZC4nLCBcImVycm9yXCIpO1xuICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgfVxuICAgICk7XG4gICAgYWpheFJlcXVlc3QucHVzaChkZmQpO1xuICB9KTtcblxuICAkLndoZW4uYXBwbHkoJCwgYWpheFJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYXRhVGVtcGxhdGUgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDFTZWN0aW9ucyhkYXRhVGVtcGxhdGUpO1xuICAgICQoJyN0by1wb3B1bGF0ZScpLnJlcGxhY2VXaXRoKGh0bWwpO1xuXG4gICAgLy9FZGl0IHNlY3Rpb25cbiAgICAkKGRhdGEuc2VjdGlvbnMpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBzZWN0aW9uKSB7XG4vLyAgbGFzdEluZGV4U2VjdGlvbnMgPSBpbmRleCArIDE7XG4gICAgICAkKFwiI3NlY3Rpb24tZWRpdF9cIiArIGluZGV4KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN3YWwgKHtcbiAgICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgICAgdGV4dDogXCJJZiB5b3UgZG8gbm90IGNvbWUgYmFjayB0byB0aGlzIHBhZ2UsIHlvdSB3aWxsIGxvc2UgYW55IHVuc2F2ZWQgY2hhbmdlc1wiLFxuICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiQ29udGludWVcIixcbiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiXG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWVFdmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWUnKS5jb250ZW50V2luZG93O1xuICAgICAgICAgICAgaWZyYW1lRXZlbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBGbG9yZW5jZS5IYW5kbGVyLCB0cnVlKTtcbiAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZSgnLycsIGNvbGxlY3Rpb25JZCwgJycsIG51bGwsIHRydWUpO1xuXG4gICAgICAgICAgICAkKCcjJyArIGluZGV4KS5yZXBsYWNlV2l0aChcbiAgICAgICAgICAgICAgJzxkaXYgaWQ9XCInICsgaW5kZXggKyAnXCIgY2xhc3M9XCJlZGl0LXNlY3Rpb25fX3NvcnRhYmxlLWl0ZW1cIj4nICtcbiAgICAgICAgICAgICAgJyAgPHRleHRhcmVhIGlkPVwidXJpXycgKyBpbmRleCArICdcIiBwbGFjZWhvbGRlcj1cIkdvIHRvIHRoZSByZWxhdGVkIGRvY3VtZW50IGFuZCBjbGljayBHZXRcIj48L3RleHRhcmVhPicgK1xuICAgICAgICAgICAgICAnICA8YnV0dG9uIGNsYXNzPVwiYnRuLXBhZ2UtZ2V0XCIgaWQ9XCJzZWN0aW9uLWdldF8nICsgaW5kZXggKyAnXCI+R2V0PC9idXR0b24+JyArXG4gICAgICAgICAgICAgICcgIDxidXR0b24gY2xhc3M9XCJidG4tcGFnZS1jYW5jZWxcIiBpZD1cInNlY3Rpb24tY2FuY2VsXycgKyBpbmRleCArICdcIj5DYW5jZWw8L2J1dHRvbj4nICtcbiAgICAgICAgICAgICAgJzwvZGl2PicpO1xuICAgICAgICAgICAgJChcIiNzZWN0aW9uLWNhbmNlbF9cIiArIGluZGV4KS5oaWRlKCk7XG5cbiAgICAgICAgICAgICQoXCIjc2VjdGlvbi1nZXRfXCIgKyBpbmRleCkub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdmFyIHBhc3RlZFVybCA9ICQoJyN1cmlfJyArIGluZGV4KS52YWwoKTtcbiAgICAgICAgICAgICAgaWYgKCFwYXN0ZWRVcmwpIHtcbiAgICAgICAgICAgICAgICBwYXN0ZWRVcmwgPSBnZXRQYXRoTmFtZVRyaW1MYXN0KCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFzdGVkVXJsID0gY2hlY2tQYXRoUGFyc2VkKHBhc3RlZFVybCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIHNlY3Rpb25VcmxEYXRhID0gcGFzdGVkVXJsICsgXCIvZGF0YVwiO1xuXG4gICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiBzZWN0aW9uVXJsRGF0YSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzZWN0aW9uRGF0YSkge1xuICAgICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLnR5cGUgPT09ICd0aW1lc2VyaWVzJykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnNlY3Rpb25zLnNwbGljZShpbmRleCwgMSxcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVtZToge3VyaTogZ2V0VGhlbWUoc2VjdGlvbkRhdGEudXJpKX0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzOiB7dXJpOiBzZWN0aW9uRGF0YS51cml9XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCAnJywgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjb21wbGV0ZWQgXCIgKyByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlV29ya3NwYWNlKCcvJywgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGlzIG5vdCBhIHRpbWUgc2VyaWVzXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBwYWdlIGRhdGEgcmV0dXJuZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoXCIjc2VjdGlvbi1jYW5jZWxfXCIgKyBpbmRleCkuc2hvdygpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZSgnJywgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc29ydGFibGVTZWN0aW9ucygpIHtcbiAgICAgICQoXCIjc29ydGFibGUtc2VjdGlvblwiKS5zb3J0YWJsZSgpO1xuICAgIH1cblxuICAgIHNvcnRhYmxlU2VjdGlvbnMoKTtcblxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0VGhlbWUodXJpKSB7XG4gIHZhciBwYXJ0cyA9IHVyaS5zcGxpdCgnLycpO1xuICB2YXIgdGhlbWUgPSBwYXJ0cy5zcGxpY2UoMCwgMik7XG4gIHJldHVybiB0aGVtZS5qb2luKCcvJyk7XG59XG5mdW5jdGlvbiB0MUVkaXRvckNlbnN1cyhjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSkge1xuXG4gIHZhciBuZXdCbG9ja3MgPSBbXSwgbmV3SW1hZ2UgPSBbXTtcbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuICB2YXIgcmVuYW1lVXJpID0gZmFsc2U7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuXG4gIC8vIE1ldGFkYXRhIGVkaXRpb24gYW5kIHNhdmluZ1xuICAkKFwiI3RpdGxlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICByZW5hbWVVcmkgPSB0cnVlO1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24udGl0bGUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAkKFwiI3N1bW1hcnlcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uc3VtbWFyeSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvLyBTYXZlXG4gIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRSZXZpZXdDb250ZW50KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcbiAgICAvLyBCbG9ja3NcbiAgICB2YXIgb3JkZXJCbG9ja3MgPSAkKFwiI3NvcnRhYmxlLWJsb2NrXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckJsb2NrcykuZWFjaChmdW5jdGlvbiAoaW5kZXhCLCB0aXRsZUIpIHtcbiAgICAgIGlmICghZGF0YS5zZWN0aW9uc1twYXJzZUludCh0aXRsZUIpXS50aXRsZSkge1xuICAgICAgICB2YXIgdXJpID0gZGF0YS5zZWN0aW9uc1twYXJzZUludCh0aXRsZUIpXS51cmk7XG4gICAgICAgIHZhciBzaXplID0gZGF0YS5zZWN0aW9uc1twYXJzZUludCh0aXRsZUIpXS5zaXplO1xuICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgbmV3QmxvY2tzW2luZGV4Ql0gPSB7dXJpOiBzYWZlVXJpLCBzaXplOiBzaXplfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB1cmkgPSBkYXRhLnNlY3Rpb25zW3BhcnNlSW50KHRpdGxlQildLnVyaTtcbiAgICAgICAgdmFyIHRpdGxlID0gZGF0YS5zZWN0aW9uc1twYXJzZUludCh0aXRsZUIpXS50aXRsZTtcbiAgICAgICAgdmFyIHNpemUgPSBkYXRhLnNlY3Rpb25zW3BhcnNlSW50KHRpdGxlQildLnNpemU7XG4gICAgICAgIHZhciBpbWFnZSA9IGRhdGEuc2VjdGlvbnNbcGFyc2VJbnQodGl0bGVCKV0uaW1hZ2U7XG4gICAgICAgIHZhciB0ZXh0ID0gZGF0YS5zZWN0aW9uc1twYXJzZUludCh0aXRsZUIpXS50ZXh0O1xuICAgICAgICBuZXdCbG9ja3NbaW5kZXhCXSA9IHt1cmk6IHVyaSwgdGl0bGU6IHRpdGxlLCB0ZXh0OiB0ZXh0LCBpbWFnZTogaW1hZ2UsIHNpemU6IHNpemV9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGEuc2VjdGlvbnMgPSBuZXdCbG9ja3M7XG4gICAgLy8gaW1hZ2VzXG4gICAgdmFyIG9yZGVySW1hZ2UgPSAkKFwiI3NvcnRhYmxlLWltYWdlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckltYWdlKS5lYWNoKGZ1bmN0aW9uIChpbmRleEltYWdlLCBuYW1lSW1hZ2UpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdJbWFnZVtpbmRleEltYWdlXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLmltYWdlcyA9IG5ld0ltYWdlO1xuXG4gICAgY2hlY2tSZW5hbWVVcmkoY29sbGVjdGlvbklkLCBkYXRhLCByZW5hbWVVcmksIG9uU2F2ZSk7XG4gIH1cblxufVxuXG5mdW5jdGlvbiB0MkVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuXG4gIC8vIE1ldGFkYXRhIGxvYWQsIGVkaXRpb24gYW5kIHNhdmluZ1xuICAkKFwiI3RpdGxlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc3VtbWFyeVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIja2V5d29yZHNUYWdcIikudGFnaXQoe1xuICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgYWxsb3dTcGFjZXM6IHRydWUsXG4gICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICB9KTtcbiAgJCgnI2tleXdvcmRzJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzID0gJCgnI2tleXdvcmRzJykudmFsKCkuc3BsaXQoJywnKTtcbiAgfSk7XG4gICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgIHVwZGF0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICB9KTtcblxuICAvLyBjb21wbGV0ZWQgdG8gcmV2aWV3XG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgIHNhdmVBbmRDb21wbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICB9KTtcblxuICAvLyByZXZpZXdlZCB0byBhcHByb3ZlXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgc2F2ZUFuZFJldmlld0NvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gdDNFZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuXG4gICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICB9XG4gIH0pO1xuXG4gIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgLy8gTWV0YWRhdGEgbG9hZCwgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24udGl0bGUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNzdW1tYXJ5XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnN1bW1hcnkgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgc2F2ZUFuZENvbXBsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICBzYXZlQW5kUmV2aWV3Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG59XG5cbmZ1bmN0aW9uIEFydGljbGVEb3dubG9hZEVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuLy8gIHZhciBpbmRleCA9IGRhdGEucmVsZWFzZTtcbiAgdmFyIG5ld0ZpbGVzID0gW10sIG5ld0NoYXJ0ID0gW10sIG5ld1RhYmxlID0gW10sIG5ld0ltYWdlID0gW10sIG5ld0RhdGEgPSBbXSwgbmV3TGlua3MgPSBbXSwgbmV3UmVsYXRlZFFtaSA9IFtdLCBuZXdSZWxhdGVkTWV0aG9kb2xvZ3kgPSBbXSwgbmV3RG9jdW1lbnRzID0gW107XG4gIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcbiAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuXG4gICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICB9XG4gIH0pO1xuXG4gIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgLy8gTWV0YWRhdGEgbG9hZCwgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2VkaXRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRhdGVUbXAgPSBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlO1xuICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cblxuICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5leHRSZWxlYXNlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0ID0ge307XG4gIH1cbiAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5lbWFpbCA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNhYnN0cmFjdFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5fYWJzdHJhY3QgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLyogVGhlIGNoZWNrZWQgYXR0cmlidXRlIGlzIGEgYm9vbGVhbiBhdHRyaWJ1dGUsIHdoaWNoIG1lYW5zIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IGlzIHRydWUgaWYgdGhlIGF0dHJpYnV0ZVxuICAgaXMgcHJlc2VudCBhdCBhbGzigJRldmVuIGlmLCBmb3IgZXhhbXBsZSwgdGhlIGF0dHJpYnV0ZSBoYXMgbm8gdmFsdWUgb3IgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyB2YWx1ZSBvciBldmVuIFwiZmFsc2VcIiAqL1xuICB2YXIgY2hlY2tCb3hTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IFwiZmFsc2VcIiB8fCBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgY2hlY2tCb3hTdGF0dXMpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICB9KTtcblxuICAvLyBTYXZlXG4gIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRSZXZpZXdDb250ZW50KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcblxuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAvLyBTZWN0aW9uc1xuICAgIGRhdGEubWFya2Rvd24gPSBbJCgnI2NvbnRlbnQtbWFya2Rvd24nKS52YWwoKV07XG5cbiAgICAvLyBjaGFydHNcbiAgICB2YXIgb3JkZXJDaGFydCA9ICQoXCIjc29ydGFibGUtY2hhcnRcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyQ2hhcnQpLmVhY2goZnVuY3Rpb24gKGluZGV4Q2gsIG5hbWVDaCkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5jaGFydHNbcGFyc2VJbnQobmFtZUNoKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0NoYXJ0W2luZGV4Q2hdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuY2hhcnRzID0gbmV3Q2hhcnQ7XG4gICAgLy8gdGFibGVzXG4gICAgdmFyIG9yZGVyVGFibGUgPSAkKFwiI3NvcnRhYmxlLXRhYmxlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlclRhYmxlKS5lYWNoKGZ1bmN0aW9uIChpbmRleFRhYmxlLCBuYW1lVGFibGUpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdUYWJsZVtpbmRleFRhYmxlXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLnRhYmxlcyA9IG5ld1RhYmxlO1xuICAgIC8vIGltYWdlc1xuICAgIHZhciBvcmRlckltYWdlID0gJChcIiNzb3J0YWJsZS1pbWFnZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJJbWFnZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhJbWFnZSwgbmFtZUltYWdlKSB7XG4gICAgICB2YXIgdXJpID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0udXJpO1xuICAgICAgdmFyIHRpdGxlID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0udGl0bGU7XG4gICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS5maWxlbmFtZTtcbiAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3SW1hZ2VbaW5kZXhJbWFnZV0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgfSk7XG4gICAgZGF0YS5pbWFnZXMgPSBuZXdJbWFnZTtcblxuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLWZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG4gICAgLy8gRXh0ZXJuYWwgbGlua3NcbiAgICB2YXIgb3JkZXJMaW5rID0gJChcIiNzb3J0YWJsZS1saW5rXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckxpbmspLmVhY2goZnVuY3Rpb24gKGluZGV4TCwgbmFtZUwpIHtcbiAgICAgIHZhciBkaXNwbGF5VGV4dCA9IGRhdGEubGlua3NbcGFyc2VJbnQobmFtZUwpXS50aXRsZTtcbiAgICAgIHZhciBsaW5rID0gJCgnI2xpbmstdXJpXycgKyBuYW1lTCkudmFsKCk7XG4gICAgICBuZXdMaW5rc1tpbmRleExdID0ge3VyaTogbGluaywgdGl0bGU6IGRpc3BsYXlUZXh0fTtcbiAgICB9KTtcbiAgICBkYXRhLmxpbmtzID0gbmV3TGlua3M7XG5cbiAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIGRhdGEsIHJlbmFtZVVyaSwgb25TYXZlKTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIGFydGljbGVFZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgdmFyIG5ld0NoYXJ0ID0gW10sIG5ld1RhYmxlID0gW10sIG5ld0VxdWF0aW9uID0gW10sIG5ld0ltYWdlID0gW10sIG5ld0xpbmtzID0gW10sIG5ld0ZpbGVzID0gW107XG4gIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcbiAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuXG4gICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICB9XG4gIH0pO1xuXG4gIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgLy8gTWV0YWRhdGEgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2VkaXRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuXG4gICQoXCIjbmV4dFJlbGVhc2VcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubmV4dFJlbGVhc2UgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QgPSB7fTtcbiAgfVxuICAkKFwiI2NvbnRhY3ROYW1lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QubmFtZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2NvbnRhY3RFbWFpbFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LmVtYWlsID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjY29udGFjdFRlbGVwaG9uZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LnRlbGVwaG9uZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2Fic3RyYWN0XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLl9hYnN0cmFjdCA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvKiBUaGUgY2hlY2tlZCBhdHRyaWJ1dGUgaXMgYSBib29sZWFuIGF0dHJpYnV0ZSwgd2hpY2ggbWVhbnMgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgaXMgdHJ1ZSBpZiB0aGUgYXR0cmlidXRlXG4gICBpcyBwcmVzZW50IGF0IGFsbOKAlGV2ZW4gaWYsIGZvciBleGFtcGxlLCB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSBvciBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIHZhbHVlIG9yIGV2ZW4gXCJmYWxzZVwiICovXG4gIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgY2hlY2tCb3hTdGF0dXMpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICB9KTtcblxuICAvLyBTYXZlXG4gIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRSZXZpZXdDb250ZW50KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcblxuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAvLyBjaGFydHNcbiAgICB2YXIgb3JkZXJDaGFydCA9ICQoXCIjc29ydGFibGUtY2hhcnRcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyQ2hhcnQpLmVhY2goZnVuY3Rpb24gKGluZGV4Q2gsIG5hbWVDaCkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5jaGFydHNbcGFyc2VJbnQobmFtZUNoKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0NoYXJ0W2luZGV4Q2hdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuY2hhcnRzID0gbmV3Q2hhcnQ7XG4gICAgLy8gdGFibGVzXG4gICAgdmFyIG9yZGVyVGFibGUgPSAkKFwiI3NvcnRhYmxlLXRhYmxlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlclRhYmxlKS5lYWNoKGZ1bmN0aW9uIChpbmRleFRhYmxlLCBuYW1lVGFibGUpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdUYWJsZVtpbmRleFRhYmxlXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLnRhYmxlcyA9IG5ld1RhYmxlO1xuICAgIC8vIGVxdWF0aW9uc1xuICAgIHZhciBvcmRlckVxdWF0aW9uID0gJChcIiNzb3J0YWJsZS1lcXVhdGlvblwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJFcXVhdGlvbikuZWFjaChmdW5jdGlvbiAoaW5kZXhFcXVhdGlvbiwgbmFtZUVxdWF0aW9uKSB7XG4gICAgICB2YXIgdXJpID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udXJpO1xuICAgICAgdmFyIHRpdGxlID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udGl0bGU7XG4gICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmVxdWF0aW9uc1twYXJzZUludChuYW1lRXF1YXRpb24pXS5maWxlbmFtZTtcbiAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3RXF1YXRpb25baW5kZXhFcXVhdGlvbl0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgfSk7XG4gICAgZGF0YS5lcXVhdGlvbnMgPSBuZXdFcXVhdGlvbjtcbiAgICAvLyBpbWFnZXNcbiAgICB2YXIgb3JkZXJJbWFnZSA9ICQoXCIjc29ydGFibGUtaW1hZ2VcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVySW1hZ2UpLmVhY2goZnVuY3Rpb24gKGluZGV4SW1hZ2UsIG5hbWVJbWFnZSkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0ltYWdlW2luZGV4SW1hZ2VdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuaW1hZ2VzID0gbmV3SW1hZ2U7XG4gICAgLy8gRXh0ZXJuYWwgbGlua3NcbiAgICB2YXIgb3JkZXJMaW5rID0gJChcIiNzb3J0YWJsZS1saW5rXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckxpbmspLmVhY2goZnVuY3Rpb24gKGluZGV4TCwgbmFtZUwpIHtcbiAgICAgIHZhciBkaXNwbGF5VGV4dCA9IGRhdGEubGlua3NbcGFyc2VJbnQobmFtZUwpXS50aXRsZTtcbiAgICAgIHZhciBsaW5rID0gJCgnI2xpbmstdXJpXycgKyBuYW1lTCkudmFsKCk7XG4gICAgICBuZXdMaW5rc1tpbmRleExdID0ge3VyaTogbGluaywgdGl0bGU6IGRpc3BsYXlUZXh0fTtcbiAgICB9KTtcbiAgICBkYXRhLmxpbmtzID0gbmV3TGlua3M7XG4gICAgLy8gRmlsZXMgYXJlIHVwbG9hZGVkLiBTYXZlIG1ldGFkYXRhXG4gICAgdmFyIG9yZGVyRmlsZSA9ICQoXCIjc29ydGFibGUtcGRmXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckZpbGUpLmVhY2goZnVuY3Rpb24gKGluZGV4RiwgbmFtZUYpIHtcbiAgICAgIHZhciB0aXRsZSA9ICQoJyNwZGYtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5wZGZUYWJsZVtwYXJzZUludChuYW1lRildLmZpbGU7XG4gICAgICBuZXdGaWxlc1tpbmRleEZdID0ge3RpdGxlOiB0aXRsZSwgZmlsZTogZmlsZX07XG4gICAgfSk7XG4gICAgZGF0YS5wZGZUYWJsZSA9IG5ld0ZpbGVzO1xuXG4gICAgY2hlY2tSZW5hbWVVcmkoY29sbGVjdGlvbklkLCBkYXRhLCByZW5hbWVVcmksIG9uU2F2ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYnVsbGV0aW5FZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgICB2YXIgbmV3Q2hhcnQgPSBbXSwgbmV3VGFibGUgPSBbXSwgbmV3RXF1YXRpb24gPSBbXSwgbmV3SW1hZ2UgPSBbXSwgbmV3TGlua3MgPSBbXSwgbmV3RmlsZXMgPSBbXTtcbiAgICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gICAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuXG4gICAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICAgIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuICAgIGdldExhc3RQb3NpdGlvbigpO1xuXG4gICAgLy8gTWV0YWRhdGEgbG9hZCwgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2VkaXRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZW5hbWVVcmkgPSB0cnVlO1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcblxuICAgIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICAgICAkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKHRoaXMpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KVswXS52YWx1ZSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICAgICAkKCcjcmVsZWFzZURhdGUnKS52YWwoZGF0ZVRtcEZvcm1hdHRlZCkuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubmV4dFJlbGVhc2UgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdCA9IHt9O1xuICAgIH1cbiAgICAkKFwiI2NvbnRhY3ROYW1lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2NvbnRhY3RFbWFpbFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgICQoXCIjY29udGFjdFRlbGVwaG9uZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI3N1bW1hcnlcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2hlYWRsaW5lMVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmhlYWRsaW5lMSA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gICAgJChcIiNoZWFkbGluZTJcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5oZWFkbGluZTIgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgICQoXCIjaGVhZGxpbmUzXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uaGVhZGxpbmUzID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICAgICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICAgICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgICAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gICAgfSk7XG4gICAgJCgnI2tleXdvcmRzJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gICAgfSk7XG4gICAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuXG4gICAgLyogVGhlIGNoZWNrZWQgYXR0cmlidXRlIGlzIGEgYm9vbGVhbiBhdHRyaWJ1dGUsIHdoaWNoIG1lYW5zIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IGlzIHRydWUgaWYgdGhlIGF0dHJpYnV0ZVxuICAgICBpcyBwcmVzZW50IGF0IGFsbOKAlGV2ZW4gaWYsIGZvciBleGFtcGxlLCB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSBvciBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIHZhbHVlIG9yIGV2ZW4gXCJmYWxzZVwiICovXG4gICAgdmFyIGNoZWNrQm94U3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgICQoXCIjbWV0YWRhdGEtbGlzdCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH0pO1xuXG4gICAgLy8gU2F2ZVxuICAgIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gICAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlKHVwZGF0ZUNvbnRlbnQpO1xuICAgIH0pO1xuXG4gICAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgICB9KTtcblxuICAgIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzYXZlKG9uU2F2ZSkge1xuXG4gICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgLy8gY2hhcnRzXG4gICAgICAgIHZhciBvcmRlckNoYXJ0ID0gJChcIiNzb3J0YWJsZS1jaGFydFwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyQ2hhcnQpLmVhY2goZnVuY3Rpb24gKGluZGV4Q2gsIG5hbWVDaCkge1xuICAgICAgICAgICAgdmFyIHVyaSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnVyaTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5jaGFydHNbcGFyc2VJbnQobmFtZUNoKV0uZmlsZW5hbWU7XG4gICAgICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgICAgIG5ld0NoYXJ0W2luZGV4Q2hdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS5jaGFydHMgPSBuZXdDaGFydDtcbiAgICAgICAgLy8gdGFibGVzXG4gICAgICAgIHZhciBvcmRlclRhYmxlID0gJChcIiNzb3J0YWJsZS10YWJsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyVGFibGUpLmVhY2goZnVuY3Rpb24gKGluZGV4VGFibGUsIG5hbWVUYWJsZSkge1xuICAgICAgICAgICAgdmFyIHVyaSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLnVyaTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0uZmlsZW5hbWU7XG4gICAgICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgICAgIG5ld1RhYmxlW2luZGV4VGFibGVdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS50YWJsZXMgPSBuZXdUYWJsZTtcbiAgICAgICAgLy8gZXF1YXRpb25zXG4gICAgICAgIHZhciBvcmRlckVxdWF0aW9uID0gJChcIiNzb3J0YWJsZS1lcXVhdGlvblwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyRXF1YXRpb24pLmVhY2goZnVuY3Rpb24gKGluZGV4RXF1YXRpb24sIG5hbWVFcXVhdGlvbikge1xuICAgICAgICAgICAgdmFyIHVyaSA9IGRhdGEuZXF1YXRpb25zW3BhcnNlSW50KG5hbWVFcXVhdGlvbildLnVyaTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRhdGEuZXF1YXRpb25zW3BhcnNlSW50KG5hbWVFcXVhdGlvbildLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0uZmlsZW5hbWU7XG4gICAgICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgICAgIG5ld0VxdWF0aW9uW2luZGV4RXF1YXRpb25dID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS5lcXVhdGlvbnMgPSBuZXdFcXVhdGlvbjtcbiAgICAgICAgLy8gaW1hZ2VzXG4gICAgICAgIHZhciBvcmRlckltYWdlID0gJChcIiNzb3J0YWJsZS1pbWFnZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVySW1hZ2UpLmVhY2goZnVuY3Rpb24gKGluZGV4SW1hZ2UsIG5hbWVJbWFnZSkge1xuICAgICAgICAgICAgdmFyIHVyaSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnVyaTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0uZmlsZW5hbWU7XG4gICAgICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgICAgIG5ld0ltYWdlW2luZGV4SW1hZ2VdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS5pbWFnZXMgPSBuZXdJbWFnZTtcbiAgICAgICAgLy8gRXh0ZXJuYWwgbGlua3NcbiAgICAgICAgdmFyIG9yZGVyTGluayA9ICQoXCIjc29ydGFibGUtbGlua1wiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyTGluaykuZWFjaChmdW5jdGlvbiAoaW5kZXhMLCBuYW1lTCkge1xuICAgICAgICAgICAgdmFyIGRpc3BsYXlUZXh0ID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGxpbmsgPSAkKCcjbGluay11cmlfJyArIG5hbWVMKS52YWwoKTtcbiAgICAgICAgICAgIG5ld0xpbmtzW2luZGV4TF0gPSB7dXJpOiBsaW5rLCB0aXRsZTogZGlzcGxheVRleHR9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS5saW5rcyA9IG5ld0xpbmtzO1xuICAgICAgICAvLyBGaWxlcyBhcmUgdXBsb2FkZWQuIFNhdmUgbWV0YWRhdGFcbiAgICAgICAgdmFyIG9yZGVyRmlsZSA9ICQoXCIjc29ydGFibGUtcGRmXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgICAgICQob3JkZXJGaWxlKS5lYWNoKGZ1bmN0aW9uIChpbmRleEYsIG5hbWVGKSB7XG4gICAgICAgICAgICB2YXIgdGl0bGUgPSAkKCcjcGRmLXRpdGxlXycgKyBuYW1lRikudmFsKCk7XG4gICAgICAgICAgICB2YXIgZmlsZSA9IGRhdGEucGRmVGFibGVbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS5wZGZUYWJsZSA9IG5ld0ZpbGVzO1xuXG4gICAgICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gdGltZXNlcmllc0VkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAvLyBNZXRhZGF0YSBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5leHRSZWxlYXNlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0ID0ge307XG4gIH1cbiAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5lbWFpbCA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNudW1iZXJcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubnVtYmVyID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIja2V5Tm90ZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXlOb3RlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjdW5pdFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi51bml0ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjcHJlVW5pdFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5wcmVVbml0ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc291cmNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnNvdXJjZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvKiBUaGUgY2hlY2tlZCBhdHRyaWJ1dGUgaXMgYSBib29sZWFuIGF0dHJpYnV0ZSwgd2hpY2ggbWVhbnMgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgaXMgdHJ1ZSBpZiB0aGUgYXR0cmlidXRlXG4gICBpcyBwcmVzZW50IGF0IGFsbOKAlGV2ZW4gaWYsIGZvciBleGFtcGxlLCB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSBvciBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIHZhbHVlIG9yIGV2ZW4gXCJmYWxzZVwiICovXG4gIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICAkKFwiI21ldGFkYXRhLWxpc3QgI25hdFN0YXQgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgY2hlY2tCb3hTdGF0dXMpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0ICNuYXRTdGF0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICB9KTtcblxuICB2YXIgaXNJbmRleFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5pc0luZGV4ID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICAkKFwiI21ldGFkYXRhLWxpc3QgI2lzSW5kZXggaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgaXNJbmRleFN0YXR1cykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24uaXNJbmRleCA9ICQoXCIjbWV0YWRhdGEtbGlzdCAjaXNJbmRleCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnKSA/IHRydWUgOiBmYWxzZTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIGlmIChGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICBzd2VldEFsZXJ0KCdZb3UgY2Fubm90IHBlcmZvcm0gdGhpcyBvcGVyYXRpb24gaW4gV2Vsc2guJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIGlmIChGbG9yZW5jZS5nbG9iYWxWYXJzLndlbHNoKSB7XG4gICAgICBzd2VldEFsZXJ0KCdZb3UgY2Fubm90IHBlcmZvcm0gdGhpcyBvcGVyYXRpb24gaW4gV2Vsc2guJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG4gICAgICBzYXZlQW5kQ29tcGxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcbiAgICBzYXZlQW5kUmV2aWV3Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG59XG5cbmZ1bmN0aW9uIGNvbXBlbmRpdW1DaGFwdGVyRWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuXG4gICAgdmFyIG5ld0NoYXJ0ID0gW10sIG5ld1RhYmxlID0gW10sIG5ld0VxdWF0aW9uID0gW10sIG5ld0ltYWdlID0gW10sIG5ld0xpbmtzID0gW107XG4gICAgdmFyIHBhcmVudFVybCA9IGdldFBhcmVudFBhZ2UoZGF0YS51cmkpO1xuICAgIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcblxuICAgIC8vQWRkIHBhcmVudCBsaW5rIG9udG8gcGFnZVxuICAgIGxvYWRQYXJlbnRMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YSwgcGFyZW50VXJsKTtcblxuICAgICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgICAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAgIC8vIE1ldGFkYXRhIGVkaXRpb24gYW5kIHNhdmluZ1xuICAgICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCByZW1hbWUgdGhpcyBwYWdlIGhlcmVcIiwgXCJHbyBiYWNrIHRvIHBhcmVudCBwYWdlIGFuZCB1c2UgdGhlIHJlbmFtZSBmdW5jdGlvbiB0aGVyZVwiKTtcbiAgICB9KTtcbiAgICAkKFwiI2hlYWRsaW5lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uaGVhZGxpbmUgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICAgICAkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKHRoaXMpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KVswXS52YWx1ZSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICAgICAkKCcjcmVsZWFzZURhdGUnKS52YWwoZGF0ZVRtcEZvcm1hdHRlZCkuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpKS50b0lTT1N0cmluZygpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgJChcIiNuZXh0UmVsZWFzZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLm5leHRSZWxlYXNlID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uY29udGFjdCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QgPSB7fTtcbiAgICB9XG4gICAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QubmFtZSA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gICAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LmVtYWlsID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0LnRlbGVwaG9uZSA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gICAgJChcIiNhYnN0cmFjdFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLl9hYnN0cmFjdCA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gICAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgICAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICAgICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICAgIH0pO1xuICAgICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICAgIH0pO1xuICAgICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcblxuICAgIC8qIFRoZSBjaGVja2VkIGF0dHJpYnV0ZSBpcyBhIGJvb2xlYW4gYXR0cmlidXRlLCB3aGljaCBtZWFucyB0aGUgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBpcyB0cnVlIGlmIHRoZSBhdHRyaWJ1dGVcbiAgICAgaXMgcHJlc2VudCBhdCBhbGzigJRldmVuIGlmLCBmb3IgZXhhbXBsZSwgdGhlIGF0dHJpYnV0ZSBoYXMgbm8gdmFsdWUgb3IgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyB2YWx1ZSBvciBldmVuIFwiZmFsc2VcIiAqL1xuICAgIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IFwiZmFsc2VcIiB8fCBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcsIGNoZWNrQm94U3RhdHVzKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPSAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gICAgfSk7XG5cbiAgICAvLyBTYXZlXG4gICAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNhdmUoKTtcbiAgICAgICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfSk7XG5cbiAgICAvLyBjb21wbGV0ZWQgdG8gcmV2aWV3XG4gICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlKCk7XG4gICAgICAgIHNhdmVBbmRDb21wbGV0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIGZhbHNlLCBwYXJlbnRVcmwpO1xuICAgIH0pO1xuXG4gICAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlKCk7XG4gICAgICAgIHNhdmVBbmRSZXZpZXdDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLCBmYWxzZSwgcGFyZW50VXJsKTtcbiAgICB9KTtcblxuXG4gICAgZnVuY3Rpb24gc2F2ZSgpIHtcblxuICAgICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuXG4gICAgICAgIC8vIGNoYXJ0c1xuICAgICAgICB2YXIgb3JkZXJDaGFydCA9ICQoXCIjc29ydGFibGUtY2hhcnRcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAgICAgJChvcmRlckNoYXJ0KS5lYWNoKGZ1bmN0aW9uIChpbmRleENoLCBuYW1lQ2gpIHtcbiAgICAgICAgICAgIHZhciB1cmkgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS51cmk7XG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS50aXRsZTtcbiAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLmZpbGVuYW1lO1xuICAgICAgICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICAgICAgICBuZXdDaGFydFtpbmRleENoXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRhdGEuY2hhcnRzID0gbmV3Q2hhcnQ7XG5cbiAgICAgICAgLy8gdGFibGVzXG4gICAgICAgIHZhciBvcmRlclRhYmxlID0gJChcIiNzb3J0YWJsZS10YWJsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyVGFibGUpLmVhY2goZnVuY3Rpb24gKGluZGV4VGFibGUsIG5hbWVUYWJsZSkge1xuICAgICAgICAgICAgdmFyIHVyaSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLnVyaTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLnRpdGxlO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0uZmlsZW5hbWU7XG4gICAgICAgICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgICAgICAgIG5ld1RhYmxlW2luZGV4VGFibGVdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS50YWJsZXMgPSBuZXdUYWJsZTtcbiAgICAgICAgdmFyIG9yZGVyRXF1YXRpb24gPSAkKFwiI3NvcnRhYmxlLWVxdWF0aW9uXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgICAgICQob3JkZXJFcXVhdGlvbikuZWFjaChmdW5jdGlvbiAoaW5kZXhFcXVhdGlvbiwgbmFtZUVxdWF0aW9uKSB7XG4gICAgICAgICAgICB2YXIgdXJpID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udXJpO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udGl0bGU7XG4gICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmVxdWF0aW9uc1twYXJzZUludChuYW1lRXF1YXRpb24pXS5maWxlbmFtZTtcbiAgICAgICAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgICAgICAgbmV3RXF1YXRpb25baW5kZXhFcXVhdGlvbl0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgICAgIH0pO1xuICAgICAgICBkYXRhLmVxdWF0aW9ucyA9IG5ld0VxdWF0aW9uO1xuICAgICAgICAvLyBpbWFnZXNcbiAgICAgICAgdmFyIG9yZGVySW1hZ2UgPSAkKFwiI3NvcnRhYmxlLWltYWdlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgICAgICQob3JkZXJJbWFnZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhJbWFnZSwgbmFtZUltYWdlKSB7XG4gICAgICAgICAgICB2YXIgdXJpID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0udXJpO1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0udGl0bGU7XG4gICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS5maWxlbmFtZTtcbiAgICAgICAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgICAgICAgbmV3SW1hZ2VbaW5kZXhJbWFnZV0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgICAgIH0pO1xuICAgICAgICBkYXRhLmltYWdlcyA9IG5ld0ltYWdlO1xuXG4gICAgICAgIC8vIEV4dGVybmFsIGxpbmtzXG4gICAgICAgIHZhciBvcmRlckxpbmsgPSAkKFwiI3NvcnRhYmxlLWxpbmtcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAgICAgJChvcmRlckxpbmspLmVhY2goZnVuY3Rpb24gKGluZGV4TCwgbmFtZUwpIHtcbiAgICAgICAgICAgIHZhciBkaXNwbGF5VGV4dCA9IGRhdGEubGlua3NbcGFyc2VJbnQobmFtZUwpXS50aXRsZTtcbiAgICAgICAgICAgIHZhciBsaW5rID0gJCgnI2xpbmstdXJpXycgKyBuYW1lTCkudmFsKCk7XG4gICAgICAgICAgICBuZXdMaW5rc1tpbmRleExdID0ge3VyaTogbGluaywgdGl0bGU6IGRpc3BsYXlUZXh0fTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRhdGEubGlua3MgPSBuZXdMaW5rcztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNvbXBlbmRpdW1EYXRhRWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuXG4gICAgdmFyIG5ld0ZpbGVzID0gW107XG4gICAgdmFyIHBhcmVudFVybCA9IGdldFBhcmVudFBhZ2UoZGF0YS51cmkpO1xuICAgIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcblxuICAgIC8vQWRkIHBhcmVudCBsaW5rIG9udG8gcGFnZVxuICAgIGxvYWRQYXJlbnRMaW5rKGNvbGxlY3Rpb25JZCwgZGF0YSwgcGFyZW50VXJsKTtcblxuICAgICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgICAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICAgICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAgIC8vIE1ldGFkYXRhIGVkaXRpb24gYW5kIHNhdmluZ1xuICAgICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCByZW1hbWUgdGhpcyBwYWdlIGhlcmVcIiwgXCJHbyBiYWNrIHRvIHBhcmVudCBwYWdlIGFuZCB1c2UgdGhlIHJlbmFtZSBmdW5jdGlvbiB0aGVyZVwiKTtcbiAgICB9KTtcbiAgICAkKFwiI3N1bW1hcnlcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAvL2lmICghRmxvcmVuY2UuY29sbGVjdGlvbi5kYXRlKSB7ICAgICAgICAgICAgICAgICAgICAvL292ZXJ3cml0ZSBzY2hlZHVsZWQgY29sbGVjdGlvbiBkYXRlXG4gICAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBkYXRlVG1wID0gZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZTtcbiAgICAgICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgJCgnLnJlbGVhc2UtZGF0ZScpLmhpZGUoKTtcbiAgICAvL31cbiAgICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubmV4dFJlbGVhc2UgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdCA9IHt9O1xuICAgIH1cbiAgICAkKFwiI2NvbnRhY3ROYW1lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2NvbnRhY3RFbWFpbFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICAgIH0pO1xuICAgICQoXCIjY29udGFjdFRlbGVwaG9uZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKFwiI2RhdGFzZXRJZFwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLmRhdGFzZXRJZCA9ICQodGhpcykudmFsKCk7XG4gICAgfSk7XG4gICAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgICAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICAgICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICAgIH0pO1xuICAgICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICAgIH0pO1xuICAgICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcblxuICAgIC8qIFRoZSBjaGVja2VkIGF0dHJpYnV0ZSBpcyBhIGJvb2xlYW4gYXR0cmlidXRlLCB3aGljaCBtZWFucyB0aGUgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBpcyB0cnVlIGlmIHRoZSBhdHRyaWJ1dGVcbiAgICAgaXMgcHJlc2VudCBhdCBhbGzigJRldmVuIGlmLCBmb3IgZXhhbXBsZSwgdGhlIGF0dHJpYnV0ZSBoYXMgbm8gdmFsdWUgb3IgaXMgc2V0IHRvIGVtcHR5IHN0cmluZyB2YWx1ZSBvciBldmVuIFwiZmFsc2VcIiAqL1xuICAgIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IFwiZmFsc2VcIiB8fCBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICQoXCIjbWV0YWRhdGEtbGlzdCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH0pO1xuXG4gICAgLy8gU2F2ZVxuICAgIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gICAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJyNzYXZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlKCk7XG4gICAgICAgIHVwZGF0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgIH0pO1xuXG4gICAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9wYWdlRGF0YSA9ICQoJy5mbC1lZGl0b3JfX2hlYWRsaW5lJykudmFsKCk7XG4gICAgICAgIHNhdmUoKTtcbiAgICAgICAgc2F2ZUFuZENvbXBsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgcGFyZW50VXJsKTtcbiAgICB9KTtcblxuICAgIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2F2ZSgpO1xuICAgICAgICBzYXZlQW5kUmV2aWV3Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgcGFyZW50VXJsKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHNhdmUoKSB7XG5cbiAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcblxuICAgICAgICAvLyBGaWxlcyBhcmUgdXBsb2FkZWQuIFNhdmUgbWV0YWRhdGFcbiAgICAgICAgdmFyIG9yZGVyRmlsZSA9ICQoXCIjc29ydGFibGUtZmlsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgICAgICAgIHZhciBmaWxlRGVzY3JpcHRpb24gPSAkKFwiI2ZpbGUtc3VtbWFyeV9cIiArIG5hbWVGKS52YWwoKTtcbiAgICAgICAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGVEZXNjcmlwdGlvbjogZmlsZURlc2NyaXB0aW9uLCBmaWxlOiBmaWxlfTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjb21wZW5kaXVtRWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhKSB7XG5cbi8vICB2YXIgaW5kZXggPSBkYXRhLnJlbGVhc2U7XG4gIHZhciBuZXdDaGFwdGVycyA9IFtdO1xuICB2YXIgbGFzdEluZGV4Q2hhcHRlciwgbGFzdEluZGV4RGF0YXNldDtcbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuICB2YXIgcmVuYW1lVXJpID0gZmFsc2U7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICByZXNvbHZlVGl0bGVUNihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgJ2NoYXB0ZXJzJyk7XG4gIHJlc29sdmVUaXRsZVQ2KGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhLCAnZGF0YXNldHMnKTtcblxuICAvLyBNZXRhZGF0YSBsb2FkLCBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjZWRpdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5leHRSZWxlYXNlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0ID0ge307XG4gIH1cbiAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5lbWFpbCA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNzdW1tYXJ5XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnN1bW1hcnkgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNoZWFkbGluZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5oZWFkbGluZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvKiBUaGUgY2hlY2tlZCBhdHRyaWJ1dGUgaXMgYSBib29sZWFuIGF0dHJpYnV0ZSwgd2hpY2ggbWVhbnMgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgaXMgdHJ1ZSBpZiB0aGUgYXR0cmlidXRlXG4gICBpcyBwcmVzZW50IGF0IGFsbOKAlGV2ZW4gaWYsIGZvciBleGFtcGxlLCB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSBvciBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIHZhbHVlIG9yIGV2ZW4gXCJmYWxzZVwiICovXG4gIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gICQoXCIjbWV0YWRhdGEtbGlzdCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPSAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gIH0pO1xuXG4gIC8vQWRkIG5ldyBjaGFwdGVyXG4gICQoXCIjYWRkLWNoYXB0ZXJcIikub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY2hhcHRlclRpdGxlO1xuICAgICQoJyNzb3J0YWJsZS1jaGFwdGVyJykuYXBwZW5kKFxuICAgICAgJzxkaXYgaWQ9XCInICsgbGFzdEluZGV4Q2hhcHRlciArICdcIiBjbGFzcz1cImVkaXQtc2VjdGlvbl9fc29ydGFibGUtaXRlbVwiPicgK1xuICAgICAgJzx0ZXh0YXJlYSBjbGFzcz1cImF1dG8tc2l6ZVwiIGlkPVwibmV3LWNoYXB0ZXItdGl0bGVcIiBwbGFjZWhvbGRlcj1cIlR5cGUgdGl0bGUgaGVyZSBhbmQgY2xpY2sgYWRkXCI+PC90ZXh0YXJlYT4nICtcbiAgICAgICc8ZGl2IGNsYXNzPVwiZWRpdC1zZWN0aW9uX19idXR0b25zXCI+JyArXG4gICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0bi1tYXJrZG93bi1lZGl0XCIgaWQ9XCJjaGFwdGVyLWFkZFwiPkVkaXQgY2hhcHRlcjwvYnV0dG9uPicgK1xuICAgICAgJzwvZGl2PicgK1xuICAgICAgJzwvZGl2PicpO1xuICAgICQoJyNuZXctY2hhcHRlci10aXRsZScpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgICAgY2hhcHRlclRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgICB9KTtcbiAgICAkKCcjY2hhcHRlci1hZGQnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoY2hhcHRlclRpdGxlLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgc3dlZXRBbGVydChcIlRoaXMgaXMgbm90IGEgdmFsaWQgZmlsZSB0aXRsZVwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2FkVDZDcmVhdG9yKGNvbGxlY3Rpb25JZCwgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSwgJ2NvbXBlbmRpdW1fY2hhcHRlcicsIGRhdGEudXJpLCBjaGFwdGVyVGl0bGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICAvL0FkZCBuZXcgdGFibGUgKG9ubHkgb25lIHBlciBjb21wZW5kaXVtKVxuICBpZiAoIWRhdGEuZGF0YXNldHMgfHwgZGF0YS5kYXRhc2V0cy5sZW5ndGggPT09IDApIHtcbiAgICAkKFwiI2FkZC1jb21wZW5kaXVtLWRhdGFcIikub25lKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0YWJsZVRpdGxlO1xuICAgICAgJCgnI3NvcnRhYmxlLWNvbXBlbmRpdW0tZGF0YScpLmFwcGVuZChcbiAgICAgICAgJzxkaXYgaWQ9XCInICsgbGFzdEluZGV4RGF0YXNldCArICdcIiBjbGFzcz1cImVkaXQtc2VjdGlvbl9faXRlbVwiPicgK1xuICAgICAgICAnPHRleHRhcmVhIGNsYXNzPVwiYXV0by1zaXplXCIgaWQ9XCJuZXctY29tcGVuZGl1bS1kYXRhLXRpdGxlXCIgcGxhY2Vob2xkZXI9XCJUeXBlIHRpdGxlIGhlcmUgYW5kIGNsaWNrIGFkZFwiPjwvdGV4dGFyZWE+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiZWRpdC1zZWN0aW9uX19idXR0b25zXCI+JyArXG4gICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuLW1hcmtkb3duLWVkaXRcIiBpZD1cImNvbXBlbmRpdW0tZGF0YS1hZGRcIj5FZGl0IGRhdGE8L2J1dHRvbj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+Jyk7XG4gICAgICAkKCcjbmV3LWNvbXBlbmRpdW0tZGF0YS10aXRsZScpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgICAgIHRhYmxlVGl0bGUgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgfSk7XG4gICAgICAkKCcjY29tcGVuZGl1bS1kYXRhLWFkZCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRhYmxlVGl0bGUubGVuZ3RoIDwgNSkge1xuICAgICAgICAgIHN3ZWV0QWxlcnQoXCJUaGlzIGlzIG5vdCBhIHZhbGlkIGZpbGUgdGl0bGVcIik7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9hZFQ2Q3JlYXRvcihjb2xsZWN0aW9uSWQsIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUsICdjb21wZW5kaXVtX2RhdGEnLCBkYXRhLnVyaSwgdGFibGVUaXRsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgICQoJyNhZGQtY29tcGVuZGl1bS1kYXRhJykuaGlkZSgpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzd2VldEFsZXJ0KCdBdCB0aGUgbW9tZW50IHlvdSBjYW4gaGF2ZSBvbmUgc2VjdGlvbiBoZXJlLicpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUodXBkYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNhdmUob25TYXZlKSB7XG5cbiAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuXG4gICAgLy8gQ2hhcHRlcnNcbiAgICB2YXIgb3JkZXJSZWxhdGVkQ2hhcHRlciA9ICQoXCIjc29ydGFibGUtY2hhcHRlclwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJSZWxhdGVkQ2hhcHRlcikuZWFjaChmdW5jdGlvbiAoaW5kZXhDLCBuYW1lQykge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuY2hhcHRlcnNbcGFyc2VJbnQobmFtZUMpXS51cmk7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0NoYXB0ZXJzW2luZGV4Q10gPSB7dXJpOiBzYWZlVXJpfTtcbiAgICB9KTtcbiAgICBkYXRhLmNoYXB0ZXJzID0gbmV3Q2hhcHRlcnM7XG5cbiAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIGRhdGEsIHJlbmFtZVVyaSwgb25TYXZlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXNvbHZlVGl0bGVUNihjb2xsZWN0aW9uSWQsIGRhdGEsIHRlbXBsYXRlRGF0YSwgZmllbGQpIHtcbiAgdmFyIGFqYXhSZXF1ZXN0ID0gW107XG4gICQodGVtcGxhdGVEYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhdGgpIHtcbiAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbiA9IHt9O1xuICAgIHZhciBlYWNoVXJpID0gcGF0aC51cmk7XG4gICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBnZXRQYWdlRGF0YVRpdGxlKGNvbGxlY3Rpb25JZCwgZWFjaFVyaSxcbiAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbi50aXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xuICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3dlZXRBbGVydChcIkVycm9yXCIsIGZpZWxkICsgJyBhZGRyZXNzOiAnICsgZWFjaFVyaSArICcgaXMgbm90IGZvdW5kLicsIFwiZXJyb3JcIik7XG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XG4gICAgICB9XG4gICAgKTtcbiAgICBhamF4UmVxdWVzdC5wdXNoKGRmZCk7XG4gIH0pO1xuXG4gICQud2hlbi5hcHBseSgkLCBhamF4UmVxdWVzdCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRhdGFUZW1wbGF0ZSA9IHRlbXBsYXRlRGF0YVtmaWVsZF07XG4gICAgaWYgKGZpZWxkID09PSAnZGF0YXNldHMnKSB7XG4gICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ2RGF0YXNldChkYXRhVGVtcGxhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgaHRtbCA9IHRlbXBsYXRlcy53b3JrRWRpdFQ2Q2hhcHRlcihkYXRhVGVtcGxhdGUpO1xuICAgIH1cbiAgICAkKCcjJyArIGZpZWxkKS5yZXBsYWNlV2l0aChodG1sKTtcblxuICAgIGlmIChmaWVsZCA9PT0gJ2RhdGFzZXRzJykge1xuICAgICAgZWRpdERhdGEoY29sbGVjdGlvbklkLCBkYXRhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWRpdENoYXB0ZXJzKGNvbGxlY3Rpb25JZCwgZGF0YSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZWRpdENoYXB0ZXJzKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAvLyBFZGl0IGNoYXB0ZXJzXG4gIC8vIExvYWQgY2hhcHRlciB0byBlZGl0XG4gICQoZGF0YS5jaGFwdGVycykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICBsYXN0SW5kZXhDaGFwdGVyID0gaW5kZXggKyAxO1xuXG4gICAgLy9vcGVuIGRvY3VtZW50XG4gICAgJChcIiNjaGFwdGVyLWVkaXRfXCIgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlbGVjdGVkQ2hhcHRlciA9IGRhdGEuY2hhcHRlcnNbaW5kZXhdLnVyaTtcbiAgICAgIGNyZWF0ZVdvcmtzcGFjZShzZWxlY3RlZENoYXB0ZXIsIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICB9KTtcblxuICAgICQoJyNjaGFwdGVyLWVkaXQtbGFiZWxfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc2VsZWN0ZWRDaGFwdGVyID0gZGF0YS5jaGFwdGVyc1tpbmRleF0udXJpO1xuICAgICAgZ2V0UGFnZURhdGEoY29sbGVjdGlvbklkLCBzZWxlY3RlZENoYXB0ZXIsXG4gICAgICAgIGZ1bmN0aW9uIChwYWdlRGF0YSkge1xuICAgICAgICAgIHZhciBtYXJrZG93biA9IHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnRpdGxlO1xuICAgICAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7dGl0bGU6ICdDb21wZW5kaXVtIGNoYXB0ZXIgdGl0bGUnLCBtYXJrZG93bjogbWFya2Rvd259O1xuICAgICAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICAgICAgcGFnZURhdGEuZGVzY3JpcHRpb24udGl0bGUgPSB1cGRhdGVkQ29udGVudDtcbiAgICAgICAgICAgIHZhciBjaGlsZFRpdGxlID0gdXBkYXRlZENvbnRlbnQucmVwbGFjZSgvW15BLVowLTldKy9pZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYWdlRGF0YS51cmksIEpTT04uc3RyaW5naWZ5KHBhZ2VEYXRhKSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vc2F2ZSBjaGlsZHJlbiBjaGFuZ2UgYW5kIG1vdmVcbiAgICAgICAgICAgICAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0cnVlLCB1cGRhdGVDb250ZW50KTtcbiAgICAgICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBvbiBzdWNjZXNzIHVwZGF0ZSBkYXRhc2V0IHVyaSBpbiBwYXJlbnQgYW5kIHNhdmVcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jaGFwdGVyc1tpbmRleF0udXJpID0gZGF0YS51cmkgKyBcIi9cIiArIGNoaWxkVGl0bGU7XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH07XG4gICAgICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIHBhZ2VEYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICBoYW5kbGVBcGlFcnJvcihtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIC8vIERlbGV0ZVxuICAgICQoXCIjY2hhcHRlci1kZWxldGVfXCIgKyBpbmRleCkuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgc3dhbCh7XG4gICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgdGV4dDogXCJZb3UgYXJlIGdvaW5nIHRvIGRlbGV0ZSB0aGUgY2hhcHRlciB0aGlzIGxpbmsgcmVmZXJzIHRvLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcHJvY2VlZD9cIixcbiAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgdmFyIHNlbGVjdGVkQ2hhcHRlciA9IGRhdGEuY2hhcHRlcnNbaW5kZXhdLnVyaTtcbiAgICAgICAgICB2YXIgcGF0aCA9IGRhdGEudXJpO1xuICAgICAgICAgICQoXCIjXCIgKyBpbmRleCkucmVtb3ZlKCk7XG4gICAgICAgICAgZGF0YS5jaGFwdGVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBmaWxlIGhhcyBiZWVuIGRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHNlbGVjdGVkQ2hhcHRlciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KHBhdGgpO1xuICAgICAgICAgICAgICAgIGxvYWRQYWdlRGF0YUludG9FZGl0b3IocGF0aCwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgICAgfSwgZXJyb3IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNvcnRhYmxlU2VjdGlvbnMoKSB7XG4gICAgJChcIiNzb3J0YWJsZS1jaGFwdGVyXCIpLnNvcnRhYmxlKCk7XG4gIH1cblxuICBzb3J0YWJsZVNlY3Rpb25zKCk7XG59XG5cbmZ1bmN0aW9uIGVkaXREYXRhKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuICAvLyBFZGl0IGRhdGEgcmVmZXJlbmNlIHRhYmxlXG4gIC8vIExvYWQgdGFibGUgdG8gZWRpdFxuICBpZiAoIWRhdGEuZGF0YXNldHMgfHwgZGF0YS5kYXRhc2V0cy5sZW5ndGggPT09IDApIHtcbiAgICBsYXN0SW5kZXhEYXRhc2V0ID0gMDtcbiAgfSBlbHNlIHtcbiAgICAkKGRhdGEuZGF0YXNldHMpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAvL29wZW4gZG9jdW1lbnRcbiAgICAgIHZhciBzZWxlY3RlZERhdGEgPSBkYXRhLmRhdGFzZXRzW2luZGV4XS51cmk7XG4gICAgICAkKFwiI2NvbXBlbmRpdW0tZGF0YS1lZGl0X1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVmcmVzaFByZXZpZXcoc2VsZWN0ZWREYXRhKTtcbiAgICAgICAgdmlld1dvcmtzcGFjZShzZWxlY3RlZERhdGEsIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgIH0pO1xuXG4gICAgICAkKCcjY29tcGVuZGl1bS1kYXRhLWVkaXQtbGFiZWxfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdldFBhZ2VEYXRhKGNvbGxlY3Rpb25JZCwgc2VsZWN0ZWREYXRhLFxuICAgICAgICAgIGZ1bmN0aW9uIChwYWdlRGF0YSkge1xuICAgICAgICAgICAgdmFyIG1hcmtkb3duID0gcGFnZURhdGEuZGVzY3JpcHRpb24udGl0bGU7XG4gICAgICAgICAgICB2YXIgZWRpdGVkU2VjdGlvblZhbHVlID0ge3RpdGxlOiAnQ29tcGVuZGl1bSBkYXRhc2V0IHRpdGxlJywgbWFya2Rvd246IG1hcmtkb3dufTtcbiAgICAgICAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9IHVwZGF0ZWRDb250ZW50O1xuICAgICAgICAgICAgICB2YXIgY2hpbGRUaXRsZSA9IHVwZGF0ZWRDb250ZW50LnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYWdlRGF0YS51cmksIEpTT04uc3RyaW5naWZ5KHBhZ2VEYXRhKSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAvL3NhdmUgY2hpbGRyZW4gY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgLy9tb3ZlXG4gICAgICAgICAgICAgICAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIHBhZ2VEYXRhLCB0cnVlLCB1cGRhdGVDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBvbiBzdWNjZXNzIHVwZGF0ZSBkYXRhc2V0IHVyaSBpbiBwYXJlbnQgYW5kIHNhdmVcbiAgICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFzZXRzW2luZGV4XS51cmkgPSBkYXRhLnVyaSArIFwiL1wiICsgY2hpbGRUaXRsZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsb2FkTWFya2Rvd25FZGl0b3IoZWRpdGVkU2VjdGlvblZhbHVlLCBzYXZlQ29udGVudCwgcGFnZURhdGEpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBEZWxldGVcbiAgICAgICQoXCIjY29tcGVuZGl1bS1kYXRhLWRlbGV0ZV9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vdmFyIHJlc3VsdCA9IGNvbmZpcm0oXCJZb3UgYXJlIGdvaW5nIHRvIGRlbGV0ZSB0aGUgY2hhcHRlciB0aGlzIGxpbmsgcmVmZXJzIHRvLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcHJvY2VlZD9cIik7XG4gICAgICAgIHN3YWwoe1xuICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIllvdSBhcmUgZ29pbmcgdG8gZGVsZXRlIHRoZSBjaGFwdGVyIHRoaXMgbGluayByZWZlcnMgdG8uIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBwcm9jZWVkP1wiLFxuICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEgPSBkYXRhLmRhdGFzZXRzW2luZGV4XS51cmk7XG4gICAgICAgICAgICB2YXIgcGF0aCA9IGRhdGEudXJpO1xuICAgICAgICAgICAgJChcIiNcIiArIGluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGRhdGEuZGF0YXNldHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiRGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgdGV4dDogXCJUaGlzIGZpbGUgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHNlbGVjdGVkRGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcocGF0aCk7XG4gICAgICAgICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKHBhdGgsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgfSwgZXJyb3IpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZEhvY0VkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgbmV3RmlsZXMgPSBbXTtcbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuICB2YXIgcmVuYW1lVXJpID0gZmFsc2U7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAkKFwiI21ldGFkYXRhLWZcIikucmVtb3ZlKCk7XG4gICQoXCIjbWV0YWRhdGEtbWRcIikucmVtb3ZlKCk7XG4gICQoXCIjbWV0YWRhdGEtcVwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1zXCIpLnJlbW92ZSgpO1xuICAkKFwiI3N1bW1hcnktcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNjb250YWN0LXBcIikucmVtb3ZlKCk7XG4gICQoXCIjbmF0U3RhdFwiKS5yZW1vdmUoKTtcbiAgJChcIiNzdXJ2ZXktcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNmcmVxdWVuY3ktcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNjb21waWxhdGlvbi1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2dlb0NvdmVyYWdlLXBcIikucmVtb3ZlKCk7XG4gICQoXCIjc2FtcGxlU2l6ZS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiLmxhc3RSZXZpc2VkLXBcIikucmVtb3ZlKCk7XG5cbiAgLy8gTWV0YWRhdGEgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAvL2lmICghRmxvcmVuY2UuY29sbGVjdGlvbi5kYXRlKSB7ICAgICAgICAgICAgICAgICAgICAvL292ZXJ3cml0ZSBzY2hlZHVsZWQgY29sbGVjdGlvbiBkYXRlXG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRhdGVUbXAgPSBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlO1xuICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cbiAgLy99IGVsc2Uge1xuICAvLyAgICAkKCcucmVsZWFzZS1kYXRlJykuaGlkZSgpO1xuICAvL31cbiAgJChcIiNyZWZlcmVuY2VcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgdmFyIGlzTnVtYmVyID0gJCh0aGlzKS52YWwoKTtcbiAgICBpZiAoaXNOdW1iZXIubWF0Y2goL15cXGQrJC8pKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlZmVyZW5jZSA9IGlzTnVtYmVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBzd2VldEFsZXJ0KCdUaGlzIG5lZWRzIHRvIGJlIGEgbnVtYmVyJyk7XG4gICAgfVxuICB9KTtcbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUodXBkYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNhdmUob25TYXZlKSB7XG5cbiAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuXG4gICAgLy8gU2VjdGlvbnNcbiAgICBkYXRhLm1hcmtkb3duID0gWyQoJyNjb250ZW50LW1hcmtkb3duJykudmFsKCldO1xuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLWZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG5cbiAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIGRhdGEsIHJlbmFtZVVyaSwgb25TYXZlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBmb2lFZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgdmFyIG5ld0ZpbGVzID0gW107XG4gIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcbiAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuXG4gICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICB9XG4gIH0pO1xuXG4gIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgJChcIiNtZXRhZGF0YS1hZFwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1tZFwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1xXCIpLnJlbW92ZSgpO1xuICAkKFwiI21ldGFkYXRhLXNcIikucmVtb3ZlKCk7XG4gICQoXCIjc3VtbWFyeS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2NvbnRhY3QtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNuYXRTdGF0XCIpLnJlbW92ZSgpO1xuICAkKFwiI3N1cnZleS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2ZyZXF1ZW5jeS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2NvbXBpbGF0aW9uLXBcIikucmVtb3ZlKCk7XG4gICQoXCIjZ2VvQ292ZXJhZ2UtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNzYW1wbGVTaXplLXBcIikucmVtb3ZlKCk7XG4gICQoXCIubGFzdFJldmlzZWQtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNyZWZlcmVuY2UtcFwiKS5yZW1vdmUoKTtcblxuICAvLyBNZXRhZGF0YSBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIC8vaWYgKCFGbG9yZW5jZS5jb2xsZWN0aW9uLmRhdGUpIHsgICAgICAgICAgICAgICAgICAgIC8vb3ZlcndyaXRlIHNjaGVkdWxlZCBjb2xsZWN0aW9uIGRhdGVcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuICAvL30gZWxzZSB7XG4gIC8vICAgICQoJy5yZWxlYXNlLWRhdGUnKS5oaWRlKCk7XG4gIC8vfVxuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvLyBTYXZlXG4gIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRSZXZpZXdDb250ZW50KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcbiAgICAvLyBTZWN0aW9uc1xuICAgIGRhdGEubWFya2Rvd24gPSBbJCgnI2NvbnRlbnQtbWFya2Rvd24nKS52YWwoKV07XG4gICAgLy8gRmlsZXMgYXJlIHVwbG9hZGVkLiBTYXZlIG1ldGFkYXRhXG4gICAgdmFyIG9yZGVyRmlsZSA9ICQoXCIjc29ydGFibGUtZmlsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJGaWxlKS5lYWNoKGZ1bmN0aW9uIChpbmRleEYsIG5hbWVGKSB7XG4gICAgICB2YXIgdGl0bGUgPSAkKCcjZmlsZS10aXRsZV8nICsgbmFtZUYpLnZhbCgpO1xuICAgICAgdmFyIGZpbGUgPSBkYXRhLmRvd25sb2Fkc1twYXJzZUludChuYW1lRildLmZpbGU7XG4gICAgICBuZXdGaWxlc1tpbmRleEZdID0ge3RpdGxlOiB0aXRsZSwgZmlsZTogZmlsZX07XG4gICAgfSk7XG4gICAgZGF0YS5kb3dubG9hZHMgPSBuZXdGaWxlcztcblxuICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG1ldGhvZG9sb2d5RG93bmxvYWRFZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgdmFyIG5ld0ZpbGVzID0gW10sIG5ld1BkZkZpbGVzID0gW107XG4gIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcbiAgdmFyIHJlbmFtZVVyaSA9IGZhbHNlO1xuXG4gICQoXCIuZWRpdC1hY2NvcmRpb25cIikub24oJ2FjY29yZGlvbmFjdGl2YXRlJywgZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgIGlmIChzZXRBY3RpdmVUYWIgIT09IGZhbHNlKSB7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9IHNldEFjdGl2ZVRhYjtcbiAgICB9XG4gIH0pO1xuXG4gIGdldEFjdGl2ZVRhYiA9IEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiO1xuICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgZ2V0TGFzdFBvc2l0aW9uKCk7XG5cbiAgJChcIiNtZXRhZGF0YS1hZFwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1mXCIpLnJlbW92ZSgpO1xuICAkKFwiI21ldGFkYXRhLXFcIikucmVtb3ZlKCk7XG4gICQoXCIjbWV0YWRhdGEtc1wiKS5yZW1vdmUoKTtcbiAgJChcIiNzdW1tYXJ5LXBcIikucmVtb3ZlKCk7XG4gICQoXCIjbmF0U3RhdFwiKS5yZW1vdmUoKTtcbiAgJChcIiNzdXJ2ZXktcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNmcmVxdWVuY3ktcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNjb21waWxhdGlvbi1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2dlb0NvdmVyYWdlLXBcIikucmVtb3ZlKCk7XG4gICQoXCIjc2FtcGxlU2l6ZS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiLmxhc3RSZXZpc2VkLXBcIikucmVtb3ZlKCk7XG4gICQoXCIjcmVmZXJlbmNlLXBcIikucmVtb3ZlKCk7XG5cbiAgLy8gTWV0YWRhdGEgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uY29udGFjdCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdCA9IHt9O1xuICB9XG4gICQoXCIjY29udGFjdE5hbWVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjY29udGFjdEVtYWlsXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0VGVsZXBob25lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRhdGVUbXAgPSBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlO1xuICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUodXBkYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNhdmUob25TYXZlKSB7XG4gICAgLy8gU2VjdGlvbnNcbiAgICBkYXRhLm1hcmtkb3duID0gWyQoJyNjb250ZW50LW1hcmtkb3duJykudmFsKCldO1xuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLWZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG4gICAgLy8gUERGIGZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlclBkZkZpbGUgPSAkKFwiI3NvcnRhYmxlLXBkZkZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyUGRmRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhQLCBuYW1lUCkge1xuICAgICAgdmFyIHBkZlRpdGxlID0gJCgnI3BkZkZpbGUtdGl0bGVfJyArIG5hbWVQKS52YWwoKTtcbiAgICAgIHZhciBwZGZGaWxlID0gZGF0YS5wZGZEb3dubG9hZHNbcGFyc2VJbnQobmFtZVApXS5maWxlO1xuICAgICAgbmV3UGRmRmlsZXNbaW5kZXhQXSA9IHt0aXRsZTogcGRmVGl0bGUsIGZpbGU6IHBkZkZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEucGRmRG93bmxvYWRzID0gbmV3UGRmRmlsZXM7XG5cbiAgICBjaGVja1JlbmFtZVVyaShjb2xsZWN0aW9uSWQsIGRhdGEsIHJlbmFtZVVyaSwgb25TYXZlKTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIG1ldGhvZG9sb2d5RWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuXG4gIHZhciBuZXdDaGFydCA9IFtdLCBuZXdUYWJsZSA9IFtdLCBuZXdFcXVhdGlvbiA9IFtdLCBuZXdJbWFnZSA9IFtdLCBuZXdGaWxlcyA9IFtdO1xuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gIHZhciByZW5hbWVVcmkgPSBmYWxzZTtcblxuICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgfVxuICB9KTtcblxuICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG4gIGdldExhc3RQb3NpdGlvbigpO1xuXG4gIC8vIE1ldGFkYXRhIGxvYWQsIGVkaXRpb24gYW5kIHNhdmluZ1xuICAkKFwiI3RpdGxlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICByZW5hbWVVcmkgPSB0cnVlO1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24udGl0bGUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgLy9pZiAoIUZsb3JlbmNlLmNvbGxlY3Rpb24uZGF0ZSkgeyAgICAgICAgICAgICAgICAgICAgICAgIC8vb3ZlcndyaXRlIHNjaGVkdWxlZCBjb2xsZWN0aW9uIGRhdGVcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgLy9kYXRlVG1wID0gJCgnI3JlbGVhc2VEYXRlJykudmFsKCk7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuICAvL30gZWxzZSB7XG4gIC8vICAgICQoJy5yZWxlYXNlLWRhdGUnKS5oaWRlKCk7XG4gIC8vfVxuICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uY29udGFjdCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdCA9IHt9O1xuICB9XG4gICQoXCIjY29udGFjdE5hbWVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjY29udGFjdEVtYWlsXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0VGVsZXBob25lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc3VtbWFyeVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIja2V5d29yZHNUYWdcIikudGFnaXQoe1xuICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgYWxsb3dTcGFjZXM6IHRydWUsXG4gICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICB9KTtcbiAgJCgnI2tleXdvcmRzJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzID0gJCgnI2tleXdvcmRzJykudmFsKCkuc3BsaXQoJywnKTtcbiAgfSk7XG4gICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHVwZGF0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyBjb21wbGV0ZWQgdG8gcmV2aWV3XG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRDb21wbGV0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyByZXZpZXdlZCB0byBhcHByb3ZlXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZFJldmlld0NvbnRlbnQpO1xuICB9KTtcblxuICBmdW5jdGlvbiBzYXZlKG9uU2F2ZSkge1xuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAvLyBjaGFydHNcbiAgICB2YXIgb3JkZXJDaGFydCA9ICQoXCIjc29ydGFibGUtY2hhcnRcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyQ2hhcnQpLmVhY2goZnVuY3Rpb24gKGluZGV4Q2gsIG5hbWVDaCkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5jaGFydHNbcGFyc2VJbnQobmFtZUNoKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0NoYXJ0W2luZGV4Q2hdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuY2hhcnRzID0gbmV3Q2hhcnQ7XG4gICAgLy8gdGFibGVzXG4gICAgdmFyIG9yZGVyVGFibGUgPSAkKFwiI3NvcnRhYmxlLXRhYmxlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlclRhYmxlKS5lYWNoKGZ1bmN0aW9uIChpbmRleFRhYmxlLCBuYW1lVGFibGUpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEudGFibGVzW3BhcnNlSW50KG5hbWVUYWJsZSldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdUYWJsZVtpbmRleFRhYmxlXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLnRhYmxlcyA9IG5ld1RhYmxlO1xuICAgIC8vIGVxdWF0aW9uc1xuICAgIHZhciBvcmRlckVxdWF0aW9uID0gJChcIiNzb3J0YWJsZS1lcXVhdGlvblwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJFcXVhdGlvbikuZWFjaChmdW5jdGlvbiAoaW5kZXhFcXVhdGlvbiwgbmFtZUVxdWF0aW9uKSB7XG4gICAgICB2YXIgdXJpID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udXJpO1xuICAgICAgdmFyIHRpdGxlID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0udGl0bGU7XG4gICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmVxdWF0aW9uc1twYXJzZUludChuYW1lRXF1YXRpb24pXS5maWxlbmFtZTtcbiAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3RXF1YXRpb25baW5kZXhFcXVhdGlvbl0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgfSk7XG4gICAgZGF0YS5lcXVhdGlvbnMgPSBuZXdFcXVhdGlvbjtcbiAgICAvLyBpbWFnZXNcbiAgICB2YXIgb3JkZXJJbWFnZSA9ICQoXCIjc29ydGFibGUtaW1hZ2VcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVySW1hZ2UpLmVhY2goZnVuY3Rpb24gKGluZGV4SW1hZ2UsIG5hbWVJbWFnZSkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0ltYWdlW2luZGV4SW1hZ2VdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuaW1hZ2VzID0gbmV3SW1hZ2U7XG5cbiAgICAvLyBGaWxlcyBhcmUgdXBsb2FkZWQuIFNhdmUgbWV0YWRhdGFcbiAgICB2YXIgb3JkZXJGaWxlID0gJChcIiNzb3J0YWJsZS1maWxlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckZpbGUpLmVhY2goZnVuY3Rpb24gKGluZGV4RiwgbmFtZUYpIHtcbiAgICAgIHZhciB0aXRsZSA9ICQoJyNmaWxlLXRpdGxlXycgKyBuYW1lRikudmFsKCk7XG4gICAgICB2YXIgZmlsZSA9IGRhdGEuZG93bmxvYWRzW3BhcnNlSW50KG5hbWVGKV0uZmlsZTtcbiAgICAgIG5ld0ZpbGVzW2luZGV4Rl0gPSB7dGl0bGU6IHRpdGxlLCBmaWxlOiBmaWxlfTtcbiAgICB9KTtcbiAgICBkYXRhLmRvd25sb2FkcyA9IG5ld0ZpbGVzO1xuXG4gICAgY2hlY2tSZW5hbWVVcmkoY29sbGVjdGlvbklkLCBkYXRhLCByZW5hbWVVcmksIG9uU2F2ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcW1pRWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuXG4gIHZhciBuZXdGaWxlcyA9IFtdO1xuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gIHZhciByZW5hbWVVcmkgPSBmYWxzZTtcblxuICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgfVxuICB9KTtcblxuICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG4gIGdldExhc3RQb3NpdGlvbigpO1xuXG4gICQoXCIjbWV0YWRhdGEtYWRcIikucmVtb3ZlKCk7XG4gICQoXCIjbWV0YWRhdGEtZlwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1tZFwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1zXCIpLnJlbW92ZSgpO1xuICAkKFwiI3N1bW1hcnktcFwiKS5yZW1vdmUoKTtcbiAgJChcIi5yZWxlYXNlLWRhdGVcIikucmVtb3ZlKCk7XG4gICQoXCIjcmVmZXJlbmNlLXBcIikucmVtb3ZlKCk7XG5cbiAgLy8gTWV0YWRhdGEgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICBpZiAoIWRhdGEuZGVzY3JpcHRpb24uY29udGFjdCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdCA9IHt9O1xuICB9XG4gICQoXCIjY29udGFjdE5hbWVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5uYW1lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjY29udGFjdEVtYWlsXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWwgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0VGVsZXBob25lXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc3VydmV5XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnN1cnZleU5hbWUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNmcmVxdWVuY3lcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uZnJlcXVlbmN5ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjY29tcGlsYXRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29tcGlsYXRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNnZW9Db3ZlcmFnZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5nZW9ncmFwaGljQ292ZXJhZ2UgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNzYW1wbGVTaXplXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnNhbXBsZVNpemUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLmxhc3RSZXZpc2VkKSB7XG4gICAgJCgnI2xhc3RSZXZpc2VkJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLmxhc3RSZXZpc2VkID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ubGFzdFJldmlzZWQ7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI2xhc3RSZXZpc2VkJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5sYXN0UmV2aXNlZCA9IG5ldyBEYXRlKCQoJyNsYXN0UmV2aXNlZCcpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuICAkKFwiI2tleXdvcmRzVGFnXCIpLnRhZ2l0KHtcbiAgICBhdmFpbGFibGVUYWdzOiBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzLFxuICAgIHNpbmdsZUZpZWxkOiB0cnVlLFxuICAgIGFsbG93U3BhY2VzOiB0cnVlLFxuICAgIHNpbmdsZUZpZWxkTm9kZTogJCgnI2tleXdvcmRzJylcbiAgfSk7XG4gICQoJyNrZXl3b3JkcycpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyA9ICQoJyNrZXl3b3JkcycpLnZhbCgpLnNwbGl0KCcsJyk7XG4gIH0pO1xuICAkKFwiI21ldGFEZXNjcmlwdGlvblwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5tZXRhRGVzY3JpcHRpb24gPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcblxuICAvKiBUaGUgY2hlY2tlZCBhdHRyaWJ1dGUgaXMgYSBib29sZWFuIGF0dHJpYnV0ZSwgd2hpY2ggbWVhbnMgdGhlIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgaXMgdHJ1ZSBpZiB0aGUgYXR0cmlidXRlXG4gICBpcyBwcmVzZW50IGF0IGFsbOKAlGV2ZW4gaWYsIGZvciBleGFtcGxlLCB0aGUgYXR0cmlidXRlIGhhcyBubyB2YWx1ZSBvciBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIHZhbHVlIG9yIGV2ZW4gXCJmYWxzZVwiICovXG4gIHZhciBjaGVja0JveFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gXCJmYWxzZVwiIHx8IGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gICQoXCIjbWV0YWRhdGEtbGlzdCBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja0JveFN0YXR1cykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWMgPSAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJykgPyB0cnVlIDogZmFsc2U7XG4gIH0pO1xuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHVwZGF0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyBjb21wbGV0ZWQgdG8gcmV2aWV3XG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRDb21wbGV0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyByZXZpZXdlZCB0byBhcHByb3ZlXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZFJldmlld0NvbnRlbnQpO1xuICB9KTtcblxuICBmdW5jdGlvbiBzYXZlKG9uU2F2ZSkge1xuXG4gICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcblxuICAgIC8vIFNlY3Rpb25zXG4gICAgZGF0YS5tYXJrZG93biA9IFskKCcjY29udGVudC1tYXJrZG93bicpLnZhbCgpXTtcbiAgICAvLyBGaWxlcyBhcmUgdXBsb2FkZWQuIFNhdmUgbWV0YWRhdGFcbiAgICB2YXIgb3JkZXJGaWxlID0gJChcIiNzb3J0YWJsZS1maWxlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckZpbGUpLmVhY2goZnVuY3Rpb24gKGluZGV4RiwgbmFtZUYpIHtcbiAgICAgIHZhciB0aXRsZSA9ICQoJyNmaWxlLXRpdGxlXycgKyBuYW1lRikudmFsKCk7XG4gICAgICB2YXIgZmlsZSA9IGRhdGEuZG93bmxvYWRzW3BhcnNlSW50KG5hbWVGKV0uZmlsZTtcbiAgICAgIG5ld0ZpbGVzW2luZGV4Rl0gPSB7dGl0bGU6IHRpdGxlLCBmaWxlOiBmaWxlfTtcbiAgICB9KTtcbiAgICBkYXRhLmRvd25sb2FkcyA9IG5ld0ZpbGVzO1xuXG4gICAgY2hlY2tSZW5hbWVVcmkoY29sbGVjdGlvbklkLCBkYXRhLCByZW5hbWVVcmksIG9uU2F2ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc3RhdGljQXJ0aWNsZUVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgbmV3Q2hhcnQgPSBbXSwgbmV3VGFibGUgPSBbXSwgbmV3RXF1YXRpb24gPSBbXSwgbmV3SW1hZ2UgPSBbXSwgbmV3TGlua3MgPSBbXSwgbmV3RmlsZXMgPSBbXTtcbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuICB2YXIgcmVuYW1lVXJpID0gZmFsc2U7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAvLyBNZXRhZGF0YSBsb2FkLCBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIC8vaWYgKCFGbG9yZW5jZS5jb2xsZWN0aW9uLmRhdGUpIHsgICAgICAgICAgICAgICAgICAgICAgICAvL292ZXJ3cml0ZSBzY2hlZHVsZWQgY29sbGVjdGlvbiBkYXRlXG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIC8vZGF0ZVRtcCA9ICQoJyNyZWxlYXNlRGF0ZScpLnZhbCgpO1xuICAgIGRhdGVUbXAgPSBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlO1xuICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cbiAgLy99IGVsc2Uge1xuICAvLyAgICAkKCcucmVsZWFzZS1kYXRlJykuaGlkZSgpO1xuICAvL31cbiAgJChcIiNzdW1tYXJ5XCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnN1bW1hcnkgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUodXBkYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNhdmUob25TYXZlKSB7XG5cbiAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLnBhZ2VQb3MgPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuXG4gICAgLy8gY2hhcnRzXG4gICAgdmFyIG9yZGVyQ2hhcnQgPSAkKFwiI3NvcnRhYmxlLWNoYXJ0XCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckNoYXJ0KS5lYWNoKGZ1bmN0aW9uIChpbmRleENoLCBuYW1lQ2gpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdDaGFydFtpbmRleENoXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLmNoYXJ0cyA9IG5ld0NoYXJ0O1xuICAgIC8vIHRhYmxlc1xuICAgIHZhciBvcmRlclRhYmxlID0gJChcIiNzb3J0YWJsZS10YWJsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJUYWJsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhUYWJsZSwgbmFtZVRhYmxlKSB7XG4gICAgICB2YXIgdXJpID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0udXJpO1xuICAgICAgdmFyIHRpdGxlID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0udGl0bGU7XG4gICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS5maWxlbmFtZTtcbiAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3VGFibGVbaW5kZXhUYWJsZV0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgfSk7XG4gICAgZGF0YS50YWJsZXMgPSBuZXdUYWJsZTtcbiAgICAvLyBlcXVhdGlvbnNcbiAgICB2YXIgb3JkZXJFcXVhdGlvbiA9ICQoXCIjc29ydGFibGUtZXF1YXRpb25cIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRXF1YXRpb24pLmVhY2goZnVuY3Rpb24gKGluZGV4RXF1YXRpb24sIG5hbWVFcXVhdGlvbikge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuZXF1YXRpb25zW3BhcnNlSW50KG5hbWVFcXVhdGlvbildLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuZXF1YXRpb25zW3BhcnNlSW50KG5hbWVFcXVhdGlvbildLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5lcXVhdGlvbnNbcGFyc2VJbnQobmFtZUVxdWF0aW9uKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0VxdWF0aW9uW2luZGV4RXF1YXRpb25dID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuZXF1YXRpb25zID0gbmV3RXF1YXRpb247XG4gICAgLy8gaW1hZ2VzXG4gICAgdmFyIG9yZGVySW1hZ2UgPSAkKFwiI3NvcnRhYmxlLWltYWdlXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckltYWdlKS5lYWNoKGZ1bmN0aW9uIChpbmRleEltYWdlLCBuYW1lSW1hZ2UpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLmltYWdlc1twYXJzZUludChuYW1lSW1hZ2UpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdJbWFnZVtpbmRleEltYWdlXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLmltYWdlcyA9IG5ld0ltYWdlO1xuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLWZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG4gICAgLy8gbGlua3NcbiAgICB2YXIgb3JkZXJMaW5rID0gJChcIiNzb3J0YWJsZS1saW5rXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckxpbmspLmVhY2goZnVuY3Rpb24gKGluZGV4TCwgbmFtZUwpIHtcbiAgICAgIGlmIChkYXRhLmxpbmtzW3BhcnNlSW50KG5hbWVMKV0udGl0bGUpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBkYXRhLmxpbmtzW3BhcnNlSW50KG5hbWVMKV0udGl0bGU7XG4gICAgICAgIHZhciBsaW5rID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnVyaTtcbiAgICAgICAgbmV3TGlua3NbaW5kZXhMXSA9IHt1cmk6IGxpbmssIHRpdGxlOiBuYW1lfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBsaW5rID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnVyaTtcbiAgICAgICAgbmV3TGlua3NbaW5kZXhMXSA9IHt1cmk6IGxpbmt9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGEubGlua3MgPSBuZXdMaW5rcztcblxuICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHN0YXRpY0xhbmRpbmdQYWdlRWRpdG9yKGNvbGxlY3Rpb25JZCwgZGF0YSkge1xuXG4gIHZhciBuZXdTZWN0aW9ucyA9IFtdLCBuZXdMaW5rcyA9IFtdO1xuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gIHZhciByZW5hbWVVcmkgPSBmYWxzZTtcblxuICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgfVxuICB9KTtcblxuICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG5cblxuICAvLyBNZXRhZGF0YSBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc3VtbWFyeVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIja2V5d29yZHNUYWdcIikudGFnaXQoe1xuICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgYWxsb3dTcGFjZXM6IHRydWUsXG4gICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICB9KTtcbiAgJCgnI2tleXdvcmRzJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzID0gJCgnI2tleXdvcmRzJykudmFsKCkuc3BsaXQoJywnKTtcbiAgfSk7XG4gICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuXG4gIC8vIEVkaXQgY29udGVudFxuICAvLyBMb2FkIGFuZCBlZGl0aW9uXG4gICQoZGF0YS5zZWN0aW9ucykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcblxuICAgICQoJyNzZWN0aW9uLXVyaV8nICsgaW5kZXgpLm9uKCdwYXN0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFzdGVkVXJsID0gJCgnI3NlY3Rpb24tdXJpXycgKyBpbmRleCkudmFsKCk7XG4gICAgICAgIHZhciBzYWZlVXJsID0gY2hlY2tQYXRoUGFyc2VkKHBhc3RlZFVybCk7XG4gICAgICAgICQoJyNzZWN0aW9uLXVyaV8nICsgaW5kZXgpLnZhbChzYWZlVXJsKTtcbiAgICAgIH0sIDUwKTtcbiAgICB9KTtcblxuICAgIGlmICghJCgnI3NlY3Rpb24tdXJpXycgKyBpbmRleCkudmFsKCkpIHtcbiAgICAgICQoJzxidXR0b24gY2xhc3M9XCJidG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlld1wiIGlkPVwic2VjdGlvbi1nZXRfJyArIGluZGV4ICsgJ1wiPkdvIHRvPC9idXR0b24+JykuaW5zZXJ0QWZ0ZXIoJyNzZWN0aW9uLXVyaV8nICsgaW5kZXgpO1xuXG4gICAgICAkKCcjc2VjdGlvbi1nZXRfJyArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpZnJhbWVFdmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWUnKS5jb250ZW50V2luZG93O1xuICAgICAgICBpZnJhbWVFdmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIEZsb3JlbmNlLkhhbmRsZXIsIHRydWUpO1xuICAgICAgICBjcmVhdGVXb3Jrc3BhY2UoZGF0YS51cmksIGNvbGxlY3Rpb25JZCwgJycsIG51bGwsIHRydWUpO1xuICAgICAgICAkKCcjc2VjdGlvbi1nZXRfJyArIGluZGV4KS5odG1sKCdDb3B5IGxpbmsnKS5vZmYoKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciB1cmlDaGVjayA9IGdldFBhdGhOYW1lVHJpbUxhc3QoKTtcbiAgICAgICAgICB2YXIgdXJpQ2hlY2tlZCA9IGNoZWNrUGF0aFNsYXNoZXModXJpQ2hlY2spO1xuICAgICAgICAgIGRhdGEuc2VjdGlvbnNbaW5kZXhdLnVyaSA9IHVyaUNoZWNrZWQ7XG4gICAgICAgICAgcHV0Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGluZyBjb21wbGV0ZWQgXCIgKyByZXNwb25zZSk7XG4gICAgICAgICAgICAgIEZsb3JlbmNlLkVkaXRvci5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgIHZpZXdXb3Jrc3BhY2UoZGF0YS51cmksIGNvbGxlY3Rpb25JZCwgJ2VkaXQnKTtcbiAgICAgICAgICAgICAgcmVmcmVzaFByZXZpZXcoZGF0YS51cmkpO1xuICAgICAgICAgICAgICB2YXIgaWZyYW1lRXZlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lJykuY29udGVudFdpbmRvdztcbiAgICAgICAgICAgICAgaWZyYW1lRXZlbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBGbG9yZW5jZS5IYW5kbGVyLCB0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgICQoXCIjc2VjdGlvbi1lZGl0X1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlZGl0ZWRTZWN0aW9uVmFsdWUgPSB7XG4gICAgICAgIFwidGl0bGVcIjogJCgnI3NlY3Rpb24tdGl0bGVfJyArIGluZGV4KS52YWwoKSxcbiAgICAgICAgXCJtYXJrZG93blwiOiAkKFwiI3NlY3Rpb24tbWFya2Rvd25fXCIgKyBpbmRleCkudmFsKClcbiAgICAgIH07XG5cbiAgICAgIHZhciBzYXZlQ29udGVudCA9IGZ1bmN0aW9uICh1cGRhdGVkQ29udGVudCkge1xuICAgICAgICBkYXRhLnNlY3Rpb25zW2luZGV4XS5zdW1tYXJ5ID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgIGRhdGEuc2VjdGlvbnNbaW5kZXhdLnRpdGxlID0gJCgnI3NlY3Rpb24tdGl0bGVfJyArIGluZGV4KS52YWwoKTtcbiAgICAgICAgZGF0YS5zZWN0aW9uc1tpbmRleF0udXJpID0gJCgnI3NlY3Rpb24tdXJpXycgKyBpbmRleCkudmFsKCk7XG4gICAgICAgIHVwZGF0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgfTtcblxuICAgICAgbG9hZE1hcmtkb3duRWRpdG9yKGVkaXRlZFNlY3Rpb25WYWx1ZSwgc2F2ZUNvbnRlbnQsIGRhdGEpO1xuICAgIH0pO1xuXG4gICAgLy8gRGVsZXRlXG4gICAgJChcIiNzZWN0aW9uLWRlbGV0ZV9cIiArIGluZGV4KS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICBzd2FsICh7XG4gICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlP1wiLFxuICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgfSwgZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAkKFwiI1wiICsgaW5kZXgpLnJlbW92ZSgpO1xuICAgICAgICAgIGRhdGEuc2VjdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBzZWN0aW9uIGhhcyBiZWVuIGRlbGV0ZWRcIixcbiAgICAgICAgICAgIHR5cGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAgIC8vIFRvb2x0aXBzXG4gICAgJChmdW5jdGlvbiAoKSB7XG4gICAgICAkKCcjc2VjdGlvbi11cmlfJyArIGluZGV4KS50b29sdGlwKHtcbiAgICAgICAgaXRlbXM6ICcjc2VjdGlvbi11cmlfJyArIGluZGV4LFxuICAgICAgICBjb250ZW50OiAnQ29weSBsaW5rIG9yIGNsaWNrIEdvIHRvLCBuYXZpZ2F0ZSB0byBwYWdlIGFuZCBjbGljayBDb3B5IGxpbmsuIFRoZW4gYWRkIGEgdGl0bGUgYW5kIGNsaWNrIEVkaXQnLFxuICAgICAgICBzaG93OiBcInNsaWRlRG93blwiLCAvLyBzaG93IGltbWVkaWF0ZWx5XG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgICB1aS50b29sdGlwLmhvdmVyKFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAkKHRoaXMpLmZhZGVUbyhcInNsb3dcIiwgMC41KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgICQoZnVuY3Rpb24gKCkge1xuICAgICAgJCgnI3NlY3Rpb24tdGl0bGVfJyArIGluZGV4KS50b29sdGlwKHtcbiAgICAgICAgaXRlbXM6ICcjc2VjdGlvbi10aXRsZV8nICsgaW5kZXgsXG4gICAgICAgIGNvbnRlbnQ6ICdUeXBlIGEgdGl0bGUgYW5kIGNsaWNrIEVkaXQnLFxuICAgICAgICBzaG93OiBcInNsaWRlRG93blwiLCAvLyBzaG93IGltbWVkaWF0ZWx5XG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgICB1aS50b29sdGlwLmhvdmVyKFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAkKHRoaXMpLmZhZGVUbyhcInNsb3dcIiwgMC41KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy9BZGQgbmV3IGNvbnRlbnRcbiAgJChcIiNhZGQtc2VjdGlvblwiKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIHN3YWwgKHtcbiAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgIHRleHQ6IFwiSWYgeW91IGRvIG5vdCBjb21lIGJhY2sgdG8gdGhpcyBwYWdlLCB5b3Ugd2lsbCBsb3NlIGFueSB1bnNhdmVkIGNoYW5nZXNcIixcbiAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiXG4gICAgfSwgZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgIGRhdGEuc2VjdGlvbnMucHVzaCh7dXJpOiBcIlwiLCB0aXRsZTogXCJcIiwgc3VtbWFyeTogXCJcIn0pO1xuICAgICAgICB1cGRhdGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvYWRQYWdlRGF0YUludG9FZGl0b3IoZGF0YS51cmksIGNvbGxlY3Rpb25JZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNvcnRhYmxlQ29udGVudCgpIHtcbiAgICAkKFwiI3NvcnRhYmxlLXNlY3Rpb25cIikuc29ydGFibGUoKTtcbiAgfVxuXG4gIHNvcnRhYmxlQ29udGVudCgpO1xuXG4gIHJlbmRlckV4dGVybmFsTGlua0FjY29yZGlvblNlY3Rpb24oY29sbGVjdGlvbklkLCBkYXRhLCAnbGlua3MnLCAnbGluaycpO1xuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHVwZGF0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyBjb21wbGV0ZWQgdG8gcmV2aWV3XG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLXJldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRDb21wbGV0ZUNvbnRlbnQpO1xuICB9KTtcblxuICAvLyByZXZpZXdlZCB0byBhcHByb3ZlXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZFJldmlld0NvbnRlbnQpO1xuICB9KTtcblxuICBmdW5jdGlvbiBzYXZlKG9uU2F2ZSkge1xuXG4gICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5wYWdlUG9zID0gJChcIi53b3Jrc3BhY2UtZWRpdFwiKS5zY3JvbGxUb3AoKTtcblxuICAgIC8vIFNlY3Rpb25zXG4gICAgdmFyIG9yZGVyU2VjdGlvbiA9ICQoXCIjc29ydGFibGUtc2VjdGlvblwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJTZWN0aW9uKS5lYWNoKGZ1bmN0aW9uIChpbmRleFMsIG5hbWVTKSB7XG4gICAgICB2YXIgc3VtbWFyeSA9IGRhdGEuc2VjdGlvbnNbcGFyc2VJbnQobmFtZVMpXS5zdW1tYXJ5O1xuICAgICAgICAvLyBGaXhlcyB0aXRsZSBvciB1cmkgbm90IHNhdmluZyB1bmxlc3MgbWFya2Rvd24gZWRpdGVkXG4gICAgICAgIHZhciB0aXRsZSA9ICQoJyNzZWN0aW9uLXRpdGxlXycgKyBuYW1lUykudmFsKCk7XG4gICAgICAgIHZhciB1cmkgPSAkKCcjc2VjdGlvbi11cmlfJyArIG5hbWVTKS52YWwoKTtcbiAgICAgIC8vdmFyIHRpdGxlID0gZGF0YS5zZWN0aW9uc1twYXJzZUludChuYW1lUyldLnRpdGxlO1xuICAgICAgLy92YXIgdXJpID0gZGF0YS5zZWN0aW9uc1twYXJzZUludChuYW1lUyldLnVyaTtcbiAgICAgIHZhciB1cmlDaGVja2VkID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3U2VjdGlvbnNbaW5kZXhTXSA9IHt1cmk6IHVyaUNoZWNrZWQsIHRpdGxlOiB0aXRsZSwgc3VtbWFyeTogc3VtbWFyeX07XG4gICAgfSk7XG4gICAgZGF0YS5zZWN0aW9ucyA9IG5ld1NlY3Rpb25zO1xuICAgIC8vIEV4dGVybmFsIGxpbmtzXG4gICAgdmFyIG9yZGVyTGluayA9ICQoXCIjc29ydGFibGUtbGlua1wiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJMaW5rKS5lYWNoKGZ1bmN0aW9uIChpbmRleEwsIG5hbWVMKSB7XG4gICAgICB2YXIgZGlzcGxheVRleHQgPSBkYXRhLmxpbmtzW3BhcnNlSW50KG5hbWVMKV0udGl0bGU7XG4gICAgICB2YXIgbGluayA9ICQoJyNsaW5rLXVyaV8nICsgbmFtZUwpLnZhbCgpO1xuICAgICAgbmV3TGlua3NbaW5kZXhMXSA9IHt1cmk6IGxpbmssIHRpdGxlOiBkaXNwbGF5VGV4dH07XG4gICAgfSk7XG4gICAgZGF0YS5saW5rcyA9IG5ld0xpbmtzO1xuXG4gICAgY2hlY2tSZW5hbWVVcmkoY29sbGVjdGlvbklkLCBkYXRhLCByZW5hbWVVcmksIG9uU2F2ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc3RhdGljUGFnZUVkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgbmV3TGlua3MgPSBbXSwgbmV3RmlsZXMgPSBbXSwgbmV3Q2hhcnQgPSBbXSwgbmV3VGFibGUgPSBbXSwgbmV3SW1hZ2UgPSBbXTtcbiAgdmFyIHNldEFjdGl2ZVRhYiwgZ2V0QWN0aXZlVGFiO1xuICB2YXIgcmVuYW1lVXJpID0gZmFsc2U7XG5cbiAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XG4gICAgc2V0QWN0aXZlVGFiID0gJChcIi5lZGl0LWFjY29yZGlvblwiKS5hY2NvcmRpb24oXCJvcHRpb25cIiwgXCJhY3RpdmVcIik7XG4gICAgaWYgKHNldEFjdGl2ZVRhYiAhPT0gZmFsc2UpIHtcbiAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMuYWN0aXZlVGFiID0gc2V0QWN0aXZlVGFiO1xuICAgIH1cbiAgfSk7XG5cbiAgZ2V0QWN0aXZlVGFiID0gRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWI7XG4gIGFjY29yZGlvbihnZXRBY3RpdmVUYWIpO1xuXG4gICQoXCIjbWV0YWRhdGEtYWRcIikucmVtb3ZlKCk7XG4gICQoXCIjbWV0YWRhdGEtZlwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1tZFwiKS5yZW1vdmUoKTtcbiAgJChcIiNtZXRhZGF0YS1xXCIpLnJlbW92ZSgpO1xuICAkKFwiI2NvbnRhY3QtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNuYXRTdGF0XCIpLnJlbW92ZSgpO1xuICAkKFwiI3N1cnZleS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2ZyZXF1ZW5jeS1wXCIpLnJlbW92ZSgpO1xuICAkKFwiI2NvbXBpbGF0aW9uLXBcIikucmVtb3ZlKCk7XG4gICQoXCIjZ2VvQ292ZXJhZ2UtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNzYW1wbGVTaXplLXBcIikucmVtb3ZlKCk7XG4gICQoXCIubGFzdFJldmlzZWQtcFwiKS5yZW1vdmUoKTtcbiAgJChcIiNyZWZlcmVuY2UtcFwiKS5yZW1vdmUoKTtcblxuICAvLyBNZXRhZGF0YSBlZGl0aW9uIGFuZCBzYXZpbmdcbiAgJChcIiN0aXRsZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmVuYW1lVXJpID0gdHJ1ZTtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLnRpdGxlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIjc3VtbWFyeVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5ID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQodGhpcykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pWzBdLnZhbHVlKS50b0lTT1N0cmluZygpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRhdGVUbXAgPSBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlO1xuICAgIHZhciBkYXRlVG1wRm9ybWF0dGVkID0gJC5kYXRlcGlja2VyLmZvcm1hdERhdGUoJ2RkIE1NIHl5JywgbmV3IERhdGUoZGF0ZVRtcCkpO1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLnZhbChkYXRlVG1wRm9ybWF0dGVkKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgkKCcjcmVsZWFzZURhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJykpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cbiAgJChcIiNrZXl3b3Jkc1RhZ1wiKS50YWdpdCh7XG4gICAgYXZhaWxhYmxlVGFnczogZGF0YS5kZXNjcmlwdGlvbi5rZXl3b3JkcyxcbiAgICBzaW5nbGVGaWVsZDogdHJ1ZSxcbiAgICBhbGxvd1NwYWNlczogdHJ1ZSxcbiAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyNrZXl3b3JkcycpXG4gIH0pO1xuICAkKCcja2V5d29yZHMnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMgPSAkKCcja2V5d29yZHMnKS52YWwoKS5zcGxpdCgnLCcpO1xuICB9KTtcbiAgJChcIiNtZXRhRGVzY3JpcHRpb25cIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24ubWV0YURlc2NyaXB0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG5cbiAgLy8gU2F2ZVxuICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICBlZGl0TmF2Lm9mZigpOyAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGV2ZW50IGhhbmRsZXJzLlxuXG4gIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlJywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUodXBkYXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIHNhdmUoc2F2ZUFuZENvbXBsZXRlQ29udGVudCk7XG4gIH0pO1xuXG4gIC8vIHJldmlld2VkIHRvIGFwcHJvdmVcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItYXBwcm92YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kUmV2aWV3Q29udGVudCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNhdmUob25TYXZlKSB7XG4gICAgLy8gU2VjdGlvbnNcbiAgICBkYXRhLm1hcmtkb3duID0gWyQoJyNjb250ZW50LW1hcmtkb3duJykudmFsKCldO1xuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLWZpbGVcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI2ZpbGUtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kb3dubG9hZHNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuZG93bmxvYWRzID0gbmV3RmlsZXM7XG4gICAgLy8gY2hhcnRzXG4gICAgdmFyIG9yZGVyQ2hhcnQgPSAkKFwiI3NvcnRhYmxlLWNoYXJ0XCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckNoYXJ0KS5lYWNoKGZ1bmN0aW9uIChpbmRleENoLCBuYW1lQ2gpIHtcbiAgICAgIHZhciB1cmkgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS51cmk7XG4gICAgICB2YXIgdGl0bGUgPSBkYXRhLmNoYXJ0c1twYXJzZUludChuYW1lQ2gpXS50aXRsZTtcbiAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuY2hhcnRzW3BhcnNlSW50KG5hbWVDaCldLmZpbGVuYW1lO1xuICAgICAgdmFyIHNhZmVVcmkgPSBjaGVja1BhdGhTbGFzaGVzKHVyaSk7XG4gICAgICBuZXdDaGFydFtpbmRleENoXSA9IHt1cmk6IHNhZmVVcmksIHRpdGxlOiB0aXRsZSwgZmlsZW5hbWU6IGZpbGVuYW1lfTtcbiAgICB9KTtcbiAgICBkYXRhLmNoYXJ0cyA9IG5ld0NoYXJ0O1xuICAgIC8vIHRhYmxlc1xuICAgIHZhciBvcmRlclRhYmxlID0gJChcIiNzb3J0YWJsZS10YWJsZVwiKS5zb3J0YWJsZSgndG9BcnJheScpO1xuICAgICQob3JkZXJUYWJsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhUYWJsZSwgbmFtZVRhYmxlKSB7XG4gICAgICB2YXIgdXJpID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0udXJpO1xuICAgICAgdmFyIHRpdGxlID0gZGF0YS50YWJsZXNbcGFyc2VJbnQobmFtZVRhYmxlKV0udGl0bGU7XG4gICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLnRhYmxlc1twYXJzZUludChuYW1lVGFibGUpXS5maWxlbmFtZTtcbiAgICAgIHZhciBzYWZlVXJpID0gY2hlY2tQYXRoU2xhc2hlcyh1cmkpO1xuICAgICAgbmV3VGFibGVbaW5kZXhUYWJsZV0gPSB7dXJpOiBzYWZlVXJpLCB0aXRsZTogdGl0bGUsIGZpbGVuYW1lOiBmaWxlbmFtZX07XG4gICAgfSk7XG4gICAgZGF0YS50YWJsZXMgPSBuZXdUYWJsZTtcbiAgICAvLyBpbWFnZXNcbiAgICB2YXIgb3JkZXJJbWFnZSA9ICQoXCIjc29ydGFibGUtaW1hZ2VcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVySW1hZ2UpLmVhY2goZnVuY3Rpb24gKGluZGV4SW1hZ2UsIG5hbWVJbWFnZSkge1xuICAgICAgdmFyIHVyaSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnVyaTtcbiAgICAgIHZhciB0aXRsZSA9IGRhdGEuaW1hZ2VzW3BhcnNlSW50KG5hbWVJbWFnZSldLnRpdGxlO1xuICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5pbWFnZXNbcGFyc2VJbnQobmFtZUltYWdlKV0uZmlsZW5hbWU7XG4gICAgICB2YXIgc2FmZVVyaSA9IGNoZWNrUGF0aFNsYXNoZXModXJpKTtcbiAgICAgIG5ld0ltYWdlW2luZGV4SW1hZ2VdID0ge3VyaTogc2FmZVVyaSwgdGl0bGU6IHRpdGxlLCBmaWxlbmFtZTogZmlsZW5hbWV9O1xuICAgIH0pO1xuICAgIGRhdGEuaW1hZ2VzID0gbmV3SW1hZ2U7XG4gICAgLy8gbGlua3NcbiAgICB2YXIgb3JkZXJMaW5rID0gJChcIiNzb3J0YWJsZS1saW5rXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckxpbmspLmVhY2goZnVuY3Rpb24gKGluZGV4TCwgbmFtZUwpIHtcbiAgICAgIGlmIChkYXRhLmxpbmtzW3BhcnNlSW50KG5hbWVMKV0udGl0bGUpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBkYXRhLmxpbmtzW3BhcnNlSW50KG5hbWVMKV0udGl0bGU7XG4gICAgICAgIHZhciBsaW5rID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnVyaTtcbiAgICAgICAgbmV3TGlua3NbaW5kZXhMXSA9IHt1cmk6IGxpbmssIHRpdGxlOiBuYW1lfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBsaW5rID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnVyaTtcbiAgICAgICAgbmV3TGlua3NbaW5kZXhMXSA9IHt1cmk6IGxpbmt9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRhdGEubGlua3MgPSBuZXdMaW5rcztcblxuICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRhdGFzZXRFZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG5cbiAgdmFyIG5ld0ZpbGVzID0gW107XG4gIHZhciBzZXRBY3RpdmVUYWIsIGdldEFjdGl2ZVRhYjtcbiAgdmFyIHBhcmVudFVybCA9IGdldFBhcmVudFBhZ2UoZGF0YS51cmkpO1xuXG4gIC8vQWRkIHBhcmVudCBsaW5rIG9udG8gcGFnZVxuICBsb2FkUGFyZW50TGluayhjb2xsZWN0aW9uSWQsIGRhdGEsIHBhcmVudFVybCk7XG5cblxuICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgfVxuICB9KTtcblxuICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG4gIGdldExhc3RQb3NpdGlvbigpO1xuXG4gIC8vIFNhdmVcbiAgdmFyIGVkaXROYXYgPSAkKCcuZWRpdC1uYXYnKTtcbiAgZWRpdE5hdi5vZmYoKTsgLy8gcmVtb3ZlIGFueSBleGlzdGluZyBldmVudCBoYW5kbGVycy5cblxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKCk7XG4gICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gIH0pO1xuXG4gIC8vIGNvbXBsZXRlZCB0byByZXZpZXdcbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIC8vcGFnZURhdGEgPSAkKCcuZmwtZWRpdG9yX19oZWFkbGluZScpLnZhbCgpO1xuICAgIHNhdmUoKTtcbiAgICBzYXZlQW5kQ29tcGxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLCBmYWxzZSwgcGFyZW50VXJsKTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKCk7XG4gICAgc2F2ZUFuZFJldmlld0NvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIGZhbHNlLCBwYXJlbnRVcmwpO1xuICB9KTtcblxuICBmdW5jdGlvbiBzYXZlKCkge1xuICAgIC8vIEZpbGVzIGFyZSB1cGxvYWRlZC4gU2F2ZSBtZXRhZGF0YVxuICAgIHZhciBvcmRlckZpbGUgPSAkKFwiI3NvcnRhYmxlLXN1cHBsZW1lbnRhcnktZmlsZXNcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyRmlsZSkuZWFjaChmdW5jdGlvbiAoaW5kZXhGLCBuYW1lRikge1xuICAgICAgdmFyIHRpdGxlID0gJCgnI3N1cHBsZW1lbnRhcnktZmlsZXMtdGl0bGVfJyArIG5hbWVGKS52YWwoKTtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5zdXBwbGVtZW50YXJ5RmlsZXNbcGFyc2VJbnQobmFtZUYpXS5maWxlO1xuICAgICAgbmV3RmlsZXNbaW5kZXhGXSA9IHt0aXRsZTogdGl0bGUsIGZpbGU6IGZpbGV9O1xuICAgIH0pO1xuICAgIGRhdGEuc3VwcGxlbWVudGFyeUZpbGVzID0gbmV3RmlsZXM7XG4gICAgLy8gTm90ZXNcbiAgICBkYXRhLnNlY3Rpb24gPSB7bWFya2Rvd246ICQoJyNvbmUtbWFya2Rvd24nKS52YWwoKX07XG4gIH1cbn1mdW5jdGlvbiBkYXRhc2V0TGFuZGluZ0VkaXRvcihjb2xsZWN0aW9uSWQsIGRhdGEpIHtcblxuICB2YXIgbmV3RGF0YXNldHMgPSBbXSwgbmV3TGlua3MgPSBbXSwgbmV3UmVsYXRlZERvY3VtZW50cyA9IFtdLCBuZXdSZWxhdGVkUW1pID0gW10sIG5ld1JlbGF0ZWRNZXRob2RvbG9neSA9IFtdO1xuICB2YXIgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG4gIHZhciByZW5hbWVVcmkgPSBmYWxzZTtcblxuICAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLm9uKCdhY2NvcmRpb25hY3RpdmF0ZScsIGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICBzZXRBY3RpdmVUYWIgPSAkKFwiLmVkaXQtYWNjb3JkaW9uXCIpLmFjY29yZGlvbihcIm9wdGlvblwiLCBcImFjdGl2ZVwiKTtcbiAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgfVxuICB9KTtcblxuICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgYWNjb3JkaW9uKGdldEFjdGl2ZVRhYik7XG4gIGdldExhc3RQb3NpdGlvbigpO1xuXG4gIHJlc29sdmVUaXRsZVQ4KGNvbGxlY3Rpb25JZCwgZGF0YSwgJ2RhdGFzZXRzJyk7XG5cbiAgLy8gTWV0YWRhdGEgZWRpdGlvbiBhbmQgc2F2aW5nXG4gICQoXCIjdGl0bGVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgIHJlbmFtZVVyaSA9IHRydWU7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi50aXRsZSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI3N1bW1hcnlcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uc3VtbWFyeSA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAvL2lmICghRmxvcmVuY2UuY29sbGVjdGlvbi5kYXRlKSB7ICAgICAgICAgICAgICAgICAgICAgIC8vb3ZlcndyaXRlIHNjaGVkdWxlZCBjb2xsZWN0aW9uIGRhdGVcbiAgaWYgKCFkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlKSB7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkIE1NIHl5J30pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlID0gbmV3IERhdGUoJCh0aGlzKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQgTU0geXknfSlbMF0udmFsdWUpLnRvSVNPU3RyaW5nKCk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0ZVRtcCA9IGRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGU7XG4gICAgdmFyIGRhdGVUbXBGb3JtYXR0ZWQgPSAkLmRhdGVwaWNrZXIuZm9ybWF0RGF0ZSgnZGQgTU0geXknLCBuZXcgRGF0ZShkYXRlVG1wKSk7XG4gICAgJCgnI3JlbGVhc2VEYXRlJykudmFsKGRhdGVUbXBGb3JtYXR0ZWQpLmRhdGVwaWNrZXIoe2RhdGVGb3JtYXQ6ICdkZCBNTSB5eSd9KS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGF0YS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSA9IG5ldyBEYXRlKCQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSkudG9JU09TdHJpbmcoKTtcbiAgICB9KTtcbiAgfVxuICAvL30gZWxzZSB7XG4gIC8vICAgICQoJy5yZWxlYXNlLWRhdGUnKS5oaWRlKCk7XG4gIC8vfVxuICAkKFwiI25leHRSZWxlYXNlXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5leHRSZWxlYXNlID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gIGlmICghZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0KSB7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0ID0ge307XG4gIH1cbiAgJChcIiNjb250YWN0TmFtZVwiKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS50ZXh0YXJlYUF1dG9TaXplKCk7XG4gICAgZGF0YS5kZXNjcmlwdGlvbi5jb250YWN0Lm5hbWUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNjb250YWN0RW1haWxcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5lbWFpbCA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuICAkKFwiI2NvbnRhY3RUZWxlcGhvbmVcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmUgPSAkKHRoaXMpLnZhbCgpO1xuICB9KTtcbiAgJChcIiNkYXRhc2V0SWRcIikub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudGV4dGFyZWFBdXRvU2l6ZSgpO1xuICAgIGRhdGEuZGVzY3JpcHRpb24uZGF0YXNldElkID0gJCh0aGlzKS52YWwoKTtcbiAgfSk7XG4gICQoXCIja2V5d29yZHNUYWdcIikudGFnaXQoe1xuICAgIGF2YWlsYWJsZVRhZ3M6IGRhdGEuZGVzY3JpcHRpb24ua2V5d29yZHMsXG4gICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgYWxsb3dTcGFjZXM6IHRydWUsXG4gICAgc2luZ2xlRmllbGROb2RlOiAkKCcja2V5d29yZHMnKVxuICB9KTtcbiAgJCgnI2tleXdvcmRzJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzID0gJCgnI2tleXdvcmRzJykudmFsKCkuc3BsaXQoJywnKTtcbiAgfSk7XG4gICQoXCIjbWV0YURlc2NyaXB0aW9uXCIpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnRleHRhcmVhQXV0b1NpemUoKTtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9ICQodGhpcykudmFsKCk7XG4gIH0pO1xuXG4gIC8qIFRoZSBjaGVja2VkIGF0dHJpYnV0ZSBpcyBhIGJvb2xlYW4gYXR0cmlidXRlLCB3aGljaCBtZWFucyB0aGUgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBpcyB0cnVlIGlmIHRoZSBhdHRyaWJ1dGVcbiAgIGlzIHByZXNlbnQgYXQgYWxs4oCUZXZlbiBpZiwgZm9yIGV4YW1wbGUsIHRoZSBhdHRyaWJ1dGUgaGFzIG5vIHZhbHVlIG9yIGlzIHNldCB0byBlbXB0eSBzdHJpbmcgdmFsdWUgb3IgZXZlbiBcImZhbHNlXCIgKi9cbiAgdmFyIGNoZWNrQm94U3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID09PSBcImZhbHNlXCIgfHwgZGF0YS5kZXNjcmlwdGlvbi5uYXRpb25hbFN0YXRpc3RpYyA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuICAkKFwiI21ldGFkYXRhLWxpc3QgaW5wdXRbdHlwZT0nY2hlY2tib3gnXVwiKS5wcm9wKCdjaGVja2VkJywgY2hlY2tCb3hTdGF0dXMpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICBkYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gJChcIiNtZXRhZGF0YS1saXN0IGlucHV0W3R5cGU9J2NoZWNrYm94J11cIikucHJvcCgnY2hlY2tlZCcpID8gdHJ1ZSA6IGZhbHNlO1xuICB9KTtcblxuICAvLyBTYXZlXG4gIHZhciBlZGl0TmF2ID0gJCgnLmVkaXQtbmF2Jyk7XG4gIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZSh1cGRhdGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gY29tcGxldGVkIHRvIHJldmlld1xuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1yZXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2F2ZShzYXZlQW5kQ29tcGxldGVDb250ZW50KTtcbiAgfSk7XG5cbiAgLy8gcmV2aWV3ZWQgdG8gYXBwcm92ZVxuICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZS1hbmQtc3VibWl0LWZvci1hcHByb3ZhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzYXZlKHNhdmVBbmRSZXZpZXdDb250ZW50KTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gc2F2ZShvblNhdmUpIHtcblxuICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9ICQoXCIud29ya3NwYWNlLWVkaXRcIikuc2Nyb2xsVG9wKCk7XG5cbiAgICAvLyBEYXRhc2V0cyBhcmUgdXBsb2FkZWQuIFNhdmUgbWV0YWRhdGFcbiAgICB2YXIgb3JkZXJEYXRhc2V0ID0gJChcIiNzb3J0YWJsZS1lZGl0aW9uXCIpLnNvcnRhYmxlKCd0b0FycmF5Jyk7XG4gICAgJChvcmRlckRhdGFzZXQpLmVhY2goZnVuY3Rpb24gKGluZGV4RiwgbmFtZUYpIHtcbiAgICAgIHZhciBmaWxlID0gZGF0YS5kYXRhc2V0c1twYXJzZUludChuYW1lRildLnVyaTtcbiAgICAgIG5ld0RhdGFzZXRzW2luZGV4Rl0gPSB7dXJpOiBmaWxlfTtcbiAgICB9KTtcbiAgICBkYXRhLmRhdGFzZXRzID0gbmV3RGF0YXNldHM7XG5cbiAgICAvLyBsaW5rc1xuICAgIHZhciBvcmRlckxpbmsgPSAkKFwiI3NvcnRhYmxlLWxpbmtcIikuc29ydGFibGUoJ3RvQXJyYXknKTtcbiAgICAkKG9yZGVyTGluaykuZWFjaChmdW5jdGlvbiAoaW5kZXhMLCBuYW1lTCkge1xuICAgICAgdmFyIGRpc3BsYXlUZXh0ID0gZGF0YS5saW5rc1twYXJzZUludChuYW1lTCldLnRpdGxlO1xuICAgICAgdmFyIGxpbmsgPSAkKCcjbGluay11cmlfJyArIG5hbWVMKS52YWwoKTtcbiAgICAgIG5ld0xpbmtzW2luZGV4TF0gPSB7dXJpOiBsaW5rLCB0aXRsZTogZGlzcGxheVRleHR9O1xuICAgIH0pO1xuICAgIGRhdGEubGlua3MgPSBuZXdMaW5rcztcblxuICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgZGF0YSwgcmVuYW1lVXJpLCBvblNhdmUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVUaXRsZVQ4KGNvbGxlY3Rpb25JZCwgZGF0YSwgZmllbGQpIHtcbiAgdmFyIGFqYXhSZXF1ZXN0ID0gW107XG4gIHZhciB0ZW1wbGF0ZURhdGEgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGF0YSk7XG4gICQodGVtcGxhdGVEYXRhW2ZpZWxkXSkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBhdGgpIHtcbiAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbiA9IHt9O1xuICAgIHZhciBlYWNoVXJpID0gcGF0aC51cmk7XG4gICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBnZXRQYWdlRGF0YVRpdGxlKGNvbGxlY3Rpb25JZCwgZWFjaFVyaSxcbiAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB0ZW1wbGF0ZURhdGFbZmllbGRdW2luZGV4XS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gcmVzcG9uc2UuZWRpdGlvbjtcbiAgICAgICAgdGVtcGxhdGVEYXRhW2ZpZWxkXVtpbmRleF0udXJpID0gZWFjaFVyaTtcbiAgICAgICAgZGZkLnJlc29sdmUoKTtcbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJFcnJvclwiLCBmaWVsZCArICcgYWRkcmVzczogJyArIGVhY2hVcmkgKyAnIGlzIG5vdCBmb3VuZC4nLCBcImVycm9yXCIpO1xuICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgfVxuICAgICk7XG4gICAgYWpheFJlcXVlc3QucHVzaChkZmQpO1xuICB9KTtcblxuICAkLndoZW4uYXBwbHkoJCwgYWpheFJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBkYXRhVGVtcGxhdGUgPSB0ZW1wbGF0ZURhdGFbZmllbGRdO1xuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLndvcmtFZGl0VDhMYW5kaW5nRGF0YXNldExpc3QoZGF0YVRlbXBsYXRlKTtcbiAgICAkKCcjZWRpdGlvbicpLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAgIGFkZEVkaXRpb25FZGl0QnV0dG9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGFkZEVkaXRpb25FZGl0QnV0dG9uKGNvbGxlY3Rpb25JZCwgZGF0YSwgdGVtcGxhdGVEYXRhKSB7XG4gIC8vIExvYWQgZGF0YXNldCB0byBlZGl0XG4gICQodGVtcGxhdGVEYXRhLmRhdGFzZXRzKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgIC8vb3BlbiBkb2N1bWVudFxuICAgICQoXCIjZWRpdGlvbi1lZGl0X1wiICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzZWxlY3RlZEVkaXRpb24gPSBkYXRhLmRhdGFzZXRzW2luZGV4XS51cmk7XG4gICAgICBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYiA9ICcnO1xuICAgICAgY3JlYXRlV29ya3NwYWNlKHNlbGVjdGVkRWRpdGlvbiwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgIH0pO1xuXG4gICAgJCgnI2VkaXRpb24tZWRpdC1sYWJlbF8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzZWxlY3RlZEVkaXRpb24gPSBkYXRhLmRhdGFzZXRzW2luZGV4XS51cmk7XG4gICAgICBnZXRQYWdlRGF0YShjb2xsZWN0aW9uSWQsIHNlbGVjdGVkRWRpdGlvbixcbiAgICAgICAgZnVuY3Rpb24gKHBhZ2VEYXRhKSB7XG4gICAgICAgICAgdmFyIG1hcmtkb3duID0gcGFnZURhdGEuZGVzY3JpcHRpb24uZWRpdGlvbjtcbiAgICAgICAgICB2YXIgZWRpdGVkU2VjdGlvblZhbHVlID0ge3RpdGxlOiAnRWRpdGlvbiB0aXRsZScsIG1hcmtkb3duOiBtYXJrZG93bn07XG4gICAgICAgICAgdmFyIHNhdmVDb250ZW50ID0gZnVuY3Rpb24gKHVwZGF0ZWRDb250ZW50KSB7XG4gICAgICAgICAgICBwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uID0gdXBkYXRlZENvbnRlbnQ7XG4gICAgICAgICAgICB2YXIgY2hpbGRUaXRsZSA9IHVwZGF0ZWRDb250ZW50LnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgcGFnZURhdGEudXJpLCBKU09OLnN0cmluZ2lmeShwYWdlRGF0YSksXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvL3NhdmUgY2hpbGRyZW4gY2hhbmdlcyBhbmQgbW92ZVxuICAgICAgICAgICAgICAgIGNoZWNrUmVuYW1lVXJpKGNvbGxlY3Rpb25JZCwgcGFnZURhdGEsIHRydWUsIHVwZGF0ZUNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIC8vdXBkYXRlIGRhdGFzZXQgdXJpIGluIHBhcmVudCBhbmQgc2F2ZVxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YXNldHNbaW5kZXhdLnVyaSA9IGRhdGEudXJpICsgXCIvXCIgKyBjaGlsZFRpdGxlO1xuICAgICAgICAgICAgICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBkYXRhLnVyaSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7fSxcbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiQ2Fubm90IGVkaXQgdGhpcyBwYWdlXCIsIFwiSXQgaXMgYWxyZWFkeSBwYXJ0IG9mIGFub3RoZXIgY29sbGVjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIkNhbm5vdCBlZGl0IHRoaXMgcGFnZVwiLCBcIkl0IGlzIGFscmVhZHkgcGFydCBvZiBhbm90aGVyIGNvbGxlY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGxvYWRNYXJrZG93bkVkaXRvcihlZGl0ZWRTZWN0aW9uVmFsdWUsIHNhdmVDb250ZW50LCBwYWdlRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgaGFuZGxlQXBpRXJyb3IobWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBEZWxldGUgKGFzc3VtaW5nIGRhdGFzZXRzIGluIG1ha2VFZGl0U2VjdGlvbiAtIG5vdCBkeW5hbWljIGZpZWxkcyBoZXJlKVxuICAgICQoJyNlZGl0aW9uLWRlbGV0ZV8nICsgaW5kZXgpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIHN3YWwoe1xuICAgICAgICB0aXRsZTogXCJXYXJuaW5nXCIsXG4gICAgICAgIHRleHQ6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIGVkaXRpb24/XCIsXG4gICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZWRcIixcbiAgICAgICAgICAgIHRleHQ6IFwiVGhpcyBlZGl0aW9uIGhhcyBiZWVuIGRlbGV0ZWRcIixcbiAgICAgICAgICAgIHR5cGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgdGltZXI6IDIwMDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2YXIgcG9zaXRpb24gPSAkKFwiLndvcmtzcGFjZS1lZGl0XCIpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBvcyA9IHBvc2l0aW9uO1xuICAgICAgICAgICQoJyNlZGl0aW9uLWRlbGV0ZV8nICsgaW5kZXgpLnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvY29udGVudC9cIiArIGNvbGxlY3Rpb25JZCArIFwiP3VyaT1cIiArIGRhdGEuZGF0YXNldHNbaW5kZXhdLnVyaSxcbiAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkYXRhLmRhdGFzZXRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgdXBkYXRlQ29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBmdW5jdGlvbiBzb3J0YWJsZVNlY3Rpb25zKCkge1xuICAgICQoXCIjc29ydGFibGUtZWRpdGlvblwiKS5zb3J0YWJsZSgpO1xuICB9XG5cbiAgc29ydGFibGVTZWN0aW9ucygpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2Zlcihzb3VyY2UsIGRlc3RpbmF0aW9uLCB1cmkpIHtcbiAgdmFyIHRyYW5zZmVyUmVxdWVzdCA9IHtcbiAgICBzb3VyY2U6IHNvdXJjZSxcbiAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sXG4gICAgdXJpOiB1cmlcbiAgfTtcbiAgJC5hamF4KHtcbiAgICB1cmw6IFwiL3plYmVkZWUvdHJhbnNmZXJcIixcbiAgICB0eXBlOiBcIlBPU1RcIixcbiAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh0cmFuc2ZlclJlcXVlc3QpLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgY29uc29sZS5sb2coJyBmaWxlIGhhcyBiZWVuIG1vdmVkJyk7XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyb3IgbW92aW5nIGZpbGUnKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0cmVlTm9kZVNlbGVjdCh1cmwpIHtcbiAgICB2YXIgdXJsUGFydCA9IHVybC5yZXBsYWNlKEZsb3JlbmNlLmJhYmJhZ2VCYXNlVXJsLCAnJyk7XG5cbiAgICAvLyBCRUlORyBSRU1PVkVEIEJFQ0FVU0UgQkFCQkFHRSBJUyBOT1cgUkVOREVSSU5HIFNBTUUgQVMgTk9STUFMIFBBR0UgLSBSZW1vdmUgdGhlIHRyYWlsaW5nIHNsYXNoIG9uIHZpc3VhbGlzYXRpb25zIHNvIHRoZSBub2RlIHNlbGVjdCB3b3JrcyBhcyBleHBlY3RlZCAodW5sZXNzIGF0IHJvb3QpXG4gICAgLy8gaWYgKHVybFBhcnQgIT09ICcvJykge1xuICAgIC8vICAgICB1cmxQYXJ0ID0gdXJsUGFydC5yZXBsYWNlKC9cXC8rJC8sICcnKTtcbiAgICAvLyB9XG5cbiAgICB2YXIgJHNlbGVjdGVkTGlzdEl0ZW0gPSAkKCdbZGF0YS11cmw9XCInICsgdXJsUGFydCArICdcIl0nKTsgLy9nZXQgZmlyc3QgbGkgd2l0aCBkYXRhLXVybCB3aXRoIHVybFxuICAgICQoJy5qcy1icm93c2VfX2l0ZW0uc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAkc2VsZWN0ZWRMaXN0SXRlbS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgIC8vIEhpZGUgY29udGFpbmVyIGZvciBpdGVtIGFuZCBidXR0b25zIGZvciBwcmV2aW91cyBhbmQgc2hvdyBzZWxlY3RlZCBvbmVcbiAgICAkKCcucGFnZV9fY29udGFpbmVyLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgJHNlbGVjdGVkTGlzdEl0ZW0uZmluZCgnLnBhZ2VfX2NvbnRhaW5lcjpmaXJzdCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgLy8gSGlkZSBwcmV2aW91cyBkaXNwbGF5ZWQgcGFnZSBidXR0b25zIGFuZCBzaG93IHNlbGVjdGVkIG9uZVxuICAgIGlmICgkc2VsZWN0ZWRMaXN0SXRlbS5maW5kKCcucGFnZV9fYnV0dG9uczpmaXJzdCcpKSB7XG4gICAgICAgICQoJy5wYWdlX19idXR0b25zLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICRzZWxlY3RlZExpc3RJdGVtLmZpbmQoJy5wYWdlX19idXR0b25zOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgfVxuXG4gICAgLy9wYWdlLWxpc3QtdHJlZVxuICAgICQoJy50cmVlLW5hdi1ob2xkZXIgdWwnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgJHNlbGVjdGVkTGlzdEl0ZW0ucGFyZW50cygndWwnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgJHNlbGVjdGVkTGlzdEl0ZW0uY2xvc2VzdCgnbGknKS5jaGlsZHJlbigndWwnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAvLyBVcGRhdGUgYnJvd3NlIHRyZWUgc2Nyb2xsIHBvc2l0aW9uXG4gICAgYnJvd3NlU2Nyb2xsUG9zKCk7XG5cbiAgICAvLyBPcGVuIGFjdGl2ZSBkaXJlY3Rvcmllc1xuICAgIHNlbGVjdFBhcmVudERpcmVjdG9yaWVzKCRzZWxlY3RlZExpc3RJdGVtKTtcbn1cbi8qXG4qICAgRnVuY3Rpb24gdGhhdCBhcmUgYXBwbGllZCBqdXN0IHRvIFVJL3N0eWxpbmcgYW5kIGFyZW4ndCBzcGVjaWZpYyB0byBjZXJ0YWluIHNjcmVlbnMgb3IgZnVuY3Rpb25zXG4gKi9cblxudmFyICRkZWxlZ2F0ZWRTZWxlY3RvciA9ICQoJyNtYWluJyk7IC8vIFRoaXMgc2hvdWxkIGJlIHRoZSBoaWdoZXN0IHBvaW50IGV2ZW50IGhhbmRsZXJzIGFyZSBkZWxlZ2F0ZWQgdXAgdG9cblxuLy8gQWRkIGZvY3VzIHN0eWxpbmcgdG8gc2VsZWN0c1xudmFyICRjbG9zZXN0V3JhcDtcbiRkZWxlZ2F0ZWRTZWxlY3Rvci5vbignZm9jdXMnLCAnLnNlbGVjdC13cmFwIHNlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAkY2xvc2VzdFdyYXAgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcuc2VsZWN0LXdyYXAnKTtcbiAgICAkY2xvc2VzdFdyYXAudG9nZ2xlQ2xhc3MoJ3NlbGVjdC13cmFwLS1mb2N1cycpO1xufSk7XG5cbiRkZWxlZ2F0ZWRTZWxlY3Rvci5vbignZm9jdXNvdXQnLCAnLnNlbGVjdC13cmFwIHNlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAkY2xvc2VzdFdyYXAudG9nZ2xlQ2xhc3MoJ3NlbGVjdC13cmFwLS1mb2N1cycpO1xufSk7XG5cbi8vIEZ1bmN0aW9uIHRvIGFkZCBsb2FkaW5nIGljb24gdG8gYSBidXR0b25cbmZ1bmN0aW9uIGxvYWRpbmdCdG4oc2VsZWN0b3IpIHtcbiAgICB2YXIgbG9hZGluZ0hUTUwgPSAkKHRlbXBsYXRlcy5sb2FkaW5nQW5pbWF0aW9uKCkpLmNzcygndG9wJywgJy0zcHgnKTsgLy8gLTNweCB0byBnZXQgYW5pbWF0aW9uIGluIGNlbnRyZSBvZiBidXR0b25cblxuICAgIHNlbGVjdG9yXG4gICAgICAgIC53aWR0aChzZWxlY3Rvci53aWR0aCgpKS5oZWlnaHQoc2VsZWN0b3IuaGVpZ2h0KCkpIC8vIG1ha2UgYnRuIGtlZXAgd2lkdGggJiBoZWlnaHQgd2l0aCBsb2FkaW5nIGljb25cbiAgICAgICAgLmVtcHR5KCkgLy8gcmVtb3ZlIGJ1dHRvbiB0ZXh0XG4gICAgICAgIC5hcHBlbmQobG9hZGluZ0hUTUwpOyAvLyBMb2FkIGxvYWRpbmcgYW5pbWF0aW9uIHRlbXBsYXRlIGludG8gYnV0dG9uXG59ZnVuY3Rpb24gdWlUaWR5VXAoKSB7XG5cdC8vd3JhcCBzZWxlY3RzIHdpdGggPGRpdiBjbGFzcz1cInNlbGVjdC13cmFwXCI+XG5cdC8vICQoJ3NlbGVjdCcpLndyYXAoJzxzcGFuIGNsYXNzPVwic2VsZWN0LXdyYXBcIj48L3NwYW4+Jyk7XG5cdGNvbnNvbGUubG9nKCd1aVRpZHl1cCcpO1xuXHQkKGZ1bmN0aW9uKCkge1xuIFxuICAgICQoICdzZWxlY3QnIClcbiAgICAgIC5zZWxlY3RtZW51KClcbiAgICAgIC5zZWxlY3RtZW51KCBcIm1lbnVXaWRnZXRcIiApXG4gICAgICAgIC5hZGRDbGFzcyggXCJvdmVyZmxvd1wiICk7XG4gIH0pO1xufWZ1bmN0aW9uIHVwZGF0ZUNvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50LCByZWRpcmVjdFRvUGF0aCkge1xuICAgIHB1dENvbnRlbnQoY29sbGVjdGlvbklkLCBwYXRoLCBjb250ZW50LFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgRmxvcmVuY2UuRWRpdG9yLmlzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChyZWRpcmVjdFRvUGF0aCkge1xuICAgICAgICAgICAgICAgIGNyZWF0ZVdvcmtzcGFjZShyZWRpcmVjdFRvUGF0aCwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9jcmVhdGVXb3Jrc3BhY2UocGF0aCwgY29sbGVjdGlvbklkLCAnZWRpdCcpO1xuICAgICAgICAgICAgICAgIHJlZnJlc2hQcmV2aWV3KHBhdGgpO1xuICAgICAgICAgICAgICAgIGxvYWRQYWdlRGF0YUludG9FZGl0b3IocGF0aCwgY29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cbi8qKlxuICogU2hvdyB0aGUgY2hhbmdlIHBhc3N3b3JkIHNjcmVlbiB0byBjaGFuZ2UgdGhlIHBhc3N3b3JkIGZvciB0aGUgZ2l2ZW4gZW1haWwuXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlciB0byBjaGFuZ2UgdGhlIHBhc3N3b3JkIGZvci5cbiAqIEBwYXJhbSBhdXRoZW50aWNhdGUgLSB0cnVlIGlmIHRoZSBleGlzdGluZyBwYXNzd29yZCBmb3IgdGhlIHVzZXIgbmVlZHMgdG8gYmUgZW50ZXJlZC5cbiAqL1xuZnVuY3Rpb24gdmlld0NoYW5nZVBhc3N3b3JkKGVtYWlsLCBhdXRoZW50aWNhdGUpIHtcblxuICB2YXIgdmlld01vZGVsID0ge1xuICAgIGF1dGhlbnRpY2F0ZTogYXV0aGVudGljYXRlXG4gIH07XG4gIFxuICAkKCdib2R5JykuYXBwZW5kKHRlbXBsYXRlcy5jaGFuZ2VQYXNzd29yZCh2aWV3TW9kZWwpKTtcblxuICAkKCcuY2hhbmdlLXBhc3N3b3JkLW92ZXJsYXlfX2lubmVyIGlucHV0OmZpcnN0JykuZm9jdXMoKTsgLy8gUHV0IGZvY3VzIG9uIGZpcnN0IGlucHV0XG5cbiAgJCgnI3VwZGF0ZS1wYXNzd29yZCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgb2xkUGFzc3dvcmQgPSAkKCcjcGFzc3dvcmQtb2xkJykudmFsKCk7XG4gICAgdmFyIG5ld1Bhc3N3b3JkID0gJCgnI3Bhc3N3b3JkLW5ldycpLnZhbCgpO1xuICAgIHZhciBjb25maXJtUGFzc3dvcmQgPSAkKCcjcGFzc3dvcmQtY29uZmlybScpLnZhbCgpO1xuXG4gICAgaWYobmV3UGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZCkge1xuICAgICAgc3dlZXRBbGVydCgnVGhlIHBhc3NwaHJhc2VzIHByb3ZpZGVkIGRvIG5vdCBtYXRjaCcsICdQbGVhc2UgZW50ZXIgdGhlIG5ldyBwYXNzcGhyYXNlIGFnYWluIGFuZCBjb25maXJtIGl0LicpO1xuICAgIH0gZWxzZSBpZighbmV3UGFzc3dvcmQubWF0Y2goLy4rXFxzLitcXHMuK1xccy4rLykpIHtcbiAgICAgIHN3ZWV0QWxlcnQoJ1RoZSBwYXNzcGhyYXNlIGRvZXMgbm90IGhhdmUgZm91ciB3b3JkcycsICdQbGVhc2UgZW50ZXIgYSBuZXcgcGFzc3BocmFzZSBhbmQgY29uZmlybSBpdC4nKTtcbiAgICB9IGVsc2UgaWYobmV3UGFzc3dvcmQubGVuZ3RoIDwgMTUpIHtcbiAgICAgIHN3ZWV0QWxlcnQoJ1RoZSBwYXNzcGhyYXNlIGlzIHRvbyBzaG9ydCcsICdQbGVhc2UgbWFrZSBzdXJlIGl0IGhhcyBhdCBsZWFzdCAxNSBjaGFyYWN0ZXJzIChpbmNsdWRpbmcgc3BhY2VzKS4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3VibWl0TmV3UGFzc3dvcmQobmV3UGFzc3dvcmQsIG9sZFBhc3N3b3JkKTtcbiAgICB9XG4gIH0pO1xuXG4gICQoJyN1cGRhdGUtcGFzc3dvcmQtY2FuY2VsJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQoJy5jaGFuZ2UtcGFzc3dvcmQtb3ZlcmxheScpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHN1Ym1pdE5ld1Bhc3N3b3JkKG5ld1Bhc3N3b3JkLCBvbGRQYXNzd29yZCkge1xuICAgIHBvc3RQYXNzd29yZChcbiAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQYXNzd29yZCB1cGRhdGVkJyk7XG4gICAgICAgIHN3ZWV0QWxlcnQoXCJQYXNzd29yZCB1cGRhdGVkXCIsIFwiXCIsIFwic3VjY2Vzc1wiKTtcbiAgICAgICAgJCgnLmNoYW5nZS1wYXNzd29yZC1vdmVybGF5Jykuc3RvcCgpLmZhZGVPdXQoMjAwKS5yZW1vdmUoKTtcblxuICAgICAgICBpZihhdXRoZW50aWNhdGUpIHtcbiAgICAgICAgICBwb3N0TG9naW4oZW1haWwsIG5ld1Bhc3N3b3JkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMyB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgIGlmIChhdXRoZW50aWNhdGUpIHtcbiAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ1RoZSBwYXNzd29yZCB5b3UgZW50ZXJlZCBpcyBpbmNvcnJlY3QuIFBsZWFzZSB0cnkgYWdhaW4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dlZXRBbGVydCgnWW91IGFyZSBub3QgYXV0aG9yaXNlZCB0byBjaGFuZ2UgdGhlIHBhc3N3b3JkIGZvciB0aGlzIHVzZXInKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlbWFpbCxcbiAgICAgIG5ld1Bhc3N3b3JkLFxuICAgICAgb2xkUGFzc3dvcmQpO1xuICB9XG59XG5cblxuZnVuY3Rpb24gdmlld0NvbGxlY3Rpb25EZXRhaWxzKGNvbGxlY3Rpb25JZCwgJHRoaXMpIHtcblxuICAgIGdldENvbGxlY3Rpb25EZXRhaWxzKGNvbGxlY3Rpb25JZCxcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgcG9wdWxhdGVDb2xsZWN0aW9uRGV0YWlscyhyZXNwb25zZSwgY29sbGVjdGlvbklkLCAkdGhpcyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVDb2xsZWN0aW9uRGV0YWlscyhjb2xsZWN0aW9uLCBjb2xsZWN0aW9uSWQpIHtcblxuICAgICAgICBGbG9yZW5jZS5zZXRBY3RpdmVDb2xsZWN0aW9uKGNvbGxlY3Rpb24pO1xuXG4gICAgICAgIC8vIFNldCBwdWJsaXNoZWQgZGF0ZVxuICAgICAgICBpZiAoIWNvbGxlY3Rpb24ucHVibGlzaERhdGUpIHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb24uZGF0ZSA9ICdbbWFudWFsIGNvbGxlY3Rpb25dJztcbiAgICAgICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uLnB1Ymxpc2hEYXRlICYmIGNvbGxlY3Rpb24udHlwZSA9PT0gJ21hbnVhbCcpIHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb24uZGF0ZSA9ICdbbWFudWFsIGNvbGxlY3Rpb25dIE9yaWdpbmFsbHkgc2NoZWR1bGVkIGZvciAnICsgU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbChjb2xsZWN0aW9uLnB1Ymxpc2hEYXRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb24uZGF0ZSA9IFN0cmluZ1V0aWxzLmZvcm1hdElzb0Z1bGwoY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgY29sbGVjdGlvbiBwcm9ncmVzc1xuICAgICAgICBQcm9jZXNzUGFnZXMoY29sbGVjdGlvbi5pblByb2dyZXNzKTtcbiAgICAgICAgUHJvY2Vzc1BhZ2VzKGNvbGxlY3Rpb24uY29tcGxldGUpO1xuICAgICAgICBQcm9jZXNzUGFnZXMoY29sbGVjdGlvbi5yZXZpZXdlZCk7XG5cbiAgICAgICAgLy8gU2V0IGNvbGxlY3Rpb24gYXBwcm92YWwgc3RhdGVcbiAgICAgICAgdmFyIGFwcHJvdmFsU3RhdGVzID0ge2luUHJvZ3Jlc3M6IGZhbHNlLCB0aHJvd25FcnJvcjogZmFsc2UsIGNvbXBsZXRlZDogZmFsc2V9O1xuICAgICAgICBzd2l0Y2ggKGNvbGxlY3Rpb24uYXBwcm92YWxTdGF0dXMpIHtcbiAgICAgICAgICAgIGNhc2UgKHVuZGVmaW5lZCk6IHtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmFwcHJvdmFsU3RhdGUgPSAnJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgKCdJTl9QUk9HUkVTUycpOiB7XG4gICAgICAgICAgICAgICAgYXBwcm92YWxTdGF0ZXMuaW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICgnQ09NUExFVEUnKToge1xuICAgICAgICAgICAgICAgIGFwcHJvdmFsU3RhdGVzLmNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICgnRVJST1InKToge1xuICAgICAgICAgICAgICAgIGFwcHJvdmFsU3RhdGVzLnRocm93bkVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb2xsZWN0aW9uLmFwcHJvdmFsU3RhdGUgPSBhcHByb3ZhbFN0YXRlcztcblxuICAgICAgICB2YXIgc2hvd1BhbmVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGh0bWw6IHdpbmRvdy50ZW1wbGF0ZXMuY29sbGVjdGlvbkRldGFpbHMoY29sbGVjdGlvbilcbiAgICAgICAgfTtcbiAgICAgICAgc2hvd1BhbmVsKCR0aGlzLCBzaG93UGFuZWxPcHRpb25zKTtcblxuICAgICAgICB2YXIgZGVsZXRlQnV0dG9uID0gJCgnI2NvbGxlY3Rpb24tZGVsZXRlJyksXG4gICAgICAgICAgICBjb2xsZWN0aW9uQ2FuQmVEZWxldGVkID0gY29sbGVjdGlvbi5pblByb2dyZXNzLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICAgICYmIGNvbGxlY3Rpb24uY29tcGxldGUubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICAgJiYgY29sbGVjdGlvbi5yZXZpZXdlZC5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICAmJiBjb2xsZWN0aW9uLnRpbWVzZXJpZXNJbXBvcnRGaWxlcy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICAmJiBjb2xsZWN0aW9uLnBlbmRpbmdEZWxldGVzLmxlbmd0aCA8PSAwO1xuICAgICAgICBpZiAoY29sbGVjdGlvbkNhbkJlRGVsZXRlZCkge1xuICAgICAgICAgICAgZGVsZXRlQnV0dG9uLnNob3coKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgY29sbGVjdGlvbj9cIixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkNvbnRpbnVlXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkNvbGxlY3Rpb24gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25EZXRhaWxzKGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoJ0ZpbGUgaGFzIG5vdCBiZWVuIGRlbGV0ZWQuIENvbnRhY3QgYW4gYWRtaW5pc3RyYXRvcicsIGVycm9yLCBcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlQnV0dG9uLmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciAkYXBwcm92ZUJ0biA9ICQoJy5idG4tY29sbGVjdGlvbi1hcHByb3ZlJyksXG4gICAgICAgICAgICAkZWRpdEJ0biA9ICQoJy5idG4tY29sbGVjdGlvbi1lZGl0JyksXG4gICAgICAgICAgICAkd29ya09uQnRuID0gJCgnLmJ0bi1jb2xsZWN0aW9uLXdvcmstb24nKTtcblxuICAgICAgICBpZiAoY29sbGVjdGlvbi5hcHByb3ZhbFN0YXRlLmluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIC8vIENvbGxlY3Rpb24gaGFzIGJlZW4gYXBwcm92ZWQgYW5kIGlzIGdlbmVyYXRpbmcgUERGLCB0aW1lc2VyaWVzIGV0YyBzbyBkaXNhYmxlIGJ1dHRvbnNcbiAgICAgICAgICAgICR3b3JrT25CdG4uYWRkQ2xhc3MoJ2J0bi0tZGlzYWJsZWQnKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgJGFwcHJvdmVCdG4uYWRkQ2xhc3MoJ2J0bi0tZGlzYWJsZWQnKS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbGxlY3Rpb24uYXBwcm92YWxTdGF0ZS50aHJvd25FcnJvcikge1xuICAgICAgICAgICAgLy8gQ29sbGVjdGlvbiBoYXMgdGhyb3duIGVycm9yIGRvaW5nIHByZS1wdWJsaXNoIHRhc2tzLCBnaXZlIHVzZXIgb3B0aW9uIHRvIHJldHJ5IGFwcHJvdmFsXG4gICAgICAgICAgICAkd29ya09uQnRuLmhpZGUoKTtcbiAgICAgICAgICAgICRhcHByb3ZlQnRuLnRleHQoJ1JldHJ5IGFwcHJvdmFsJykuc2hvdygpLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcG9zdEFwcHJvdmVDb2xsZWN0aW9uKGNvbGxlY3Rpb24uaWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2hvd0FwcHJvdmVCdXR0b24oY29sbGVjdGlvbikpIHtcbiAgICAgICAgICAgIC8vIENvbGxlY3Rpb24gaGFzIGJlZW4gcmV2aWV3ZWQgYW5kIGlzIHJlYWR5IGZvciBhcHByb3ZhbCwgc28gc2hvdyBidXR0b24gYW5kIGJpbmQgY2xpY2tcbiAgICAgICAgICAgICRhcHByb3ZlQnRuLnNob3coKS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHBvc3RBcHByb3ZlQ29sbGVjdGlvbihjb2xsZWN0aW9uLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gWW91IGNhbid0IGFwcHJvdmUgY29sbGVjdGlvbnMgdW5sZXNzIHRoZXJlIGlzIG5vdGhpbmcgbGVmdCB0byBiZSByZXZpZXdlZCwgaGlkZSBhcHByb3ZlIGJ1dHRvblxuICAgICAgICAgICAgJGFwcHJvdmVCdG4uaGlkZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9lZGl0IGNvbGxlY3Rpb25cbiAgICAgICAgJGVkaXRCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdENvbGxlY3Rpb24oY29sbGVjdGlvbik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vcGFnZS1saXN0XG4gICAgICAgICQoJy5wYWdlX19pdGVtOm5vdCguZGVsZXRlLWNoaWxkKScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoJy5wYWdlLWxpc3QgbGknKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICQoJy5wYWdlX19idXR0b25zJykuaGlkZSgpO1xuICAgICAgICAgICAgJCgnLnBhZ2VfX2NoaWxkcmVuJykuaGlkZSgpO1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRidXR0b25zID0gJHRoaXMubmV4dCgnLnBhZ2VfX2J1dHRvbnMnKSxcbiAgICAgICAgICAgICAgICAkY2hpbGRyZW5QYWdlcyA9ICRidXR0b25zLmxlbmd0aCA+IDAgPyAkYnV0dG9ucy5uZXh0KCcucGFnZV9fY2hpbGRyZW4nKSA6ICR0aGlzLm5leHQoJy5wYWdlX19jaGlsZHJlbicpO1xuXG4gICAgICAgICAgICAkdGhpcy5wYXJlbnQoJ2xpJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAkYnV0dG9ucy5zaG93KCk7XG4gICAgICAgICAgICAkY2hpbGRyZW5QYWdlcy5zaG93KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idG4tcGFnZS1lZGl0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHBhdGggPSAkKHRoaXMpLmF0dHIoJ2RhdGEtcGF0aCcpO1xuICAgICAgICAgICAgdmFyIGxhbmd1YWdlID0gJCh0aGlzKS5hdHRyKCdkYXRhLWxhbmd1YWdlJyk7XG4gICAgICAgICAgICBpZiAobGFuZ3VhZ2UgPT09ICdjeScpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2FmZVBhdGggPSBjaGVja1BhdGhTbGFzaGVzKHBhdGgpO1xuICAgICAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2ggPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgc2FmZVBhdGggPSBjaGVja1BhdGhTbGFzaGVzKHBhdGgpO1xuICAgICAgICAgICAgICAgIEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2ggPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldFBhZ2VEYXRhRGVzY3JpcHRpb24oY29sbGVjdGlvbklkLCBzYWZlUGF0aCxcbiAgICAgICAgICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVXb3Jrc3BhY2Uoc2FmZVBhdGgsIGNvbGxlY3Rpb25JZCwgJ2VkaXQnLCBjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcucGFnZS1kZWxldGUnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGF0aCA9ICQodGhpcykuYXR0cignZGF0YS1wYXRoJyk7XG4gICAgICAgICAgICB2YXIgbGFuZ3VhZ2UgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtbGFuZ3VhZ2UnKTtcblxuICAgICAgICAgICAgLy9TaG93cyByZWxldmFudCBhbGVydCB0ZXh0IC0gU3dlZXRBbGVydCBkb2Vzbid0IHJldHVybiBhIHRydWUgb3IgZmFsc2UgaW4gc2FtZSB3YXkgdGhhdCBjb25maXJtKCkgZG9lcyBzbyBoYXZlIHRvIHdyaXRlIGVhY2ggYWxlcnQgd2l0aCBkZWxldGUgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIGl0XG4gICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVBbGVydCh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIldhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGxhbmd1YWdlID09PSAnY3knICYmICEocGF0aC5tYXRjaCgvXFwvYnVsbGV0aW5zXFwvLykgfHwgcGF0aC5tYXRjaCgvXFwvYXJ0aWNsZXNcXC8vKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYW5ndWFnZSA9PT0gJ2N5Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoICsgJy9kYXRhX2N5Lmpzb24nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ29udGVudChjb2xsZWN0aW9uSWQsIHBhdGgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25EZXRhaWxzKGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiUGFnZSBkZWxldGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlRoaXMgcGFnZSBoYXMgYmVlbiBkZWxldGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2lmIChwYXRoLm1hdGNoKC9cXC9idWxsZXRpbnNcXC8vKSB8fCBwYXRoLm1hdGNoKC9cXC9hcnRpY2xlc1xcLy8pKSB7XG4gICAgICAgICAgICAvLyAgZGVsZXRlQWxlcnQoXCJUaGlzIHdpbGwgZGVsZXRlIHRoZSBFbmdsaXNoIGFuZCBXZWxzaCBjb250ZW50IG9mIHRoaXMgcGFnZSwgaWYgYW55LiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgcGFnZSBmcm9tIHRoZSBjb2xsZWN0aW9uP1wiKTtcbiAgICAgICAgICAgIC8vfSBlbHNlIGlmIChsYW5ndWFnZSA9PT0gJ2N5Jykge1xuICAgICAgICAgICAgZGVsZXRlQWxlcnQoXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgcGFnZSBmcm9tIHRoZSBjb2xsZWN0aW9uP1wiKTtcbiAgICAgICAgICAgIC8vfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICBkZWxldGVBbGVydChcIlRoaXMgd2lsbCBkZWxldGUgdGhlIEVuZ2xpc2ggYW5kIFdlbHNoIGNvbnRlbnQgb2YgdGhpcyBwYWdlLCBpZiBhbnkuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBwYWdlIGZyb20gdGhlIGNvbGxlY3Rpb24/XCIpO1xuICAgICAgICAgICAgLy99XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5kZWxldGUtbWFya2VyLXJlbW92ZScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSAkKCcucGFnZS1saXN0JykuZmluZCgnLnNlbGVjdGVkJyk7XG4gICAgICAgICAgICB2YXIgdXJpID0gJCh0aGlzKS5hdHRyKCdkYXRhLXBhdGgnKTtcbiAgICAgICAgICAgIHJlbW92ZURlbGV0ZU1hcmtlcih1cmksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIHNlbGVjdGlvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBnZXRDb2xsZWN0aW9uRGV0YWlscyhjb2xsZWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlQ29sbGVjdGlvbkRldGFpbHMocmVzcG9uc2UsIGNvbGxlY3Rpb25JZCwgJHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KCdVbmRvJywgXCJEZWxldGlvbiByZW1vdmVkXCIsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ0bi1jb2xsZWN0aW9uLWNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGhpZGVQYW5lbCh7fSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICR3b3JrT25CdG4uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZVN0YXRlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3dvcmtzcGFjZVN0YXRlJyk7XG4gICAgICAgICAgICB3b3Jrc3BhY2VTdGF0ZS5yZXNldCgpO1xuICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb25TdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUuanMnKTtcbiAgICAgICAgICAgIGNvbGxlY3Rpb25TdGF0ZS5zZXQoY29sbGVjdGlvbik7XG4gICAgICAgICAgICB2YXIgd29ya3NwYWNlQ29udHJvbGxlciA9IHJlcXVpcmUoJ3dvcmtzcGFjZS93b3Jrc3BhY2VDb250cm9sbGVyJyk7XG4gICAgICAgICAgICB3b3Jrc3BhY2VDb250cm9sbGVyLmluaXQoKTtcbiAgICAgICAgICAgIC8vIEZsb3JlbmNlLmdsb2JhbFZhcnMud2Vsc2ggPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIGNyZWF0ZVdvcmtzcGFjZSgnJywgY29sbGVjdGlvbklkLCAnYnJvd3NlJywgY29sbGVjdGlvbik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNldENvbGxlY3Rpb25EZXRhaWxzSGVpZ2h0KCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFByb2Nlc3NQYWdlcyhwYWdlcykge1xuICAgICAgICBfLnNvcnRCeShwYWdlcywgJ3VyaScpO1xuICAgICAgICBfLmVhY2gocGFnZXMsIGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICAgICAgICBwYWdlLnVyaSA9IHBhZ2UudXJpLnJlcGxhY2UoJy9kYXRhLmpzb24nLCAnJyk7XG4gICAgICAgICAgICByZXR1cm4gcGFnZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0Q29sbGVjdGlvbkRldGFpbHNIZWlnaHQoKSB7XG4gICAgICAgIHZhciBwYW5lbEhlaWdodCA9IHBhcnNlSW50KCQoJy5wYW5lbC0tb2ZmLWNhbnZhcycpLmhlaWdodCgpKTtcblxuICAgICAgICB2YXIgaGVhZEhlaWdodCA9IHBhcnNlSW50KCQoJy5zbGlkZXJfX2hlYWQnKS5oZWlnaHQoKSk7XG4gICAgICAgIHZhciBoZWFkUGFkZGluZyA9IHBhcnNlSW50KCQoJy5zbGlkZXJfX2hlYWQnKS5jc3MoJ3BhZGRpbmctYm90dG9tJykpO1xuXG4gICAgICAgIHZhciBjb250ZW50UGFkZGluZyA9IHBhcnNlSW50KCQoJy5zbGlkZXJfX2NvbnRlbnQnKS5jc3MoJ3BhZGRpbmctYm90dG9tJykpO1xuXG4gICAgICAgIHZhciBuYXZIZWlnaHQgPSBwYXJzZUludCgkKCcuc2xpZGVyX19uYXYnKS5oZWlnaHQoKSk7XG4gICAgICAgIHZhciBuYXZQYWRkaW5nID0gKHBhcnNlSW50KCQoJy5zbGlkZXJfX25hdicpLmNzcygncGFkZGluZy1ib3R0b20nKSkpICsgKHBhcnNlSW50KCQoJy5zbGlkZXJfX25hdicpLmNzcygncGFkZGluZy10b3AnKSkpO1xuXG4gICAgICAgIHZhciBjb250ZW50SGVpZ2h0ID0gcGFuZWxIZWlnaHQgLSAoaGVhZEhlaWdodCArIGhlYWRQYWRkaW5nICsgY29udGVudFBhZGRpbmcgKyBuYXZIZWlnaHQgKyBuYXZQYWRkaW5nKTtcbiAgICAgICAgJCgnLnNsaWRlcl9fY29udGVudCcpLmNzcygnaGVpZ2h0JywgY29udGVudEhlaWdodCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0FwcHJvdmVCdXR0b24oY29sbGVjdGlvbikge1xuICAgICAgICAvLyBJZiB0aGUgY29sbGVjdGlvbiBjb250YWlucyBkZWxldGVzLi4uXG4gICAgICAgIGlmIChjb2xsZWN0aW9uLnBlbmRpbmdEZWxldGVzICYmIGNvbGxlY3Rpb24ucGVuZGluZ0RlbGV0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgY3VycmVudCB1c2VyIGlzIG5vdCB0aGUgb3duZXIgb2YgYW55IG9mIHRoZSBkZWxldGVzLlxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbGxlY3Rpb24ucGVuZGluZ0RlbGV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVuZGluZ0RlbGV0ZSA9IGNvbGxlY3Rpb24ucGVuZGluZ0RlbGV0ZXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdEZWxldGUudXNlciA9PSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbG9nZ2VkSW5BcycpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjYXBwcm92YWwtcGVybWlzc2lvbi1ibG9ja2VkXCIpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIChjb2xsZWN0aW9uLmluUHJvZ3Jlc3MubGVuZ3RoID09PSAwICYmIGNvbGxlY3Rpb24uY29tcGxldGUubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICAgJiYgY29sbGVjdGlvbi5yZXZpZXdlZC5sZW5ndGggPj0gMCkgfHwgKGNvbGxlY3Rpb24udGltZXNlcmllc0ltcG9ydEZpbGVzLmxlbmd0aCA+IDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoY29sbGVjdGlvbi5pblByb2dyZXNzLmxlbmd0aCA9PT0gMCAmJiBjb2xsZWN0aW9uLmNvbXBsZXRlLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgJiYgY29sbGVjdGlvbi5yZXZpZXdlZC5sZW5ndGggPiAwKSB8fCAoY29sbGVjdGlvbi50aW1lc2VyaWVzSW1wb3J0RmlsZXMubGVuZ3RoID4gMCk7XG4gICAgfVxufWZ1bmN0aW9uIHZpZXdDb2xsZWN0aW9ucyhjb2xsZWN0aW9uSWQpIHtcblxuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICB2YXIgcGFnZURhdGFSZXF1ZXN0cyA9IFtdOyAvLyBsaXN0IG9mIHByb21pc2VzIC0gb25lIGZvciBlYWNoIGFqYXggcmVxdWVzdC5cbiAgICBwYWdlRGF0YVJlcXVlc3RzLnB1c2goXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiL3plYmVkZWUvY29sbGVjdGlvbnNcIixcbiAgICAgICAgICAgIHR5cGU6IFwiZ2V0XCIsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxeGhyKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IoanF4aHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICk7XG4gICAgcGFnZURhdGFSZXF1ZXN0cy5wdXNoKFxuICAgICAgICBnZXRUZWFtcyhcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAodGVhbSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC50ZWFtID0gdGVhbTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICk7XG5cbiAgICAkLndoZW4uYXBwbHkoJCwgcGFnZURhdGFSZXF1ZXN0cykudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgdmFyIHJlc3BvbnNlID0gW10sIHRlYW1zID0gW10sIGRhdGUgPSBcIlwiO1xuXG4gICAgICAgICQuZWFjaChyZXN1bHQuZGF0YSwgZnVuY3Rpb24gKGksIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIHZhciBhcHByb3ZhbFN0YXRlcyA9IHtpblByb2dyZXNzOiBmYWxzZSwgdGhyb3duRXJyb3I6IGZhbHNlLCBjb21wbGV0ZWQ6IGZhbHNlfTtcblxuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24uYXBwcm92YWxTdGF0dXMgIT0gXCJDT01QTEVURVwiKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgcHVibGlzaCBkYXRlXG4gICAgICAgICAgICAgICAgaWYgKCFjb2xsZWN0aW9uLnB1Ymxpc2hEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnW21hbnVhbCBjb2xsZWN0aW9uXSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uLnB1Ymxpc2hEYXRlICYmIGNvbGxlY3Rpb24udHlwZSA9PT0gJ21hbnVhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IFN0cmluZ1V0aWxzLmZvcm1hdElzb0RhdGVTdHJpbmcoY29sbGVjdGlvbi5wdWJsaXNoRGF0ZSkgKyAnIFtyb2xsZWQgYmFja10nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGUgPSBTdHJpbmdVdGlscy5mb3JtYXRJc29EYXRlU3RyaW5nKGNvbGxlY3Rpb24ucHVibGlzaERhdGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNldCBhcHByb3ZhbCBzdGF0ZVxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sbGVjdGlvbi5hcHByb3ZhbFN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICh1bmRlZmluZWQpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICgnSU5fUFJPR1JFU1MnKToge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwcm92YWxTdGF0ZXMuaW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICgnQ09NUExFVEUnKToge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwcm92YWxTdGF0ZXMuY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgKCdFUlJPUicpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHByb3ZhbFN0YXRlcy50aHJvd25FcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnB1c2goe2lkOiBjb2xsZWN0aW9uLmlkLCBuYW1lOiBjb2xsZWN0aW9uLm5hbWUsIGRhdGU6IGRhdGUsIGFwcHJvdmFsU3RhdGU6IGFwcHJvdmFsU3RhdGVzfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBpc0RhdGFWaXMgPSBmYWxzZTtcbiAgICAgICAgaWYgKEZsb3JlbmNlLkF1dGhlbnRpY2F0aW9uLnVzZXJUeXBlKCkgPT09IFwiREFUQV9WSVNVQUxJU0FUSU9OXCIpIHtcbiAgICAgICAgICAgIGlzRGF0YVZpcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbGxlY3Rpb25zSHRtbCA9IHRlbXBsYXRlcy5jb2xsZWN0aW9uTGlzdCh7cmVzcG9uc2U6IHJlc3BvbnNlLCB0ZWFtczogcmVzdWx0LnRlYW0udGVhbXMsIGlzRGF0YVZpczogaXNEYXRhVmlzfSk7XG4gICAgICAgICQoJy5zZWN0aW9uJykuaHRtbChjb2xsZWN0aW9uc0h0bWwpO1xuXG4gICAgICAgIGlmIChjb2xsZWN0aW9uSWQpIHtcbiAgICAgICAgICAgIHZpZXdDb2xsZWN0aW9uRGV0YWlscyhjb2xsZWN0aW9uSWQsICQoJy5qcy1zZWxlY3RhYmxlLXRhYmxlIHRyW2RhdGEtaWQ9XCInICsgY29sbGVjdGlvbklkICsgJ1wiXScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJy5qcy1zZWxlY3RhYmxlLXRhYmxlIHRib2R5IHRyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb25JZCA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25EZXRhaWxzKGNvbGxlY3Rpb25JZCwgJCh0aGlzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjdGVhbS10YWdcIikudGFnaXQoe1xuICAgICAgICAgICAgc2luZ2xlRmllbGQ6IHRydWUsXG4gICAgICAgICAgICBzaW5nbGVGaWVsZE5vZGU6ICQoJyN0ZWFtLWlucHV0JylcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLnVpLWF1dG9jb21wbGV0ZS1pbnB1dCcpLmhpZGUoKTtcblxuICAgICAgICAkKCdzZWxlY3QjdGVhbScpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcjdGVhbS10YWcnKS50YWdpdCgnY3JlYXRlVGFnJywgJChcIiN0ZWFtIG9wdGlvbjpzZWxlY3RlZFwiKS50ZXh0KCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcjdGVhbS1pbnB1dCcpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0ZWFtcyA9ICQoJyN0ZWFtLWlucHV0JykudmFsKCkuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIC8vQWZ0ZXIgY3JlYXRpbmcgdGhlIGFycmF5IHRhZ2l0IGxlYXZlcyBhbiBlbXB0eSBzdHJpbmcgaWYgYWxsIGVsZW1lbnRzIGFyZSByZW1vdmVkXG4gICAgICAgICAgICBpZiAodGVhbXMubGVuZ3RoID09PSAxICYmIHRlYW1zWzBdID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgdGVhbXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnZm9ybSBpbnB1dFt0eXBlPXJhZGlvXScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgaWYgKCQodGhpcykudmFsKCkgPT09ICdtYW51YWwnKSB7XG4gICAgICAgICAgICAgICAgJCgnI3NjaGVkdWxlZFB1Ymxpc2hPcHRpb25zJykuaGlkZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLnZhbCgpID09PSAnc2NoZWR1bGVkJykge1xuICAgICAgICAgICAgICAgICQoJyNzY2hlZHVsZWRQdWJsaXNoT3B0aW9ucycpLnNob3coKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS52YWwoKSA9PT0gJ2N1c3RvbScpIHtcbiAgICAgICAgICAgICAgICAkKCcjY3VzdG9tU2NoZWR1bGVPcHRpb25zJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICQoJyNyZWxlYXNlU2NoZWR1bGVPcHRpb25zJykuaGlkZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLnZhbCgpID09PSAncmVsZWFzZScpIHtcbiAgICAgICAgICAgICAgICAkKCcjY3VzdG9tU2NoZWR1bGVPcHRpb25zJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJyNyZWxlYXNlU2NoZWR1bGVPcHRpb25zJykuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuXG4gICAgICAgICQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICQoJyNkYXRlJykuZGF0ZXBpY2tlcih7XG4gICAgICAgICAgICAgICAgbWluRGF0ZTogdG9kYXksXG4gICAgICAgICAgICAgICAgZGF0ZUZvcm1hdDogJ2RkL21tL3l5JyxcbiAgICAgICAgICAgICAgICBjb25zdHJhaW5JbnB1dDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgJCgnLmJ0bi1zZWxlY3QtcmVsZWFzZScpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZpZXdSZWxlYXNlU2VsZWN0b3IoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmZvcm0tY3JlYXRlLWNvbGxlY3Rpb24nKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGNyZWF0ZUNvbGxlY3Rpb24odGVhbXMpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1mdW5jdGlvbiB2aWV3Q29udHJvbGxlcih2aWV3KSB7XG5cbiAgICBpZiAoRmxvcmVuY2UuQXV0aGVudGljYXRpb24uaXNBdXRoZW50aWNhdGVkKCkpIHtcblxuICAgICAgICBpZiAodmlldyA9PT0gJ2NvbGxlY3Rpb25zJykge1xuICAgICAgICAgICAgdmlld0NvbGxlY3Rpb25zKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlldyA9PT0gJ3VzZXJzJykge1xuICAgICAgICAgICAgdmlld1VzZXJzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlldyA9PT0gJ3RlYW1zJykge1xuICAgICAgICAgICAgdmlld1RlYW1zKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlldyA9PT0gJ2xvZ2luJykge1xuICAgICAgICAgICAgdmlld0xvZ0luKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlldyA9PT0gJ3B1Ymxpc2gnKSB7XG4gICAgICAgICAgICB2aWV3UHVibGlzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZpZXcgPT09ICdyZXBvcnRzJykge1xuICAgICAgICAgICAgdmlld1JlcG9ydHMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZpZXdDb250cm9sbGVyKCdjb2xsZWN0aW9ucycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2aWV3TG9nSW4oKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHZpZXdMb2dJbigpIHtcblxuICAgIHZhciBsb2dpbl9mb3JtID0gdGVtcGxhdGVzLmxvZ2luO1xuICAgICQoJy5zZWN0aW9uJykuaHRtbChsb2dpbl9mb3JtKTtcblxuICAgICQoJy5mb3JtLWxvZ2luJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbG9hZGluZ0J0bigkKCcjbG9naW4nKSk7XG4gICAgICAgIHZhciBlbWFpbCA9ICQoJy5mbC11c2VyLWFuZC1hY2Nlc3NfX2VtYWlsJykudmFsKCk7XG4gICAgICAgIHZhciBwYXNzd29yZCA9ICQoJy5mbC11c2VyLWFuZC1hY2Nlc3NfX3Bhc3N3b3JkJykudmFsKCk7XG4gICAgICAgIHBvc3RMb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiB2aWV3UHVibGlzaCgpIHtcbiAgICB2YXIgbWFudWFsID0gJ1ttYW51YWwgY29sbGVjdGlvbl0nO1xuXG4gICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbGxlY3Rpb25zXCIsXG4gICAgICAgIHR5cGU6IFwiZ2V0XCIsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoY29sbGVjdGlvbnMpIHtcbiAgICAgICAgICAgICQoY29sbGVjdGlvbnMpLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbGxlY3Rpb25zW2ldLnR5cGUgfHwgKGNvbGxlY3Rpb25zW2ldLnR5cGUgPT09ICdtYW51YWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uc1tpXS5wdWJsaXNoRGF0ZSA9IG1hbnVhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHBvcHVsYXRlUHVibGlzaFRhYmxlKGNvbGxlY3Rpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgcmVzdWx0ID0gW107XG5cbiAgICBmdW5jdGlvbiBwb3B1bGF0ZVB1Ymxpc2hUYWJsZShjb2xsZWN0aW9ucykge1xuXG5cbiAgICAgICAgdmFyIGNvbGxlY3Rpb25zQnlEYXRlID0gXy5jaGFpbihjb2xsZWN0aW9ucylcbiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbi5hcHByb3ZhbFN0YXR1cyA9PSBcIkNPTVBMRVRFXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc29ydEJ5KCdwdWJsaXNoRGF0ZScpXG4gICAgICAgICAgICAuZ3JvdXBCeSgncHVibGlzaERhdGUnKVxuICAgICAgICAgICAgLnZhbHVlKCk7XG5cbiAgICAgICAgZm9yICh2YXIga2V5IGluIGNvbGxlY3Rpb25zQnlEYXRlKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBbXTtcbiAgICAgICAgICAgIGlmIChrZXkgPT09IG1hbnVhbCkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWREYXRlID0gbWFudWFsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkRGF0ZSA9IFN0cmluZ1V0aWxzLmZvcm1hdElzb0Z1bGwoa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoY29sbGVjdGlvbnNCeURhdGVba2V5XSkuZWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IGNvbGxlY3Rpb25zQnlEYXRlW2tleV1bbl0uaWQ7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucHVzaChpZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtkYXRlOiBmb3JtYXR0ZWREYXRlLCBpZHM6IHJlc3BvbnNlfSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcHVibGlzaExpc3QgPSB0ZW1wbGF0ZXMucHVibGlzaExpc3QocmVzdWx0KTtcbiAgICAgICAgJCgnLnNlY3Rpb24nKS5odG1sKHB1Ymxpc2hMaXN0KTtcblxuICAgICAgICAkKCcuanMtc2VsZWN0YWJsZS10YWJsZSB0Ym9keSB0cicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb2xsZWN0aW9ucyA9ICQodGhpcykuYXR0cignZGF0YS1jb2xsZWN0aW9ucycpLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICBGbG9yZW5jZS5jb2xsZWN0aW9uVG9QdWJsaXNoLnB1Ymxpc2hEYXRlID0gJCh0aGlzKS5maW5kKCd0ZCcpLmh0bWwoKTtcbiAgICAgICAgICAgIHZpZXdQdWJsaXNoRGV0YWlscyhjb2xsZWN0aW9ucyk7XG5cbiAgICAgICAgICAgIHZhciBzaG93UGFuZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGh0bWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG1vdmVDZW50ZXJlZFBhbmVsOiB0cnVlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2hvd1BhbmVsKCQodGhpcyksIHNob3dQYW5lbE9wdGlvbnMpO1xuICAgICAgICAgICAgLy8gJCgnLnBhbmVsLS1jZW50cmVkJykuYW5pbWF0ZSh7bWFyZ2luTGVmdDogXCIwJVwifSwgODAwKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB2aWV3UHVibGlzaERldGFpbHMoY29sbGVjdGlvbnMpIHtcblxuICAgIHZhciBtYW51YWwgPSAnW21hbnVhbCBjb2xsZWN0aW9uXSc7XG4gICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgZGF0ZTogRmxvcmVuY2UuY29sbGVjdGlvblRvUHVibGlzaC5wdWJsaXNoRGF0ZSxcbiAgICAgICAgc3VidGl0bGU6ICcnLFxuICAgICAgICBjb2xsZWN0aW9uRGV0YWlsczogW10sXG4gICAgICAgIHBlbmRpbmdEZWxldGVzOiBbXVxuICAgIH07XG4gICAgdmFyIHBhZ2VEYXRhUmVxdWVzdHMgPSBbXTsgLy8gbGlzdCBvZiBwcm9taXNlcyAtIG9uZSBmb3IgZWFjaCBhamF4IHJlcXVlc3QgdG8gbG9hZCBwYWdlIGRhdGEuXG4gICAgdmFyIG9ubHlPbmUgPSAwO1xuXG4gICAgJC5lYWNoKGNvbGxlY3Rpb25zLCBmdW5jdGlvbiAoaSwgY29sbGVjdGlvbklkKSB7XG4gICAgICAgIG9ubHlPbmUgKz0gMTtcbiAgICAgICAgcGFnZURhdGFSZXF1ZXN0cy5wdXNoKFxuICAgICAgICAgICAgZ2V0Q29sbGVjdGlvbkRldGFpbHMoY29sbGVjdGlvbklkLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kYXRlID09PSBtYW51YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5jb2xsZWN0aW9uRGV0YWlscy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcmVzcG9uc2UuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVzcG9uc2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlRGV0YWlsczogcmVzcG9uc2UucmV2aWV3ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVR5cGU6ICdtYW51YWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdEZWxldGVzOiByZXNwb25zZS5wZW5kaW5nRGVsZXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRldGFpbHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHJlc3BvbnNlLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHJlc3BvbnNlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZURldGFpbHM6IHJlc3BvbnNlLnJldmlld2VkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9KTtcblxuICAgIGlmIChvbmx5T25lIDwgMikge1xuICAgICAgICByZXN1bHQuc3VidGl0bGUgPSAnVGhlIGZvbGxvd2luZyBjb2xsZWN0aW9uIGhhcyBiZWVuIGFwcHJvdmVkJztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQuc3VidGl0bGUgPSAnVGhlIGZvbGxvd2luZyBjb2xsZWN0aW9ucyBoYXZlIGJlZW4gYXBwcm92ZWQnO1xuICAgIH1cblxuICAgICQud2hlbi5hcHBseSgkLCBwYWdlRGF0YVJlcXVlc3RzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHB1Ymxpc2hEZXRhaWxzID0gdGVtcGxhdGVzLnB1Ymxpc2hEZXRhaWxzKHJlc3VsdCk7XG4gICAgICAgICQoJy5wYW5lbC0tb2ZmLWNhbnZhcycpLmh0bWwocHVibGlzaERldGFpbHMpO1xuICAgICAgICBiaW5kQWNjb3JkaW9ucygpO1xuXG4gICAgICAgICQoJy5idG4tY29sbGVjdGlvbi1wdWJsaXNoJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSAkKHRoaXMpLmNsb3Nlc3QoJy5qcy1hY2NvcmRpb24nKS5maW5kKCcuY29sbGVjdGlvbi1uYW1lJykuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coY29sbGVjdGlvbik7XG4gICAgICAgICAgICBwdWJsaXNoKGNvbGxlY3Rpb24pO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnRuLWNvbGxlY3Rpb24tdW5sb2NrJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSAkKHRoaXMpLmNsb3Nlc3QoJy5qcy1hY2NvcmRpb24nKS5maW5kKCcuY29sbGVjdGlvbi1uYW1lJykuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coY29sbGVjdGlvbik7XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHQuZGF0ZSAhPT0gbWFudWFsKSB7XG4gICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJBcmUgeW91IHN1cmU/XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIklmIHVubG9ja2VkLCB0aGlzIGNvbGxlY3Rpb24gd2lsbCBub3QgYmUgcHVibGlzaGVkIG9uIFwiICsgcmVzdWx0LmRhdGUgKyBcIiB1bmxlc3MgaXQgaXMgYXBwcm92ZWRcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiBhZ2FpblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiBcIiM2ZDI3MmJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIlllcywgdW5sb2NrIGl0IVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVubG9jayhjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVubG9jayhjb2xsZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9wYWdlLWxpc3RcbiAgICAgICAgJCgnLnBhZ2VfX2l0ZW06bm90KC5kZWxldGUtY2hpbGQpJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLnBhZ2UtbGlzdCBsaScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgJCgnLnBhZ2VfX2J1dHRvbnMnKS5oaWRlKCk7XG4gICAgICAgICAgICAkKCcucGFnZV9fY2hpbGRyZW4nKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vICQodGhpcykucGFyZW50KCdsaScpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgLy8gJCh0aGlzKS5uZXh0KCcucGFnZV9fYnV0dG9ucycpLnNob3coKTtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAkYnV0dG9ucyA9ICR0aGlzLm5leHQoJy5wYWdlX19idXR0b25zJyksXG4gICAgICAgICAgICAgICAgJGNoaWxkcmVuUGFnZXMgPSAkYnV0dG9ucy5sZW5ndGggPiAwID8gJGJ1dHRvbnMubmV4dCgnLnBhZ2VfX2NoaWxkcmVuJykgOiAkdGhpcy5uZXh0KCcucGFnZV9fY2hpbGRyZW4nKTtcblxuICAgICAgICAgICAgJHRoaXMucGFyZW50KCdsaScpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgJGJ1dHRvbnMuc2hvdygpO1xuICAgICAgICAgICAgJGNoaWxkcmVuUGFnZXMuc2hvdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnRuLWNvbGxlY3Rpb24tY2FuY2VsJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGhpZGVQYW5lbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgb25IaWRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtb3ZlQ2VudGVyZWRQYW5lbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaGlkZVBhbmVsKGhpZGVQYW5lbE9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbi8qKlxuICogTG9hZCB0aGUgcmVsZWFzZSBzZWxlY3RvciBzY3JlZW4gYW5kIHBvcHVsYXRlIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSByZWxlYXNlcy5cbiAqL1xuZnVuY3Rpb24gdmlld1JlbGVhc2VTZWxlY3RvcigpIHtcblxuICAgIHZhciBodG1sID0gdGVtcGxhdGVzLnJlbGVhc2VTZWxlY3RvcigpO1xuICAgICQoJ2JvZHknKS5hcHBlbmQoaHRtbCk7XG5cbiAgICB2YXIgcmVsZWFzZXMgPSBbXTtcbiAgICBQb3B1bGF0ZVJlbGVhc2VzRm9yVXJpKFwiL3JlbGVhc2VjYWxlbmRhci9kYXRhP3ZpZXc9dXBjb21pbmdcIiwgcmVsZWFzZXMpO1xuXG4gICAgJCgnLmJ0bi1yZWxlYXNlLXNlbGVjdG9yLWNhbmNlbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnLnJlbGVhc2Utc2VsZWN0Jykuc3RvcCgpLmZhZGVPdXQoMjAwKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIHZhciAkc2VhcmNoSW5wdXQgPSAkKCcjcmVsZWFzZS1zZWFyY2gtaW5wdXQnKTtcbiAgICAkc2VhcmNoSW5wdXQuZm9jdXMoKTtcbiAgICAkc2VhcmNoSW5wdXQub24oJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VhcmNoVGV4dCA9ICQodGhpcykudmFsKCk7XG4gICAgICAgIHBvcHVsYXRlUmVsZWFzZXNMaXN0KHJlbGVhc2VzLCBzZWFyY2hUZXh0KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIFBvcHVsYXRlUmVsZWFzZXNGb3JVcmkoYmFzZVJlbGVhc2VVcmksIHJlbGVhc2VzKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJwb3B1bGF0aW5nIHJlbGVhc2UgZm9yIHVyaSBcIiArIGJhc2VSZWxlYXNlVXJpKTtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICB1cmw6IGJhc2VSZWxlYXNlVXJpLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiZ2V0XCIsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVSZW1haW5pbmdSZWxlYXNlUGFnZXMoZGF0YSwgcmVsZWFzZXMsIGJhc2VSZWxlYXNlVXJpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlIHRoZSBkYXRhIGZyb20gdGhlIHJlc3BvbnNlIG9mIGdldHRpbmcgdGhlIGZpcnN0IHJlbGVhc2UgcGFnZSBhbmRcbiAgICAgKiBkZXRlcm1pbmUgaWYgdGhlcmUgYXJlIGFueSBtb3JlIHBhZ2VzIHRvIGdldC5cbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHBvcHVsYXRlUmVtYWluaW5nUmVsZWFzZVBhZ2VzKGRhdGEsIHJlbGVhc2VzLCBiYXNlUmVsZWFzZVVyaSkge1xuICAgICAgICB2YXIgcGFnZVNpemUgPSAxMDtcbiAgICAgICAgXyhkYXRhLnJlc3VsdC5yZXN1bHRzKS5lYWNoKGZ1bmN0aW9uIChyZWxlYXNlKSB7XG4gICAgICAgICAgICByZWxlYXNlcy5wdXNoKHJlbGVhc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbW9yZSByZXN1bHRzIHRoYW4gdGhlIGV4aXN0aW5nIHBhZ2Ugc2l6ZSwgZ28gZ2V0IHRoZW0uXG4gICAgICAgIGlmIChkYXRhLnJlc3VsdC5udW1iZXJPZlJlc3VsdHMgPiBwYWdlU2l6ZSkge1xuXG4gICAgICAgICAgICB2YXIgcGFnZXNUb0dldCA9IE1hdGguY2VpbCgoZGF0YS5yZXN1bHQubnVtYmVyT2ZSZXN1bHRzIC0gcGFnZVNpemUpIC8gcGFnZVNpemUpO1xuICAgICAgICAgICAgdmFyIHBhZ2VEYXRhUmVxdWVzdHMgPSBbXTsgLy8gbGlzdCBvZiBwcm9taXNlcyAtIG9uZSBmb3IgZWFjaCBhamF4IHJlcXVlc3QgdG8gbG9hZCBwYWdlIGRhdGEuXG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAyOyBpIDwgcGFnZXNUb0dldCArIDI7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBkZmQgPSBnZXRSZWxlYXNlc1BhZ2UoYmFzZVJlbGVhc2VVcmksIGksIHJlbGVhc2VzKTtcbiAgICAgICAgICAgICAgICBwYWdlRGF0YVJlcXVlc3RzLnB1c2goZGZkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC53aGVuLmFwcGx5KCQsIHBhZ2VEYXRhUmVxdWVzdHMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHBvcHVsYXRlUmVsZWFzZXNMaXN0KHJlbGVhc2VzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcG9wdWxhdGVSZWxlYXNlc0xpc3QocmVsZWFzZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSByZWxlYXNlIHBhZ2UgZm9yIHRoZSBnaXZlbiBpbmRleCBhbmQgYWRkIHRoZSByZXNwb25zZSB0byB0aGUgZ2l2ZW4gcmVsZWFzZXMgYXJyYXkuXG4gICAgICogQHBhcmFtIGlcbiAgICAgKiBAcGFyYW0gcmVsZWFzZXNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZWxlYXNlc1BhZ2UoYmFzZVJlbGVhc2VVcmksIGksIHJlbGVhc2VzKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJnZXR0aW5nIHBhZ2UgIFwiICsgaSArIFwiIGZvciBcIiArIGJhc2VSZWxlYXNlVXJpKTtcbiAgICAgICAgdmFyIGRmZCA9ICQuRGVmZXJyZWQoKTtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogYmFzZVJlbGVhc2VVcmkgKyAnJnBhZ2U9JyArIGksXG4gICAgICAgICAgICB0eXBlOiBcImdldFwiLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBfKGRhdGEucmVzdWx0LnJlc3VsdHMpLmVhY2goZnVuY3Rpb24gKHJlbGVhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZXMucHVzaChyZWxlYXNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZmQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUG9wdWxhdGUgdGhlIHJlbGVhc2VzIGxpc3QgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkgb2YgcmVsZWFzZXMuXG4gICAgICogQHBhcmFtIHJlbGVhc2VzXG4gICAgICovXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVSZWxlYXNlc0xpc3QocmVsZWFzZXMsIGZpbHRlcikge1xuICAgICAgICB2YXIgcmVsZWFzZUxpc3QgPSAkKCcjcmVsZWFzZS1saXN0Jyk7XG4gICAgICAgIHJlbGVhc2VMaXN0LmZpbmQoJ3RyJykucmVtb3ZlKCk7IC8vIHJlbW92ZSBleGlzdGluZyB0YWJsZSBlbnRyaWVzXG5cbiAgICAgICAgXyhfLnNvcnRCeShyZWxlYXNlcywgZnVuY3Rpb24gKHJlbGVhc2UpIHtcbiAgICAgICAgICAgIHJldHVybiByZWxlYXNlLmRlc2NyaXB0aW9uLnJlbGVhc2VEYXRlXG4gICAgICAgIH0pKVxuICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKHJlbGVhc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlciB8fCAocmVsZWFzZS5kZXNjcmlwdGlvbi50aXRsZS50b1VwcGVyQ2FzZSgpLmluZGV4T2YoZmlsdGVyLnRvVXBwZXJDYXNlKCkpID4gLTEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbERhdGVTdHJpbmcocmVsZWFzZS5kZXNjcmlwdGlvbi5yZWxlYXNlRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJlbGVhc2VMaXN0LmFwcGVuZCgnPHRyIGRhdGEtaWQ9XCInICsgcmVsZWFzZS5kZXNjcmlwdGlvbi50aXRsZSArICdcIiBkYXRhLXVyaT1cIicgKyByZWxlYXNlLnVyaSArICdcIj48dGQ+JyArIHJlbGVhc2UuZGVzY3JpcHRpb24udGl0bGUgKyAnPC90ZD48dGQ+JyArIGRhdGUgKyAnPC90ZD48L3RyPicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJlbGVhc2VMaXN0LmZpbmQoJ3RyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlbGVhc2VUaXRsZSA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgdmFyIHJlbGVhc2VVcmkgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdXJpJyksXG4gICAgICAgICAgICAgICAgJHJlbGVhc2VUaXRsZSA9ICQoJy5zZWxlY3RlZC1yZWxlYXNlJyk7XG4gICAgICAgICAgICBGbG9yZW5jZS5DcmVhdGVDb2xsZWN0aW9uLnNlbGVjdGVkUmVsZWFzZSA9IHt1cmk6IHJlbGVhc2VVcmksIHRpdGxlOiByZWxlYXNlVGl0bGV9O1xuXG5cbiAgICAgICAgICAgICRyZWxlYXNlVGl0bGUuc2hvdygpLnRleHQocmVsZWFzZVRpdGxlKTtcbiAgICAgICAgICAgICQoJy5yZWxlYXNlLXNlbGVjdCcpLnN0b3AoKS5mYWRlT3V0KDIwMCkucmVtb3ZlKCk7XG4gICAgICAgIH0pXG4gICAgfVxufS8qKlxuICogRGlzcGxheSBwYW5lbCB3aXRoIHNlbGVjdGVkIHJlcG9ydCdzIGRldGFpbHNcbiAqXG4gKiBAcGFyYW0gY29sbGVjdGlvbiA9IHNlbGVjdGVkIGNvbGxlY3Rpb24gZGF0YSBvYmplY3RcbiAqIEBwYXJhbSBpc1B1Ymxpc2hlZCA9IGJvb2xlYW4gZmxhZyBvZiB3aGV0aGVyIHNlbGVjdGVkIGNvbGxlY3Rpb24gaXMgcHVibGlzaGVkIG9yIG5vdFxuICogQHBhcmFtICR0aGlzID0galF1ZXJ5IG9iamVjdCBvZiBzZWxlY3RlZCBpdGVtIGZyb20gdGFibGVcbiAqL1xuXG5mdW5jdGlvbiB2aWV3UmVwb3J0RGV0YWlscyhjb2xsZWN0aW9uLCBpc1B1Ymxpc2hlZCwgJHRoaXMpIHtcblxuICAgIHZhciBkZXRhaWxzLCByZXBvcnREZXRhaWxzLCBwdWJsaXNoZWQsIGV2ZW50cztcblxuICAgIC8vIGdldCB0aGUgZXZlbnQgZGV0YWlsc1xuICAgICQuYWpheCh7XG4gICAgICAgIHVybDogXCIvemViZWRlZS9jb2xsZWN0aW9uSGlzdG9yeS9cIiArIGNvbGxlY3Rpb24uaWQsXG4gICAgICAgIHR5cGU6IFwiZ2V0XCIsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZXZlbnRzKSB7XG5cbiAgICAgICAgICAgIC8vIGZvcm1hdCBldmVudERhdGUgdG8gdXNlciByZWFkYWJsZSBkYXRlXG4gICAgICAgICAgICAkKGV2ZW50cykuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWREYXRlID0gZXZlbnRzW2ldLmV2ZW50RGV0YWlscy5kYXRlO1xuICAgICAgICAgICAgICAgIGV2ZW50c1tpXS5mb3JtYXR0ZWREYXRlID0gU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbChmb3JtYXR0ZWREYXRlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoaXNQdWJsaXNoZWQpIHtcblxuXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL3B1Ymxpc2hlZENvbGxlY3Rpb25zL1wiICsgY29sbGVjdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xsZWN0aW9uID0gY29sbGVjdGlvblswXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBjb2xsZWN0aW9uLnB1Ymxpc2hFbmREYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5mb3JtYXR0ZWREYXRlID0gU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbChkYXRlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBkZXRhaWxzIHdpdGggcHVibGlzaGVkIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sbGVjdGlvbi5wdWJsaXNoUmVzdWx0cyB8fCBjb2xsZWN0aW9uLnB1Ymxpc2hSZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSBjb2xsZWN0aW9uLnB1Ymxpc2hSZXN1bHRzW2NvbGxlY3Rpb24ucHVibGlzaFJlc3VsdHMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24ucHVibGlzaFN0YXJ0RGF0ZSAmJiBjb2xsZWN0aW9uLnB1Ymxpc2hFbmREYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGNvbGxlY3Rpb24ucHVibGlzaFN0YXJ0RGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBuZXcgRGF0ZShjb2xsZWN0aW9uLnB1Ymxpc2hFbmREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShzdWNjZXNzLnRyYW5zYWN0aW9uLnN0YXJ0RGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmQgPSBuZXcgRGF0ZShzdWNjZXNzLnRyYW5zYWN0aW9uLmVuZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZW5kIC0gc3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uLnB1Ymxpc2hTdGFydERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRpbmcgPSBTdHJpbmdVdGlscy5mb3JtYXRJc29GdWxsU2VjKGNvbGxlY3Rpb24ucHVibGlzaFN0YXJ0RGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFydGluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdElzb0Z1bGxTZWMoc3VjY2Vzcy50cmFuc2FjdGlvbi5zdGFydERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB2YXIgdmVyaWZpZWRDb3VudCA9IGNvbGxlY3Rpb24udmVyaWZpZWRDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhciB2ZXJpZnlGYWlsZWRDb3VudCA9IGNvbGxlY3Rpb24udmVyaWZ5RmFpbGVkQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB2YXIgdmVyaWZ5SW5wcm9ncmVzc0NvdW50ID0gY29sbGVjdGlvbi52ZXJpZnlJbnByb2dyZXNzQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGNvbGxlY3Rpb24ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2ZXJpZmllZENvdW50OiB2ZXJpZmllZENvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZlcmlmeUlucHJvZ3Jlc3NDb3VudDogdmVyaWZ5SW5wcm9ncmVzc0NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZlcmlmeUZhaWxlZENvdW50OiB2ZXJpZnlGYWlsZWRDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBjb2xsZWN0aW9uLmZvcm1hdHRlZERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRpbmc6IHN0YXJ0aW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50czogZXZlbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2hvd1BhbmVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiB0ZW1wbGF0ZXMucmVwb3J0UHVibGlzaGVkRGV0YWlscyhkZXRhaWxzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlQ2VudGVyZWRQYW5lbDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1BhbmVsKCR0aGlzLCBzaG93UGFuZWxPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBY2NvcmRpb25zKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaW5kVGFibGVPcmRlcmluZygpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG5cblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIC8vIExvYWQgZGV0YWlscyB3aXRoIHVucHVibGlzaGVkIGRhdGFcbiAgICAgICAgICAgICAgICBkZXRhaWxzID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBjb2xsZWN0aW9uLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50czogZXZlbnRzXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBzaG93UGFuZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICBodG1sOiB0ZW1wbGF0ZXMucmVwb3J0VW5wdWJsaXNoZWREZXRhaWxzKGRldGFpbHMpLFxuICAgICAgICAgICAgICAgICAgICBtb3ZlQ2VudGVyZWRQYW5lbDogdHJ1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc2hvd1BhbmVsKCR0aGlzLCBzaG93UGFuZWxPcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYmluZEFjY29yZGlvbnMoKTtcblxuICAgICAgICAgICAgJCgnLmJ0bi1jb2xsZWN0aW9uLWNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGlkZVBhbmVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgbW92ZUNlbnRlcmVkUGFuZWw6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGhpZGVQYW5lbChoaWRlUGFuZWxPcHRpb25zKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbn1cblxuZnVuY3Rpb24gYmluZFRhYmxlT3JkZXJpbmcoKSB7XG4gICAgLy8gQmluZCB0YWJsZSBvcmRlcmluZyBmdW5jdGlvbmFsaXR5IHRvIHB1Ymxpc2ggdGltZXNcbiAgICB2YXIgJHB1Ymxpc2hUaW1lSGVhZGluZ3MgPSAkKCcucHVibGlzaC10aW1lcy10YWJsZSB0aCcpO1xuICAgICRwdWJsaXNoVGltZUhlYWRpbmdzLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvLyBHZXQgdGFibGUsIHJldmVyc2Ugb3JkZXIgYW5kIHJlYnVpbGQgaXRcbiAgICAgICAgdmFyIHRhYmxlID0gJCh0aGlzKS5wYXJlbnRzKCd0YWJsZScpLmVxKDApO1xuICAgICAgICB2YXIgcm93cyA9IHRhYmxlLmZpbmQoJ3RyOmd0KDApJykudG9BcnJheSgpLnNvcnQoY29tcGFyZXIoJCh0aGlzKS5pbmRleCgpKSk7XG4gICAgICAgIHRoaXMuYXNjID0gIXRoaXMuYXNjO1xuICAgICAgICBpZiAoIXRoaXMuYXNjKSB7XG4gICAgICAgICAgICByb3dzID0gcm93cy5yZXZlcnNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0YWJsZS5hcHBlbmQocm93c1tpXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKiBUT0RPIEdldCBzb3J0aW5nIGFycm93cyB3b3JraW5nIC0gYWxzbyBjb2RlIGNvbW1lbnRlZCBvdXQgaW4gcmVsYXRlZCBTQ1NTICovXG4gICAgICAgIC8vIFVwZGF0ZSBhY3RpdmUgY2xhc3NlcyB0byBzaG93IHNvcnQgZGlyZWN0aW9uIGluIFVJXG4gICAgICAgICRwdWJsaXNoVGltZUhlYWRpbmdzLnJlbW92ZUNsYXNzKCdhY3RpdmUgYWN0aXZlLS1hc2MgYWN0aXZlLS1kZXNjJyk7XG4gICAgICAgIHZhciB0YWJsZURpcmVjdGlvbiA9IFwiYXNjXCI7XG4gICAgICAgIGlmICghdGhpcy5hc2MpIHtcbiAgICAgICAgICAgIHRhYmxlRGlyZWN0aW9uID0gXCJkZXNjXCI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFjdGl2ZUNsYXNzID0gXCJhY3RpdmUgYWN0aXZlLS1cIiArIHRhYmxlRGlyZWN0aW9uO1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGNvbXBhcmVyKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgdmFyIHZhbEEgPSBnZXRDZWxsVmFsdWUoYSwgaW5kZXgpLCB2YWxCID0gZ2V0Q2VsbFZhbHVlKGIsIGluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiAkLmlzTnVtZXJpYyh2YWxBKSAmJiAkLmlzTnVtZXJpYyh2YWxCKSA/IHZhbEEgLSB2YWxCIDogdmFsQS5sb2NhbGVDb21wYXJlKHZhbEIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Q2VsbFZhbHVlKHJvdywgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuICQocm93KS5jaGlsZHJlbigndGQnKS5lcShpbmRleCkuaHRtbCgpXG4gICAgfVxuXG59ZnVuY3Rpb24gdmlld1JlcG9ydHMoKSB7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL3plYmVkZWUvcHVibGlzaGVkQ29sbGVjdGlvbnNcIixcbiAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjb2xsZWN0aW9ucykge1xuICAgICAgICAgICAgZ2V0VW5wdWJsaXNoZWRDb2xsZWN0aW9ucyhjb2xsZWN0aW9ucyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZ2V0VW5wdWJsaXNoZWRDb2xsZWN0aW9ucyhwdWJsaXNoZWRDb2xsZWN0aW9ucykge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbGxlY3Rpb25zXCIsXG4gICAgICAgICAgICB0eXBlOiBcIkdFVFwiLFxuICAgICAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBjb2xsZWN0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25zW1wicHVibGlzaGVkXCJdID0gcHVibGlzaGVkQ29sbGVjdGlvbnM7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbnNbXCJ1bnB1Ymxpc2hlZFwiXSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIHBvcHVsYXRlVGFibGUoY29sbGVjdGlvbnMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwb3B1bGF0ZVRhYmxlKGNvbGxlY3Rpb25zKSB7XG4gICAgICAgIHZhciBjb2xsZWN0aW9ucyA9IGNvbGxlY3Rpb25zO1xuICAgICAgICAvL2NvbnNvbGUubG9nKGNvbGxlY3Rpb25zKTtcblxuICAgICAgICAvLyBCdWlsZCBwdWJsaXNoZWQgY29sbGVjdGlvbnMgb2JqZWN0c1xuICAgICAgICAvLyAvLyB2YXIgcHVibGlzaGVkQ29sbGVjdGlvbnMgPSBfLmNoYWluKGNvbGxlY3Rpb25zLnB1Ymxpc2hlZClcbiAgICAgICAgLy8gLy8gICAgIC5maWx0ZXIoZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgICAgLy8gLy8gICAgICAgICByZXR1cm4gY29sbGVjdGlvbi5wdWJsaXNoUmVzdWx0cyAmJiBjb2xsZWN0aW9uLnB1Ymxpc2hSZXN1bHRzLmxlbmd0aCA+IDA7XG4gICAgICAgIC8vIC8vICAgICB9KVxuICAgICAgICAvLyAvLyAgICAgLnZhbHVlKCk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHB1Ymxpc2hlZENvbGxlY3Rpb25zKTtcbiAgICAgICAgLy8gJChwdWJsaXNoZWRDb2xsZWN0aW9ucykuZWFjaChmdW5jdGlvbiAobiwgY29sbCkge1xuICAgICAgICAvLyAgICAgdmFyIGRhdGUgPSBwdWJsaXNoZWRDb2xsZWN0aW9uc1tuXS5cbiAgICAgICAgLy8gICAgIGlmIChjb2xsLnB1Ymxpc2hSZXN1bHRzICYmIGNvbGwucHVibGlzaFJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIGlmIChjb2xsLnB1Ymxpc2hTdGFydERhdGUpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGRhdGUgPSBjb2xsLnB1Ymxpc2hTdGFydERhdGU7XG4gICAgICAgIC8vICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGRhdGUgPSBjb2xsLnB1Ymxpc2hSZXN1bHRzW2NvbGwucHVibGlzaFJlc3VsdHMubGVuZ3RoIC0gMV0udHJhbnNhY3Rpb24uc3RhcnREYXRlO1xuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBwdWJsaXNoZWRDb2xsZWN0aW9uc1tuXS5mb3JtYXR0ZWREYXRlID0gU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbChkYXRlKTtcbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vIGNvbGxlY3Rpb25zW1wicHVibGlzaGVkXCJdID0gcHVibGlzaGVkQ29sbGVjdGlvbnM7XG5cbiAgICAgICAgdmFyIHB1Ymxpc2hlZENvbGxlY3Rpb25zID0gY29sbGVjdGlvbnMucHVibGlzaGVkO1xuXG4gICAgICAgICQocHVibGlzaGVkQ29sbGVjdGlvbnMpLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgIHB1Ymxpc2hlZENvbGxlY3Rpb25zW2ldLm9yZGVyID0gaTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9ybWF0IHRoZSBwdWJsaXNoRGF0ZSB0byB1c2VyIHJlYWRhYmxlIGFuZCBhZGQgaW50byBKU09OXG4gICAgICAgICQocHVibGlzaGVkQ29sbGVjdGlvbnMpLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWREYXRlID0gY29sbGVjdGlvbnNbXCJwdWJsaXNoZWRcIl1baV0ucHVibGlzaERhdGU7XG4gICAgICAgICAgICBjb2xsZWN0aW9uc1tcInB1Ymxpc2hlZFwiXVtpXS5mb3JtYXR0ZWREYXRlID0gU3RyaW5nVXRpbHMuZm9ybWF0SXNvRnVsbChmb3JtYXR0ZWREYXRlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUGFzcyBkYXRhIHRvIHRlbXBsYXRlIFxuICAgICAgICB2YXIgcmVwb3J0TGlzdCA9IHRlbXBsYXRlcy5yZXBvcnRMaXN0KGNvbGxlY3Rpb25zKTtcbiAgICAgICAgJCgnLnNlY3Rpb24nKS5odG1sKHJlcG9ydExpc3QpO1xuXG4gICAgICAgIC8vIEJpbmQgY2xpY2sgb24gdW5wdWJsaXNoZWQgY29sbGVjdGlvblxuICAgICAgICAkKCcudW5wdWJsaXNoZWQnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpID0gJCh0aGlzKS5hdHRyKCdkYXRhLWNvbGxlY3Rpb25zLW9yZGVyJyk7XG4gICAgICAgICAgICB2YXIgaXNQdWJsaXNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZpZXdSZXBvcnREZXRhaWxzKGNvbGxlY3Rpb25zLnVucHVibGlzaGVkW2ldLCBpc1B1Ymxpc2hlZCwgJCh0aGlzKSk7XG5cbiAgICAgICAgICAgIHNlbGVjdFRyKCQodGhpcykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBCaW5kIGNsaWNrIG9uIHB1Ymxpc2hlZCBjb2xsZWN0aW9uXG4gICAgICAgICQoJy5wdWJsaXNoZWQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaSA9ICQodGhpcykuYXR0cignZGF0YS1jb2xsZWN0aW9ucy1vcmRlcicpO1xuICAgICAgICAgICAgdmFyIGlzUHVibGlzaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZpZXdSZXBvcnREZXRhaWxzKGNvbGxlY3Rpb25zLnB1Ymxpc2hlZFtpXSwgaXNQdWJsaXNoZWQsICQodGhpcykpO1xuXG4gICAgICAgICAgICBzZWxlY3RUcigkKHRoaXMpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gc2VsZWN0VHIoJHRoaXMpIHtcbiAgICAgICAgICAgIC8vICQoJy5wdWJsaXNoLXNlbGVjdC10YWJsZSB0Ym9keSB0cicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgLy8gJHRoaXMuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAvLyAkKCcucHVibGlzaC1zZWxlY3RlZCcpLmFuaW1hdGUoe3JpZ2h0OiBcIjAlXCJ9LCA4MDApO1xuICAgICAgICAgICAgLy8gJCgnLnB1Ymxpc2gtc2VsZWN0JykuYW5pbWF0ZSh7bWFyZ2luTGVmdDogXCIwJVwifSwgNTAwKTtcbiAgICAgICAgICAgIHZhciBzaG93UGFuZWxPcHRpb25zID0ge1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIERpc3BsYXkgdGhlIGRldGFpbHMgb2YgdGhlIHRlYW0gd2l0aCB0aGUgZ2l2ZW4gbmFtZS5cbiAqIEBwYXJhbSB0ZWFtTmFtZVxuICogQHBhcmFtICR0aGlzID0galF1ZXJ5IG9iamVjdCBvZiBzZWxlY3RlZCB0YWJsZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHZpZXdUZWFtRGV0YWlscyh0ZWFtTmFtZSwgJHRoaXMpIHtcblxuICAgIGdldFRlYW1zKFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKHRlYW0pIHtcbiAgICAgICAgICAgIHBvcHVsYXRlVGVhbURldGFpbHModGVhbSwgJHRoaXMpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICB9LFxuICAgICAgICB0ZWFtTmFtZVxuICAgICk7XG5cbiAgICBmdW5jdGlvbiBwb3B1bGF0ZVRlYW1EZXRhaWxzKHRlYW0sICR0aGlzKSB7XG5cbiAgICAgICAgdmFyIHNob3dQYW5lbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBodG1sOiB3aW5kb3cudGVtcGxhdGVzLnRlYW1EZXRhaWxzKHRlYW0pXG4gICAgICAgIH07XG4gICAgICAgIHNob3dQYW5lbCgkdGhpcywgc2hvd1BhbmVsT3B0aW9ucyk7XG5cbiAgICAgICAgJCgnLmJ0bi10ZWFtLWRlbGV0ZScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN3YWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkNvbmZpcm0gZGVsZXRpb25cIixcbiAgICAgICAgICAgICAgICB0ZXh0OiBcIlBsZWFzZSBlbnRlciB0aGUgbmFtZSBvZiB0aGUgdGVhbSB5b3Ugd2FudCB0byBkZWxldGVcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBcImlucHV0XCIsXG4gICAgICAgICAgICAgICAgaW5wdXRQbGFjZUhvbGRlcjogXCJOYW1lXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcInNsaWRlLWZyb20tdG9wXCJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdGVhbU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmNvZGVkTmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudCh0ZWFtTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVUZWFtKGVuY29kZWROYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJPb3BzIVwiLCAnVGhlIG5hbWUgeW91IGVudGVyZWQgZGlkIG5vdCBtYXRjaCB0aGUgdGVhbSB5b3Ugd2FudCB0byBkZWxldGUuJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ0bi10ZWFtLWNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGhpZGVQYW5lbCh7fSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idG4tdGVhbS1lZGl0LW1lbWJlcnMnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwb3B1bGF0ZU1lbWJlcnModGVhbSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcG9wdWxhdGVNZW1iZXJzKHRlYW0pIHtcbiAgICB2YXIgdXNlckFycmF5LCB1c2VyTm90SW5UZWFtO1xuICAgIGdldFVzZXJzKFxuICAgICAgICBmdW5jdGlvbiAodXNlcnMpIHtcbiAgICAgICAgICAgIHVzZXJBcnJheSA9IF8ucGx1Y2sodXNlcnMsIFwiZW1haWxcIik7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiVUE6IFwiICsgdXNlckFycmF5KTtcbiAgICAgICAgICAgIHVzZXJOb3RJblRlYW0gPSBfLmRpZmZlcmVuY2UodXNlckFycmF5LCB0ZWFtLm1lbWJlcnMpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIlVOSVQ6IFwiICsgdXNlck5vdEluVGVhbSk7XG4gICAgICAgICAgICB2YXIgdGVhbXNIdG1sID0gdGVtcGxhdGVzLnRlYW1FZGl0KHt0ZWFtOiB0ZWFtLCB1c2VyOiB1c2VyTm90SW5UZWFtfSk7XG4gICAgICAgICAgICAkKCcuc2VjdGlvbicpLmFwcGVuZCh0ZWFtc0h0bWwpO1xuXG4gICAgICAgICAgICAkKCcjdGVhbS1zZWFyY2gtaW5wdXQnKS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaFRleHQgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgICAgIHBvcHVsYXRlVXNlcnNMaXN0KHVzZXJOb3RJblRlYW0sIHNlYXJjaFRleHQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5idG4tdGVhbS1zZWxlY3Rvci1jYW5jZWwnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnLnRlYW0tc2VsZWN0Jykuc3RvcCgpLmZhZGVPdXQoMjAwKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB2aWV3VGVhbURldGFpbHModGVhbS5uYW1lKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcudXNlci1saXN0Jykub24oJ2NsaWNrJywgJy5idG4tdGVhbS1hZGQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygneW91IGNsaWNrZWQgYWRkJyk7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgJGxpID0gJHRoaXMucGFyZW50KCdsaScpLFxuICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSAkdGhpcy5kYXRhKCdlbWFpbCcpO1xuICAgICAgICAgICAgICAgICRsaS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBtb3ZlVXNlcigkZW1haWwsIHRydWUpXG4gICAgICAgICAgICAgICAgcG9zdFRlYW1NZW1iZXIodGVhbS5uYW1lLCAkZW1haWwpO1xuICAgICAgICAgICAgICAgIHVzZXJOb3RJblRlYW0gPSBfLmRpZmZlcmVuY2UodXNlck5vdEluVGVhbSwgWyRlbWFpbF0pO1xuXG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAkKCcudGVhbS1saXN0Jykub24oJ2NsaWNrJywgJy5idG4tdGVhbS1yZW1vdmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygneW91IGNsaWNrZWQgcmVtb3ZlJyk7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgJGxpID0gJHRoaXMucGFyZW50KCdsaScpLFxuICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSAkdGhpcy5kYXRhKCdlbWFpbCcpO1xuICAgICAgICAgICAgICAgICRsaS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBtb3ZlVXNlcigkZW1haWwsIGZhbHNlKVxuICAgICAgICAgICAgICAgIGRlbGV0ZVRlYW1NZW1iZXIodGVhbS5uYW1lLCAkZW1haWwpO1xuICAgICAgICAgICAgICAgIHVzZXJOb3RJblRlYW0ucHVzaCgkZW1haWwpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vZHJhZ0FuZERyb3AoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGpxeGhyKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihqcXhocik7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgLyoqXG4gICAgICogUG9wdWxhdGUgdGhlIHVzZXJzIGxpc3QgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkgb2YgdXNlcnMuXG4gICAgICogQHBhcmFtIHVzZXJzXG4gICAgICovXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVVc2Vyc0xpc3QodXNlcnMsIGZpbHRlcikge1xuICAgICAgICB2YXIgdXNlckxpc3QgPSAkKCcudXNlci1saXN0Jyk7XG4gICAgICAgIHVzZXJMaXN0LmZpbmQoJ2xpJykucmVtb3ZlKCk7IC8vIHJlbW92ZSBleGlzdGluZyB0YWJsZSBlbnRyaWVzXG5cbiAgICAgICAgXyhfLnNvcnRCeSh1c2VycywgZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB1c2VyO1xuICAgICAgICB9KSlcbiAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXIgfHwgKHVzZXIudG9VcHBlckNhc2UoKS5pbmRleE9mKGZpbHRlci50b1VwcGVyQ2FzZSgpKSA+IC0xKSkge1xuICAgICAgICAgICAgICAgICAgICB1c2VyTGlzdC5hcHBlbmQoJzxsaSA+JyArIHVzZXIgKyAnIDxidXR0b24gY2xhc3M9XCJidG4tdGVhbS1saXN0IGJ0bi10ZWFtLWFkZFwiIGRhdGEtZW1haWw9XCInICsgdXNlciArICdcIj5BZGQ8L2J1dHRvbj48L2xpPicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvL2RyYWdBbmREcm9wKCk7XG4gICAgfVxuXG4gICAgLy9mdW5jdGlvbiBkcmFnQW5kRHJvcCgpIHtcbiAgICAvLyAgICAkKCcudXNlci1saXN0ID4gbGknKS5kcmFnZ2FibGUoe1xuICAgIC8vICAgICAgICBhcHBlbmRUbzogJ2RvY3VtZW50JyxcbiAgICAvLyAgICAgICAgaGVscGVyOiAnY2xvbmUnLFxuICAgIC8vICAgICAgICBjdXJzb3I6ICdtb3ZlJ1xuICAgIC8vICAgIH0pO1xuICAgIC8vXG4gICAgLy8gICAgJCgnLnRlYW0tbGlzdCA+IGxpJykuZHJhZ2dhYmxlKHtcbiAgICAvLyAgICAgICAgYXBwZW5kVG86ICdkb2N1bWVudCcsXG4gICAgLy8gICAgICAgIGhlbHBlcjogJ2Nsb25lJyxcbiAgICAvLyAgICAgICAgY3Vyc29yOiAnbW92ZSdcbiAgICAvLyAgICB9KTtcbiAgICAvL1xuICAgIC8vICAgICQoJy51c2VyLWxpc3QnKS5kcm9wcGFibGUoe1xuICAgIC8vICAgICAgICBhY2NlcHQ6IFwiLnRlYW0tbGlzdCA+IGxpXCIsXG4gICAgLy8gICAgICAgIGRyb3A6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAvLyAgICAgICAgICAgIHZhciB0YXJnZXRFbGVtID0gJCh0aGlzKS5hdHRyKFwiaWRcIik7XG4gICAgLy8gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaGlnaGxpZ2h0XCIpO1xuICAgIC8vICAgICAgICAgICAgJCh1aS5kcmFnZ2FibGUpLmFwcGVuZFRvKHRoaXMpO1xuICAgIC8vICAgICAgICAgICAgZGVsZXRlVGVhbU1lbWJlcih0ZWFtLm5hbWUsIHVpLmRyYWdnYWJsZVswXS5maXJzdENoaWxkLnRleHRDb250ZW50KTtcbiAgICAvLyAgICAgICAgICAgIHVzZXJOb3RJblRlYW0ucHVzaCh1aS5kcmFnZ2FibGVbMF0uZmlyc3RDaGlsZC50ZXh0Q29udGVudCk7XG4gICAgLy8gICAgICAgIH1cbiAgICAvLyAgICB9KTtcbiAgICAvL1xuICAgIC8vICAgICQoJy50ZWFtLWxpc3QnKS5kcm9wcGFibGUoe1xuICAgIC8vICAgICAgICBhY2NlcHQ6IFwiLnVzZXItbGlzdCA+IGxpXCIsXG4gICAgLy8gICAgICAgIGRyb3A6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAvLyAgICAgICAgICAgIHZhciB0YXJnZXRFbGVtID0gJCh0aGlzKS5hdHRyKFwiaWRcIik7XG4gICAgLy8gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwidWktc3RhdGUtaGlnaGxpZ2h0XCIpO1xuICAgIC8vICAgICAgICAgICAgJCh1aS5kcmFnZ2FibGUpLmFwcGVuZFRvKHRoaXMpO1xuICAgIC8vICAgICAgICAgICAgcG9zdFRlYW1NZW1iZXIodGVhbS5uYW1lLCB1aS5kcmFnZ2FibGVbMF0uZmlyc3RDaGlsZC50ZXh0Q29udGVudCk7XG4gICAgLy8gICAgICAgICAgICB1c2VyTm90SW5UZWFtID0gXy5kaWZmZXJlbmNlKHVzZXJOb3RJblRlYW0sIFt1aS5kcmFnZ2FibGVbMF0uZmlyc3RDaGlsZC50ZXh0Q29udGVudF0pO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgfSk7XG4gICAgLy99O1xuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIG1vdmluZyBsaXN0IGl0ZW1zIGJldHdlZW4gbHNpdHMuXG4gICAgICogQHBhcmFtIHVzZXIgLSBlbWFpbCBzdHJpbmdcbiAgICAgKiBAcGFyYW0gYmVpbmdBZGRlZCAtIHRydWUgb3IgZmFsc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtb3ZlVXNlcih1c2VyLCBiZWluZ0FkZGVkKSB7XG4gICAgICAgIGlmIChiZWluZ0FkZGVkKSB7XG4gICAgICAgICAgICBidXR0b24gPSAnPGJ1dHRvbiBjbGFzcz1cImJ0bi10ZWFtLWxpc3QgYnRuLXRlYW0tcmVtb3ZlXCIgZGF0YS1lbWFpbD1cIicgKyB1c2VyICsgJ1wiPlJlbW92ZTwvYnV0dG9uPic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBidXR0b24gPSAnPGJ1dHRvbiBjbGFzcz1cImJ0bi10ZWFtLWxpc3QgYnRuLXRlYW0tYWRkXCIgZGF0YS1lbWFpbD1cIicgKyB1c2VyICsgJ1wiPkFkZDwvYnV0dG9uPic7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0ciA9ICc8bGk+JyArIHVzZXIgKyAnICcgKyBidXR0b24gKyAnPC9saT4nO1xuXG4gICAgICAgIGlmIChiZWluZ0FkZGVkKSB7XG4gICAgICAgICAgICAkKCcudGVhbS1saXN0JykucHJlcGVuZChzdHIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLnVzZXItbGlzdCcpLnByZXBlbmQoc3RyKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuXG5mdW5jdGlvbiB2aWV3VGVhbXMoc2VsZWN0VGFibGVSb3dBbmREaXNwbGF5VGVhbURldGFpbHMpIHtcblxuICAgIGdldFRlYW1zKFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHBvcHVsYXRlVGVhbXNUYWJsZShkYXRhLnRlYW1zKTtcblxuICAgICAgICAgICAgLy8gb24gY3JlYXRpb24gb2YgbmV3IHRlYW0gaGlnaGxpZ2h0IHJvdyBpbiB0YWJsZSBhbmQgZGlzcGxheSB0ZWFtIGRldGFpbHNcbiAgICAgICAgICAgIGlmIChzZWxlY3RUYWJsZVJvd0FuZERpc3BsYXlUZWFtRGV0YWlscykge1xuICAgICAgICAgICAgICAgIHNlbGVjdFRhYmxlUm93QW5kRGlzcGxheVRlYW1EZXRhaWxzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0gZnVuY3Rpb24gKGpxeGhyKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihqcXhocik7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVUZWFtc1RhYmxlKGRhdGEpIHtcbiAgICAgICAgdmFyIHRlYW1zSHRtbCA9IHRlbXBsYXRlcy50ZWFtTGlzdChkYXRhKTtcbiAgICAgICAgJCgnLnNlY3Rpb24nKS5odG1sKHRlYW1zSHRtbCk7XG5cbiAgICAgICAgJCgnLmpzLXNlbGVjdGFibGUtdGFibGUgdGJvZHkgdHInKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGVhbUlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICB2aWV3VGVhbURldGFpbHModGVhbUlkLCAkKHRoaXMpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmZvcm0tY3JlYXRlLXRlYW0nKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgdmFyIHRlYW1OYW1lID0gJCgnI2NyZWF0ZS10ZWFtLW5hbWUnKS52YWwoKTtcblxuICAgICAgICAgICAgaWYgKHRlYW1OYW1lLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiUGxlYXNlIGVudGVyIGEgdXNlciBuYW1lLlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRlYW1OYW1lID0gdGVhbU5hbWUudHJpbSgpO1xuICAgICAgICAgICAgcG9zdFRlYW0odGVhbU5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cblxuLyoqXG4gKiBEaXNwbGF5IHRoZSBkZXRhaWxzIG9mIHRoZSB1c2VyIHdpdGggdGhlIGdpdmVuIGVtYWlsLlxuICpcbiAqIEBwYXJhbSBlbWFpbFxuICogQHBhcmFtICR0aGlzID0galF1ZXJ5IG9iamVjdCBvZiBzZWxlY3RlZCB0YWJsZSBpdGVtXG4gKi9cbmZ1bmN0aW9uIHZpZXdVc2VyRGV0YWlscyhlbWFpbCwgJHRoaXMpIHtcblxuICAgIGdldFVzZXJzKFxuICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgIHBvcHVsYXRlVXNlckRldGFpbHModXNlciwgZW1haWwsICR0aGlzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW1haWxcbiAgICApO1xuXG4gICAgdmFyIGlzQWRtaW4sIGlzRWRpdG9yLCBpc1Zpc1B1Ymxpc2hlcjtcbiAgICBmdW5jdGlvbiBwb3B1bGF0ZVVzZXJEZXRhaWxzKHVzZXIsIGVtYWlsLCAkdGhpcykge1xuICAgICAgICBnZXRVc2VyUGVybWlzc2lvbihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgaXNBZG1pbiA9IHBlcm1pc3Npb24uYWRtaW47XG4gICAgICAgICAgICAgICAgaXNFZGl0b3IgPSBwZXJtaXNzaW9uLmVkaXRvcjtcbiAgICAgICAgICAgICAgICBpc1Zpc1B1Ymxpc2hlciA9IHBlcm1pc3Npb24uZGF0YVZpc1B1Ymxpc2hlcjtcblxuICAgICAgICAgICAgICAgIGFkZFBlcm1pc3Npb25Ub0pTT04odXNlcik7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2hvd1BhbmVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogd2luZG93LnRlbXBsYXRlcy51c2VyRGV0YWlscyh1c2VyKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc2hvd1BhbmVsKCR0aGlzLCBzaG93UGFuZWxPcHRpb25zKTtcblxuICAgICAgICAgICAgICAgICQoJy5idG4tdXNlci1jaGFuZ2UtcGFzc3dvcmQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UGFzc3dvcmRSZXF1aXJlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbWFpbCA9PSBGbG9yZW5jZS5BdXRoZW50aWNhdGlvbi5sb2dnZWRJbkVtYWlsKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXNzd29yZFJlcXVpcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZpZXdDaGFuZ2VQYXNzd29yZChlbWFpbCwgY3VycmVudFBhc3N3b3JkUmVxdWlyZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCgnLmJ0bi11c2VyLWRlbGV0ZScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJDb25maXJtIGRlbGV0aW9uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBcIlBsZWFzZSBlbnRlciB0aGUgZW1haWwgYWRkcmVzcyBvZiB0aGUgdXNlciB5b3Ugd2FudCB0byBkZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UGxhY2VIb2xkZXI6IFwiRW1haWwgYWRkcmVzc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcInNsaWRlLWZyb20tdG9wXCJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSBlbWFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlVzZXIgZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJUaGlzIHVzZXIgaGFzIGJlZW4gZGVsZXRlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlVXNlcihlbWFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIk9vcHMhXCIsICdUaGUgZW1haWwgeW91IGVudGVyZWQgZGlkIG5vdCBtYXRjaCB0aGUgdXNlciB5b3Ugd2FudCB0byBkZWxldGUuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCgnLmJ0bi11c2VyLWNhbmNlbCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlkZVBhbmVsKHt9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtoYW5kbGVBcGlFcnJvcihlcnJvcik7fSxcbiAgICAgICAgICAgIGVtYWlsXG4gICAgICAgICk7XG5cbiAgICB9XG5cbiAgICAvKlxuICAgICAqIEFkZCBwZXJtaXNzaW9ucyBvYmplY3QgdG8gSlNPTiBzbyBhY2Nlc3NpYmxlIHRvIGhhbmRsZWJhcnMgdGVtcGxhdGVcbiAgICAgKiBAcGFyYW0gdXNlciAtIEpTT04gb2JqZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gYWRkUGVybWlzc2lvblRvSlNPTiAodXNlcikge1xuICAgICAgICB1c2VyWydwZXJtaXNzaW9uJ10gPSBwZXJtaXNzaW9uU3RyKGlzQWRtaW4sIGlzRWRpdG9yLCBpc1Zpc1B1Ymxpc2hlcik7XG4gICAgfVxuXG5cbiAgICAvKlxuICAgICAqIExvZ2ljIHRvIHdvcmsgb3V0IHVzZXIgcm9sZVxuICAgICAqIEBwYXJhbSBpc0FkbWluIC0gdHJ1ZS9mYWxzZVxuICAgICAqIEBwYXJhbSBpc0VkaXRvciAtIHRydWUvZmFsc2VcbiAgICAgKiBAcmV0dXJuIHRoZSB1c2VyJ3Mgcm9sZSBhcyBzdHJpbmdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwZXJtaXNzaW9uU3RyIChpc0FkbWluLCBpc0VkaXRvciwgaXNWaXNQdWJsaXNoZXIpIHtcbiAgICAgICAgdmFyIHBlcm1pc3Npb25TdHI7XG4gICAgICAgIGlmICghaXNBZG1pbiAmJiAhaXNFZGl0b3IpIHtwZXJtaXNzaW9uU3RyID0gJ3ZpZXdlcic7fVxuICAgICAgICBpZiAoaXNFZGl0b3IgJiYgIWlzVmlzUHVibGlzaGVyKSB7cGVybWlzc2lvblN0ciA9ICdwdWJsaXNoZXInO31cbiAgICAgICAgaWYgKGlzRWRpdG9yICYmIGlzVmlzUHVibGlzaGVyKSB7cGVybWlzc2lvblN0ciA9ICd2aXN1YWxpc2F0aW9uIHB1Ymxpc2hlcic7fVxuICAgICAgICBpZiAoaXNBZG1pbikge3Blcm1pc3Npb25TdHIgPSBcImFkbWluXCI7fVxuXG4gICAgICAgIHJldHVybiBwZXJtaXNzaW9uU3RyO1xuICAgIH1cbn1mdW5jdGlvbiB2aWV3VXNlcnModmlldykge1xuICAgIHZhciBsb2dnZWRVc2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvZ2dlZEluQXMnKTtcbiAgICBnZXRVc2VycyhcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvL2Jhc2VkIG9uIHVzZXIgcGVybWlzc2lvbiB3aWxsIHNob3cgdGhlIG9wdGlvbnMgdG8gY3JlYXRlIGRpZmZlcmVudCB1c2Vyc1xuICAgICAgICAgICAgZ2V0VXNlclBlcm1pc3Npb24oXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVVc2Vyc1RhYmxlKGRhdGEsIHBlcm1pc3Npb24pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxvZ2dlZFVzZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0gZnVuY3Rpb24gKGpxeGhyKSB7XG4gICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihqcXhocik7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVVc2Vyc1RhYmxlKGRhdGEsIHBlcm1pc3Npb24pIHtcbiAgICAgICAgdmFyIG9yZGVyZWRVc2VycyA9IF8uc29ydEJ5KGRhdGEsICduYW1lJyk7XG4gICAgICAgIHZhciBkYXRhVGVtcGxhdGUgPSB7ZGF0YTogb3JkZXJlZFVzZXJzLCBwZXJtaXNzaW9uOiBwZXJtaXNzaW9ufTtcbiAgICAgICAgdmFyIHVzZXJzSHRtbCA9IHRlbXBsYXRlcy51c2VyTGlzdChkYXRhVGVtcGxhdGUpO1xuICAgICAgICB2YXIgaXNBZG1pbiA9IGZhbHNlO1xuICAgICAgICB2YXIgaXNEYXRhVmlzUHVibGlzaGVyID0gZmFsc2U7XG4gICAgICAgIHZhciBpc0VkaXRvciA9IGZhbHNlO1xuICAgICAgICAkKCcuc2VjdGlvbicpLmh0bWwodXNlcnNIdG1sKTtcblxuXG4gICAgICAgICQoJy5qcy1zZWxlY3RhYmxlLXRhYmxlIHRib2R5IHRyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHVzZXJJZCA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpO1xuICAgICAgICAgICAgdmlld1VzZXJEZXRhaWxzKHVzZXJJZCwgJCh0aGlzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5yYWRpb0J0bkRpdicpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJCgnaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgICAgICAgaXNBZG1pbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgaXNFZGl0b3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzRGF0YVZpc1B1Ymxpc2hlciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoJCgnaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpID09PSAncHVibGlzaGVyJykge1xuICAgICAgICAgICAgICAgIGlzQWRtaW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0VkaXRvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgaXNEYXRhVmlzUHVibGlzaGVyID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgkKCdpbnB1dDpjaGVja2VkJykudmFsKCkgPT09ICdkYXRhVmlzUHVibGlzaGVyJykge1xuICAgICAgICAgICAgICAgIGlzQWRtaW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0VkaXRvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzRGF0YVZpc1B1Ymxpc2hlciA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpc0FkbWluID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNFZGl0b3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0RhdGFWaXNQdWJsaXNoZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmZvcm0tY3JlYXRlLXVzZXInKS5zdWJtaXQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gJCgnI2NyZWF0ZS11c2VyLXVzZXJuYW1lJykudmFsKCk7XG4gICAgICAgICAgICB2YXIgZW1haWwgPSAkKCcjY3JlYXRlLXVzZXItZW1haWwnKS52YWwoKTtcbiAgICAgICAgICAgIHZhciBwYXNzd29yZCA9ICQoJyNjcmVhdGUtdXNlci1wYXNzd29yZCcpLnZhbCgpO1xuXG4gICAgICAgICAgICBpZiAodXNlcm5hbWUubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJQbGVhc2UgZW50ZXIgYSB1c2VyIG5hbWUuXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGVtYWlsLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICBzd2VldEFsZXJ0KFwiUGxlYXNlIGVudGVyIGEgdXNlciBuYW1lLlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXNzd29yZC5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAgICAgc3dlZXRBbGVydChcIlBsZWFzZSBlbnRlciBhIHBhc3N3b3JkLlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3N0VXNlcih1c2VybmFtZSwgZW1haWwsIHBhc3N3b3JkLCBpc0FkbWluLCBpc0VkaXRvciwgaXNEYXRhVmlzUHVibGlzaGVyKTtcbiAgICAgICAgICAgIHZpZXdVc2VycygpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHZpZXdXb3Jrc3BhY2UocGF0aCwgY29sbGVjdGlvbklkLCBtZW51KSB7XG5cbiAgdmFyIGN1cnJlbnRQYXRoID0gJyc7XG4gIGlmIChwYXRoKSB7XG4gICAgY3VycmVudFBhdGggPSBwYXRoO1xuICB9XG4gIEZsb3JlbmNlLmdsb2JhbFZhcnMucGFnZVBhdGggPSBjdXJyZW50UGF0aDtcblxuICBpZiAobWVudSA9PT0gJ2Jyb3dzZScpIHtcbiAgICAkKCcubmF2X19pdGVtLS13b3Jrc3BhY2UnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAkKFwiI2Jyb3dzZVwiKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBsb2FkQnJvd3NlU2NyZWVuKGNvbGxlY3Rpb25JZCwgJ2NsaWNrJyk7XG4gIH1cbiAgZWxzZSBpZiAobWVudSA9PT0gJ2NyZWF0ZScpIHtcbiAgICAkKCcubmF2X19pdGVtLS13b3Jrc3BhY2UnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAkKFwiI2NyZWF0ZVwiKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBsb2FkQ3JlYXRlU2NyZWVuKGN1cnJlbnRQYXRoLCBjb2xsZWN0aW9uSWQpO1xuICB9XG4gIGVsc2UgaWYgKG1lbnUgPT09ICdlZGl0Jykge1xuICAgICQoJy5uYXZfX2l0ZW0tLXdvcmtzcGFjZScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICQoXCIjZWRpdFwiKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKGN1cnJlbnRQYXRoLCBjb2xsZWN0aW9uSWQpO1xuICB9XG59XG5cbi8qKlxuICogRWRpdG9yIHNjcmVlbiBmb3IgdXBsb2FkaW5nIHZpc3VhbGlzYXRpb25zXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkXG4gKiBAcGFyYW0gZGF0YVxuICovXG5cbmZ1bmN0aW9uIHZpc3VhbGlzYXRpb25FZGl0b3IoY29sbGVjdGlvbklkLCBkYXRhKSB7XG4gICAgdmFyIHBhdGggPSBkYXRhLnVyaSxcbiAgICAgICAgJGZpbGVJbnB1dCA9ICQoJyNpbnB1dC12aXMnKSxcbiAgICAgICAgJGZpbGVGb3JtID0gJCgnI3VwbG9hZC12aXMnKSxcbiAgICAgICAgaSwgc2V0QWN0aXZlVGFiLCBnZXRBY3RpdmVUYWI7XG5cbiAgICAvLyBBY3RpdmUgdGFiXG4gICAgJChcIi5lZGl0LWFjY29yZGlvblwiKS5vbignYWNjb3JkaW9uYWN0aXZhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNldEFjdGl2ZVRhYiA9ICQoXCIuZWRpdC1hY2NvcmRpb25cIikuYWNjb3JkaW9uKFwib3B0aW9uXCIsIFwiYWN0aXZlXCIpO1xuICAgICAgICBpZiAoc2V0QWN0aXZlVGFiICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgRmxvcmVuY2UuZ2xvYmFsVmFycy5hY3RpdmVUYWIgPSBzZXRBY3RpdmVUYWI7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBnZXRBY3RpdmVUYWIgPSBGbG9yZW5jZS5nbG9iYWxWYXJzLmFjdGl2ZVRhYjtcbiAgICBhY2NvcmRpb24oZ2V0QWN0aXZlVGFiKTtcbiAgICBnZXRMYXN0UG9zaXRpb24oKTtcblxuICAgIC8vIFVwZGF0ZSBoaWRkZW4gc2VsZWN0IHRvIGRpc3BsYXkgYWxsIEhUTUwgZmlsZXMgaW4gWklQXG4gICAgdmFyIHNlbGVjdE9wdGlvbnMgPSBbXCI8b3B0aW9uIHZhbHVlPScnPi0tIFNlbGVjdCBhbiBIVE1MIGZpbGUgdG8gcHJldmlldyAtLTwvb3B0aW9uPlwiXSxcbiAgICAgICAgJHNlbGVjdFdyYXBwZXIgPSAkKCcjc2VsZWN0LXZpcy13cmFwcGVyJyk7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5maWxlbmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc2VsZWN0T3B0aW9ucy5wdXNoKFwiPG9wdGlvbiB2YWx1ZT0nXCIgKyBkYXRhLmZpbGVuYW1lc1tpXSArIFwiJz5cIiArIGRhdGEuZmlsZW5hbWVzW2ldICsgXCI8L29wdGlvbj5cIilcbiAgICB9XG4gICAgJHNlbGVjdFdyYXBwZXIuZmluZCgnc2VsZWN0JykuZW1wdHkoKS5hcHBlbmQoc2VsZWN0T3B0aW9ucy5qb2luKCcnKSk7XG4gICAgJHNlbGVjdFdyYXBwZXIuc2hvdygpO1xuICAgICQoJyNicm93c2VyLWxvY2F0aW9uJykuaGlkZSgpO1xuICAgICQoJy5icm93c2VyLmRpc2FibGVkJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cbiAgICAvLyBCaW5kIHRvIHNlbGVjdCdzIGNoYW5nZSBhbmQgdG9nZ2xlIHByZXZpZXcgdG8gc2VsZWN0ZWQgSFRNTCBmaWxlXG4gICAgJCgnI3NlbGVjdC12aXMtcHJldmlldycpLmNoYW5nZShmdW5jdGlvbigpIHtcbiAgICAgICAgcmVmcmVzaFZpc1ByZXZpZXcoXCIvXCIgKyAkKHRoaXMpLnZhbCgpKTtcbiAgICB9KTtcblxuICAgIC8vIERpc2FibGUgcHJldmlldyB3aGVuIG5hdmlnYXRpbmcgYmFjayB0byBicm93c2UgdGFiXG4gICAgJCgnI2Jyb3dzZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2VsZWN0V3JhcHBlci5oaWRlKCk7XG4gICAgICAgICQoJyNicm93c2VyLWxvY2F0aW9uJykuc2hvdygpO1xuICAgICAgICAkKCcuYnJvd3NlcicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICB1cGRhdGVCcm93c2VyVVJMKFwiL1wiKTtcbiAgICAgICAgJCgnI2lmcmFtZScpLmF0dHIoJ3NyYycsIEZsb3JlbmNlLmJhYmJhZ2VCYXNlVXJsKTtcbiAgICB9KTtcblxuICAgIC8vIFN1Ym1pdCBuZXcgWklQIGZpbGVcbiAgICBiaW5kWmlwU3VibWl0KCk7XG5cbiAgICAvLyBCaW5kIGZpbGUgc2F2ZSB0byB0aGUgY2hhbmdlIGV2ZW50IG9mIHRoZSBmaWxlIGlucHV0XG4gICAgJGZpbGVJbnB1dC5vbignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGRhdGEuemlwVGl0bGUgPSAoJCh0aGlzKS52YWwoKSkuc3BsaXQoJ1xcXFwnKS5wb3AoKTtcbiAgICAgICAgJGZpbGVGb3JtLnN1Ym1pdCgpO1xuICAgIH0pO1xuXG4gICAgLy8gQmluZCBzYXZlIGJ1dHRvbnNcbiAgICB2YXIgZWRpdE5hdiA9ICQoJy5lZGl0LW5hdicpO1xuICAgIGVkaXROYXYub2ZmKCk7IC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgZXZlbnQgaGFuZGxlcnMuXG5cbiAgICBlZGl0TmF2Lm9uKCdjbGljaycsICcuYnRuLWVkaXQtc2F2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2F2ZSgpO1xuICAgIH0pO1xuXG4gICAgZWRpdE5hdi5vbignY2xpY2snLCAnLmJ0bi1lZGl0LXNhdmUtYW5kLXN1Ym1pdC1mb3ItcmV2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlQW5kQ29tcGxldGVDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLCB0cnVlKTtcbiAgICB9KTtcblxuICAgIGVkaXROYXYub24oJ2NsaWNrJywgJy5idG4tZWRpdC1zYXZlLWFuZC1zdWJtaXQtZm9yLWFwcHJvdmFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzYXZlQW5kUmV2aWV3Q29udGVudChjb2xsZWN0aW9uSWQsIGRhdGEudXJpLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgdHJ1ZSk7XG4gICAgfSk7XG5cblxuICAgIC8qIEZVTkNUSU9OUyAqL1xuICAgIGZ1bmN0aW9uIGJpbmRaaXBTdWJtaXQoKSB7XG4gICAgICAgIC8vIFVwbG9hZCBaSVAgZmlsZVxuICAgICAgICAkKCcjdXBsb2FkLXZpcycpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuICAgICAgICAgICAgdmFyIGZvcm1kYXRhID0gbmV3IEZvcm1EYXRhKCQodGhpcylbMF0pLFxuICAgICAgICAgICAgICAgIGZpbGUgPSB0aGlzWzBdLmZpbGVzWzBdO1xuXG4gICAgICAgICAgICBpZiAoISQoJyNpbnB1dC12aXMnKSkge1xuICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJQbGVhc2UgY2hvb3NlIGEgZmlsZSBiZWZvcmUgc3VibWl0dGluZ1wiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQoJy5pbnB1dF9fZmlsZScpLmF0dHIoJ2RhdGEtZmlsZS10aXRsZScsICdGaWxlIHVwbG9hZGluZyAuLi4nKTtcblxuICAgICAgICAgICAgdmFyIGZpbGVOYW1lTm9TcGFjZSA9IGZpbGUubmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLl0vZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHZhciB1bmlxdWVJZE5vU3BhY2UgPSBkYXRhLnVpZC5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLl0vZywgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHZhciBjb250ZW50VXJpID0gXCIvdmlzdWFsaXNhdGlvbnMvXCIgKyB1bmlxdWVJZE5vU3BhY2UgKyBcIi9jb250ZW50XCI7XG4gICAgICAgICAgICB2YXIgdXJpVXBsb2FkID0gY29udGVudFVyaSArIFwiL1wiICsgZmlsZU5hbWVOb1NwYWNlO1xuICAgICAgICAgICAgdmFyIHNhZmVVcmlVcGxvYWQgPSBjaGVja1BhdGhTbGFzaGVzKHVyaVVwbG9hZCk7XG5cbiAgICAgICAgICAgIHBhdGggPSBcIi92aXN1YWxpc2F0aW9ucy9cIiArIHVuaXF1ZUlkTm9TcGFjZTtcblxuICAgICAgICAgICAgZGVsZXRlQW5kVXBsb2FkRmlsZShcbiAgICAgICAgICAgICAgICBzYWZlVXJpVXBsb2FkLCBjb250ZW50VXJpLCBmb3JtZGF0YSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB1bnBhY2taaXAoc2FmZVVyaVVwbG9hZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPbiB1bnBhY2sgb2YgWmlwIHJlZnJlc2ggdGhlIHJlbG9hZCBlZGl0b3IgYW5kIHByZXZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKHBhdGgsIGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlZnJlc2ggcHJldmlldyAoZG9uJ3QgdXNlIGdsb2JhbCByZWZyZXNoUHJldmlldyBmdW5jdGlvbiBiZWNhdXNlIHdlIHdhbnQgZG8gb3RoZXIgZnVuY3Rpb25zIGF0IHRoZSBzYW1lIHRpbWUgd2hlbiBzZWxlY3RpbmcgZGlmZmVyZW50IEhUTUwgZmlsZXMpXG4gICAgZnVuY3Rpb24gcmVmcmVzaFZpc1ByZXZpZXcodXJsKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWUnKS5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWYgPSBGbG9yZW5jZS5iYWJiYWdlQmFzZVVybCArIHBhdGggKyB1cmw7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVsZXRlQW5kVXBsb2FkRmlsZShwYXRoLCBjb250ZW50VXJpLCBmb3JtRGF0YSwgc3VjY2Vzcykge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL0RhdGFWaXN1YWxpc2F0aW9uWmlwL1wiICsgRmxvcmVuY2UuY29sbGVjdGlvbi5pZCArIFwiP3ppcFBhdGg9XCIgKyBjb250ZW50VXJpLFxuICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICBhc3luYzogZmFsc2UsXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB1cGxvYWRGaWxlKHBhdGgsIGZvcm1EYXRhLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlQXBpRXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGxvYWRGaWxlKHBhdGgsIGZvcm1EYXRhLCBzdWNjZXNzKSB7XG4gICAgICAgIC8vIFNlbmQgemlwIGZpbGUgdG8gemViZWRlZVxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi96ZWJlZGVlL2NvbnRlbnQvXCIgKyBGbG9yZW5jZS5jb2xsZWN0aW9uLmlkICsgXCI/dXJpPVwiICsgcGF0aCxcbiAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzcyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZUFwaUVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW5wYWNrWmlwKHppcFBhdGgsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgIC8vIFVucGFjayBjb250ZW50cyBvZiBaSVBcbiAgICAgICAgY29uc29sZS5sb2coXCJVbnBhY2s6IFwiICsgemlwUGF0aCk7XG4gICAgICAgIHZhciB1cmwgPSBcIi96ZWJlZGVlL0RhdGFWaXN1YWxpc2F0aW9uWmlwL1wiICsgRmxvcmVuY2UuY29sbGVjdGlvbi5pZCArIFwiP3ppcFBhdGg9XCIgKyB6aXBQYXRoO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYXZlKCkge1xuICAgICAgICBwdXRDb250ZW50KGNvbGxlY3Rpb25JZCwgZGF0YS51cmksIEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBGbG9yZW5jZS5FZGl0b3IuaXNEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIHJlZnJlc2hWaXNQcmV2aWV3KCk7XG4gICAgICAgICAgICAgICAgLy8gcmVmcmVzaFByZXZpZXcoKTtcbiAgICAgICAgICAgICAgICBsb2FkUGFnZURhdGFJbnRvRWRpdG9yKGRhdGEudXJpLCBjb2xsZWN0aW9uSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7XG4gICAgICAgICAgICAgICAgICAgIHN3ZWV0QWxlcnQoXCJDYW5ub3QgZWRpdCB0aGlzIHBhZ2VcIiwgXCJJdCBpcyBhbHJlYWR5IHBhcnQgb2YgYW5vdGhlciBjb2xsZWN0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVBcGlFcnJvcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcbiAgICB9XG59XG4vKipcbiAqIFJlZ2lzdGVycyBzZXJ2aWNlIHdvcmtlciAoaW4gcm9vdCBvZiBGbG9yZW5jZSlcbiAqL1xuXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi4vZmxvcmVuY2Uvc2VydmljZS13b3JrZXIuanMnKS50aGVuKGZ1bmN0aW9uKHJlZ2lzdHJhdGlvbikge1xuICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciByZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bCB3aXRoIHNjb3BlOicsICByZWdpc3RyYXRpb24uc2NvcGUpO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH0pO1xufVxuLyoqXG4gKiAgQSBzaW1wbGUgalF1ZXJ5IGFjY29yZGlvblxuICogIFJlcXVpcmVzIGEgY29udGFpbmVyICgnanMtYWNjb3JkaW9uJyksIGEgdGl0bGUgKCdqcy1hY2NvcmRpb25fX3RpdGxlKSBhbmQgdGhlIGNvbnRlbnQgKCdqcy1hY2NvcmRpb25fX2NvbnRlbnQnKVxuICoqL1xuXG5mdW5jdGlvbiBiaW5kQWNjb3JkaW9ucygpIHtcbiAgICB2YXIgJGFjY29yZGlvbnMgPSAkKCcuanMtYWNjb3JkaW9uJyksXG4gICAgICAgICR0aXRsZSA9ICRhY2NvcmRpb25zLmZpbmQoJy5qcy1hY2NvcmRpb25fX3RpdGxlJyk7XG5cbiAgICAvLyBpZiAoJGFjY29yZGlvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gICAgICRhY2NvcmRpb25zLmZpbmQoJy5qcy1hY2NvcmRpb25fX2NvbnRlbnQnKS5hZGRDbGFzcygnYWNjb3JkaW9uX19jb250ZW50LS1ib3JkZXJzJyk7XG4gICAgLy8gfVxuXG4gICAgJHRpdGxlLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgJGFjdGl2ZUFjY29yZGlvbnMgPSAkKCcuanMtYWNjb3JkaW9uIC5hY3RpdmUnKSxcbiAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIC8vIFJlbW92ZSBjbGFzcyB0aGF0IGRpc2FibGVzIGFuaW1hdGlvbnMgb24gbG9hZFxuICAgICAgICAkdGhpcy5uZXh0KCcuanMtYWNjb3JkaW9uX19jb250ZW50JykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGUtYW5pbWF0aW9uJyk7XG5cbiAgICAgICAgLy8gRGV0ZWN0IHdoZXRoZXIgdGhlIGFjY29yZGlvbiBpcyBhY3RpdmUgYWxyZWFkeSBvciBub3RcbiAgICAgICAgaWYgKCR0aGlzLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERlc2VsZWN0IGFueSBhY2NvcmRpb25zIGFscmVhZHkgYWN0aXZlXG4gICAgICAgICRhY3RpdmVBY2NvcmRpb25zLmNsb3Nlc3QoJy5qcy1hY2NvcmRpb24nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICRhY3RpdmVBY2NvcmRpb25zLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAvLyBBY3RpdmF0ZSBjbGlja2VkIGFjY29yZGlvbiBpZiBpdCB3YXNuJ3QgYWxyZWFkeVxuICAgICAgICBpZiAoIWFjdGl2ZSkge1xuICAgICAgICAgICAgJHRoaXMuY2xvc2VzdCgnLmpzLWFjY29yZGlvbicpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICR0aGlzLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICR0aGlzLm5leHQoJy5qcy1hY2NvcmRpb25fX2NvbnRlbnQnKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufVxuLyoqXG4gKiBDb250cm9scyB0aGUgZW5oYW5jZWQgZmlsZSBpbnB1dCB0eXBlLCBpbnB1dHMgaXMgaGlkZGVuIG9mZiBvZiBwYWdlIHNvIGphdmFzY3JpcHQgcGVyZm9ybXMgZnVuY3Rpb25zIHRoYXQgeW91J2Qgc2VlIGhhcHBlbiBuYXRpdmVseVxuICovXG5cbiQoZnVuY3Rpb24oKSB7XG4gICAgdmFyICRib2R5ID0gJCgnYm9keScpO1xuXG4gICAgLy8gVXBkYXRlIGZpbGUgbmFtZSBiZWluZyBkaXNwbGF5ZWQgd2hlbiBhIG5ldyBvbmUgaXMgdXBsb2FkZWRcbiAgICAkYm9keS5vbignY2hhbmdlJywgJy5pbnB1dF9fZmlsZSBpbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgZmlsZU5hbWUgPSAoJHRoaXMudmFsKCkpLnNwbGl0KCdcXFxcJykucG9wKCk7IC8vIHNwbGl0IGZpbGUgcGF0aCBieSBiYWNrc2xhc2hlcyBpbnRvIGFuIGFycmF5IGFuZCB1c2UgbGFzdCBlbnRyeVxuXG4gICAgICAgICR0aGlzLmNsb3Nlc3QoJ2xhYmVsJykuYXR0cignZGF0YS1maWxlLXRpdGxlJywgZmlsZU5hbWUpO1xuICAgIH0pO1xuXG4gICAgLy8gRm9jdXMgc3RhdGVcbiAgICB2YXIgJGZpbGVJbnB1dDtcbiAgICAkYm9keS5vbignZm9jdXNpbicsICcuaW5wdXRfX2ZpbGUgaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJGZpbGVJbnB1dCA9ICQoJy5pbnB1dF9fZmlsZScpO1xuICAgICAgICAkZmlsZUlucHV0LmFkZENsYXNzKCdmb2N1cycpO1xuICAgIH0pO1xuICAgICRib2R5Lm9uKCdmb2N1c291dCcsICcuaW5wdXRfX2ZpbGUgaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJGZpbGVJbnB1dC5yZW1vdmVDbGFzcygnZm9jdXMnKTtcbiAgICB9KVxufSk7XG4vKipcbiAqIEhpZGUgcGFuZWwgb2ZmLXNjcmVlblxuICogQHBhcmFtIG9wdGlvbnMgPSBvcHRpb25zIHRoYXQgY2FuIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gdG8gcGVyZm9ybVxuICpcbiAqIEBvcHRpb24gb25IaWRlID0gZnVuY3Rpb24gdG8gcnVuIGF0IHRoZSBlbmQgb2YgdGhlIGhpZGUgYW5pbWF0aW9uXG4gKiBAb3B0aW9ucyBtb3ZlQ2VudGVyZWRQYW5lbCA9IGlmIHRydWUgdGhlbiByZW1vdmUgbWFyZ2luIGZyb20gdGhlIGNlbnRlcmVkIHNlbGVjdGFibGUgcGFuZWxcbiAqL1xuXG5mdW5jdGlvbiBoaWRlUGFuZWwob3B0aW9ucykge1xuICAgICQoJy5qcy1zZWxlY3RhYmxlLXRhYmxlIHRib2R5IHRyJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cbiAgICBpZiAob3B0aW9ucy5vbkhpZGUpIHtcbiAgICAgICAgLy8gUnVuIGFueSBmdW5jdGlvbnMgc2V0IHRvIHJ1biBvbmNlIHRoZSBvZmYtc2NyZWVuIHBhbmVsIGlzIGhpZGRlblxuICAgICAgICAkKCcucGFuZWwtLW9mZi1jYW52YXMnKS5zdG9wKCkuYW5pbWF0ZSh7cmlnaHQ6IFwiLTUwJVwifSwgNTAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG9wdGlvbnMub25IaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIERlZmF1bHQgdG8ganVzdCBoaWRpbmcgb2ZmLXNjcmVlbiBwYW5lbFxuICAgICAgICAkKCcucGFuZWwtLW9mZi1jYW52YXMnKS5zdG9wKCkuYW5pbWF0ZSh7cmlnaHQ6IFwiLTUwJVwifSwgNTAwKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5tb3ZlQ2VudGVyZWRQYW5lbCkge1xuICAgICAgICAvLyBBZGQgdGhlIGRlZmF1bHQgbWFyZ2luIGJhY2sgaW4gZm9yIHRoZSBjZW50ZXJlZCBwYW5lbFxuICAgICAgICAkKCcucGFuZWwtLWNlbnRyZWQnKS5hbmltYXRlKHttYXJnaW5MZWZ0OiBcIjI1JVwifSwgODAwKTtcbiAgICB9XG59XG4vKipcbiAqIEFuaW1hdGUgb2ZmLXNjcmVlbiBwYW5lbCB0byBhcHBlYXIgb24tc2NyZWVuXG4gKlxuICogQHBhcmFtICR0aGlzID0gdGhlIHRhYmxlIGl0ZW0gdGhhdCBoYXMgYmVlbiBzZWxlY3RlZFxuICogQHBhcmFtIG9wdGlvbnMgPSBvYmplY3Qgb2Ygb3B0aW9ucyBmb3IgdGhlIGZ1bmN0aW9uIHRvIHVzZVxuICpcbiAqIEBvcHRpb25zIGh0bWwgPSBjb250ZW50cyBvZiB0aGUgcGFuZWwvc2xpZGVyXG4gKiBAb3B0aW9ucyBtb3ZlQ2VudGVyZWRQYW5lbCA9IGlmIHRydWUgdGhlbiByZW1vdmUgbWFyZ2luIGZyb20gdGhlIGNlbnRlcmVkIHNlbGVjdGFibGUgcGFuZWxcbiAqL1xuXG5mdW5jdGlvbiBzaG93UGFuZWwoJHRoaXMsIG9wdGlvbnMpIHtcblxuICAgIGlmICgkdGhpcykge1xuICAgICAgICAkKCcuanMtc2VsZWN0YWJsZS10YWJsZSB0Ym9keSB0cicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAkdGhpcy5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5odG1sKSB7XG4gICAgICAgICQoJy5wYW5lbC0tb2ZmLWNhbnZhcycpLmh0bWwob3B0aW9ucy5odG1sKS5hbmltYXRlKHtyaWdodDogXCIwJVwifSwgNTAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKCcucGFuZWwtLW9mZi1jYW52YXMnKS5hbmltYXRlKHtyaWdodDogXCIwJVwifSwgNTAwKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5tb3ZlQ2VudGVyZWRQYW5lbCkge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIG1hcmdpbiBmcm9tIHRoZSBjZW50ZXJlZCBwYW5lbCB0byBtYWtlIHJvb20gZm9yIG9mZi1zY3JlZW4gcGFuZWxcbiAgICAgICAgJCgnLnBhbmVsLS1jZW50cmVkJykuYW5pbWF0ZSh7bWFyZ2luTGVmdDogXCIwXCJ9LCA1MDApO1xuICAgIH1cbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2Fzc2V0cy9qcy9tYWluLmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 1 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(global) {/*global window, global*/\nvar util = __webpack_require__(2)\nvar assert = __webpack_require__(6)\nvar now = __webpack_require__(7)\n\nvar slice = Array.prototype.slice\nvar console\nvar times = {}\n\nif (typeof global !== \"undefined\" && global.console) {\n    console = global.console\n} else if (typeof window !== \"undefined\" && window.console) {\n    console = window.console\n} else {\n    console = {}\n}\n\nvar functions = [\n    [log, \"log\"],\n    [info, \"info\"],\n    [warn, \"warn\"],\n    [error, \"error\"],\n    [time, \"time\"],\n    [timeEnd, \"timeEnd\"],\n    [trace, \"trace\"],\n    [dir, \"dir\"],\n    [consoleAssert, \"assert\"]\n]\n\nfor (var i = 0; i < functions.length; i++) {\n    var tuple = functions[i]\n    var f = tuple[0]\n    var name = tuple[1]\n\n    if (!console[name]) {\n        console[name] = f\n    }\n}\n\nmodule.exports = console\n\nfunction log() {}\n\nfunction info() {\n    console.log.apply(console, arguments)\n}\n\nfunction warn() {\n    console.log.apply(console, arguments)\n}\n\nfunction error() {\n    console.warn.apply(console, arguments)\n}\n\nfunction time(label) {\n    times[label] = now()\n}\n\nfunction timeEnd(label) {\n    var time = times[label]\n    if (!time) {\n        throw new Error(\"No such label: \" + label)\n    }\n\n    var duration = now() - time\n    console.log(label + \": \" + duration + \"ms\")\n}\n\nfunction trace() {\n    var err = new Error()\n    err.name = \"Trace\"\n    err.message = util.format.apply(null, arguments)\n    console.error(err.stack)\n}\n\nfunction dir(object) {\n    console.log(util.inspect(object) + \"\\n\")\n}\n\nfunction consoleAssert(expression) {\n    if (!expression) {\n        var arr = slice.call(arguments, 1)\n        assert.ok(false, util.format.apply(null, arr))\n    }\n}\n\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vY29uc29sZS1icm93c2VyaWZ5L2luZGV4LmpzPzY1ZGIiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgd2luZG93LCBnbG9iYWwqL1xudmFyIHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKVxudmFyIGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIilcbnZhciBub3cgPSByZXF1aXJlKFwiZGF0ZS1ub3dcIilcblxudmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlXG52YXIgY29uc29sZVxudmFyIHRpbWVzID0ge31cblxuaWYgKHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgJiYgZ2xvYmFsLmNvbnNvbGUpIHtcbiAgICBjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGVcbn0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB3aW5kb3cuY29uc29sZSkge1xuICAgIGNvbnNvbGUgPSB3aW5kb3cuY29uc29sZVxufSBlbHNlIHtcbiAgICBjb25zb2xlID0ge31cbn1cblxudmFyIGZ1bmN0aW9ucyA9IFtcbiAgICBbbG9nLCBcImxvZ1wiXSxcbiAgICBbaW5mbywgXCJpbmZvXCJdLFxuICAgIFt3YXJuLCBcIndhcm5cIl0sXG4gICAgW2Vycm9yLCBcImVycm9yXCJdLFxuICAgIFt0aW1lLCBcInRpbWVcIl0sXG4gICAgW3RpbWVFbmQsIFwidGltZUVuZFwiXSxcbiAgICBbdHJhY2UsIFwidHJhY2VcIl0sXG4gICAgW2RpciwgXCJkaXJcIl0sXG4gICAgW2NvbnNvbGVBc3NlcnQsIFwiYXNzZXJ0XCJdXG5dXG5cbmZvciAodmFyIGkgPSAwOyBpIDwgZnVuY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHR1cGxlID0gZnVuY3Rpb25zW2ldXG4gICAgdmFyIGYgPSB0dXBsZVswXVxuICAgIHZhciBuYW1lID0gdHVwbGVbMV1cblxuICAgIGlmICghY29uc29sZVtuYW1lXSkge1xuICAgICAgICBjb25zb2xlW25hbWVdID0gZlxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjb25zb2xlXG5cbmZ1bmN0aW9uIGxvZygpIHt9XG5cbmZ1bmN0aW9uIGluZm8oKSB7XG4gICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKVxufVxuXG5mdW5jdGlvbiB3YXJuKCkge1xuICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cylcbn1cblxuZnVuY3Rpb24gZXJyb3IoKSB7XG4gICAgY29uc29sZS53YXJuLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cylcbn1cblxuZnVuY3Rpb24gdGltZShsYWJlbCkge1xuICAgIHRpbWVzW2xhYmVsXSA9IG5vdygpXG59XG5cbmZ1bmN0aW9uIHRpbWVFbmQobGFiZWwpIHtcbiAgICB2YXIgdGltZSA9IHRpbWVzW2xhYmVsXVxuICAgIGlmICghdGltZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBzdWNoIGxhYmVsOiBcIiArIGxhYmVsKVxuICAgIH1cblxuICAgIHZhciBkdXJhdGlvbiA9IG5vdygpIC0gdGltZVxuICAgIGNvbnNvbGUubG9nKGxhYmVsICsgXCI6IFwiICsgZHVyYXRpb24gKyBcIm1zXCIpXG59XG5cbmZ1bmN0aW9uIHRyYWNlKCkge1xuICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoKVxuICAgIGVyci5uYW1lID0gXCJUcmFjZVwiXG4gICAgZXJyLm1lc3NhZ2UgPSB1dGlsLmZvcm1hdC5hcHBseShudWxsLCBhcmd1bWVudHMpXG4gICAgY29uc29sZS5lcnJvcihlcnIuc3RhY2spXG59XG5cbmZ1bmN0aW9uIGRpcihvYmplY3QpIHtcbiAgICBjb25zb2xlLmxvZyh1dGlsLmluc3BlY3Qob2JqZWN0KSArIFwiXFxuXCIpXG59XG5cbmZ1bmN0aW9uIGNvbnNvbGVBc3NlcnQoZXhwcmVzc2lvbikge1xuICAgIGlmICghZXhwcmVzc2lvbikge1xuICAgICAgICB2YXIgYXJyID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpXG4gICAgICAgIGFzc2VydC5vayhmYWxzZSwgdXRpbC5mb3JtYXQuYXBwbHkobnVsbCwgYXJyKSlcbiAgICB9XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vY29uc29sZS1icm93c2VyaWZ5L2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(global, process, console) {// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = __webpack_require__(4);\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = __webpack_require__(5);\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }()), __webpack_require__(3), __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vdXRpbC91dGlsLmpzPzFlMzAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IEpveWVudCwgSW5jLiBhbmQgb3RoZXIgTm9kZSBjb250cmlidXRvcnMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGFcbi8vIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbi8vIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZ1xuLy8gd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLFxuLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdFxuLy8gcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlXG4vLyBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZFxuLy8gaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTU1xuLy8gT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRlxuLy8gTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTlxuLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sXG4vLyBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Jcbi8vIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEVcbi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbnZhciBmb3JtYXRSZWdFeHAgPSAvJVtzZGolXS9nO1xuZXhwb3J0cy5mb3JtYXQgPSBmdW5jdGlvbihmKSB7XG4gIGlmICghaXNTdHJpbmcoZikpIHtcbiAgICB2YXIgb2JqZWN0cyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBvYmplY3RzLnB1c2goaW5zcGVjdChhcmd1bWVudHNbaV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdHMuam9pbignICcpO1xuICB9XG5cbiAgdmFyIGkgPSAxO1xuICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgdmFyIGxlbiA9IGFyZ3MubGVuZ3RoO1xuICB2YXIgc3RyID0gU3RyaW5nKGYpLnJlcGxhY2UoZm9ybWF0UmVnRXhwLCBmdW5jdGlvbih4KSB7XG4gICAgaWYgKHggPT09ICclJScpIHJldHVybiAnJSc7XG4gICAgaWYgKGkgPj0gbGVuKSByZXR1cm4geDtcbiAgICBzd2l0Y2ggKHgpIHtcbiAgICAgIGNhc2UgJyVzJzogcmV0dXJuIFN0cmluZyhhcmdzW2krK10pO1xuICAgICAgY2FzZSAnJWQnOiByZXR1cm4gTnVtYmVyKGFyZ3NbaSsrXSk7XG4gICAgICBjYXNlICclaic6XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZ3NbaSsrXSk7XG4gICAgICAgIH0gY2F0Y2ggKF8pIHtcbiAgICAgICAgICByZXR1cm4gJ1tDaXJjdWxhcl0nO1xuICAgICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4geDtcbiAgICB9XG4gIH0pO1xuICBmb3IgKHZhciB4ID0gYXJnc1tpXTsgaSA8IGxlbjsgeCA9IGFyZ3NbKytpXSkge1xuICAgIGlmIChpc051bGwoeCkgfHwgIWlzT2JqZWN0KHgpKSB7XG4gICAgICBzdHIgKz0gJyAnICsgeDtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyICs9ICcgJyArIGluc3BlY3QoeCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzdHI7XG59O1xuXG5cbi8vIE1hcmsgdGhhdCBhIG1ldGhvZCBzaG91bGQgbm90IGJlIHVzZWQuXG4vLyBSZXR1cm5zIGEgbW9kaWZpZWQgZnVuY3Rpb24gd2hpY2ggd2FybnMgb25jZSBieSBkZWZhdWx0LlxuLy8gSWYgLS1uby1kZXByZWNhdGlvbiBpcyBzZXQsIHRoZW4gaXQgaXMgYSBuby1vcC5cbmV4cG9ydHMuZGVwcmVjYXRlID0gZnVuY3Rpb24oZm4sIG1zZykge1xuICAvLyBBbGxvdyBmb3IgZGVwcmVjYXRpbmcgdGhpbmdzIGluIHRoZSBwcm9jZXNzIG9mIHN0YXJ0aW5nIHVwLlxuICBpZiAoaXNVbmRlZmluZWQoZ2xvYmFsLnByb2Nlc3MpKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGV4cG9ydHMuZGVwcmVjYXRlKGZuLCBtc2cpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfVxuXG4gIGlmIChwcm9jZXNzLm5vRGVwcmVjYXRpb24gPT09IHRydWUpIHtcbiAgICByZXR1cm4gZm47XG4gIH1cblxuICB2YXIgd2FybmVkID0gZmFsc2U7XG4gIGZ1bmN0aW9uIGRlcHJlY2F0ZWQoKSB7XG4gICAgaWYgKCF3YXJuZWQpIHtcbiAgICAgIGlmIChwcm9jZXNzLnRocm93RGVwcmVjYXRpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICB9IGVsc2UgaWYgKHByb2Nlc3MudHJhY2VEZXByZWNhdGlvbikge1xuICAgICAgICBjb25zb2xlLnRyYWNlKG1zZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKG1zZyk7XG4gICAgICB9XG4gICAgICB3YXJuZWQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIHJldHVybiBkZXByZWNhdGVkO1xufTtcblxuXG52YXIgZGVidWdzID0ge307XG52YXIgZGVidWdFbnZpcm9uO1xuZXhwb3J0cy5kZWJ1Z2xvZyA9IGZ1bmN0aW9uKHNldCkge1xuICBpZiAoaXNVbmRlZmluZWQoZGVidWdFbnZpcm9uKSlcbiAgICBkZWJ1Z0Vudmlyb24gPSBwcm9jZXNzLmVudi5OT0RFX0RFQlVHIHx8ICcnO1xuICBzZXQgPSBzZXQudG9VcHBlckNhc2UoKTtcbiAgaWYgKCFkZWJ1Z3Nbc2V0XSkge1xuICAgIGlmIChuZXcgUmVnRXhwKCdcXFxcYicgKyBzZXQgKyAnXFxcXGInLCAnaScpLnRlc3QoZGVidWdFbnZpcm9uKSkge1xuICAgICAgdmFyIHBpZCA9IHByb2Nlc3MucGlkO1xuICAgICAgZGVidWdzW3NldF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG1zZyA9IGV4cG9ydHMuZm9ybWF0LmFwcGx5KGV4cG9ydHMsIGFyZ3VtZW50cyk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJyVzICVkOiAlcycsIHNldCwgcGlkLCBtc2cpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVidWdzW3NldF0gPSBmdW5jdGlvbigpIHt9O1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGVidWdzW3NldF07XG59O1xuXG5cbi8qKlxuICogRWNob3MgdGhlIHZhbHVlIG9mIGEgdmFsdWUuIFRyeXMgdG8gcHJpbnQgdGhlIHZhbHVlIG91dFxuICogaW4gdGhlIGJlc3Qgd2F5IHBvc3NpYmxlIGdpdmVuIHRoZSBkaWZmZXJlbnQgdHlwZXMuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBUaGUgb2JqZWN0IHRvIHByaW50IG91dC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIE9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0IHRoYXQgYWx0ZXJzIHRoZSBvdXRwdXQuXG4gKi9cbi8qIGxlZ2FjeTogb2JqLCBzaG93SGlkZGVuLCBkZXB0aCwgY29sb3JzKi9cbmZ1bmN0aW9uIGluc3BlY3Qob2JqLCBvcHRzKSB7XG4gIC8vIGRlZmF1bHQgb3B0aW9uc1xuICB2YXIgY3R4ID0ge1xuICAgIHNlZW46IFtdLFxuICAgIHN0eWxpemU6IHN0eWxpemVOb0NvbG9yXG4gIH07XG4gIC8vIGxlZ2FjeS4uLlxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+PSAzKSBjdHguZGVwdGggPSBhcmd1bWVudHNbMl07XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDQpIGN0eC5jb2xvcnMgPSBhcmd1bWVudHNbM107XG4gIGlmIChpc0Jvb2xlYW4ob3B0cykpIHtcbiAgICAvLyBsZWdhY3kuLi5cbiAgICBjdHguc2hvd0hpZGRlbiA9IG9wdHM7XG4gIH0gZWxzZSBpZiAob3B0cykge1xuICAgIC8vIGdvdCBhbiBcIm9wdGlvbnNcIiBvYmplY3RcbiAgICBleHBvcnRzLl9leHRlbmQoY3R4LCBvcHRzKTtcbiAgfVxuICAvLyBzZXQgZGVmYXVsdCBvcHRpb25zXG4gIGlmIChpc1VuZGVmaW5lZChjdHguc2hvd0hpZGRlbikpIGN0eC5zaG93SGlkZGVuID0gZmFsc2U7XG4gIGlmIChpc1VuZGVmaW5lZChjdHguZGVwdGgpKSBjdHguZGVwdGggPSAyO1xuICBpZiAoaXNVbmRlZmluZWQoY3R4LmNvbG9ycykpIGN0eC5jb2xvcnMgPSBmYWxzZTtcbiAgaWYgKGlzVW5kZWZpbmVkKGN0eC5jdXN0b21JbnNwZWN0KSkgY3R4LmN1c3RvbUluc3BlY3QgPSB0cnVlO1xuICBpZiAoY3R4LmNvbG9ycykgY3R4LnN0eWxpemUgPSBzdHlsaXplV2l0aENvbG9yO1xuICByZXR1cm4gZm9ybWF0VmFsdWUoY3R4LCBvYmosIGN0eC5kZXB0aCk7XG59XG5leHBvcnRzLmluc3BlY3QgPSBpbnNwZWN0O1xuXG5cbi8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQU5TSV9lc2NhcGVfY29kZSNncmFwaGljc1xuaW5zcGVjdC5jb2xvcnMgPSB7XG4gICdib2xkJyA6IFsxLCAyMl0sXG4gICdpdGFsaWMnIDogWzMsIDIzXSxcbiAgJ3VuZGVybGluZScgOiBbNCwgMjRdLFxuICAnaW52ZXJzZScgOiBbNywgMjddLFxuICAnd2hpdGUnIDogWzM3LCAzOV0sXG4gICdncmV5JyA6IFs5MCwgMzldLFxuICAnYmxhY2snIDogWzMwLCAzOV0sXG4gICdibHVlJyA6IFszNCwgMzldLFxuICAnY3lhbicgOiBbMzYsIDM5XSxcbiAgJ2dyZWVuJyA6IFszMiwgMzldLFxuICAnbWFnZW50YScgOiBbMzUsIDM5XSxcbiAgJ3JlZCcgOiBbMzEsIDM5XSxcbiAgJ3llbGxvdycgOiBbMzMsIDM5XVxufTtcblxuLy8gRG9uJ3QgdXNlICdibHVlJyBub3QgdmlzaWJsZSBvbiBjbWQuZXhlXG5pbnNwZWN0LnN0eWxlcyA9IHtcbiAgJ3NwZWNpYWwnOiAnY3lhbicsXG4gICdudW1iZXInOiAneWVsbG93JyxcbiAgJ2Jvb2xlYW4nOiAneWVsbG93JyxcbiAgJ3VuZGVmaW5lZCc6ICdncmV5JyxcbiAgJ251bGwnOiAnYm9sZCcsXG4gICdzdHJpbmcnOiAnZ3JlZW4nLFxuICAnZGF0ZSc6ICdtYWdlbnRhJyxcbiAgLy8gXCJuYW1lXCI6IGludGVudGlvbmFsbHkgbm90IHN0eWxpbmdcbiAgJ3JlZ2V4cCc6ICdyZWQnXG59O1xuXG5cbmZ1bmN0aW9uIHN0eWxpemVXaXRoQ29sb3Ioc3RyLCBzdHlsZVR5cGUpIHtcbiAgdmFyIHN0eWxlID0gaW5zcGVjdC5zdHlsZXNbc3R5bGVUeXBlXTtcblxuICBpZiAoc3R5bGUpIHtcbiAgICByZXR1cm4gJ1xcdTAwMWJbJyArIGluc3BlY3QuY29sb3JzW3N0eWxlXVswXSArICdtJyArIHN0ciArXG4gICAgICAgICAgICdcXHUwMDFiWycgKyBpbnNwZWN0LmNvbG9yc1tzdHlsZV1bMV0gKyAnbSc7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIHN0eWxpemVOb0NvbG9yKHN0ciwgc3R5bGVUeXBlKSB7XG4gIHJldHVybiBzdHI7XG59XG5cblxuZnVuY3Rpb24gYXJyYXlUb0hhc2goYXJyYXkpIHtcbiAgdmFyIGhhc2ggPSB7fTtcblxuICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKHZhbCwgaWR4KSB7XG4gICAgaGFzaFt2YWxdID0gdHJ1ZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGhhc2g7XG59XG5cblxuZnVuY3Rpb24gZm9ybWF0VmFsdWUoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzKSB7XG4gIC8vIFByb3ZpZGUgYSBob29rIGZvciB1c2VyLXNwZWNpZmllZCBpbnNwZWN0IGZ1bmN0aW9ucy5cbiAgLy8gQ2hlY2sgdGhhdCB2YWx1ZSBpcyBhbiBvYmplY3Qgd2l0aCBhbiBpbnNwZWN0IGZ1bmN0aW9uIG9uIGl0XG4gIGlmIChjdHguY3VzdG9tSW5zcGVjdCAmJlxuICAgICAgdmFsdWUgJiZcbiAgICAgIGlzRnVuY3Rpb24odmFsdWUuaW5zcGVjdCkgJiZcbiAgICAgIC8vIEZpbHRlciBvdXQgdGhlIHV0aWwgbW9kdWxlLCBpdCdzIGluc3BlY3QgZnVuY3Rpb24gaXMgc3BlY2lhbFxuICAgICAgdmFsdWUuaW5zcGVjdCAhPT0gZXhwb3J0cy5pbnNwZWN0ICYmXG4gICAgICAvLyBBbHNvIGZpbHRlciBvdXQgYW55IHByb3RvdHlwZSBvYmplY3RzIHVzaW5nIHRoZSBjaXJjdWxhciBjaGVjay5cbiAgICAgICEodmFsdWUuY29uc3RydWN0b3IgJiYgdmFsdWUuY29uc3RydWN0b3IucHJvdG90eXBlID09PSB2YWx1ZSkpIHtcbiAgICB2YXIgcmV0ID0gdmFsdWUuaW5zcGVjdChyZWN1cnNlVGltZXMsIGN0eCk7XG4gICAgaWYgKCFpc1N0cmluZyhyZXQpKSB7XG4gICAgICByZXQgPSBmb3JtYXRWYWx1ZShjdHgsIHJldCwgcmVjdXJzZVRpbWVzKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfVxuXG4gIC8vIFByaW1pdGl2ZSB0eXBlcyBjYW5ub3QgaGF2ZSBwcm9wZXJ0aWVzXG4gIHZhciBwcmltaXRpdmUgPSBmb3JtYXRQcmltaXRpdmUoY3R4LCB2YWx1ZSk7XG4gIGlmIChwcmltaXRpdmUpIHtcbiAgICByZXR1cm4gcHJpbWl0aXZlO1xuICB9XG5cbiAgLy8gTG9vayB1cCB0aGUga2V5cyBvZiB0aGUgb2JqZWN0LlxuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHZhbHVlKTtcbiAgdmFyIHZpc2libGVLZXlzID0gYXJyYXlUb0hhc2goa2V5cyk7XG5cbiAgaWYgKGN0eC5zaG93SGlkZGVuKSB7XG4gICAga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHZhbHVlKTtcbiAgfVxuXG4gIC8vIElFIGRvZXNuJ3QgbWFrZSBlcnJvciBmaWVsZHMgbm9uLWVudW1lcmFibGVcbiAgLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2R3dzUyc2J0KHY9dnMuOTQpLmFzcHhcbiAgaWYgKGlzRXJyb3IodmFsdWUpXG4gICAgICAmJiAoa2V5cy5pbmRleE9mKCdtZXNzYWdlJykgPj0gMCB8fCBrZXlzLmluZGV4T2YoJ2Rlc2NyaXB0aW9uJykgPj0gMCkpIHtcbiAgICByZXR1cm4gZm9ybWF0RXJyb3IodmFsdWUpO1xuICB9XG5cbiAgLy8gU29tZSB0eXBlIG9mIG9iamVjdCB3aXRob3V0IHByb3BlcnRpZXMgY2FuIGJlIHNob3J0Y3V0dGVkLlxuICBpZiAoa2V5cy5sZW5ndGggPT09IDApIHtcbiAgICBpZiAoaXNGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgIHZhciBuYW1lID0gdmFsdWUubmFtZSA/ICc6ICcgKyB2YWx1ZS5uYW1lIDogJyc7XG4gICAgICByZXR1cm4gY3R4LnN0eWxpemUoJ1tGdW5jdGlvbicgKyBuYW1lICsgJ10nLCAnc3BlY2lhbCcpO1xuICAgIH1cbiAgICBpZiAoaXNSZWdFeHAodmFsdWUpKSB7XG4gICAgICByZXR1cm4gY3R4LnN0eWxpemUoUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSwgJ3JlZ2V4cCcpO1xuICAgIH1cbiAgICBpZiAoaXNEYXRlKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIGN0eC5zdHlsaXplKERhdGUucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpLCAnZGF0ZScpO1xuICAgIH1cbiAgICBpZiAoaXNFcnJvcih2YWx1ZSkpIHtcbiAgICAgIHJldHVybiBmb3JtYXRFcnJvcih2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGJhc2UgPSAnJywgYXJyYXkgPSBmYWxzZSwgYnJhY2VzID0gWyd7JywgJ30nXTtcblxuICAvLyBNYWtlIEFycmF5IHNheSB0aGF0IHRoZXkgYXJlIEFycmF5XG4gIGlmIChpc0FycmF5KHZhbHVlKSkge1xuICAgIGFycmF5ID0gdHJ1ZTtcbiAgICBicmFjZXMgPSBbJ1snLCAnXSddO1xuICB9XG5cbiAgLy8gTWFrZSBmdW5jdGlvbnMgc2F5IHRoYXQgdGhleSBhcmUgZnVuY3Rpb25zXG4gIGlmIChpc0Z1bmN0aW9uKHZhbHVlKSkge1xuICAgIHZhciBuID0gdmFsdWUubmFtZSA/ICc6ICcgKyB2YWx1ZS5uYW1lIDogJyc7XG4gICAgYmFzZSA9ICcgW0Z1bmN0aW9uJyArIG4gKyAnXSc7XG4gIH1cblxuICAvLyBNYWtlIFJlZ0V4cHMgc2F5IHRoYXQgdGhleSBhcmUgUmVnRXhwc1xuICBpZiAoaXNSZWdFeHAodmFsdWUpKSB7XG4gICAgYmFzZSA9ICcgJyArIFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSk7XG4gIH1cblxuICAvLyBNYWtlIGRhdGVzIHdpdGggcHJvcGVydGllcyBmaXJzdCBzYXkgdGhlIGRhdGVcbiAgaWYgKGlzRGF0ZSh2YWx1ZSkpIHtcbiAgICBiYXNlID0gJyAnICsgRGF0ZS5wcm90b3R5cGUudG9VVENTdHJpbmcuY2FsbCh2YWx1ZSk7XG4gIH1cblxuICAvLyBNYWtlIGVycm9yIHdpdGggbWVzc2FnZSBmaXJzdCBzYXkgdGhlIGVycm9yXG4gIGlmIChpc0Vycm9yKHZhbHVlKSkge1xuICAgIGJhc2UgPSAnICcgKyBmb3JtYXRFcnJvcih2YWx1ZSk7XG4gIH1cblxuICBpZiAoa2V5cy5sZW5ndGggPT09IDAgJiYgKCFhcnJheSB8fCB2YWx1ZS5sZW5ndGggPT0gMCkpIHtcbiAgICByZXR1cm4gYnJhY2VzWzBdICsgYmFzZSArIGJyYWNlc1sxXTtcbiAgfVxuXG4gIGlmIChyZWN1cnNlVGltZXMgPCAwKSB7XG4gICAgaWYgKGlzUmVnRXhwKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIGN0eC5zdHlsaXplKFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSksICdyZWdleHAnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGN0eC5zdHlsaXplKCdbT2JqZWN0XScsICdzcGVjaWFsJyk7XG4gICAgfVxuICB9XG5cbiAgY3R4LnNlZW4ucHVzaCh2YWx1ZSk7XG5cbiAgdmFyIG91dHB1dDtcbiAgaWYgKGFycmF5KSB7XG4gICAgb3V0cHV0ID0gZm9ybWF0QXJyYXkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cyk7XG4gIH0gZWxzZSB7XG4gICAgb3V0cHV0ID0ga2V5cy5tYXAoZnVuY3Rpb24oa2V5KSB7XG4gICAgICByZXR1cm4gZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5LCBhcnJheSk7XG4gICAgfSk7XG4gIH1cblxuICBjdHguc2Vlbi5wb3AoKTtcblxuICByZXR1cm4gcmVkdWNlVG9TaW5nbGVTdHJpbmcob3V0cHV0LCBiYXNlLCBicmFjZXMpO1xufVxuXG5cbmZ1bmN0aW9uIGZvcm1hdFByaW1pdGl2ZShjdHgsIHZhbHVlKSB7XG4gIGlmIChpc1VuZGVmaW5lZCh2YWx1ZSkpXG4gICAgcmV0dXJuIGN0eC5zdHlsaXplKCd1bmRlZmluZWQnLCAndW5kZWZpbmVkJyk7XG4gIGlmIChpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICB2YXIgc2ltcGxlID0gJ1xcJycgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkucmVwbGFjZSgvXlwifFwiJC9nLCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8nL2csIFwiXFxcXCdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJykgKyAnXFwnJztcbiAgICByZXR1cm4gY3R4LnN0eWxpemUoc2ltcGxlLCAnc3RyaW5nJyk7XG4gIH1cbiAgaWYgKGlzTnVtYmVyKHZhbHVlKSlcbiAgICByZXR1cm4gY3R4LnN0eWxpemUoJycgKyB2YWx1ZSwgJ251bWJlcicpO1xuICBpZiAoaXNCb29sZWFuKHZhbHVlKSlcbiAgICByZXR1cm4gY3R4LnN0eWxpemUoJycgKyB2YWx1ZSwgJ2Jvb2xlYW4nKTtcbiAgLy8gRm9yIHNvbWUgcmVhc29uIHR5cGVvZiBudWxsIGlzIFwib2JqZWN0XCIsIHNvIHNwZWNpYWwgY2FzZSBoZXJlLlxuICBpZiAoaXNOdWxsKHZhbHVlKSlcbiAgICByZXR1cm4gY3R4LnN0eWxpemUoJ251bGwnLCAnbnVsbCcpO1xufVxuXG5cbmZ1bmN0aW9uIGZvcm1hdEVycm9yKHZhbHVlKSB7XG4gIHJldHVybiAnWycgKyBFcnJvci5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgKyAnXSc7XG59XG5cblxuZnVuY3Rpb24gZm9ybWF0QXJyYXkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cykge1xuICB2YXIgb3V0cHV0ID0gW107XG4gIGZvciAodmFyIGkgPSAwLCBsID0gdmFsdWUubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgaWYgKGhhc093blByb3BlcnR5KHZhbHVlLCBTdHJpbmcoaSkpKSB7XG4gICAgICBvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLFxuICAgICAgICAgIFN0cmluZyhpKSwgdHJ1ZSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXRwdXQucHVzaCgnJyk7XG4gICAgfVxuICB9XG4gIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAoIWtleS5tYXRjaCgvXlxcZCskLykpIHtcbiAgICAgIG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsXG4gICAgICAgICAga2V5LCB0cnVlKSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuXG5mdW5jdGlvbiBmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLCBrZXksIGFycmF5KSB7XG4gIHZhciBuYW1lLCBzdHIsIGRlc2M7XG4gIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHZhbHVlLCBrZXkpIHx8IHsgdmFsdWU6IHZhbHVlW2tleV0gfTtcbiAgaWYgKGRlc2MuZ2V0KSB7XG4gICAgaWYgKGRlc2Muc2V0KSB7XG4gICAgICBzdHIgPSBjdHguc3R5bGl6ZSgnW0dldHRlci9TZXR0ZXJdJywgJ3NwZWNpYWwnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyID0gY3R4LnN0eWxpemUoJ1tHZXR0ZXJdJywgJ3NwZWNpYWwnKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRlc2Muc2V0KSB7XG4gICAgICBzdHIgPSBjdHguc3R5bGl6ZSgnW1NldHRlcl0nLCAnc3BlY2lhbCcpO1xuICAgIH1cbiAgfVxuICBpZiAoIWhhc093blByb3BlcnR5KHZpc2libGVLZXlzLCBrZXkpKSB7XG4gICAgbmFtZSA9ICdbJyArIGtleSArICddJztcbiAgfVxuICBpZiAoIXN0cikge1xuICAgIGlmIChjdHguc2Vlbi5pbmRleE9mKGRlc2MudmFsdWUpIDwgMCkge1xuICAgICAgaWYgKGlzTnVsbChyZWN1cnNlVGltZXMpKSB7XG4gICAgICAgIHN0ciA9IGZvcm1hdFZhbHVlKGN0eCwgZGVzYy52YWx1ZSwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHIgPSBmb3JtYXRWYWx1ZShjdHgsIGRlc2MudmFsdWUsIHJlY3Vyc2VUaW1lcyAtIDEpO1xuICAgICAgfVxuICAgICAgaWYgKHN0ci5pbmRleE9mKCdcXG4nKSA+IC0xKSB7XG4gICAgICAgIGlmIChhcnJheSkge1xuICAgICAgICAgIHN0ciA9IHN0ci5zcGxpdCgnXFxuJykubWFwKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiAnICAnICsgbGluZTtcbiAgICAgICAgICB9KS5qb2luKCdcXG4nKS5zdWJzdHIoMik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RyID0gJ1xcbicgKyBzdHIuc3BsaXQoJ1xcbicpLm1hcChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gJyAgICcgKyBsaW5lO1xuICAgICAgICAgIH0pLmpvaW4oJ1xcbicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0ciA9IGN0eC5zdHlsaXplKCdbQ2lyY3VsYXJdJywgJ3NwZWNpYWwnKTtcbiAgICB9XG4gIH1cbiAgaWYgKGlzVW5kZWZpbmVkKG5hbWUpKSB7XG4gICAgaWYgKGFycmF5ICYmIGtleS5tYXRjaCgvXlxcZCskLykpIHtcbiAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuICAgIG5hbWUgPSBKU09OLnN0cmluZ2lmeSgnJyArIGtleSk7XG4gICAgaWYgKG5hbWUubWF0Y2goL15cIihbYS16QS1aX11bYS16QS1aXzAtOV0qKVwiJC8pKSB7XG4gICAgICBuYW1lID0gbmFtZS5zdWJzdHIoMSwgbmFtZS5sZW5ndGggLSAyKTtcbiAgICAgIG5hbWUgPSBjdHguc3R5bGl6ZShuYW1lLCAnbmFtZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC8nL2csIFwiXFxcXCdcIilcbiAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcXFxcIi9nLCAnXCInKVxuICAgICAgICAgICAgICAgICAucmVwbGFjZSgvKF5cInxcIiQpL2csIFwiJ1wiKTtcbiAgICAgIG5hbWUgPSBjdHguc3R5bGl6ZShuYW1lLCAnc3RyaW5nJyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5hbWUgKyAnOiAnICsgc3RyO1xufVxuXG5cbmZ1bmN0aW9uIHJlZHVjZVRvU2luZ2xlU3RyaW5nKG91dHB1dCwgYmFzZSwgYnJhY2VzKSB7XG4gIHZhciBudW1MaW5lc0VzdCA9IDA7XG4gIHZhciBsZW5ndGggPSBvdXRwdXQucmVkdWNlKGZ1bmN0aW9uKHByZXYsIGN1cikge1xuICAgIG51bUxpbmVzRXN0Kys7XG4gICAgaWYgKGN1ci5pbmRleE9mKCdcXG4nKSA+PSAwKSBudW1MaW5lc0VzdCsrO1xuICAgIHJldHVybiBwcmV2ICsgY3VyLnJlcGxhY2UoL1xcdTAwMWJcXFtcXGRcXGQ/bS9nLCAnJykubGVuZ3RoICsgMTtcbiAgfSwgMCk7XG5cbiAgaWYgKGxlbmd0aCA+IDYwKSB7XG4gICAgcmV0dXJuIGJyYWNlc1swXSArXG4gICAgICAgICAgIChiYXNlID09PSAnJyA/ICcnIDogYmFzZSArICdcXG4gJykgK1xuICAgICAgICAgICAnICcgK1xuICAgICAgICAgICBvdXRwdXQuam9pbignLFxcbiAgJykgK1xuICAgICAgICAgICAnICcgK1xuICAgICAgICAgICBicmFjZXNbMV07XG4gIH1cblxuICByZXR1cm4gYnJhY2VzWzBdICsgYmFzZSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdO1xufVxuXG5cbi8vIE5PVEU6IFRoZXNlIHR5cGUgY2hlY2tpbmcgZnVuY3Rpb25zIGludGVudGlvbmFsbHkgZG9uJ3QgdXNlIGBpbnN0YW5jZW9mYFxuLy8gYmVjYXVzZSBpdCBpcyBmcmFnaWxlIGFuZCBjYW4gYmUgZWFzaWx5IGZha2VkIHdpdGggYE9iamVjdC5jcmVhdGUoKWAuXG5mdW5jdGlvbiBpc0FycmF5KGFyKSB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KGFyKTtcbn1cbmV4cG9ydHMuaXNBcnJheSA9IGlzQXJyYXk7XG5cbmZ1bmN0aW9uIGlzQm9vbGVhbihhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdib29sZWFuJztcbn1cbmV4cG9ydHMuaXNCb29sZWFuID0gaXNCb29sZWFuO1xuXG5mdW5jdGlvbiBpc051bGwoYXJnKSB7XG4gIHJldHVybiBhcmcgPT09IG51bGw7XG59XG5leHBvcnRzLmlzTnVsbCA9IGlzTnVsbDtcblxuZnVuY3Rpb24gaXNOdWxsT3JVbmRlZmluZWQoYXJnKSB7XG4gIHJldHVybiBhcmcgPT0gbnVsbDtcbn1cbmV4cG9ydHMuaXNOdWxsT3JVbmRlZmluZWQgPSBpc051bGxPclVuZGVmaW5lZDtcblxuZnVuY3Rpb24gaXNOdW1iZXIoYXJnKSB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnbnVtYmVyJztcbn1cbmV4cG9ydHMuaXNOdW1iZXIgPSBpc051bWJlcjtcblxuZnVuY3Rpb24gaXNTdHJpbmcoYXJnKSB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnc3RyaW5nJztcbn1cbmV4cG9ydHMuaXNTdHJpbmcgPSBpc1N0cmluZztcblxuZnVuY3Rpb24gaXNTeW1ib2woYXJnKSB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnc3ltYm9sJztcbn1cbmV4cG9ydHMuaXNTeW1ib2wgPSBpc1N5bWJvbDtcblxuZnVuY3Rpb24gaXNVbmRlZmluZWQoYXJnKSB7XG4gIHJldHVybiBhcmcgPT09IHZvaWQgMDtcbn1cbmV4cG9ydHMuaXNVbmRlZmluZWQgPSBpc1VuZGVmaW5lZDtcblxuZnVuY3Rpb24gaXNSZWdFeHAocmUpIHtcbiAgcmV0dXJuIGlzT2JqZWN0KHJlKSAmJiBvYmplY3RUb1N0cmluZyhyZSkgPT09ICdbb2JqZWN0IFJlZ0V4cF0nO1xufVxuZXhwb3J0cy5pc1JlZ0V4cCA9IGlzUmVnRXhwO1xuXG5mdW5jdGlvbiBpc09iamVjdChhcmcpIHtcbiAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmIGFyZyAhPT0gbnVsbDtcbn1cbmV4cG9ydHMuaXNPYmplY3QgPSBpc09iamVjdDtcblxuZnVuY3Rpb24gaXNEYXRlKGQpIHtcbiAgcmV0dXJuIGlzT2JqZWN0KGQpICYmIG9iamVjdFRvU3RyaW5nKGQpID09PSAnW29iamVjdCBEYXRlXSc7XG59XG5leHBvcnRzLmlzRGF0ZSA9IGlzRGF0ZTtcblxuZnVuY3Rpb24gaXNFcnJvcihlKSB7XG4gIHJldHVybiBpc09iamVjdChlKSAmJlxuICAgICAgKG9iamVjdFRvU3RyaW5nKGUpID09PSAnW29iamVjdCBFcnJvcl0nIHx8IGUgaW5zdGFuY2VvZiBFcnJvcik7XG59XG5leHBvcnRzLmlzRXJyb3IgPSBpc0Vycm9yO1xuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKGFyZykge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJztcbn1cbmV4cG9ydHMuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247XG5cbmZ1bmN0aW9uIGlzUHJpbWl0aXZlKGFyZykge1xuICByZXR1cm4gYXJnID09PSBudWxsIHx8XG4gICAgICAgICB0eXBlb2YgYXJnID09PSAnYm9vbGVhbicgfHxcbiAgICAgICAgIHR5cGVvZiBhcmcgPT09ICdudW1iZXInIHx8XG4gICAgICAgICB0eXBlb2YgYXJnID09PSAnc3RyaW5nJyB8fFxuICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ3N5bWJvbCcgfHwgIC8vIEVTNiBzeW1ib2xcbiAgICAgICAgIHR5cGVvZiBhcmcgPT09ICd1bmRlZmluZWQnO1xufVxuZXhwb3J0cy5pc1ByaW1pdGl2ZSA9IGlzUHJpbWl0aXZlO1xuXG5leHBvcnRzLmlzQnVmZmVyID0gcmVxdWlyZSgnLi9zdXBwb3J0L2lzQnVmZmVyJyk7XG5cbmZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKG8pIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKTtcbn1cblxuXG5mdW5jdGlvbiBwYWQobikge1xuICByZXR1cm4gbiA8IDEwID8gJzAnICsgbi50b1N0cmluZygxMCkgOiBuLnRvU3RyaW5nKDEwKTtcbn1cblxuXG52YXIgbW9udGhzID0gWydKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAnTWF5JywgJ0p1bicsICdKdWwnLCAnQXVnJywgJ1NlcCcsXG4gICAgICAgICAgICAgICdPY3QnLCAnTm92JywgJ0RlYyddO1xuXG4vLyAyNiBGZWIgMTY6MTk6MzRcbmZ1bmN0aW9uIHRpbWVzdGFtcCgpIHtcbiAgdmFyIGQgPSBuZXcgRGF0ZSgpO1xuICB2YXIgdGltZSA9IFtwYWQoZC5nZXRIb3VycygpKSxcbiAgICAgICAgICAgICAgcGFkKGQuZ2V0TWludXRlcygpKSxcbiAgICAgICAgICAgICAgcGFkKGQuZ2V0U2Vjb25kcygpKV0uam9pbignOicpO1xuICByZXR1cm4gW2QuZ2V0RGF0ZSgpLCBtb250aHNbZC5nZXRNb250aCgpXSwgdGltZV0uam9pbignICcpO1xufVxuXG5cbi8vIGxvZyBpcyBqdXN0IGEgdGhpbiB3cmFwcGVyIHRvIGNvbnNvbGUubG9nIHRoYXQgcHJlcGVuZHMgYSB0aW1lc3RhbXBcbmV4cG9ydHMubG9nID0gZnVuY3Rpb24oKSB7XG4gIGNvbnNvbGUubG9nKCclcyAtICVzJywgdGltZXN0YW1wKCksIGV4cG9ydHMuZm9ybWF0LmFwcGx5KGV4cG9ydHMsIGFyZ3VtZW50cykpO1xufTtcblxuXG4vKipcbiAqIEluaGVyaXQgdGhlIHByb3RvdHlwZSBtZXRob2RzIGZyb20gb25lIGNvbnN0cnVjdG9yIGludG8gYW5vdGhlci5cbiAqXG4gKiBUaGUgRnVuY3Rpb24ucHJvdG90eXBlLmluaGVyaXRzIGZyb20gbGFuZy5qcyByZXdyaXR0ZW4gYXMgYSBzdGFuZGFsb25lXG4gKiBmdW5jdGlvbiAobm90IG9uIEZ1bmN0aW9uLnByb3RvdHlwZSkuIE5PVEU6IElmIHRoaXMgZmlsZSBpcyB0byBiZSBsb2FkZWRcbiAqIGR1cmluZyBib290c3RyYXBwaW5nIHRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gYmUgcmV3cml0dGVuIHVzaW5nIHNvbWUgbmF0aXZlXG4gKiBmdW5jdGlvbnMgYXMgcHJvdG90eXBlIHNldHVwIHVzaW5nIG5vcm1hbCBKYXZhU2NyaXB0IGRvZXMgbm90IHdvcmsgYXNcbiAqIGV4cGVjdGVkIGR1cmluZyBib290c3RyYXBwaW5nIChzZWUgbWlycm9yLmpzIGluIHIxMTQ5MDMpLlxuICpcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGN0b3IgQ29uc3RydWN0b3IgZnVuY3Rpb24gd2hpY2ggbmVlZHMgdG8gaW5oZXJpdCB0aGVcbiAqICAgICBwcm90b3R5cGUuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdXBlckN0b3IgQ29uc3RydWN0b3IgZnVuY3Rpb24gdG8gaW5oZXJpdCBwcm90b3R5cGUgZnJvbS5cbiAqL1xuZXhwb3J0cy5pbmhlcml0cyA9IHJlcXVpcmUoJ2luaGVyaXRzJyk7XG5cbmV4cG9ydHMuX2V4dGVuZCA9IGZ1bmN0aW9uKG9yaWdpbiwgYWRkKSB7XG4gIC8vIERvbid0IGRvIGFueXRoaW5nIGlmIGFkZCBpc24ndCBhbiBvYmplY3RcbiAgaWYgKCFhZGQgfHwgIWlzT2JqZWN0KGFkZCkpIHJldHVybiBvcmlnaW47XG5cbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhZGQpO1xuICB2YXIgaSA9IGtleXMubGVuZ3RoO1xuICB3aGlsZSAoaS0tKSB7XG4gICAgb3JpZ2luW2tleXNbaV1dID0gYWRkW2tleXNbaV1dO1xuICB9XG4gIHJldHVybiBvcmlnaW47XG59O1xuXG5mdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShvYmosIHByb3ApIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApO1xufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3V0aWwvdXRpbC5qc1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 3 */
/***/ function(module, exports) {

	eval("// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vcHJvY2Vzcy9icm93c2VyLmpzPzgyZTQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbi8vIGNhY2hlZCBmcm9tIHdoYXRldmVyIGdsb2JhbCBpcyBwcmVzZW50IHNvIHRoYXQgdGVzdCBydW5uZXJzIHRoYXQgc3R1YiBpdFxuLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzXG4vLyB3cmFwcGVkIGluIHN0cmljdCBtb2RlIGNvZGUgd2hpY2ggZG9lc24ndCBkZWZpbmUgYW55IGdsb2JhbHMuICBJdCdzIGluc2lkZSBhXG4vLyBmdW5jdGlvbiBiZWNhdXNlIHRyeS9jYXRjaGVzIGRlb3B0aW1pemUgaW4gY2VydGFpbiBlbmdpbmVzLlxuXG52YXIgY2FjaGVkU2V0VGltZW91dDtcbnZhciBjYWNoZWRDbGVhclRpbWVvdXQ7XG5cbmZ1bmN0aW9uIGRlZmF1bHRTZXRUaW1vdXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0ICgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuKGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICB9XG59ICgpKVxuZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHtcbiAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9IGNhdGNoKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKG51bGwsIGZ1biwgMCk7XG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cbmZ1bmN0aW9uIHJ1bkNsZWFyVGltZW91dChtYXJrZXIpIHtcbiAgICBpZiAoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgLy8gaWYgY2xlYXJUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZFxuICAgIGlmICgoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBkZWZhdWx0Q2xlYXJUaW1lb3V0IHx8ICFjYWNoZWRDbGVhclRpbWVvdXQpICYmIGNsZWFyVGltZW91dCkge1xuICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzc1xuICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfSBjYXRjaCAoZSl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgIHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvci5cbiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXRcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cblxufVxudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuXG5mdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7XG4gICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmFpblF1ZXVlKCkge1xuICAgIGlmIChkcmFpbmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spO1xuICAgIGRyYWluaW5nID0gdHJ1ZTtcblxuICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgd2hpbGUobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBjdXJyZW50UXVldWUgPSBudWxsO1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xufVxuXG5wcm9jZXNzLm5leHRUaWNrID0gZnVuY3Rpb24gKGZ1bikge1xuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHF1ZXVlLnB1c2gobmV3IEl0ZW0oZnVuLCBhcmdzKSk7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHtcbiAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTtcbiAgICB9XG59O1xuXG4vLyB2OCBsaWtlcyBwcmVkaWN0aWJsZSBvYmplY3RzXG5mdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHtcbiAgICB0aGlzLmZ1biA9IGZ1bjtcbiAgICB0aGlzLmFycmF5ID0gYXJyYXk7XG59XG5JdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7XG59O1xucHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJztcbnByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG5wcm9jZXNzLmVudiA9IHt9O1xucHJvY2Vzcy5hcmd2ID0gW107XG5wcm9jZXNzLnZlcnNpb24gPSAnJzsgLy8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkIHJlZ2V4cCBpc3N1ZXNcbnByb2Nlc3MudmVyc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5cbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xucHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9wcm9jZXNzL2Jyb3dzZXIuanNcbi8vIG1vZHVsZSBpZCA9IDNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 4 */
/***/ function(module, exports) {

	eval("module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vdXRpbC9zdXBwb3J0L2lzQnVmZmVyQnJvd3Nlci5qcz84NTk2Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaXNCdWZmZXIoYXJnKSB7XG4gIHJldHVybiBhcmcgJiYgdHlwZW9mIGFyZyA9PT0gJ29iamVjdCdcbiAgICAmJiB0eXBlb2YgYXJnLmNvcHkgPT09ICdmdW5jdGlvbidcbiAgICAmJiB0eXBlb2YgYXJnLmZpbGwgPT09ICdmdW5jdGlvbidcbiAgICAmJiB0eXBlb2YgYXJnLnJlYWRVSW50OCA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vdXRpbC9zdXBwb3J0L2lzQnVmZmVyQnJvd3Nlci5qc1xuLy8gbW9kdWxlIGlkID0gNFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 5 */
/***/ function(module, exports) {

	eval("if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vdXRpbC9+L2luaGVyaXRzL2luaGVyaXRzX2Jyb3dzZXIuanM/YWJhNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpZiAodHlwZW9mIE9iamVjdC5jcmVhdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgLy8gaW1wbGVtZW50YXRpb24gZnJvbSBzdGFuZGFyZCBub2RlLmpzICd1dGlsJyBtb2R1bGVcbiAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHtcbiAgICBjdG9yLnN1cGVyXyA9IHN1cGVyQ3RvclxuICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7XG4gICAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgICB2YWx1ZTogY3RvcixcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbn0gZWxzZSB7XG4gIC8vIG9sZCBzY2hvb2wgc2hpbSBmb3Igb2xkIGJyb3dzZXJzXG4gIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaW5oZXJpdHMoY3Rvciwgc3VwZXJDdG9yKSB7XG4gICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3JcbiAgICB2YXIgVGVtcEN0b3IgPSBmdW5jdGlvbiAoKSB7fVxuICAgIFRlbXBDdG9yLnByb3RvdHlwZSA9IHN1cGVyQ3Rvci5wcm90b3R5cGVcbiAgICBjdG9yLnByb3RvdHlwZSA9IG5ldyBUZW1wQ3RvcigpXG4gICAgY3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBjdG9yXG4gIH1cbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi91dGlsL34vaW5oZXJpdHMvaW5oZXJpdHNfYnJvd3Nlci5qc1xuLy8gbW9kdWxlIGlkID0gNVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 6 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(global) {'use strict';\n\n// compare and isBuffer taken from https://github.com/feross/buffer/blob/680e9e5e488f22aac27599a57dc844a6315928dd/index.js\n// original notice:\n\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nfunction compare(a, b) {\n  if (a === b) {\n    return 0;\n  }\n\n  var x = a.length;\n  var y = b.length;\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i];\n      y = b[i];\n      break;\n    }\n  }\n\n  if (x < y) {\n    return -1;\n  }\n  if (y < x) {\n    return 1;\n  }\n  return 0;\n}\nfunction isBuffer(b) {\n  if (global.Buffer && typeof global.Buffer.isBuffer === 'function') {\n    return global.Buffer.isBuffer(b);\n  }\n  return !!(b != null && b._isBuffer);\n}\n\n// based on node assert, original notice:\n\n// http://wiki.commonjs.org/wiki/Unit_Testing/1.0\n//\n// THIS IS NOT TESTED NOR LIKELY TO WORK OUTSIDE V8!\n//\n// Originally from narwhal.js (http://narwhaljs.org)\n// Copyright (c) 2009 Thomas Robinson <280north.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the 'Software'), to\n// deal in the Software without restriction, including without limitation the\n// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n// sell copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar util = __webpack_require__(2);\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar pSlice = Array.prototype.slice;\nvar functionsHaveNames = (function () {\n  return function foo() {}.name === 'foo';\n}());\nfunction pToString (obj) {\n  return Object.prototype.toString.call(obj);\n}\nfunction isView(arrbuf) {\n  if (isBuffer(arrbuf)) {\n    return false;\n  }\n  if (typeof global.ArrayBuffer !== 'function') {\n    return false;\n  }\n  if (typeof ArrayBuffer.isView === 'function') {\n    return ArrayBuffer.isView(arrbuf);\n  }\n  if (!arrbuf) {\n    return false;\n  }\n  if (arrbuf instanceof DataView) {\n    return true;\n  }\n  if (arrbuf.buffer && arrbuf.buffer instanceof ArrayBuffer) {\n    return true;\n  }\n  return false;\n}\n// 1. The assert module provides functions that throw\n// AssertionError's when particular conditions are not met. The\n// assert module must conform to the following interface.\n\nvar assert = module.exports = ok;\n\n// 2. The AssertionError is defined in assert.\n// new assert.AssertionError({ message: message,\n//                             actual: actual,\n//                             expected: expected })\n\nvar regex = /\\s*function\\s+([^\\(\\s]*)\\s*/;\n// based on https://github.com/ljharb/function.prototype.name/blob/adeeeec8bfcc6068b187d7d9fb3d5bb1d3a30899/implementation.js\nfunction getName(func) {\n  if (!util.isFunction(func)) {\n    return;\n  }\n  if (functionsHaveNames) {\n    return func.name;\n  }\n  var str = func.toString();\n  var match = str.match(regex);\n  return match && match[1];\n}\nassert.AssertionError = function AssertionError(options) {\n  this.name = 'AssertionError';\n  this.actual = options.actual;\n  this.expected = options.expected;\n  this.operator = options.operator;\n  if (options.message) {\n    this.message = options.message;\n    this.generatedMessage = false;\n  } else {\n    this.message = getMessage(this);\n    this.generatedMessage = true;\n  }\n  var stackStartFunction = options.stackStartFunction || fail;\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, stackStartFunction);\n  } else {\n    // non v8 browsers so we can have a stacktrace\n    var err = new Error();\n    if (err.stack) {\n      var out = err.stack;\n\n      // try to strip useless frames\n      var fn_name = getName(stackStartFunction);\n      var idx = out.indexOf('\\n' + fn_name);\n      if (idx >= 0) {\n        // once we have located the function frame\n        // we need to strip out everything before it (and its line)\n        var next_line = out.indexOf('\\n', idx + 1);\n        out = out.substring(next_line + 1);\n      }\n\n      this.stack = out;\n    }\n  }\n};\n\n// assert.AssertionError instanceof Error\nutil.inherits(assert.AssertionError, Error);\n\nfunction truncate(s, n) {\n  if (typeof s === 'string') {\n    return s.length < n ? s : s.slice(0, n);\n  } else {\n    return s;\n  }\n}\nfunction inspect(something) {\n  if (functionsHaveNames || !util.isFunction(something)) {\n    return util.inspect(something);\n  }\n  var rawname = getName(something);\n  var name = rawname ? ': ' + rawname : '';\n  return '[Function' +  name + ']';\n}\nfunction getMessage(self) {\n  return truncate(inspect(self.actual), 128) + ' ' +\n         self.operator + ' ' +\n         truncate(inspect(self.expected), 128);\n}\n\n// At present only the three keys mentioned above are used and\n// understood by the spec. Implementations or sub modules can pass\n// other keys to the AssertionError's constructor - they will be\n// ignored.\n\n// 3. All of the following functions must throw an AssertionError\n// when a corresponding condition is not met, with a message that\n// may be undefined if not provided.  All assertion methods provide\n// both the actual and expected values to the assertion error for\n// display purposes.\n\nfunction fail(actual, expected, message, operator, stackStartFunction) {\n  throw new assert.AssertionError({\n    message: message,\n    actual: actual,\n    expected: expected,\n    operator: operator,\n    stackStartFunction: stackStartFunction\n  });\n}\n\n// EXTENSION! allows for well behaved errors defined elsewhere.\nassert.fail = fail;\n\n// 4. Pure assertion tests whether a value is truthy, as determined\n// by !!guard.\n// assert.ok(guard, message_opt);\n// This statement is equivalent to assert.equal(true, !!guard,\n// message_opt);. To test strictly for the value true, use\n// assert.strictEqual(true, guard, message_opt);.\n\nfunction ok(value, message) {\n  if (!value) fail(value, true, message, '==', assert.ok);\n}\nassert.ok = ok;\n\n// 5. The equality assertion tests shallow, coercive equality with\n// ==.\n// assert.equal(actual, expected, message_opt);\n\nassert.equal = function equal(actual, expected, message) {\n  if (actual != expected) fail(actual, expected, message, '==', assert.equal);\n};\n\n// 6. The non-equality assertion tests for whether two objects are not equal\n// with != assert.notEqual(actual, expected, message_opt);\n\nassert.notEqual = function notEqual(actual, expected, message) {\n  if (actual == expected) {\n    fail(actual, expected, message, '!=', assert.notEqual);\n  }\n};\n\n// 7. The equivalence assertion tests a deep equality relation.\n// assert.deepEqual(actual, expected, message_opt);\n\nassert.deepEqual = function deepEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'deepEqual', assert.deepEqual);\n  }\n};\n\nassert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'deepStrictEqual', assert.deepStrictEqual);\n  }\n};\n\nfunction _deepEqual(actual, expected, strict, memos) {\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n  } else if (isBuffer(actual) && isBuffer(expected)) {\n    return compare(actual, expected) === 0;\n\n  // 7.2. If the expected value is a Date object, the actual value is\n  // equivalent if it is also a Date object that refers to the same time.\n  } else if (util.isDate(actual) && util.isDate(expected)) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3 If the expected value is a RegExp object, the actual value is\n  // equivalent if it is also a RegExp object with the same source and\n  // properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).\n  } else if (util.isRegExp(actual) && util.isRegExp(expected)) {\n    return actual.source === expected.source &&\n           actual.global === expected.global &&\n           actual.multiline === expected.multiline &&\n           actual.lastIndex === expected.lastIndex &&\n           actual.ignoreCase === expected.ignoreCase;\n\n  // 7.4. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if ((actual === null || typeof actual !== 'object') &&\n             (expected === null || typeof expected !== 'object')) {\n    return strict ? actual === expected : actual == expected;\n\n  // If both values are instances of typed arrays, wrap their underlying\n  // ArrayBuffers in a Buffer each to increase performance\n  // This optimization requires the arrays to have the same type as checked by\n  // Object.prototype.toString (aka pToString). Never perform binary\n  // comparisons for Float*Arrays, though, since e.g. +0 === -0 but their\n  // bit patterns are not identical.\n  } else if (isView(actual) && isView(expected) &&\n             pToString(actual) === pToString(expected) &&\n             !(actual instanceof Float32Array ||\n               actual instanceof Float64Array)) {\n    return compare(new Uint8Array(actual.buffer),\n                   new Uint8Array(expected.buffer)) === 0;\n\n  // 7.5 For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else if (isBuffer(actual) !== isBuffer(expected)) {\n    return false;\n  } else {\n    memos = memos || {actual: [], expected: []};\n\n    var actualIndex = memos.actual.indexOf(actual);\n    if (actualIndex !== -1) {\n      if (actualIndex === memos.expected.indexOf(expected)) {\n        return true;\n      }\n    }\n\n    memos.actual.push(actual);\n    memos.expected.push(expected);\n\n    return objEquiv(actual, expected, strict, memos);\n  }\n}\n\nfunction isArguments(object) {\n  return Object.prototype.toString.call(object) == '[object Arguments]';\n}\n\nfunction objEquiv(a, b, strict, actualVisitedObjects) {\n  if (a === null || a === undefined || b === null || b === undefined)\n    return false;\n  // if one is a primitive, the other must be same\n  if (util.isPrimitive(a) || util.isPrimitive(b))\n    return a === b;\n  if (strict && Object.getPrototypeOf(a) !== Object.getPrototypeOf(b))\n    return false;\n  var aIsArgs = isArguments(a);\n  var bIsArgs = isArguments(b);\n  if ((aIsArgs && !bIsArgs) || (!aIsArgs && bIsArgs))\n    return false;\n  if (aIsArgs) {\n    a = pSlice.call(a);\n    b = pSlice.call(b);\n    return _deepEqual(a, b, strict);\n  }\n  var ka = objectKeys(a);\n  var kb = objectKeys(b);\n  var key, i;\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!_deepEqual(a[key], b[key], strict, actualVisitedObjects))\n      return false;\n  }\n  return true;\n}\n\n// 8. The non-equivalence assertion tests for any deep inequality.\n// assert.notDeepEqual(actual, expected, message_opt);\n\nassert.notDeepEqual = function notDeepEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'notDeepEqual', assert.notDeepEqual);\n  }\n};\n\nassert.notDeepStrictEqual = notDeepStrictEqual;\nfunction notDeepStrictEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'notDeepStrictEqual', notDeepStrictEqual);\n  }\n}\n\n\n// 9. The strict equality assertion tests strict equality, as determined by ===.\n// assert.strictEqual(actual, expected, message_opt);\n\nassert.strictEqual = function strictEqual(actual, expected, message) {\n  if (actual !== expected) {\n    fail(actual, expected, message, '===', assert.strictEqual);\n  }\n};\n\n// 10. The strict non-equality assertion tests for strict inequality, as\n// determined by !==.  assert.notStrictEqual(actual, expected, message_opt);\n\nassert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n  if (actual === expected) {\n    fail(actual, expected, message, '!==', assert.notStrictEqual);\n  }\n};\n\nfunction expectedException(actual, expected) {\n  if (!actual || !expected) {\n    return false;\n  }\n\n  if (Object.prototype.toString.call(expected) == '[object RegExp]') {\n    return expected.test(actual);\n  }\n\n  try {\n    if (actual instanceof expected) {\n      return true;\n    }\n  } catch (e) {\n    // Ignore.  The instanceof check doesn't work for arrow functions.\n  }\n\n  if (Error.isPrototypeOf(expected)) {\n    return false;\n  }\n\n  return expected.call({}, actual) === true;\n}\n\nfunction _tryBlock(block) {\n  var error;\n  try {\n    block();\n  } catch (e) {\n    error = e;\n  }\n  return error;\n}\n\nfunction _throws(shouldThrow, block, expected, message) {\n  var actual;\n\n  if (typeof block !== 'function') {\n    throw new TypeError('\"block\" argument must be a function');\n  }\n\n  if (typeof expected === 'string') {\n    message = expected;\n    expected = null;\n  }\n\n  actual = _tryBlock(block);\n\n  message = (expected && expected.name ? ' (' + expected.name + ').' : '.') +\n            (message ? ' ' + message : '.');\n\n  if (shouldThrow && !actual) {\n    fail(actual, expected, 'Missing expected exception' + message);\n  }\n\n  var userProvidedMessage = typeof message === 'string';\n  var isUnwantedException = !shouldThrow && util.isError(actual);\n  var isUnexpectedException = !shouldThrow && actual && !expected;\n\n  if ((isUnwantedException &&\n      userProvidedMessage &&\n      expectedException(actual, expected)) ||\n      isUnexpectedException) {\n    fail(actual, expected, 'Got unwanted exception' + message);\n  }\n\n  if ((shouldThrow && actual && expected &&\n      !expectedException(actual, expected)) || (!shouldThrow && actual)) {\n    throw actual;\n  }\n}\n\n// 11. Expected to throw an error:\n// assert.throws(block, Error_opt, message_opt);\n\nassert.throws = function(block, /*optional*/error, /*optional*/message) {\n  _throws(true, block, error, message);\n};\n\n// EXTENSION! This is annoying to write outside this module.\nassert.doesNotThrow = function(block, /*optional*/error, /*optional*/message) {\n  _throws(false, block, error, message);\n};\n\nassert.ifError = function(err) { if (err) throw err; };\n\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) {\n    if (hasOwn.call(obj, key)) keys.push(key);\n  }\n  return keys;\n};\n\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vYXNzZXJ0L2Fzc2VydC5qcz85MjgxIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLy8gY29tcGFyZSBhbmQgaXNCdWZmZXIgdGFrZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2J1ZmZlci9ibG9iLzY4MGU5ZTVlNDg4ZjIyYWFjMjc1OTlhNTdkYzg0NGE2MzE1OTI4ZGQvaW5kZXguanNcbi8vIG9yaWdpbmFsIG5vdGljZTpcblxuLyohXG4gKiBUaGUgYnVmZmVyIG1vZHVsZSBmcm9tIG5vZGUuanMsIGZvciB0aGUgYnJvd3Nlci5cbiAqXG4gKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8ZmVyb3NzQGZlcm9zcy5vcmc+IDxodHRwOi8vZmVyb3NzLm9yZz5cbiAqIEBsaWNlbnNlICBNSVRcbiAqL1xuZnVuY3Rpb24gY29tcGFyZShhLCBiKSB7XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICB2YXIgeCA9IGEubGVuZ3RoO1xuICB2YXIgeSA9IGIubGVuZ3RoO1xuXG4gIGZvciAodmFyIGkgPSAwLCBsZW4gPSBNYXRoLm1pbih4LCB5KTsgaSA8IGxlbjsgKytpKSB7XG4gICAgaWYgKGFbaV0gIT09IGJbaV0pIHtcbiAgICAgIHggPSBhW2ldO1xuICAgICAgeSA9IGJbaV07XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBpZiAoeCA8IHkpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgaWYgKHkgPCB4KSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgcmV0dXJuIDA7XG59XG5mdW5jdGlvbiBpc0J1ZmZlcihiKSB7XG4gIGlmIChnbG9iYWwuQnVmZmVyICYmIHR5cGVvZiBnbG9iYWwuQnVmZmVyLmlzQnVmZmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGdsb2JhbC5CdWZmZXIuaXNCdWZmZXIoYik7XG4gIH1cbiAgcmV0dXJuICEhKGIgIT0gbnVsbCAmJiBiLl9pc0J1ZmZlcik7XG59XG5cbi8vIGJhc2VkIG9uIG5vZGUgYXNzZXJ0LCBvcmlnaW5hbCBub3RpY2U6XG5cbi8vIGh0dHA6Ly93aWtpLmNvbW1vbmpzLm9yZy93aWtpL1VuaXRfVGVzdGluZy8xLjBcbi8vXG4vLyBUSElTIElTIE5PVCBURVNURUQgTk9SIExJS0VMWSBUTyBXT1JLIE9VVFNJREUgVjghXG4vL1xuLy8gT3JpZ2luYWxseSBmcm9tIG5hcndoYWwuanMgKGh0dHA6Ly9uYXJ3aGFsanMub3JnKVxuLy8gQ29weXJpZ2h0IChjKSAyMDA5IFRob21hcyBSb2JpbnNvbiA8Mjgwbm9ydGguY29tPlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICdTb2Z0d2FyZScpLCB0b1xuLy8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGVcbi8vIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vclxuLy8gc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAnQVMgSVMnLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU5cbi8vIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT05cbi8vIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWwvJyk7XG52YXIgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBwU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG52YXIgZnVuY3Rpb25zSGF2ZU5hbWVzID0gKGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGZvbygpIHt9Lm5hbWUgPT09ICdmb28nO1xufSgpKTtcbmZ1bmN0aW9uIHBUb1N0cmluZyAob2JqKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKTtcbn1cbmZ1bmN0aW9uIGlzVmlldyhhcnJidWYpIHtcbiAgaWYgKGlzQnVmZmVyKGFycmJ1ZikpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKHR5cGVvZiBnbG9iYWwuQXJyYXlCdWZmZXIgIT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlci5pc1ZpZXcgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gQXJyYXlCdWZmZXIuaXNWaWV3KGFycmJ1Zik7XG4gIH1cbiAgaWYgKCFhcnJidWYpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKGFycmJ1ZiBpbnN0YW5jZW9mIERhdGFWaWV3KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKGFycmJ1Zi5idWZmZXIgJiYgYXJyYnVmLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuLy8gMS4gVGhlIGFzc2VydCBtb2R1bGUgcHJvdmlkZXMgZnVuY3Rpb25zIHRoYXQgdGhyb3dcbi8vIEFzc2VydGlvbkVycm9yJ3Mgd2hlbiBwYXJ0aWN1bGFyIGNvbmRpdGlvbnMgYXJlIG5vdCBtZXQuIFRoZVxuLy8gYXNzZXJ0IG1vZHVsZSBtdXN0IGNvbmZvcm0gdG8gdGhlIGZvbGxvd2luZyBpbnRlcmZhY2UuXG5cbnZhciBhc3NlcnQgPSBtb2R1bGUuZXhwb3J0cyA9IG9rO1xuXG4vLyAyLiBUaGUgQXNzZXJ0aW9uRXJyb3IgaXMgZGVmaW5lZCBpbiBhc3NlcnQuXG4vLyBuZXcgYXNzZXJ0LkFzc2VydGlvbkVycm9yKHsgbWVzc2FnZTogbWVzc2FnZSxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3R1YWw6IGFjdHVhbCxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZDogZXhwZWN0ZWQgfSlcblxudmFyIHJlZ2V4ID0gL1xccypmdW5jdGlvblxccysoW15cXChcXHNdKilcXHMqLztcbi8vIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9samhhcmIvZnVuY3Rpb24ucHJvdG90eXBlLm5hbWUvYmxvYi9hZGVlZWVjOGJmY2M2MDY4YjE4N2Q3ZDlmYjNkNWJiMWQzYTMwODk5L2ltcGxlbWVudGF0aW9uLmpzXG5mdW5jdGlvbiBnZXROYW1lKGZ1bmMpIHtcbiAgaWYgKCF1dGlsLmlzRnVuY3Rpb24oZnVuYykpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGZ1bmN0aW9uc0hhdmVOYW1lcykge1xuICAgIHJldHVybiBmdW5jLm5hbWU7XG4gIH1cbiAgdmFyIHN0ciA9IGZ1bmMudG9TdHJpbmcoKTtcbiAgdmFyIG1hdGNoID0gc3RyLm1hdGNoKHJlZ2V4KTtcbiAgcmV0dXJuIG1hdGNoICYmIG1hdGNoWzFdO1xufVxuYXNzZXJ0LkFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gQXNzZXJ0aW9uRXJyb3Iob3B0aW9ucykge1xuICB0aGlzLm5hbWUgPSAnQXNzZXJ0aW9uRXJyb3InO1xuICB0aGlzLmFjdHVhbCA9IG9wdGlvbnMuYWN0dWFsO1xuICB0aGlzLmV4cGVjdGVkID0gb3B0aW9ucy5leHBlY3RlZDtcbiAgdGhpcy5vcGVyYXRvciA9IG9wdGlvbnMub3BlcmF0b3I7XG4gIGlmIChvcHRpb25zLm1lc3NhZ2UpIHtcbiAgICB0aGlzLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2U7XG4gICAgdGhpcy5nZW5lcmF0ZWRNZXNzYWdlID0gZmFsc2U7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5tZXNzYWdlID0gZ2V0TWVzc2FnZSh0aGlzKTtcbiAgICB0aGlzLmdlbmVyYXRlZE1lc3NhZ2UgPSB0cnVlO1xuICB9XG4gIHZhciBzdGFja1N0YXJ0RnVuY3Rpb24gPSBvcHRpb25zLnN0YWNrU3RhcnRGdW5jdGlvbiB8fCBmYWlsO1xuICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBzdGFja1N0YXJ0RnVuY3Rpb24pO1xuICB9IGVsc2Uge1xuICAgIC8vIG5vbiB2OCBicm93c2VycyBzbyB3ZSBjYW4gaGF2ZSBhIHN0YWNrdHJhY2VcbiAgICB2YXIgZXJyID0gbmV3IEVycm9yKCk7XG4gICAgaWYgKGVyci5zdGFjaykge1xuICAgICAgdmFyIG91dCA9IGVyci5zdGFjaztcblxuICAgICAgLy8gdHJ5IHRvIHN0cmlwIHVzZWxlc3MgZnJhbWVzXG4gICAgICB2YXIgZm5fbmFtZSA9IGdldE5hbWUoc3RhY2tTdGFydEZ1bmN0aW9uKTtcbiAgICAgIHZhciBpZHggPSBvdXQuaW5kZXhPZignXFxuJyArIGZuX25hbWUpO1xuICAgICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICAgIC8vIG9uY2Ugd2UgaGF2ZSBsb2NhdGVkIHRoZSBmdW5jdGlvbiBmcmFtZVxuICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0cmlwIG91dCBldmVyeXRoaW5nIGJlZm9yZSBpdCAoYW5kIGl0cyBsaW5lKVxuICAgICAgICB2YXIgbmV4dF9saW5lID0gb3V0LmluZGV4T2YoJ1xcbicsIGlkeCArIDEpO1xuICAgICAgICBvdXQgPSBvdXQuc3Vic3RyaW5nKG5leHRfbGluZSArIDEpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnN0YWNrID0gb3V0O1xuICAgIH1cbiAgfVxufTtcblxuLy8gYXNzZXJ0LkFzc2VydGlvbkVycm9yIGluc3RhbmNlb2YgRXJyb3JcbnV0aWwuaW5oZXJpdHMoYXNzZXJ0LkFzc2VydGlvbkVycm9yLCBFcnJvcik7XG5cbmZ1bmN0aW9uIHRydW5jYXRlKHMsIG4pIHtcbiAgaWYgKHR5cGVvZiBzID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBzLmxlbmd0aCA8IG4gPyBzIDogcy5zbGljZSgwLCBuKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcztcbiAgfVxufVxuZnVuY3Rpb24gaW5zcGVjdChzb21ldGhpbmcpIHtcbiAgaWYgKGZ1bmN0aW9uc0hhdmVOYW1lcyB8fCAhdXRpbC5pc0Z1bmN0aW9uKHNvbWV0aGluZykpIHtcbiAgICByZXR1cm4gdXRpbC5pbnNwZWN0KHNvbWV0aGluZyk7XG4gIH1cbiAgdmFyIHJhd25hbWUgPSBnZXROYW1lKHNvbWV0aGluZyk7XG4gIHZhciBuYW1lID0gcmF3bmFtZSA/ICc6ICcgKyByYXduYW1lIDogJyc7XG4gIHJldHVybiAnW0Z1bmN0aW9uJyArICBuYW1lICsgJ10nO1xufVxuZnVuY3Rpb24gZ2V0TWVzc2FnZShzZWxmKSB7XG4gIHJldHVybiB0cnVuY2F0ZShpbnNwZWN0KHNlbGYuYWN0dWFsKSwgMTI4KSArICcgJyArXG4gICAgICAgICBzZWxmLm9wZXJhdG9yICsgJyAnICtcbiAgICAgICAgIHRydW5jYXRlKGluc3BlY3Qoc2VsZi5leHBlY3RlZCksIDEyOCk7XG59XG5cbi8vIEF0IHByZXNlbnQgb25seSB0aGUgdGhyZWUga2V5cyBtZW50aW9uZWQgYWJvdmUgYXJlIHVzZWQgYW5kXG4vLyB1bmRlcnN0b29kIGJ5IHRoZSBzcGVjLiBJbXBsZW1lbnRhdGlvbnMgb3Igc3ViIG1vZHVsZXMgY2FuIHBhc3Ncbi8vIG90aGVyIGtleXMgdG8gdGhlIEFzc2VydGlvbkVycm9yJ3MgY29uc3RydWN0b3IgLSB0aGV5IHdpbGwgYmVcbi8vIGlnbm9yZWQuXG5cbi8vIDMuIEFsbCBvZiB0aGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBtdXN0IHRocm93IGFuIEFzc2VydGlvbkVycm9yXG4vLyB3aGVuIGEgY29ycmVzcG9uZGluZyBjb25kaXRpb24gaXMgbm90IG1ldCwgd2l0aCBhIG1lc3NhZ2UgdGhhdFxuLy8gbWF5IGJlIHVuZGVmaW5lZCBpZiBub3QgcHJvdmlkZWQuICBBbGwgYXNzZXJ0aW9uIG1ldGhvZHMgcHJvdmlkZVxuLy8gYm90aCB0aGUgYWN0dWFsIGFuZCBleHBlY3RlZCB2YWx1ZXMgdG8gdGhlIGFzc2VydGlvbiBlcnJvciBmb3Jcbi8vIGRpc3BsYXkgcHVycG9zZXMuXG5cbmZ1bmN0aW9uIGZhaWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSwgb3BlcmF0b3IsIHN0YWNrU3RhcnRGdW5jdGlvbikge1xuICB0aHJvdyBuZXcgYXNzZXJ0LkFzc2VydGlvbkVycm9yKHtcbiAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgIGFjdHVhbDogYWN0dWFsLFxuICAgIGV4cGVjdGVkOiBleHBlY3RlZCxcbiAgICBvcGVyYXRvcjogb3BlcmF0b3IsXG4gICAgc3RhY2tTdGFydEZ1bmN0aW9uOiBzdGFja1N0YXJ0RnVuY3Rpb25cbiAgfSk7XG59XG5cbi8vIEVYVEVOU0lPTiEgYWxsb3dzIGZvciB3ZWxsIGJlaGF2ZWQgZXJyb3JzIGRlZmluZWQgZWxzZXdoZXJlLlxuYXNzZXJ0LmZhaWwgPSBmYWlsO1xuXG4vLyA0LiBQdXJlIGFzc2VydGlvbiB0ZXN0cyB3aGV0aGVyIGEgdmFsdWUgaXMgdHJ1dGh5LCBhcyBkZXRlcm1pbmVkXG4vLyBieSAhIWd1YXJkLlxuLy8gYXNzZXJ0Lm9rKGd1YXJkLCBtZXNzYWdlX29wdCk7XG4vLyBUaGlzIHN0YXRlbWVudCBpcyBlcXVpdmFsZW50IHRvIGFzc2VydC5lcXVhbCh0cnVlLCAhIWd1YXJkLFxuLy8gbWVzc2FnZV9vcHQpOy4gVG8gdGVzdCBzdHJpY3RseSBmb3IgdGhlIHZhbHVlIHRydWUsIHVzZVxuLy8gYXNzZXJ0LnN0cmljdEVxdWFsKHRydWUsIGd1YXJkLCBtZXNzYWdlX29wdCk7LlxuXG5mdW5jdGlvbiBvayh2YWx1ZSwgbWVzc2FnZSkge1xuICBpZiAoIXZhbHVlKSBmYWlsKHZhbHVlLCB0cnVlLCBtZXNzYWdlLCAnPT0nLCBhc3NlcnQub2spO1xufVxuYXNzZXJ0Lm9rID0gb2s7XG5cbi8vIDUuIFRoZSBlcXVhbGl0eSBhc3NlcnRpb24gdGVzdHMgc2hhbGxvdywgY29lcmNpdmUgZXF1YWxpdHkgd2l0aFxuLy8gPT0uXG4vLyBhc3NlcnQuZXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZV9vcHQpO1xuXG5hc3NlcnQuZXF1YWwgPSBmdW5jdGlvbiBlcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7XG4gIGlmIChhY3R1YWwgIT0gZXhwZWN0ZWQpIGZhaWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSwgJz09JywgYXNzZXJ0LmVxdWFsKTtcbn07XG5cbi8vIDYuIFRoZSBub24tZXF1YWxpdHkgYXNzZXJ0aW9uIHRlc3RzIGZvciB3aGV0aGVyIHR3byBvYmplY3RzIGFyZSBub3QgZXF1YWxcbi8vIHdpdGggIT0gYXNzZXJ0Lm5vdEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2Vfb3B0KTtcblxuYXNzZXJ0Lm5vdEVxdWFsID0gZnVuY3Rpb24gbm90RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkge1xuICBpZiAoYWN0dWFsID09IGV4cGVjdGVkKSB7XG4gICAgZmFpbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlLCAnIT0nLCBhc3NlcnQubm90RXF1YWwpO1xuICB9XG59O1xuXG4vLyA3LiBUaGUgZXF1aXZhbGVuY2UgYXNzZXJ0aW9uIHRlc3RzIGEgZGVlcCBlcXVhbGl0eSByZWxhdGlvbi5cbi8vIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZV9vcHQpO1xuXG5hc3NlcnQuZGVlcEVxdWFsID0gZnVuY3Rpb24gZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHtcbiAgaWYgKCFfZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIGZhbHNlKSkge1xuICAgIGZhaWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSwgJ2RlZXBFcXVhbCcsIGFzc2VydC5kZWVwRXF1YWwpO1xuICB9XG59O1xuXG5hc3NlcnQuZGVlcFN0cmljdEVxdWFsID0gZnVuY3Rpb24gZGVlcFN0cmljdEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHtcbiAgaWYgKCFfZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIHRydWUpKSB7XG4gICAgZmFpbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlLCAnZGVlcFN0cmljdEVxdWFsJywgYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbCk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIF9kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgc3RyaWN0LCBtZW1vcykge1xuICAvLyA3LjEuIEFsbCBpZGVudGljYWwgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBhcyBkZXRlcm1pbmVkIGJ5ID09PS5cbiAgaWYgKGFjdHVhbCA9PT0gZXhwZWN0ZWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChpc0J1ZmZlcihhY3R1YWwpICYmIGlzQnVmZmVyKGV4cGVjdGVkKSkge1xuICAgIHJldHVybiBjb21wYXJlKGFjdHVhbCwgZXhwZWN0ZWQpID09PSAwO1xuXG4gIC8vIDcuMi4gSWYgdGhlIGV4cGVjdGVkIHZhbHVlIGlzIGEgRGF0ZSBvYmplY3QsIHRoZSBhY3R1YWwgdmFsdWUgaXNcbiAgLy8gZXF1aXZhbGVudCBpZiBpdCBpcyBhbHNvIGEgRGF0ZSBvYmplY3QgdGhhdCByZWZlcnMgdG8gdGhlIHNhbWUgdGltZS5cbiAgfSBlbHNlIGlmICh1dGlsLmlzRGF0ZShhY3R1YWwpICYmIHV0aWwuaXNEYXRlKGV4cGVjdGVkKSkge1xuICAgIHJldHVybiBhY3R1YWwuZ2V0VGltZSgpID09PSBleHBlY3RlZC5nZXRUaW1lKCk7XG5cbiAgLy8gNy4zIElmIHRoZSBleHBlY3RlZCB2YWx1ZSBpcyBhIFJlZ0V4cCBvYmplY3QsIHRoZSBhY3R1YWwgdmFsdWUgaXNcbiAgLy8gZXF1aXZhbGVudCBpZiBpdCBpcyBhbHNvIGEgUmVnRXhwIG9iamVjdCB3aXRoIHRoZSBzYW1lIHNvdXJjZSBhbmRcbiAgLy8gcHJvcGVydGllcyAoYGdsb2JhbGAsIGBtdWx0aWxpbmVgLCBgbGFzdEluZGV4YCwgYGlnbm9yZUNhc2VgKS5cbiAgfSBlbHNlIGlmICh1dGlsLmlzUmVnRXhwKGFjdHVhbCkgJiYgdXRpbC5pc1JlZ0V4cChleHBlY3RlZCkpIHtcbiAgICByZXR1cm4gYWN0dWFsLnNvdXJjZSA9PT0gZXhwZWN0ZWQuc291cmNlICYmXG4gICAgICAgICAgIGFjdHVhbC5nbG9iYWwgPT09IGV4cGVjdGVkLmdsb2JhbCAmJlxuICAgICAgICAgICBhY3R1YWwubXVsdGlsaW5lID09PSBleHBlY3RlZC5tdWx0aWxpbmUgJiZcbiAgICAgICAgICAgYWN0dWFsLmxhc3RJbmRleCA9PT0gZXhwZWN0ZWQubGFzdEluZGV4ICYmXG4gICAgICAgICAgIGFjdHVhbC5pZ25vcmVDYXNlID09PSBleHBlY3RlZC5pZ25vcmVDYXNlO1xuXG4gIC8vIDcuNC4gT3RoZXIgcGFpcnMgdGhhdCBkbyBub3QgYm90aCBwYXNzIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JyxcbiAgLy8gZXF1aXZhbGVuY2UgaXMgZGV0ZXJtaW5lZCBieSA9PS5cbiAgfSBlbHNlIGlmICgoYWN0dWFsID09PSBudWxsIHx8IHR5cGVvZiBhY3R1YWwgIT09ICdvYmplY3QnKSAmJlxuICAgICAgICAgICAgIChleHBlY3RlZCA9PT0gbnVsbCB8fCB0eXBlb2YgZXhwZWN0ZWQgIT09ICdvYmplY3QnKSkge1xuICAgIHJldHVybiBzdHJpY3QgPyBhY3R1YWwgPT09IGV4cGVjdGVkIDogYWN0dWFsID09IGV4cGVjdGVkO1xuXG4gIC8vIElmIGJvdGggdmFsdWVzIGFyZSBpbnN0YW5jZXMgb2YgdHlwZWQgYXJyYXlzLCB3cmFwIHRoZWlyIHVuZGVybHlpbmdcbiAgLy8gQXJyYXlCdWZmZXJzIGluIGEgQnVmZmVyIGVhY2ggdG8gaW5jcmVhc2UgcGVyZm9ybWFuY2VcbiAgLy8gVGhpcyBvcHRpbWl6YXRpb24gcmVxdWlyZXMgdGhlIGFycmF5cyB0byBoYXZlIHRoZSBzYW1lIHR5cGUgYXMgY2hlY2tlZCBieVxuICAvLyBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nIChha2EgcFRvU3RyaW5nKS4gTmV2ZXIgcGVyZm9ybSBiaW5hcnlcbiAgLy8gY29tcGFyaXNvbnMgZm9yIEZsb2F0KkFycmF5cywgdGhvdWdoLCBzaW5jZSBlLmcuICswID09PSAtMCBidXQgdGhlaXJcbiAgLy8gYml0IHBhdHRlcm5zIGFyZSBub3QgaWRlbnRpY2FsLlxuICB9IGVsc2UgaWYgKGlzVmlldyhhY3R1YWwpICYmIGlzVmlldyhleHBlY3RlZCkgJiZcbiAgICAgICAgICAgICBwVG9TdHJpbmcoYWN0dWFsKSA9PT0gcFRvU3RyaW5nKGV4cGVjdGVkKSAmJlxuICAgICAgICAgICAgICEoYWN0dWFsIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8XG4gICAgICAgICAgICAgICBhY3R1YWwgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpKSB7XG4gICAgcmV0dXJuIGNvbXBhcmUobmV3IFVpbnQ4QXJyYXkoYWN0dWFsLmJ1ZmZlciksXG4gICAgICAgICAgICAgICAgICAgbmV3IFVpbnQ4QXJyYXkoZXhwZWN0ZWQuYnVmZmVyKSkgPT09IDA7XG5cbiAgLy8gNy41IEZvciBhbGwgb3RoZXIgT2JqZWN0IHBhaXJzLCBpbmNsdWRpbmcgQXJyYXkgb2JqZWN0cywgZXF1aXZhbGVuY2UgaXNcbiAgLy8gZGV0ZXJtaW5lZCBieSBoYXZpbmcgdGhlIHNhbWUgbnVtYmVyIG9mIG93bmVkIHByb3BlcnRpZXMgKGFzIHZlcmlmaWVkXG4gIC8vIHdpdGggT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKSwgdGhlIHNhbWUgc2V0IG9mIGtleXNcbiAgLy8gKGFsdGhvdWdoIG5vdCBuZWNlc3NhcmlseSB0aGUgc2FtZSBvcmRlciksIGVxdWl2YWxlbnQgdmFsdWVzIGZvciBldmVyeVxuICAvLyBjb3JyZXNwb25kaW5nIGtleSwgYW5kIGFuIGlkZW50aWNhbCAncHJvdG90eXBlJyBwcm9wZXJ0eS4gTm90ZTogdGhpc1xuICAvLyBhY2NvdW50cyBmb3IgYm90aCBuYW1lZCBhbmQgaW5kZXhlZCBwcm9wZXJ0aWVzIG9uIEFycmF5cy5cbiAgfSBlbHNlIGlmIChpc0J1ZmZlcihhY3R1YWwpICE9PSBpc0J1ZmZlcihleHBlY3RlZCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSB7XG4gICAgbWVtb3MgPSBtZW1vcyB8fCB7YWN0dWFsOiBbXSwgZXhwZWN0ZWQ6IFtdfTtcblxuICAgIHZhciBhY3R1YWxJbmRleCA9IG1lbW9zLmFjdHVhbC5pbmRleE9mKGFjdHVhbCk7XG4gICAgaWYgKGFjdHVhbEluZGV4ICE9PSAtMSkge1xuICAgICAgaWYgKGFjdHVhbEluZGV4ID09PSBtZW1vcy5leHBlY3RlZC5pbmRleE9mKGV4cGVjdGVkKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBtZW1vcy5hY3R1YWwucHVzaChhY3R1YWwpO1xuICAgIG1lbW9zLmV4cGVjdGVkLnB1c2goZXhwZWN0ZWQpO1xuXG4gICAgcmV0dXJuIG9iakVxdWl2KGFjdHVhbCwgZXhwZWN0ZWQsIHN0cmljdCwgbWVtb3MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzQXJndW1lbnRzKG9iamVjdCkge1xuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iamVjdCkgPT0gJ1tvYmplY3QgQXJndW1lbnRzXSc7XG59XG5cbmZ1bmN0aW9uIG9iakVxdWl2KGEsIGIsIHN0cmljdCwgYWN0dWFsVmlzaXRlZE9iamVjdHMpIHtcbiAgaWYgKGEgPT09IG51bGwgfHwgYSA9PT0gdW5kZWZpbmVkIHx8IGIgPT09IG51bGwgfHwgYiA9PT0gdW5kZWZpbmVkKVxuICAgIHJldHVybiBmYWxzZTtcbiAgLy8gaWYgb25lIGlzIGEgcHJpbWl0aXZlLCB0aGUgb3RoZXIgbXVzdCBiZSBzYW1lXG4gIGlmICh1dGlsLmlzUHJpbWl0aXZlKGEpIHx8IHV0aWwuaXNQcmltaXRpdmUoYikpXG4gICAgcmV0dXJuIGEgPT09IGI7XG4gIGlmIChzdHJpY3QgJiYgT2JqZWN0LmdldFByb3RvdHlwZU9mKGEpICE9PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYikpXG4gICAgcmV0dXJuIGZhbHNlO1xuICB2YXIgYUlzQXJncyA9IGlzQXJndW1lbnRzKGEpO1xuICB2YXIgYklzQXJncyA9IGlzQXJndW1lbnRzKGIpO1xuICBpZiAoKGFJc0FyZ3MgJiYgIWJJc0FyZ3MpIHx8ICghYUlzQXJncyAmJiBiSXNBcmdzKSlcbiAgICByZXR1cm4gZmFsc2U7XG4gIGlmIChhSXNBcmdzKSB7XG4gICAgYSA9IHBTbGljZS5jYWxsKGEpO1xuICAgIGIgPSBwU2xpY2UuY2FsbChiKTtcbiAgICByZXR1cm4gX2RlZXBFcXVhbChhLCBiLCBzdHJpY3QpO1xuICB9XG4gIHZhciBrYSA9IG9iamVjdEtleXMoYSk7XG4gIHZhciBrYiA9IG9iamVjdEtleXMoYik7XG4gIHZhciBrZXksIGk7XG4gIC8vIGhhdmluZyB0aGUgc2FtZSBudW1iZXIgb2Ygb3duZWQgcHJvcGVydGllcyAoa2V5cyBpbmNvcnBvcmF0ZXNcbiAgLy8gaGFzT3duUHJvcGVydHkpXG4gIGlmIChrYS5sZW5ndGggIT09IGtiLmxlbmd0aClcbiAgICByZXR1cm4gZmFsc2U7XG4gIC8vdGhlIHNhbWUgc2V0IG9mIGtleXMgKGFsdGhvdWdoIG5vdCBuZWNlc3NhcmlseSB0aGUgc2FtZSBvcmRlciksXG4gIGthLnNvcnQoKTtcbiAga2Iuc29ydCgpO1xuICAvL35+fmNoZWFwIGtleSB0ZXN0XG4gIGZvciAoaSA9IGthLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgaWYgKGthW2ldICE9PSBrYltpXSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvL2VxdWl2YWxlbnQgdmFsdWVzIGZvciBldmVyeSBjb3JyZXNwb25kaW5nIGtleSwgYW5kXG4gIC8vfn5+cG9zc2libHkgZXhwZW5zaXZlIGRlZXAgdGVzdFxuICBmb3IgKGkgPSBrYS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIGtleSA9IGthW2ldO1xuICAgIGlmICghX2RlZXBFcXVhbChhW2tleV0sIGJba2V5XSwgc3RyaWN0LCBhY3R1YWxWaXNpdGVkT2JqZWN0cykpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8vIDguIFRoZSBub24tZXF1aXZhbGVuY2UgYXNzZXJ0aW9uIHRlc3RzIGZvciBhbnkgZGVlcCBpbmVxdWFsaXR5LlxuLy8gYXNzZXJ0Lm5vdERlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlX29wdCk7XG5cbmFzc2VydC5ub3REZWVwRXF1YWwgPSBmdW5jdGlvbiBub3REZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkge1xuICBpZiAoX2RlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBmYWxzZSkpIHtcbiAgICBmYWlsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UsICdub3REZWVwRXF1YWwnLCBhc3NlcnQubm90RGVlcEVxdWFsKTtcbiAgfVxufTtcblxuYXNzZXJ0Lm5vdERlZXBTdHJpY3RFcXVhbCA9IG5vdERlZXBTdHJpY3RFcXVhbDtcbmZ1bmN0aW9uIG5vdERlZXBTdHJpY3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7XG4gIGlmIChfZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIHRydWUpKSB7XG4gICAgZmFpbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlLCAnbm90RGVlcFN0cmljdEVxdWFsJywgbm90RGVlcFN0cmljdEVxdWFsKTtcbiAgfVxufVxuXG5cbi8vIDkuIFRoZSBzdHJpY3QgZXF1YWxpdHkgYXNzZXJ0aW9uIHRlc3RzIHN0cmljdCBlcXVhbGl0eSwgYXMgZGV0ZXJtaW5lZCBieSA9PT0uXG4vLyBhc3NlcnQuc3RyaWN0RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZV9vcHQpO1xuXG5hc3NlcnQuc3RyaWN0RXF1YWwgPSBmdW5jdGlvbiBzdHJpY3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7XG4gIGlmIChhY3R1YWwgIT09IGV4cGVjdGVkKSB7XG4gICAgZmFpbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlLCAnPT09JywgYXNzZXJ0LnN0cmljdEVxdWFsKTtcbiAgfVxufTtcblxuLy8gMTAuIFRoZSBzdHJpY3Qgbm9uLWVxdWFsaXR5IGFzc2VydGlvbiB0ZXN0cyBmb3Igc3RyaWN0IGluZXF1YWxpdHksIGFzXG4vLyBkZXRlcm1pbmVkIGJ5ICE9PS4gIGFzc2VydC5ub3RTdHJpY3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlX29wdCk7XG5cbmFzc2VydC5ub3RTdHJpY3RFcXVhbCA9IGZ1bmN0aW9uIG5vdFN0cmljdEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHtcbiAgaWYgKGFjdHVhbCA9PT0gZXhwZWN0ZWQpIHtcbiAgICBmYWlsKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UsICchPT0nLCBhc3NlcnQubm90U3RyaWN0RXF1YWwpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBleHBlY3RlZEV4Y2VwdGlvbihhY3R1YWwsIGV4cGVjdGVkKSB7XG4gIGlmICghYWN0dWFsIHx8ICFleHBlY3RlZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZXhwZWN0ZWQpID09ICdbb2JqZWN0IFJlZ0V4cF0nKSB7XG4gICAgcmV0dXJuIGV4cGVjdGVkLnRlc3QoYWN0dWFsKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgaWYgKGFjdHVhbCBpbnN0YW5jZW9mIGV4cGVjdGVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBJZ25vcmUuICBUaGUgaW5zdGFuY2VvZiBjaGVjayBkb2Vzbid0IHdvcmsgZm9yIGFycm93IGZ1bmN0aW9ucy5cbiAgfVxuXG4gIGlmIChFcnJvci5pc1Byb3RvdHlwZU9mKGV4cGVjdGVkKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiBleHBlY3RlZC5jYWxsKHt9LCBhY3R1YWwpID09PSB0cnVlO1xufVxuXG5mdW5jdGlvbiBfdHJ5QmxvY2soYmxvY2spIHtcbiAgdmFyIGVycm9yO1xuICB0cnkge1xuICAgIGJsb2NrKCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBlcnJvciA9IGU7XG4gIH1cbiAgcmV0dXJuIGVycm9yO1xufVxuXG5mdW5jdGlvbiBfdGhyb3dzKHNob3VsZFRocm93LCBibG9jaywgZXhwZWN0ZWQsIG1lc3NhZ2UpIHtcbiAgdmFyIGFjdHVhbDtcblxuICBpZiAodHlwZW9mIGJsb2NrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJibG9ja1wiIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbicpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBleHBlY3RlZCA9PT0gJ3N0cmluZycpIHtcbiAgICBtZXNzYWdlID0gZXhwZWN0ZWQ7XG4gICAgZXhwZWN0ZWQgPSBudWxsO1xuICB9XG5cbiAgYWN0dWFsID0gX3RyeUJsb2NrKGJsb2NrKTtcblxuICBtZXNzYWdlID0gKGV4cGVjdGVkICYmIGV4cGVjdGVkLm5hbWUgPyAnICgnICsgZXhwZWN0ZWQubmFtZSArICcpLicgOiAnLicpICtcbiAgICAgICAgICAgIChtZXNzYWdlID8gJyAnICsgbWVzc2FnZSA6ICcuJyk7XG5cbiAgaWYgKHNob3VsZFRocm93ICYmICFhY3R1YWwpIHtcbiAgICBmYWlsKGFjdHVhbCwgZXhwZWN0ZWQsICdNaXNzaW5nIGV4cGVjdGVkIGV4Y2VwdGlvbicgKyBtZXNzYWdlKTtcbiAgfVxuXG4gIHZhciB1c2VyUHJvdmlkZWRNZXNzYWdlID0gdHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnO1xuICB2YXIgaXNVbndhbnRlZEV4Y2VwdGlvbiA9ICFzaG91bGRUaHJvdyAmJiB1dGlsLmlzRXJyb3IoYWN0dWFsKTtcbiAgdmFyIGlzVW5leHBlY3RlZEV4Y2VwdGlvbiA9ICFzaG91bGRUaHJvdyAmJiBhY3R1YWwgJiYgIWV4cGVjdGVkO1xuXG4gIGlmICgoaXNVbndhbnRlZEV4Y2VwdGlvbiAmJlxuICAgICAgdXNlclByb3ZpZGVkTWVzc2FnZSAmJlxuICAgICAgZXhwZWN0ZWRFeGNlcHRpb24oYWN0dWFsLCBleHBlY3RlZCkpIHx8XG4gICAgICBpc1VuZXhwZWN0ZWRFeGNlcHRpb24pIHtcbiAgICBmYWlsKGFjdHVhbCwgZXhwZWN0ZWQsICdHb3QgdW53YW50ZWQgZXhjZXB0aW9uJyArIG1lc3NhZ2UpO1xuICB9XG5cbiAgaWYgKChzaG91bGRUaHJvdyAmJiBhY3R1YWwgJiYgZXhwZWN0ZWQgJiZcbiAgICAgICFleHBlY3RlZEV4Y2VwdGlvbihhY3R1YWwsIGV4cGVjdGVkKSkgfHwgKCFzaG91bGRUaHJvdyAmJiBhY3R1YWwpKSB7XG4gICAgdGhyb3cgYWN0dWFsO1xuICB9XG59XG5cbi8vIDExLiBFeHBlY3RlZCB0byB0aHJvdyBhbiBlcnJvcjpcbi8vIGFzc2VydC50aHJvd3MoYmxvY2ssIEVycm9yX29wdCwgbWVzc2FnZV9vcHQpO1xuXG5hc3NlcnQudGhyb3dzID0gZnVuY3Rpb24oYmxvY2ssIC8qb3B0aW9uYWwqL2Vycm9yLCAvKm9wdGlvbmFsKi9tZXNzYWdlKSB7XG4gIF90aHJvd3ModHJ1ZSwgYmxvY2ssIGVycm9yLCBtZXNzYWdlKTtcbn07XG5cbi8vIEVYVEVOU0lPTiEgVGhpcyBpcyBhbm5veWluZyB0byB3cml0ZSBvdXRzaWRlIHRoaXMgbW9kdWxlLlxuYXNzZXJ0LmRvZXNOb3RUaHJvdyA9IGZ1bmN0aW9uKGJsb2NrLCAvKm9wdGlvbmFsKi9lcnJvciwgLypvcHRpb25hbCovbWVzc2FnZSkge1xuICBfdGhyb3dzKGZhbHNlLCBibG9jaywgZXJyb3IsIG1lc3NhZ2UpO1xufTtcblxuYXNzZXJ0LmlmRXJyb3IgPSBmdW5jdGlvbihlcnIpIHsgaWYgKGVycikgdGhyb3cgZXJyOyB9O1xuXG52YXIgb2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIChvYmopIHtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgIGlmIChoYXNPd24uY2FsbChvYmosIGtleSkpIGtleXMucHVzaChrZXkpO1xuICB9XG4gIHJldHVybiBrZXlzO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hc3NlcnQvYXNzZXJ0LmpzXG4vLyBtb2R1bGUgaWQgPSA2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 7 */
/***/ function(module, exports) {

	eval("module.exports = now\n\nfunction now() {\n    return new Date().getTime()\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL34vZGF0ZS1ub3cvaW5kZXguanM/ZDJiNiJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IG5vd1xuXG5mdW5jdGlvbiBub3coKSB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpXG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vZGF0ZS1ub3cvaW5kZXguanNcbi8vIG1vZHVsZSBpZCA9IDdcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 8 */
/***/ function(module, exports, __webpack_require__) {

	eval("\"use strict\";\n\nvar store = __webpack_require__(9);\n\nvar baseUrlState = {\n\n    get: function get() {\n        return store.getState().baseUrl;\n    },\n\n    set: function set(baseUrl) {\n        store.dispatch({\n            type: \"UPDATE_BASE_URL\",\n            baseUrl: baseUrl\n        });\n    }\n\n};\n\nmodule.exports = baseUrlState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvc2hhcmVkL3N0YXRlL2Jhc2VVcmxTdGF0ZS5qcz82ZDg3Il0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIHN0b3JlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3N0YXRlJyk7XG5cbnZhciBiYXNlVXJsU3RhdGUgPSB7XG5cbiAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc3RvcmUuZ2V0U3RhdGUoKS5iYXNlVXJsO1xuICAgIH0sXG5cbiAgICBzZXQ6IGZ1bmN0aW9uKGJhc2VVcmwpIHtcbiAgICAgICAgc3RvcmUuZGlzcGF0Y2goe1xuICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfQkFTRV9VUkxcIixcbiAgICAgICAgICAgIGJhc2VVcmw6IGJhc2VVcmxcbiAgICAgICAgfSk7XG4gICAgfVxuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGJhc2VVcmxTdGF0ZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9zdGF0ZS9iYXNlVXJsU3RhdGUuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBWkE7QUFDQTtBQWNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 9 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {\"use strict\";\n\nvar Redux = __webpack_require__(10);\n\n/* Reducer */\nfunction florence() {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n    var action = arguments[1];\n\n    // Parse to string, clone and parse back to object to keep original state immutable\n    var newState = JSON.parse(JSON.stringify(state));\n\n    // Reducer switch function, updates the state as necessary\n    switch (action.type) {\n        case \"UPDATE_BASE_URL\":\n            {\n                newState.baseUrl = action.baseUrl;\n                break;\n            }\n        case \"UPDATE_BROWSE_TREE_DATA\":\n            {\n                newState.workspace.browseTreeData = action.browseTreeData;\n                break;\n            }\n        case \"RESET_WORKSPACE\":\n            {\n                newState.workspace = initialState.workspace;\n                break;\n            }\n        case \"UPDATE_ACTIVE_WORKSPACE_SCREEN\":\n            {\n                newState.workspace.activeScreen = action.activeScreen;\n                break;\n            }\n        case \"UPDATE_WORKSPACE_ACTIVE_URL\":\n            {\n                newState.workspace.activeUrl = action.activeUrl;\n                break;\n            }\n        case \"UPDATE_WORKSPACE_PREVIEW_URL\":\n            {\n                newState.workspace.activeUrl = action.previewUrl;\n                break;\n            }\n        case \"UPDATE_COLLECTION_DATA\":\n            {\n                newState.workspace.collectionData = action.collectionData;\n                break;\n            }\n        case \"UPDATE_USER_EMAIL\":\n            {\n                newState.user.email = action.userEmail;\n                break;\n            }\n        case \"UPDATE_USER_TYPE\":\n            {\n                newState.user.type = action.userType;\n                break;\n            }\n        case \"UPDATE_IS_DIRTY\":\n            {\n                newState.workspace.isDirty = action.isDirty;\n                break;\n            }\n        case \"UPDATE_EDITOR_DATA\":\n            {\n                newState.workspace.editorData = action.editorData;\n                break;\n            }\n        default:\n            {\n                console.log(\"State action '%s' not recognised\", action.type);\n            }\n    }\n\n    return newState;\n}\n\n/* Create store */\nvar createStore = Redux.createStore;\nvar initialState = {\n    baseUrl: \"\",\n    user: {\n        email: \"\",\n        hasSession: false,\n        sessonExpiryDate: \"\",\n        type: \"\"\n    },\n    activeView: {\n        name: \"editor\"\n    },\n    workspace: {\n        collectionData: {},\n        browseTreeData: {},\n        activeScreen: \"\",\n        activeUrl: \"\",\n        previewUrl: \"\",\n        language: \"english\",\n        isDirty: false,\n        editorData: {}\n    }\n};\nvar store = createStore(florence, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__());\n\nmodule.exports = store;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hcHAvc2hhcmVkL3N0YXRlL3N0YXRlLmpzPzQ4ZDEiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUmVkdXggPSByZXF1aXJlKCdyZWR1eCcpO1xuXG4vKiBSZWR1Y2VyICovXG5mdW5jdGlvbiBmbG9yZW5jZShzdGF0ZSA9IGluaXRpYWxTdGF0ZSwgYWN0aW9uKSB7XG4gICAgLy8gUGFyc2UgdG8gc3RyaW5nLCBjbG9uZSBhbmQgcGFyc2UgYmFjayB0byBvYmplY3QgdG8ga2VlcCBvcmlnaW5hbCBzdGF0ZSBpbW11dGFibGVcbiAgICBsZXQgbmV3U3RhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7XG5cbiAgICAvLyBSZWR1Y2VyIHN3aXRjaCBmdW5jdGlvbiwgdXBkYXRlcyB0aGUgc3RhdGUgYXMgbmVjZXNzYXJ5XG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlIChcIlVQREFURV9CQVNFX1VSTFwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUuYmFzZVVybCA9IGFjdGlvbi5iYXNlVXJsO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoXCJVUERBVEVfQlJPV1NFX1RSRUVfREFUQVwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUud29ya3NwYWNlLmJyb3dzZVRyZWVEYXRhID0gYWN0aW9uLmJyb3dzZVRyZWVEYXRhO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoXCJSRVNFVF9XT1JLU1BBQ0VcIik6IHtcbiAgICAgICAgICAgIG5ld1N0YXRlLndvcmtzcGFjZSA9IGluaXRpYWxTdGF0ZS53b3Jrc3BhY2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcIlVQREFURV9BQ1RJVkVfV09SS1NQQUNFX1NDUkVFTlwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUud29ya3NwYWNlLmFjdGl2ZVNjcmVlbiA9IGFjdGlvbi5hY3RpdmVTY3JlZW47XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcIlVQREFURV9XT1JLU1BBQ0VfQUNUSVZFX1VSTFwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUud29ya3NwYWNlLmFjdGl2ZVVybCA9IGFjdGlvbi5hY3RpdmVVcmw7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcIlVQREFURV9XT1JLU1BBQ0VfUFJFVklFV19VUkxcIik6IHtcbiAgICAgICAgICAgIG5ld1N0YXRlLndvcmtzcGFjZS5hY3RpdmVVcmwgPSBhY3Rpb24ucHJldmlld1VybDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgKFwiVVBEQVRFX0NPTExFQ1RJT05fREFUQVwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUud29ya3NwYWNlLmNvbGxlY3Rpb25EYXRhID0gYWN0aW9uLmNvbGxlY3Rpb25EYXRhO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoXCJVUERBVEVfVVNFUl9FTUFJTFwiKToge1xuICAgICAgICAgICAgbmV3U3RhdGUudXNlci5lbWFpbCA9IGFjdGlvbi51c2VyRW1haWw7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcIlVQREFURV9VU0VSX1RZUEVcIik6IHtcbiAgICAgICAgICAgIG5ld1N0YXRlLnVzZXIudHlwZSA9IGFjdGlvbi51c2VyVHlwZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgKFwiVVBEQVRFX0lTX0RJUlRZXCIpOiB7XG4gICAgICAgICAgICBuZXdTdGF0ZS53b3Jrc3BhY2UuaXNEaXJ0eSA9IGFjdGlvbi5pc0RpcnR5O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAoXCJVUERBVEVfRURJVE9SX0RBVEFcIik6IHtcbiAgICAgICAgICAgIG5ld1N0YXRlLndvcmtzcGFjZS5lZGl0b3JEYXRhID0gYWN0aW9uLmVkaXRvckRhdGE7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXRlIGFjdGlvbiAnJXMnIG5vdCByZWNvZ25pc2VkXCIsIGFjdGlvbi50eXBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdTdGF0ZVxufVxuXG4vKiBDcmVhdGUgc3RvcmUgKi9cbmNvbnN0IGNyZWF0ZVN0b3JlID0gUmVkdXguY3JlYXRlU3RvcmU7XG5jb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gICAgICAgIGJhc2VVcmw6IFwiXCIsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGVtYWlsOiBcIlwiLFxuICAgICAgICAgICAgaGFzU2Vzc2lvbjogZmFsc2UsXG4gICAgICAgICAgICBzZXNzb25FeHBpcnlEYXRlOiBcIlwiLFxuICAgICAgICAgICAgdHlwZTogXCJcIlxuICAgICAgICB9LFxuICAgICAgICBhY3RpdmVWaWV3OiB7XG4gICAgICAgICAgICBuYW1lOiBcImVkaXRvclwiXG4gICAgICAgIH0sXG4gICAgICAgIHdvcmtzcGFjZToge1xuICAgICAgICAgICAgY29sbGVjdGlvbkRhdGE6IHt9LFxuICAgICAgICAgICAgYnJvd3NlVHJlZURhdGE6IHt9LFxuICAgICAgICAgICAgYWN0aXZlU2NyZWVuOiBcIlwiLFxuICAgICAgICAgICAgYWN0aXZlVXJsOiBcIlwiLFxuICAgICAgICAgICAgcHJldmlld1VybDogXCJcIixcbiAgICAgICAgICAgIGxhbmd1YWdlOiBcImVuZ2xpc2hcIixcbiAgICAgICAgICAgIGlzRGlydHk6IGZhbHNlLFxuICAgICAgICAgICAgZWRpdG9yRGF0YToge31cbiAgICAgICAgfVxuICAgIH07XG5jb25zdCBzdG9yZSA9IGNyZWF0ZVN0b3JlKGZsb3JlbmNlLCB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXyAmJiB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXygpKTtcblxubW9kdWxlLmV4cG9ydHMgPSBzdG9yZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9zdGF0ZS9zdGF0ZS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBL0NBO0FBQ0E7QUFpREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVhBO0FBc0JBO0FBQ0E7OyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 10 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(process) {'use strict';\n\nexports.__esModule = true;\nexports.compose = exports.applyMiddleware = exports.bindActionCreators = exports.combineReducers = exports.createStore = undefined;\n\nvar _createStore = __webpack_require__(11);\n\nvar _createStore2 = _interopRequireDefault(_createStore);\n\nvar _combineReducers = __webpack_require__(19);\n\nvar _combineReducers2 = _interopRequireDefault(_combineReducers);\n\nvar _bindActionCreators = __webpack_require__(21);\n\nvar _bindActionCreators2 = _interopRequireDefault(_bindActionCreators);\n\nvar _applyMiddleware = __webpack_require__(22);\n\nvar _applyMiddleware2 = _interopRequireDefault(_applyMiddleware);\n\nvar _compose = __webpack_require__(23);\n\nvar _compose2 = _interopRequireDefault(_compose);\n\nvar _warning = __webpack_require__(20);\n\nvar _warning2 = _interopRequireDefault(_warning);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\n/*\n* This is a dummy function to check if the function name has been altered by minification.\n* If the function has been minified and NODE_ENV !== 'production', warn the user.\n*/\nfunction isCrushed() {}\n\nif (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  (0, _warning2['default'])('You are currently using minified code outside of NODE_ENV === \\'production\\'. ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) ' + 'to ensure you have the correct code for your production build.');\n}\n\nexports.createStore = _createStore2['default'];\nexports.combineReducers = _combineReducers2['default'];\nexports.bindActionCreators = _bindActionCreators2['default'];\nexports.applyMiddleware = _applyMiddleware2['default'];\nexports.compose = _compose2['default'];\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9pbmRleC5qcz81ZjE5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuY29tcG9zZSA9IGV4cG9ydHMuYXBwbHlNaWRkbGV3YXJlID0gZXhwb3J0cy5iaW5kQWN0aW9uQ3JlYXRvcnMgPSBleHBvcnRzLmNvbWJpbmVSZWR1Y2VycyA9IGV4cG9ydHMuY3JlYXRlU3RvcmUgPSB1bmRlZmluZWQ7XG5cbnZhciBfY3JlYXRlU3RvcmUgPSByZXF1aXJlKCcuL2NyZWF0ZVN0b3JlJyk7XG5cbnZhciBfY3JlYXRlU3RvcmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY3JlYXRlU3RvcmUpO1xuXG52YXIgX2NvbWJpbmVSZWR1Y2VycyA9IHJlcXVpcmUoJy4vY29tYmluZVJlZHVjZXJzJyk7XG5cbnZhciBfY29tYmluZVJlZHVjZXJzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbWJpbmVSZWR1Y2Vycyk7XG5cbnZhciBfYmluZEFjdGlvbkNyZWF0b3JzID0gcmVxdWlyZSgnLi9iaW5kQWN0aW9uQ3JlYXRvcnMnKTtcblxudmFyIF9iaW5kQWN0aW9uQ3JlYXRvcnMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYmluZEFjdGlvbkNyZWF0b3JzKTtcblxudmFyIF9hcHBseU1pZGRsZXdhcmUgPSByZXF1aXJlKCcuL2FwcGx5TWlkZGxld2FyZScpO1xuXG52YXIgX2FwcGx5TWlkZGxld2FyZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hcHBseU1pZGRsZXdhcmUpO1xuXG52YXIgX2NvbXBvc2UgPSByZXF1aXJlKCcuL2NvbXBvc2UnKTtcblxudmFyIF9jb21wb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvc2UpO1xuXG52YXIgX3dhcm5pbmcgPSByZXF1aXJlKCcuL3V0aWxzL3dhcm5pbmcnKTtcblxudmFyIF93YXJuaW5nMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3dhcm5pbmcpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbi8qXG4qIFRoaXMgaXMgYSBkdW1teSBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgZnVuY3Rpb24gbmFtZSBoYXMgYmVlbiBhbHRlcmVkIGJ5IG1pbmlmaWNhdGlvbi5cbiogSWYgdGhlIGZ1bmN0aW9uIGhhcyBiZWVuIG1pbmlmaWVkIGFuZCBOT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nLCB3YXJuIHRoZSB1c2VyLlxuKi9cbmZ1bmN0aW9uIGlzQ3J1c2hlZCgpIHt9XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHR5cGVvZiBpc0NydXNoZWQubmFtZSA9PT0gJ3N0cmluZycgJiYgaXNDcnVzaGVkLm5hbWUgIT09ICdpc0NydXNoZWQnKSB7XG4gICgwLCBfd2FybmluZzJbJ2RlZmF1bHQnXSkoJ1lvdSBhcmUgY3VycmVudGx5IHVzaW5nIG1pbmlmaWVkIGNvZGUgb3V0c2lkZSBvZiBOT0RFX0VOViA9PT0gXFwncHJvZHVjdGlvblxcJy4gJyArICdUaGlzIG1lYW5zIHRoYXQgeW91IGFyZSBydW5uaW5nIGEgc2xvd2VyIGRldmVsb3BtZW50IGJ1aWxkIG9mIFJlZHV4LiAnICsgJ1lvdSBjYW4gdXNlIGxvb3NlLWVudmlmeSAoaHR0cHM6Ly9naXRodWIuY29tL3plcnRvc2gvbG9vc2UtZW52aWZ5KSBmb3IgYnJvd3NlcmlmeSAnICsgJ29yIERlZmluZVBsdWdpbiBmb3Igd2VicGFjayAoaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAzMDAzMSkgJyArICd0byBlbnN1cmUgeW91IGhhdmUgdGhlIGNvcnJlY3QgY29kZSBmb3IgeW91ciBwcm9kdWN0aW9uIGJ1aWxkLicpO1xufVxuXG5leHBvcnRzLmNyZWF0ZVN0b3JlID0gX2NyZWF0ZVN0b3JlMlsnZGVmYXVsdCddO1xuZXhwb3J0cy5jb21iaW5lUmVkdWNlcnMgPSBfY29tYmluZVJlZHVjZXJzMlsnZGVmYXVsdCddO1xuZXhwb3J0cy5iaW5kQWN0aW9uQ3JlYXRvcnMgPSBfYmluZEFjdGlvbkNyZWF0b3JzMlsnZGVmYXVsdCddO1xuZXhwb3J0cy5hcHBseU1pZGRsZXdhcmUgPSBfYXBwbHlNaWRkbGV3YXJlMlsnZGVmYXVsdCddO1xuZXhwb3J0cy5jb21wb3NlID0gX2NvbXBvc2UyWydkZWZhdWx0J107XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3JlZHV4L2xpYi9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gMTBcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 11 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nexports.__esModule = true;\nexports.ActionTypes = undefined;\nexports['default'] = createStore;\n\nvar _isPlainObject = __webpack_require__(12);\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _symbolObservable = __webpack_require__(16);\n\nvar _symbolObservable2 = _interopRequireDefault(_symbolObservable);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nvar ActionTypes = exports.ActionTypes = {\n  INIT: '@@redux/INIT'\n};\n\n/**\n * Creates a Redux store that holds the state tree.\n * The only way to change the data in the store is to call `dispatch()` on it.\n *\n * There should only be a single store in your app. To specify how different\n * parts of the state tree respond to actions, you may combine several reducers\n * into a single reducer function by using `combineReducers`.\n *\n * @param {Function} reducer A function that returns the next state tree, given\n * the current state tree and the action to handle.\n *\n * @param {any} [preloadedState] The initial state. You may optionally specify it\n * to hydrate the state from the server in universal apps, or to restore a\n * previously serialized user session.\n * If you use `combineReducers` to produce the root reducer function, this must be\n * an object with the same shape as `combineReducers` keys.\n *\n * @param {Function} enhancer The store enhancer. You may optionally specify it\n * to enhance the store with third-party capabilities such as middleware,\n * time travel, persistence, etc. The only store enhancer that ships with Redux\n * is `applyMiddleware()`.\n *\n * @returns {Store} A Redux store that lets you read the state, dispatch actions\n * and subscribe to changes.\n */\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.');\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error('Expected the reducer to be a function.');\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n  function getState() {\n    return currentState;\n  }\n\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('Expected listener to be a function.');\n    }\n\n    var isSubscribed = true;\n\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      isSubscribed = false;\n\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\n\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n  function dispatch(action) {\n    if (!(0, _isPlainObject2['default'])(action)) {\n      throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.');\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error('Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?');\n    }\n\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i]();\n    }\n\n    return action;\n  }\n\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.');\n    }\n\n    currentReducer = nextReducer;\n    dispatch({ type: ActionTypes.INIT });\n  }\n\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/zenparsing/es-observable\n   */\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object') {\n          throw new TypeError('Expected the observer to be an object.');\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return { unsubscribe: unsubscribe };\n      }\n    }, _ref[_symbolObservable2['default']] = function () {\n      return this;\n    }, _ref;\n  }\n\n  // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n  dispatch({ type: ActionTypes.INIT });\n\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[_symbolObservable2['default']] = observable, _ref2;\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9jcmVhdGVTdG9yZS5qcz9mZTRjIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuQWN0aW9uVHlwZXMgPSB1bmRlZmluZWQ7XG5leHBvcnRzWydkZWZhdWx0J10gPSBjcmVhdGVTdG9yZTtcblxudmFyIF9pc1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnbG9kYXNoL2lzUGxhaW5PYmplY3QnKTtcblxudmFyIF9pc1BsYWluT2JqZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lzUGxhaW5PYmplY3QpO1xuXG52YXIgX3N5bWJvbE9ic2VydmFibGUgPSByZXF1aXJlKCdzeW1ib2wtb2JzZXJ2YWJsZScpO1xuXG52YXIgX3N5bWJvbE9ic2VydmFibGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3ltYm9sT2JzZXJ2YWJsZSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxuLyoqXG4gKiBUaGVzZSBhcmUgcHJpdmF0ZSBhY3Rpb24gdHlwZXMgcmVzZXJ2ZWQgYnkgUmVkdXguXG4gKiBGb3IgYW55IHVua25vd24gYWN0aW9ucywgeW91IG11c3QgcmV0dXJuIHRoZSBjdXJyZW50IHN0YXRlLlxuICogSWYgdGhlIGN1cnJlbnQgc3RhdGUgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUuXG4gKiBEbyBub3QgcmVmZXJlbmNlIHRoZXNlIGFjdGlvbiB0eXBlcyBkaXJlY3RseSBpbiB5b3VyIGNvZGUuXG4gKi9cbnZhciBBY3Rpb25UeXBlcyA9IGV4cG9ydHMuQWN0aW9uVHlwZXMgPSB7XG4gIElOSVQ6ICdAQHJlZHV4L0lOSVQnXG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBSZWR1eCBzdG9yZSB0aGF0IGhvbGRzIHRoZSBzdGF0ZSB0cmVlLlxuICogVGhlIG9ubHkgd2F5IHRvIGNoYW5nZSB0aGUgZGF0YSBpbiB0aGUgc3RvcmUgaXMgdG8gY2FsbCBgZGlzcGF0Y2goKWAgb24gaXQuXG4gKlxuICogVGhlcmUgc2hvdWxkIG9ubHkgYmUgYSBzaW5nbGUgc3RvcmUgaW4geW91ciBhcHAuIFRvIHNwZWNpZnkgaG93IGRpZmZlcmVudFxuICogcGFydHMgb2YgdGhlIHN0YXRlIHRyZWUgcmVzcG9uZCB0byBhY3Rpb25zLCB5b3UgbWF5IGNvbWJpbmUgc2V2ZXJhbCByZWR1Y2Vyc1xuICogaW50byBhIHNpbmdsZSByZWR1Y2VyIGZ1bmN0aW9uIGJ5IHVzaW5nIGBjb21iaW5lUmVkdWNlcnNgLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHJlZHVjZXIgQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIG5leHQgc3RhdGUgdHJlZSwgZ2l2ZW5cbiAqIHRoZSBjdXJyZW50IHN0YXRlIHRyZWUgYW5kIHRoZSBhY3Rpb24gdG8gaGFuZGxlLlxuICpcbiAqIEBwYXJhbSB7YW55fSBbcHJlbG9hZGVkU3RhdGVdIFRoZSBpbml0aWFsIHN0YXRlLiBZb3UgbWF5IG9wdGlvbmFsbHkgc3BlY2lmeSBpdFxuICogdG8gaHlkcmF0ZSB0aGUgc3RhdGUgZnJvbSB0aGUgc2VydmVyIGluIHVuaXZlcnNhbCBhcHBzLCBvciB0byByZXN0b3JlIGFcbiAqIHByZXZpb3VzbHkgc2VyaWFsaXplZCB1c2VyIHNlc3Npb24uXG4gKiBJZiB5b3UgdXNlIGBjb21iaW5lUmVkdWNlcnNgIHRvIHByb2R1Y2UgdGhlIHJvb3QgcmVkdWNlciBmdW5jdGlvbiwgdGhpcyBtdXN0IGJlXG4gKiBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZSBhcyBgY29tYmluZVJlZHVjZXJzYCBrZXlzLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGVuaGFuY2VyIFRoZSBzdG9yZSBlbmhhbmNlci4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXRcbiAqIHRvIGVuaGFuY2UgdGhlIHN0b3JlIHdpdGggdGhpcmQtcGFydHkgY2FwYWJpbGl0aWVzIHN1Y2ggYXMgbWlkZGxld2FyZSxcbiAqIHRpbWUgdHJhdmVsLCBwZXJzaXN0ZW5jZSwgZXRjLiBUaGUgb25seSBzdG9yZSBlbmhhbmNlciB0aGF0IHNoaXBzIHdpdGggUmVkdXhcbiAqIGlzIGBhcHBseU1pZGRsZXdhcmUoKWAuXG4gKlxuICogQHJldHVybnMge1N0b3JlfSBBIFJlZHV4IHN0b3JlIHRoYXQgbGV0cyB5b3UgcmVhZCB0aGUgc3RhdGUsIGRpc3BhdGNoIGFjdGlvbnNcbiAqIGFuZCBzdWJzY3JpYmUgdG8gY2hhbmdlcy5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlU3RvcmUocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKSB7XG4gIHZhciBfcmVmMjtcblxuICBpZiAodHlwZW9mIHByZWxvYWRlZFN0YXRlID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBlbmhhbmNlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBlbmhhbmNlciA9IHByZWxvYWRlZFN0YXRlO1xuICAgIHByZWxvYWRlZFN0YXRlID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZiAodHlwZW9mIGVuaGFuY2VyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSBlbmhhbmNlciB0byBiZSBhIGZ1bmN0aW9uLicpO1xuICAgIH1cblxuICAgIHJldHVybiBlbmhhbmNlcihjcmVhdGVTdG9yZSkocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiByZWR1Y2VyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgcmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpO1xuICB9XG5cbiAgdmFyIGN1cnJlbnRSZWR1Y2VyID0gcmVkdWNlcjtcbiAgdmFyIGN1cnJlbnRTdGF0ZSA9IHByZWxvYWRlZFN0YXRlO1xuICB2YXIgY3VycmVudExpc3RlbmVycyA9IFtdO1xuICB2YXIgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnM7XG4gIHZhciBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpIHtcbiAgICBpZiAobmV4dExpc3RlbmVycyA9PT0gY3VycmVudExpc3RlbmVycykge1xuICAgICAgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnMuc2xpY2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVhZHMgdGhlIHN0YXRlIHRyZWUgbWFuYWdlZCBieSB0aGUgc3RvcmUuXG4gICAqXG4gICAqIEByZXR1cm5zIHthbnl9IFRoZSBjdXJyZW50IHN0YXRlIHRyZWUgb2YgeW91ciBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGZ1bmN0aW9uIGdldFN0YXRlKCkge1xuICAgIHJldHVybiBjdXJyZW50U3RhdGU7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGNoYW5nZSBsaXN0ZW5lci4gSXQgd2lsbCBiZSBjYWxsZWQgYW55IHRpbWUgYW4gYWN0aW9uIGlzIGRpc3BhdGNoZWQsXG4gICAqIGFuZCBzb21lIHBhcnQgb2YgdGhlIHN0YXRlIHRyZWUgbWF5IHBvdGVudGlhbGx5IGhhdmUgY2hhbmdlZC4gWW91IG1heSB0aGVuXG4gICAqIGNhbGwgYGdldFN0YXRlKClgIHRvIHJlYWQgdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBpbnNpZGUgdGhlIGNhbGxiYWNrLlxuICAgKlxuICAgKiBZb3UgbWF5IGNhbGwgYGRpc3BhdGNoKClgIGZyb20gYSBjaGFuZ2UgbGlzdGVuZXIsIHdpdGggdGhlIGZvbGxvd2luZ1xuICAgKiBjYXZlYXRzOlxuICAgKlxuICAgKiAxLiBUaGUgc3Vic2NyaXB0aW9ucyBhcmUgc25hcHNob3R0ZWQganVzdCBiZWZvcmUgZXZlcnkgYGRpc3BhdGNoKClgIGNhbGwuXG4gICAqIElmIHlvdSBzdWJzY3JpYmUgb3IgdW5zdWJzY3JpYmUgd2hpbGUgdGhlIGxpc3RlbmVycyBhcmUgYmVpbmcgaW52b2tlZCwgdGhpc1xuICAgKiB3aWxsIG5vdCBoYXZlIGFueSBlZmZlY3Qgb24gdGhlIGBkaXNwYXRjaCgpYCB0aGF0IGlzIGN1cnJlbnRseSBpbiBwcm9ncmVzcy5cbiAgICogSG93ZXZlciwgdGhlIG5leHQgYGRpc3BhdGNoKClgIGNhbGwsIHdoZXRoZXIgbmVzdGVkIG9yIG5vdCwgd2lsbCB1c2UgYSBtb3JlXG4gICAqIHJlY2VudCBzbmFwc2hvdCBvZiB0aGUgc3Vic2NyaXB0aW9uIGxpc3QuXG4gICAqXG4gICAqIDIuIFRoZSBsaXN0ZW5lciBzaG91bGQgbm90IGV4cGVjdCB0byBzZWUgYWxsIHN0YXRlIGNoYW5nZXMsIGFzIHRoZSBzdGF0ZVxuICAgKiBtaWdodCBoYXZlIGJlZW4gdXBkYXRlZCBtdWx0aXBsZSB0aW1lcyBkdXJpbmcgYSBuZXN0ZWQgYGRpc3BhdGNoKClgIGJlZm9yZVxuICAgKiB0aGUgbGlzdGVuZXIgaXMgY2FsbGVkLiBJdCBpcywgaG93ZXZlciwgZ3VhcmFudGVlZCB0aGF0IGFsbCBzdWJzY3JpYmVyc1xuICAgKiByZWdpc3RlcmVkIGJlZm9yZSB0aGUgYGRpc3BhdGNoKClgIHN0YXJ0ZWQgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgbGF0ZXN0XG4gICAqIHN0YXRlIGJ5IHRoZSB0aW1lIGl0IGV4aXRzLlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBBIGNhbGxiYWNrIHRvIGJlIGludm9rZWQgb24gZXZlcnkgZGlzcGF0Y2guXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byByZW1vdmUgdGhpcyBjaGFuZ2UgbGlzdGVuZXIuXG4gICAqL1xuICBmdW5jdGlvbiBzdWJzY3JpYmUobGlzdGVuZXIpIHtcbiAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGxpc3RlbmVyIHRvIGJlIGEgZnVuY3Rpb24uJyk7XG4gICAgfVxuXG4gICAgdmFyIGlzU3Vic2NyaWJlZCA9IHRydWU7XG5cbiAgICBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCk7XG4gICAgbmV4dExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcblxuICAgIHJldHVybiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHtcbiAgICAgIGlmICghaXNTdWJzY3JpYmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG5cbiAgICAgIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKTtcbiAgICAgIHZhciBpbmRleCA9IG5leHRMaXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICBuZXh0TGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwYXRjaGVzIGFuIGFjdGlvbi4gSXQgaXMgdGhlIG9ubHkgd2F5IHRvIHRyaWdnZXIgYSBzdGF0ZSBjaGFuZ2UuXG4gICAqXG4gICAqIFRoZSBgcmVkdWNlcmAgZnVuY3Rpb24sIHVzZWQgdG8gY3JlYXRlIHRoZSBzdG9yZSwgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGVcbiAgICogY3VycmVudCBzdGF0ZSB0cmVlIGFuZCB0aGUgZ2l2ZW4gYGFjdGlvbmAuIEl0cyByZXR1cm4gdmFsdWUgd2lsbFxuICAgKiBiZSBjb25zaWRlcmVkIHRoZSAqKm5leHQqKiBzdGF0ZSBvZiB0aGUgdHJlZSwgYW5kIHRoZSBjaGFuZ2UgbGlzdGVuZXJzXG4gICAqIHdpbGwgYmUgbm90aWZpZWQuXG4gICAqXG4gICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9ubHkgc3VwcG9ydHMgcGxhaW4gb2JqZWN0IGFjdGlvbnMuIElmIHlvdSB3YW50IHRvXG4gICAqIGRpc3BhdGNoIGEgUHJvbWlzZSwgYW4gT2JzZXJ2YWJsZSwgYSB0aHVuaywgb3Igc29tZXRoaW5nIGVsc2UsIHlvdSBuZWVkIHRvXG4gICAqIHdyYXAgeW91ciBzdG9yZSBjcmVhdGluZyBmdW5jdGlvbiBpbnRvIHRoZSBjb3JyZXNwb25kaW5nIG1pZGRsZXdhcmUuIEZvclxuICAgKiBleGFtcGxlLCBzZWUgdGhlIGRvY3VtZW50YXRpb24gZm9yIHRoZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UuIEV2ZW4gdGhlXG4gICAqIG1pZGRsZXdhcmUgd2lsbCBldmVudHVhbGx5IGRpc3BhdGNoIHBsYWluIG9iamVjdCBhY3Rpb25zIHVzaW5nIHRoaXMgbWV0aG9kLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gYWN0aW9uIEEgcGxhaW4gb2JqZWN0IHJlcHJlc2VudGluZyDigJx3aGF0IGNoYW5nZWTigJ0uIEl0IGlzXG4gICAqIGEgZ29vZCBpZGVhIHRvIGtlZXAgYWN0aW9ucyBzZXJpYWxpemFibGUgc28geW91IGNhbiByZWNvcmQgYW5kIHJlcGxheSB1c2VyXG4gICAqIHNlc3Npb25zLCBvciB1c2UgdGhlIHRpbWUgdHJhdmVsbGluZyBgcmVkdXgtZGV2dG9vbHNgLiBBbiBhY3Rpb24gbXVzdCBoYXZlXG4gICAqIGEgYHR5cGVgIHByb3BlcnR5IHdoaWNoIG1heSBub3QgYmUgYHVuZGVmaW5lZGAuIEl0IGlzIGEgZ29vZCBpZGVhIHRvIHVzZVxuICAgKiBzdHJpbmcgY29uc3RhbnRzIGZvciBhY3Rpb24gdHlwZXMuXG4gICAqXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IEZvciBjb252ZW5pZW5jZSwgdGhlIHNhbWUgYWN0aW9uIG9iamVjdCB5b3UgZGlzcGF0Y2hlZC5cbiAgICpcbiAgICogTm90ZSB0aGF0LCBpZiB5b3UgdXNlIGEgY3VzdG9tIG1pZGRsZXdhcmUsIGl0IG1heSB3cmFwIGBkaXNwYXRjaCgpYCB0b1xuICAgKiByZXR1cm4gc29tZXRoaW5nIGVsc2UgKGZvciBleGFtcGxlLCBhIFByb21pc2UgeW91IGNhbiBhd2FpdCkuXG4gICAqL1xuICBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHtcbiAgICBpZiAoISgwLCBfaXNQbGFpbk9iamVjdDJbJ2RlZmF1bHQnXSkoYWN0aW9uKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG11c3QgYmUgcGxhaW4gb2JqZWN0cy4gJyArICdVc2UgY3VzdG9tIG1pZGRsZXdhcmUgZm9yIGFzeW5jIGFjdGlvbnMuJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBhY3Rpb24udHlwZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWN0aW9ucyBtYXkgbm90IGhhdmUgYW4gdW5kZWZpbmVkIFwidHlwZVwiIHByb3BlcnR5LiAnICsgJ0hhdmUgeW91IG1pc3NwZWxsZWQgYSBjb25zdGFudD8nKTtcbiAgICB9XG5cbiAgICBpZiAoaXNEaXNwYXRjaGluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWR1Y2VycyBtYXkgbm90IGRpc3BhdGNoIGFjdGlvbnMuJyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlzRGlzcGF0Y2hpbmcgPSB0cnVlO1xuICAgICAgY3VycmVudFN0YXRlID0gY3VycmVudFJlZHVjZXIoY3VycmVudFN0YXRlLCBhY3Rpb24pO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGxpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnMgPSBuZXh0TGlzdGVuZXJzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsaXN0ZW5lcnNbaV0oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcGxhY2VzIHRoZSByZWR1Y2VyIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBzdG9yZSB0byBjYWxjdWxhdGUgdGhlIHN0YXRlLlxuICAgKlxuICAgKiBZb3UgbWlnaHQgbmVlZCB0aGlzIGlmIHlvdXIgYXBwIGltcGxlbWVudHMgY29kZSBzcGxpdHRpbmcgYW5kIHlvdSB3YW50IHRvXG4gICAqIGxvYWQgc29tZSBvZiB0aGUgcmVkdWNlcnMgZHluYW1pY2FsbHkuIFlvdSBtaWdodCBhbHNvIG5lZWQgdGhpcyBpZiB5b3VcbiAgICogaW1wbGVtZW50IGEgaG90IHJlbG9hZGluZyBtZWNoYW5pc20gZm9yIFJlZHV4LlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBuZXh0UmVkdWNlciBUaGUgcmVkdWNlciBmb3IgdGhlIHN0b3JlIHRvIHVzZSBpbnN0ZWFkLlxuICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICovXG4gIGZ1bmN0aW9uIHJlcGxhY2VSZWR1Y2VyKG5leHRSZWR1Y2VyKSB7XG4gICAgaWYgKHR5cGVvZiBuZXh0UmVkdWNlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgbmV4dFJlZHVjZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTtcbiAgICB9XG5cbiAgICBjdXJyZW50UmVkdWNlciA9IG5leHRSZWR1Y2VyO1xuICAgIGRpc3BhdGNoKHsgdHlwZTogQWN0aW9uVHlwZXMuSU5JVCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRlcm9wZXJhYmlsaXR5IHBvaW50IGZvciBvYnNlcnZhYmxlL3JlYWN0aXZlIGxpYnJhcmllcy5cbiAgICogQHJldHVybnMge29ic2VydmFibGV9IEEgbWluaW1hbCBvYnNlcnZhYmxlIG9mIHN0YXRlIGNoYW5nZXMuXG4gICAqIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgdGhlIG9ic2VydmFibGUgcHJvcG9zYWw6XG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS96ZW5wYXJzaW5nL2VzLW9ic2VydmFibGVcbiAgICovXG4gIGZ1bmN0aW9uIG9ic2VydmFibGUoKSB7XG4gICAgdmFyIF9yZWY7XG5cbiAgICB2YXIgb3V0ZXJTdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG4gICAgcmV0dXJuIF9yZWYgPSB7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBtaW5pbWFsIG9ic2VydmFibGUgc3Vic2NyaXB0aW9uIG1ldGhvZC5cbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYnNlcnZlciBBbnkgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gb2JzZXJ2ZXIuXG4gICAgICAgKiBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHNob3VsZCBoYXZlIGEgYG5leHRgIG1ldGhvZC5cbiAgICAgICAqIEByZXR1cm5zIHtzdWJzY3JpcHRpb259IEFuIG9iamVjdCB3aXRoIGFuIGB1bnN1YnNjcmliZWAgbWV0aG9kIHRoYXQgY2FuXG4gICAgICAgKiBiZSB1c2VkIHRvIHVuc3Vic2NyaWJlIHRoZSBvYnNlcnZhYmxlIGZyb20gdGhlIHN0b3JlLCBhbmQgcHJldmVudCBmdXJ0aGVyXG4gICAgICAgKiBlbWlzc2lvbiBvZiB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZS5cbiAgICAgICAqL1xuICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUob2JzZXJ2ZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYnNlcnZlciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCB0aGUgb2JzZXJ2ZXIgdG8gYmUgYW4gb2JqZWN0LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb2JzZXJ2ZVN0YXRlKCkge1xuICAgICAgICAgIGlmIChvYnNlcnZlci5uZXh0KSB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGdldFN0YXRlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG9ic2VydmVTdGF0ZSgpO1xuICAgICAgICB2YXIgdW5zdWJzY3JpYmUgPSBvdXRlclN1YnNjcmliZShvYnNlcnZlU3RhdGUpO1xuICAgICAgICByZXR1cm4geyB1bnN1YnNjcmliZTogdW5zdWJzY3JpYmUgfTtcbiAgICAgIH1cbiAgICB9LCBfcmVmW19zeW1ib2xPYnNlcnZhYmxlMlsnZGVmYXVsdCddXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sIF9yZWY7XG4gIH1cblxuICAvLyBXaGVuIGEgc3RvcmUgaXMgY3JlYXRlZCwgYW4gXCJJTklUXCIgYWN0aW9uIGlzIGRpc3BhdGNoZWQgc28gdGhhdCBldmVyeVxuICAvLyByZWR1Y2VyIHJldHVybnMgdGhlaXIgaW5pdGlhbCBzdGF0ZS4gVGhpcyBlZmZlY3RpdmVseSBwb3B1bGF0ZXNcbiAgLy8gdGhlIGluaXRpYWwgc3RhdGUgdHJlZS5cbiAgZGlzcGF0Y2goeyB0eXBlOiBBY3Rpb25UeXBlcy5JTklUIH0pO1xuXG4gIHJldHVybiBfcmVmMiA9IHtcbiAgICBkaXNwYXRjaDogZGlzcGF0Y2gsXG4gICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsXG4gICAgZ2V0U3RhdGU6IGdldFN0YXRlLFxuICAgIHJlcGxhY2VSZWR1Y2VyOiByZXBsYWNlUmVkdWNlclxuICB9LCBfcmVmMltfc3ltYm9sT2JzZXJ2YWJsZTJbJ2RlZmF1bHQnXV0gPSBvYnNlcnZhYmxlLCBfcmVmMjtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcmVkdXgvbGliL2NyZWF0ZVN0b3JlLmpzXG4vLyBtb2R1bGUgaWQgPSAxMVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 12 */
/***/ function(module, exports, __webpack_require__) {

	eval("var getPrototype = __webpack_require__(13),\n    isHostObject = __webpack_require__(14),\n    isObjectLike = __webpack_require__(15);\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = Function.prototype.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object,\n *  else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) ||\n      objectToString.call(value) != objectTag || isHostObject(value)) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nmodule.exports = isPlainObject;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2xvZGFzaC9pc1BsYWluT2JqZWN0LmpzPzQzNDIiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGdldFByb3RvdHlwZSA9IHJlcXVpcmUoJy4vX2dldFByb3RvdHlwZScpLFxuICAgIGlzSG9zdE9iamVjdCA9IHJlcXVpcmUoJy4vX2lzSG9zdE9iamVjdCcpLFxuICAgIGlzT2JqZWN0TGlrZSA9IHJlcXVpcmUoJy4vaXNPYmplY3RMaWtlJyk7XG5cbi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJztcblxuLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqL1xudmFyIGZ1bmNUb1N0cmluZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZztcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqIFVzZWQgdG8gaW5mZXIgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yLiAqL1xudmFyIG9iamVjdEN0b3JTdHJpbmcgPSBmdW5jVG9TdHJpbmcuY2FsbChPYmplY3QpO1xuXG4vKipcbiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGVcbiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi82LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKVxuICogb2YgdmFsdWVzLlxuICovXG52YXIgb2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZztcblxuLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgdGhhdCBpcywgYW4gb2JqZWN0IGNyZWF0ZWQgYnkgdGhlXG4gKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAwLjguMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsXG4gKiAgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBmdW5jdGlvbiBGb28oKSB7XG4gKiAgIHRoaXMuYSA9IDE7XG4gKiB9XG4gKlxuICogXy5pc1BsYWluT2JqZWN0KG5ldyBGb28pO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmlzUGxhaW5PYmplY3QoWzEsIDIsIDNdKTtcbiAqIC8vID0+IGZhbHNlXG4gKlxuICogXy5pc1BsYWluT2JqZWN0KHsgJ3gnOiAwLCAneSc6IDAgfSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc1BsYWluT2JqZWN0KE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICogLy8gPT4gdHJ1ZVxuICovXG5mdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbHVlKSB7XG4gIGlmICghaXNPYmplY3RMaWtlKHZhbHVlKSB8fFxuICAgICAgb2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSkgIT0gb2JqZWN0VGFnIHx8IGlzSG9zdE9iamVjdCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIHByb3RvID0gZ2V0UHJvdG90eXBlKHZhbHVlKTtcbiAgaWYgKHByb3RvID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgdmFyIEN0b3IgPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKHByb3RvLCAnY29uc3RydWN0b3InKSAmJiBwcm90by5jb25zdHJ1Y3RvcjtcbiAgcmV0dXJuICh0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmXG4gICAgQ3RvciBpbnN0YW5jZW9mIEN0b3IgJiYgZnVuY1RvU3RyaW5nLmNhbGwoQ3RvcikgPT0gb2JqZWN0Q3RvclN0cmluZyk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gaXNQbGFpbk9iamVjdDtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9sb2Rhc2gvaXNQbGFpbk9iamVjdC5qc1xuLy8gbW9kdWxlIGlkID0gMTJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 13 */
/***/ function(module, exports) {

	eval("/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetPrototype = Object.getPrototypeOf;\n\n/**\n * Gets the `[[Prototype]]` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {null|Object} Returns the `[[Prototype]]`.\n */\nfunction getPrototype(value) {\n  return nativeGetPrototype(Object(value));\n}\n\nmodule.exports = getPrototype;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2xvZGFzaC9fZ2V0UHJvdG90eXBlLmpzPzEwNzUiXSwic291cmNlc0NvbnRlbnQiOlsiLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqL1xudmFyIG5hdGl2ZUdldFByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjtcblxuLyoqXG4gKiBHZXRzIHRoZSBgW1tQcm90b3R5cGVdXWAgb2YgYHZhbHVlYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7bnVsbHxPYmplY3R9IFJldHVybnMgdGhlIGBbW1Byb3RvdHlwZV1dYC5cbiAqL1xuZnVuY3Rpb24gZ2V0UHJvdG90eXBlKHZhbHVlKSB7XG4gIHJldHVybiBuYXRpdmVHZXRQcm90b3R5cGUoT2JqZWN0KHZhbHVlKSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZ2V0UHJvdG90eXBlO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2xvZGFzaC9fZ2V0UHJvdG90eXBlLmpzXG4vLyBtb2R1bGUgaWQgPSAxM1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 14 */
/***/ function(module, exports) {

	eval("/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\nmodule.exports = isHostObject;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2xvZGFzaC9faXNIb3N0T2JqZWN0LmpzP2FiMTciXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGhvc3Qgb2JqZWN0IGluIElFIDwgOS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGhvc3Qgb2JqZWN0LCBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGlzSG9zdE9iamVjdCh2YWx1ZSkge1xuICAvLyBNYW55IGhvc3Qgb2JqZWN0cyBhcmUgYE9iamVjdGAgb2JqZWN0cyB0aGF0IGNhbiBjb2VyY2UgdG8gc3RyaW5nc1xuICAvLyBkZXNwaXRlIGhhdmluZyBpbXByb3Blcmx5IGRlZmluZWQgYHRvU3RyaW5nYCBtZXRob2RzLlxuICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gIGlmICh2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZS50b1N0cmluZyAhPSAnZnVuY3Rpb24nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9ICEhKHZhbHVlICsgJycpO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBpc0hvc3RPYmplY3Q7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vbG9kYXNoL19pc0hvc3RPYmplY3QuanNcbi8vIG1vZHVsZSBpZCA9IDE0XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 15 */
/***/ function(module, exports) {

	eval("/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2xvZGFzaC9pc09iamVjdExpa2UuanM/MzZiZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYFxuICogYW5kIGhhcyBhIGB0eXBlb2ZgIHJlc3VsdCBvZiBcIm9iamVjdFwiLlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4wLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKHt9KTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7XG4gKiAvLyA9PiBmYWxzZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKG51bGwpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7XG4gIHJldHVybiAhIXZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0Jztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBpc09iamVjdExpa2U7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vbG9kYXNoL2lzT2JqZWN0TGlrZS5qc1xuLy8gbW9kdWxlIGlkID0gMTVcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 16 */
/***/ function(module, exports, __webpack_require__) {

	eval("module.exports = __webpack_require__(17);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3N5bWJvbC1vYnNlcnZhYmxlL2luZGV4LmpzPzY5ODIiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL2xpYi9pbmRleCcpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3N5bWJvbC1vYnNlcnZhYmxlL2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAxNlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 17 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(global) {'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _ponyfill = __webpack_require__(18);\n\nvar _ponyfill2 = _interopRequireDefault(_ponyfill);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar root = undefined; /* global window */\n\nif (typeof global !== 'undefined') {\n\troot = global;\n} else if (typeof window !== 'undefined') {\n\troot = window;\n}\n\nvar result = (0, _ponyfill2['default'])(root);\nexports['default'] = result;\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3N5bWJvbC1vYnNlcnZhYmxlL2xpYi9pbmRleC5qcz82MzFmIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG5cdHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF9wb255ZmlsbCA9IHJlcXVpcmUoJy4vcG9ueWZpbGwnKTtcblxudmFyIF9wb255ZmlsbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wb255ZmlsbCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH1cblxudmFyIHJvb3QgPSB1bmRlZmluZWQ7IC8qIGdsb2JhbCB3aW5kb3cgKi9cblxuaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XG5cdHJvb3QgPSBnbG9iYWw7XG59IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG5cdHJvb3QgPSB3aW5kb3c7XG59XG5cbnZhciByZXN1bHQgPSAoMCwgX3BvbnlmaWxsMlsnZGVmYXVsdCddKShyb290KTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IHJlc3VsdDtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vc3ltYm9sLW9ic2VydmFibGUvbGliL2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAxN1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 18 */
/***/ function(module, exports) {

	eval("'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports['default'] = symbolObservablePonyfill;\nfunction symbolObservablePonyfill(root) {\n\tvar result;\n\tvar _Symbol = root.Symbol;\n\n\tif (typeof _Symbol === 'function') {\n\t\tif (_Symbol.observable) {\n\t\t\tresult = _Symbol.observable;\n\t\t} else {\n\t\t\tresult = _Symbol('observable');\n\t\t\t_Symbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3N5bWJvbC1vYnNlcnZhYmxlL2xpYi9wb255ZmlsbC5qcz81MDVkIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG5cdHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IHN5bWJvbE9ic2VydmFibGVQb255ZmlsbDtcbmZ1bmN0aW9uIHN5bWJvbE9ic2VydmFibGVQb255ZmlsbChyb290KSB7XG5cdHZhciByZXN1bHQ7XG5cdHZhciBfU3ltYm9sID0gcm9vdC5TeW1ib2w7XG5cblx0aWYgKHR5cGVvZiBfU3ltYm9sID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0aWYgKF9TeW1ib2wub2JzZXJ2YWJsZSkge1xuXHRcdFx0cmVzdWx0ID0gX1N5bWJvbC5vYnNlcnZhYmxlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXN1bHQgPSBfU3ltYm9sKCdvYnNlcnZhYmxlJyk7XG5cdFx0XHRfU3ltYm9sLm9ic2VydmFibGUgPSByZXN1bHQ7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJlc3VsdCA9ICdAQG9ic2VydmFibGUnO1xuXHR9XG5cblx0cmV0dXJuIHJlc3VsdDtcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3N5bWJvbC1vYnNlcnZhYmxlL2xpYi9wb255ZmlsbC5qc1xuLy8gbW9kdWxlIGlkID0gMThcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 19 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(process) {'use strict';\n\nexports.__esModule = true;\nexports['default'] = combineReducers;\n\nvar _createStore = __webpack_require__(11);\n\nvar _isPlainObject = __webpack_require__(12);\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _warning = __webpack_require__(20);\n\nvar _warning2 = _interopRequireDefault(_warning);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nfunction getUndefinedStateErrorMessage(key, action) {\n  var actionType = action && action.type;\n  var actionName = actionType && '\"' + actionType.toString() + '\"' || 'an action';\n\n  return 'Given action ' + actionName + ', reducer \"' + key + '\" returned undefined. ' + 'To ignore an action, you must explicitly return the previous state.';\n}\n\nfunction getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {\n  var reducerKeys = Object.keys(reducers);\n  var argumentName = action && action.type === _createStore.ActionTypes.INIT ? 'preloadedState argument passed to createStore' : 'previous state received by the reducer';\n\n  if (reducerKeys.length === 0) {\n    return 'Store does not have a valid reducer. Make sure the argument passed ' + 'to combineReducers is an object whose values are reducers.';\n  }\n\n  if (!(0, _isPlainObject2['default'])(inputState)) {\n    return 'The ' + argumentName + ' has unexpected type of \"' + {}.toString.call(inputState).match(/\\s([a-z|A-Z]+)/)[1] + '\". Expected argument to be an object with the following ' + ('keys: \"' + reducerKeys.join('\", \"') + '\"');\n  }\n\n  var unexpectedKeys = Object.keys(inputState).filter(function (key) {\n    return !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key];\n  });\n\n  unexpectedKeys.forEach(function (key) {\n    unexpectedKeyCache[key] = true;\n  });\n\n  if (unexpectedKeys.length > 0) {\n    return 'Unexpected ' + (unexpectedKeys.length > 1 ? 'keys' : 'key') + ' ' + ('\"' + unexpectedKeys.join('\", \"') + '\" found in ' + argumentName + '. ') + 'Expected to find one of the known reducer keys instead: ' + ('\"' + reducerKeys.join('\", \"') + '\". Unexpected keys will be ignored.');\n  }\n}\n\nfunction assertReducerSanity(reducers) {\n  Object.keys(reducers).forEach(function (key) {\n    var reducer = reducers[key];\n    var initialState = reducer(undefined, { type: _createStore.ActionTypes.INIT });\n\n    if (typeof initialState === 'undefined') {\n      throw new Error('Reducer \"' + key + '\" returned undefined during initialization. ' + 'If the state passed to the reducer is undefined, you must ' + 'explicitly return the initial state. The initial state may ' + 'not be undefined.');\n    }\n\n    var type = '@@redux/PROBE_UNKNOWN_ACTION_' + Math.random().toString(36).substring(7).split('').join('.');\n    if (typeof reducer(undefined, { type: type }) === 'undefined') {\n      throw new Error('Reducer \"' + key + '\" returned undefined when probed with a random type. ' + ('Don\\'t try to handle ' + _createStore.ActionTypes.INIT + ' or other actions in \"redux/*\" ') + 'namespace. They are considered private. Instead, you must return the ' + 'current state for any unknown actions, unless it is undefined, ' + 'in which case you must return the initial state, regardless of the ' + 'action type. The initial state may not be undefined.');\n    }\n  });\n}\n\n/**\n * Turns an object whose values are different reducer functions, into a single\n * reducer function. It will call every child reducer, and gather their results\n * into a single state object, whose keys correspond to the keys of the passed\n * reducer functions.\n *\n * @param {Object} reducers An object whose values correspond to different\n * reducer functions that need to be combined into one. One handy way to obtain\n * it is to use ES6 `import * as reducers` syntax. The reducers may never return\n * undefined for any action. Instead, they should return their initial state\n * if the state passed to them was undefined, and the current state for any\n * unrecognized action.\n *\n * @returns {Function} A reducer function that invokes every reducer inside the\n * passed object, and builds a state object with the same shape.\n */\nfunction combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers);\n  var finalReducers = {};\n  for (var i = 0; i < reducerKeys.length; i++) {\n    var key = reducerKeys[i];\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        (0, _warning2['default'])('No reducer provided for key \"' + key + '\"');\n      }\n    }\n\n    if (typeof reducers[key] === 'function') {\n      finalReducers[key] = reducers[key];\n    }\n  }\n  var finalReducerKeys = Object.keys(finalReducers);\n\n  if (process.env.NODE_ENV !== 'production') {\n    var unexpectedKeyCache = {};\n  }\n\n  var sanityError;\n  try {\n    assertReducerSanity(finalReducers);\n  } catch (e) {\n    sanityError = e;\n  }\n\n  return function combination() {\n    var state = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n    var action = arguments[1];\n\n    if (sanityError) {\n      throw sanityError;\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      var warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache);\n      if (warningMessage) {\n        (0, _warning2['default'])(warningMessage);\n      }\n    }\n\n    var hasChanged = false;\n    var nextState = {};\n    for (var i = 0; i < finalReducerKeys.length; i++) {\n      var key = finalReducerKeys[i];\n      var reducer = finalReducers[key];\n      var previousStateForKey = state[key];\n      var nextStateForKey = reducer(previousStateForKey, action);\n      if (typeof nextStateForKey === 'undefined') {\n        var errorMessage = getUndefinedStateErrorMessage(key, action);\n        throw new Error(errorMessage);\n      }\n      nextState[key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n    return hasChanged ? nextState : state;\n  };\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(3)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9jb21iaW5lUmVkdWNlcnMuanM/MTA4NiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzWydkZWZhdWx0J10gPSBjb21iaW5lUmVkdWNlcnM7XG5cbnZhciBfY3JlYXRlU3RvcmUgPSByZXF1aXJlKCcuL2NyZWF0ZVN0b3JlJyk7XG5cbnZhciBfaXNQbGFpbk9iamVjdCA9IHJlcXVpcmUoJ2xvZGFzaC9pc1BsYWluT2JqZWN0Jyk7XG5cbnZhciBfaXNQbGFpbk9iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pc1BsYWluT2JqZWN0KTtcblxudmFyIF93YXJuaW5nID0gcmVxdWlyZSgnLi91dGlscy93YXJuaW5nJyk7XG5cbnZhciBfd2FybmluZzIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93YXJuaW5nKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG5mdW5jdGlvbiBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShrZXksIGFjdGlvbikge1xuICB2YXIgYWN0aW9uVHlwZSA9IGFjdGlvbiAmJiBhY3Rpb24udHlwZTtcbiAgdmFyIGFjdGlvbk5hbWUgPSBhY3Rpb25UeXBlICYmICdcIicgKyBhY3Rpb25UeXBlLnRvU3RyaW5nKCkgKyAnXCInIHx8ICdhbiBhY3Rpb24nO1xuXG4gIHJldHVybiAnR2l2ZW4gYWN0aW9uICcgKyBhY3Rpb25OYW1lICsgJywgcmVkdWNlciBcIicgKyBrZXkgKyAnXCIgcmV0dXJuZWQgdW5kZWZpbmVkLiAnICsgJ1RvIGlnbm9yZSBhbiBhY3Rpb24sIHlvdSBtdXN0IGV4cGxpY2l0bHkgcmV0dXJuIHRoZSBwcmV2aW91cyBzdGF0ZS4nO1xufVxuXG5mdW5jdGlvbiBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKGlucHV0U3RhdGUsIHJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSkge1xuICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7XG4gIHZhciBhcmd1bWVudE5hbWUgPSBhY3Rpb24gJiYgYWN0aW9uLnR5cGUgPT09IF9jcmVhdGVTdG9yZS5BY3Rpb25UeXBlcy5JTklUID8gJ3ByZWxvYWRlZFN0YXRlIGFyZ3VtZW50IHBhc3NlZCB0byBjcmVhdGVTdG9yZScgOiAncHJldmlvdXMgc3RhdGUgcmVjZWl2ZWQgYnkgdGhlIHJlZHVjZXInO1xuXG4gIGlmIChyZWR1Y2VyS2V5cy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJ1N0b3JlIGRvZXMgbm90IGhhdmUgYSB2YWxpZCByZWR1Y2VyLiBNYWtlIHN1cmUgdGhlIGFyZ3VtZW50IHBhc3NlZCAnICsgJ3RvIGNvbWJpbmVSZWR1Y2VycyBpcyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSByZWR1Y2Vycy4nO1xuICB9XG5cbiAgaWYgKCEoMCwgX2lzUGxhaW5PYmplY3QyWydkZWZhdWx0J10pKGlucHV0U3RhdGUpKSB7XG4gICAgcmV0dXJuICdUaGUgJyArIGFyZ3VtZW50TmFtZSArICcgaGFzIHVuZXhwZWN0ZWQgdHlwZSBvZiBcIicgKyB7fS50b1N0cmluZy5jYWxsKGlucHV0U3RhdGUpLm1hdGNoKC9cXHMoW2EtenxBLVpdKykvKVsxXSArICdcIi4gRXhwZWN0ZWQgYXJndW1lbnQgdG8gYmUgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyAnICsgKCdrZXlzOiBcIicgKyByZWR1Y2VyS2V5cy5qb2luKCdcIiwgXCInKSArICdcIicpO1xuICB9XG5cbiAgdmFyIHVuZXhwZWN0ZWRLZXlzID0gT2JqZWN0LmtleXMoaW5wdXRTdGF0ZSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gIXJlZHVjZXJzLmhhc093blByb3BlcnR5KGtleSkgJiYgIXVuZXhwZWN0ZWRLZXlDYWNoZVtrZXldO1xuICB9KTtcblxuICB1bmV4cGVjdGVkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICB1bmV4cGVjdGVkS2V5Q2FjaGVba2V5XSA9IHRydWU7XG4gIH0pO1xuXG4gIGlmICh1bmV4cGVjdGVkS2V5cy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuICdVbmV4cGVjdGVkICcgKyAodW5leHBlY3RlZEtleXMubGVuZ3RoID4gMSA/ICdrZXlzJyA6ICdrZXknKSArICcgJyArICgnXCInICsgdW5leHBlY3RlZEtleXMuam9pbignXCIsIFwiJykgKyAnXCIgZm91bmQgaW4gJyArIGFyZ3VtZW50TmFtZSArICcuICcpICsgJ0V4cGVjdGVkIHRvIGZpbmQgb25lIG9mIHRoZSBrbm93biByZWR1Y2VyIGtleXMgaW5zdGVhZDogJyArICgnXCInICsgcmVkdWNlcktleXMuam9pbignXCIsIFwiJykgKyAnXCIuIFVuZXhwZWN0ZWQga2V5cyB3aWxsIGJlIGlnbm9yZWQuJyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzZXJ0UmVkdWNlclNhbml0eShyZWR1Y2Vycykge1xuICBPYmplY3Qua2V5cyhyZWR1Y2VycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgdmFyIHJlZHVjZXIgPSByZWR1Y2Vyc1trZXldO1xuICAgIHZhciBpbml0aWFsU3RhdGUgPSByZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiBfY3JlYXRlU3RvcmUuQWN0aW9uVHlwZXMuSU5JVCB9KTtcblxuICAgIGlmICh0eXBlb2YgaW5pdGlhbFN0YXRlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWR1Y2VyIFwiJyArIGtleSArICdcIiByZXR1cm5lZCB1bmRlZmluZWQgZHVyaW5nIGluaXRpYWxpemF0aW9uLiAnICsgJ0lmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlIHJlZHVjZXIgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCAnICsgJ2V4cGxpY2l0bHkgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLiBUaGUgaW5pdGlhbCBzdGF0ZSBtYXkgJyArICdub3QgYmUgdW5kZWZpbmVkLicpO1xuICAgIH1cblxuICAgIHZhciB0eXBlID0gJ0BAcmVkdXgvUFJPQkVfVU5LTk9XTl9BQ1RJT05fJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg3KS5zcGxpdCgnJykuam9pbignLicpO1xuICAgIGlmICh0eXBlb2YgcmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogdHlwZSB9KSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlciBcIicgKyBrZXkgKyAnXCIgcmV0dXJuZWQgdW5kZWZpbmVkIHdoZW4gcHJvYmVkIHdpdGggYSByYW5kb20gdHlwZS4gJyArICgnRG9uXFwndCB0cnkgdG8gaGFuZGxlICcgKyBfY3JlYXRlU3RvcmUuQWN0aW9uVHlwZXMuSU5JVCArICcgb3Igb3RoZXIgYWN0aW9ucyBpbiBcInJlZHV4LypcIiAnKSArICduYW1lc3BhY2UuIFRoZXkgYXJlIGNvbnNpZGVyZWQgcHJpdmF0ZS4gSW5zdGVhZCwgeW91IG11c3QgcmV0dXJuIHRoZSAnICsgJ2N1cnJlbnQgc3RhdGUgZm9yIGFueSB1bmtub3duIGFjdGlvbnMsIHVubGVzcyBpdCBpcyB1bmRlZmluZWQsICcgKyAnaW4gd2hpY2ggY2FzZSB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUsIHJlZ2FyZGxlc3Mgb2YgdGhlICcgKyAnYWN0aW9uIHR5cGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSBub3QgYmUgdW5kZWZpbmVkLicpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgZGlmZmVyZW50IHJlZHVjZXIgZnVuY3Rpb25zLCBpbnRvIGEgc2luZ2xlXG4gKiByZWR1Y2VyIGZ1bmN0aW9uLiBJdCB3aWxsIGNhbGwgZXZlcnkgY2hpbGQgcmVkdWNlciwgYW5kIGdhdGhlciB0aGVpciByZXN1bHRzXG4gKiBpbnRvIGEgc2luZ2xlIHN0YXRlIG9iamVjdCwgd2hvc2Uga2V5cyBjb3JyZXNwb25kIHRvIHRoZSBrZXlzIG9mIHRoZSBwYXNzZWRcbiAqIHJlZHVjZXIgZnVuY3Rpb25zLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSByZWR1Y2VycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGNvcnJlc3BvbmQgdG8gZGlmZmVyZW50XG4gKiByZWR1Y2VyIGZ1bmN0aW9ucyB0aGF0IG5lZWQgdG8gYmUgY29tYmluZWQgaW50byBvbmUuIE9uZSBoYW5keSB3YXkgdG8gb2J0YWluXG4gKiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhcyByZWR1Y2Vyc2Agc3ludGF4LiBUaGUgcmVkdWNlcnMgbWF5IG5ldmVyIHJldHVyblxuICogdW5kZWZpbmVkIGZvciBhbnkgYWN0aW9uLiBJbnN0ZWFkLCB0aGV5IHNob3VsZCByZXR1cm4gdGhlaXIgaW5pdGlhbCBzdGF0ZVxuICogaWYgdGhlIHN0YXRlIHBhc3NlZCB0byB0aGVtIHdhcyB1bmRlZmluZWQsIGFuZCB0aGUgY3VycmVudCBzdGF0ZSBmb3IgYW55XG4gKiB1bnJlY29nbml6ZWQgYWN0aW9uLlxuICpcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSByZWR1Y2VyIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBldmVyeSByZWR1Y2VyIGluc2lkZSB0aGVcbiAqIHBhc3NlZCBvYmplY3QsIGFuZCBidWlsZHMgYSBzdGF0ZSBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZS5cbiAqL1xuZnVuY3Rpb24gY29tYmluZVJlZHVjZXJzKHJlZHVjZXJzKSB7XG4gIHZhciByZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKHJlZHVjZXJzKTtcbiAgdmFyIGZpbmFsUmVkdWNlcnMgPSB7fTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWR1Y2VyS2V5cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBrZXkgPSByZWR1Y2VyS2V5c1tpXTtcblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICgwLCBfd2FybmluZzJbJ2RlZmF1bHQnXSkoJ05vIHJlZHVjZXIgcHJvdmlkZWQgZm9yIGtleSBcIicgKyBrZXkgKyAnXCInKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGZpbmFsUmVkdWNlcnNba2V5XSA9IHJlZHVjZXJzW2tleV07XG4gICAgfVxuICB9XG4gIHZhciBmaW5hbFJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMoZmluYWxSZWR1Y2Vycyk7XG5cbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICB2YXIgdW5leHBlY3RlZEtleUNhY2hlID0ge307XG4gIH1cblxuICB2YXIgc2FuaXR5RXJyb3I7XG4gIHRyeSB7XG4gICAgYXNzZXJ0UmVkdWNlclNhbml0eShmaW5hbFJlZHVjZXJzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHNhbml0eUVycm9yID0gZTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiBjb21iaW5hdGlvbigpIHtcbiAgICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgfHwgYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1swXTtcbiAgICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdO1xuXG4gICAgaWYgKHNhbml0eUVycm9yKSB7XG4gICAgICB0aHJvdyBzYW5pdHlFcnJvcjtcbiAgICB9XG5cbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgdmFyIHdhcm5pbmdNZXNzYWdlID0gZ2V0VW5leHBlY3RlZFN0YXRlU2hhcGVXYXJuaW5nTWVzc2FnZShzdGF0ZSwgZmluYWxSZWR1Y2VycywgYWN0aW9uLCB1bmV4cGVjdGVkS2V5Q2FjaGUpO1xuICAgICAgaWYgKHdhcm5pbmdNZXNzYWdlKSB7XG4gICAgICAgICgwLCBfd2FybmluZzJbJ2RlZmF1bHQnXSkod2FybmluZ01lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgdmFyIG5leHRTdGF0ZSA9IHt9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmluYWxSZWR1Y2VyS2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGtleSA9IGZpbmFsUmVkdWNlcktleXNbaV07XG4gICAgICB2YXIgcmVkdWNlciA9IGZpbmFsUmVkdWNlcnNba2V5XTtcbiAgICAgIHZhciBwcmV2aW91c1N0YXRlRm9yS2V5ID0gc3RhdGVba2V5XTtcbiAgICAgIHZhciBuZXh0U3RhdGVGb3JLZXkgPSByZWR1Y2VyKHByZXZpb3VzU3RhdGVGb3JLZXksIGFjdGlvbik7XG4gICAgICBpZiAodHlwZW9mIG5leHRTdGF0ZUZvcktleSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IGdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlKGtleSwgYWN0aW9uKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICB9XG4gICAgICBuZXh0U3RhdGVba2V5XSA9IG5leHRTdGF0ZUZvcktleTtcbiAgICAgIGhhc0NoYW5nZWQgPSBoYXNDaGFuZ2VkIHx8IG5leHRTdGF0ZUZvcktleSAhPT0gcHJldmlvdXNTdGF0ZUZvcktleTtcbiAgICB9XG4gICAgcmV0dXJuIGhhc0NoYW5nZWQgPyBuZXh0U3RhdGUgOiBzdGF0ZTtcbiAgfTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcmVkdXgvbGliL2NvbWJpbmVSZWR1Y2Vycy5qc1xuLy8gbW9kdWxlIGlkID0gMTlcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 20 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nexports.__esModule = true;\nexports['default'] = warning;\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n    /* eslint-disable no-empty */\n  } catch (e) {}\n  /* eslint-enable no-empty */\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi91dGlscy93YXJuaW5nLmpzPzA3YzMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0c1snZGVmYXVsdCddID0gd2FybmluZztcbi8qKlxuICogUHJpbnRzIGEgd2FybmluZyBpbiB0aGUgY29uc29sZSBpZiBpdCBleGlzdHMuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGhlIHdhcm5pbmcgbWVzc2FnZS5cbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UpIHtcbiAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqL1xuICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjb25zb2xlLmVycm9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTtcbiAgfVxuICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbnNvbGUgKi9cbiAgdHJ5IHtcbiAgICAvLyBUaGlzIGVycm9yIHdhcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB0aGF0IGlmIHlvdSBlbmFibGVcbiAgICAvLyBcImJyZWFrIG9uIGFsbCBleGNlcHRpb25zXCIgaW4geW91ciBjb25zb2xlLFxuICAgIC8vIGl0IHdvdWxkIHBhdXNlIHRoZSBleGVjdXRpb24gYXQgdGhpcyBsaW5lLlxuICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1lbXB0eSAqL1xuICB9IGNhdGNoIChlKSB7fVxuICAvKiBlc2xpbnQtZW5hYmxlIG5vLWVtcHR5ICovXG59XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L3JlZHV4L2xpYi91dGlscy93YXJuaW5nLmpzXG4vLyBtb2R1bGUgaWQgPSAyMFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 21 */
/***/ function(module, exports) {

	eval("'use strict';\n\nexports.__esModule = true;\nexports['default'] = bindActionCreators;\nfunction bindActionCreator(actionCreator, dispatch) {\n  return function () {\n    return dispatch(actionCreator.apply(undefined, arguments));\n  };\n}\n\n/**\n * Turns an object whose values are action creators, into an object with the\n * same keys, but with every function wrapped into a `dispatch` call so they\n * may be invoked directly. This is just a convenience method, as you can call\n * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.\n *\n * For convenience, you can also pass a single function as the first argument,\n * and get a function in return.\n *\n * @param {Function|Object} actionCreators An object whose values are action\n * creator functions. One handy way to obtain it is to use ES6 `import * as`\n * syntax. You may also pass a single function.\n *\n * @param {Function} dispatch The `dispatch` function available on your Redux\n * store.\n *\n * @returns {Function|Object} The object mimicking the original object, but with\n * every action creator wrapped into the `dispatch` call. If you passed a\n * function as `actionCreators`, the return value will also be a single\n * function.\n */\nfunction bindActionCreators(actionCreators, dispatch) {\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch);\n  }\n\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error('bindActionCreators expected an object or a function, instead received ' + (actionCreators === null ? 'null' : typeof actionCreators) + '. ' + 'Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?');\n  }\n\n  var keys = Object.keys(actionCreators);\n  var boundActionCreators = {};\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var actionCreator = actionCreators[key];\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\n    }\n  }\n  return boundActionCreators;\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9iaW5kQWN0aW9uQ3JlYXRvcnMuanM/OTFkOSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzWydkZWZhdWx0J10gPSBiaW5kQWN0aW9uQ3JlYXRvcnM7XG5mdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9yLCBkaXNwYXRjaCkge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkaXNwYXRjaChhY3Rpb25DcmVhdG9yLmFwcGx5KHVuZGVmaW5lZCwgYXJndW1lbnRzKSk7XG4gIH07XG59XG5cbi8qKlxuICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uIGNyZWF0b3JzLCBpbnRvIGFuIG9iamVjdCB3aXRoIHRoZVxuICogc2FtZSBrZXlzLCBidXQgd2l0aCBldmVyeSBmdW5jdGlvbiB3cmFwcGVkIGludG8gYSBgZGlzcGF0Y2hgIGNhbGwgc28gdGhleVxuICogbWF5IGJlIGludm9rZWQgZGlyZWN0bHkuIFRoaXMgaXMganVzdCBhIGNvbnZlbmllbmNlIG1ldGhvZCwgYXMgeW91IGNhbiBjYWxsXG4gKiBgc3RvcmUuZGlzcGF0Y2goTXlBY3Rpb25DcmVhdG9ycy5kb1NvbWV0aGluZygpKWAgeW91cnNlbGYganVzdCBmaW5lLlxuICpcbiAqIEZvciBjb252ZW5pZW5jZSwgeW91IGNhbiBhbHNvIHBhc3MgYSBzaW5nbGUgZnVuY3Rpb24gYXMgdGhlIGZpcnN0IGFyZ3VtZW50LFxuICogYW5kIGdldCBhIGZ1bmN0aW9uIGluIHJldHVybi5cbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gYWN0aW9uQ3JlYXRvcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uXG4gKiBjcmVhdG9yIGZ1bmN0aW9ucy4gT25lIGhhbmR5IHdheSB0byBvYnRhaW4gaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXNgXG4gKiBzeW50YXguIFlvdSBtYXkgYWxzbyBwYXNzIGEgc2luZ2xlIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGRpc3BhdGNoIFRoZSBgZGlzcGF0Y2hgIGZ1bmN0aW9uIGF2YWlsYWJsZSBvbiB5b3VyIFJlZHV4XG4gKiBzdG9yZS5cbiAqXG4gKiBAcmV0dXJucyB7RnVuY3Rpb258T2JqZWN0fSBUaGUgb2JqZWN0IG1pbWlja2luZyB0aGUgb3JpZ2luYWwgb2JqZWN0LCBidXQgd2l0aFxuICogZXZlcnkgYWN0aW9uIGNyZWF0b3Igd3JhcHBlZCBpbnRvIHRoZSBgZGlzcGF0Y2hgIGNhbGwuIElmIHlvdSBwYXNzZWQgYVxuICogZnVuY3Rpb24gYXMgYGFjdGlvbkNyZWF0b3JzYCwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGFsc28gYmUgYSBzaW5nbGVcbiAqIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcnMoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKSB7XG4gIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvcnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvcnMgIT09ICdvYmplY3QnIHx8IGFjdGlvbkNyZWF0b3JzID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdiaW5kQWN0aW9uQ3JlYXRvcnMgZXhwZWN0ZWQgYW4gb2JqZWN0IG9yIGEgZnVuY3Rpb24sIGluc3RlYWQgcmVjZWl2ZWQgJyArIChhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBhY3Rpb25DcmVhdG9ycykgKyAnLiAnICsgJ0RpZCB5b3Ugd3JpdGUgXCJpbXBvcnQgQWN0aW9uQ3JlYXRvcnMgZnJvbVwiIGluc3RlYWQgb2YgXCJpbXBvcnQgKiBhcyBBY3Rpb25DcmVhdG9ycyBmcm9tXCI/Jyk7XG4gIH1cblxuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGFjdGlvbkNyZWF0b3JzKTtcbiAgdmFyIGJvdW5kQWN0aW9uQ3JlYXRvcnMgPSB7fTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgdmFyIGFjdGlvbkNyZWF0b3IgPSBhY3Rpb25DcmVhdG9yc1trZXldO1xuICAgIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9yc1trZXldID0gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYm91bmRBY3Rpb25DcmVhdG9ycztcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vcmVkdXgvbGliL2JpbmRBY3Rpb25DcmVhdG9ycy5qc1xuLy8gbW9kdWxlIGlkID0gMjFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 22 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports['default'] = applyMiddleware;\n\nvar _compose = __webpack_require__(23);\n\nvar _compose2 = _interopRequireDefault(_compose);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\nfunction applyMiddleware() {\n  for (var _len = arguments.length, middlewares = Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function (reducer, preloadedState, enhancer) {\n      var store = createStore(reducer, preloadedState, enhancer);\n      var _dispatch = store.dispatch;\n      var chain = [];\n\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch(action) {\n          return _dispatch(action);\n        }\n      };\n      chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = _compose2['default'].apply(undefined, chain)(store.dispatch);\n\n      return _extends({}, store, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9hcHBseU1pZGRsZXdhcmUuanM/ZWUxNSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cbmV4cG9ydHNbJ2RlZmF1bHQnXSA9IGFwcGx5TWlkZGxld2FyZTtcblxudmFyIF9jb21wb3NlID0gcmVxdWlyZSgnLi9jb21wb3NlJyk7XG5cbnZhciBfY29tcG9zZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb21wb3NlKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzdG9yZSBlbmhhbmNlciB0aGF0IGFwcGxpZXMgbWlkZGxld2FyZSB0byB0aGUgZGlzcGF0Y2ggbWV0aG9kXG4gKiBvZiB0aGUgUmVkdXggc3RvcmUuIFRoaXMgaXMgaGFuZHkgZm9yIGEgdmFyaWV0eSBvZiB0YXNrcywgc3VjaCBhcyBleHByZXNzaW5nXG4gKiBhc3luY2hyb25vdXMgYWN0aW9ucyBpbiBhIGNvbmNpc2UgbWFubmVyLCBvciBsb2dnaW5nIGV2ZXJ5IGFjdGlvbiBwYXlsb2FkLlxuICpcbiAqIFNlZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UgYXMgYW4gZXhhbXBsZSBvZiB0aGUgUmVkdXggbWlkZGxld2FyZS5cbiAqXG4gKiBCZWNhdXNlIG1pZGRsZXdhcmUgaXMgcG90ZW50aWFsbHkgYXN5bmNocm9ub3VzLCB0aGlzIHNob3VsZCBiZSB0aGUgZmlyc3RcbiAqIHN0b3JlIGVuaGFuY2VyIGluIHRoZSBjb21wb3NpdGlvbiBjaGFpbi5cbiAqXG4gKiBOb3RlIHRoYXQgZWFjaCBtaWRkbGV3YXJlIHdpbGwgYmUgZ2l2ZW4gdGhlIGBkaXNwYXRjaGAgYW5kIGBnZXRTdGF0ZWAgZnVuY3Rpb25zXG4gKiBhcyBuYW1lZCBhcmd1bWVudHMuXG4gKlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gbWlkZGxld2FyZXMgVGhlIG1pZGRsZXdhcmUgY2hhaW4gdG8gYmUgYXBwbGllZC5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBzdG9yZSBlbmhhbmNlciBhcHBseWluZyB0aGUgbWlkZGxld2FyZS5cbiAqL1xuZnVuY3Rpb24gYXBwbHlNaWRkbGV3YXJlKCkge1xuICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgbWlkZGxld2FyZXMgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBtaWRkbGV3YXJlc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoY3JlYXRlU3RvcmUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcikge1xuICAgICAgdmFyIHN0b3JlID0gY3JlYXRlU3RvcmUocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKTtcbiAgICAgIHZhciBfZGlzcGF0Y2ggPSBzdG9yZS5kaXNwYXRjaDtcbiAgICAgIHZhciBjaGFpbiA9IFtdO1xuXG4gICAgICB2YXIgbWlkZGxld2FyZUFQSSA9IHtcbiAgICAgICAgZ2V0U3RhdGU6IHN0b3JlLmdldFN0YXRlLFxuICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIF9kaXNwYXRjaChhY3Rpb24pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAoZnVuY3Rpb24gKG1pZGRsZXdhcmUpIHtcbiAgICAgICAgcmV0dXJuIG1pZGRsZXdhcmUobWlkZGxld2FyZUFQSSk7XG4gICAgICB9KTtcbiAgICAgIF9kaXNwYXRjaCA9IF9jb21wb3NlMlsnZGVmYXVsdCddLmFwcGx5KHVuZGVmaW5lZCwgY2hhaW4pKHN0b3JlLmRpc3BhdGNoKTtcblxuICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBzdG9yZSwge1xuICAgICAgICBkaXNwYXRjaDogX2Rpc3BhdGNoXG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9yZWR1eC9saWIvYXBwbHlNaWRkbGV3YXJlLmpzXG4vLyBtb2R1bGUgaWQgPSAyMlxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 23 */
/***/ function(module, exports) {

	eval("\"use strict\";\n\nexports.__esModule = true;\nexports[\"default\"] = compose;\n/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\n\nfunction compose() {\n  for (var _len = arguments.length, funcs = Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  var last = funcs[funcs.length - 1];\n  var rest = funcs.slice(0, -1);\n  return function () {\n    return rest.reduceRight(function (composed, f) {\n      return f(composed);\n    }, last.apply(undefined, arguments));\n  };\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L3JlZHV4L2xpYi9jb21wb3NlLmpzP2E4YzciXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IGNvbXBvc2U7XG4vKipcbiAqIENvbXBvc2VzIHNpbmdsZS1hcmd1bWVudCBmdW5jdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0LiBUaGUgcmlnaHRtb3N0XG4gKiBmdW5jdGlvbiBjYW4gdGFrZSBtdWx0aXBsZSBhcmd1bWVudHMgYXMgaXQgcHJvdmlkZXMgdGhlIHNpZ25hdHVyZSBmb3JcbiAqIHRoZSByZXN1bHRpbmcgY29tcG9zaXRlIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB7Li4uRnVuY3Rpb259IGZ1bmNzIFRoZSBmdW5jdGlvbnMgdG8gY29tcG9zZS5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiBvYnRhaW5lZCBieSBjb21wb3NpbmcgdGhlIGFyZ3VtZW50IGZ1bmN0aW9uc1xuICogZnJvbSByaWdodCB0byBsZWZ0LiBGb3IgZXhhbXBsZSwgY29tcG9zZShmLCBnLCBoKSBpcyBpZGVudGljYWwgdG8gZG9pbmdcbiAqICguLi5hcmdzKSA9PiBmKGcoaCguLi5hcmdzKSkpLlxuICovXG5cbmZ1bmN0aW9uIGNvbXBvc2UoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBmdW5jcyA9IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgIGZ1bmNzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICB9XG5cbiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoYXJnKSB7XG4gICAgICByZXR1cm4gYXJnO1xuICAgIH07XG4gIH1cblxuICBpZiAoZnVuY3MubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGZ1bmNzWzBdO1xuICB9XG5cbiAgdmFyIGxhc3QgPSBmdW5jc1tmdW5jcy5sZW5ndGggLSAxXTtcbiAgdmFyIHJlc3QgPSBmdW5jcy5zbGljZSgwLCAtMSk7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHJlc3QucmVkdWNlUmlnaHQoZnVuY3Rpb24gKGNvbXBvc2VkLCBmKSB7XG4gICAgICByZXR1cm4gZihjb21wb3NlZCk7XG4gICAgfSwgbGFzdC5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cykpO1xuICB9O1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9yZWR1eC9saWIvY29tcG9zZS5qc1xuLy8gbW9kdWxlIGlkID0gMjNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 24 */
/***/ function(module, exports, __webpack_require__) {

	eval("\"use strict\";\n\nvar store = __webpack_require__(9);\n\nvar userState = {\n\n    type: {\n\n        get: function get() {\n            // TODO this is only set on login, if user doesn't login because they have an active session already then it isn't set. We probably need this information from the server (it was stored in localStorage before, which doesn't seem ideal)\n            return store.getState().user.type;\n        },\n\n        set: function set(userType) {\n            store.dispatch({\n                type: \"UPDATE_USER_TYPE\",\n                userType: userType\n            });\n        },\n\n        isDataVis: function isDataVis() {\n            return userState.type.get() === \"DATA_VISUALISATION\";\n        },\n\n        isPublisher: function isPublisher() {\n            return userState.type.get() === \"PUBLISHING_SUPPORT\";\n        }\n    },\n\n    email: {\n\n        get: function get() {\n            return store.getState().user.email;\n        },\n\n        set: function set(userEmail) {\n            store.dispatch({\n                type: \"UPDATE_USER_EMAIL\",\n                userEmail: userEmail\n            });\n        }\n    }\n};\n\nmodule.exports = userState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9zdGF0ZS91c2VyU3RhdGUuanM/MWQzNSJdLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBzdG9yZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9zdGF0ZS5qcycpO1xuXG52YXIgdXNlclN0YXRlID0ge1xuXG4gICAgdHlwZToge1xuXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBUT0RPIHRoaXMgaXMgb25seSBzZXQgb24gbG9naW4sIGlmIHVzZXIgZG9lc24ndCBsb2dpbiBiZWNhdXNlIHRoZXkgaGF2ZSBhbiBhY3RpdmUgc2Vzc2lvbiBhbHJlYWR5IHRoZW4gaXQgaXNuJ3Qgc2V0LiBXZSBwcm9iYWJseSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2VydmVyIChpdCB3YXMgc3RvcmVkIGluIGxvY2FsU3RvcmFnZSBiZWZvcmUsIHdoaWNoIGRvZXNuJ3Qgc2VlbSBpZGVhbClcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLnVzZXIudHlwZTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHVzZXJUeXBlKSB7XG4gICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfVVNFUl9UWVBFXCIsXG4gICAgICAgICAgICAgICAgdXNlclR5cGU6IHVzZXJUeXBlXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzRGF0YVZpczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdXNlclN0YXRlLnR5cGUuZ2V0KCkgPT09IFwiREFUQV9WSVNVQUxJU0FUSU9OXCI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNQdWJsaXNoZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHVzZXJTdGF0ZS50eXBlLmdldCgpID09PSBcIlBVQkxJU0hJTkdfU1VQUE9SVFwiO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGVtYWlsOiB7XG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLnVzZXIuZW1haWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbih1c2VyRW1haWwpIHtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9VU0VSX0VNQUlMXCIsXG4gICAgICAgICAgICAgICAgdXNlckVtYWlsOiB1c2VyRW1haWxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHVzZXJTdGF0ZTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2hhcmVkL3N0YXRlL3VzZXJTdGF0ZS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBCQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQVhBO0FBekJBO0FBQ0E7QUF1Q0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 25 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar store = __webpack_require__(9),\n    watchState = __webpack_require__(26);\n\nvar workspaceState = {\n\n    reset: function reset() {\n        store.dispatch({\n            type: \"RESET_WORKSPACE\"\n        });\n    },\n\n    browseTreeData: {\n\n        get: function get() {\n            return store.getState().workspace.browseTreeData;\n        },\n\n        set: function set(browseTreeData) {\n            store.dispatch({\n                type: \"UPDATE_BROWSE_TREE_DATA\",\n                browseTreeData: browseTreeData\n            });\n        }\n\n    },\n\n    activeScreen: {\n\n        get: function get() {\n            return store.getState().workspace.activeScreen;\n        },\n\n        set: function set(activeScreen) {\n            store.dispatch({\n                type: \"UPDATE_ACTIVE_WORKSPACE_SCREEN\",\n                activeScreen: activeScreen\n            });\n        },\n\n        watch: function watch(onChange) {\n            return watchState('workspace.activeScreen', onChange);\n        }\n    },\n\n    activeUrl: {\n\n        get: function get() {\n            return store.getState().workspace.activeUrl;\n        },\n\n        set: function set(activeUrl) {\n            store.dispatch({\n                type: \"UPDATE_WORKSPACE_ACTIVE_URL\",\n                activeUrl: activeUrl\n            });\n        },\n\n        watch: function watch(onChange) {\n            return watchState('workspace.activeUrl', onChange);\n        }\n    },\n\n    previewUrl: {\n\n        get: function get() {\n            return store.getState().workspace.previewUrl;\n        },\n\n        set: function set(previewUrl) {\n            store.dispatch({\n                type: \"UPDATE_WORKSPACE_PREVIEW_URL\",\n                previewUrl: previewUrl\n            });\n        },\n\n        watch: function watch(onChange) {\n            return watchState('workspace.previewUrl', onChange);\n        }\n    },\n\n    isDirty: {\n\n        get: function get() {\n            return store.getState().workspace.isDirty;\n        },\n\n        set: function set(bool) {\n            store.dispatch({\n                type: \"UPDATE_IS_DIRTY\",\n                isDirty: bool\n            });\n        }\n    },\n\n    editorData: {\n\n        get: function get() {\n            return store.getState().workspace.editorData;\n        },\n\n        set: function set(editorData) {\n            store.dispatch({\n                type: \"UPDATE_EDITOR_DATA\",\n                editorData: editorData\n            });\n        }\n\n    }\n\n};\n\nmodule.exports = workspaceState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZS5qcz8yMTkwIl0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIHN0b3JlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3N0YXRlLmpzJyksXG4gICAgd2F0Y2hTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS93YXRjaFN0YXRlJyk7XG5cbnZhciB3b3Jrc3BhY2VTdGF0ZSA9IHtcblxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgc3RvcmUuZGlzcGF0Y2goe1xuICAgICAgICAgICAgdHlwZTogXCJSRVNFVF9XT1JLU1BBQ0VcIlxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYnJvd3NlVHJlZURhdGE6IHtcblxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldFN0YXRlKCkud29ya3NwYWNlLmJyb3dzZVRyZWVEYXRhO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldDogZnVuY3Rpb24oYnJvd3NlVHJlZURhdGEpIHtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9CUk9XU0VfVFJFRV9EQVRBXCIsXG4gICAgICAgICAgICAgICAgYnJvd3NlVHJlZURhdGE6IGJyb3dzZVRyZWVEYXRhXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICB9LFxuXG4gICAgYWN0aXZlU2NyZWVuOiB7XG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLndvcmtzcGFjZS5hY3RpdmVTY3JlZW47XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbihhY3RpdmVTY3JlZW4pIHtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9BQ1RJVkVfV09SS1NQQUNFX1NDUkVFTlwiLFxuICAgICAgICAgICAgICAgIGFjdGl2ZVNjcmVlbjogYWN0aXZlU2NyZWVuXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIHdhdGNoOiBmdW5jdGlvbihvbkNoYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoU3RhdGUoJ3dvcmtzcGFjZS5hY3RpdmVTY3JlZW4nLCBvbkNoYW5nZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWN0aXZlVXJsOiB7XG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLndvcmtzcGFjZS5hY3RpdmVVcmw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbihhY3RpdmVVcmwpIHtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9XT1JLU1BBQ0VfQUNUSVZFX1VSTFwiLFxuICAgICAgICAgICAgICAgIGFjdGl2ZVVybDogYWN0aXZlVXJsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIHdhdGNoOiBmdW5jdGlvbihvbkNoYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoU3RhdGUoJ3dvcmtzcGFjZS5hY3RpdmVVcmwnLCBvbkNoYW5nZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcHJldmlld1VybDoge1xuXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0U3RhdGUoKS53b3Jrc3BhY2UucHJldmlld1VybDtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHByZXZpZXdVcmwpIHtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlVQREFURV9XT1JLU1BBQ0VfUFJFVklFV19VUkxcIixcbiAgICAgICAgICAgICAgICBwcmV2aWV3VXJsOiBwcmV2aWV3VXJsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIHdhdGNoOiBmdW5jdGlvbihvbkNoYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoU3RhdGUoJ3dvcmtzcGFjZS5wcmV2aWV3VXJsJywgb25DaGFuZ2UpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGlzRGlydHk6IHtcblxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldFN0YXRlKCkud29ya3NwYWNlLmlzRGlydHk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbihib29sKSB7XG4gICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfSVNfRElSVFlcIixcbiAgICAgICAgICAgICAgICBpc0RpcnR5OiBib29sXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGVkaXRvckRhdGE6IHtcblxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldFN0YXRlKCkud29ya3NwYWNlLmVkaXRvckRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbihlZGl0b3JEYXRhKSB7XG4gICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfRURJVE9SX0RBVEFcIixcbiAgICAgICAgICAgICAgICBlZGl0b3JEYXRhOiBlZGl0b3JEYXRhXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICB9XG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gd29ya3NwYWNlU3RhdGU7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFaQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQUNBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZkE7QUFDQTtBQWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBQ0E7QUFpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBWEE7QUFDQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBWkE7QUFDQTtBQTVGQTtBQUNBO0FBMkdBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 26 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\n/**\n * Observes state and runs function when specific part of state in updated\n *\n * @param statePropert - a string of the selector for the property being observed in stave (eg 'workspace.editorData')\n * @param onChange - a function that is run when selected property in state in updated to new value (which is passed back as an argument in onChange)\n *\n * @returns unsubscribe function - stops this observation of the state\n */\n\nvar store = __webpack_require__(9),\n    getValue = __webpack_require__(27).get;\n\nvar watchStore = function watchStore(stateProperty, onChange) {\n\n    console.log(\"Registered state observation for '\" + stateProperty + \"'\");\n\n    var currentValue;\n\n    function handleChange() {\n        var previousValue = currentValue;\n        currentValue = getValue(store.getState(), stateProperty);\n\n        if (previousValue !== currentValue) {\n            onChange(currentValue, previousValue);\n            console.log(stateProperty + ' changed from \"', previousValue, '\" to \"', currentValue, '\"');\n        }\n    }\n\n    return store.subscribe(handleChange);\n};\n\nmodule.exports = watchStore;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9zdGF0ZS93YXRjaFN0YXRlLmpzPzdiMzUiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPYnNlcnZlcyBzdGF0ZSBhbmQgcnVucyBmdW5jdGlvbiB3aGVuIHNwZWNpZmljIHBhcnQgb2Ygc3RhdGUgaW4gdXBkYXRlZFxuICpcbiAqIEBwYXJhbSBzdGF0ZVByb3BlcnQgLSBhIHN0cmluZyBvZiB0aGUgc2VsZWN0b3IgZm9yIHRoZSBwcm9wZXJ0eSBiZWluZyBvYnNlcnZlZCBpbiBzdGF2ZSAoZWcgJ3dvcmtzcGFjZS5lZGl0b3JEYXRhJylcbiAqIEBwYXJhbSBvbkNoYW5nZSAtIGEgZnVuY3Rpb24gdGhhdCBpcyBydW4gd2hlbiBzZWxlY3RlZCBwcm9wZXJ0eSBpbiBzdGF0ZSBpbiB1cGRhdGVkIHRvIG5ldyB2YWx1ZSAod2hpY2ggaXMgcGFzc2VkIGJhY2sgYXMgYW4gYXJndW1lbnQgaW4gb25DaGFuZ2UpXG4gKlxuICogQHJldHVybnMgdW5zdWJzY3JpYmUgZnVuY3Rpb24gLSBzdG9wcyB0aGlzIG9ic2VydmF0aW9uIG9mIHRoZSBzdGF0ZVxuICovXG5cbnZhciBzdG9yZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9zdGF0ZScpLFxuICAgIGdldFZhbHVlID0gcmVxdWlyZSgnb2JqZWN0LXBhdGgnKS5nZXQ7XG5cbnZhciB3YXRjaFN0b3JlID0gZnVuY3Rpb24oc3RhdGVQcm9wZXJ0eSwgb25DaGFuZ2UpIHtcblxuICAgIGNvbnNvbGUubG9nKFwiUmVnaXN0ZXJlZCBzdGF0ZSBvYnNlcnZhdGlvbiBmb3IgJ1wiICsgc3RhdGVQcm9wZXJ0eSArIFwiJ1wiKTtcblxuICAgIHZhciBjdXJyZW50VmFsdWU7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBwcmV2aW91c1ZhbHVlID0gY3VycmVudFZhbHVlO1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBnZXRWYWx1ZShzdG9yZS5nZXRTdGF0ZSgpLCBzdGF0ZVByb3BlcnR5KTtcblxuICAgICAgICBpZiAocHJldmlvdXNWYWx1ZSAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICBvbkNoYW5nZShjdXJyZW50VmFsdWUsIHByZXZpb3VzVmFsdWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3RhdGVQcm9wZXJ0eSArICcgY2hhbmdlZCBmcm9tIFwiJyxwcmV2aW91c1ZhbHVlLCdcIiB0byBcIicsY3VycmVudFZhbHVlLCdcIicpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0b3JlLnN1YnNjcmliZShoYW5kbGVDaGFuZ2UpO1xuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHdhdGNoU3RvcmU7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9zdGF0ZS93YXRjaFN0YXRlLmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7Ozs7QUFTQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 27 */
/***/ function(module, exports, __webpack_require__) {

	eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory){\n  'use strict';\n\n  /*istanbul ignore next:cant test*/\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = factory();\n  } else if (true) {\n    // AMD. Register as an anonymous module.\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {\n    // Browser globals\n    root.objectPath = factory();\n  }\n})(this, function(){\n  'use strict';\n\n  var toStr = Object.prototype.toString;\n  function hasOwnProperty(obj, prop) {\n    if(obj == null) {\n      return false\n    }\n    //to handle objects with null prototypes (too edge case?)\n    return Object.prototype.hasOwnProperty.call(obj, prop)\n  }\n\n  function isEmpty(value){\n    if (!value) {\n      return true;\n    }\n    if (isArray(value) && value.length === 0) {\n        return true;\n    } else if (typeof value !== 'string') {\n        for (var i in value) {\n            if (hasOwnProperty(value, i)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n  }\n\n  function toString(type){\n    return toStr.call(type);\n  }\n\n  function isObject(obj){\n    return typeof obj === 'object' && toString(obj) === \"[object Object]\";\n  }\n\n  var isArray = Array.isArray || function(obj){\n    /*istanbul ignore next:cant test*/\n    return toStr.call(obj) === '[object Array]';\n  }\n\n  function isBoolean(obj){\n    return typeof obj === 'boolean' || toString(obj) === '[object Boolean]';\n  }\n\n  function getKey(key){\n    var intKey = parseInt(key);\n    if (intKey.toString() === key) {\n      return intKey;\n    }\n    return key;\n  }\n\n  function factory(options) {\n    options = options || {}\n\n    var objectPath = function(obj) {\n      return Object.keys(objectPath).reduce(function(proxy, prop) {\n        if(prop === 'create') {\n          return proxy;\n        }\n\n        /*istanbul ignore else*/\n        if (typeof objectPath[prop] === 'function') {\n          proxy[prop] = objectPath[prop].bind(objectPath, obj);\n        }\n\n        return proxy;\n      }, {});\n    };\n\n    function getShallowProperty(obj, prop) {\n      if (options.includeInheritedProps || (typeof prop === 'number' && Array.isArray(obj)) || hasOwnProperty(obj, prop)) {\n        return obj[prop];\n      }\n    }\n\n    function set(obj, path, value, doNotReplace){\n      if (typeof path === 'number') {\n        path = [path];\n      }\n      if (!path || path.length === 0) {\n        return obj;\n      }\n      if (typeof path === 'string') {\n        return set(obj, path.split('.').map(getKey), value, doNotReplace);\n      }\n      var currentPath = path[0];\n      var currentValue = getShallowProperty(obj, currentPath);\n      if (path.length === 1) {\n        if (currentValue === void 0 || !doNotReplace) {\n          obj[currentPath] = value;\n        }\n        return currentValue;\n      }\n\n      if (currentValue === void 0) {\n        //check if we assume an array\n        if(typeof path[1] === 'number') {\n          obj[currentPath] = [];\n        } else {\n          obj[currentPath] = {};\n        }\n      }\n\n      return set(obj[currentPath], path.slice(1), value, doNotReplace);\n    }\n\n    objectPath.has = function (obj, path) {\n      if (typeof path === 'number') {\n        path = [path];\n      } else if (typeof path === 'string') {\n        path = path.split('.');\n      }\n\n      if (!path || path.length === 0) {\n        return !!obj;\n      }\n\n      for (var i = 0; i < path.length; i++) {\n        var j = getKey(path[i]);\n\n        if((typeof j === 'number' && isArray(obj) && j < obj.length) ||\n          (options.includeInheritedProps ? (j in Object(obj)) : hasOwnProperty(obj, j))) {\n          obj = obj[j];\n        } else {\n          return false;\n        }\n      }\n\n      return true;\n    };\n\n    objectPath.ensureExists = function (obj, path, value){\n      return set(obj, path, value, true);\n    };\n\n    objectPath.set = function (obj, path, value, doNotReplace){\n      return set(obj, path, value, doNotReplace);\n    };\n\n    objectPath.insert = function (obj, path, value, at){\n      var arr = objectPath.get(obj, path);\n      at = ~~at;\n      if (!isArray(arr)) {\n        arr = [];\n        objectPath.set(obj, path, arr);\n      }\n      arr.splice(at, 0, value);\n    };\n\n    objectPath.empty = function(obj, path) {\n      if (isEmpty(path)) {\n        return void 0;\n      }\n      if (obj == null) {\n        return void 0;\n      }\n\n      var value, i;\n      if (!(value = objectPath.get(obj, path))) {\n        return void 0;\n      }\n\n      if (typeof value === 'string') {\n        return objectPath.set(obj, path, '');\n      } else if (isBoolean(value)) {\n        return objectPath.set(obj, path, false);\n      } else if (typeof value === 'number') {\n        return objectPath.set(obj, path, 0);\n      } else if (isArray(value)) {\n        value.length = 0;\n      } else if (isObject(value)) {\n        for (i in value) {\n          if (hasOwnProperty(value, i)) {\n            delete value[i];\n          }\n        }\n      } else {\n        return objectPath.set(obj, path, null);\n      }\n    };\n\n    objectPath.push = function (obj, path /*, values */){\n      var arr = objectPath.get(obj, path);\n      if (!isArray(arr)) {\n        arr = [];\n        objectPath.set(obj, path, arr);\n      }\n\n      arr.push.apply(arr, Array.prototype.slice.call(arguments, 2));\n    };\n\n    objectPath.coalesce = function (obj, paths, defaultValue) {\n      var value;\n\n      for (var i = 0, len = paths.length; i < len; i++) {\n        if ((value = objectPath.get(obj, paths[i])) !== void 0) {\n          return value;\n        }\n      }\n\n      return defaultValue;\n    };\n\n    objectPath.get = function (obj, path, defaultValue){\n      if (typeof path === 'number') {\n        path = [path];\n      }\n      if (!path || path.length === 0) {\n        return obj;\n      }\n      if (obj == null) {\n        return defaultValue;\n      }\n      if (typeof path === 'string') {\n        return objectPath.get(obj, path.split('.'), defaultValue);\n      }\n\n      var currentPath = getKey(path[0]);\n      var nextObj = getShallowProperty(obj, currentPath)\n      if (nextObj === void 0) {\n        return defaultValue;\n      }\n\n      if (path.length === 1) {\n        return nextObj;\n      }\n\n      return objectPath.get(obj[currentPath], path.slice(1), defaultValue);\n    };\n\n    objectPath.del = function del(obj, path) {\n      if (typeof path === 'number') {\n        path = [path];\n      }\n\n      if (obj == null) {\n        return obj;\n      }\n\n      if (isEmpty(path)) {\n        return obj;\n      }\n      if(typeof path === 'string') {\n        return objectPath.del(obj, path.split('.'));\n      }\n\n      var currentPath = getKey(path[0]);\n      var currentVal = getShallowProperty(obj, currentPath);\n      if(currentVal == null) {\n        return currentVal;\n      }\n\n      if(path.length === 1) {\n        if (isArray(obj)) {\n          obj.splice(currentPath, 1);\n        } else {\n          delete obj[currentPath];\n        }\n      } else {\n        if (obj[currentPath] !== void 0) {\n          return objectPath.del(obj[currentPath], path.slice(1));\n        }\n      }\n\n      return obj;\n    }\n\n    return objectPath;\n  }\n\n  var mod = factory();\n  mod.create = factory;\n  mod.withInheritedProps = factory({includeInheritedProps: true})\n  return mod;\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L29iamVjdC1wYXRoL2luZGV4LmpzP2YxMTgiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KXtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qaXN0YW5idWwgaWdub3JlIG5leHQ6Y2FudCB0ZXN0Ki9cbiAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUuZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG4gICAgZGVmaW5lKFtdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBCcm93c2VyIGdsb2JhbHNcbiAgICByb290Lm9iamVjdFBhdGggPSBmYWN0b3J5KCk7XG4gIH1cbn0pKHRoaXMsIGZ1bmN0aW9uKCl7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgdG9TdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xuICBmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShvYmosIHByb3ApIHtcbiAgICBpZihvYmogPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIC8vdG8gaGFuZGxlIG9iamVjdHMgd2l0aCBudWxsIHByb3RvdHlwZXMgKHRvbyBlZGdlIGNhc2U/KVxuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKVxuICB9XG5cbiAgZnVuY3Rpb24gaXNFbXB0eSh2YWx1ZSl7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChpc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGZvciAodmFyIGkgaW4gdmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgaSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvU3RyaW5nKHR5cGUpe1xuICAgIHJldHVybiB0b1N0ci5jYWxsKHR5cGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNPYmplY3Qob2JqKXtcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgdG9TdHJpbmcob2JqKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIjtcbiAgfVxuXG4gIHZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihvYmope1xuICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQ6Y2FudCB0ZXN0Ki9cbiAgICByZXR1cm4gdG9TdHIuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNCb29sZWFuKG9iail7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICdib29sZWFuJyB8fCB0b1N0cmluZyhvYmopID09PSAnW29iamVjdCBCb29sZWFuXSc7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRLZXkoa2V5KXtcbiAgICB2YXIgaW50S2V5ID0gcGFyc2VJbnQoa2V5KTtcbiAgICBpZiAoaW50S2V5LnRvU3RyaW5nKCkgPT09IGtleSkge1xuICAgICAgcmV0dXJuIGludEtleTtcbiAgICB9XG4gICAgcmV0dXJuIGtleTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZhY3Rvcnkob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9XG5cbiAgICB2YXIgb2JqZWN0UGF0aCA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdFBhdGgpLnJlZHVjZShmdW5jdGlvbihwcm94eSwgcHJvcCkge1xuICAgICAgICBpZihwcm9wID09PSAnY3JlYXRlJykge1xuICAgICAgICAgIHJldHVybiBwcm94eTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qaXN0YW5idWwgaWdub3JlIGVsc2UqL1xuICAgICAgICBpZiAodHlwZW9mIG9iamVjdFBhdGhbcHJvcF0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBwcm94eVtwcm9wXSA9IG9iamVjdFBhdGhbcHJvcF0uYmluZChvYmplY3RQYXRoLCBvYmopO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByb3h5O1xuICAgICAgfSwge30pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnZXRTaGFsbG93UHJvcGVydHkob2JqLCBwcm9wKSB7XG4gICAgICBpZiAob3B0aW9ucy5pbmNsdWRlSW5oZXJpdGVkUHJvcHMgfHwgKHR5cGVvZiBwcm9wID09PSAnbnVtYmVyJyAmJiBBcnJheS5pc0FycmF5KG9iaikpIHx8IGhhc093blByb3BlcnR5KG9iaiwgcHJvcCkpIHtcbiAgICAgICAgcmV0dXJuIG9ialtwcm9wXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXQob2JqLCBwYXRoLCB2YWx1ZSwgZG9Ob3RSZXBsYWNlKXtcbiAgICAgIGlmICh0eXBlb2YgcGF0aCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcGF0aCA9IFtwYXRoXTtcbiAgICAgIH1cbiAgICAgIGlmICghcGF0aCB8fCBwYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gc2V0KG9iaiwgcGF0aC5zcGxpdCgnLicpLm1hcChnZXRLZXkpLCB2YWx1ZSwgZG9Ob3RSZXBsYWNlKTtcbiAgICAgIH1cbiAgICAgIHZhciBjdXJyZW50UGF0aCA9IHBhdGhbMF07XG4gICAgICB2YXIgY3VycmVudFZhbHVlID0gZ2V0U2hhbGxvd1Byb3BlcnR5KG9iaiwgY3VycmVudFBhdGgpO1xuICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmIChjdXJyZW50VmFsdWUgPT09IHZvaWQgMCB8fCAhZG9Ob3RSZXBsYWNlKSB7XG4gICAgICAgICAgb2JqW2N1cnJlbnRQYXRoXSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjdXJyZW50VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgICAvL2NoZWNrIGlmIHdlIGFzc3VtZSBhbiBhcnJheVxuICAgICAgICBpZih0eXBlb2YgcGF0aFsxXSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICBvYmpbY3VycmVudFBhdGhdID0gW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb2JqW2N1cnJlbnRQYXRoXSA9IHt9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzZXQob2JqW2N1cnJlbnRQYXRoXSwgcGF0aC5zbGljZSgxKSwgdmFsdWUsIGRvTm90UmVwbGFjZSk7XG4gICAgfVxuXG4gICAgb2JqZWN0UGF0aC5oYXMgPSBmdW5jdGlvbiAob2JqLCBwYXRoKSB7XG4gICAgICBpZiAodHlwZW9mIHBhdGggPT09ICdudW1iZXInKSB7XG4gICAgICAgIHBhdGggPSBbcGF0aF07XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICBwYXRoID0gcGF0aC5zcGxpdCgnLicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXBhdGggfHwgcGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuICEhb2JqO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGogPSBnZXRLZXkocGF0aFtpXSk7XG5cbiAgICAgICAgaWYoKHR5cGVvZiBqID09PSAnbnVtYmVyJyAmJiBpc0FycmF5KG9iaikgJiYgaiA8IG9iai5sZW5ndGgpIHx8XG4gICAgICAgICAgKG9wdGlvbnMuaW5jbHVkZUluaGVyaXRlZFByb3BzID8gKGogaW4gT2JqZWN0KG9iaikpIDogaGFzT3duUHJvcGVydHkob2JqLCBqKSkpIHtcbiAgICAgICAgICBvYmogPSBvYmpbal07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBvYmplY3RQYXRoLmVuc3VyZUV4aXN0cyA9IGZ1bmN0aW9uIChvYmosIHBhdGgsIHZhbHVlKXtcbiAgICAgIHJldHVybiBzZXQob2JqLCBwYXRoLCB2YWx1ZSwgdHJ1ZSk7XG4gICAgfTtcblxuICAgIG9iamVjdFBhdGguc2V0ID0gZnVuY3Rpb24gKG9iaiwgcGF0aCwgdmFsdWUsIGRvTm90UmVwbGFjZSl7XG4gICAgICByZXR1cm4gc2V0KG9iaiwgcGF0aCwgdmFsdWUsIGRvTm90UmVwbGFjZSk7XG4gICAgfTtcblxuICAgIG9iamVjdFBhdGguaW5zZXJ0ID0gZnVuY3Rpb24gKG9iaiwgcGF0aCwgdmFsdWUsIGF0KXtcbiAgICAgIHZhciBhcnIgPSBvYmplY3RQYXRoLmdldChvYmosIHBhdGgpO1xuICAgICAgYXQgPSB+fmF0O1xuICAgICAgaWYgKCFpc0FycmF5KGFycikpIHtcbiAgICAgICAgYXJyID0gW107XG4gICAgICAgIG9iamVjdFBhdGguc2V0KG9iaiwgcGF0aCwgYXJyKTtcbiAgICAgIH1cbiAgICAgIGFyci5zcGxpY2UoYXQsIDAsIHZhbHVlKTtcbiAgICB9O1xuXG4gICAgb2JqZWN0UGF0aC5lbXB0eSA9IGZ1bmN0aW9uKG9iaiwgcGF0aCkge1xuICAgICAgaWYgKGlzRW1wdHkocGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIGlmIChvYmogPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgfVxuXG4gICAgICB2YXIgdmFsdWUsIGk7XG4gICAgICBpZiAoISh2YWx1ZSA9IG9iamVjdFBhdGguZ2V0KG9iaiwgcGF0aCkpKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBvYmplY3RQYXRoLnNldChvYmosIHBhdGgsICcnKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNCb29sZWFuKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gb2JqZWN0UGF0aC5zZXQob2JqLCBwYXRoLCBmYWxzZSk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIG9iamVjdFBhdGguc2V0KG9iaiwgcGF0aCwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLmxlbmd0aCA9IDA7XG4gICAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICBmb3IgKGkgaW4gdmFsdWUpIHtcbiAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkodmFsdWUsIGkpKSB7XG4gICAgICAgICAgICBkZWxldGUgdmFsdWVbaV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gb2JqZWN0UGF0aC5zZXQob2JqLCBwYXRoLCBudWxsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgb2JqZWN0UGF0aC5wdXNoID0gZnVuY3Rpb24gKG9iaiwgcGF0aCAvKiwgdmFsdWVzICovKXtcbiAgICAgIHZhciBhcnIgPSBvYmplY3RQYXRoLmdldChvYmosIHBhdGgpO1xuICAgICAgaWYgKCFpc0FycmF5KGFycikpIHtcbiAgICAgICAgYXJyID0gW107XG4gICAgICAgIG9iamVjdFBhdGguc2V0KG9iaiwgcGF0aCwgYXJyKTtcbiAgICAgIH1cblxuICAgICAgYXJyLnB1c2guYXBwbHkoYXJyLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpKTtcbiAgICB9O1xuXG4gICAgb2JqZWN0UGF0aC5jb2FsZXNjZSA9IGZ1bmN0aW9uIChvYmosIHBhdGhzLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIHZhciB2YWx1ZTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBhdGhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmICgodmFsdWUgPSBvYmplY3RQYXRoLmdldChvYmosIHBhdGhzW2ldKSkgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIH07XG5cbiAgICBvYmplY3RQYXRoLmdldCA9IGZ1bmN0aW9uIChvYmosIHBhdGgsIGRlZmF1bHRWYWx1ZSl7XG4gICAgICBpZiAodHlwZW9mIHBhdGggPT09ICdudW1iZXInKSB7XG4gICAgICAgIHBhdGggPSBbcGF0aF07XG4gICAgICB9XG4gICAgICBpZiAoIXBhdGggfHwgcGF0aC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH1cbiAgICAgIGlmIChvYmogPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gb2JqZWN0UGF0aC5nZXQob2JqLCBwYXRoLnNwbGl0KCcuJyksIGRlZmF1bHRWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjdXJyZW50UGF0aCA9IGdldEtleShwYXRoWzBdKTtcbiAgICAgIHZhciBuZXh0T2JqID0gZ2V0U2hhbGxvd1Byb3BlcnR5KG9iaiwgY3VycmVudFBhdGgpXG4gICAgICBpZiAobmV4dE9iaiA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICByZXR1cm4gbmV4dE9iajtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9iamVjdFBhdGguZ2V0KG9ialtjdXJyZW50UGF0aF0sIHBhdGguc2xpY2UoMSksIGRlZmF1bHRWYWx1ZSk7XG4gICAgfTtcblxuICAgIG9iamVjdFBhdGguZGVsID0gZnVuY3Rpb24gZGVsKG9iaiwgcGF0aCkge1xuICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnbnVtYmVyJykge1xuICAgICAgICBwYXRoID0gW3BhdGhdO1xuICAgICAgfVxuXG4gICAgICBpZiAob2JqID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH1cblxuICAgICAgaWYgKGlzRW1wdHkocGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH1cbiAgICAgIGlmKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gb2JqZWN0UGF0aC5kZWwob2JqLCBwYXRoLnNwbGl0KCcuJykpO1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudFBhdGggPSBnZXRLZXkocGF0aFswXSk7XG4gICAgICB2YXIgY3VycmVudFZhbCA9IGdldFNoYWxsb3dQcm9wZXJ0eShvYmosIGN1cnJlbnRQYXRoKTtcbiAgICAgIGlmKGN1cnJlbnRWYWwgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFZhbDtcbiAgICAgIH1cblxuICAgICAgaWYocGF0aC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgaWYgKGlzQXJyYXkob2JqKSkge1xuICAgICAgICAgIG9iai5zcGxpY2UoY3VycmVudFBhdGgsIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlbGV0ZSBvYmpbY3VycmVudFBhdGhdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2N1cnJlbnRQYXRoXSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIG9iamVjdFBhdGguZGVsKG9ialtjdXJyZW50UGF0aF0sIHBhdGguc2xpY2UoMSkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9iamVjdFBhdGg7XG4gIH1cblxuICB2YXIgbW9kID0gZmFjdG9yeSgpO1xuICBtb2QuY3JlYXRlID0gZmFjdG9yeTtcbiAgbW9kLndpdGhJbmhlcml0ZWRQcm9wcyA9IGZhY3Rvcnkoe2luY2x1ZGVJbmhlcml0ZWRQcm9wczogdHJ1ZX0pXG4gIHJldHVybiBtb2Q7XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9vYmplY3QtcGF0aC9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gMjdcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 28 */
/***/ function(module, exports, __webpack_require__) {

	eval("\"use strict\";\n\nvar store = __webpack_require__(9);\n\nvar collectionState = {\n\n    get: function get() {\n        return store.getState().workspace.collectionData;\n    },\n\n    set: function set(collectionData) {\n        store.dispatch({\n            type: \"UPDATE_COLLECTION_DATA\",\n            collectionData: collectionData\n        });\n    }\n};\n\nmodule.exports = collectionState;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUuanM/YjRjZiJdLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBzdG9yZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9zdGF0ZS5qcycpO1xuXG52YXIgY29sbGVjdGlvblN0YXRlID0ge1xuXG4gICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLndvcmtzcGFjZS5jb2xsZWN0aW9uRGF0YTtcbiAgICB9LFxuXG4gICAgc2V0OiBmdW5jdGlvbiAoY29sbGVjdGlvbkRhdGEpIHtcbiAgICAgICAgc3RvcmUuZGlzcGF0Y2goe1xuICAgICAgICAgICAgdHlwZTogXCJVUERBVEVfQ09MTEVDVElPTl9EQVRBXCIsXG4gICAgICAgICAgICBjb2xsZWN0aW9uRGF0YTogY29sbGVjdGlvbkRhdGFcbiAgICAgICAgfSk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uU3RhdGU7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQVhBO0FBQ0E7QUFhQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 29 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar workspaceView = __webpack_require__(30),\n    navigationController = __webpack_require__(41),\n    browseController = __webpack_require__(44),\n    editController = __webpack_require__(52),\n    createController = __webpack_require__(58),\n    workspaceState = __webpack_require__(25),\n    previewController = __webpack_require__(66);\n\nvar workspaceController = {\n\n    init: function init() {\n        workspaceView.render();\n        navigationController.init();\n        this.updateWorkspace.onActiveScreenStateUpdate();\n        this.updateWorkspace.onActiveUrlStateUpdate();\n        this.bindWorkspaceExit();\n        previewController.init();\n\n        if (workspaceState.activeScreen.get().length <= 0) {\n            workspaceState.activeScreen.set('browse');\n        }\n    },\n\n    // Array of all state observations for the workspace so that they can be cancelled when leaving the workspace (or else it's end up being observed multiple times)\n    stateSubscriptions: [],\n\n    cancelStateSubscriptions: function cancelStateSubscriptions() {\n        var i,\n            unsubscriptions = this.stateSubscriptions,\n            unsubscriptionsLength = unsubscriptions.length;\n\n        for (i = 0; i < unsubscriptionsLength; i++) {\n            unsubscriptions[i]();\n        }\n    },\n\n    bindWorkspaceExit: function bindWorkspaceExit() {\n        //TODO this should be controlled by state, not DOM click\n        $('.js-nav-item').off().click(function () {\n            workspaceController.cancelStateSubscriptions();\n        });\n    },\n\n    updateWorkspace: {\n\n        onActiveScreenStateUpdate: function onActiveScreenStateUpdate() {\n            function updateWorkspace(newScreen) {\n                workspaceController.renderActiveScreen(newScreen);\n            }\n\n            var unsubscribe = workspaceState.activeScreen.watch(updateWorkspace);\n\n            workspaceController.stateSubscriptions.push(unsubscribe);\n        },\n\n        onActiveUrlStateUpdate: function onActiveUrlStateUpdate() {\n\n            function updateWorkspace(newUrl) {\n                // Switch to browse screen if active url changes on creator or editor\n                if (workspaceState.activeScreen.get() === \"create\" || workspaceState.activeScreen.get() === \"edit\") {\n                    workspaceState.activeScreen.set('browse');\n                    return;\n                }\n\n                // Browse already displayed, update preview (if necessary) and tree\n                if (newUrl !== previewController.getPreviewUri()) {\n                    previewController.updatePreview(newUrl);\n                }\n                browseController.selectBrowseNodeByUrl(newUrl);\n            }\n\n            var unsubscribe = workspaceState.activeUrl.watch(updateWorkspace);\n\n            workspaceController.stateSubscriptions.push(unsubscribe);\n        }\n\n    },\n\n    renderActiveScreen: function renderActiveScreen(activeScreen) {\n        switch (activeScreen) {\n            case 'browse':\n                {\n                    // console.log('Render browse workspace');\n                    navigationController.changeActiveItem(activeScreen);\n                    browseController.init();\n                    break;\n                }\n            case 'create':\n                {\n                    // console.log('Render create workspace');\n                    navigationController.changeActiveItem(activeScreen);\n                    createController.init();\n                    break;\n                }\n            case 'edit':\n                {\n                    // console.log('Render edit workspace');\n                    navigationController.changeActiveItem(activeScreen);\n                    editController.init();\n                    break;\n                }\n            default:\n                {\n                    console.log('Screen name \"%s\" is not recognised', activeScreen);\n                    break;\n                }\n        }\n    }\n\n};\n\nmodule.exports = workspaceController;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS93b3Jrc3BhY2VDb250cm9sbGVyLmpzP2FlOWEiXSwic291cmNlc0NvbnRlbnQiOlsiXG52YXIgd29ya3NwYWNlVmlldyA9IHJlcXVpcmUoJ3dvcmtzcGFjZS93b3Jrc3BhY2VWaWV3JyksXG4gICAgbmF2aWdhdGlvbkNvbnRyb2xsZXIgPSByZXF1aXJlKCd3b3Jrc3BhY2UvbmF2aWdhdGlvbi9uYXZpZ2F0aW9uQ29udHJvbGxlcicpLFxuICAgIGJyb3dzZUNvbnRyb2xsZXIgPSByZXF1aXJlKCd3b3Jrc3BhY2UvYnJvd3NlL2Jyb3dzZUNvbnRyb2xsZXInKSxcbiAgICBlZGl0Q29udHJvbGxlciA9IHJlcXVpcmUoJ3dvcmtzcGFjZS9lZGl0L2VkaXRDb250cm9sbGVyJyksXG4gICAgY3JlYXRlQ29udHJvbGxlciA9IHJlcXVpcmUoJ3dvcmtzcGFjZS9jcmVhdGUvY3JlYXRlQ29udHJvbGxlcicpLFxuICAgIHdvcmtzcGFjZVN0YXRlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3dvcmtzcGFjZVN0YXRlJyksXG4gICAgcHJldmlld0NvbnRyb2xsZXIgPSByZXF1aXJlKCd3b3Jrc3BhY2UvcHJldmlldy9wcmV2aWV3Q29udHJvbGxlcicpO1xuXG52YXIgd29ya3NwYWNlQ29udHJvbGxlciA9IHtcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB3b3Jrc3BhY2VWaWV3LnJlbmRlcigpO1xuICAgICAgICBuYXZpZ2F0aW9uQ29udHJvbGxlci5pbml0KCk7XG4gICAgICAgIHRoaXMudXBkYXRlV29ya3NwYWNlLm9uQWN0aXZlU2NyZWVuU3RhdGVVcGRhdGUoKTtcbiAgICAgICAgdGhpcy51cGRhdGVXb3Jrc3BhY2Uub25BY3RpdmVVcmxTdGF0ZVVwZGF0ZSgpO1xuICAgICAgICB0aGlzLmJpbmRXb3Jrc3BhY2VFeGl0KCk7XG4gICAgICAgIHByZXZpZXdDb250cm9sbGVyLmluaXQoKTtcblxuICAgICAgICBpZiAod29ya3NwYWNlU3RhdGUuYWN0aXZlU2NyZWVuLmdldCgpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVTY3JlZW4uc2V0KCdicm93c2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBBcnJheSBvZiBhbGwgc3RhdGUgb2JzZXJ2YXRpb25zIGZvciB0aGUgd29ya3NwYWNlIHNvIHRoYXQgdGhleSBjYW4gYmUgY2FuY2VsbGVkIHdoZW4gbGVhdmluZyB0aGUgd29ya3NwYWNlIChvciBlbHNlIGl0J3MgZW5kIHVwIGJlaW5nIG9ic2VydmVkIG11bHRpcGxlIHRpbWVzKVxuICAgIHN0YXRlU3Vic2NyaXB0aW9uczogW10sXG5cbiAgICBjYW5jZWxTdGF0ZVN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIHVuc3Vic2NyaXB0aW9ucyA9IHRoaXMuc3RhdGVTdWJzY3JpcHRpb25zLFxuICAgICAgICAgICAgdW5zdWJzY3JpcHRpb25zTGVuZ3RoID0gdW5zdWJzY3JpcHRpb25zLmxlbmd0aDtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdW5zdWJzY3JpcHRpb25zTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHVuc3Vic2NyaXB0aW9uc1tpXSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGJpbmRXb3Jrc3BhY2VFeGl0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy9UT0RPIHRoaXMgc2hvdWxkIGJlIGNvbnRyb2xsZWQgYnkgc3RhdGUsIG5vdCBET00gY2xpY2tcbiAgICAgICAgJCgnLmpzLW5hdi1pdGVtJykub2ZmKCkuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3b3Jrc3BhY2VDb250cm9sbGVyLmNhbmNlbFN0YXRlU3Vic2NyaXB0aW9ucygpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlV29ya3NwYWNlOiB7XG5cbiAgICAgICAgb25BY3RpdmVTY3JlZW5TdGF0ZVVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVXb3Jrc3BhY2UobmV3U2NyZWVuKSB7XG4gICAgICAgICAgICAgICAgd29ya3NwYWNlQ29udHJvbGxlci5yZW5kZXJBY3RpdmVTY3JlZW4obmV3U2NyZWVuKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gd29ya3NwYWNlU3RhdGUuYWN0aXZlU2NyZWVuLndhdGNoKHVwZGF0ZVdvcmtzcGFjZSk7XG5cbiAgICAgICAgICAgIHdvcmtzcGFjZUNvbnRyb2xsZXIuc3RhdGVTdWJzY3JpcHRpb25zLnB1c2godW5zdWJzY3JpYmUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQWN0aXZlVXJsU3RhdGVVcGRhdGU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVXb3Jrc3BhY2UobmV3VXJsKSB7XG4gICAgICAgICAgICAgICAgLy8gU3dpdGNoIHRvIGJyb3dzZSBzY3JlZW4gaWYgYWN0aXZlIHVybCBjaGFuZ2VzIG9uIGNyZWF0b3Igb3IgZWRpdG9yXG4gICAgICAgICAgICAgICAgaWYgKHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVNjcmVlbi5nZXQoKSA9PT0gXCJjcmVhdGVcIiB8fCB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVTY3JlZW4uZ2V0KCkgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVNjcmVlbi5zZXQoJ2Jyb3dzZScpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQnJvd3NlIGFscmVhZHkgZGlzcGxheWVkLCB1cGRhdGUgcHJldmlldyAoaWYgbmVjZXNzYXJ5KSBhbmQgdHJlZVxuICAgICAgICAgICAgICAgIGlmIChuZXdVcmwgIT09IHByZXZpZXdDb250cm9sbGVyLmdldFByZXZpZXdVcmkoKSkge1xuICAgICAgICAgICAgICAgICAgICBwcmV2aWV3Q29udHJvbGxlci51cGRhdGVQcmV2aWV3KG5ld1VybCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyb3dzZUNvbnRyb2xsZXIuc2VsZWN0QnJvd3NlTm9kZUJ5VXJsKG5ld1VybCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB1bnN1YnNjcmliZSA9IHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC53YXRjaCh1cGRhdGVXb3Jrc3BhY2UpO1xuXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb250cm9sbGVyLnN0YXRlU3Vic2NyaXB0aW9ucy5wdXNoKHVuc3Vic2NyaWJlKTtcblxuICAgICAgICB9XG5cbiAgICB9LFxuXG4gICAgcmVuZGVyQWN0aXZlU2NyZWVuOiBmdW5jdGlvbihhY3RpdmVTY3JlZW4pIHtcbiAgICAgICAgc3dpdGNoIChhY3RpdmVTY3JlZW4pIHtcbiAgICAgICAgICAgIGNhc2UgKCdicm93c2UnKToge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdSZW5kZXIgYnJvd3NlIHdvcmtzcGFjZScpO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25Db250cm9sbGVyLmNoYW5nZUFjdGl2ZUl0ZW0oYWN0aXZlU2NyZWVuKTtcbiAgICAgICAgICAgICAgICBicm93c2VDb250cm9sbGVyLmluaXQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgKCdjcmVhdGUnKToge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdSZW5kZXIgY3JlYXRlIHdvcmtzcGFjZScpO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25Db250cm9sbGVyLmNoYW5nZUFjdGl2ZUl0ZW0oYWN0aXZlU2NyZWVuKTtcbiAgICAgICAgICAgICAgICBjcmVhdGVDb250cm9sbGVyLmluaXQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgKCdlZGl0Jyk6IHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnUmVuZGVyIGVkaXQgd29ya3NwYWNlJyk7XG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvbnRyb2xsZXIuY2hhbmdlQWN0aXZlSXRlbShhY3RpdmVTY3JlZW4pO1xuICAgICAgICAgICAgICAgIGVkaXRDb250cm9sbGVyLmluaXQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2NyZWVuIG5hbWUgXCIlc1wiIGlzIG5vdCByZWNvZ25pc2VkJywgYWN0aXZlU2NyZWVuKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB3b3Jrc3BhY2VDb250cm9sbGVyO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvd29ya3NwYWNlL3dvcmtzcGFjZUNvbnRyb2xsZXIuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFqQ0E7QUFDQTtBQW1DQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQXRCQTtBQXdCQTtBQUNBO0FBakdBO0FBQ0E7QUFtR0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 30 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar template = __webpack_require__(31);\n\nvar workspaceView = {\n    render: function render() {\n        document.getElementById('main').innerHTML = template();\n    }\n};\n\nmodule.exports = workspaceView;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS93b3Jrc3BhY2VWaWV3LmpzP2IzNmEiXSwic291cmNlc0NvbnRlbnQiOlsiXG52YXIgdGVtcGxhdGUgPSByZXF1aXJlKCcuL3dvcmtzcGFjZS5oYW5kbGViYXJzJyk7XG5cbnZhciB3b3Jrc3BhY2VWaWV3ID0ge1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJykuaW5uZXJIVE1MID0gdGVtcGxhdGUoKTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHdvcmtzcGFjZVZpZXc7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3dvcmtzcGFjZS93b3Jrc3BhY2VWaWV3LmpzIl0sIm1hcHBpbmdzIjoiOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 31 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<nav class=\\\"panel col col--1 nav nav--workspace js-workspace-nav\\\" id=\\\"workspace-navigation\\\">\\n</nav>\\n<div class=\\\"panel col col--4 workspace-menu\\\" id=\\\"workspace-browse\\\">\\n    <!--<div class=\\\"margin-top--3\\\">\"\n    + ((stack1 = this.invokePartial(__webpack_require__(40),depth0,{\"name\":\"../shared/templatePartials/loadingAnimation\",\"hash\":{\"dark\":true,\"large\":true},\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \"</div>-->\\n</div>\\n<section class=\\\"panel col col--7 workspace-browser\\\" id=\\\"workspace-preview\\\">\\n    <!--<div class=\\\"margin-top--3\\\">\"\n    + ((stack1 = this.invokePartial(__webpack_require__(40),depth0,{\"name\":\"../shared/templatePartials/loadingAnimation\",\"hash\":{\"dark\":true,\"large\":true},\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \"</div>-->\\n</section>\\n\";\n},\"usePartial\":true,\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL3dvcmtzcGFjZS5oYW5kbGViYXJzP2Q2ZjEiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCI8bmF2IGNsYXNzPVxcXCJwYW5lbCBjb2wgY29sLS0xIG5hdiBuYXYtLXdvcmtzcGFjZSBqcy13b3Jrc3BhY2UtbmF2XFxcIiBpZD1cXFwid29ya3NwYWNlLW5hdmlnYXRpb25cXFwiPlxcbjwvbmF2PlxcbjxkaXYgY2xhc3M9XFxcInBhbmVsIGNvbCBjb2wtLTQgd29ya3NwYWNlLW1lbnVcXFwiIGlkPVxcXCJ3b3Jrc3BhY2UtYnJvd3NlXFxcIj5cXG4gICAgPCEtLTxkaXYgY2xhc3M9XFxcIm1hcmdpbi10b3AtLTNcXFwiPlwiXG4gICAgKyAoKHN0YWNrMSA9IHRoaXMuaW52b2tlUGFydGlhbChyZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvYXBwL3NoYXJlZC90ZW1wbGF0ZVBhcnRpYWxzL2xvYWRpbmdBbmltYXRpb24uaGFuZGxlYmFyc1wiKSxkZXB0aDAse1wibmFtZVwiOlwiLi4vc2hhcmVkL3RlbXBsYXRlUGFydGlhbHMvbG9hZGluZ0FuaW1hdGlvblwiLFwiaGFzaFwiOntcImRhcmtcIjp0cnVlLFwibGFyZ2VcIjp0cnVlfSxcImRhdGFcIjpkYXRhLFwiaGVscGVyc1wiOmhlbHBlcnMsXCJwYXJ0aWFsc1wiOnBhcnRpYWxzfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCI8L2Rpdj4tLT5cXG48L2Rpdj5cXG48c2VjdGlvbiBjbGFzcz1cXFwicGFuZWwgY29sIGNvbC0tNyB3b3Jrc3BhY2UtYnJvd3NlclxcXCIgaWQ9XFxcIndvcmtzcGFjZS1wcmV2aWV3XFxcIj5cXG4gICAgPCEtLTxkaXYgY2xhc3M9XFxcIm1hcmdpbi10b3AtLTNcXFwiPlwiXG4gICAgKyAoKHN0YWNrMSA9IHRoaXMuaW52b2tlUGFydGlhbChyZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvYXBwL3NoYXJlZC90ZW1wbGF0ZVBhcnRpYWxzL2xvYWRpbmdBbmltYXRpb24uaGFuZGxlYmFyc1wiKSxkZXB0aDAse1wibmFtZVwiOlwiLi4vc2hhcmVkL3RlbXBsYXRlUGFydGlhbHMvbG9hZGluZ0FuaW1hdGlvblwiLFwiaGFzaFwiOntcImRhcmtcIjp0cnVlLFwibGFyZ2VcIjp0cnVlfSxcImRhdGFcIjpkYXRhLFwiaGVscGVyc1wiOmhlbHBlcnMsXCJwYXJ0aWFsc1wiOnBhcnRpYWxzfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCI8L2Rpdj4tLT5cXG48L3NlY3Rpb24+XFxuXCI7XG59LFwidXNlUGFydGlhbFwiOnRydWUsXCJ1c2VEYXRhXCI6dHJ1ZX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXBwL3dvcmtzcGFjZS93b3Jrc3BhY2UuaGFuZGxlYmFyc1xuLy8gbW9kdWxlIGlkID0gMzFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 32 */
/***/ function(module, exports, __webpack_require__) {

	eval("// Create a simple path alias to allow browserify to resolve\n// the runtime on a supported path.\nmodule.exports = __webpack_require__(33)['default'];\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvcnVudGltZS5qcz81MjVkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENyZWF0ZSBhIHNpbXBsZSBwYXRoIGFsaWFzIHRvIGFsbG93IGJyb3dzZXJpZnkgdG8gcmVzb2x2ZVxuLy8gdGhlIHJ1bnRpbWUgb24gYSBzdXBwb3J0ZWQgcGF0aC5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9kaXN0L2Nqcy9oYW5kbGViYXJzLnJ1bnRpbWUnKVsnZGVmYXVsdCddO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2hhbmRsZWJhcnMvcnVudGltZS5qc1xuLy8gbW9kdWxlIGlkID0gMzJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 33 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar _interopRequireWildcard = function (obj) { return obj && obj.__esModule ? obj : { 'default': obj }; };\n\nexports.__esModule = true;\n\nvar _import = __webpack_require__(34);\n\nvar base = _interopRequireWildcard(_import);\n\n// Each of these augment the Handlebars object. No need to setup here.\n// (This is done to easily share code between commonjs and browse envs)\n\nvar _SafeString = __webpack_require__(37);\n\nvar _SafeString2 = _interopRequireWildcard(_SafeString);\n\nvar _Exception = __webpack_require__(36);\n\nvar _Exception2 = _interopRequireWildcard(_Exception);\n\nvar _import2 = __webpack_require__(35);\n\nvar Utils = _interopRequireWildcard(_import2);\n\nvar _import3 = __webpack_require__(38);\n\nvar runtime = _interopRequireWildcard(_import3);\n\nvar _noConflict = __webpack_require__(39);\n\nvar _noConflict2 = _interopRequireWildcard(_noConflict);\n\n// For compatibility and usage outside of module systems, make the Handlebars object a namespace\nfunction create() {\n  var hb = new base.HandlebarsEnvironment();\n\n  Utils.extend(hb, base);\n  hb.SafeString = _SafeString2['default'];\n  hb.Exception = _Exception2['default'];\n  hb.Utils = Utils;\n  hb.escapeExpression = Utils.escapeExpression;\n\n  hb.VM = runtime;\n  hb.template = function (spec) {\n    return runtime.template(spec, hb);\n  };\n\n  return hb;\n}\n\nvar inst = create();\ninst.create = create;\n\n_noConflict2['default'](inst);\n\ninst['default'] = inst;\n\nexports['default'] = inst;\nmodule.exports = exports['default'];//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy5ydW50aW1lLmpzP2M5OTEiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH07XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBfaW1wb3J0ID0gcmVxdWlyZSgnLi9oYW5kbGViYXJzL2Jhc2UnKTtcblxudmFyIGJhc2UgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfaW1wb3J0KTtcblxuLy8gRWFjaCBvZiB0aGVzZSBhdWdtZW50IHRoZSBIYW5kbGViYXJzIG9iamVjdC4gTm8gbmVlZCB0byBzZXR1cCBoZXJlLlxuLy8gKFRoaXMgaXMgZG9uZSB0byBlYXNpbHkgc2hhcmUgY29kZSBiZXR3ZWVuIGNvbW1vbmpzIGFuZCBicm93c2UgZW52cylcblxudmFyIF9TYWZlU3RyaW5nID0gcmVxdWlyZSgnLi9oYW5kbGViYXJzL3NhZmUtc3RyaW5nJyk7XG5cbnZhciBfU2FmZVN0cmluZzIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfU2FmZVN0cmluZyk7XG5cbnZhciBfRXhjZXB0aW9uID0gcmVxdWlyZSgnLi9oYW5kbGViYXJzL2V4Y2VwdGlvbicpO1xuXG52YXIgX0V4Y2VwdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfRXhjZXB0aW9uKTtcblxudmFyIF9pbXBvcnQyID0gcmVxdWlyZSgnLi9oYW5kbGViYXJzL3V0aWxzJyk7XG5cbnZhciBVdGlscyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9pbXBvcnQyKTtcblxudmFyIF9pbXBvcnQzID0gcmVxdWlyZSgnLi9oYW5kbGViYXJzL3J1bnRpbWUnKTtcblxudmFyIHJ1bnRpbWUgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChfaW1wb3J0Myk7XG5cbnZhciBfbm9Db25mbGljdCA9IHJlcXVpcmUoJy4vaGFuZGxlYmFycy9uby1jb25mbGljdCcpO1xuXG52YXIgX25vQ29uZmxpY3QyID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQoX25vQ29uZmxpY3QpO1xuXG4vLyBGb3IgY29tcGF0aWJpbGl0eSBhbmQgdXNhZ2Ugb3V0c2lkZSBvZiBtb2R1bGUgc3lzdGVtcywgbWFrZSB0aGUgSGFuZGxlYmFycyBvYmplY3QgYSBuYW1lc3BhY2VcbmZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgdmFyIGhiID0gbmV3IGJhc2UuSGFuZGxlYmFyc0Vudmlyb25tZW50KCk7XG5cbiAgVXRpbHMuZXh0ZW5kKGhiLCBiYXNlKTtcbiAgaGIuU2FmZVN0cmluZyA9IF9TYWZlU3RyaW5nMlsnZGVmYXVsdCddO1xuICBoYi5FeGNlcHRpb24gPSBfRXhjZXB0aW9uMlsnZGVmYXVsdCddO1xuICBoYi5VdGlscyA9IFV0aWxzO1xuICBoYi5lc2NhcGVFeHByZXNzaW9uID0gVXRpbHMuZXNjYXBlRXhwcmVzc2lvbjtcblxuICBoYi5WTSA9IHJ1bnRpbWU7XG4gIGhiLnRlbXBsYXRlID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICByZXR1cm4gcnVudGltZS50ZW1wbGF0ZShzcGVjLCBoYik7XG4gIH07XG5cbiAgcmV0dXJuIGhiO1xufVxuXG52YXIgaW5zdCA9IGNyZWF0ZSgpO1xuaW5zdC5jcmVhdGUgPSBjcmVhdGU7XG5cbl9ub0NvbmZsaWN0MlsnZGVmYXVsdCddKGluc3QpO1xuXG5pbnN0WydkZWZhdWx0J10gPSBpbnN0O1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBpbnN0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy5ydW50aW1lLmpzXG4vLyBtb2R1bGUgaWQgPSAzM1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 34 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar _interopRequireWildcard = function (obj) { return obj && obj.__esModule ? obj : { 'default': obj }; };\n\nexports.__esModule = true;\nexports.HandlebarsEnvironment = HandlebarsEnvironment;\nexports.createFrame = createFrame;\n\nvar _import = __webpack_require__(35);\n\nvar Utils = _interopRequireWildcard(_import);\n\nvar _Exception = __webpack_require__(36);\n\nvar _Exception2 = _interopRequireWildcard(_Exception);\n\nvar VERSION = '3.0.1';\nexports.VERSION = VERSION;\nvar COMPILER_REVISION = 6;\n\nexports.COMPILER_REVISION = COMPILER_REVISION;\nvar REVISION_CHANGES = {\n  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it\n  2: '== 1.0.0-rc.3',\n  3: '== 1.0.0-rc.4',\n  4: '== 1.x.x',\n  5: '== 2.0.0-alpha.x',\n  6: '>= 2.0.0-beta.1'\n};\n\nexports.REVISION_CHANGES = REVISION_CHANGES;\nvar isArray = Utils.isArray,\n    isFunction = Utils.isFunction,\n    toString = Utils.toString,\n    objectType = '[object Object]';\n\nfunction HandlebarsEnvironment(helpers, partials) {\n  this.helpers = helpers || {};\n  this.partials = partials || {};\n\n  registerDefaultHelpers(this);\n}\n\nHandlebarsEnvironment.prototype = {\n  constructor: HandlebarsEnvironment,\n\n  logger: logger,\n  log: log,\n\n  registerHelper: function registerHelper(name, fn) {\n    if (toString.call(name) === objectType) {\n      if (fn) {\n        throw new _Exception2['default']('Arg not supported with multiple helpers');\n      }\n      Utils.extend(this.helpers, name);\n    } else {\n      this.helpers[name] = fn;\n    }\n  },\n  unregisterHelper: function unregisterHelper(name) {\n    delete this.helpers[name];\n  },\n\n  registerPartial: function registerPartial(name, partial) {\n    if (toString.call(name) === objectType) {\n      Utils.extend(this.partials, name);\n    } else {\n      if (typeof partial === 'undefined') {\n        throw new _Exception2['default']('Attempting to register a partial as undefined');\n      }\n      this.partials[name] = partial;\n    }\n  },\n  unregisterPartial: function unregisterPartial(name) {\n    delete this.partials[name];\n  }\n};\n\nfunction registerDefaultHelpers(instance) {\n  instance.registerHelper('helperMissing', function () {\n    if (arguments.length === 1) {\n      // A missing field in a {{foo}} constuct.\n      return undefined;\n    } else {\n      // Someone is actually trying to call something, blow up.\n      throw new _Exception2['default']('Missing helper: \"' + arguments[arguments.length - 1].name + '\"');\n    }\n  });\n\n  instance.registerHelper('blockHelperMissing', function (context, options) {\n    var inverse = options.inverse,\n        fn = options.fn;\n\n    if (context === true) {\n      return fn(this);\n    } else if (context === false || context == null) {\n      return inverse(this);\n    } else if (isArray(context)) {\n      if (context.length > 0) {\n        if (options.ids) {\n          options.ids = [options.name];\n        }\n\n        return instance.helpers.each(context, options);\n      } else {\n        return inverse(this);\n      }\n    } else {\n      if (options.data && options.ids) {\n        var data = createFrame(options.data);\n        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);\n        options = { data: data };\n      }\n\n      return fn(context, options);\n    }\n  });\n\n  instance.registerHelper('each', function (context, options) {\n    if (!options) {\n      throw new _Exception2['default']('Must pass iterator to #each');\n    }\n\n    var fn = options.fn,\n        inverse = options.inverse,\n        i = 0,\n        ret = '',\n        data = undefined,\n        contextPath = undefined;\n\n    if (options.data && options.ids) {\n      contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';\n    }\n\n    if (isFunction(context)) {\n      context = context.call(this);\n    }\n\n    if (options.data) {\n      data = createFrame(options.data);\n    }\n\n    function execIteration(field, index, last) {\n      if (data) {\n        data.key = field;\n        data.index = index;\n        data.first = index === 0;\n        data.last = !!last;\n\n        if (contextPath) {\n          data.contextPath = contextPath + field;\n        }\n      }\n\n      ret = ret + fn(context[field], {\n        data: data,\n        blockParams: Utils.blockParams([context[field], field], [contextPath + field, null])\n      });\n    }\n\n    if (context && typeof context === 'object') {\n      if (isArray(context)) {\n        for (var j = context.length; i < j; i++) {\n          execIteration(i, i, i === context.length - 1);\n        }\n      } else {\n        var priorKey = undefined;\n\n        for (var key in context) {\n          if (context.hasOwnProperty(key)) {\n            // We're running the iterations one step out of sync so we can detect\n            // the last iteration without have to scan the object twice and create\n            // an itermediate keys array.\n            if (priorKey) {\n              execIteration(priorKey, i - 1);\n            }\n            priorKey = key;\n            i++;\n          }\n        }\n        if (priorKey) {\n          execIteration(priorKey, i - 1, true);\n        }\n      }\n    }\n\n    if (i === 0) {\n      ret = inverse(this);\n    }\n\n    return ret;\n  });\n\n  instance.registerHelper('if', function (conditional, options) {\n    if (isFunction(conditional)) {\n      conditional = conditional.call(this);\n    }\n\n    // Default behavior is to render the positive path if the value is truthy and not empty.\n    // The `includeZero` option may be set to treat the condtional as purely not empty based on the\n    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.\n    if (!options.hash.includeZero && !conditional || Utils.isEmpty(conditional)) {\n      return options.inverse(this);\n    } else {\n      return options.fn(this);\n    }\n  });\n\n  instance.registerHelper('unless', function (conditional, options) {\n    return instance.helpers['if'].call(this, conditional, { fn: options.inverse, inverse: options.fn, hash: options.hash });\n  });\n\n  instance.registerHelper('with', function (context, options) {\n    if (isFunction(context)) {\n      context = context.call(this);\n    }\n\n    var fn = options.fn;\n\n    if (!Utils.isEmpty(context)) {\n      if (options.data && options.ids) {\n        var data = createFrame(options.data);\n        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);\n        options = { data: data };\n      }\n\n      return fn(context, options);\n    } else {\n      return options.inverse(this);\n    }\n  });\n\n  instance.registerHelper('log', function (message, options) {\n    var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;\n    instance.log(level, message);\n  });\n\n  instance.registerHelper('lookup', function (obj, field) {\n    return obj && obj[field];\n  });\n}\n\nvar logger = {\n  methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },\n\n  // State enum\n  DEBUG: 0,\n  INFO: 1,\n  WARN: 2,\n  ERROR: 3,\n  level: 1,\n\n  // Can be overridden in the host environment\n  log: function log(level, message) {\n    if (typeof console !== 'undefined' && logger.level <= level) {\n      var method = logger.methodMap[level];\n      (console[method] || console.log).call(console, message); // eslint-disable-line no-console\n    }\n  }\n};\n\nexports.logger = logger;\nvar log = logger.log;\n\nexports.log = log;\n\nfunction createFrame(object) {\n  var frame = Utils.extend({}, object);\n  frame._parent = object;\n  return frame;\n}\n\n/* [args, ]options */\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy9iYXNlLmpzPzc4ZWYiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH07XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLkhhbmRsZWJhcnNFbnZpcm9ubWVudCA9IEhhbmRsZWJhcnNFbnZpcm9ubWVudDtcbmV4cG9ydHMuY3JlYXRlRnJhbWUgPSBjcmVhdGVGcmFtZTtcblxudmFyIF9pbXBvcnQgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG5cbnZhciBVdGlscyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9pbXBvcnQpO1xuXG52YXIgX0V4Y2VwdGlvbiA9IHJlcXVpcmUoJy4vZXhjZXB0aW9uJyk7XG5cbnZhciBfRXhjZXB0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9FeGNlcHRpb24pO1xuXG52YXIgVkVSU0lPTiA9ICczLjAuMSc7XG5leHBvcnRzLlZFUlNJT04gPSBWRVJTSU9OO1xudmFyIENPTVBJTEVSX1JFVklTSU9OID0gNjtcblxuZXhwb3J0cy5DT01QSUxFUl9SRVZJU0lPTiA9IENPTVBJTEVSX1JFVklTSU9OO1xudmFyIFJFVklTSU9OX0NIQU5HRVMgPSB7XG4gIDE6ICc8PSAxLjAucmMuMicsIC8vIDEuMC5yYy4yIGlzIGFjdHVhbGx5IHJldjIgYnV0IGRvZXNuJ3QgcmVwb3J0IGl0XG4gIDI6ICc9PSAxLjAuMC1yYy4zJyxcbiAgMzogJz09IDEuMC4wLXJjLjQnLFxuICA0OiAnPT0gMS54LngnLFxuICA1OiAnPT0gMi4wLjAtYWxwaGEueCcsXG4gIDY6ICc+PSAyLjAuMC1iZXRhLjEnXG59O1xuXG5leHBvcnRzLlJFVklTSU9OX0NIQU5HRVMgPSBSRVZJU0lPTl9DSEFOR0VTO1xudmFyIGlzQXJyYXkgPSBVdGlscy5pc0FycmF5LFxuICAgIGlzRnVuY3Rpb24gPSBVdGlscy5pc0Z1bmN0aW9uLFxuICAgIHRvU3RyaW5nID0gVXRpbHMudG9TdHJpbmcsXG4gICAgb2JqZWN0VHlwZSA9ICdbb2JqZWN0IE9iamVjdF0nO1xuXG5mdW5jdGlvbiBIYW5kbGViYXJzRW52aXJvbm1lbnQoaGVscGVycywgcGFydGlhbHMpIHtcbiAgdGhpcy5oZWxwZXJzID0gaGVscGVycyB8fCB7fTtcbiAgdGhpcy5wYXJ0aWFscyA9IHBhcnRpYWxzIHx8IHt9O1xuXG4gIHJlZ2lzdGVyRGVmYXVsdEhlbHBlcnModGhpcyk7XG59XG5cbkhhbmRsZWJhcnNFbnZpcm9ubWVudC5wcm90b3R5cGUgPSB7XG4gIGNvbnN0cnVjdG9yOiBIYW5kbGViYXJzRW52aXJvbm1lbnQsXG5cbiAgbG9nZ2VyOiBsb2dnZXIsXG4gIGxvZzogbG9nLFxuXG4gIHJlZ2lzdGVySGVscGVyOiBmdW5jdGlvbiByZWdpc3RlckhlbHBlcihuYW1lLCBmbikge1xuICAgIGlmICh0b1N0cmluZy5jYWxsKG5hbWUpID09PSBvYmplY3RUeXBlKSB7XG4gICAgICBpZiAoZm4pIHtcbiAgICAgICAgdGhyb3cgbmV3IF9FeGNlcHRpb24yWydkZWZhdWx0J10oJ0FyZyBub3Qgc3VwcG9ydGVkIHdpdGggbXVsdGlwbGUgaGVscGVycycpO1xuICAgICAgfVxuICAgICAgVXRpbHMuZXh0ZW5kKHRoaXMuaGVscGVycywgbmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGVscGVyc1tuYW1lXSA9IGZuO1xuICAgIH1cbiAgfSxcbiAgdW5yZWdpc3RlckhlbHBlcjogZnVuY3Rpb24gdW5yZWdpc3RlckhlbHBlcihuYW1lKSB7XG4gICAgZGVsZXRlIHRoaXMuaGVscGVyc1tuYW1lXTtcbiAgfSxcblxuICByZWdpc3RlclBhcnRpYWw6IGZ1bmN0aW9uIHJlZ2lzdGVyUGFydGlhbChuYW1lLCBwYXJ0aWFsKSB7XG4gICAgaWYgKHRvU3RyaW5nLmNhbGwobmFtZSkgPT09IG9iamVjdFR5cGUpIHtcbiAgICAgIFV0aWxzLmV4dGVuZCh0aGlzLnBhcnRpYWxzLCBuYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHR5cGVvZiBwYXJ0aWFsID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aHJvdyBuZXcgX0V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnQXR0ZW1wdGluZyB0byByZWdpc3RlciBhIHBhcnRpYWwgYXMgdW5kZWZpbmVkJyk7XG4gICAgICB9XG4gICAgICB0aGlzLnBhcnRpYWxzW25hbWVdID0gcGFydGlhbDtcbiAgICB9XG4gIH0sXG4gIHVucmVnaXN0ZXJQYXJ0aWFsOiBmdW5jdGlvbiB1bnJlZ2lzdGVyUGFydGlhbChuYW1lKSB7XG4gICAgZGVsZXRlIHRoaXMucGFydGlhbHNbbmFtZV07XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyRGVmYXVsdEhlbHBlcnMoaW5zdGFuY2UpIHtcbiAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2hlbHBlck1pc3NpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgIC8vIEEgbWlzc2luZyBmaWVsZCBpbiBhIHt7Zm9vfX0gY29uc3R1Y3QuXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTb21lb25lIGlzIGFjdHVhbGx5IHRyeWluZyB0byBjYWxsIHNvbWV0aGluZywgYmxvdyB1cC5cbiAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdNaXNzaW5nIGhlbHBlcjogXCInICsgYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXS5uYW1lICsgJ1wiJyk7XG4gICAgfVxuICB9KTtcblxuICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignYmxvY2tIZWxwZXJNaXNzaW5nJywgZnVuY3Rpb24gKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICB2YXIgaW52ZXJzZSA9IG9wdGlvbnMuaW52ZXJzZSxcbiAgICAgICAgZm4gPSBvcHRpb25zLmZuO1xuXG4gICAgaWYgKGNvbnRleHQgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmbih0aGlzKTtcbiAgICB9IGVsc2UgaWYgKGNvbnRleHQgPT09IGZhbHNlIHx8IGNvbnRleHQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7XG4gICAgfSBlbHNlIGlmIChpc0FycmF5KGNvbnRleHQpKSB7XG4gICAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmlkcykge1xuICAgICAgICAgIG9wdGlvbnMuaWRzID0gW29wdGlvbnMubmFtZV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVycy5lYWNoKGNvbnRleHQsIG9wdGlvbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBjcmVhdGVGcmFtZShvcHRpb25zLmRhdGEpO1xuICAgICAgICBkYXRhLmNvbnRleHRQYXRoID0gVXRpbHMuYXBwZW5kQ29udGV4dFBhdGgob3B0aW9ucy5kYXRhLmNvbnRleHRQYXRoLCBvcHRpb25zLm5hbWUpO1xuICAgICAgICBvcHRpb25zID0geyBkYXRhOiBkYXRhIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmbihjb250ZXh0LCBvcHRpb25zKTtcbiAgICB9XG4gIH0pO1xuXG4gIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdlYWNoJywgZnVuY3Rpb24gKGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdNdXN0IHBhc3MgaXRlcmF0b3IgdG8gI2VhY2gnKTtcbiAgICB9XG5cbiAgICB2YXIgZm4gPSBvcHRpb25zLmZuLFxuICAgICAgICBpbnZlcnNlID0gb3B0aW9ucy5pbnZlcnNlLFxuICAgICAgICBpID0gMCxcbiAgICAgICAgcmV0ID0gJycsXG4gICAgICAgIGRhdGEgPSB1bmRlZmluZWQsXG4gICAgICAgIGNvbnRleHRQYXRoID0gdW5kZWZpbmVkO1xuXG4gICAgaWYgKG9wdGlvbnMuZGF0YSAmJiBvcHRpb25zLmlkcykge1xuICAgICAgY29udGV4dFBhdGggPSBVdGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMuaWRzWzBdKSArICcuJztcbiAgICB9XG5cbiAgICBpZiAoaXNGdW5jdGlvbihjb250ZXh0KSkge1xuICAgICAgY29udGV4dCA9IGNvbnRleHQuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5kYXRhKSB7XG4gICAgICBkYXRhID0gY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleGVjSXRlcmF0aW9uKGZpZWxkLCBpbmRleCwgbGFzdCkge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZGF0YS5rZXkgPSBmaWVsZDtcbiAgICAgICAgZGF0YS5pbmRleCA9IGluZGV4O1xuICAgICAgICBkYXRhLmZpcnN0ID0gaW5kZXggPT09IDA7XG4gICAgICAgIGRhdGEubGFzdCA9ICEhbGFzdDtcblxuICAgICAgICBpZiAoY29udGV4dFBhdGgpIHtcbiAgICAgICAgICBkYXRhLmNvbnRleHRQYXRoID0gY29udGV4dFBhdGggKyBmaWVsZDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXQgPSByZXQgKyBmbihjb250ZXh0W2ZpZWxkXSwge1xuICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICBibG9ja1BhcmFtczogVXRpbHMuYmxvY2tQYXJhbXMoW2NvbnRleHRbZmllbGRdLCBmaWVsZF0sIFtjb250ZXh0UGF0aCArIGZpZWxkLCBudWxsXSlcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0ID09PSAnb2JqZWN0Jykge1xuICAgICAgaWYgKGlzQXJyYXkoY29udGV4dCkpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IGNvbnRleHQubGVuZ3RoOyBpIDwgajsgaSsrKSB7XG4gICAgICAgICAgZXhlY0l0ZXJhdGlvbihpLCBpLCBpID09PSBjb250ZXh0Lmxlbmd0aCAtIDEpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcHJpb3JLZXkgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgZm9yICh2YXIga2V5IGluIGNvbnRleHQpIHtcbiAgICAgICAgICBpZiAoY29udGV4dC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAvLyBXZSdyZSBydW5uaW5nIHRoZSBpdGVyYXRpb25zIG9uZSBzdGVwIG91dCBvZiBzeW5jIHNvIHdlIGNhbiBkZXRlY3RcbiAgICAgICAgICAgIC8vIHRoZSBsYXN0IGl0ZXJhdGlvbiB3aXRob3V0IGhhdmUgdG8gc2NhbiB0aGUgb2JqZWN0IHR3aWNlIGFuZCBjcmVhdGVcbiAgICAgICAgICAgIC8vIGFuIGl0ZXJtZWRpYXRlIGtleXMgYXJyYXkuXG4gICAgICAgICAgICBpZiAocHJpb3JLZXkpIHtcbiAgICAgICAgICAgICAgZXhlY0l0ZXJhdGlvbihwcmlvcktleSwgaSAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJpb3JLZXkgPSBrZXk7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwcmlvcktleSkge1xuICAgICAgICAgIGV4ZWNJdGVyYXRpb24ocHJpb3JLZXksIGkgLSAxLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpID09PSAwKSB7XG4gICAgICByZXQgPSBpbnZlcnNlKHRoaXMpO1xuICAgIH1cblxuICAgIHJldHVybiByZXQ7XG4gIH0pO1xuXG4gIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdpZicsIGZ1bmN0aW9uIChjb25kaXRpb25hbCwgb3B0aW9ucykge1xuICAgIGlmIChpc0Z1bmN0aW9uKGNvbmRpdGlvbmFsKSkge1xuICAgICAgY29uZGl0aW9uYWwgPSBjb25kaXRpb25hbC5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgYmVoYXZpb3IgaXMgdG8gcmVuZGVyIHRoZSBwb3NpdGl2ZSBwYXRoIGlmIHRoZSB2YWx1ZSBpcyB0cnV0aHkgYW5kIG5vdCBlbXB0eS5cbiAgICAvLyBUaGUgYGluY2x1ZGVaZXJvYCBvcHRpb24gbWF5IGJlIHNldCB0byB0cmVhdCB0aGUgY29uZHRpb25hbCBhcyBwdXJlbHkgbm90IGVtcHR5IGJhc2VkIG9uIHRoZVxuICAgIC8vIGJlaGF2aW9yIG9mIGlzRW1wdHkuIEVmZmVjdGl2ZWx5IHRoaXMgZGV0ZXJtaW5lcyBpZiAwIGlzIGhhbmRsZWQgYnkgdGhlIHBvc2l0aXZlIHBhdGggb3IgbmVnYXRpdmUuXG4gICAgaWYgKCFvcHRpb25zLmhhc2guaW5jbHVkZVplcm8gJiYgIWNvbmRpdGlvbmFsIHx8IFV0aWxzLmlzRW1wdHkoY29uZGl0aW9uYWwpKSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5mbih0aGlzKTtcbiAgICB9XG4gIH0pO1xuXG4gIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCd1bmxlc3MnLCBmdW5jdGlvbiAoY29uZGl0aW9uYWwsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVyc1snaWYnXS5jYWxsKHRoaXMsIGNvbmRpdGlvbmFsLCB7IGZuOiBvcHRpb25zLmludmVyc2UsIGludmVyc2U6IG9wdGlvbnMuZm4sIGhhc2g6IG9wdGlvbnMuaGFzaCB9KTtcbiAgfSk7XG5cbiAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ3dpdGgnLCBmdW5jdGlvbiAoY29udGV4dCwgb3B0aW9ucykge1xuICAgIGlmIChpc0Z1bmN0aW9uKGNvbnRleHQpKSB7XG4gICAgICBjb250ZXh0ID0gY29udGV4dC5jYWxsKHRoaXMpO1xuICAgIH1cblxuICAgIHZhciBmbiA9IG9wdGlvbnMuZm47XG5cbiAgICBpZiAoIVV0aWxzLmlzRW1wdHkoY29udGV4dCkpIHtcbiAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBjcmVhdGVGcmFtZShvcHRpb25zLmRhdGEpO1xuICAgICAgICBkYXRhLmNvbnRleHRQYXRoID0gVXRpbHMuYXBwZW5kQ29udGV4dFBhdGgob3B0aW9ucy5kYXRhLmNvbnRleHRQYXRoLCBvcHRpb25zLmlkc1swXSk7XG4gICAgICAgIG9wdGlvbnMgPSB7IGRhdGE6IGRhdGEgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZuKGNvbnRleHQsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgIH1cbiAgfSk7XG5cbiAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2xvZycsIGZ1bmN0aW9uIChtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgdmFyIGxldmVsID0gb3B0aW9ucy5kYXRhICYmIG9wdGlvbnMuZGF0YS5sZXZlbCAhPSBudWxsID8gcGFyc2VJbnQob3B0aW9ucy5kYXRhLmxldmVsLCAxMCkgOiAxO1xuICAgIGluc3RhbmNlLmxvZyhsZXZlbCwgbWVzc2FnZSk7XG4gIH0pO1xuXG4gIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCdsb29rdXAnLCBmdW5jdGlvbiAob2JqLCBmaWVsZCkge1xuICAgIHJldHVybiBvYmogJiYgb2JqW2ZpZWxkXTtcbiAgfSk7XG59XG5cbnZhciBsb2dnZXIgPSB7XG4gIG1ldGhvZE1hcDogeyAwOiAnZGVidWcnLCAxOiAnaW5mbycsIDI6ICd3YXJuJywgMzogJ2Vycm9yJyB9LFxuXG4gIC8vIFN0YXRlIGVudW1cbiAgREVCVUc6IDAsXG4gIElORk86IDEsXG4gIFdBUk46IDIsXG4gIEVSUk9SOiAzLFxuICBsZXZlbDogMSxcblxuICAvLyBDYW4gYmUgb3ZlcnJpZGRlbiBpbiB0aGUgaG9zdCBlbnZpcm9ubWVudFxuICBsb2c6IGZ1bmN0aW9uIGxvZyhsZXZlbCwgbWVzc2FnZSkge1xuICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbG9nZ2VyLmxldmVsIDw9IGxldmVsKSB7XG4gICAgICB2YXIgbWV0aG9kID0gbG9nZ2VyLm1ldGhvZE1hcFtsZXZlbF07XG4gICAgICAoY29uc29sZVttZXRob2RdIHx8IGNvbnNvbGUubG9nKS5jYWxsKGNvbnNvbGUsIG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydHMubG9nZ2VyID0gbG9nZ2VyO1xudmFyIGxvZyA9IGxvZ2dlci5sb2c7XG5cbmV4cG9ydHMubG9nID0gbG9nO1xuXG5mdW5jdGlvbiBjcmVhdGVGcmFtZShvYmplY3QpIHtcbiAgdmFyIGZyYW1lID0gVXRpbHMuZXh0ZW5kKHt9LCBvYmplY3QpO1xuICBmcmFtZS5fcGFyZW50ID0gb2JqZWN0O1xuICByZXR1cm4gZnJhbWU7XG59XG5cbi8qIFthcmdzLCBdb3B0aW9ucyAqL1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9oYW5kbGViYXJzL2Rpc3QvY2pzL2hhbmRsZWJhcnMvYmFzZS5qc1xuLy8gbW9kdWxlIGlkID0gMzRcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 35 */
/***/ function(module, exports) {

	eval("'use strict';\n\nexports.__esModule = true;\nexports.extend = extend;\n\n// Older IE versions do not directly support indexOf so we must implement our own, sadly.\nexports.indexOf = indexOf;\nexports.escapeExpression = escapeExpression;\nexports.isEmpty = isEmpty;\nexports.blockParams = blockParams;\nexports.appendContextPath = appendContextPath;\nvar escape = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  '\\'': '&#x27;',\n  '`': '&#x60;'\n};\n\nvar badChars = /[&<>\"'`]/g,\n    possible = /[&<>\"'`]/;\n\nfunction escapeChar(chr) {\n  return escape[chr];\n}\n\nfunction extend(obj /* , ...source */) {\n  for (var i = 1; i < arguments.length; i++) {\n    for (var key in arguments[i]) {\n      if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {\n        obj[key] = arguments[i][key];\n      }\n    }\n  }\n\n  return obj;\n}\n\nvar toString = Object.prototype.toString;\n\nexports.toString = toString;\n// Sourced from lodash\n// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt\n/*eslint-disable func-style, no-var */\nvar isFunction = function isFunction(value) {\n  return typeof value === 'function';\n};\n// fallback for older versions of Chrome and Safari\n/* istanbul ignore next */\nif (isFunction(/x/)) {\n  exports.isFunction = isFunction = function (value) {\n    return typeof value === 'function' && toString.call(value) === '[object Function]';\n  };\n}\nvar isFunction;\nexports.isFunction = isFunction;\n/*eslint-enable func-style, no-var */\n\n/* istanbul ignore next */\nvar isArray = Array.isArray || function (value) {\n  return value && typeof value === 'object' ? toString.call(value) === '[object Array]' : false;\n};exports.isArray = isArray;\n\nfunction indexOf(array, value) {\n  for (var i = 0, len = array.length; i < len; i++) {\n    if (array[i] === value) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nfunction escapeExpression(string) {\n  if (typeof string !== 'string') {\n    // don't escape SafeStrings, since they're already safe\n    if (string && string.toHTML) {\n      return string.toHTML();\n    } else if (string == null) {\n      return '';\n    } else if (!string) {\n      return string + '';\n    }\n\n    // Force a string conversion as this will be done by the append regardless and\n    // the regex test will do this transparently behind the scenes, causing issues if\n    // an object's to string has escaped characters in it.\n    string = '' + string;\n  }\n\n  if (!possible.test(string)) {\n    return string;\n  }\n  return string.replace(badChars, escapeChar);\n}\n\nfunction isEmpty(value) {\n  if (!value && value !== 0) {\n    return true;\n  } else if (isArray(value) && value.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction blockParams(params, ids) {\n  params.path = ids;\n  return params;\n}\n\nfunction appendContextPath(contextPath, id) {\n  return (contextPath ? contextPath + '.' : '') + id;\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy91dGlscy5qcz8yMzQ5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZXh0ZW5kID0gZXh0ZW5kO1xuXG4vLyBPbGRlciBJRSB2ZXJzaW9ucyBkbyBub3QgZGlyZWN0bHkgc3VwcG9ydCBpbmRleE9mIHNvIHdlIG11c3QgaW1wbGVtZW50IG91ciBvd24sIHNhZGx5LlxuZXhwb3J0cy5pbmRleE9mID0gaW5kZXhPZjtcbmV4cG9ydHMuZXNjYXBlRXhwcmVzc2lvbiA9IGVzY2FwZUV4cHJlc3Npb247XG5leHBvcnRzLmlzRW1wdHkgPSBpc0VtcHR5O1xuZXhwb3J0cy5ibG9ja1BhcmFtcyA9IGJsb2NrUGFyYW1zO1xuZXhwb3J0cy5hcHBlbmRDb250ZXh0UGF0aCA9IGFwcGVuZENvbnRleHRQYXRoO1xudmFyIGVzY2FwZSA9IHtcbiAgJyYnOiAnJmFtcDsnLFxuICAnPCc6ICcmbHQ7JyxcbiAgJz4nOiAnJmd0OycsXG4gICdcIic6ICcmcXVvdDsnLFxuICAnXFwnJzogJyYjeDI3OycsXG4gICdgJzogJyYjeDYwOydcbn07XG5cbnZhciBiYWRDaGFycyA9IC9bJjw+XCInYF0vZyxcbiAgICBwb3NzaWJsZSA9IC9bJjw+XCInYF0vO1xuXG5mdW5jdGlvbiBlc2NhcGVDaGFyKGNocikge1xuICByZXR1cm4gZXNjYXBlW2Nocl07XG59XG5cbmZ1bmN0aW9uIGV4dGVuZChvYmogLyogLCAuLi5zb3VyY2UgKi8pIHtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGFyZ3VtZW50c1tpXSwga2V5KSkge1xuICAgICAgICBvYmpba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvYmo7XG59XG5cbnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7XG5cbmV4cG9ydHMudG9TdHJpbmcgPSB0b1N0cmluZztcbi8vIFNvdXJjZWQgZnJvbSBsb2Rhc2hcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iZXN0aWVqcy9sb2Rhc2gvYmxvYi9tYXN0ZXIvTElDRU5TRS50eHRcbi8qZXNsaW50LWRpc2FibGUgZnVuYy1zdHlsZSwgbm8tdmFyICovXG52YXIgaXNGdW5jdGlvbiA9IGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJztcbn07XG4vLyBmYWxsYmFjayBmb3Igb2xkZXIgdmVyc2lvbnMgb2YgQ2hyb21lIGFuZCBTYWZhcmlcbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG5pZiAoaXNGdW5jdGlvbigveC8pKSB7XG4gIGV4cG9ydHMuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb24gPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmIHRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICB9O1xufVxudmFyIGlzRnVuY3Rpb247XG5leHBvcnRzLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uO1xuLyplc2xpbnQtZW5hYmxlIGZ1bmMtc3R5bGUsIG5vLXZhciAqL1xuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xudmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyA/IHRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nIDogZmFsc2U7XG59O2V4cG9ydHMuaXNBcnJheSA9IGlzQXJyYXk7XG5cbmZ1bmN0aW9uIGluZGV4T2YoYXJyYXksIHZhbHVlKSB7XG4gIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGlmIChhcnJheVtpXSA9PT0gdmFsdWUpIHtcbiAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gLTE7XG59XG5cbmZ1bmN0aW9uIGVzY2FwZUV4cHJlc3Npb24oc3RyaW5nKSB7XG4gIGlmICh0eXBlb2Ygc3RyaW5nICE9PSAnc3RyaW5nJykge1xuICAgIC8vIGRvbid0IGVzY2FwZSBTYWZlU3RyaW5ncywgc2luY2UgdGhleSdyZSBhbHJlYWR5IHNhZmVcbiAgICBpZiAoc3RyaW5nICYmIHN0cmluZy50b0hUTUwpIHtcbiAgICAgIHJldHVybiBzdHJpbmcudG9IVE1MKCk7XG4gICAgfSBlbHNlIGlmIChzdHJpbmcgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH0gZWxzZSBpZiAoIXN0cmluZykge1xuICAgICAgcmV0dXJuIHN0cmluZyArICcnO1xuICAgIH1cblxuICAgIC8vIEZvcmNlIGEgc3RyaW5nIGNvbnZlcnNpb24gYXMgdGhpcyB3aWxsIGJlIGRvbmUgYnkgdGhlIGFwcGVuZCByZWdhcmRsZXNzIGFuZFxuICAgIC8vIHRoZSByZWdleCB0ZXN0IHdpbGwgZG8gdGhpcyB0cmFuc3BhcmVudGx5IGJlaGluZCB0aGUgc2NlbmVzLCBjYXVzaW5nIGlzc3VlcyBpZlxuICAgIC8vIGFuIG9iamVjdCdzIHRvIHN0cmluZyBoYXMgZXNjYXBlZCBjaGFyYWN0ZXJzIGluIGl0LlxuICAgIHN0cmluZyA9ICcnICsgc3RyaW5nO1xuICB9XG5cbiAgaWYgKCFwb3NzaWJsZS50ZXN0KHN0cmluZykpIHtcbiAgICByZXR1cm4gc3RyaW5nO1xuICB9XG4gIHJldHVybiBzdHJpbmcucmVwbGFjZShiYWRDaGFycywgZXNjYXBlQ2hhcik7XG59XG5cbmZ1bmN0aW9uIGlzRW1wdHkodmFsdWUpIHtcbiAgaWYgKCF2YWx1ZSAmJiB2YWx1ZSAhPT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBibG9ja1BhcmFtcyhwYXJhbXMsIGlkcykge1xuICBwYXJhbXMucGF0aCA9IGlkcztcbiAgcmV0dXJuIHBhcmFtcztcbn1cblxuZnVuY3Rpb24gYXBwZW5kQ29udGV4dFBhdGgoY29udGV4dFBhdGgsIGlkKSB7XG4gIHJldHVybiAoY29udGV4dFBhdGggPyBjb250ZXh0UGF0aCArICcuJyA6ICcnKSArIGlkO1xufVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9oYW5kbGViYXJzL2Rpc3QvY2pzL2hhbmRsZWJhcnMvdXRpbHMuanNcbi8vIG1vZHVsZSBpZCA9IDM1XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 36 */
/***/ function(module, exports) {

	eval("'use strict';\n\nexports.__esModule = true;\n\nvar errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];\n\nfunction Exception(message, node) {\n  var loc = node && node.loc,\n      line = undefined,\n      column = undefined;\n  if (loc) {\n    line = loc.start.line;\n    column = loc.start.column;\n\n    message += ' - ' + line + ':' + column;\n  }\n\n  var tmp = Error.prototype.constructor.call(this, message);\n\n  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.\n  for (var idx = 0; idx < errorProps.length; idx++) {\n    this[errorProps[idx]] = tmp[errorProps[idx]];\n  }\n\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, Exception);\n  }\n\n  if (loc) {\n    this.lineNumber = line;\n    this.column = column;\n  }\n}\n\nException.prototype = new Error();\n\nexports['default'] = Exception;\nmodule.exports = exports['default'];//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy9leGNlcHRpb24uanM/YmRkNSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbnZhciBlcnJvclByb3BzID0gWydkZXNjcmlwdGlvbicsICdmaWxlTmFtZScsICdsaW5lTnVtYmVyJywgJ21lc3NhZ2UnLCAnbmFtZScsICdudW1iZXInLCAnc3RhY2snXTtcblxuZnVuY3Rpb24gRXhjZXB0aW9uKG1lc3NhZ2UsIG5vZGUpIHtcbiAgdmFyIGxvYyA9IG5vZGUgJiYgbm9kZS5sb2MsXG4gICAgICBsaW5lID0gdW5kZWZpbmVkLFxuICAgICAgY29sdW1uID0gdW5kZWZpbmVkO1xuICBpZiAobG9jKSB7XG4gICAgbGluZSA9IGxvYy5zdGFydC5saW5lO1xuICAgIGNvbHVtbiA9IGxvYy5zdGFydC5jb2x1bW47XG5cbiAgICBtZXNzYWdlICs9ICcgLSAnICsgbGluZSArICc6JyArIGNvbHVtbjtcbiAgfVxuXG4gIHZhciB0bXAgPSBFcnJvci5wcm90b3R5cGUuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBtZXNzYWdlKTtcblxuICAvLyBVbmZvcnR1bmF0ZWx5IGVycm9ycyBhcmUgbm90IGVudW1lcmFibGUgaW4gQ2hyb21lIChhdCBsZWFzdCksIHNvIGBmb3IgcHJvcCBpbiB0bXBgIGRvZXNuJ3Qgd29yay5cbiAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgZXJyb3JQcm9wcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgdGhpc1tlcnJvclByb3BzW2lkeF1dID0gdG1wW2Vycm9yUHJvcHNbaWR4XV07XG4gIH1cblxuICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBFeGNlcHRpb24pO1xuICB9XG5cbiAgaWYgKGxvYykge1xuICAgIHRoaXMubGluZU51bWJlciA9IGxpbmU7XG4gICAgdGhpcy5jb2x1bW4gPSBjb2x1bW47XG4gIH1cbn1cblxuRXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpO1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBFeGNlcHRpb247XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vaGFuZGxlYmFycy9kaXN0L2Nqcy9oYW5kbGViYXJzL2V4Y2VwdGlvbi5qc1xuLy8gbW9kdWxlIGlkID0gMzZcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 37 */
/***/ function(module, exports) {

	eval("'use strict';\n\nexports.__esModule = true;\n// Build out our basic SafeString type\nfunction SafeString(string) {\n  this.string = string;\n}\n\nSafeString.prototype.toString = SafeString.prototype.toHTML = function () {\n  return '' + this.string;\n};\n\nexports['default'] = SafeString;\nmodule.exports = exports['default'];//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy9zYWZlLXN0cmluZy5qcz9kNjY3Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbi8vIEJ1aWxkIG91dCBvdXIgYmFzaWMgU2FmZVN0cmluZyB0eXBlXG5mdW5jdGlvbiBTYWZlU3RyaW5nKHN0cmluZykge1xuICB0aGlzLnN0cmluZyA9IHN0cmluZztcbn1cblxuU2FmZVN0cmluZy5wcm90b3R5cGUudG9TdHJpbmcgPSBTYWZlU3RyaW5nLnByb3RvdHlwZS50b0hUTUwgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAnJyArIHRoaXMuc3RyaW5nO1xufTtcblxuZXhwb3J0c1snZGVmYXVsdCddID0gU2FmZVN0cmluZztcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9oYW5kbGViYXJzL2Rpc3QvY2pzL2hhbmRsZWJhcnMvc2FmZS1zdHJpbmcuanNcbi8vIG1vZHVsZSBpZCA9IDM3XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 38 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar _interopRequireWildcard = function (obj) { return obj && obj.__esModule ? obj : { 'default': obj }; };\n\nexports.__esModule = true;\nexports.checkRevision = checkRevision;\n\n// TODO: Remove this line and break up compilePartial\n\nexports.template = template;\nexports.wrapProgram = wrapProgram;\nexports.resolvePartial = resolvePartial;\nexports.invokePartial = invokePartial;\nexports.noop = noop;\n\nvar _import = __webpack_require__(35);\n\nvar Utils = _interopRequireWildcard(_import);\n\nvar _Exception = __webpack_require__(36);\n\nvar _Exception2 = _interopRequireWildcard(_Exception);\n\nvar _COMPILER_REVISION$REVISION_CHANGES$createFrame = __webpack_require__(34);\n\nfunction checkRevision(compilerInfo) {\n  var compilerRevision = compilerInfo && compilerInfo[0] || 1,\n      currentRevision = _COMPILER_REVISION$REVISION_CHANGES$createFrame.COMPILER_REVISION;\n\n  if (compilerRevision !== currentRevision) {\n    if (compilerRevision < currentRevision) {\n      var runtimeVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[currentRevision],\n          compilerVersions = _COMPILER_REVISION$REVISION_CHANGES$createFrame.REVISION_CHANGES[compilerRevision];\n      throw new _Exception2['default']('Template was precompiled with an older version of Handlebars than the current runtime. ' + 'Please update your precompiler to a newer version (' + runtimeVersions + ') or downgrade your runtime to an older version (' + compilerVersions + ').');\n    } else {\n      // Use the embedded version info since the runtime doesn't know about this revision yet\n      throw new _Exception2['default']('Template was precompiled with a newer version of Handlebars than the current runtime. ' + 'Please update your runtime to a newer version (' + compilerInfo[1] + ').');\n    }\n  }\n}\n\nfunction template(templateSpec, env) {\n  /* istanbul ignore next */\n  if (!env) {\n    throw new _Exception2['default']('No environment passed to template');\n  }\n  if (!templateSpec || !templateSpec.main) {\n    throw new _Exception2['default']('Unknown template object: ' + typeof templateSpec);\n  }\n\n  // Note: Using env.VM references rather than local var references throughout this section to allow\n  // for external users to override these as psuedo-supported APIs.\n  env.VM.checkRevision(templateSpec.compiler);\n\n  function invokePartialWrapper(partial, context, options) {\n    if (options.hash) {\n      context = Utils.extend({}, context, options.hash);\n    }\n\n    partial = env.VM.resolvePartial.call(this, partial, context, options);\n    var result = env.VM.invokePartial.call(this, partial, context, options);\n\n    if (result == null && env.compile) {\n      options.partials[options.name] = env.compile(partial, templateSpec.compilerOptions, env);\n      result = options.partials[options.name](context, options);\n    }\n    if (result != null) {\n      if (options.indent) {\n        var lines = result.split('\\n');\n        for (var i = 0, l = lines.length; i < l; i++) {\n          if (!lines[i] && i + 1 === l) {\n            break;\n          }\n\n          lines[i] = options.indent + lines[i];\n        }\n        result = lines.join('\\n');\n      }\n      return result;\n    } else {\n      throw new _Exception2['default']('The partial ' + options.name + ' could not be compiled when running in runtime-only mode');\n    }\n  }\n\n  // Just add water\n  var container = {\n    strict: function strict(obj, name) {\n      if (!(name in obj)) {\n        throw new _Exception2['default']('\"' + name + '\" not defined in ' + obj);\n      }\n      return obj[name];\n    },\n    lookup: function lookup(depths, name) {\n      var len = depths.length;\n      for (var i = 0; i < len; i++) {\n        if (depths[i] && depths[i][name] != null) {\n          return depths[i][name];\n        }\n      }\n    },\n    lambda: function lambda(current, context) {\n      return typeof current === 'function' ? current.call(context) : current;\n    },\n\n    escapeExpression: Utils.escapeExpression,\n    invokePartial: invokePartialWrapper,\n\n    fn: function fn(i) {\n      return templateSpec[i];\n    },\n\n    programs: [],\n    program: function program(i, data, declaredBlockParams, blockParams, depths) {\n      var programWrapper = this.programs[i],\n          fn = this.fn(i);\n      if (data || depths || blockParams || declaredBlockParams) {\n        programWrapper = wrapProgram(this, i, fn, data, declaredBlockParams, blockParams, depths);\n      } else if (!programWrapper) {\n        programWrapper = this.programs[i] = wrapProgram(this, i, fn);\n      }\n      return programWrapper;\n    },\n\n    data: function data(value, depth) {\n      while (value && depth--) {\n        value = value._parent;\n      }\n      return value;\n    },\n    merge: function merge(param, common) {\n      var obj = param || common;\n\n      if (param && common && param !== common) {\n        obj = Utils.extend({}, common, param);\n      }\n\n      return obj;\n    },\n\n    noop: env.VM.noop,\n    compilerInfo: templateSpec.compiler\n  };\n\n  function ret(context) {\n    var options = arguments[1] === undefined ? {} : arguments[1];\n\n    var data = options.data;\n\n    ret._setup(options);\n    if (!options.partial && templateSpec.useData) {\n      data = initData(context, data);\n    }\n    var depths = undefined,\n        blockParams = templateSpec.useBlockParams ? [] : undefined;\n    if (templateSpec.useDepths) {\n      depths = options.depths ? [context].concat(options.depths) : [context];\n    }\n\n    return templateSpec.main.call(container, context, container.helpers, container.partials, data, blockParams, depths);\n  }\n  ret.isTop = true;\n\n  ret._setup = function (options) {\n    if (!options.partial) {\n      container.helpers = container.merge(options.helpers, env.helpers);\n\n      if (templateSpec.usePartial) {\n        container.partials = container.merge(options.partials, env.partials);\n      }\n    } else {\n      container.helpers = options.helpers;\n      container.partials = options.partials;\n    }\n  };\n\n  ret._child = function (i, data, blockParams, depths) {\n    if (templateSpec.useBlockParams && !blockParams) {\n      throw new _Exception2['default']('must pass block params');\n    }\n    if (templateSpec.useDepths && !depths) {\n      throw new _Exception2['default']('must pass parent depths');\n    }\n\n    return wrapProgram(container, i, templateSpec[i], data, 0, blockParams, depths);\n  };\n  return ret;\n}\n\nfunction wrapProgram(container, i, fn, data, declaredBlockParams, blockParams, depths) {\n  function prog(context) {\n    var options = arguments[1] === undefined ? {} : arguments[1];\n\n    return fn.call(container, context, container.helpers, container.partials, options.data || data, blockParams && [options.blockParams].concat(blockParams), depths && [context].concat(depths));\n  }\n  prog.program = i;\n  prog.depth = depths ? depths.length : 0;\n  prog.blockParams = declaredBlockParams || 0;\n  return prog;\n}\n\nfunction resolvePartial(partial, context, options) {\n  if (!partial) {\n    partial = options.partials[options.name];\n  } else if (!partial.call && !options.name) {\n    // This is a dynamic partial that returned a string\n    options.name = partial;\n    partial = options.partials[partial];\n  }\n  return partial;\n}\n\nfunction invokePartial(partial, context, options) {\n  options.partial = true;\n\n  if (partial === undefined) {\n    throw new _Exception2['default']('The partial ' + options.name + ' could not be found');\n  } else if (partial instanceof Function) {\n    return partial(context, options);\n  }\n}\n\nfunction noop() {\n  return '';\n}\n\nfunction initData(context, data) {\n  if (!data || !('root' in data)) {\n    data = data ? _COMPILER_REVISION$REVISION_CHANGES$createFrame.createFrame(data) : {};\n    data.root = context;\n  }\n  return data;\n}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy9ydW50aW1lLmpzPzZhMjQiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH07XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmNoZWNrUmV2aXNpb24gPSBjaGVja1JldmlzaW9uO1xuXG4vLyBUT0RPOiBSZW1vdmUgdGhpcyBsaW5lIGFuZCBicmVhayB1cCBjb21waWxlUGFydGlhbFxuXG5leHBvcnRzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG5leHBvcnRzLndyYXBQcm9ncmFtID0gd3JhcFByb2dyYW07XG5leHBvcnRzLnJlc29sdmVQYXJ0aWFsID0gcmVzb2x2ZVBhcnRpYWw7XG5leHBvcnRzLmludm9rZVBhcnRpYWwgPSBpbnZva2VQYXJ0aWFsO1xuZXhwb3J0cy5ub29wID0gbm9vcDtcblxudmFyIF9pbXBvcnQgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG5cbnZhciBVdGlscyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9pbXBvcnQpO1xuXG52YXIgX0V4Y2VwdGlvbiA9IHJlcXVpcmUoJy4vZXhjZXB0aW9uJyk7XG5cbnZhciBfRXhjZXB0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKF9FeGNlcHRpb24pO1xuXG52YXIgX0NPTVBJTEVSX1JFVklTSU9OJFJFVklTSU9OX0NIQU5HRVMkY3JlYXRlRnJhbWUgPSByZXF1aXJlKCcuL2Jhc2UnKTtcblxuZnVuY3Rpb24gY2hlY2tSZXZpc2lvbihjb21waWxlckluZm8pIHtcbiAgdmFyIGNvbXBpbGVyUmV2aXNpb24gPSBjb21waWxlckluZm8gJiYgY29tcGlsZXJJbmZvWzBdIHx8IDEsXG4gICAgICBjdXJyZW50UmV2aXNpb24gPSBfQ09NUElMRVJfUkVWSVNJT04kUkVWSVNJT05fQ0hBTkdFUyRjcmVhdGVGcmFtZS5DT01QSUxFUl9SRVZJU0lPTjtcblxuICBpZiAoY29tcGlsZXJSZXZpc2lvbiAhPT0gY3VycmVudFJldmlzaW9uKSB7XG4gICAgaWYgKGNvbXBpbGVyUmV2aXNpb24gPCBjdXJyZW50UmV2aXNpb24pIHtcbiAgICAgIHZhciBydW50aW1lVmVyc2lvbnMgPSBfQ09NUElMRVJfUkVWSVNJT04kUkVWSVNJT05fQ0hBTkdFUyRjcmVhdGVGcmFtZS5SRVZJU0lPTl9DSEFOR0VTW2N1cnJlbnRSZXZpc2lvbl0sXG4gICAgICAgICAgY29tcGlsZXJWZXJzaW9ucyA9IF9DT01QSUxFUl9SRVZJU0lPTiRSRVZJU0lPTl9DSEFOR0VTJGNyZWF0ZUZyYW1lLlJFVklTSU9OX0NIQU5HRVNbY29tcGlsZXJSZXZpc2lvbl07XG4gICAgICB0aHJvdyBuZXcgX0V4Y2VwdGlvbjJbJ2RlZmF1bHQnXSgnVGVtcGxhdGUgd2FzIHByZWNvbXBpbGVkIHdpdGggYW4gb2xkZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gJyArICdQbGVhc2UgdXBkYXRlIHlvdXIgcHJlY29tcGlsZXIgdG8gYSBuZXdlciB2ZXJzaW9uICgnICsgcnVudGltZVZlcnNpb25zICsgJykgb3IgZG93bmdyYWRlIHlvdXIgcnVudGltZSB0byBhbiBvbGRlciB2ZXJzaW9uICgnICsgY29tcGlsZXJWZXJzaW9ucyArICcpLicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBVc2UgdGhlIGVtYmVkZGVkIHZlcnNpb24gaW5mbyBzaW5jZSB0aGUgcnVudGltZSBkb2Vzbid0IGtub3cgYWJvdXQgdGhpcyByZXZpc2lvbiB5ZXRcbiAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdUZW1wbGF0ZSB3YXMgcHJlY29tcGlsZWQgd2l0aCBhIG5ld2VyIHZlcnNpb24gb2YgSGFuZGxlYmFycyB0aGFuIHRoZSBjdXJyZW50IHJ1bnRpbWUuICcgKyAnUGxlYXNlIHVwZGF0ZSB5b3VyIHJ1bnRpbWUgdG8gYSBuZXdlciB2ZXJzaW9uICgnICsgY29tcGlsZXJJbmZvWzFdICsgJykuJyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHRlbXBsYXRlKHRlbXBsYXRlU3BlYywgZW52KSB7XG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gIGlmICghZW52KSB7XG4gICAgdGhyb3cgbmV3IF9FeGNlcHRpb24yWydkZWZhdWx0J10oJ05vIGVudmlyb25tZW50IHBhc3NlZCB0byB0ZW1wbGF0ZScpO1xuICB9XG4gIGlmICghdGVtcGxhdGVTcGVjIHx8ICF0ZW1wbGF0ZVNwZWMubWFpbikge1xuICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdVbmtub3duIHRlbXBsYXRlIG9iamVjdDogJyArIHR5cGVvZiB0ZW1wbGF0ZVNwZWMpO1xuICB9XG5cbiAgLy8gTm90ZTogVXNpbmcgZW52LlZNIHJlZmVyZW5jZXMgcmF0aGVyIHRoYW4gbG9jYWwgdmFyIHJlZmVyZW5jZXMgdGhyb3VnaG91dCB0aGlzIHNlY3Rpb24gdG8gYWxsb3dcbiAgLy8gZm9yIGV4dGVybmFsIHVzZXJzIHRvIG92ZXJyaWRlIHRoZXNlIGFzIHBzdWVkby1zdXBwb3J0ZWQgQVBJcy5cbiAgZW52LlZNLmNoZWNrUmV2aXNpb24odGVtcGxhdGVTcGVjLmNvbXBpbGVyKTtcblxuICBmdW5jdGlvbiBpbnZva2VQYXJ0aWFsV3JhcHBlcihwYXJ0aWFsLCBjb250ZXh0LCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMuaGFzaCkge1xuICAgICAgY29udGV4dCA9IFV0aWxzLmV4dGVuZCh7fSwgY29udGV4dCwgb3B0aW9ucy5oYXNoKTtcbiAgICB9XG5cbiAgICBwYXJ0aWFsID0gZW52LlZNLnJlc29sdmVQYXJ0aWFsLmNhbGwodGhpcywgcGFydGlhbCwgY29udGV4dCwgb3B0aW9ucyk7XG4gICAgdmFyIHJlc3VsdCA9IGVudi5WTS5pbnZva2VQYXJ0aWFsLmNhbGwodGhpcywgcGFydGlhbCwgY29udGV4dCwgb3B0aW9ucyk7XG5cbiAgICBpZiAocmVzdWx0ID09IG51bGwgJiYgZW52LmNvbXBpbGUpIHtcbiAgICAgIG9wdGlvbnMucGFydGlhbHNbb3B0aW9ucy5uYW1lXSA9IGVudi5jb21waWxlKHBhcnRpYWwsIHRlbXBsYXRlU3BlYy5jb21waWxlck9wdGlvbnMsIGVudik7XG4gICAgICByZXN1bHQgPSBvcHRpb25zLnBhcnRpYWxzW29wdGlvbnMubmFtZV0oY29udGV4dCwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQgIT0gbnVsbCkge1xuICAgICAgaWYgKG9wdGlvbnMuaW5kZW50KSB7XG4gICAgICAgIHZhciBsaW5lcyA9IHJlc3VsdC5zcGxpdCgnXFxuJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGluZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgaWYgKCFsaW5lc1tpXSAmJiBpICsgMSA9PT0gbCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGluZXNbaV0gPSBvcHRpb25zLmluZGVudCArIGxpbmVzW2ldO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdCA9IGxpbmVzLmpvaW4oJ1xcbicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IF9FeGNlcHRpb24yWydkZWZhdWx0J10oJ1RoZSBwYXJ0aWFsICcgKyBvcHRpb25zLm5hbWUgKyAnIGNvdWxkIG5vdCBiZSBjb21waWxlZCB3aGVuIHJ1bm5pbmcgaW4gcnVudGltZS1vbmx5IG1vZGUnKTtcbiAgICB9XG4gIH1cblxuICAvLyBKdXN0IGFkZCB3YXRlclxuICB2YXIgY29udGFpbmVyID0ge1xuICAgIHN0cmljdDogZnVuY3Rpb24gc3RyaWN0KG9iaiwgbmFtZSkge1xuICAgICAgaWYgKCEobmFtZSBpbiBvYmopKSB7XG4gICAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdcIicgKyBuYW1lICsgJ1wiIG5vdCBkZWZpbmVkIGluICcgKyBvYmopO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9ialtuYW1lXTtcbiAgICB9LFxuICAgIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKGRlcHRocywgbmFtZSkge1xuICAgICAgdmFyIGxlbiA9IGRlcHRocy5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChkZXB0aHNbaV0gJiYgZGVwdGhzW2ldW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gZGVwdGhzW2ldW25hbWVdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBsYW1iZGE6IGZ1bmN0aW9uIGxhbWJkYShjdXJyZW50LCBjb250ZXh0KSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicgPyBjdXJyZW50LmNhbGwoY29udGV4dCkgOiBjdXJyZW50O1xuICAgIH0sXG5cbiAgICBlc2NhcGVFeHByZXNzaW9uOiBVdGlscy5lc2NhcGVFeHByZXNzaW9uLFxuICAgIGludm9rZVBhcnRpYWw6IGludm9rZVBhcnRpYWxXcmFwcGVyLFxuXG4gICAgZm46IGZ1bmN0aW9uIGZuKGkpIHtcbiAgICAgIHJldHVybiB0ZW1wbGF0ZVNwZWNbaV07XG4gICAgfSxcblxuICAgIHByb2dyYW1zOiBbXSxcbiAgICBwcm9ncmFtOiBmdW5jdGlvbiBwcm9ncmFtKGksIGRhdGEsIGRlY2xhcmVkQmxvY2tQYXJhbXMsIGJsb2NrUGFyYW1zLCBkZXB0aHMpIHtcbiAgICAgIHZhciBwcm9ncmFtV3JhcHBlciA9IHRoaXMucHJvZ3JhbXNbaV0sXG4gICAgICAgICAgZm4gPSB0aGlzLmZuKGkpO1xuICAgICAgaWYgKGRhdGEgfHwgZGVwdGhzIHx8IGJsb2NrUGFyYW1zIHx8IGRlY2xhcmVkQmxvY2tQYXJhbXMpIHtcbiAgICAgICAgcHJvZ3JhbVdyYXBwZXIgPSB3cmFwUHJvZ3JhbSh0aGlzLCBpLCBmbiwgZGF0YSwgZGVjbGFyZWRCbG9ja1BhcmFtcywgYmxvY2tQYXJhbXMsIGRlcHRocyk7XG4gICAgICB9IGVsc2UgaWYgKCFwcm9ncmFtV3JhcHBlcikge1xuICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHRoaXMucHJvZ3JhbXNbaV0gPSB3cmFwUHJvZ3JhbSh0aGlzLCBpLCBmbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvZ3JhbVdyYXBwZXI7XG4gICAgfSxcblxuICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEodmFsdWUsIGRlcHRoKSB7XG4gICAgICB3aGlsZSAodmFsdWUgJiYgZGVwdGgtLSkge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLl9wYXJlbnQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSxcbiAgICBtZXJnZTogZnVuY3Rpb24gbWVyZ2UocGFyYW0sIGNvbW1vbikge1xuICAgICAgdmFyIG9iaiA9IHBhcmFtIHx8IGNvbW1vbjtcblxuICAgICAgaWYgKHBhcmFtICYmIGNvbW1vbiAmJiBwYXJhbSAhPT0gY29tbW9uKSB7XG4gICAgICAgIG9iaiA9IFV0aWxzLmV4dGVuZCh7fSwgY29tbW9uLCBwYXJhbSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcblxuICAgIG5vb3A6IGVudi5WTS5ub29wLFxuICAgIGNvbXBpbGVySW5mbzogdGVtcGxhdGVTcGVjLmNvbXBpbGVyXG4gIH07XG5cbiAgZnVuY3Rpb24gcmV0KGNvbnRleHQpIHtcbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMV07XG5cbiAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YTtcblxuICAgIHJldC5fc2V0dXAob3B0aW9ucyk7XG4gICAgaWYgKCFvcHRpb25zLnBhcnRpYWwgJiYgdGVtcGxhdGVTcGVjLnVzZURhdGEpIHtcbiAgICAgIGRhdGEgPSBpbml0RGF0YShjb250ZXh0LCBkYXRhKTtcbiAgICB9XG4gICAgdmFyIGRlcHRocyA9IHVuZGVmaW5lZCxcbiAgICAgICAgYmxvY2tQYXJhbXMgPSB0ZW1wbGF0ZVNwZWMudXNlQmxvY2tQYXJhbXMgPyBbXSA6IHVuZGVmaW5lZDtcbiAgICBpZiAodGVtcGxhdGVTcGVjLnVzZURlcHRocykge1xuICAgICAgZGVwdGhzID0gb3B0aW9ucy5kZXB0aHMgPyBbY29udGV4dF0uY29uY2F0KG9wdGlvbnMuZGVwdGhzKSA6IFtjb250ZXh0XTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGVtcGxhdGVTcGVjLm1haW4uY2FsbChjb250YWluZXIsIGNvbnRleHQsIGNvbnRhaW5lci5oZWxwZXJzLCBjb250YWluZXIucGFydGlhbHMsIGRhdGEsIGJsb2NrUGFyYW1zLCBkZXB0aHMpO1xuICB9XG4gIHJldC5pc1RvcCA9IHRydWU7XG5cbiAgcmV0Ll9zZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLnBhcnRpYWwpIHtcbiAgICAgIGNvbnRhaW5lci5oZWxwZXJzID0gY29udGFpbmVyLm1lcmdlKG9wdGlvbnMuaGVscGVycywgZW52LmhlbHBlcnMpO1xuXG4gICAgICBpZiAodGVtcGxhdGVTcGVjLnVzZVBhcnRpYWwpIHtcbiAgICAgICAgY29udGFpbmVyLnBhcnRpYWxzID0gY29udGFpbmVyLm1lcmdlKG9wdGlvbnMucGFydGlhbHMsIGVudi5wYXJ0aWFscyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRhaW5lci5oZWxwZXJzID0gb3B0aW9ucy5oZWxwZXJzO1xuICAgICAgY29udGFpbmVyLnBhcnRpYWxzID0gb3B0aW9ucy5wYXJ0aWFscztcbiAgICB9XG4gIH07XG5cbiAgcmV0Ll9jaGlsZCA9IGZ1bmN0aW9uIChpLCBkYXRhLCBibG9ja1BhcmFtcywgZGVwdGhzKSB7XG4gICAgaWYgKHRlbXBsYXRlU3BlYy51c2VCbG9ja1BhcmFtcyAmJiAhYmxvY2tQYXJhbXMpIHtcbiAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdtdXN0IHBhc3MgYmxvY2sgcGFyYW1zJyk7XG4gICAgfVxuICAgIGlmICh0ZW1wbGF0ZVNwZWMudXNlRGVwdGhzICYmICFkZXB0aHMpIHtcbiAgICAgIHRocm93IG5ldyBfRXhjZXB0aW9uMlsnZGVmYXVsdCddKCdtdXN0IHBhc3MgcGFyZW50IGRlcHRocycpO1xuICAgIH1cblxuICAgIHJldHVybiB3cmFwUHJvZ3JhbShjb250YWluZXIsIGksIHRlbXBsYXRlU3BlY1tpXSwgZGF0YSwgMCwgYmxvY2tQYXJhbXMsIGRlcHRocyk7XG4gIH07XG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIHdyYXBQcm9ncmFtKGNvbnRhaW5lciwgaSwgZm4sIGRhdGEsIGRlY2xhcmVkQmxvY2tQYXJhbXMsIGJsb2NrUGFyYW1zLCBkZXB0aHMpIHtcbiAgZnVuY3Rpb24gcHJvZyhjb250ZXh0KSB7XG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IHt9IDogYXJndW1lbnRzWzFdO1xuXG4gICAgcmV0dXJuIGZuLmNhbGwoY29udGFpbmVyLCBjb250ZXh0LCBjb250YWluZXIuaGVscGVycywgY29udGFpbmVyLnBhcnRpYWxzLCBvcHRpb25zLmRhdGEgfHwgZGF0YSwgYmxvY2tQYXJhbXMgJiYgW29wdGlvbnMuYmxvY2tQYXJhbXNdLmNvbmNhdChibG9ja1BhcmFtcyksIGRlcHRocyAmJiBbY29udGV4dF0uY29uY2F0KGRlcHRocykpO1xuICB9XG4gIHByb2cucHJvZ3JhbSA9IGk7XG4gIHByb2cuZGVwdGggPSBkZXB0aHMgPyBkZXB0aHMubGVuZ3RoIDogMDtcbiAgcHJvZy5ibG9ja1BhcmFtcyA9IGRlY2xhcmVkQmxvY2tQYXJhbXMgfHwgMDtcbiAgcmV0dXJuIHByb2c7XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVQYXJ0aWFsKHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgaWYgKCFwYXJ0aWFsKSB7XG4gICAgcGFydGlhbCA9IG9wdGlvbnMucGFydGlhbHNbb3B0aW9ucy5uYW1lXTtcbiAgfSBlbHNlIGlmICghcGFydGlhbC5jYWxsICYmICFvcHRpb25zLm5hbWUpIHtcbiAgICAvLyBUaGlzIGlzIGEgZHluYW1pYyBwYXJ0aWFsIHRoYXQgcmV0dXJuZWQgYSBzdHJpbmdcbiAgICBvcHRpb25zLm5hbWUgPSBwYXJ0aWFsO1xuICAgIHBhcnRpYWwgPSBvcHRpb25zLnBhcnRpYWxzW3BhcnRpYWxdO1xuICB9XG4gIHJldHVybiBwYXJ0aWFsO1xufVxuXG5mdW5jdGlvbiBpbnZva2VQYXJ0aWFsKHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucy5wYXJ0aWFsID0gdHJ1ZTtcblxuICBpZiAocGFydGlhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IF9FeGNlcHRpb24yWydkZWZhdWx0J10oJ1RoZSBwYXJ0aWFsICcgKyBvcHRpb25zLm5hbWUgKyAnIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICB9IGVsc2UgaWYgKHBhcnRpYWwgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuICAgIHJldHVybiBwYXJ0aWFsKGNvbnRleHQsIG9wdGlvbnMpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5vb3AoKSB7XG4gIHJldHVybiAnJztcbn1cblxuZnVuY3Rpb24gaW5pdERhdGEoY29udGV4dCwgZGF0YSkge1xuICBpZiAoIWRhdGEgfHwgISgncm9vdCcgaW4gZGF0YSkpIHtcbiAgICBkYXRhID0gZGF0YSA/IF9DT01QSUxFUl9SRVZJU0lPTiRSRVZJU0lPTl9DSEFOR0VTJGNyZWF0ZUZyYW1lLmNyZWF0ZUZyYW1lKGRhdGEpIDoge307XG4gICAgZGF0YS5yb290ID0gY29udGV4dDtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vaGFuZGxlYmFycy9kaXN0L2Nqcy9oYW5kbGViYXJzL3J1bnRpbWUuanNcbi8vIG1vZHVsZSBpZCA9IDM4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 39 */
/***/ function(module, exports) {

	eval("/* WEBPACK VAR INJECTION */(function(global) {'use strict';\n\nexports.__esModule = true;\n/*global window */\n\nexports['default'] = function (Handlebars) {\n  /* istanbul ignore next */\n  var root = typeof global !== 'undefined' ? global : window,\n      $Handlebars = root.Handlebars;\n  /* istanbul ignore next */\n  Handlebars.noConflict = function () {\n    if (root.Handlebars === Handlebars) {\n      root.Handlebars = $Handlebars;\n    }\n  };\n};\n\nmodule.exports = exports['default'];\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2hhbmRsZWJhcnMvZGlzdC9janMvaGFuZGxlYmFycy9uby1jb25mbGljdC5qcz8yNjk1Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbi8qZ2xvYmFsIHdpbmRvdyAqL1xuXG5leHBvcnRzWydkZWZhdWx0J10gPSBmdW5jdGlvbiAoSGFuZGxlYmFycykge1xuICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICB2YXIgcm9vdCA9IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogd2luZG93LFxuICAgICAgJEhhbmRsZWJhcnMgPSByb290LkhhbmRsZWJhcnM7XG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gIEhhbmRsZWJhcnMubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAocm9vdC5IYW5kbGViYXJzID09PSBIYW5kbGViYXJzKSB7XG4gICAgICByb290LkhhbmRsZWJhcnMgPSAkSGFuZGxlYmFycztcbiAgICB9XG4gIH07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vaGFuZGxlYmFycy9kaXN0L2Nqcy9oYW5kbGViYXJzL25vLWNvbmZsaWN0LmpzXG4vLyBtb2R1bGUgaWQgPSAzOVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 40 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    return \"loader--large\";\n},\"3\":function(depth0,helpers,partials,data) {\n    return \"loader--dark\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<div class=\\\"loader \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.large : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \" \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.dark : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(3, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\"></div>\";\n},\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvc2hhcmVkL3RlbXBsYXRlUGFydGlhbHMvbG9hZGluZ0FuaW1hdGlvbi5oYW5kbGViYXJzPzczYzYiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiMVwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCJsb2FkZXItLWxhcmdlXCI7XG59LFwiM1wiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCJsb2FkZXItLWRhcmtcIjtcbn0sXCJjb21waWxlclwiOls2LFwiPj0gMi4wLjAtYmV0YS4xXCJdLFwibWFpblwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICB2YXIgc3RhY2sxO1xuXG4gIHJldHVybiBcIjxkaXYgY2xhc3M9XFxcImxvYWRlciBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5sYXJnZSA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDEsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCIgXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuZGFyayA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDMsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiPjwvZGl2PlwiO1xufSxcInVzZURhdGFcIjp0cnVlfSk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hcHAvc2hhcmVkL3RlbXBsYXRlUGFydGlhbHMvbG9hZGluZ0FuaW1hdGlvbi5oYW5kbGViYXJzXG4vLyBtb2R1bGUgaWQgPSA0MFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 41 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar navigationView = __webpack_require__(42),\n    workspaceState = __webpack_require__(25);\n\nvar navigationController = {\n\n    init: function init() {\n        navigationView.render();\n        this.bindClicks();\n        // workspaceState.activeScreen.set('browse');\n    },\n\n    bindClicks: function bindClicks() {\n        $('.js-workspace-nav__item').click(function () {\n            var item = $(this).attr('id');\n            workspaceState.activeScreen.set(item);\n        });\n    },\n\n    changeActiveItem: function changeActiveItem(item) {\n        navigationView.renderActiveItem(item);\n    }\n};\n\nmodule.exports = navigationController;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9uYXZpZ2F0aW9uL25hdmlnYXRpb25Db250cm9sbGVyLmpzPzk1ZmUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIG5hdmlnYXRpb25WaWV3ID0gcmVxdWlyZSgnd29ya3NwYWNlL25hdmlnYXRpb24vbmF2aWdhdGlvblZpZXcnKSxcbiAgICB3b3Jrc3BhY2VTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZScpO1xuXG52YXIgbmF2aWdhdGlvbkNvbnRyb2xsZXIgPSB7XG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgbmF2aWdhdGlvblZpZXcucmVuZGVyKCk7XG4gICAgICAgIHRoaXMuYmluZENsaWNrcygpO1xuICAgICAgICAvLyB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVTY3JlZW4uc2V0KCdicm93c2UnKTtcbiAgICB9LFxuXG4gICAgYmluZENsaWNrczogZnVuY3Rpb24gKCkge1xuICAgICAgICAkKCcuanMtd29ya3NwYWNlLW5hdl9faXRlbScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVTY3JlZW4uc2V0KGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2hhbmdlQWN0aXZlSXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBuYXZpZ2F0aW9uVmlldy5yZW5kZXJBY3RpdmVJdGVtKGl0ZW0pO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gbmF2aWdhdGlvbkNvbnRyb2xsZXI7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC93b3Jrc3BhY2UvbmF2aWdhdGlvbi9uYXZpZ2F0aW9uQ29udHJvbGxlci5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqQkE7QUFDQTtBQW1CQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 42 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar template = __webpack_require__(43);\n\nvar navigationView = {\n\n    render: function render() {\n        document.getElementById('workspace-navigation').innerHTML = template();\n    },\n\n    renderActiveItem: function renderActiveItem(item) {\n        $('.js-workspace-nav__item').removeClass('selected');\n        $('#' + item).addClass('selected');\n    }\n};\n\nmodule.exports = navigationView;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9uYXZpZ2F0aW9uL25hdmlnYXRpb25WaWV3LmpzPzk0NGMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHRlbXBsYXRlID0gcmVxdWlyZSgnLi9uYXZpZ2F0aW9uLmhhbmRsZWJhcnMnKTtcblxudmFyIG5hdmlnYXRpb25WaWV3ID0ge1xuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dvcmtzcGFjZS1uYXZpZ2F0aW9uJykuaW5uZXJIVE1MID0gdGVtcGxhdGUoKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyQWN0aXZlSXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAkKCcuanMtd29ya3NwYWNlLW5hdl9faXRlbScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAkKCcjJyArIGl0ZW0pLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gbmF2aWdhdGlvblZpZXc7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3dvcmtzcGFjZS9uYXZpZ2F0aW9uL25hdmlnYXRpb25WaWV3LmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBQ0E7QUFXQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 43 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    return \"\\n<ul class=\\\"nav__list nav__list--workspace\\\">\\n     <li class=\\\"nav__item nav__item--workspace nav__item--lang js-workspace-nav__item\\\" id=\\\"nav--workspace__welsh\\\"></li>\\n\\n     <li class=\\\"nav__item nav__item--workspace nav__item--browse js-workspace-nav__item selected\\\" id=\\\"browse\\\">\\n         <a class=\\\"nav__link\\\" href=\\\"javascript:void(0)\\\">Browse</a>\\n     </li>\\n     <li class=\\\"nav__item nav__item--workspace nav__item--create js-workspace-nav__item\\\" id=\\\"create\\\">\\n         <a class=\\\"nav__link\\\" href=\\\"javascript:void(0)\\\">Create</a>\\n     </li>\\n     <li class=\\\"nav__item nav__item--workspace nav__item--edit js-workspace-nav__item\\\" id=\\\"edit\\\">\\n         <a class=\\\"nav__link\\\" href=\\\"javascript:void(0)\\\">Edit</a>\\n     </li>\\n     <li class=\\\"nav__item nav__item--workspace nav__item--import nav--workspace__import js-workspace-nav__item\\\" id=\\\"import\\\">\\n         <a class=\\\"nav__link\\\" href=\\\"javascript:void(0)\\\">Import</a>\\n     </li>\\n </ul>\";\n},\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL25hdmlnYXRpb24vbmF2aWdhdGlvbi5oYW5kbGViYXJzP2MxYzciXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgcmV0dXJuIFwiXFxuPHVsIGNsYXNzPVxcXCJuYXZfX2xpc3QgbmF2X19saXN0LS13b3Jrc3BhY2VcXFwiPlxcbiAgICAgPGxpIGNsYXNzPVxcXCJuYXZfX2l0ZW0gbmF2X19pdGVtLS13b3Jrc3BhY2UgbmF2X19pdGVtLS1sYW5nIGpzLXdvcmtzcGFjZS1uYXZfX2l0ZW1cXFwiIGlkPVxcXCJuYXYtLXdvcmtzcGFjZV9fd2Vsc2hcXFwiPjwvbGk+XFxuXFxuICAgICA8bGkgY2xhc3M9XFxcIm5hdl9faXRlbSBuYXZfX2l0ZW0tLXdvcmtzcGFjZSBuYXZfX2l0ZW0tLWJyb3dzZSBqcy13b3Jrc3BhY2UtbmF2X19pdGVtIHNlbGVjdGVkXFxcIiBpZD1cXFwiYnJvd3NlXFxcIj5cXG4gICAgICAgICA8YSBjbGFzcz1cXFwibmF2X19saW5rXFxcIiBocmVmPVxcXCJqYXZhc2NyaXB0OnZvaWQoMClcXFwiPkJyb3dzZTwvYT5cXG4gICAgIDwvbGk+XFxuICAgICA8bGkgY2xhc3M9XFxcIm5hdl9faXRlbSBuYXZfX2l0ZW0tLXdvcmtzcGFjZSBuYXZfX2l0ZW0tLWNyZWF0ZSBqcy13b3Jrc3BhY2UtbmF2X19pdGVtXFxcIiBpZD1cXFwiY3JlYXRlXFxcIj5cXG4gICAgICAgICA8YSBjbGFzcz1cXFwibmF2X19saW5rXFxcIiBocmVmPVxcXCJqYXZhc2NyaXB0OnZvaWQoMClcXFwiPkNyZWF0ZTwvYT5cXG4gICAgIDwvbGk+XFxuICAgICA8bGkgY2xhc3M9XFxcIm5hdl9faXRlbSBuYXZfX2l0ZW0tLXdvcmtzcGFjZSBuYXZfX2l0ZW0tLWVkaXQganMtd29ya3NwYWNlLW5hdl9faXRlbVxcXCIgaWQ9XFxcImVkaXRcXFwiPlxcbiAgICAgICAgIDxhIGNsYXNzPVxcXCJuYXZfX2xpbmtcXFwiIGhyZWY9XFxcImphdmFzY3JpcHQ6dm9pZCgwKVxcXCI+RWRpdDwvYT5cXG4gICAgIDwvbGk+XFxuICAgICA8bGkgY2xhc3M9XFxcIm5hdl9faXRlbSBuYXZfX2l0ZW0tLXdvcmtzcGFjZSBuYXZfX2l0ZW0tLWltcG9ydCBuYXYtLXdvcmtzcGFjZV9faW1wb3J0IGpzLXdvcmtzcGFjZS1uYXZfX2l0ZW1cXFwiIGlkPVxcXCJpbXBvcnRcXFwiPlxcbiAgICAgICAgIDxhIGNsYXNzPVxcXCJuYXZfX2xpbmtcXFwiIGhyZWY9XFxcImphdmFzY3JpcHQ6dm9pZCgwKVxcXCI+SW1wb3J0PC9hPlxcbiAgICAgPC9saT5cXG4gPC91bD5cIjtcbn0sXCJ1c2VEYXRhXCI6dHJ1ZX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXBwL3dvcmtzcGFjZS9uYXZpZ2F0aW9uL25hdmlnYXRpb24uaGFuZGxlYmFyc1xuLy8gbW9kdWxlIGlkID0gNDNcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 44 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar browseView = __webpack_require__(45),\n    getBrowseTree = __webpack_require__(50),\n    userState = __webpack_require__(24),\n    workspaceState = __webpack_require__(25),\n    collectionState = __webpack_require__(28);\n\nvar browseController = {\n\n    init: function init() {\n        browseView.render.loader();\n\n        getBrowseTree().then(function (browseTreeData) {\n            workspaceState.browseTreeData.set(browseTreeData);\n            browseController.addDeleteMarkersToData(browseTreeData);\n            browseView.render.tree(browseTreeData);\n            browseController.bindPageButtonsClick();\n            browseController.bindNodeClick();\n\n            if (workspaceState.activeUrl.get().length > 0) {\n                browseController.selectBrowseNodeByUrl(workspaceState.activeUrl.get());\n            }\n        }).catch(function (error) {\n            console.log(error);\n        });\n    },\n\n    addDeleteMarkersToData: function addDeleteMarkersToData(browseTreeData) {\n        // recursively add isDeletable and deleteIsInCollection flags to all browse tree nodes\n        browseTreeData['isDeletable'] = isDeletable(browseTreeData.type);\n        browseTreeData['deleteIsInCollection'] = deleteIsInCollection(browseTreeData.contentPath, collectionState.get());\n\n        $.each(browseTreeData.children, function (key, browseTreeNode) {\n            if (browseTreeNode.children) {\n                browseController.addDeleteMarkersToData(browseTreeNode, collectionState.get());\n            }\n        });\n\n        // set deletable flag to false for certain page types\n        function isDeletable(type) {\n            return !(type == 'home_page' || type == 'taxonomy_landing_page' || type == 'product_page');\n        }\n\n        // check if given uri is marked for deletion in current collection\n        function deleteIsInCollection(uri, collectionData) {\n            var bool = false;\n            if (collectionData.pendingDeletes) {\n                $.each(collectionData.pendingDeletes, function (key, deleteMarker) {\n                    if (uri == deleteMarker.root.uri) {\n                        bool = true;\n                        return false;\n                    } else {\n                        bool = false;\n                    }\n                });\n            }\n            return bool;\n        }\n    },\n\n    bindNodeClick: function bindNodeClick() {\n        $('.js-browse__item-title').click(function () {\n            var url = $(this).closest('.js-browse__item').attr('data-url');\n\n            if (url) {\n                workspaceState.activeUrl.set(url);\n            } else {\n                // Has no url so must be a directory\n                var $this = $(this);\n                browseView.displayChildren($this);\n                browseView.selectDirectories($this);\n                browseView.scrollSelectedItemIntoView($this);\n            }\n        });\n    },\n\n    bindPageButtonsClick: function bindPageButtonsClick() {\n        var $browseTreeItems = $('.js-browse__item');\n\n        $browseTreeItems.find('.js-browse__edit').click(function () {\n            workspaceState.activeScreen.set('edit');\n        });\n\n        $browseTreeItems.find('.js-browse__create').click(function () {\n            workspaceState.activeScreen.set('create');\n        });\n\n        $browseTreeItems.find('.js-browse__menu').click(function () {\n            var $selectedItem = $(this).closest('.js-browse__item');\n            if (!$selectedItem.find('.js-browse__menu').hasClass('active')) {\n                browseView.pageMenu.show($selectedItem);\n            } else {\n                browseView.pageMenu.hide($selectedItem);\n            }\n        });\n    },\n\n    selectBrowseNodeByUrl: function selectBrowseNodeByUrl(url) {\n        // console.log('Node selected');\n        var $this = $('[data-url=\"' + url + '\"]');\n\n        // Hide secondary buttons for currently selected item (will gracefully fail if there's no selected item with displayed secondary buttons)\n        browseView.pageMenu.hide($('.js-browse__item.selected'));\n\n        browseView.selectPage(url);\n        browseView.displayChildren($this);\n        browseView.selectDirectories($this);\n        browseView.scrollSelectedItemIntoView($this);\n    }\n\n};\n\nmodule.exports = browseController;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlQ29udHJvbGxlci5qcz8xMDM4Il0sInNvdXJjZXNDb250ZW50IjpbInZhciBicm93c2VWaWV3ID0gcmVxdWlyZSgnd29ya3NwYWNlL2Jyb3dzZS9icm93c2VWaWV3JyksXG4gICAgZ2V0QnJvd3NlVHJlZSA9IHJlcXVpcmUoJ3NoYXJlZC9hcGkvZ2V0QnJvd3NlVHJlZScpLFxuICAgIHVzZXJTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS91c2VyU3RhdGUnKSxcbiAgICB3b3Jrc3BhY2VTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZScpLFxuICAgIGNvbGxlY3Rpb25TdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUnKTtcblxudmFyIGJyb3dzZUNvbnRyb2xsZXIgPSB7XG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJyb3dzZVZpZXcucmVuZGVyLmxvYWRlcigpO1xuXG4gICAgICAgIGdldEJyb3dzZVRyZWUoKS50aGVuKGZ1bmN0aW9uKGJyb3dzZVRyZWVEYXRhKXtcbiAgICAgICAgICAgIHdvcmtzcGFjZVN0YXRlLmJyb3dzZVRyZWVEYXRhLnNldChicm93c2VUcmVlRGF0YSk7XG4gICAgICAgICAgICBicm93c2VDb250cm9sbGVyLmFkZERlbGV0ZU1hcmtlcnNUb0RhdGEoYnJvd3NlVHJlZURhdGEpO1xuICAgICAgICAgICAgYnJvd3NlVmlldy5yZW5kZXIudHJlZShicm93c2VUcmVlRGF0YSk7XG4gICAgICAgICAgICBicm93c2VDb250cm9sbGVyLmJpbmRQYWdlQnV0dG9uc0NsaWNrKCk7XG4gICAgICAgICAgICBicm93c2VDb250cm9sbGVyLmJpbmROb2RlQ2xpY2soKTtcblxuICAgICAgICAgICAgaWYgKHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5nZXQoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgYnJvd3NlQ29udHJvbGxlci5zZWxlY3RCcm93c2VOb2RlQnlVcmwod29ya3NwYWNlU3RhdGUuYWN0aXZlVXJsLmdldCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFkZERlbGV0ZU1hcmtlcnNUb0RhdGE6IGZ1bmN0aW9uKGJyb3dzZVRyZWVEYXRhKSB7XG4gICAgICAgIC8vIHJlY3Vyc2l2ZWx5IGFkZCBpc0RlbGV0YWJsZSBhbmQgZGVsZXRlSXNJbkNvbGxlY3Rpb24gZmxhZ3MgdG8gYWxsIGJyb3dzZSB0cmVlIG5vZGVzXG4gICAgICAgIGJyb3dzZVRyZWVEYXRhWydpc0RlbGV0YWJsZSddID0gaXNEZWxldGFibGUoYnJvd3NlVHJlZURhdGEudHlwZSk7XG4gICAgICAgIGJyb3dzZVRyZWVEYXRhWydkZWxldGVJc0luQ29sbGVjdGlvbiddID0gZGVsZXRlSXNJbkNvbGxlY3Rpb24oYnJvd3NlVHJlZURhdGEuY29udGVudFBhdGgsIGNvbGxlY3Rpb25TdGF0ZS5nZXQoKSk7XG5cbiAgICAgICAgJC5lYWNoKGJyb3dzZVRyZWVEYXRhLmNoaWxkcmVuLCBmdW5jdGlvbigga2V5LCBicm93c2VUcmVlTm9kZSApIHtcbiAgICAgICAgICAgIGlmIChicm93c2VUcmVlTm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGJyb3dzZUNvbnRyb2xsZXIuYWRkRGVsZXRlTWFya2Vyc1RvRGF0YShicm93c2VUcmVlTm9kZSwgY29sbGVjdGlvblN0YXRlLmdldCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IGRlbGV0YWJsZSBmbGFnIHRvIGZhbHNlIGZvciBjZXJ0YWluIHBhZ2UgdHlwZXNcbiAgICAgICAgZnVuY3Rpb24gaXNEZWxldGFibGUodHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuICEodHlwZSA9PSAnaG9tZV9wYWdlJyB8fCB0eXBlID09ICd0YXhvbm9teV9sYW5kaW5nX3BhZ2UnIHx8IHR5cGUgPT0gJ3Byb2R1Y3RfcGFnZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2hlY2sgaWYgZ2l2ZW4gdXJpIGlzIG1hcmtlZCBmb3IgZGVsZXRpb24gaW4gY3VycmVudCBjb2xsZWN0aW9uXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUlzSW5Db2xsZWN0aW9uKHVyaSwgY29sbGVjdGlvbkRhdGEpIHtcbiAgICAgICAgICAgIHZhciBib29sID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoY29sbGVjdGlvbkRhdGEucGVuZGluZ0RlbGV0ZXMpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goY29sbGVjdGlvbkRhdGEucGVuZGluZ0RlbGV0ZXMsIGZ1bmN0aW9uIChrZXksIGRlbGV0ZU1hcmtlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXJpID09IGRlbGV0ZU1hcmtlci5yb290LnVyaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib29sID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBib29sO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGJpbmROb2RlQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCcuanMtYnJvd3NlX19pdGVtLXRpdGxlJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5jbG9zZXN0KCcuanMtYnJvd3NlX19pdGVtJykuYXR0cignZGF0YS11cmwnKTtcblxuICAgICAgICAgICAgaWYgKHVybCkge1xuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5zZXQodXJsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSGFzIG5vIHVybCBzbyBtdXN0IGJlIGEgZGlyZWN0b3J5XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBicm93c2VWaWV3LmRpc3BsYXlDaGlsZHJlbigkdGhpcyk7XG4gICAgICAgICAgICAgICAgYnJvd3NlVmlldy5zZWxlY3REaXJlY3RvcmllcygkdGhpcyk7XG4gICAgICAgICAgICAgICAgYnJvd3NlVmlldy5zY3JvbGxTZWxlY3RlZEl0ZW1JbnRvVmlldygkdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBiaW5kUGFnZUJ1dHRvbnNDbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkYnJvd3NlVHJlZUl0ZW1zID0gJCgnLmpzLWJyb3dzZV9faXRlbScpO1xuXG4gICAgICAgICRicm93c2VUcmVlSXRlbXMuZmluZCgnLmpzLWJyb3dzZV9fZWRpdCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuYWN0aXZlU2NyZWVuLnNldCgnZWRpdCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkYnJvd3NlVHJlZUl0ZW1zLmZpbmQoJy5qcy1icm93c2VfX2NyZWF0ZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuYWN0aXZlU2NyZWVuLnNldCgnY3JlYXRlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRicm93c2VUcmVlSXRlbXMuZmluZCgnLmpzLWJyb3dzZV9fbWVudScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRzZWxlY3RlZEl0ZW0gPSAkKHRoaXMpLmNsb3Nlc3QoJy5qcy1icm93c2VfX2l0ZW0nKTtcbiAgICAgICAgICAgIGlmICghJHNlbGVjdGVkSXRlbS5maW5kKCcuanMtYnJvd3NlX19tZW51JykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgYnJvd3NlVmlldy5wYWdlTWVudS5zaG93KCRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBicm93c2VWaWV3LnBhZ2VNZW51LmhpZGUoJHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzZWxlY3RCcm93c2VOb2RlQnlVcmw6IGZ1bmN0aW9uKHVybCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnTm9kZSBzZWxlY3RlZCcpO1xuICAgICAgICB2YXIgJHRoaXMgPSAkKCdbZGF0YS11cmw9XCInICsgdXJsICsgJ1wiXScpO1xuXG4gICAgICAgIC8vIEhpZGUgc2Vjb25kYXJ5IGJ1dHRvbnMgZm9yIGN1cnJlbnRseSBzZWxlY3RlZCBpdGVtICh3aWxsIGdyYWNlZnVsbHkgZmFpbCBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGl0ZW0gd2l0aCBkaXNwbGF5ZWQgc2Vjb25kYXJ5IGJ1dHRvbnMpXG4gICAgICAgIGJyb3dzZVZpZXcucGFnZU1lbnUuaGlkZSgkKCcuanMtYnJvd3NlX19pdGVtLnNlbGVjdGVkJykpO1xuXG4gICAgICAgIGJyb3dzZVZpZXcuc2VsZWN0UGFnZSh1cmwpO1xuICAgICAgICBicm93c2VWaWV3LmRpc3BsYXlDaGlsZHJlbigkdGhpcyk7XG4gICAgICAgIGJyb3dzZVZpZXcuc2VsZWN0RGlyZWN0b3JpZXMoJHRoaXMpO1xuICAgICAgICBicm93c2VWaWV3LnNjcm9sbFNlbGVjdGVkSXRlbUludG9WaWV3KCR0aGlzKTtcbiAgICB9XG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gYnJvd3NlQ29udHJvbGxlcjtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvd29ya3NwYWNlL2Jyb3dzZS9icm93c2VDb250cm9sbGVyLmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdEdBO0FBQ0E7QUF3R0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 45 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar treeTemplate = __webpack_require__(46),\n    loaderTemplate = __webpack_require__(40);\n\nvar browseView = {\n\n    render: {\n\n        loader: function loader() {\n            document.getElementById('workspace-browse').innerHTML = '<div class=\"margin-top--3\">' + loaderTemplate({ large: true, dark: true }) + '</div>';\n        },\n\n        tree: function tree(browseTreeData) {\n            document.getElementById('workspace-browse').innerHTML = treeTemplate(browseTreeData);\n        }\n    },\n\n    selectDirectories: function selectDirectories($this) {\n        $('.page__item--directory.selected').removeClass('selected'); // remove previous selections\n        $this.parents('.js-browse__item--directory').find('.page__item--directory:first').addClass('selected'); // select directories along parent path\n    },\n\n    selectPage: function selectPage(url) {\n        var $selectedListItem = $('[data-url=\"' + url + '\"]'),\n            $previouslySelectedItem = $('.js-browse__item.selected');\n\n        // Remove selected styling from previously selected item\n        $previouslySelectedItem.removeClass('selected');\n\n        // Add selected styling to new item\n        $selectedListItem.addClass('selected');\n\n        // Hide container for item and buttons for previous and show selected one\n        $('.page__container.selected').removeClass('selected');\n        $selectedListItem.find('.page__container:first').addClass('selected');\n\n        // Hide previously displayed page buttons and show selected one\n        if ($selectedListItem.find('.page__buttons:first')) {\n            $('.page__buttons.selected').removeClass('selected');\n            $selectedListItem.find('.page__buttons:first').addClass('selected');\n        }\n    },\n\n    displayChildren: function displayChildren($this) {\n        $('.js-browse__children.active').removeClass('active');\n        $this.parents('ul').addClass('active');\n        $this.closest('li').children('ul').addClass('active');\n    },\n\n    scrollSelectedItemIntoView: function scrollSelectedItemIntoView($this) {\n        var $browseTree = $('#workspace-browse'),\n            $selectedItem = $this ? $this : $browseTree.find('li.selected .page__container.selected');\n\n        if ($selectedItem.length) {\n            var selectedTop = $selectedItem.offset().top,\n                selectedBottom = selectedTop + $selectedItem.height(),\n                browseTop = $browseTree.offset().top,\n                browseBottom = browseTop + $browseTree.height(),\n                navHeight = $('.nav').height();\n\n            if (selectedTop < browseTop) {\n                console.log('Item was above of viewable browse tree');\n                $browseTree.scrollTop($browseTree.scrollTop() + selectedTop - navHeight / 2);\n            } else if (selectedBottom > browseBottom) {\n                console.log('Item was below viewable browse tree');\n                $browseTree.scrollTop(selectedBottom - navHeight / 2 - $selectedItem.height());\n            }\n        }\n    },\n\n    pageMenu: {\n\n        show: function show($selectedItem) {\n            var $menuButton = $selectedItem.find('.js-browse__menu');\n\n            $selectedItem.find('.js-browse__buttons--primary').addClass('active');\n            $menuButton.addClass('active').children('.hamburger-icon__span').addClass('active');\n            $menuButton.next('.page__menu').addClass('active');\n        },\n\n        hide: function hide($selectedItem) {\n            var $menuButton = $selectedItem.find('.js-browse__menu');\n\n            $selectedItem.find('.js-browse__buttons--primary').removeClass('active');\n            $menuButton.removeClass('active').children('.hamburger-icon__span').removeClass('active');\n            $menuButton.next('.page__menu').removeClass('active');\n        }\n    }\n};\n\nmodule.exports = browseView;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlVmlldy5qcz8zNTBiIl0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIHRyZWVUZW1wbGF0ZSA9IHJlcXVpcmUoJy4vYnJvd3NlLmhhbmRsZWJhcnMnKSxcbiAgICBsb2FkZXJUZW1wbGF0ZSA9IHJlcXVpcmUoJy4uLy4uL3NoYXJlZC90ZW1wbGF0ZVBhcnRpYWxzL2xvYWRpbmdBbmltYXRpb24uaGFuZGxlYmFycycpO1xuXG52YXIgYnJvd3NlVmlldyA9IHtcblxuICAgIHJlbmRlcjoge1xuXG4gICAgICAgIGxvYWRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlLWJyb3dzZScpLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPVwibWFyZ2luLXRvcC0tM1wiPicgKyBsb2FkZXJUZW1wbGF0ZSh7bGFyZ2U6IHRydWUsIGRhcms6IHRydWV9KSArICc8L2Rpdj4nO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRyZWU6IGZ1bmN0aW9uKGJyb3dzZVRyZWVEYXRhKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlLWJyb3dzZScpLmlubmVySFRNTCA9IHRyZWVUZW1wbGF0ZShicm93c2VUcmVlRGF0YSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2VsZWN0RGlyZWN0b3JpZXM6IGZ1bmN0aW9uKCR0aGlzKSB7XG4gICAgICAgICQoJy5wYWdlX19pdGVtLS1kaXJlY3Rvcnkuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsgLy8gcmVtb3ZlIHByZXZpb3VzIHNlbGVjdGlvbnNcbiAgICAgICAgJHRoaXMucGFyZW50cygnLmpzLWJyb3dzZV9faXRlbS0tZGlyZWN0b3J5JykuZmluZCgnLnBhZ2VfX2l0ZW0tLWRpcmVjdG9yeTpmaXJzdCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpOyAvLyBzZWxlY3QgZGlyZWN0b3JpZXMgYWxvbmcgcGFyZW50IHBhdGhcbiAgICB9LFxuXG4gICAgc2VsZWN0UGFnZTogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHZhciAkc2VsZWN0ZWRMaXN0SXRlbSA9ICQoJ1tkYXRhLXVybD1cIicgKyB1cmwgKyAnXCJdJyksXG4gICAgICAgICAgICAkcHJldmlvdXNseVNlbGVjdGVkSXRlbSA9ICQoJy5qcy1icm93c2VfX2l0ZW0uc2VsZWN0ZWQnKTtcblxuICAgICAgICAvLyBSZW1vdmUgc2VsZWN0ZWQgc3R5bGluZyBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgaXRlbVxuICAgICAgICAkcHJldmlvdXNseVNlbGVjdGVkSXRlbS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAvLyBBZGQgc2VsZWN0ZWQgc3R5bGluZyB0byBuZXcgaXRlbVxuICAgICAgICAkc2VsZWN0ZWRMaXN0SXRlbS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAvLyBIaWRlIGNvbnRhaW5lciBmb3IgaXRlbSBhbmQgYnV0dG9ucyBmb3IgcHJldmlvdXMgYW5kIHNob3cgc2VsZWN0ZWQgb25lXG4gICAgICAgICQoJy5wYWdlX19jb250YWluZXIuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgJHNlbGVjdGVkTGlzdEl0ZW0uZmluZCgnLnBhZ2VfX2NvbnRhaW5lcjpmaXJzdCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgICAgIC8vIEhpZGUgcHJldmlvdXNseSBkaXNwbGF5ZWQgcGFnZSBidXR0b25zIGFuZCBzaG93IHNlbGVjdGVkIG9uZVxuICAgICAgICBpZiAoJHNlbGVjdGVkTGlzdEl0ZW0uZmluZCgnLnBhZ2VfX2J1dHRvbnM6Zmlyc3QnKSkge1xuICAgICAgICAgICAgJCgnLnBhZ2VfX2J1dHRvbnMuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICRzZWxlY3RlZExpc3RJdGVtLmZpbmQoJy5wYWdlX19idXR0b25zOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzcGxheUNoaWxkcmVuOiBmdW5jdGlvbigkdGhpcykge1xuICAgICAgICAkKCcuanMtYnJvd3NlX19jaGlsZHJlbi5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICR0aGlzLnBhcmVudHMoJ3VsJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAkdGhpcy5jbG9zZXN0KCdsaScpLmNoaWxkcmVuKCd1bCcpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9LFxuXG4gICAgc2Nyb2xsU2VsZWN0ZWRJdGVtSW50b1ZpZXc6IGZ1bmN0aW9uKCR0aGlzKSB7XG4gICAgICAgIHZhciAkYnJvd3NlVHJlZSA9ICQoJyN3b3Jrc3BhY2UtYnJvd3NlJyksXG4gICAgICAgICRzZWxlY3RlZEl0ZW0gPSAkdGhpcyA/ICR0aGlzIDogJGJyb3dzZVRyZWUuZmluZCgnbGkuc2VsZWN0ZWQgLnBhZ2VfX2NvbnRhaW5lci5zZWxlY3RlZCcpO1xuXG4gICAgICAgIGlmICgkc2VsZWN0ZWRJdGVtLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIHNlbGVjdGVkVG9wID0gJHNlbGVjdGVkSXRlbS5vZmZzZXQoKS50b3AsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRCb3R0b20gPSBzZWxlY3RlZFRvcCArICRzZWxlY3RlZEl0ZW0uaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgYnJvd3NlVG9wID0gJGJyb3dzZVRyZWUub2Zmc2V0KCkudG9wLFxuICAgICAgICAgICAgICAgIGJyb3dzZUJvdHRvbSA9IGJyb3dzZVRvcCArICRicm93c2VUcmVlLmhlaWdodCgpLFxuICAgICAgICAgICAgICAgIG5hdkhlaWdodCA9ICQoJy5uYXYnKS5oZWlnaHQoKTtcblxuICAgICAgICAgICAgaWYgKHNlbGVjdGVkVG9wIDwgYnJvd3NlVG9wKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0l0ZW0gd2FzIGFib3ZlIG9mIHZpZXdhYmxlIGJyb3dzZSB0cmVlJyk7XG4gICAgICAgICAgICAgICAgJGJyb3dzZVRyZWUuc2Nyb2xsVG9wKCRicm93c2VUcmVlLnNjcm9sbFRvcCgpICsgKHNlbGVjdGVkVG9wKSAtIChuYXZIZWlnaHQgLyAyKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkQm90dG9tID4gYnJvd3NlQm90dG9tKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0l0ZW0gd2FzIGJlbG93IHZpZXdhYmxlIGJyb3dzZSB0cmVlJyk7XG4gICAgICAgICAgICAgICAgJGJyb3dzZVRyZWUuc2Nyb2xsVG9wKHNlbGVjdGVkQm90dG9tIC0gKG5hdkhlaWdodCAvIDIpIC0gJHNlbGVjdGVkSXRlbS5oZWlnaHQoKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBwYWdlTWVudToge1xuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCRzZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgICAgIHZhciAkbWVudUJ1dHRvbiA9ICRzZWxlY3RlZEl0ZW0uZmluZCgnLmpzLWJyb3dzZV9fbWVudScpO1xuXG4gICAgICAgICAgICAkc2VsZWN0ZWRJdGVtLmZpbmQoJy5qcy1icm93c2VfX2J1dHRvbnMtLXByaW1hcnknKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAkbWVudUJ1dHRvbi5hZGRDbGFzcygnYWN0aXZlJykuY2hpbGRyZW4oJy5oYW1idXJnZXItaWNvbl9fc3BhbicpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICRtZW51QnV0dG9uLm5leHQoJy5wYWdlX19tZW51JykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKCRzZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgICAgIHZhciAkbWVudUJ1dHRvbiA9ICRzZWxlY3RlZEl0ZW0uZmluZCgnLmpzLWJyb3dzZV9fbWVudScpO1xuXG4gICAgICAgICAgICAkc2VsZWN0ZWRJdGVtLmZpbmQoJy5qcy1icm93c2VfX2J1dHRvbnMtLXByaW1hcnknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAkbWVudUJ1dHRvbi5yZW1vdmVDbGFzcygnYWN0aXZlJykuY2hpbGRyZW4oJy5oYW1idXJnZXItaWNvbl9fc3BhbicpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICRtZW51QnV0dG9uLm5leHQoJy5wYWdlX19tZW51JykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBicm93c2VWaWV3O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC93b3Jrc3BhY2UvYnJvd3NlL2Jyb3dzZVZpZXcuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQWxFQTtBQUNBO0FBcUZBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 46 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    return \" page__item--directory\";\n},\"3\":function(depth0,helpers,partials,data) {\n    return \" page__item--\"\n    + this.escapeExpression(this.lambda((depth0 != null ? depth0.type : depth0), depth0));\n},\"5\":function(depth0,helpers,partials,data) {\n    return \"<button class=\\\"btn btn--warning js-browse__delete\\\">Delete</button>\";\n},\"7\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"-->\\n                        <!--<div class=\\\"page__buttons page__buttons--list selected\\\">-->\\n                            <!--<button class=\\\"btn btn--primary btn-browse-edit\\\">Edit</button>-->\\n                            <!--<button class=\\\"btn btn--positive btn-browse-create\\\">Create</button>-->\\n                            <!--\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.isDeletable : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(8, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"-->\\n                        <!--</div>-->\\n                    <!--\";\n},\"8\":function(depth0,helpers,partials,data) {\n    return \"<button class=\\\"btn btn--warning btn-browse-delete\\\">Delete</button>\";\n},\"10\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \" \\n                    <ul class=\\\"js-browse__children active\\\">\\n                        \"\n    + ((stack1 = this.invokePartial(__webpack_require__(47),depth0,{\"name\":\"browseNode\",\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \" \\n                        <!--\"\n    + ((stack1 = __default(__webpack_require__(48)).call(depth0,(depth0 != null ? depth0.collectionOwner : depth0),\"===\",\"PUBLISHING_SUPPORT\",{\"name\":\"ifCond\",\"hash\":{},\"fn\":this.program(11, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"-->\\n                        <!--\"\n    + ((stack1 = __default(__webpack_require__(48)).call(depth0,(depth0 != null ? depth0.collectionOwner : depth0),\"===\",\"DATA_VISUALISATION\",{\"name\":\"ifCond\",\"hash\":{},\"fn\":this.program(13, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"-->\\n                    </ul>\\n\";\n},\"11\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"-->\\n                            <!--\"\n    + ((stack1 = this.invokePartial(__webpack_require__(47),depth0,{\"name\":\"browseNode\",\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \" -->\\n                        <!--\";\n},\"13\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"-->\\n                            <!--\"\n    + ((stack1 = this.invokePartial(__webpack_require__(49),depth0,{\"name\":\"browseVisNode\",\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \" -->\\n                        <!--\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1, alias1=this.lambda, alias2=this.escapeExpression;\n\n  return \"<section class=\\\"panel panel--scrollable workspace-browse\\\">\\n    <nav class=\\\"tree-nav-holder js-browse\\\">\\n        <ul class=\\\"page-list page-list--tree active\\\">\\n            <li class=\\\"js-browse__item selected\\\" data-url=\\\"\"\n    + alias2(alias1((depth0 != null ? depth0.uri : depth0), depth0))\n    + \"\\\">\\n                <div class=\\\"page__container selected\\\">\\n                    <span class=\\\"js-browse__item-title page__item\"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.program(3, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\"\n    + alias2(alias1(((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.title : stack1), depth0))\n    + \"</span>\\n                    <div class=\\\"page__buttons page__buttons--list selected\\\">\\n                        <button class=\\\"btn btn--primary js-browse__edit\\\">Edit</button>\\n                        <button class=\\\"btn btn--positive js-browse__create\\\">Create</button>\\n                        \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.isDeletable : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(5, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n                    </div>\\n                    <!--\"\n    + ((stack1 = __default(__webpack_require__(48)).call(depth0,(depth0 != null ? depth0.collectionOwner : depth0),\"===\",\"PUBLISHING_SUPPORT\",{\"name\":\"ifCond\",\"hash\":{},\"fn\":this.program(7, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"-->\\n                </div>\\n                \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.children : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(10, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"            </li>\\n        </ul>\\n    </nav>\\n</section>\";\n},\"usePartial\":true,\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2Jyb3dzZS9icm93c2UuaGFuZGxlYmFycz8wZmEyIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBIYW5kbGViYXJzID0gcmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL25vZGVfbW9kdWxlcy9oYW5kbGViYXJzL3J1bnRpbWUuanNcIik7XG5mdW5jdGlvbiBfX2RlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgKG9iai5fX2VzTW9kdWxlID8gb2JqW1wiZGVmYXVsdFwiXSA6IG9iaik7IH1cbm1vZHVsZS5leHBvcnRzID0gKEhhbmRsZWJhcnNbXCJkZWZhdWx0XCJdIHx8IEhhbmRsZWJhcnMpLnRlbXBsYXRlKHtcIjFcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgcmV0dXJuIFwiIHBhZ2VfX2l0ZW0tLWRpcmVjdG9yeVwiO1xufSxcIjNcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgcmV0dXJuIFwiIHBhZ2VfX2l0ZW0tLVwiXG4gICAgKyB0aGlzLmVzY2FwZUV4cHJlc3Npb24odGhpcy5sYW1iZGEoKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLnR5cGUgOiBkZXB0aDApLCBkZXB0aDApKTtcbn0sXCI1XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIjxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXdhcm5pbmcganMtYnJvd3NlX19kZWxldGVcXFwiPkRlbGV0ZTwvYnV0dG9uPlwiO1xufSxcIjdcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCItLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8IS0tPGRpdiBjbGFzcz1cXFwicGFnZV9fYnV0dG9ucyBwYWdlX19idXR0b25zLS1saXN0IHNlbGVjdGVkXFxcIj4tLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLTxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXByaW1hcnkgYnRuLWJyb3dzZS1lZGl0XFxcIj5FZGl0PC9idXR0b24+LS0+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS08YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLS1wb3NpdGl2ZSBidG4tYnJvd3NlLWNyZWF0ZVxcXCI+Q3JlYXRlPC9idXR0b24+LS0+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS1cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5pc0RlbGV0YWJsZSA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDgsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCItLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8IS0tPC9kaXY+LS0+XFxuICAgICAgICAgICAgICAgICAgICA8IS0tXCI7XG59LFwiOFwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCI8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLS13YXJuaW5nIGJ0bi1icm93c2UtZGVsZXRlXFxcIj5EZWxldGU8L2J1dHRvbj5cIjtcbn0sXCIxMFwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICB2YXIgc3RhY2sxO1xuXG4gIHJldHVybiBcIiBcXG4gICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz1cXFwianMtYnJvd3NlX19jaGlsZHJlbiBhY3RpdmVcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiXG4gICAgKyAoKHN0YWNrMSA9IHRoaXMuaW52b2tlUGFydGlhbChyZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlTm9kZS5oYW5kbGViYXJzXCIpLGRlcHRoMCx7XCJuYW1lXCI6XCJicm93c2VOb2RlXCIsXCJkYXRhXCI6ZGF0YSxcImhlbHBlcnNcIjpoZWxwZXJzLFwicGFydGlhbHNcIjpwYXJ0aWFsc30pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiIFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS1cIlxuICAgICsgKChzdGFjazEgPSBfX2RlZmF1bHQocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC9zaGFyZWQvdGVtcGxhdGVIZWxwZXJzL2lmQ29uZC5qc1wiKSkuY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmNvbGxlY3Rpb25Pd25lciA6IGRlcHRoMCksXCI9PT1cIixcIlBVQkxJU0hJTkdfU1VQUE9SVFwiLHtcIm5hbWVcIjpcImlmQ29uZFwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMTEsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCItLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8IS0tXCJcbiAgICArICgoc3RhY2sxID0gX19kZWZhdWx0KHJlcXVpcmUoXCIvVXNlcnMvY3Jpc3Bpbm1lcnJpbWFuL0dpdC9vbnNkaWdpdGFsL2Zsb3JlbmNlL3NyYy9hcHAvc2hhcmVkL3RlbXBsYXRlSGVscGVycy9pZkNvbmQuanNcIikpLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5jb2xsZWN0aW9uT3duZXIgOiBkZXB0aDApLFwiPT09XCIsXCJEQVRBX1ZJU1VBTElTQVRJT05cIix7XCJuYW1lXCI6XCJpZkNvbmRcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDEzLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiLS0+XFxuICAgICAgICAgICAgICAgICAgICA8L3VsPlxcblwiO1xufSxcIjExXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiLS0+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS1cIlxuICAgICsgKChzdGFjazEgPSB0aGlzLmludm9rZVBhcnRpYWwocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC93b3Jrc3BhY2UvYnJvd3NlL2Jyb3dzZU5vZGUuaGFuZGxlYmFyc1wiKSxkZXB0aDAse1wibmFtZVwiOlwiYnJvd3NlTm9kZVwiLFwiZGF0YVwiOmRhdGEsXCJoZWxwZXJzXCI6aGVscGVycyxcInBhcnRpYWxzXCI6cGFydGlhbHN9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIiAtLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8IS0tXCI7XG59LFwiMTNcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCItLT5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLVwiXG4gICAgKyAoKHN0YWNrMSA9IHRoaXMuaW52b2tlUGFydGlhbChyZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlVmlzTm9kZS5oYW5kbGViYXJzXCIpLGRlcHRoMCx7XCJuYW1lXCI6XCJicm93c2VWaXNOb2RlXCIsXCJkYXRhXCI6ZGF0YSxcImhlbHBlcnNcIjpoZWxwZXJzLFwicGFydGlhbHNcIjpwYXJ0aWFsc30pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiIC0tPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS1cIjtcbn0sXCJjb21waWxlclwiOls2LFwiPj0gMi4wLjAtYmV0YS4xXCJdLFwibWFpblwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICB2YXIgc3RhY2sxLCBhbGlhczE9dGhpcy5sYW1iZGEsIGFsaWFzMj10aGlzLmVzY2FwZUV4cHJlc3Npb247XG5cbiAgcmV0dXJuIFwiPHNlY3Rpb24gY2xhc3M9XFxcInBhbmVsIHBhbmVsLS1zY3JvbGxhYmxlIHdvcmtzcGFjZS1icm93c2VcXFwiPlxcbiAgICA8bmF2IGNsYXNzPVxcXCJ0cmVlLW5hdi1ob2xkZXIganMtYnJvd3NlXFxcIj5cXG4gICAgICAgIDx1bCBjbGFzcz1cXFwicGFnZS1saXN0IHBhZ2UtbGlzdC0tdHJlZSBhY3RpdmVcXFwiPlxcbiAgICAgICAgICAgIDxsaSBjbGFzcz1cXFwianMtYnJvd3NlX19pdGVtIHNlbGVjdGVkXFxcIiBkYXRhLXVybD1cXFwiXCJcbiAgICArIGFsaWFzMihhbGlhczEoKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLnVyaSA6IGRlcHRoMCksIGRlcHRoMCkpXG4gICAgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBhZ2VfX2NvbnRhaW5lciBzZWxlY3RlZFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwianMtYnJvd3NlX19pdGVtLXRpdGxlIHBhZ2VfX2l0ZW1cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzLnVubGVzcy5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudXJpIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJ1bmxlc3NcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDEsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMucHJvZ3JhbSgzLCBkYXRhLCAwKSxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiPlwiXG4gICAgKyBhbGlhczIoYWxpYXMxKCgoc3RhY2sxID0gKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlc2NyaXB0aW9uIDogZGVwdGgwKSkgIT0gbnVsbCA/IHN0YWNrMS50aXRsZSA6IHN0YWNrMSksIGRlcHRoMCkpXG4gICAgKyBcIjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBhZ2VfX2J1dHRvbnMgcGFnZV9fYnV0dG9ucy0tbGlzdCBzZWxlY3RlZFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIGJ0bi0tcHJpbWFyeSBqcy1icm93c2VfX2VkaXRcXFwiPkVkaXQ8L2J1dHRvbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLS1wb3NpdGl2ZSBqcy1icm93c2VfX2NyZWF0ZVxcXCI+Q3JlYXRlPC9idXR0b24+XFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuaXNEZWxldGFibGUgOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSg1LCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDwhLS1cIlxuICAgICsgKChzdGFjazEgPSBfX2RlZmF1bHQocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC9zaGFyZWQvdGVtcGxhdGVIZWxwZXJzL2lmQ29uZC5qc1wiKSkuY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmNvbGxlY3Rpb25Pd25lciA6IGRlcHRoMCksXCI9PT1cIixcIlBVQkxJU0hJTkdfU1VQUE9SVFwiLHtcIm5hbWVcIjpcImlmQ29uZFwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oNywgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIi0tPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuY2hpbGRyZW4gOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxMCwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIiAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICA8L3VsPlxcbiAgICA8L25hdj5cXG48L3NlY3Rpb24+XCI7XG59LFwidXNlUGFydGlhbFwiOnRydWUsXCJ1c2VEYXRhXCI6dHJ1ZX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlLmhhbmRsZWJhcnNcbi8vIG1vZHVsZSBpZCA9IDQ2XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 47 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    var stack1, alias1=this.lambda, alias2=this.escapeExpression;\n\n  return \" \\n    <li class=\\\"js-browse__item \"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(2, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\" data-url=\\\"\"\n    + alias2(alias1((depth0 != null ? depth0.uri : depth0), depth0))\n    + \"\\\">\\n        <span class=\\\"page__container \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.deleteMarker : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(4, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\\n            <span class=\\\"js-browse__item-title page__item\"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(6, data, 0),\"inverse\":this.program(8, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\"\n    + alias2(alias1(((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.title : stack1), depth0))\n    + ((stack1 = helpers['if'].call(depth0,((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.edition : stack1),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(10, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"</span>\\n            <span class=\\\"page__buttons page__buttons--list\\\">\\n\\n                <span class=\\\"page__primary-buttons js-browse__buttons--primary \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.deleteMarker : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(12, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\\n                    <button class=\\\"btn btn--primary js-browse__edit\\\">Edit</button>\\n                    <button class=\\\"btn btn--positive js-browse__create\\\">Create</button>\\n                </span>\\n\\n\\n                <button class=\\\"btn btn--primary js-browse__delete-revert \"\n    + ((stack1 = __default(__webpack_require__(48)).call(depth0,(depth0 != null ? depth0.deleteIsInCollection : depth0),\"&&\",(depth0 != null ? depth0.deleteMarker : depth0),{\"name\":\"ifCond\",\"hash\":{},\"fn\":this.program(14, data, 0),\"inverse\":this.program(12, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">Revert deletion</button>\\n\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.deleteMarker : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(16, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.isDeletable : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(19, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"            </span>\\n        </span>\\n        \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.children : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(24, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"    </li>\\n\";\n},\"2\":function(depth0,helpers,partials,data) {\n    return \"js-browse__item--directory\";\n},\"4\":function(depth0,helpers,partials,data) {\n    return \"deleted\";\n},\"6\":function(depth0,helpers,partials,data) {\n    return \" page__item--directory\";\n},\"8\":function(depth0,helpers,partials,data) {\n    return \" page__item--\"\n    + this.escapeExpression(this.lambda((depth0 != null ? depth0.type : depth0), depth0));\n},\"10\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"\\n                : \"\n    + this.escapeExpression(this.lambda(((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.edition : stack1), depth0));\n},\"12\":function(depth0,helpers,partials,data) {\n    return \"hidden\";\n},\"14\":function(depth0,helpers,partials,data) {\n    return \"\";\n},\"16\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"                    \"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.deleteIsInCollection : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(17, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\";\n},\"17\":function(depth0,helpers,partials,data) {\n    return \"* this file has been delete in another collection\";\n},\"19\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"                    <span class=\\\"js-browse__buttons--secondary \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.deleteMarker : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(12, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\\n                        <button class=\\\"js-browse__menu hamburger-icon hamburger-icon--page-item\\\">\\n                            <span class=\\\"hamburger-icon__span\\\">toggle menu</span>\\n                        </button>\\n\\n                        <span class=\\\"page__menu\\\">\\n\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.isMoveable : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(20, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.isDeletable : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(22, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n                        </span>\\n                    </span>\\n\";\n},\"20\":function(depth0,helpers,partials,data) {\n    return \"                                <button class=\\\"btn btn--primary js-browse__move\\\">Move</button>\";\n},\"22\":function(depth0,helpers,partials,data) {\n    return \"                                <button class=\\\"btn btn--warning js-browse__delete\\\">Delete</button>\";\n},\"24\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \" \\n            <ul class=\\\"js-browse__children\\\">\\n                \"\n    + ((stack1 = this.invokePartial(__webpack_require__(47),depth0,{\"name\":\"browseNode\",\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \" \\n            </ul>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return ((stack1 = helpers.each.call(depth0,(depth0 != null ? depth0.children : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"usePartial\":true,\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2Jyb3dzZS9icm93c2VOb2RlLmhhbmRsZWJhcnM/NmM0OCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgSGFuZGxlYmFycyA9IHJlcXVpcmUoXCIvVXNlcnMvY3Jpc3Bpbm1lcnJpbWFuL0dpdC9vbnNkaWdpdGFsL2Zsb3JlbmNlL3NyYy9ub2RlX21vZHVsZXMvaGFuZGxlYmFycy9ydW50aW1lLmpzXCIpO1xuZnVuY3Rpb24gX19kZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIChvYmouX19lc01vZHVsZSA/IG9ialtcImRlZmF1bHRcIl0gOiBvYmopOyB9XG5tb2R1bGUuZXhwb3J0cyA9IChIYW5kbGViYXJzW1wiZGVmYXVsdFwiXSB8fCBIYW5kbGViYXJzKS50ZW1wbGF0ZSh7XCIxXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazEsIGFsaWFzMT10aGlzLmxhbWJkYSwgYWxpYXMyPXRoaXMuZXNjYXBlRXhwcmVzc2lvbjtcblxuICByZXR1cm4gXCIgXFxuICAgIDxsaSBjbGFzcz1cXFwianMtYnJvd3NlX19pdGVtIFwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnMudW5sZXNzLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC51cmkgOiBkZXB0aDApLHtcIm5hbWVcIjpcInVubGVzc1wiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMiwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIlxcXCIgZGF0YS11cmw9XFxcIlwiXG4gICAgKyBhbGlhczIoYWxpYXMxKChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC51cmkgOiBkZXB0aDApLCBkZXB0aDApKVxuICAgICsgXCJcXFwiPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInBhZ2VfX2NvbnRhaW5lciBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5kZWxldGVNYXJrZXIgOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSg0LCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxcIj5cXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwianMtYnJvd3NlX19pdGVtLXRpdGxlIHBhZ2VfX2l0ZW1cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzLnVubGVzcy5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudXJpIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJ1bmxlc3NcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDYsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMucHJvZ3JhbSg4LCBkYXRhLCAwKSxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiPlwiXG4gICAgKyBhbGlhczIoYWxpYXMxKCgoc3RhY2sxID0gKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlc2NyaXB0aW9uIDogZGVwdGgwKSkgIT0gbnVsbCA/IHN0YWNrMS50aXRsZSA6IHN0YWNrMSksIGRlcHRoMCkpXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnNbJ2lmJ10uY2FsbChkZXB0aDAsKChzdGFjazEgPSAoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuZGVzY3JpcHRpb24gOiBkZXB0aDApKSAhPSBudWxsID8gc3RhY2sxLmVkaXRpb24gOiBzdGFjazEpLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxMCwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIjwvc3Bhbj5cXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwicGFnZV9fYnV0dG9ucyBwYWdlX19idXR0b25zLS1saXN0XFxcIj5cXG5cXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInBhZ2VfX3ByaW1hcnktYnV0dG9ucyBqcy1icm93c2VfX2J1dHRvbnMtLXByaW1hcnkgXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuZGVsZXRlTWFya2VyIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJpZlwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMTIsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIGJ0bi0tcHJpbWFyeSBqcy1icm93c2VfX2VkaXRcXFwiPkVkaXQ8L2J1dHRvbj5cXG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXBvc2l0aXZlIGpzLWJyb3dzZV9fY3JlYXRlXFxcIj5DcmVhdGU8L2J1dHRvbj5cXG4gICAgICAgICAgICAgICAgPC9zcGFuPlxcblxcblxcbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLS1wcmltYXJ5IGpzLWJyb3dzZV9fZGVsZXRlLXJldmVydCBcIlxuICAgICsgKChzdGFjazEgPSBfX2RlZmF1bHQocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC9zaGFyZWQvdGVtcGxhdGVIZWxwZXJzL2lmQ29uZC5qc1wiKSkuY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlbGV0ZUlzSW5Db2xsZWN0aW9uIDogZGVwdGgwKSxcIiYmXCIsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlbGV0ZU1hcmtlciA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZDb25kXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxNCwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5wcm9ncmFtKDEyLCBkYXRhLCAwKSxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiPlJldmVydCBkZWxldGlvbjwvYnV0dG9uPlxcblwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnNbJ2lmJ10uY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlbGV0ZU1hcmtlciA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDE2LCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxuXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuaXNEZWxldGFibGUgOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxOSwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIiAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgIDwvc3Bhbj5cXG4gICAgICAgIFwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnNbJ2lmJ10uY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmNoaWxkcmVuIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJpZlwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMjQsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCIgICAgPC9saT5cXG5cIjtcbn0sXCIyXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcImpzLWJyb3dzZV9faXRlbS0tZGlyZWN0b3J5XCI7XG59LFwiNFwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCJkZWxldGVkXCI7XG59LFwiNlwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCIgcGFnZV9faXRlbS0tZGlyZWN0b3J5XCI7XG59LFwiOFwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCIgcGFnZV9faXRlbS0tXCJcbiAgICArIHRoaXMuZXNjYXBlRXhwcmVzc2lvbih0aGlzLmxhbWJkYSgoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudHlwZSA6IGRlcHRoMCksIGRlcHRoMCkpO1xufSxcIjEwXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiXFxuICAgICAgICAgICAgICAgIDogXCJcbiAgICArIHRoaXMuZXNjYXBlRXhwcmVzc2lvbih0aGlzLmxhbWJkYSgoKHN0YWNrMSA9IChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5kZXNjcmlwdGlvbiA6IGRlcHRoMCkpICE9IG51bGwgPyBzdGFjazEuZWRpdGlvbiA6IHN0YWNrMSksIGRlcHRoMCkpO1xufSxcIjEyXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcImhpZGRlblwiO1xufSxcIjE0XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIlwiO1xufSxcIjE2XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiICAgICAgICAgICAgICAgICAgICBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzLnVubGVzcy5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuZGVsZXRlSXNJbkNvbGxlY3Rpb24gOiBkZXB0aDApLHtcIm5hbWVcIjpcInVubGVzc1wiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMTcsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXG5cIjtcbn0sXCIxN1wiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCIqIHRoaXMgZmlsZSBoYXMgYmVlbiBkZWxldGUgaW4gYW5vdGhlciBjb2xsZWN0aW9uXCI7XG59LFwiMTlcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCIgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJqcy1icm93c2VfX2J1dHRvbnMtLXNlY29uZGFyeSBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5kZWxldGVNYXJrZXIgOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxMiwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwianMtYnJvd3NlX19tZW51IGhhbWJ1cmdlci1pY29uIGhhbWJ1cmdlci1pY29uLS1wYWdlLWl0ZW1cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiaGFtYnVyZ2VyLWljb25fX3NwYW5cXFwiPnRvZ2dsZSBtZW51PC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxcblxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJwYWdlX19tZW51XFxcIj5cXG5cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5pc01vdmVhYmxlIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJpZlwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMjAsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXG5cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5pc0RlbGV0YWJsZSA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDIyLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcblwiO1xufSxcIjIwXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIGJ0bi0tcHJpbWFyeSBqcy1icm93c2VfX21vdmVcXFwiPk1vdmU8L2J1dHRvbj5cIjtcbn0sXCIyMlwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXdhcm5pbmcganMtYnJvd3NlX19kZWxldGVcXFwiPkRlbGV0ZTwvYnV0dG9uPlwiO1xufSxcIjI0XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiIFxcbiAgICAgICAgICAgIDx1bCBjbGFzcz1cXFwianMtYnJvd3NlX19jaGlsZHJlblxcXCI+XFxuICAgICAgICAgICAgICAgIFwiXG4gICAgKyAoKHN0YWNrMSA9IHRoaXMuaW52b2tlUGFydGlhbChyZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlTm9kZS5oYW5kbGViYXJzXCIpLGRlcHRoMCx7XCJuYW1lXCI6XCJicm93c2VOb2RlXCIsXCJkYXRhXCI6ZGF0YSxcImhlbHBlcnNcIjpoZWxwZXJzLFwicGFydGlhbHNcIjpwYXJ0aWFsc30pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiIFxcbiAgICAgICAgICAgIDwvdWw+XFxuXCI7XG59LFwiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gKChzdGFjazEgPSBoZWxwZXJzLmVhY2guY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmNoaWxkcmVuIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJlYWNoXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIik7XG59LFwidXNlUGFydGlhbFwiOnRydWUsXCJ1c2VEYXRhXCI6dHJ1ZX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXBwL3dvcmtzcGFjZS9icm93c2UvYnJvd3NlTm9kZS5oYW5kbGViYXJzXG4vLyBtb2R1bGUgaWQgPSA0N1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 48 */
/***/ function(module, exports) {

	eval("'use strict';\n\nmodule.exports = function (v1, operator, v2, options) {\n\n    switch (operator) {\n        case '==':\n            return v1 == v2 ? options.fn(this) : options.inverse(this);\n        case '===':\n            return v1 === v2 ? options.fn(this) : options.inverse(this);\n        case '<':\n            return v1 < v2 ? options.fn(this) : options.inverse(this);\n        case '<=':\n            return v1 <= v2 ? options.fn(this) : options.inverse(this);\n        case '>':\n            return v1 > v2 ? options.fn(this) : options.inverse(this);\n        case '>=':\n            return v1 >= v2 ? options.fn(this) : options.inverse(this);\n        case '&&':\n            return v1 && v2 ? options.fn(this) : options.inverse(this);\n        case '||':\n            return v1 || v2 ? options.fn(this) : options.inverse(this);\n        default:\n            return options.inverse(this);\n    }\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC90ZW1wbGF0ZUhlbHBlcnMvaWZDb25kLmpzPzZiNmQiXSwic291cmNlc0NvbnRlbnQiOlsiXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh2MSwgb3BlcmF0b3IsIHYyLCBvcHRpb25zKSB7XG5cbiAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7XG4gICAgICAgIGNhc2UgJz09JzpcbiAgICAgICAgICAgIHJldHVybiAodjEgPT0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgY2FzZSAnPT09JzpcbiAgICAgICAgICAgIHJldHVybiAodjEgPT09IHYyKSA/IG9wdGlvbnMuZm4odGhpcykgOiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgIGNhc2UgJzwnOlxuICAgICAgICAgICAgcmV0dXJuICh2MSA8IHYyKSA/IG9wdGlvbnMuZm4odGhpcykgOiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgIGNhc2UgJzw9JzpcbiAgICAgICAgICAgIHJldHVybiAodjEgPD0gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgY2FzZSAnPic6XG4gICAgICAgICAgICByZXR1cm4gKHYxID4gdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgY2FzZSAnPj0nOlxuICAgICAgICAgICAgcmV0dXJuICh2MSA+PSB2MikgPyBvcHRpb25zLmZuKHRoaXMpIDogb3B0aW9ucy5pbnZlcnNlKHRoaXMpO1xuICAgICAgICBjYXNlICcmJic6XG4gICAgICAgICAgICByZXR1cm4gKHYxICYmIHYyKSA/IG9wdGlvbnMuZm4odGhpcykgOiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICAgIGNhc2UgJ3x8JzpcbiAgICAgICAgICAgIHJldHVybiAodjEgfHwgdjIpID8gb3B0aW9ucy5mbih0aGlzKSA6IG9wdGlvbnMuaW52ZXJzZSh0aGlzKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2hhcmVkL3RlbXBsYXRlSGVscGVycy9pZkNvbmQuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbEJBO0FBb0JBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 49 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \" \\n    <li class=\\\"js-browse__item\\\" data-url=\\\"\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(2, data, 0),\"inverse\":this.program(4, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\" >\\n        <span class=\\\"page__container\\\">\\n            <span class=\\\"js-browse__item-title page__item\"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(6, data, 0),\"inverse\":this.program(8, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \" \"\n    + ((stack1 = __default(__webpack_require__(48)).call(depth0,((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.title : stack1),\"===\",\"visualisations\",{\"name\":\"ifCond\",\"hash\":{},\"fn\":this.program(10, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\"\n    + this.escapeExpression(this.lambda(((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.title : stack1), depth0))\n    + \"</span>\\n            <div class=\\\"page__buttons page__buttons--list\\\">\\n                \"\n    + ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(12, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.uri : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(14, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"            </div>\\n        </span>\\n        \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.children : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(16, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"    </li>\\n\";\n},\"2\":function(depth0,helpers,partials,data) {\n    return this.escapeExpression(this.lambda((depth0 != null ? depth0.uri : depth0), depth0));\n},\"4\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"/\"\n    + this.escapeExpression(this.lambda(((stack1 = (depth0 != null ? depth0.description : depth0)) != null ? stack1.title : stack1), depth0));\n},\"6\":function(depth0,helpers,partials,data) {\n    return \" page__item--directory\";\n},\"8\":function(depth0,helpers,partials,data) {\n    return \" page__item--\"\n    + this.escapeExpression(this.lambda((depth0 != null ? depth0.type : depth0), depth0));\n},\"10\":function(depth0,helpers,partials,data) {\n    return \"datavis-directory\";\n},\"12\":function(depth0,helpers,partials,data) {\n    return \"<button class=\\\"btn btn--positive btn-browse-create-datavis\\\">Upload visualisation</button>\";\n},\"14\":function(depth0,helpers,partials,data) {\n    return \"                    <button class=\\\"btn btn--primary btn-browse-edit\\\">Edit</button>\\n\";\n},\"16\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \" \\n            <ul class=\\\"js-browse__children\\\">\\n                \"\n    + ((stack1 = this.invokePartial(__webpack_require__(49),depth0,{\"name\":\"browseVisNode\",\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \" \\n            </ul>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return ((stack1 = helpers.each.call(depth0,(depth0 != null ? depth0.children : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"usePartial\":true,\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2Jyb3dzZS9icm93c2VWaXNOb2RlLmhhbmRsZWJhcnM/MDdlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgSGFuZGxlYmFycyA9IHJlcXVpcmUoXCIvVXNlcnMvY3Jpc3Bpbm1lcnJpbWFuL0dpdC9vbnNkaWdpdGFsL2Zsb3JlbmNlL3NyYy9ub2RlX21vZHVsZXMvaGFuZGxlYmFycy9ydW50aW1lLmpzXCIpO1xuZnVuY3Rpb24gX19kZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIChvYmouX19lc01vZHVsZSA/IG9ialtcImRlZmF1bHRcIl0gOiBvYmopOyB9XG5tb2R1bGUuZXhwb3J0cyA9IChIYW5kbGViYXJzW1wiZGVmYXVsdFwiXSB8fCBIYW5kbGViYXJzKS50ZW1wbGF0ZSh7XCIxXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiIFxcbiAgICA8bGkgY2xhc3M9XFxcImpzLWJyb3dzZV9faXRlbVxcXCIgZGF0YS11cmw9XFxcIlwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnNbJ2lmJ10uY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLnVyaSA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDIsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMucHJvZ3JhbSg0LCBkYXRhLCAwKSxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCJcXFwiID5cXG4gICAgICAgIDxzcGFuIGNsYXNzPVxcXCJwYWdlX19jb250YWluZXJcXFwiPlxcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJqcy1icm93c2VfX2l0ZW0tdGl0bGUgcGFnZV9faXRlbVwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnMudW5sZXNzLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC51cmkgOiBkZXB0aDApLHtcIm5hbWVcIjpcInVubGVzc1wiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oNiwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5wcm9ncmFtKDgsIGRhdGEsIDApLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIiBcIlxuICAgICsgKChzdGFjazEgPSBfX2RlZmF1bHQocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC9zaGFyZWQvdGVtcGxhdGVIZWxwZXJzL2lmQ29uZC5qc1wiKSkuY2FsbChkZXB0aDAsKChzdGFjazEgPSAoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuZGVzY3JpcHRpb24gOiBkZXB0aDApKSAhPSBudWxsID8gc3RhY2sxLnRpdGxlIDogc3RhY2sxKSxcIj09PVwiLFwidmlzdWFsaXNhdGlvbnNcIix7XCJuYW1lXCI6XCJpZkNvbmRcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDEwLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxcIj5cIlxuICAgICsgdGhpcy5lc2NhcGVFeHByZXNzaW9uKHRoaXMubGFtYmRhKCgoc3RhY2sxID0gKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmRlc2NyaXB0aW9uIDogZGVwdGgwKSkgIT0gbnVsbCA/IHN0YWNrMS50aXRsZSA6IHN0YWNrMSksIGRlcHRoMCkpXG4gICAgKyBcIjwvc3Bhbj5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwYWdlX19idXR0b25zIHBhZ2VfX2J1dHRvbnMtLWxpc3RcXFwiPlxcbiAgICAgICAgICAgICAgICBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzLnVubGVzcy5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudXJpIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJ1bmxlc3NcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDEyLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxuXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVyc1snaWYnXS5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudXJpIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJpZlwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMTQsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCIgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvc3Bhbj5cXG4gICAgICAgIFwiXG4gICAgKyAoKHN0YWNrMSA9IGhlbHBlcnNbJ2lmJ10uY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmNoaWxkcmVuIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJpZlwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMTYsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKVxuICAgICsgXCIgICAgPC9saT5cXG5cIjtcbn0sXCIyXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiB0aGlzLmVzY2FwZUV4cHJlc3Npb24odGhpcy5sYW1iZGEoKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLnVyaSA6IGRlcHRoMCksIGRlcHRoMCkpO1xufSxcIjRcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCIvXCJcbiAgICArIHRoaXMuZXNjYXBlRXhwcmVzc2lvbih0aGlzLmxhbWJkYSgoKHN0YWNrMSA9IChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5kZXNjcmlwdGlvbiA6IGRlcHRoMCkpICE9IG51bGwgPyBzdGFjazEudGl0bGUgOiBzdGFjazEpLCBkZXB0aDApKTtcbn0sXCI2XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIiBwYWdlX19pdGVtLS1kaXJlY3RvcnlcIjtcbn0sXCI4XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIiBwYWdlX19pdGVtLS1cIlxuICAgICsgdGhpcy5lc2NhcGVFeHByZXNzaW9uKHRoaXMubGFtYmRhKChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC50eXBlIDogZGVwdGgwKSwgZGVwdGgwKSk7XG59LFwiMTBcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgcmV0dXJuIFwiZGF0YXZpcy1kaXJlY3RvcnlcIjtcbn0sXCIxMlwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCI8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLS1wb3NpdGl2ZSBidG4tYnJvd3NlLWNyZWF0ZS1kYXRhdmlzXFxcIj5VcGxvYWQgdmlzdWFsaXNhdGlvbjwvYnV0dG9uPlwiO1xufSxcIjE0XCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHJldHVybiBcIiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIGJ0bi0tcHJpbWFyeSBidG4tYnJvd3NlLWVkaXRcXFwiPkVkaXQ8L2J1dHRvbj5cXG5cIjtcbn0sXCIxNlwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICB2YXIgc3RhY2sxO1xuXG4gIHJldHVybiBcIiBcXG4gICAgICAgICAgICA8dWwgY2xhc3M9XFxcImpzLWJyb3dzZV9fY2hpbGRyZW5cXFwiPlxcbiAgICAgICAgICAgICAgICBcIlxuICAgICsgKChzdGFjazEgPSB0aGlzLmludm9rZVBhcnRpYWwocmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL2FwcC93b3Jrc3BhY2UvYnJvd3NlL2Jyb3dzZVZpc05vZGUuaGFuZGxlYmFyc1wiKSxkZXB0aDAse1wibmFtZVwiOlwiYnJvd3NlVmlzTm9kZVwiLFwiZGF0YVwiOmRhdGEsXCJoZWxwZXJzXCI6aGVscGVycyxcInBhcnRpYWxzXCI6cGFydGlhbHN9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIiBcXG4gICAgICAgICAgICA8L3VsPlxcblwiO1xufSxcImNvbXBpbGVyXCI6WzYsXCI+PSAyLjAuMC1iZXRhLjFcIl0sXCJtYWluXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuICgoc3RhY2sxID0gaGVscGVycy5lYWNoLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5jaGlsZHJlbiA6IGRlcHRoMCkse1wibmFtZVwiOlwiZWFjaFwiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oMSwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpO1xufSxcInVzZVBhcnRpYWxcIjp0cnVlLFwidXNlRGF0YVwiOnRydWV9KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2FwcC93b3Jrc3BhY2UvYnJvd3NlL2Jyb3dzZVZpc05vZGUuaGFuZGxlYmFyc1xuLy8gbW9kdWxlIGlkID0gNDlcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 50 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar collectionState = __webpack_require__(28),\n    get = __webpack_require__(51);\n\nvar getBrowseTree = function getBrowseTree() {\n    return get(\"/zebedee/collectionBrowseTree/\" + collectionState.get().id);\n};\n\nmodule.exports = getBrowseTree;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9hcGkvZ2V0QnJvd3NlVHJlZS5qcz8yZWM0Il0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIGNvbGxlY3Rpb25TdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUnKSxcbiAgICBnZXQgPSByZXF1aXJlKCdzaGFyZWQvdXRpbGl0aWVzL2dldCcpO1xuXG52YXIgZ2V0QnJvd3NlVHJlZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnZXQoXCIvemViZWRlZS9jb2xsZWN0aW9uQnJvd3NlVHJlZS9cIiArIGNvbGxlY3Rpb25TdGF0ZS5nZXQoKS5pZCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGdldEJyb3dzZVRyZWU7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC9hcGkvZ2V0QnJvd3NlVHJlZS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 51 */
/***/ function(module, exports) {

	eval("\"use strict\";\n\n/**\n * High-level wrapper for the Fetch API (see this post for explanation - https://medium.com/@shahata/why-i-wont-be-using-fetch-api-in-my-apps-6900e6c6fe78#.o6k6ai5fj)\n *\n * @param uri - URI that the GET request is being sent to\n * @returns {Promise}\n */\n\nvar get = function get(uri) {\n\n    return new Promise(function (resolve, reject) {\n        fetch(uri, {\n            credentials: \"include\"\n        }).then(function (response) {\n            return response.json().then(function (data) {\n                if (response.ok) {\n                    return data;\n                } else {\n                    reject({ status: response.status, message: data.message });\n                }\n            });\n        }).then(function (responseJSON) {\n            resolve(responseJSON);\n        }).catch(function (fetchError) {\n            reject(fetchError);\n        });\n    });\n};\n\nmodule.exports = get;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC91dGlsaXRpZXMvZ2V0LmpzP2M5ZGQiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBIaWdoLWxldmVsIHdyYXBwZXIgZm9yIHRoZSBGZXRjaCBBUEkgKHNlZSB0aGlzIHBvc3QgZm9yIGV4cGxhbmF0aW9uIC0gaHR0cHM6Ly9tZWRpdW0uY29tL0BzaGFoYXRhL3doeS1pLXdvbnQtYmUtdXNpbmctZmV0Y2gtYXBpLWluLW15LWFwcHMtNjkwMGU2YzZmZTc4Iy5vNms2YWk1ZmopXG4gKlxuICogQHBhcmFtIHVyaSAtIFVSSSB0aGF0IHRoZSBHRVQgcmVxdWVzdCBpcyBiZWluZyBzZW50IHRvXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xuXG5cbnZhciBnZXQgPSBmdW5jdGlvbih1cmkpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZmV0Y2godXJpLCB7XG4gICAgICAgICAgICBjcmVkZW50aWFsczogXCJpbmNsdWRlXCJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe3N0YXR1czogcmVzcG9uc2Uuc3RhdHVzLCBtZXNzYWdlOiBkYXRhLm1lc3NhZ2V9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlSlNPTikge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZUpTT04pO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihmZXRjaEVycm9yKSB7XG4gICAgICAgICAgICByZWplY3QoZmV0Y2hFcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBnZXQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC91dGlsaXRpZXMvZ2V0LmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 52 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar editView = __webpack_require__(53),\n    workspaceState = __webpack_require__(25),\n    getActivePage = __webpack_require__(56),\n    i,\n    velocity = __webpack_require__(57);\n\nvar editController = {\n\n    init: function init() {\n\n        if ($.isEmptyObject(workspaceState.editorData.get())) {\n            // No current editorData, get data for activeURL from API and re-run this initialisation\n            editView.render.loader();\n            getActivePage().then(function (pageData) {\n                workspaceState.editorData.set(pageData);\n                editController.init();\n            }).catch(function (error) {\n                console.log(error);\n            });\n\n            return false;\n        }\n\n        editView.render.accordions(editController.build.accordions());\n        this.bind.accordions();\n        console.log(\"Render from state, no request to Zebedee required\");\n    },\n\n    build: {\n\n        accordions: function accordions() {\n            var HTML = [];\n\n            if (workspaceState.editorData.get().sections) {\n                HTML.push(editController.build.sections());\n            }\n\n            return HTML.join('');\n        },\n\n        sections: function sections() {\n            var templateData = {\n                id: \"sections\",\n                heading: \"Sections\",\n                itemName: \"section\",\n                items: []\n            },\n                editorData = workspaceState.editorData.get(),\n                sectionsLength = editorData.sections.length;\n\n            // Map editorData sections to accordion template data\n            for (i = 0; i < sectionsLength; i++) {\n                templateData.items.push({ title: editorData.sections[i].title, value: editorData.sections[i].markdown });\n            }\n\n            return editView.accordionHTML(templateData);\n        }\n    },\n\n    bind: {\n\n        accordions: function accordions() {\n            var $headings = $('.js-editor-accordion__heading'),\n                $bodys = $('.js-editor-accordion__body'),\n                $this;\n\n            // Display hidden body and set negative margin in preparation for being animated later\n            $bodys.each(function () {\n                $this = $(this);\n                $this.css('display', 'block');\n                $this.css('margin-top', -$this.outerHeight());\n            });\n\n            // If a heading has 'active' class then open it (unanimated)\n            $headings.each(function () {\n                $this = $(this);\n                if ($this.hasClass('active')) {\n                    var $thisBody = $this.next('.js-editor-accordion__body');\n                    $thisBody.css({ display: 'block', marginTop: 0 }).addClass('active');\n                    return true;\n                }\n            });\n\n            // Toggle accordions on click\n            $headings.click(function () {\n                var $this = $(this),\n                    $thisBody = $this.next('.js-editor-accordion__body'),\n                    $previousHeading = $('.js-editor-accordion__heading.active'),\n                    $previousBody = $('.js-editor-accordion__body.active');\n\n                if ($thisBody.hasClass('active')) {\n                    $thisBody.velocity({ marginTop: -$thisBody.outerHeight() }, { duration: 350 });\n                    $this.removeClass('active');\n                    $thisBody.removeClass('active');\n                    return;\n                }\n\n                $previousHeading.removeClass('active');\n                $previousBody.removeClass('active').velocity({ marginTop: -$previousBody.outerHeight() }, { duration: 350 });\n\n                $thisBody.velocity({ marginTop: 0 }, { duration: 350 });\n                $this.addClass('active');\n                $thisBody.addClass('active');\n            });\n        }\n\n    }\n\n};\n\nmodule.exports = editController;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9lZGl0L2VkaXRDb250cm9sbGVyLmpzPzU5OWIiXSwic291cmNlc0NvbnRlbnQiOlsiXG52YXIgZWRpdFZpZXcgPSByZXF1aXJlKCd3b3Jrc3BhY2UvZWRpdC9lZGl0Vmlldy5qcycpLFxuICAgIHdvcmtzcGFjZVN0YXRlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3dvcmtzcGFjZVN0YXRlJyksXG4gICAgZ2V0QWN0aXZlUGFnZSA9IHJlcXVpcmUoJ3NoYXJlZC9hcGkvZ2V0QWN0aXZlUGFnZScpLFxuICAgIGksXG4gICAgdmVsb2NpdHkgPSByZXF1aXJlKCd2ZWxvY2l0eS1hbmltYXRlJyk7XG5cbnZhciBlZGl0Q29udHJvbGxlciA9IHtcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmICgkLmlzRW1wdHlPYmplY3Qod29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKSkpIHtcbiAgICAgICAgICAgIC8vIE5vIGN1cnJlbnQgZWRpdG9yRGF0YSwgZ2V0IGRhdGEgZm9yIGFjdGl2ZVVSTCBmcm9tIEFQSSBhbmQgcmUtcnVuIHRoaXMgaW5pdGlhbGlzYXRpb25cbiAgICAgICAgICAgIGVkaXRWaWV3LnJlbmRlci5sb2FkZXIoKTtcbiAgICAgICAgICAgIGdldEFjdGl2ZVBhZ2UoKS50aGVuKGZ1bmN0aW9uKHBhZ2VEYXRhKSB7XG4gICAgICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5zZXQocGFnZURhdGEpO1xuICAgICAgICAgICAgICAgIGVkaXRDb250cm9sbGVyLmluaXQoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVkaXRWaWV3LnJlbmRlci5hY2NvcmRpb25zKGVkaXRDb250cm9sbGVyLmJ1aWxkLmFjY29yZGlvbnMoKSk7XG4gICAgICAgIHRoaXMuYmluZC5hY2NvcmRpb25zKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUmVuZGVyIGZyb20gc3RhdGUsIG5vIHJlcXVlc3QgdG8gWmViZWRlZSByZXF1aXJlZFwiKTtcbiAgICB9LFxuXG4gICAgYnVpbGQ6IHtcblxuICAgICAgICBhY2NvcmRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBIVE1MID0gW107XG5cbiAgICAgICAgICAgIGlmICh3b3Jrc3BhY2VTdGF0ZS5lZGl0b3JEYXRhLmdldCgpLnNlY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgSFRNTC5wdXNoKGVkaXRDb250cm9sbGVyLmJ1aWxkLnNlY3Rpb25zKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gSFRNTC5qb2luKCcnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZWN0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGVtcGxhdGVEYXRhID0ge1xuICAgICAgICAgICAgICAgIGlkOiBcInNlY3Rpb25zXCIsXG4gICAgICAgICAgICAgICAgaGVhZGluZzogXCJTZWN0aW9uc1wiLFxuICAgICAgICAgICAgICAgIGl0ZW1OYW1lOiBcInNlY3Rpb25cIixcbiAgICAgICAgICAgICAgICBpdGVtczogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlZGl0b3JEYXRhID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKSxcbiAgICAgICAgICAgIHNlY3Rpb25zTGVuZ3RoID0gZWRpdG9yRGF0YS5zZWN0aW9ucy5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIE1hcCBlZGl0b3JEYXRhIHNlY3Rpb25zIHRvIGFjY29yZGlvbiB0ZW1wbGF0ZSBkYXRhXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VjdGlvbnNMZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlRGF0YS5pdGVtcy5wdXNoKHt0aXRsZTogZWRpdG9yRGF0YS5zZWN0aW9uc1tpXS50aXRsZSwgdmFsdWU6IGVkaXRvckRhdGEuc2VjdGlvbnNbaV0ubWFya2Rvd259KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZWRpdFZpZXcuYWNjb3JkaW9uSFRNTCh0ZW1wbGF0ZURhdGEpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGJpbmQ6IHtcblxuICAgICAgICBhY2NvcmRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkaGVhZGluZ3MgPSAkKCcuanMtZWRpdG9yLWFjY29yZGlvbl9faGVhZGluZycpLFxuICAgICAgICAgICAgICAgICRib2R5cyA9ICQoJy5qcy1lZGl0b3ItYWNjb3JkaW9uX19ib2R5JyksXG4gICAgICAgICAgICAgICAgJHRoaXM7XG5cbiAgICAgICAgICAgIC8vIERpc3BsYXkgaGlkZGVuIGJvZHkgYW5kIHNldCBuZWdhdGl2ZSBtYXJnaW4gaW4gcHJlcGFyYXRpb24gZm9yIGJlaW5nIGFuaW1hdGVkIGxhdGVyXG4gICAgICAgICAgICAkYm9keXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgJHRoaXMuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgJHRoaXMuY3NzKCdtYXJnaW4tdG9wJywgLSR0aGlzLm91dGVySGVpZ2h0KCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIElmIGEgaGVhZGluZyBoYXMgJ2FjdGl2ZScgY2xhc3MgdGhlbiBvcGVuIGl0ICh1bmFuaW1hdGVkKVxuICAgICAgICAgICAgJGhlYWRpbmdzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzQm9keSA9ICR0aGlzLm5leHQoJy5qcy1lZGl0b3ItYWNjb3JkaW9uX19ib2R5Jyk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzQm9keS5jc3Moe2Rpc3BsYXk6ICdibG9jaycsIG1hcmdpblRvcDogMCB9KS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBUb2dnbGUgYWNjb3JkaW9ucyBvbiBjbGlja1xuICAgICAgICAgICAgJGhlYWRpbmdzLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICR0aGlzQm9keSA9ICR0aGlzLm5leHQoJy5qcy1lZGl0b3ItYWNjb3JkaW9uX19ib2R5JyksXG4gICAgICAgICAgICAgICAgICAgICRwcmV2aW91c0hlYWRpbmcgPSAkKCcuanMtZWRpdG9yLWFjY29yZGlvbl9faGVhZGluZy5hY3RpdmUnKSxcbiAgICAgICAgICAgICAgICAgICAgJHByZXZpb3VzQm9keSA9ICQoJy5qcy1lZGl0b3ItYWNjb3JkaW9uX19ib2R5LmFjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzQm9keS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXNCb2R5LnZlbG9jaXR5KHsgbWFyZ2luVG9wOiAtJHRoaXNCb2R5Lm91dGVySGVpZ2h0KCl9LCB7IGR1cmF0aW9uOiAzNTAgfSk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXNCb2R5LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICRwcmV2aW91c0hlYWRpbmcucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICRwcmV2aW91c0JvZHkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLnZlbG9jaXR5KHsgbWFyZ2luVG9wOiAtJHByZXZpb3VzQm9keS5vdXRlckhlaWdodCgpfSwgeyBkdXJhdGlvbjogMzUwIH0pO1xuXG4gICAgICAgICAgICAgICAgJHRoaXNCb2R5LnZlbG9jaXR5KHsgbWFyZ2luVG9wOiAwfSwgeyBkdXJhdGlvbjogMzUwIH0pO1xuICAgICAgICAgICAgICAgICR0aGlzLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkdGhpc0JvZHkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH1cblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBlZGl0Q29udHJvbGxlcjtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvd29ya3NwYWNlL2VkaXQvZWRpdENvbnRyb2xsZXIuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUFBO0FBQUE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUJBO0FBQ0E7QUE4QkE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlDQTtBQUNBO0FBdERBO0FBQ0E7QUF1R0E7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 53 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar editTemplate = __webpack_require__(54),\n    accordionTemplate = __webpack_require__(55);\n\nvar editView = {\n\n    render: {\n\n        loader: function loader() {\n            document.getElementById('workspace-browse').innerHTML = editTemplate();\n        },\n\n        accordions: function accordions(HTML) {\n            document.getElementById('workspace-browse').innerHTML = HTML;\n        }\n    },\n\n    accordionHTML: function accordionHTML(templateData) {\n        /* templateData should follow structure of:\n        {\n            id: \"\",\n            heading: \"\",\n            items: [\n                {\n                    title: \"\"\n                }\n            ]\n        }\n        */\n        return accordionTemplate(templateData);\n    }\n\n};\n\nmodule.exports = editView;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9lZGl0L2VkaXRWaWV3LmpzPzNkY2QiXSwic291cmNlc0NvbnRlbnQiOlsiXG52YXIgZWRpdFRlbXBsYXRlID0gcmVxdWlyZSgnLi9lZGl0LmhhbmRsZWJhcnMnKSxcbiAgICBhY2NvcmRpb25UZW1wbGF0ZSA9IHJlcXVpcmUoJy4vZWRpdEFjY29yZGlvbi5oYW5kbGViYXJzJyk7XG5cbnZhciBlZGl0VmlldyA9IHtcblxuICAgIHJlbmRlcjoge1xuXG4gICAgICAgIGxvYWRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dvcmtzcGFjZS1icm93c2UnKS5pbm5lckhUTUwgPSBlZGl0VGVtcGxhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhY2NvcmRpb25zOiBmdW5jdGlvbihIVE1MKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NwYWNlLWJyb3dzZScpLmlubmVySFRNTCA9IEhUTUw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWNjb3JkaW9uSFRNTDogZnVuY3Rpb24odGVtcGxhdGVEYXRhKSB7XG4gICAgICAgIC8qIHRlbXBsYXRlRGF0YSBzaG91bGQgZm9sbG93IHN0cnVjdHVyZSBvZjpcbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6IFwiXCIsXG4gICAgICAgICAgICBoZWFkaW5nOiBcIlwiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICAgICovXG4gICAgICAgIHJldHVybiBhY2NvcmRpb25UZW1wbGF0ZSh0ZW1wbGF0ZURhdGEpO1xuICAgIH1cblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBlZGl0VmlldztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvd29ya3NwYWNlL2VkaXQvZWRpdFZpZXcuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQTNCQTtBQUNBO0FBNkJBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 54 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<div id=\\\"js-edit\\\">\\n    <div class=\\\"margin-top--3\\\">\"\n    + ((stack1 = this.invokePartial(__webpack_require__(40),depth0,{\"name\":\"../../shared/templatePartials/loadingAnimation\",\"hash\":{\"dark\":true,\"large\":true},\"data\":data,\"helpers\":helpers,\"partials\":partials})) != null ? stack1 : \"\")\n    + \"</div>\\n</div>\";\n},\"usePartial\":true,\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2VkaXQvZWRpdC5oYW5kbGViYXJzPzQ4NDUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gXCI8ZGl2IGlkPVxcXCJqcy1lZGl0XFxcIj5cXG4gICAgPGRpdiBjbGFzcz1cXFwibWFyZ2luLXRvcC0tM1xcXCI+XCJcbiAgICArICgoc3RhY2sxID0gdGhpcy5pbnZva2VQYXJ0aWFsKHJlcXVpcmUoXCIvVXNlcnMvY3Jpc3Bpbm1lcnJpbWFuL0dpdC9vbnNkaWdpdGFsL2Zsb3JlbmNlL3NyYy9hcHAvc2hhcmVkL3RlbXBsYXRlUGFydGlhbHMvbG9hZGluZ0FuaW1hdGlvbi5oYW5kbGViYXJzXCIpLGRlcHRoMCx7XCJuYW1lXCI6XCIuLi8uLi9zaGFyZWQvdGVtcGxhdGVQYXJ0aWFscy9sb2FkaW5nQW5pbWF0aW9uXCIsXCJoYXNoXCI6e1wiZGFya1wiOnRydWUsXCJsYXJnZVwiOnRydWV9LFwiZGF0YVwiOmRhdGEsXCJoZWxwZXJzXCI6aGVscGVycyxcInBhcnRpYWxzXCI6cGFydGlhbHN9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpXG4gICAgKyBcIjwvZGl2PlxcbjwvZGl2PlwiO1xufSxcInVzZVBhcnRpYWxcIjp0cnVlLFwidXNlRGF0YVwiOnRydWV9KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2FwcC93b3Jrc3BhY2UvZWRpdC9lZGl0LmhhbmRsZWJhcnNcbi8vIG1vZHVsZSBpZCA9IDU0XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 55 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    var helper;\n\n  return \"                <li class=\\\"editor-accordion__item\\\">\\n                    \"\n    + this.escapeExpression(((helper = (helper = helpers.itemHTML || (depth0 != null ? depth0.itemHTML : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0,{\"name\":\"itemHTML\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\n                </li>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1, helper, alias1=helpers.helperMissing, alias2=\"function\", alias3=this.escapeExpression;\n\n  return \"<div class=\\\"editor-accordion\\\" id=\\\"\"\n    + alias3(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\\n    <h2 class=\\\"editor-accordion__heading js-editor-accordion__heading\\\">\"\n    + alias3(((helper = (helper = helpers.heading || (depth0 != null ? depth0.heading : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"heading\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</h2>\\n    <div class=\\\"editor-accordion__body js-editor-accordion__body\\\">\\n        <ul class=\\\"list list--neutral\\\">\\n\"\n    + ((stack1 = helpers.each.call(depth0,(depth0 != null ? depth0.items : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"        </ul>\\n        <div class=\\\"text-center\\\">\\n            <button class=\\\"btn btn--subtle\\\">New \"\n    + alias3(((helper = (helper = helpers.itemName || (depth0 != null ? depth0.itemName : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"itemName\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</button>\\n        </div>\\n    </div>\\n</div>\";\n},\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2VkaXQvZWRpdEFjY29yZGlvbi5oYW5kbGViYXJzP2RiMTAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiMVwiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICB2YXIgaGVscGVyO1xuXG4gIHJldHVybiBcIiAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XFxcImVkaXRvci1hY2NvcmRpb25fX2l0ZW1cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgXCJcbiAgICArIHRoaXMuZXNjYXBlRXhwcmVzc2lvbigoKGhlbHBlciA9IChoZWxwZXIgPSBoZWxwZXJzLml0ZW1IVE1MIHx8IChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5pdGVtSFRNTCA6IGRlcHRoMCkpICE9IG51bGwgPyBoZWxwZXIgOiBoZWxwZXJzLmhlbHBlck1pc3NpbmcpLCh0eXBlb2YgaGVscGVyID09PSBcImZ1bmN0aW9uXCIgPyBoZWxwZXIuY2FsbChkZXB0aDAse1wibmFtZVwiOlwiaXRlbUhUTUxcIixcImhhc2hcIjp7fSxcImRhdGFcIjpkYXRhfSkgOiBoZWxwZXIpKSlcbiAgICArIFwiXFxuICAgICAgICAgICAgICAgIDwvbGk+XFxuXCI7XG59LFwiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMSwgaGVscGVyLCBhbGlhczE9aGVscGVycy5oZWxwZXJNaXNzaW5nLCBhbGlhczI9XCJmdW5jdGlvblwiLCBhbGlhczM9dGhpcy5lc2NhcGVFeHByZXNzaW9uO1xuXG4gIHJldHVybiBcIjxkaXYgY2xhc3M9XFxcImVkaXRvci1hY2NvcmRpb25cXFwiIGlkPVxcXCJcIlxuICAgICsgYWxpYXMzKCgoaGVscGVyID0gKGhlbHBlciA9IGhlbHBlcnMuaWQgfHwgKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmlkIDogZGVwdGgwKSkgIT0gbnVsbCA/IGhlbHBlciA6IGFsaWFzMSksKHR5cGVvZiBoZWxwZXIgPT09IGFsaWFzMiA/IGhlbHBlci5jYWxsKGRlcHRoMCx7XCJuYW1lXCI6XCJpZFwiLFwiaGFzaFwiOnt9LFwiZGF0YVwiOmRhdGF9KSA6IGhlbHBlcikpKVxuICAgICsgXCJcXFwiPlxcbiAgICA8aDIgY2xhc3M9XFxcImVkaXRvci1hY2NvcmRpb25fX2hlYWRpbmcganMtZWRpdG9yLWFjY29yZGlvbl9faGVhZGluZ1xcXCI+XCJcbiAgICArIGFsaWFzMygoKGhlbHBlciA9IChoZWxwZXIgPSBoZWxwZXJzLmhlYWRpbmcgfHwgKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmhlYWRpbmcgOiBkZXB0aDApKSAhPSBudWxsID8gaGVscGVyIDogYWxpYXMxKSwodHlwZW9mIGhlbHBlciA9PT0gYWxpYXMyID8gaGVscGVyLmNhbGwoZGVwdGgwLHtcIm5hbWVcIjpcImhlYWRpbmdcIixcImhhc2hcIjp7fSxcImRhdGFcIjpkYXRhfSkgOiBoZWxwZXIpKSlcbiAgICArIFwiPC9oMj5cXG4gICAgPGRpdiBjbGFzcz1cXFwiZWRpdG9yLWFjY29yZGlvbl9fYm9keSBqcy1lZGl0b3ItYWNjb3JkaW9uX19ib2R5XFxcIj5cXG4gICAgICAgIDx1bCBjbGFzcz1cXFwibGlzdCBsaXN0LS1uZXV0cmFsXFxcIj5cXG5cIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzLmVhY2guY2FsbChkZXB0aDAsKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLml0ZW1zIDogZGVwdGgwKSx7XCJuYW1lXCI6XCJlYWNoXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiICAgICAgICA8L3VsPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwidGV4dC1jZW50ZXJcXFwiPlxcbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXN1YnRsZVxcXCI+TmV3IFwiXG4gICAgKyBhbGlhczMoKChoZWxwZXIgPSAoaGVscGVyID0gaGVscGVycy5pdGVtTmFtZSB8fCAoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuaXRlbU5hbWUgOiBkZXB0aDApKSAhPSBudWxsID8gaGVscGVyIDogYWxpYXMxKSwodHlwZW9mIGhlbHBlciA9PT0gYWxpYXMyID8gaGVscGVyLmNhbGwoZGVwdGgwLHtcIm5hbWVcIjpcIml0ZW1OYW1lXCIsXCJoYXNoXCI6e30sXCJkYXRhXCI6ZGF0YX0pIDogaGVscGVyKSkpXG4gICAgKyBcIjwvYnV0dG9uPlxcbiAgICAgICAgPC9kaXY+XFxuICAgIDwvZGl2PlxcbjwvZGl2PlwiO1xufSxcInVzZURhdGFcIjp0cnVlfSk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9hcHAvd29ya3NwYWNlL2VkaXQvZWRpdEFjY29yZGlvbi5oYW5kbGViYXJzXG4vLyBtb2R1bGUgaWQgPSA1NVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 56 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar collectionState = __webpack_require__(28),\n    workspaceState = __webpack_require__(25),\n    get = __webpack_require__(51);\n\nvar getActivePage = function getActivePage() {\n    return get('/zebedee/data/' + collectionState.get().id + '?uri=' + workspaceState.activeUrl.get());\n};\n\nmodule.exports = getActivePage;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9hcGkvZ2V0QWN0aXZlUGFnZS5qcz9lZjIyIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBjb2xsZWN0aW9uU3RhdGUgPSByZXF1aXJlKCdzaGFyZWQvc3RhdGUvY29sbGVjdGlvblN0YXRlJyksXG4gICAgd29ya3NwYWNlU3RhdGUgPSByZXF1aXJlKCdzaGFyZWQvc3RhdGUvd29ya3NwYWNlU3RhdGUnKSxcbiAgICBnZXQgPSByZXF1aXJlKCdzaGFyZWQvdXRpbGl0aWVzL2dldCcpO1xuXG52YXIgZ2V0QWN0aXZlUGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBnZXQoJy96ZWJlZGVlL2RhdGEvJyArIGNvbGxlY3Rpb25TdGF0ZS5nZXQoKS5pZCArICc/dXJpPScgKyB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVVcmwuZ2V0KCkpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBnZXRBY3RpdmVQYWdlO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9zaGFyZWQvYXBpL2dldEFjdGl2ZVBhZ2UuanMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 57 */
/***/ function(module, exports, __webpack_require__) {

	eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/* WEBPACK VAR INJECTION */(function(console) {/*! VelocityJS.org (1.3.1). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */\n\n/*************************\n Velocity jQuery Shim\n *************************/\n\n/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */\n\n/* This file contains the jQuery functions that Velocity relies on, thereby removing Velocity's dependency on a full copy of jQuery, and allowing it to work in any environment. */\n/* These shimmed functions are only used if jQuery isn't present. If both this shim and jQuery are loaded, Velocity defaults to jQuery proper. */\n/* Browser support: Using this shim instead of jQuery proper removes support for IE8. */\n\n(function(window) {\n\t\"use strict\";\n\t/***************\n\t Setup\n\t ***************/\n\n\t/* If jQuery is already loaded, there's no point in loading this shim. */\n\tif (window.jQuery) {\n\t\treturn;\n\t}\n\n\t/* jQuery base. */\n\tvar $ = function(selector, context) {\n\t\treturn new $.fn.init(selector, context);\n\t};\n\n\t/********************\n\t Private Methods\n\t ********************/\n\n\t/* jQuery */\n\t$.isWindow = function(obj) {\n\t\t/* jshint eqeqeq: false */\n\t\treturn obj && obj === obj.window;\n\t};\n\n\t/* jQuery */\n\t$.type = function(obj) {\n\t\tif (!obj) {\n\t\t\treturn obj + \"\";\n\t\t}\n\n\t\treturn typeof obj === \"object\" || typeof obj === \"function\" ?\n\t\t\t\tclass2type[toString.call(obj)] || \"object\" :\n\t\t\t\ttypeof obj;\n\t};\n\n\t/* jQuery */\n\t$.isArray = Array.isArray || function(obj) {\n\t\treturn $.type(obj) === \"array\";\n\t};\n\n\t/* jQuery */\n\tfunction isArraylike(obj) {\n\t\tvar length = obj.length,\n\t\t\t\ttype = $.type(obj);\n\n\t\tif (type === \"function\" || $.isWindow(obj)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (obj.nodeType === 1 && length) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn type === \"array\" || length === 0 || typeof length === \"number\" && length > 0 && (length - 1) in obj;\n\t}\n\n\t/***************\n\t $ Methods\n\t ***************/\n\n\t/* jQuery: Support removed for IE<9. */\n\t$.isPlainObject = function(obj) {\n\t\tvar key;\n\n\t\tif (!obj || $.type(obj) !== \"object\" || obj.nodeType || $.isWindow(obj)) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tif (obj.constructor &&\n\t\t\t\t\t!hasOwn.call(obj, \"constructor\") &&\n\t\t\t\t\t!hasOwn.call(obj.constructor.prototype, \"isPrototypeOf\")) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (key in obj) {\n\t\t}\n\n\t\treturn key === undefined || hasOwn.call(obj, key);\n\t};\n\n\t/* jQuery */\n\t$.each = function(obj, callback, args) {\n\t\tvar value,\n\t\t\t\ti = 0,\n\t\t\t\tlength = obj.length,\n\t\t\t\tisArray = isArraylike(obj);\n\n\t\tif (args) {\n\t\t\tif (isArray) {\n\t\t\t\tfor (; i < length; i++) {\n\t\t\t\t\tvalue = callback.apply(obj[i], args);\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvalue = callback.apply(obj[i], args);\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isArray) {\n\t\t\t\tfor (; i < length; i++) {\n\t\t\t\t\tvalue = callback.call(obj[i], i, obj[i]);\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvalue = callback.call(obj[i], i, obj[i]);\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t};\n\n\t/* Custom */\n\t$.data = function(node, key, value) {\n\t\t/* $.getData() */\n\t\tif (value === undefined) {\n\t\t\tvar getId = node[$.expando],\n\t\t\t\t\tstore = getId && cache[getId];\n\n\t\t\tif (key === undefined) {\n\t\t\t\treturn store;\n\t\t\t} else if (store) {\n\t\t\t\tif (key in store) {\n\t\t\t\t\treturn store[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* $.setData() */\n\t\t} else if (key !== undefined) {\n\t\t\tvar setId = node[$.expando] || (node[$.expando] = ++$.uuid);\n\n\t\t\tcache[setId] = cache[setId] || {};\n\t\t\tcache[setId][key] = value;\n\n\t\t\treturn value;\n\t\t}\n\t};\n\n\t/* Custom */\n\t$.removeData = function(node, keys) {\n\t\tvar id = node[$.expando],\n\t\t\t\tstore = id && cache[id];\n\n\t\tif (store) {\n\t\t\t// Cleanup the entire store if no keys are provided.\n\t\t\tif (!keys) {\n\t\t\t\tdelete cache[id];\n\t\t\t} else {\n\t\t\t\t$.each(keys, function(_, key) {\n\t\t\t\t\tdelete store[key];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t/* jQuery */\n\t$.extend = function() {\n\t\tvar src, copyIsArray, copy, name, options, clone,\n\t\t\t\ttarget = arguments[0] || {},\n\t\t\t\ti = 1,\n\t\t\t\tlength = arguments.length,\n\t\t\t\tdeep = false;\n\n\t\tif (typeof target === \"boolean\") {\n\t\t\tdeep = target;\n\n\t\t\ttarget = arguments[i] || {};\n\t\t\ti++;\n\t\t}\n\n\t\tif (typeof target !== \"object\" && $.type(target) !== \"function\") {\n\t\t\ttarget = {};\n\t\t}\n\n\t\tif (i === length) {\n\t\t\ttarget = this;\n\t\t\ti--;\n\t\t}\n\n\t\tfor (; i < length; i++) {\n\t\t\tif ((options = arguments[i])) {\n\t\t\t\tfor (name in options) {\n\t\t\t\t\tif (!options.hasOwnProperty(name)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tsrc = target[name];\n\t\t\t\t\tcopy = options[name];\n\n\t\t\t\t\tif (target === copy) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (deep && copy && ($.isPlainObject(copy) || (copyIsArray = $.isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && $.isArray(src) ? src : [];\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && $.isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget[name] = $.extend(deep, clone, copy);\n\n\t\t\t\t\t} else if (copy !== undefined) {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t};\n\n\t/* jQuery 1.4.3 */\n\t$.queue = function(elem, type, data) {\n\t\tfunction $makeArray(arr, results) {\n\t\t\tvar ret = results || [];\n\n\t\t\tif (arr) {\n\t\t\t\tif (isArraylike(Object(arr))) {\n\t\t\t\t\t/* $.merge */\n\t\t\t\t\t(function(first, second) {\n\t\t\t\t\t\tvar len = +second.length,\n\t\t\t\t\t\t\t\tj = 0,\n\t\t\t\t\t\t\t\ti = first.length;\n\n\t\t\t\t\t\twhile (j < len) {\n\t\t\t\t\t\t\tfirst[i++] = second[j++];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (len !== len) {\n\t\t\t\t\t\t\twhile (second[j] !== undefined) {\n\t\t\t\t\t\t\t\tfirst[i++] = second[j++];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfirst.length = i;\n\n\t\t\t\t\t\treturn first;\n\t\t\t\t\t})(ret, typeof arr === \"string\" ? [arr] : arr);\n\t\t\t\t} else {\n\t\t\t\t\t[].push.call(ret, arr);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (!elem) {\n\t\t\treturn;\n\t\t}\n\n\t\ttype = (type || \"fx\") + \"queue\";\n\n\t\tvar q = $.data(elem, type);\n\n\t\tif (!data) {\n\t\t\treturn q || [];\n\t\t}\n\n\t\tif (!q || $.isArray(data)) {\n\t\t\tq = $.data(elem, type, $makeArray(data));\n\t\t} else {\n\t\t\tq.push(data);\n\t\t}\n\n\t\treturn q;\n\t};\n\n\t/* jQuery 1.4.3 */\n\t$.dequeue = function(elems, type) {\n\t\t/* Custom: Embed element iteration. */\n\t\t$.each(elems.nodeType ? [elems] : elems, function(i, elem) {\n\t\t\ttype = type || \"fx\";\n\n\t\t\tvar queue = $.queue(elem, type),\n\t\t\t\t\tfn = queue.shift();\n\n\t\t\tif (fn === \"inprogress\") {\n\t\t\t\tfn = queue.shift();\n\t\t\t}\n\n\t\t\tif (fn) {\n\t\t\t\tif (type === \"fx\") {\n\t\t\t\t\tqueue.unshift(\"inprogress\");\n\t\t\t\t}\n\n\t\t\t\tfn.call(elem, function() {\n\t\t\t\t\t$.dequeue(elem, type);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\t/******************\n\t $.fn Methods\n\t ******************/\n\n\t/* jQuery */\n\t$.fn = $.prototype = {\n\t\tinit: function(selector) {\n\t\t\t/* Just return the element wrapped inside an array; don't proceed with the actual jQuery node wrapping process. */\n\t\t\tif (selector.nodeType) {\n\t\t\t\tthis[0] = selector;\n\n\t\t\t\treturn this;\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Not a DOM node.\");\n\t\t\t}\n\t\t},\n\t\toffset: function() {\n\t\t\t/* jQuery altered code: Dropped disconnected DOM node checking. */\n\t\t\tvar box = this[0].getBoundingClientRect ? this[0].getBoundingClientRect() : {top: 0, left: 0};\n\n\t\t\treturn {\n\t\t\t\ttop: box.top + (window.pageYOffset || document.scrollTop || 0) - (document.clientTop || 0),\n\t\t\t\tleft: box.left + (window.pageXOffset || document.scrollLeft || 0) - (document.clientLeft || 0)\n\t\t\t};\n\t\t},\n\t\tposition: function() {\n\t\t\t/* jQuery */\n\t\t\tfunction offsetParentFn(elem) {\n\t\t\t\tvar offsetParent = elem.offsetParent || document;\n\n\t\t\t\twhile (offsetParent && (offsetParent.nodeType.toLowerCase !== \"html\" && offsetParent.style.position === \"static\")) {\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn offsetParent || document;\n\t\t\t}\n\n\t\t\t/* Zepto */\n\t\t\tvar elem = this[0],\n\t\t\t\t\toffsetParent = offsetParentFn(elem),\n\t\t\t\t\toffset = this.offset(),\n\t\t\t\t\tparentOffset = /^(?:body|html)$/i.test(offsetParent.nodeName) ? {top: 0, left: 0} : $(offsetParent).offset();\n\n\t\t\toffset.top -= parseFloat(elem.style.marginTop) || 0;\n\t\t\toffset.left -= parseFloat(elem.style.marginLeft) || 0;\n\n\t\t\tif (offsetParent.style) {\n\t\t\t\tparentOffset.top += parseFloat(offsetParent.style.borderTopWidth) || 0;\n\t\t\t\tparentOffset.left += parseFloat(offsetParent.style.borderLeftWidth) || 0;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: offset.top - parentOffset.top,\n\t\t\t\tleft: offset.left - parentOffset.left\n\t\t\t};\n\t\t}\n\t};\n\n\t/**********************\n\t Private Variables\n\t **********************/\n\n\t/* For $.data() */\n\tvar cache = {};\n\t$.expando = \"velocity\" + (new Date().getTime());\n\t$.uuid = 0;\n\n\t/* For $.queue() */\n\tvar class2type = {},\n\t\t\thasOwn = class2type.hasOwnProperty,\n\t\t\ttoString = class2type.toString;\n\n\tvar types = \"Boolean Number String Function Array Date RegExp Object Error\".split(\" \");\n\tfor (var i = 0; i < types.length; i++) {\n\t\tclass2type[\"[object \" + types[i] + \"]\"] = types[i].toLowerCase();\n\t}\n\n\t/* Makes $(node) possible, without having to call init. */\n\t$.fn.init.prototype = $.fn;\n\n\t/* Globalize Velocity onto the window, and assign its Utilities property. */\n\twindow.Velocity = {Utilities: $};\n})(window);\n\n/******************\n Velocity.js\n ******************/\n\n(function(factory) {\n\t\"use strict\";\n\t/* CommonJS module. */\n\tif (typeof module === \"object\" && typeof module.exports === \"object\") {\n\t\tmodule.exports = factory();\n\t\t/* AMD module. */\n\t} else if (true) {\n\t\t!(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t\t/* Browser globals. */\n\t} else {\n\t\tfactory();\n\t}\n}(function() {\n\t\"use strict\";\n\treturn function(global, window, document, undefined) {\n\n\t\t/***************\n\t\t Summary\n\t\t ***************/\n\n\t\t/*\n\t\t - CSS: CSS stack that works independently from the rest of Velocity.\n\t\t - animate(): Core animation method that iterates over the targeted elements and queues the incoming call onto each element individually.\n\t\t - Pre-Queueing: Prepare the element for animation by instantiating its data cache and processing the call's options.\n\t\t - Queueing: The logic that runs once the call has reached its point of execution in the element's $.queue() stack.\n\t\t Most logic is placed here to avoid risking it becoming stale (if the element's properties have changed).\n\t\t - Pushing: Consolidation of the tween data followed by its push onto the global in-progress calls container.\n\t\t - tick(): The single requestAnimationFrame loop responsible for tweening all in-progress calls.\n\t\t - completeCall(): Handles the cleanup process for each Velocity call.\n\t\t */\n\n\t\t/*********************\n\t\t Helper Functions\n\t\t *********************/\n\n\t\t/* IE detection. Gist: https://gist.github.com/julianshapiro/9098609 */\n\t\tvar IE = (function() {\n\t\t\tif (document.documentMode) {\n\t\t\t\treturn document.documentMode;\n\t\t\t} else {\n\t\t\t\tfor (var i = 7; i > 4; i--) {\n\t\t\t\t\tvar div = document.createElement(\"div\");\n\n\t\t\t\t\tdiv.innerHTML = \"<!--[if IE \" + i + \"]><span></span><![endif]-->\";\n\n\t\t\t\t\tif (div.getElementsByTagName(\"span\").length) {\n\t\t\t\t\t\tdiv = null;\n\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t})();\n\n\t\t/* rAF shim. Gist: https://gist.github.com/julianshapiro/9497513 */\n\t\tvar rAFShim = (function() {\n\t\t\tvar timeLast = 0;\n\n\t\t\treturn window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(callback) {\n\t\t\t\tvar timeCurrent = (new Date()).getTime(),\n\t\t\t\t\t\ttimeDelta;\n\n\t\t\t\t/* Dynamically set delay on a per-tick basis to match 60fps. */\n\t\t\t\t/* Technique by Erik Moller. MIT license: https://gist.github.com/paulirish/1579671 */\n\t\t\t\ttimeDelta = Math.max(0, 16 - (timeCurrent - timeLast));\n\t\t\t\ttimeLast = timeCurrent + timeDelta;\n\n\t\t\t\treturn setTimeout(function() {\n\t\t\t\t\tcallback(timeCurrent + timeDelta);\n\t\t\t\t}, timeDelta);\n\t\t\t};\n\t\t})();\n\n\t\t/* Array compacting. Copyright Lo-Dash. MIT License: https://github.com/lodash/lodash/blob/master/LICENSE.txt */\n\t\tfunction compactSparseArray(array) {\n\t\t\tvar index = -1,\n\t\t\t\t\tlength = array ? array.length : 0,\n\t\t\t\t\tresult = [];\n\n\t\t\twhile (++index < length) {\n\t\t\t\tvar value = array[index];\n\n\t\t\t\tif (value) {\n\t\t\t\t\tresult.push(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tfunction sanitizeElements(elements) {\n\t\t\t/* Unwrap jQuery/Zepto objects. */\n\t\t\tif (Type.isWrapped(elements)) {\n\t\t\t\telements = [].slice.call(elements);\n\t\t\t\t/* Wrap a single element in an array so that $.each() can iterate with the element instead of its node's children. */\n\t\t\t} else if (Type.isNode(elements)) {\n\t\t\t\telements = [elements];\n\t\t\t}\n\n\t\t\treturn elements;\n\t\t}\n\n\t\tvar Type = {\n\t\t\tisString: function(variable) {\n\t\t\t\treturn (typeof variable === \"string\");\n\t\t\t},\n\t\t\tisArray: Array.isArray || function(variable) {\n\t\t\t\treturn Object.prototype.toString.call(variable) === \"[object Array]\";\n\t\t\t},\n\t\t\tisFunction: function(variable) {\n\t\t\t\treturn Object.prototype.toString.call(variable) === \"[object Function]\";\n\t\t\t},\n\t\t\tisNode: function(variable) {\n\t\t\t\treturn variable && variable.nodeType;\n\t\t\t},\n\t\t\t/* Copyright Martin Bohm. MIT License: https://gist.github.com/Tomalak/818a78a226a0738eaade */\n\t\t\tisNodeList: function(variable) {\n\t\t\t\treturn typeof variable === \"object\" &&\n\t\t\t\t\t\t/^\\[object (HTMLCollection|NodeList|Object)\\]$/.test(Object.prototype.toString.call(variable)) &&\n\t\t\t\t\t\tvariable.length !== undefined &&\n\t\t\t\t\t\t(variable.length === 0 || (typeof variable[0] === \"object\" && variable[0].nodeType > 0));\n\t\t\t},\n\t\t\t/* Determine if variable is a wrapped jQuery or Zepto element. */\n\t\t\tisWrapped: function(variable) {\n\t\t\t\treturn variable && (variable.jquery || (window.Zepto && window.Zepto.zepto.isZ(variable)));\n\t\t\t},\n\t\t\tisSVG: function(variable) {\n\t\t\t\treturn window.SVGElement && (variable instanceof window.SVGElement);\n\t\t\t},\n\t\t\tisEmptyObject: function(variable) {\n\t\t\t\tfor (var name in variable) {\n\t\t\t\t\tif (variable.hasOwnProperty(name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\t/*****************\n\t\t Dependencies\n\t\t *****************/\n\n\t\tvar $,\n\t\t\t\tisJQuery = false;\n\n\t\tif (global.fn && global.fn.jquery) {\n\t\t\t$ = global;\n\t\t\tisJQuery = true;\n\t\t} else {\n\t\t\t$ = window.Velocity.Utilities;\n\t\t}\n\n\t\tif (IE <= 8 && !isJQuery) {\n\t\t\tthrow new Error(\"Velocity: IE8 and below require jQuery to be loaded before Velocity.\");\n\t\t} else if (IE <= 7) {\n\t\t\t/* Revert to jQuery's $.animate(), and lose Velocity's extra features. */\n\t\t\tjQuery.fn.velocity = jQuery.fn.animate;\n\n\t\t\t/* Now that $.fn.velocity is aliased, abort this Velocity declaration. */\n\t\t\treturn;\n\t\t}\n\n\t\t/*****************\n\t\t Constants\n\t\t *****************/\n\n\t\tvar DURATION_DEFAULT = 400,\n\t\t\t\tEASING_DEFAULT = \"swing\";\n\n\t\t/*************\n\t\t State\n\t\t *************/\n\n\t\tvar Velocity = {\n\t\t\t/* Container for page-wide Velocity state data. */\n\t\t\tState: {\n\t\t\t\t/* Detect mobile devices to determine if mobileHA should be turned on. */\n\t\t\t\tisMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),\n\t\t\t\t/* The mobileHA option's behavior changes on older Android devices (Gingerbread, versions 2.3.3-2.3.7). */\n\t\t\t\tisAndroid: /Android/i.test(navigator.userAgent),\n\t\t\t\tisGingerbread: /Android 2\\.3\\.[3-7]/i.test(navigator.userAgent),\n\t\t\t\tisChrome: window.chrome,\n\t\t\t\tisFirefox: /Firefox/i.test(navigator.userAgent),\n\t\t\t\t/* Create a cached element for re-use when checking for CSS property prefixes. */\n\t\t\t\tprefixElement: document.createElement(\"div\"),\n\t\t\t\t/* Cache every prefix match to avoid repeating lookups. */\n\t\t\t\tprefixMatches: {},\n\t\t\t\t/* Cache the anchor used for animating window scrolling. */\n\t\t\t\tscrollAnchor: null,\n\t\t\t\t/* Cache the browser-specific property names associated with the scroll anchor. */\n\t\t\t\tscrollPropertyLeft: null,\n\t\t\t\tscrollPropertyTop: null,\n\t\t\t\t/* Keep track of whether our RAF tick is running. */\n\t\t\t\tisTicking: false,\n\t\t\t\t/* Container for every in-progress call to Velocity. */\n\t\t\t\tcalls: []\n\t\t\t},\n\t\t\t/* Velocity's custom CSS stack. Made global for unit testing. */\n\t\t\tCSS: { /* Defined below. */},\n\t\t\t/* A shim of the jQuery utility functions used by Velocity -- provided by Velocity's optional jQuery shim. */\n\t\t\tUtilities: $,\n\t\t\t/* Container for the user's custom animation redirects that are referenced by name in place of the properties map argument. */\n\t\t\tRedirects: { /* Manually registered by the user. */},\n\t\t\tEasings: { /* Defined below. */},\n\t\t\t/* Attempt to use ES6 Promises by default. Users can override this with a third-party promises library. */\n\t\t\tPromise: window.Promise,\n\t\t\t/* Velocity option defaults, which can be overriden by the user. */\n\t\t\tdefaults: {\n\t\t\t\tqueue: \"\",\n\t\t\t\tduration: DURATION_DEFAULT,\n\t\t\t\teasing: EASING_DEFAULT,\n\t\t\t\tbegin: undefined,\n\t\t\t\tcomplete: undefined,\n\t\t\t\tprogress: undefined,\n\t\t\t\tdisplay: undefined,\n\t\t\t\tvisibility: undefined,\n\t\t\t\tloop: false,\n\t\t\t\tdelay: false,\n\t\t\t\tmobileHA: true,\n\t\t\t\t/* Advanced: Set to false to prevent property values from being cached between consecutive Velocity-initiated chain calls. */\n\t\t\t\t_cacheValues: true\n\t\t\t},\n\t\t\t/* A design goal of Velocity is to cache data wherever possible in order to avoid DOM requerying. Accordingly, each element has a data cache. */\n\t\t\tinit: function(element) {\n\t\t\t\t$.data(element, \"velocity\", {\n\t\t\t\t\t/* Store whether this is an SVG element, since its properties are retrieved and updated differently than standard HTML elements. */\n\t\t\t\t\tisSVG: Type.isSVG(element),\n\t\t\t\t\t/* Keep track of whether the element is currently being animated by Velocity.\n\t\t\t\t\t This is used to ensure that property values are not transferred between non-consecutive (stale) calls. */\n\t\t\t\t\tisAnimating: false,\n\t\t\t\t\t/* A reference to the element's live computedStyle object. Learn more here: https://developer.mozilla.org/en/docs/Web/API/window.getComputedStyle */\n\t\t\t\t\tcomputedStyle: null,\n\t\t\t\t\t/* Tween data is cached for each animation on the element so that data can be passed across calls --\n\t\t\t\t\t in particular, end values are used as subsequent start values in consecutive Velocity calls. */\n\t\t\t\t\ttweensContainer: null,\n\t\t\t\t\t/* The full root property values of each CSS hook being animated on this element are cached so that:\n\t\t\t\t\t 1) Concurrently-animating hooks sharing the same root can have their root values' merged into one while tweening.\n\t\t\t\t\t 2) Post-hook-injection root values can be transferred over to consecutively chained Velocity calls as starting root values. */\n\t\t\t\t\trootPropertyValueCache: {},\n\t\t\t\t\t/* A cache for transform updates, which must be manually flushed via CSS.flushTransformCache(). */\n\t\t\t\t\ttransformCache: {}\n\t\t\t\t});\n\t\t\t},\n\t\t\t/* A parallel to jQuery's $.css(), used for getting/setting Velocity's hooked CSS properties. */\n\t\t\thook: null, /* Defined below. */\n\t\t\t/* Velocity-wide animation time remapping for testing purposes. */\n\t\t\tmock: false,\n\t\t\tversion: {major: 1, minor: 3, patch: 1},\n\t\t\t/* Set to 1 or 2 (most verbose) to output debug info to console. */\n\t\t\tdebug: false\n\t\t};\n\n\t\t/* Retrieve the appropriate scroll anchor and property name for the browser: https://developer.mozilla.org/en-US/docs/Web/API/Window.scrollY */\n\t\tif (window.pageYOffset !== undefined) {\n\t\t\tVelocity.State.scrollAnchor = window;\n\t\t\tVelocity.State.scrollPropertyLeft = \"pageXOffset\";\n\t\t\tVelocity.State.scrollPropertyTop = \"pageYOffset\";\n\t\t} else {\n\t\t\tVelocity.State.scrollAnchor = document.documentElement || document.body.parentNode || document.body;\n\t\t\tVelocity.State.scrollPropertyLeft = \"scrollLeft\";\n\t\t\tVelocity.State.scrollPropertyTop = \"scrollTop\";\n\t\t}\n\n\t\t/* Shorthand alias for jQuery's $.data() utility. */\n\t\tfunction Data(element) {\n\t\t\t/* Hardcode a reference to the plugin name. */\n\t\t\tvar response = $.data(element, \"velocity\");\n\n\t\t\t/* jQuery <=1.4.2 returns null instead of undefined when no match is found. We normalize this behavior. */\n\t\t\treturn response === null ? undefined : response;\n\t\t}\n\n\t\t/**************\n\t\t Easing\n\t\t **************/\n\n\t\t/* Step easing generator. */\n\t\tfunction generateStep(steps) {\n\t\t\treturn function(p) {\n\t\t\t\treturn Math.round(p * steps) * (1 / steps);\n\t\t\t};\n\t\t}\n\n\t\t/* Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */\n\t\tfunction generateBezier(mX1, mY1, mX2, mY2) {\n\t\t\tvar NEWTON_ITERATIONS = 4,\n\t\t\t\t\tNEWTON_MIN_SLOPE = 0.001,\n\t\t\t\t\tSUBDIVISION_PRECISION = 0.0000001,\n\t\t\t\t\tSUBDIVISION_MAX_ITERATIONS = 10,\n\t\t\t\t\tkSplineTableSize = 11,\n\t\t\t\t\tkSampleStepSize = 1.0 / (kSplineTableSize - 1.0),\n\t\t\t\t\tfloat32ArraySupported = \"Float32Array\" in window;\n\n\t\t\t/* Must contain four arguments. */\n\t\t\tif (arguments.length !== 4) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* Arguments must be numbers. */\n\t\t\tfor (var i = 0; i < 4; ++i) {\n\t\t\t\tif (typeof arguments[i] !== \"number\" || isNaN(arguments[i]) || !isFinite(arguments[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* X values must be in the [0, 1] range. */\n\t\t\tmX1 = Math.min(mX1, 1);\n\t\t\tmX2 = Math.min(mX2, 1);\n\t\t\tmX1 = Math.max(mX1, 0);\n\t\t\tmX2 = Math.max(mX2, 0);\n\n\t\t\tvar mSampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\n\n\t\t\tfunction A(aA1, aA2) {\n\t\t\t\treturn 1.0 - 3.0 * aA2 + 3.0 * aA1;\n\t\t\t}\n\t\t\tfunction B(aA1, aA2) {\n\t\t\t\treturn 3.0 * aA2 - 6.0 * aA1;\n\t\t\t}\n\t\t\tfunction C(aA1) {\n\t\t\t\treturn 3.0 * aA1;\n\t\t\t}\n\n\t\t\tfunction calcBezier(aT, aA1, aA2) {\n\t\t\t\treturn ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT;\n\t\t\t}\n\n\t\t\tfunction getSlope(aT, aA1, aA2) {\n\t\t\t\treturn 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1);\n\t\t\t}\n\n\t\t\tfunction newtonRaphsonIterate(aX, aGuessT) {\n\t\t\t\tfor (var i = 0; i < NEWTON_ITERATIONS; ++i) {\n\t\t\t\t\tvar currentSlope = getSlope(aGuessT, mX1, mX2);\n\n\t\t\t\t\tif (currentSlope === 0.0) {\n\t\t\t\t\t\treturn aGuessT;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n\t\t\t\t\taGuessT -= currentX / currentSlope;\n\t\t\t\t}\n\n\t\t\t\treturn aGuessT;\n\t\t\t}\n\n\t\t\tfunction calcSampleValues() {\n\t\t\t\tfor (var i = 0; i < kSplineTableSize; ++i) {\n\t\t\t\t\tmSampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction binarySubdivide(aX, aA, aB) {\n\t\t\t\tvar currentX, currentT, i = 0;\n\n\t\t\t\tdo {\n\t\t\t\t\tcurrentT = aA + (aB - aA) / 2.0;\n\t\t\t\t\tcurrentX = calcBezier(currentT, mX1, mX2) - aX;\n\t\t\t\t\tif (currentX > 0.0) {\n\t\t\t\t\t\taB = currentT;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taA = currentT;\n\t\t\t\t\t}\n\t\t\t\t} while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\n\n\t\t\t\treturn currentT;\n\t\t\t}\n\n\t\t\tfunction getTForX(aX) {\n\t\t\t\tvar intervalStart = 0.0,\n\t\t\t\t\t\tcurrentSample = 1,\n\t\t\t\t\t\tlastSample = kSplineTableSize - 1;\n\n\t\t\t\tfor (; currentSample !== lastSample && mSampleValues[currentSample] <= aX; ++currentSample) {\n\t\t\t\t\tintervalStart += kSampleStepSize;\n\t\t\t\t}\n\n\t\t\t\t--currentSample;\n\n\t\t\t\tvar dist = (aX - mSampleValues[currentSample]) / (mSampleValues[currentSample + 1] - mSampleValues[currentSample]),\n\t\t\t\t\t\tguessForT = intervalStart + dist * kSampleStepSize,\n\t\t\t\t\t\tinitialSlope = getSlope(guessForT, mX1, mX2);\n\n\t\t\t\tif (initialSlope >= NEWTON_MIN_SLOPE) {\n\t\t\t\t\treturn newtonRaphsonIterate(aX, guessForT);\n\t\t\t\t} else if (initialSlope === 0.0) {\n\t\t\t\t\treturn guessForT;\n\t\t\t\t} else {\n\t\t\t\t\treturn binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar _precomputed = false;\n\n\t\t\tfunction precompute() {\n\t\t\t\t_precomputed = true;\n\t\t\t\tif (mX1 !== mY1 || mX2 !== mY2) {\n\t\t\t\t\tcalcSampleValues();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar f = function(aX) {\n\t\t\t\tif (!_precomputed) {\n\t\t\t\t\tprecompute();\n\t\t\t\t}\n\t\t\t\tif (mX1 === mY1 && mX2 === mY2) {\n\t\t\t\t\treturn aX;\n\t\t\t\t}\n\t\t\t\tif (aX === 0) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tif (aX === 1) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn calcBezier(getTForX(aX), mY1, mY2);\n\t\t\t};\n\n\t\t\tf.getControlPoints = function() {\n\t\t\t\treturn [{x: mX1, y: mY1}, {x: mX2, y: mY2}];\n\t\t\t};\n\n\t\t\tvar str = \"generateBezier(\" + [mX1, mY1, mX2, mY2] + \")\";\n\t\t\tf.toString = function() {\n\t\t\t\treturn str;\n\t\t\t};\n\n\t\t\treturn f;\n\t\t}\n\n\t\t/* Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */\n\t\t/* Given a tension, friction, and duration, a simulation at 60FPS will first run without a defined duration in order to calculate the full path. A second pass\n\t\t then adjusts the time delta -- using the relation between actual time and duration -- to calculate the path for the duration-constrained animation. */\n\t\tvar generateSpringRK4 = (function() {\n\t\t\tfunction springAccelerationForState(state) {\n\t\t\t\treturn (-state.tension * state.x) - (state.friction * state.v);\n\t\t\t}\n\n\t\t\tfunction springEvaluateStateWithDerivative(initialState, dt, derivative) {\n\t\t\t\tvar state = {\n\t\t\t\t\tx: initialState.x + derivative.dx * dt,\n\t\t\t\t\tv: initialState.v + derivative.dv * dt,\n\t\t\t\t\ttension: initialState.tension,\n\t\t\t\t\tfriction: initialState.friction\n\t\t\t\t};\n\n\t\t\t\treturn {dx: state.v, dv: springAccelerationForState(state)};\n\t\t\t}\n\n\t\t\tfunction springIntegrateState(state, dt) {\n\t\t\t\tvar a = {\n\t\t\t\t\tdx: state.v,\n\t\t\t\t\tdv: springAccelerationForState(state)\n\t\t\t\t},\n\t\t\t\tb = springEvaluateStateWithDerivative(state, dt * 0.5, a),\n\t\t\t\t\t\tc = springEvaluateStateWithDerivative(state, dt * 0.5, b),\n\t\t\t\t\t\td = springEvaluateStateWithDerivative(state, dt, c),\n\t\t\t\t\t\tdxdt = 1.0 / 6.0 * (a.dx + 2.0 * (b.dx + c.dx) + d.dx),\n\t\t\t\t\t\tdvdt = 1.0 / 6.0 * (a.dv + 2.0 * (b.dv + c.dv) + d.dv);\n\n\t\t\t\tstate.x = state.x + dxdt * dt;\n\t\t\t\tstate.v = state.v + dvdt * dt;\n\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\treturn function springRK4Factory(tension, friction, duration) {\n\n\t\t\t\tvar initState = {\n\t\t\t\t\tx: -1,\n\t\t\t\t\tv: 0,\n\t\t\t\t\ttension: null,\n\t\t\t\t\tfriction: null\n\t\t\t\t},\n\t\t\t\tpath = [0],\n\t\t\t\t\t\ttime_lapsed = 0,\n\t\t\t\t\t\ttolerance = 1 / 10000,\n\t\t\t\t\t\tDT = 16 / 1000,\n\t\t\t\t\t\thave_duration, dt, last_state;\n\n\t\t\t\ttension = parseFloat(tension) || 500;\n\t\t\t\tfriction = parseFloat(friction) || 20;\n\t\t\t\tduration = duration || null;\n\n\t\t\t\tinitState.tension = tension;\n\t\t\t\tinitState.friction = friction;\n\n\t\t\t\thave_duration = duration !== null;\n\n\t\t\t\t/* Calculate the actual time it takes for this animation to complete with the provided conditions. */\n\t\t\t\tif (have_duration) {\n\t\t\t\t\t/* Run the simulation without a duration. */\n\t\t\t\t\ttime_lapsed = springRK4Factory(tension, friction);\n\t\t\t\t\t/* Compute the adjusted time delta. */\n\t\t\t\t\tdt = time_lapsed / duration * DT;\n\t\t\t\t} else {\n\t\t\t\t\tdt = DT;\n\t\t\t\t}\n\n\t\t\t\twhile (true) {\n\t\t\t\t\t/* Next/step function .*/\n\t\t\t\t\tlast_state = springIntegrateState(last_state || initState, dt);\n\t\t\t\t\t/* Store the position. */\n\t\t\t\t\tpath.push(1 + last_state.x);\n\t\t\t\t\ttime_lapsed += 16;\n\t\t\t\t\t/* If the change threshold is reached, break. */\n\t\t\t\t\tif (!(Math.abs(last_state.x) > tolerance && Math.abs(last_state.v) > tolerance)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* If duration is not defined, return the actual time required for completing this animation. Otherwise, return a closure that holds the\n\t\t\t\t computed path and returns a snapshot of the position according to a given percentComplete. */\n\t\t\t\treturn !have_duration ? time_lapsed : function(percentComplete) {\n\t\t\t\t\treturn path[ (percentComplete * (path.length - 1)) | 0 ];\n\t\t\t\t};\n\t\t\t};\n\t\t}());\n\n\t\t/* jQuery easings. */\n\t\tVelocity.Easings = {\n\t\t\tlinear: function(p) {\n\t\t\t\treturn p;\n\t\t\t},\n\t\t\tswing: function(p) {\n\t\t\t\treturn 0.5 - Math.cos(p * Math.PI) / 2;\n\t\t\t},\n\t\t\t/* Bonus \"spring\" easing, which is a less exaggerated version of easeInOutElastic. */\n\t\t\tspring: function(p) {\n\t\t\t\treturn 1 - (Math.cos(p * 4.5 * Math.PI) * Math.exp(-p * 6));\n\t\t\t}\n\t\t};\n\n\t\t/* CSS3 and Robert Penner easings. */\n\t\t$.each(\n\t\t\t\t[\n\t\t\t\t\t[\"ease\", [0.25, 0.1, 0.25, 1.0]],\n\t\t\t\t\t[\"ease-in\", [0.42, 0.0, 1.00, 1.0]],\n\t\t\t\t\t[\"ease-out\", [0.00, 0.0, 0.58, 1.0]],\n\t\t\t\t\t[\"ease-in-out\", [0.42, 0.0, 0.58, 1.0]],\n\t\t\t\t\t[\"easeInSine\", [0.47, 0, 0.745, 0.715]],\n\t\t\t\t\t[\"easeOutSine\", [0.39, 0.575, 0.565, 1]],\n\t\t\t\t\t[\"easeInOutSine\", [0.445, 0.05, 0.55, 0.95]],\n\t\t\t\t\t[\"easeInQuad\", [0.55, 0.085, 0.68, 0.53]],\n\t\t\t\t\t[\"easeOutQuad\", [0.25, 0.46, 0.45, 0.94]],\n\t\t\t\t\t[\"easeInOutQuad\", [0.455, 0.03, 0.515, 0.955]],\n\t\t\t\t\t[\"easeInCubic\", [0.55, 0.055, 0.675, 0.19]],\n\t\t\t\t\t[\"easeOutCubic\", [0.215, 0.61, 0.355, 1]],\n\t\t\t\t\t[\"easeInOutCubic\", [0.645, 0.045, 0.355, 1]],\n\t\t\t\t\t[\"easeInQuart\", [0.895, 0.03, 0.685, 0.22]],\n\t\t\t\t\t[\"easeOutQuart\", [0.165, 0.84, 0.44, 1]],\n\t\t\t\t\t[\"easeInOutQuart\", [0.77, 0, 0.175, 1]],\n\t\t\t\t\t[\"easeInQuint\", [0.755, 0.05, 0.855, 0.06]],\n\t\t\t\t\t[\"easeOutQuint\", [0.23, 1, 0.32, 1]],\n\t\t\t\t\t[\"easeInOutQuint\", [0.86, 0, 0.07, 1]],\n\t\t\t\t\t[\"easeInExpo\", [0.95, 0.05, 0.795, 0.035]],\n\t\t\t\t\t[\"easeOutExpo\", [0.19, 1, 0.22, 1]],\n\t\t\t\t\t[\"easeInOutExpo\", [1, 0, 0, 1]],\n\t\t\t\t\t[\"easeInCirc\", [0.6, 0.04, 0.98, 0.335]],\n\t\t\t\t\t[\"easeOutCirc\", [0.075, 0.82, 0.165, 1]],\n\t\t\t\t\t[\"easeInOutCirc\", [0.785, 0.135, 0.15, 0.86]]\n\t\t\t\t], function(i, easingArray) {\n\t\t\tVelocity.Easings[easingArray[0]] = generateBezier.apply(null, easingArray[1]);\n\t\t});\n\n\t\t/* Determine the appropriate easing type given an easing input. */\n\t\tfunction getEasing(value, duration) {\n\t\t\tvar easing = value;\n\n\t\t\t/* The easing option can either be a string that references a pre-registered easing,\n\t\t\t or it can be a two-/four-item array of integers to be converted into a bezier/spring function. */\n\t\t\tif (Type.isString(value)) {\n\t\t\t\t/* Ensure that the easing has been assigned to jQuery's Velocity.Easings object. */\n\t\t\t\tif (!Velocity.Easings[value]) {\n\t\t\t\t\teasing = false;\n\t\t\t\t}\n\t\t\t} else if (Type.isArray(value) && value.length === 1) {\n\t\t\t\teasing = generateStep.apply(null, value);\n\t\t\t} else if (Type.isArray(value) && value.length === 2) {\n\t\t\t\t/* springRK4 must be passed the animation's duration. */\n\t\t\t\t/* Note: If the springRK4 array contains non-numbers, generateSpringRK4() returns an easing\n\t\t\t\t function generated with default tension and friction values. */\n\t\t\t\teasing = generateSpringRK4.apply(null, value.concat([duration]));\n\t\t\t} else if (Type.isArray(value) && value.length === 4) {\n\t\t\t\t/* Note: If the bezier array contains non-numbers, generateBezier() returns false. */\n\t\t\t\teasing = generateBezier.apply(null, value);\n\t\t\t} else {\n\t\t\t\teasing = false;\n\t\t\t}\n\n\t\t\t/* Revert to the Velocity-wide default easing type, or fall back to \"swing\" (which is also jQuery's default)\n\t\t\t if the Velocity-wide default has been incorrectly modified. */\n\t\t\tif (easing === false) {\n\t\t\t\tif (Velocity.Easings[Velocity.defaults.easing]) {\n\t\t\t\t\teasing = Velocity.defaults.easing;\n\t\t\t\t} else {\n\t\t\t\t\teasing = EASING_DEFAULT;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn easing;\n\t\t}\n\n\t\t/*****************\n\t\t CSS Stack\n\t\t *****************/\n\n\t\t/* The CSS object is a highly condensed and performant CSS stack that fully replaces jQuery's.\n\t\t It handles the validation, getting, and setting of both standard CSS properties and CSS property hooks. */\n\t\t/* Note: A \"CSS\" shorthand is aliased so that our code is easier to read. */\n\t\tvar CSS = Velocity.CSS = {\n\t\t\t/*************\n\t\t\t RegEx\n\t\t\t *************/\n\n\t\t\tRegEx: {\n\t\t\t\tisHex: /^#([A-f\\d]{3}){1,2}$/i,\n\t\t\t\t/* Unwrap a property value's surrounding text, e.g. \"rgba(4, 3, 2, 1)\" ==> \"4, 3, 2, 1\" and \"rect(4px 3px 2px 1px)\" ==> \"4px 3px 2px 1px\". */\n\t\t\t\tvalueUnwrap: /^[A-z]+\\((.*)\\)$/i,\n\t\t\t\twrappedValueAlreadyExtracted: /[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,\n\t\t\t\t/* Split a multi-value property into an array of subvalues, e.g. \"rgba(4, 3, 2, 1) 4px 3px 2px 1px\" ==> [ \"rgba(4, 3, 2, 1)\", \"4px\", \"3px\", \"2px\", \"1px\" ]. */\n\t\t\t\tvalueSplit: /([A-z]+\\(.+\\))|(([A-z0-9#-.]+?)(?=\\s|$))/ig\n\t\t\t},\n\t\t\t/************\n\t\t\t Lists\n\t\t\t ************/\n\n\t\t\tLists: {\n\t\t\t\tcolors: [\"fill\", \"stroke\", \"stopColor\", \"color\", \"backgroundColor\", \"borderColor\", \"borderTopColor\", \"borderRightColor\", \"borderBottomColor\", \"borderLeftColor\", \"outlineColor\"],\n\t\t\t\ttransformsBase: [\"translateX\", \"translateY\", \"scale\", \"scaleX\", \"scaleY\", \"skewX\", \"skewY\", \"rotateZ\"],\n\t\t\t\ttransforms3D: [\"transformPerspective\", \"translateZ\", \"scaleZ\", \"rotateX\", \"rotateY\"]\n\t\t\t},\n\t\t\t/************\n\t\t\t Hooks\n\t\t\t ************/\n\n\t\t\t/* Hooks allow a subproperty (e.g. \"boxShadowBlur\") of a compound-value CSS property\n\t\t\t (e.g. \"boxShadow: X Y Blur Spread Color\") to be animated as if it were a discrete property. */\n\t\t\t/* Note: Beyond enabling fine-grained property animation, hooking is necessary since Velocity only\n\t\t\t tweens properties with single numeric values; unlike CSS transitions, Velocity does not interpolate compound-values. */\n\t\t\tHooks: {\n\t\t\t\t/********************\n\t\t\t\t Registration\n\t\t\t\t ********************/\n\n\t\t\t\t/* Templates are a concise way of indicating which subproperties must be individually registered for each compound-value CSS property. */\n\t\t\t\t/* Each template consists of the compound-value's base name, its constituent subproperty names, and those subproperties' default values. */\n\t\t\t\ttemplates: {\n\t\t\t\t\t\"textShadow\": [\"Color X Y Blur\", \"black 0px 0px 0px\"],\n\t\t\t\t\t\"boxShadow\": [\"Color X Y Blur Spread\", \"black 0px 0px 0px 0px\"],\n\t\t\t\t\t\"clip\": [\"Top Right Bottom Left\", \"0px 0px 0px 0px\"],\n\t\t\t\t\t\"backgroundPosition\": [\"X Y\", \"0% 0%\"],\n\t\t\t\t\t\"transformOrigin\": [\"X Y Z\", \"50% 50% 0px\"],\n\t\t\t\t\t\"perspectiveOrigin\": [\"X Y\", \"50% 50%\"]\n\t\t\t\t},\n\t\t\t\t/* A \"registered\" hook is one that has been converted from its template form into a live,\n\t\t\t\t tweenable property. It contains data to associate it with its root property. */\n\t\t\t\tregistered: {\n\t\t\t\t\t/* Note: A registered hook looks like this ==> textShadowBlur: [ \"textShadow\", 3 ],\n\t\t\t\t\t which consists of the subproperty's name, the associated root property's name,\n\t\t\t\t\t and the subproperty's position in the root's value. */\n\t\t\t\t},\n\t\t\t\t/* Convert the templates into individual hooks then append them to the registered object above. */\n\t\t\t\tregister: function() {\n\t\t\t\t\t/* Color hooks registration: Colors are defaulted to white -- as opposed to black -- since colors that are\n\t\t\t\t\t currently set to \"transparent\" default to their respective template below when color-animated,\n\t\t\t\t\t and white is typically a closer match to transparent than black is. An exception is made for text (\"color\"),\n\t\t\t\t\t which is almost always set closer to black than white. */\n\t\t\t\t\tfor (var i = 0; i < CSS.Lists.colors.length; i++) {\n\t\t\t\t\t\tvar rgbComponents = (CSS.Lists.colors[i] === \"color\") ? \"0 0 0 1\" : \"255 255 255 1\";\n\t\t\t\t\t\tCSS.Hooks.templates[CSS.Lists.colors[i]] = [\"Red Green Blue Alpha\", rgbComponents];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar rootProperty,\n\t\t\t\t\t\t\thookTemplate,\n\t\t\t\t\t\t\thookNames;\n\n\t\t\t\t\t/* In IE, color values inside compound-value properties are positioned at the end the value instead of at the beginning.\n\t\t\t\t\t Thus, we re-arrange the templates accordingly. */\n\t\t\t\t\tif (IE) {\n\t\t\t\t\t\tfor (rootProperty in CSS.Hooks.templates) {\n\t\t\t\t\t\t\tif (!CSS.Hooks.templates.hasOwnProperty(rootProperty)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thookTemplate = CSS.Hooks.templates[rootProperty];\n\t\t\t\t\t\t\thookNames = hookTemplate[0].split(\" \");\n\n\t\t\t\t\t\t\tvar defaultValues = hookTemplate[1].match(CSS.RegEx.valueSplit);\n\n\t\t\t\t\t\t\tif (hookNames[0] === \"Color\") {\n\t\t\t\t\t\t\t\t/* Reposition both the hook's name and its default value to the end of their respective strings. */\n\t\t\t\t\t\t\t\thookNames.push(hookNames.shift());\n\t\t\t\t\t\t\t\tdefaultValues.push(defaultValues.shift());\n\n\t\t\t\t\t\t\t\t/* Replace the existing template for the hook's root property. */\n\t\t\t\t\t\t\t\tCSS.Hooks.templates[rootProperty] = [hookNames.join(\" \"), defaultValues.join(\" \")];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Hook registration. */\n\t\t\t\t\tfor (rootProperty in CSS.Hooks.templates) {\n\t\t\t\t\t\tif (!CSS.Hooks.templates.hasOwnProperty(rootProperty)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thookTemplate = CSS.Hooks.templates[rootProperty];\n\t\t\t\t\t\thookNames = hookTemplate[0].split(\" \");\n\n\t\t\t\t\t\tfor (var j in hookNames) {\n\t\t\t\t\t\t\tif (!hookNames.hasOwnProperty(j)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar fullHookName = rootProperty + hookNames[j],\n\t\t\t\t\t\t\t\t\thookPosition = j;\n\n\t\t\t\t\t\t\t/* For each hook, register its full name (e.g. textShadowBlur) with its root property (e.g. textShadow)\n\t\t\t\t\t\t\t and the hook's position in its template's default value string. */\n\t\t\t\t\t\t\tCSS.Hooks.registered[fullHookName] = [rootProperty, hookPosition];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*****************************\n\t\t\t\t Injection and Extraction\n\t\t\t\t *****************************/\n\n\t\t\t\t/* Look up the root property associated with the hook (e.g. return \"textShadow\" for \"textShadowBlur\"). */\n\t\t\t\t/* Since a hook cannot be set directly (the browser won't recognize it), style updating for hooks is routed through the hook's root property. */\n\t\t\t\tgetRoot: function(property) {\n\t\t\t\t\tvar hookData = CSS.Hooks.registered[property];\n\n\t\t\t\t\tif (hookData) {\n\t\t\t\t\t\treturn hookData[0];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* If there was no hook match, return the property name untouched. */\n\t\t\t\t\t\treturn property;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/* Convert any rootPropertyValue, null or otherwise, into a space-delimited list of hook values so that\n\t\t\t\t the targeted hook can be injected or extracted at its standard position. */\n\t\t\t\tcleanRootPropertyValue: function(rootProperty, rootPropertyValue) {\n\t\t\t\t\t/* If the rootPropertyValue is wrapped with \"rgb()\", \"clip()\", etc., remove the wrapping to normalize the value before manipulation. */\n\t\t\t\t\tif (CSS.RegEx.valueUnwrap.test(rootPropertyValue)) {\n\t\t\t\t\t\trootPropertyValue = rootPropertyValue.match(CSS.RegEx.valueUnwrap)[1];\n\t\t\t\t\t}\n\n\t\t\t\t\t/* If rootPropertyValue is a CSS null-value (from which there's inherently no hook value to extract),\n\t\t\t\t\t default to the root's default value as defined in CSS.Hooks.templates. */\n\t\t\t\t\t/* Note: CSS null-values include \"none\", \"auto\", and \"transparent\". They must be converted into their\n\t\t\t\t\t zero-values (e.g. textShadow: \"none\" ==> textShadow: \"0px 0px 0px black\") for hook manipulation to proceed. */\n\t\t\t\t\tif (CSS.Values.isCSSNullValue(rootPropertyValue)) {\n\t\t\t\t\t\trootPropertyValue = CSS.Hooks.templates[rootProperty][1];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn rootPropertyValue;\n\t\t\t\t},\n\t\t\t\t/* Extracted the hook's value from its root property's value. This is used to get the starting value of an animating hook. */\n\t\t\t\textractValue: function(fullHookName, rootPropertyValue) {\n\t\t\t\t\tvar hookData = CSS.Hooks.registered[fullHookName];\n\n\t\t\t\t\tif (hookData) {\n\t\t\t\t\t\tvar hookRoot = hookData[0],\n\t\t\t\t\t\t\t\thookPosition = hookData[1];\n\n\t\t\t\t\t\trootPropertyValue = CSS.Hooks.cleanRootPropertyValue(hookRoot, rootPropertyValue);\n\n\t\t\t\t\t\t/* Split rootPropertyValue into its constituent hook values then grab the desired hook at its standard position. */\n\t\t\t\t\t\treturn rootPropertyValue.toString().match(CSS.RegEx.valueSplit)[hookPosition];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* If the provided fullHookName isn't a registered hook, return the rootPropertyValue that was passed in. */\n\t\t\t\t\t\treturn rootPropertyValue;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/* Inject the hook's value into its root property's value. This is used to piece back together the root property\n\t\t\t\t once Velocity has updated one of its individually hooked values through tweening. */\n\t\t\t\tinjectValue: function(fullHookName, hookValue, rootPropertyValue) {\n\t\t\t\t\tvar hookData = CSS.Hooks.registered[fullHookName];\n\n\t\t\t\t\tif (hookData) {\n\t\t\t\t\t\tvar hookRoot = hookData[0],\n\t\t\t\t\t\t\t\thookPosition = hookData[1],\n\t\t\t\t\t\t\t\trootPropertyValueParts,\n\t\t\t\t\t\t\t\trootPropertyValueUpdated;\n\n\t\t\t\t\t\trootPropertyValue = CSS.Hooks.cleanRootPropertyValue(hookRoot, rootPropertyValue);\n\n\t\t\t\t\t\t/* Split rootPropertyValue into its individual hook values, replace the targeted value with hookValue,\n\t\t\t\t\t\t then reconstruct the rootPropertyValue string. */\n\t\t\t\t\t\trootPropertyValueParts = rootPropertyValue.toString().match(CSS.RegEx.valueSplit);\n\t\t\t\t\t\trootPropertyValueParts[hookPosition] = hookValue;\n\t\t\t\t\t\trootPropertyValueUpdated = rootPropertyValueParts.join(\" \");\n\n\t\t\t\t\t\treturn rootPropertyValueUpdated;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* If the provided fullHookName isn't a registered hook, return the rootPropertyValue that was passed in. */\n\t\t\t\t\t\treturn rootPropertyValue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/*******************\n\t\t\t Normalizations\n\t\t\t *******************/\n\n\t\t\t/* Normalizations standardize CSS property manipulation by pollyfilling browser-specific implementations (e.g. opacity)\n\t\t\t and reformatting special properties (e.g. clip, rgba) to look like standard ones. */\n\t\t\tNormalizations: {\n\t\t\t\t/* Normalizations are passed a normalization target (either the property's name, its extracted value, or its injected value),\n\t\t\t\t the targeted element (which may need to be queried), and the targeted property value. */\n\t\t\t\tregistered: {\n\t\t\t\t\tclip: function(type, element, propertyValue) {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\treturn \"clip\";\n\t\t\t\t\t\t\t\t/* Clip needs to be unwrapped and stripped of its commas during extraction. */\n\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\tvar extracted;\n\n\t\t\t\t\t\t\t\t/* If Velocity also extracted this value, skip extraction. */\n\t\t\t\t\t\t\t\tif (CSS.RegEx.wrappedValueAlreadyExtracted.test(propertyValue)) {\n\t\t\t\t\t\t\t\t\textracted = propertyValue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/* Remove the \"rect()\" wrapper. */\n\t\t\t\t\t\t\t\t\textracted = propertyValue.toString().match(CSS.RegEx.valueUnwrap);\n\n\t\t\t\t\t\t\t\t\t/* Strip off commas. */\n\t\t\t\t\t\t\t\t\textracted = extracted ? extracted[1].replace(/,(\\s+)?/g, \" \") : propertyValue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn extracted;\n\t\t\t\t\t\t\t\t/* Clip needs to be re-wrapped during injection. */\n\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\treturn \"rect(\" + propertyValue + \")\";\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tblur: function(type, element, propertyValue) {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\treturn Velocity.State.isFirefox ? \"filter\" : \"-webkit-filter\";\n\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\tvar extracted = parseFloat(propertyValue);\n\n\t\t\t\t\t\t\t\t/* If extracted is NaN, meaning the value isn't already extracted. */\n\t\t\t\t\t\t\t\tif (!(extracted || extracted === 0)) {\n\t\t\t\t\t\t\t\t\tvar blurComponent = propertyValue.toString().match(/blur\\(([0-9]+[A-z]+)\\)/i);\n\n\t\t\t\t\t\t\t\t\t/* If the filter string had a blur component, return just the blur value and unit type. */\n\t\t\t\t\t\t\t\t\tif (blurComponent) {\n\t\t\t\t\t\t\t\t\t\textracted = blurComponent[1];\n\t\t\t\t\t\t\t\t\t\t/* If the component doesn't exist, default blur to 0. */\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\textracted = 0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn extracted;\n\t\t\t\t\t\t\t\t/* Blur needs to be re-wrapped during injection. */\n\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\t/* For the blur effect to be fully de-applied, it needs to be set to \"none\" instead of 0. */\n\t\t\t\t\t\t\t\tif (!parseFloat(propertyValue)) {\n\t\t\t\t\t\t\t\t\treturn \"none\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn \"blur(\" + propertyValue + \")\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t/* <=IE8 do not support the standard opacity property. They use filter:alpha(opacity=INT) instead. */\n\t\t\t\t\topacity: function(type, element, propertyValue) {\n\t\t\t\t\t\tif (IE <= 8) {\n\t\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\t\treturn \"filter\";\n\t\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\t\t/* <=IE8 return a \"filter\" value of \"alpha(opacity=\\d{1,3})\".\n\t\t\t\t\t\t\t\t\t Extract the value and convert it to a decimal value to match the standard CSS opacity property's formatting. */\n\t\t\t\t\t\t\t\t\tvar extracted = propertyValue.toString().match(/alpha\\(opacity=(.*)\\)/i);\n\n\t\t\t\t\t\t\t\t\tif (extracted) {\n\t\t\t\t\t\t\t\t\t\t/* Convert to decimal value. */\n\t\t\t\t\t\t\t\t\t\tpropertyValue = extracted[1] / 100;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t/* When extracting opacity, default to 1 since a null value means opacity hasn't been set. */\n\t\t\t\t\t\t\t\t\t\tpropertyValue = 1;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn propertyValue;\n\t\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\t\t/* Opacified elements are required to have their zoom property set to a non-zero value. */\n\t\t\t\t\t\t\t\t\telement.style.zoom = 1;\n\n\t\t\t\t\t\t\t\t\t/* Setting the filter property on elements with certain font property combinations can result in a\n\t\t\t\t\t\t\t\t\t highly unappealing ultra-bolding effect. There's no way to remedy this throughout a tween, but dropping the\n\t\t\t\t\t\t\t\t\t value altogether (when opacity hits 1) at leasts ensures that the glitch is gone post-tweening. */\n\t\t\t\t\t\t\t\t\tif (parseFloat(propertyValue) >= 1) {\n\t\t\t\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t/* As per the filter property's spec, convert the decimal value to a whole number and wrap the value. */\n\t\t\t\t\t\t\t\t\t\treturn \"alpha(opacity=\" + parseInt(parseFloat(propertyValue) * 100, 10) + \")\";\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* With all other browsers, normalization is not required; return the same values that were passed in. */\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\t\treturn \"opacity\";\n\t\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\t\treturn propertyValue;\n\t\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\t\treturn propertyValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*****************************\n\t\t\t\t Batched Registrations\n\t\t\t\t *****************************/\n\n\t\t\t\t/* Note: Batched normalizations extend the CSS.Normalizations.registered object. */\n\t\t\t\tregister: function() {\n\n\t\t\t\t\t/*****************\n\t\t\t\t\t Transforms\n\t\t\t\t\t *****************/\n\n\t\t\t\t\t/* Transforms are the subproperties contained by the CSS \"transform\" property. Transforms must undergo normalization\n\t\t\t\t\t so that they can be referenced in a properties map by their individual names. */\n\t\t\t\t\t/* Note: When transforms are \"set\", they are actually assigned to a per-element transformCache. When all transform\n\t\t\t\t\t setting is complete complete, CSS.flushTransformCache() must be manually called to flush the values to the DOM.\n\t\t\t\t\t Transform setting is batched in this way to improve performance: the transform style only needs to be updated\n\t\t\t\t\t once when multiple transform subproperties are being animated simultaneously. */\n\t\t\t\t\t/* Note: IE9 and Android Gingerbread have support for 2D -- but not 3D -- transforms. Since animating unsupported\n\t\t\t\t\t transform properties results in the browser ignoring the *entire* transform string, we prevent these 3D values\n\t\t\t\t\t from being normalized for these browsers so that tweening skips these properties altogether\n\t\t\t\t\t (since it will ignore them as being unsupported by the browser.) */\n\t\t\t\t\tif ((!IE || IE > 9) && !Velocity.State.isGingerbread) {\n\t\t\t\t\t\t/* Note: Since the standalone CSS \"perspective\" property and the CSS transform \"perspective\" subproperty\n\t\t\t\t\t\t share the same name, the latter is given a unique token within Velocity: \"transformPerspective\". */\n\t\t\t\t\t\tCSS.Lists.transformsBase = CSS.Lists.transformsBase.concat(CSS.Lists.transforms3D);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < CSS.Lists.transformsBase.length; i++) {\n\t\t\t\t\t\t/* Wrap the dynamically generated normalization function in a new scope so that transformName's value is\n\t\t\t\t\t\t paired with its respective function. (Otherwise, all functions would take the final for loop's transformName.) */\n\t\t\t\t\t\t(function() {\n\t\t\t\t\t\t\tvar transformName = CSS.Lists.transformsBase[i];\n\n\t\t\t\t\t\t\tCSS.Normalizations.registered[transformName] = function(type, element, propertyValue) {\n\t\t\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\t\t\t/* The normalized property name is the parent \"transform\" property -- the property that is actually set in CSS. */\n\t\t\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\t\t\treturn \"transform\";\n\t\t\t\t\t\t\t\t\t\t/* Transform values are cached onto a per-element transformCache object. */\n\t\t\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\t\t\t/* If this transform has yet to be assigned a value, return its null value. */\n\t\t\t\t\t\t\t\t\t\tif (Data(element) === undefined || Data(element).transformCache[transformName] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t/* Scale CSS.Lists.transformsBase default to 1 whereas all other transform properties default to 0. */\n\t\t\t\t\t\t\t\t\t\t\treturn /^scale/i.test(transformName) ? 1 : 0;\n\t\t\t\t\t\t\t\t\t\t\t/* When transform values are set, they are wrapped in parentheses as per the CSS spec.\n\t\t\t\t\t\t\t\t\t\t\t Thus, when extracting their values (for tween calculations), we strip off the parentheses. */\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn Data(element).transformCache[transformName].replace(/[()]/g, \"\");\n\t\t\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\t\t\tvar invalid = false;\n\n\t\t\t\t\t\t\t\t\t\t/* If an individual transform property contains an unsupported unit type, the browser ignores the *entire* transform property.\n\t\t\t\t\t\t\t\t\t\t Thus, protect users from themselves by skipping setting for transform values supplied with invalid unit types. */\n\t\t\t\t\t\t\t\t\t\t/* Switch on the base transform type; ignore the axis by removing the last letter from the transform's name. */\n\t\t\t\t\t\t\t\t\t\tswitch (transformName.substr(0, transformName.length - 1)) {\n\t\t\t\t\t\t\t\t\t\t\t/* Whitelist unit types for each transform. */\n\t\t\t\t\t\t\t\t\t\t\tcase \"translate\":\n\t\t\t\t\t\t\t\t\t\t\t\tinvalid = !/(%|px|em|rem|vw|vh|\\d)$/i.test(propertyValue);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t/* Since an axis-free \"scale\" property is supported as well, a little hack is used here to detect it by chopping off its last letter. */\n\t\t\t\t\t\t\t\t\t\t\tcase \"scal\":\n\t\t\t\t\t\t\t\t\t\t\tcase \"scale\":\n\t\t\t\t\t\t\t\t\t\t\t\t/* Chrome on Android has a bug in which scaled elements blur if their initial scale\n\t\t\t\t\t\t\t\t\t\t\t\t value is below 1 (which can happen with forcefeeding). Thus, we detect a yet-unset scale property\n\t\t\t\t\t\t\t\t\t\t\t\t and ensure that its first value is always 1. More info: http://stackoverflow.com/questions/10417890/css3-animations-with-transform-causes-blurred-elements-on-webkit/10417962#10417962 */\n\t\t\t\t\t\t\t\t\t\t\t\tif (Velocity.State.isAndroid && Data(element).transformCache[transformName] === undefined && propertyValue < 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpropertyValue = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tinvalid = !/(\\d)$/i.test(propertyValue);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase \"skew\":\n\t\t\t\t\t\t\t\t\t\t\t\tinvalid = !/(deg|\\d)$/i.test(propertyValue);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase \"rotate\":\n\t\t\t\t\t\t\t\t\t\t\t\tinvalid = !/(deg|\\d)$/i.test(propertyValue);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!invalid) {\n\t\t\t\t\t\t\t\t\t\t\t/* As per the CSS spec, wrap the value in parentheses. */\n\t\t\t\t\t\t\t\t\t\t\tData(element).transformCache[transformName] = \"(\" + propertyValue + \")\";\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t/* Although the value is set on the transformCache object, return the newly-updated value for the calling code to process as normal. */\n\t\t\t\t\t\t\t\t\t\treturn Data(element).transformCache[transformName];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})();\n\t\t\t\t\t}\n\n\t\t\t\t\t/*************\n\t\t\t\t\t Colors\n\t\t\t\t\t *************/\n\n\t\t\t\t\t/* Since Velocity only animates a single numeric value per property, color animation is achieved by hooking the individual RGBA components of CSS color properties.\n\t\t\t\t\t Accordingly, color values must be normalized (e.g. \"#ff0000\", \"red\", and \"rgb(255, 0, 0)\" ==> \"255 0 0 1\") so that their components can be injected/extracted by CSS.Hooks logic. */\n\t\t\t\t\tfor (var j = 0; j < CSS.Lists.colors.length; j++) {\n\t\t\t\t\t\t/* Wrap the dynamically generated normalization function in a new scope so that colorName's value is paired with its respective function.\n\t\t\t\t\t\t (Otherwise, all functions would take the final for loop's colorName.) */\n\t\t\t\t\t\t(function() {\n\t\t\t\t\t\t\tvar colorName = CSS.Lists.colors[j];\n\n\t\t\t\t\t\t\t/* Note: In IE<=8, which support rgb but not rgba, color properties are reverted to rgb by stripping off the alpha component. */\n\t\t\t\t\t\t\tCSS.Normalizations.registered[colorName] = function(type, element, propertyValue) {\n\t\t\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\t\t\tcase \"name\":\n\t\t\t\t\t\t\t\t\t\treturn colorName;\n\t\t\t\t\t\t\t\t\t\t/* Convert all color values into the rgb format. (Old IE can return hex values and color names instead of rgb/rgba.) */\n\t\t\t\t\t\t\t\t\tcase \"extract\":\n\t\t\t\t\t\t\t\t\t\tvar extracted;\n\n\t\t\t\t\t\t\t\t\t\t/* If the color is already in its hookable form (e.g. \"255 255 255 1\") due to having been previously extracted, skip extraction. */\n\t\t\t\t\t\t\t\t\t\tif (CSS.RegEx.wrappedValueAlreadyExtracted.test(propertyValue)) {\n\t\t\t\t\t\t\t\t\t\t\textracted = propertyValue;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tvar converted,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolorNames = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tblack: \"rgb(0, 0, 0)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tblue: \"rgb(0, 0, 255)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgray: \"rgb(128, 128, 128)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgreen: \"rgb(0, 128, 0)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tred: \"rgb(255, 0, 0)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhite: \"rgb(255, 255, 255)\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t/* Convert color names to rgb. */\n\t\t\t\t\t\t\t\t\t\t\tif (/^[A-z]+$/i.test(propertyValue)) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (colorNames[propertyValue] !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconverted = colorNames[propertyValue];\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t/* If an unmatched color name is provided, default to black. */\n\t\t\t\t\t\t\t\t\t\t\t\t\tconverted = colorNames.black;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/* Convert hex values to rgb. */\n\t\t\t\t\t\t\t\t\t\t\t} else if (CSS.RegEx.isHex.test(propertyValue)) {\n\t\t\t\t\t\t\t\t\t\t\t\tconverted = \"rgb(\" + CSS.Values.hexToRgb(propertyValue).join(\" \") + \")\";\n\t\t\t\t\t\t\t\t\t\t\t\t/* If the provided color doesn't match any of the accepted color formats, default to black. */\n\t\t\t\t\t\t\t\t\t\t\t} else if (!(/^rgba?\\(/i.test(propertyValue))) {\n\t\t\t\t\t\t\t\t\t\t\t\tconverted = colorNames.black;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t/* Remove the surrounding \"rgb/rgba()\" string then replace commas with spaces and strip\n\t\t\t\t\t\t\t\t\t\t\t repeated spaces (in case the value included spaces to begin with). */\n\t\t\t\t\t\t\t\t\t\t\textracted = (converted || propertyValue).toString().match(CSS.RegEx.valueUnwrap)[1].replace(/,(\\s+)?/g, \" \");\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t/* So long as this isn't <=IE8, add a fourth (alpha) component if it's missing and default it to 1 (visible). */\n\t\t\t\t\t\t\t\t\t\tif ((!IE || IE > 8) && extracted.split(\" \").length === 3) {\n\t\t\t\t\t\t\t\t\t\t\textracted += \" 1\";\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn extracted;\n\t\t\t\t\t\t\t\t\tcase \"inject\":\n\t\t\t\t\t\t\t\t\t\t/* If this is IE<=8 and an alpha component exists, strip it off. */\n\t\t\t\t\t\t\t\t\t\tif (IE <= 8) {\n\t\t\t\t\t\t\t\t\t\t\tif (propertyValue.split(\" \").length === 4) {\n\t\t\t\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.split(/\\s+/).slice(0, 3).join(\" \");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/* Otherwise, add a fourth (alpha) component if it's missing and default it to 1 (visible). */\n\t\t\t\t\t\t\t\t\t\t} else if (propertyValue.split(\" \").length === 3) {\n\t\t\t\t\t\t\t\t\t\t\tpropertyValue += \" 1\";\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t/* Re-insert the browser-appropriate wrapper(\"rgb/rgba()\"), insert commas, and strip off decimal units\n\t\t\t\t\t\t\t\t\t\t on all values but the fourth (R, G, and B only accept whole numbers). */\n\t\t\t\t\t\t\t\t\t\treturn (IE <= 8 ? \"rgb\" : \"rgba\") + \"(\" + propertyValue.replace(/\\s+/g, \",\").replace(/\\.(\\d)+(?=,)/g, \"\") + \")\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/************************\n\t\t\t CSS Property Names\n\t\t\t ************************/\n\n\t\t\tNames: {\n\t\t\t\t/* Camelcase a property name into its JavaScript notation (e.g. \"background-color\" ==> \"backgroundColor\").\n\t\t\t\t Camelcasing is used to normalize property names between and across calls. */\n\t\t\t\tcamelCase: function(property) {\n\t\t\t\t\treturn property.replace(/-(\\w)/g, function(match, subMatch) {\n\t\t\t\t\t\treturn subMatch.toUpperCase();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/* For SVG elements, some properties (namely, dimensional ones) are GET/SET via the element's HTML attributes (instead of via CSS styles). */\n\t\t\t\tSVGAttribute: function(property) {\n\t\t\t\t\tvar SVGAttributes = \"width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2\";\n\n\t\t\t\t\t/* Certain browsers require an SVG transform to be applied as an attribute. (Otherwise, application via CSS is preferable due to 3D support.) */\n\t\t\t\t\tif (IE || (Velocity.State.isAndroid && !Velocity.State.isChrome)) {\n\t\t\t\t\t\tSVGAttributes += \"|transform\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new RegExp(\"^(\" + SVGAttributes + \")$\", \"i\").test(property);\n\t\t\t\t},\n\t\t\t\t/* Determine whether a property should be set with a vendor prefix. */\n\t\t\t\t/* If a prefixed version of the property exists, return it. Otherwise, return the original property name.\n\t\t\t\t If the property is not at all supported by the browser, return a false flag. */\n\t\t\t\tprefixCheck: function(property) {\n\t\t\t\t\t/* If this property has already been checked, return the cached value. */\n\t\t\t\t\tif (Velocity.State.prefixMatches[property]) {\n\t\t\t\t\t\treturn [Velocity.State.prefixMatches[property], true];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar vendors = [\"\", \"Webkit\", \"Moz\", \"ms\", \"O\"];\n\n\t\t\t\t\t\tfor (var i = 0, vendorsLength = vendors.length; i < vendorsLength; i++) {\n\t\t\t\t\t\t\tvar propertyPrefixed;\n\n\t\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\t\tpropertyPrefixed = property;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t/* Capitalize the first letter of the property to conform to JavaScript vendor prefix notation (e.g. webkitFilter). */\n\t\t\t\t\t\t\t\tpropertyPrefixed = vendors[i] + property.replace(/^\\w/, function(match) {\n\t\t\t\t\t\t\t\t\treturn match.toUpperCase();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Check if the browser supports this property as prefixed. */\n\t\t\t\t\t\t\tif (Type.isString(Velocity.State.prefixElement.style[propertyPrefixed])) {\n\t\t\t\t\t\t\t\t/* Cache the match. */\n\t\t\t\t\t\t\t\tVelocity.State.prefixMatches[property] = propertyPrefixed;\n\n\t\t\t\t\t\t\t\treturn [propertyPrefixed, true];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* If the browser doesn't support this property in any form, include a false flag so that the caller can decide how to proceed. */\n\t\t\t\t\t\treturn [property, false];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/************************\n\t\t\t CSS Property Values\n\t\t\t ************************/\n\n\t\t\tValues: {\n\t\t\t\t/* Hex to RGB conversion. Copyright Tim Down: http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb */\n\t\t\t\thexToRgb: function(hex) {\n\t\t\t\t\tvar shortformRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n\t\t\t\t\t\t\tlongformRegex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i,\n\t\t\t\t\t\t\trgbParts;\n\n\t\t\t\t\thex = hex.replace(shortformRegex, function(m, r, g, b) {\n\t\t\t\t\t\treturn r + r + g + g + b + b;\n\t\t\t\t\t});\n\n\t\t\t\t\trgbParts = longformRegex.exec(hex);\n\n\t\t\t\t\treturn rgbParts ? [parseInt(rgbParts[1], 16), parseInt(rgbParts[2], 16), parseInt(rgbParts[3], 16)] : [0, 0, 0];\n\t\t\t\t},\n\t\t\t\tisCSSNullValue: function(value) {\n\t\t\t\t\t/* The browser defaults CSS values that have not been set to either 0 or one of several possible null-value strings.\n\t\t\t\t\t Thus, we check for both falsiness and these special strings. */\n\t\t\t\t\t/* Null-value checking is performed to default the special strings to 0 (for the sake of tweening) or their hook\n\t\t\t\t\t templates as defined as CSS.Hooks (for the sake of hook injection/extraction). */\n\t\t\t\t\t/* Note: Chrome returns \"rgba(0, 0, 0, 0)\" for an undefined color whereas IE returns \"transparent\". */\n\t\t\t\t\treturn (!value || /^(none|auto|transparent|(rgba\\(0, ?0, ?0, ?0\\)))$/i.test(value));\n\t\t\t\t},\n\t\t\t\t/* Retrieve a property's default unit type. Used for assigning a unit type when one is not supplied by the user. */\n\t\t\t\tgetUnitType: function(property) {\n\t\t\t\t\tif (/^(rotate|skew)/i.test(property)) {\n\t\t\t\t\t\treturn \"deg\";\n\t\t\t\t\t} else if (/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(property)) {\n\t\t\t\t\t\t/* The above properties are unitless. */\n\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Default to px for all other properties. */\n\t\t\t\t\t\treturn \"px\";\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/* HTML elements default to an associated display type when they're not set to display:none. */\n\t\t\t\t/* Note: This function is used for correctly setting the non-\"none\" display value in certain Velocity redirects, such as fadeIn/Out. */\n\t\t\t\tgetDisplayType: function(element) {\n\t\t\t\t\tvar tagName = element && element.tagName.toString().toLowerCase();\n\n\t\t\t\t\tif (/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(tagName)) {\n\t\t\t\t\t\treturn \"inline\";\n\t\t\t\t\t} else if (/^(li)$/i.test(tagName)) {\n\t\t\t\t\t\treturn \"list-item\";\n\t\t\t\t\t} else if (/^(tr)$/i.test(tagName)) {\n\t\t\t\t\t\treturn \"table-row\";\n\t\t\t\t\t} else if (/^(table)$/i.test(tagName)) {\n\t\t\t\t\t\treturn \"table\";\n\t\t\t\t\t} else if (/^(tbody)$/i.test(tagName)) {\n\t\t\t\t\t\treturn \"table-row-group\";\n\t\t\t\t\t\t/* Default to \"block\" when no match is found. */\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"block\";\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/* The class add/remove functions are used to temporarily apply a \"velocity-animating\" class to elements while they're animating. */\n\t\t\t\taddClass: function(element, className) {\n\t\t\t\t\tif (element.classList) {\n\t\t\t\t\t\telement.classList.add(className);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.className += (element.className.length ? \" \" : \"\") + className;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveClass: function(element, className) {\n\t\t\t\t\tif (element.classList) {\n\t\t\t\t\t\telement.classList.remove(className);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.className = element.className.toString().replace(new RegExp(\"(^|\\\\s)\" + className.split(\" \").join(\"|\") + \"(\\\\s|$)\", \"gi\"), \" \");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/****************************\n\t\t\t Style Getting & Setting\n\t\t\t ****************************/\n\n\t\t\t/* The singular getPropertyValue, which routes the logic for all normalizations, hooks, and standard CSS properties. */\n\t\t\tgetPropertyValue: function(element, property, rootPropertyValue, forceStyleLookup) {\n\t\t\t\t/* Get an element's computed property value. */\n\t\t\t\t/* Note: Retrieving the value of a CSS property cannot simply be performed by checking an element's\n\t\t\t\t style attribute (which only reflects user-defined values). Instead, the browser must be queried for a property's\n\t\t\t\t *computed* value. You can read more about getComputedStyle here: https://developer.mozilla.org/en/docs/Web/API/window.getComputedStyle */\n\t\t\t\tfunction computePropertyValue(element, property) {\n\t\t\t\t\t/* When box-sizing isn't set to border-box, height and width style values are incorrectly computed when an\n\t\t\t\t\t element's scrollbars are visible (which expands the element's dimensions). Thus, we defer to the more accurate\n\t\t\t\t\t offsetHeight/Width property, which includes the total dimensions for interior, border, padding, and scrollbar.\n\t\t\t\t\t We subtract border and padding to get the sum of interior + scrollbar. */\n\t\t\t\t\tvar computedValue = 0;\n\n\t\t\t\t\t/* IE<=8 doesn't support window.getComputedStyle, thus we defer to jQuery, which has an extensive array\n\t\t\t\t\t of hacks to accurately retrieve IE8 property values. Re-implementing that logic here is not worth bloating the\n\t\t\t\t\t codebase for a dying browser. The performance repercussions of using jQuery here are minimal since\n\t\t\t\t\t Velocity is optimized to rarely (and sometimes never) query the DOM. Further, the $.css() codepath isn't that slow. */\n\t\t\t\t\tif (IE <= 8) {\n\t\t\t\t\t\tcomputedValue = $.css(element, property); /* GET */\n\t\t\t\t\t\t/* All other browsers support getComputedStyle. The returned live object reference is cached onto its\n\t\t\t\t\t\t associated element so that it does not need to be refetched upon every GET. */\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Browsers do not return height and width values for elements that are set to display:\"none\". Thus, we temporarily\n\t\t\t\t\t\t toggle display to the element type's default value. */\n\t\t\t\t\t\tvar toggleDisplay = false;\n\n\t\t\t\t\t\tif (/^(width|height)$/.test(property) && CSS.getPropertyValue(element, \"display\") === 0) {\n\t\t\t\t\t\t\ttoggleDisplay = true;\n\t\t\t\t\t\t\tCSS.setPropertyValue(element, \"display\", CSS.Values.getDisplayType(element));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar revertDisplay = function() {\n\t\t\t\t\t\t\tif (toggleDisplay) {\n\t\t\t\t\t\t\t\tCSS.setPropertyValue(element, \"display\", \"none\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!forceStyleLookup) {\n\t\t\t\t\t\t\tif (property === \"height\" && CSS.getPropertyValue(element, \"boxSizing\").toString().toLowerCase() !== \"border-box\") {\n\t\t\t\t\t\t\t\tvar contentBoxHeight = element.offsetHeight - (parseFloat(CSS.getPropertyValue(element, \"borderTopWidth\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"borderBottomWidth\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"paddingTop\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"paddingBottom\")) || 0);\n\t\t\t\t\t\t\t\trevertDisplay();\n\n\t\t\t\t\t\t\t\treturn contentBoxHeight;\n\t\t\t\t\t\t\t} else if (property === \"width\" && CSS.getPropertyValue(element, \"boxSizing\").toString().toLowerCase() !== \"border-box\") {\n\t\t\t\t\t\t\t\tvar contentBoxWidth = element.offsetWidth - (parseFloat(CSS.getPropertyValue(element, \"borderLeftWidth\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"borderRightWidth\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"paddingLeft\")) || 0) - (parseFloat(CSS.getPropertyValue(element, \"paddingRight\")) || 0);\n\t\t\t\t\t\t\t\trevertDisplay();\n\n\t\t\t\t\t\t\t\treturn contentBoxWidth;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar computedStyle;\n\n\t\t\t\t\t\t/* For elements that Velocity hasn't been called on directly (e.g. when Velocity queries the DOM on behalf\n\t\t\t\t\t\t of a parent of an element its animating), perform a direct getComputedStyle lookup since the object isn't cached. */\n\t\t\t\t\t\tif (Data(element) === undefined) {\n\t\t\t\t\t\t\tcomputedStyle = window.getComputedStyle(element, null); /* GET */\n\t\t\t\t\t\t\t/* If the computedStyle object has yet to be cached, do so now. */\n\t\t\t\t\t\t} else if (!Data(element).computedStyle) {\n\t\t\t\t\t\t\tcomputedStyle = Data(element).computedStyle = window.getComputedStyle(element, null); /* GET */\n\t\t\t\t\t\t\t/* If computedStyle is cached, use it. */\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomputedStyle = Data(element).computedStyle;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* IE and Firefox do not return a value for the generic borderColor -- they only return individual values for each border side's color.\n\t\t\t\t\t\t Also, in all browsers, when border colors aren't all the same, a compound value is returned that Velocity isn't setup to parse.\n\t\t\t\t\t\t So, as a polyfill for querying individual border side colors, we just return the top border's color and animate all borders from that value. */\n\t\t\t\t\t\tif (property === \"borderColor\") {\n\t\t\t\t\t\t\tproperty = \"borderTopColor\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* IE9 has a bug in which the \"filter\" property must be accessed from computedStyle using the getPropertyValue method\n\t\t\t\t\t\t instead of a direct property lookup. The getPropertyValue method is slower than a direct lookup, which is why we avoid it by default. */\n\t\t\t\t\t\tif (IE === 9 && property === \"filter\") {\n\t\t\t\t\t\t\tcomputedValue = computedStyle.getPropertyValue(property); /* GET */\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomputedValue = computedStyle[property];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Fall back to the property's style value (if defined) when computedValue returns nothing,\n\t\t\t\t\t\t which can happen when the element hasn't been painted. */\n\t\t\t\t\t\tif (computedValue === \"\" || computedValue === null) {\n\t\t\t\t\t\t\tcomputedValue = element.style[property];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trevertDisplay();\n\t\t\t\t\t}\n\n\t\t\t\t\t/* For top, right, bottom, and left (TRBL) values that are set to \"auto\" on elements of \"fixed\" or \"absolute\" position,\n\t\t\t\t\t defer to jQuery for converting \"auto\" to a numeric value. (For elements with a \"static\" or \"relative\" position, \"auto\" has the same\n\t\t\t\t\t effect as being set to 0, so no conversion is necessary.) */\n\t\t\t\t\t/* An example of why numeric conversion is necessary: When an element with \"position:absolute\" has an untouched \"left\"\n\t\t\t\t\t property, which reverts to \"auto\", left's value is 0 relative to its parent element, but is often non-zero relative\n\t\t\t\t\t to its *containing* (not parent) element, which is the nearest \"position:relative\" ancestor or the viewport (and always the viewport in the case of \"position:fixed\"). */\n\t\t\t\t\tif (computedValue === \"auto\" && /^(top|right|bottom|left)$/i.test(property)) {\n\t\t\t\t\t\tvar position = computePropertyValue(element, \"position\"); /* GET */\n\n\t\t\t\t\t\t/* For absolute positioning, jQuery's $.position() only returns values for top and left;\n\t\t\t\t\t\t right and bottom will have their \"auto\" value reverted to 0. */\n\t\t\t\t\t\t/* Note: A jQuery object must be created here since jQuery doesn't have a low-level alias for $.position().\n\t\t\t\t\t\t Not a big deal since we're currently in a GET batch anyway. */\n\t\t\t\t\t\tif (position === \"fixed\" || (position === \"absolute\" && /top|left/i.test(property))) {\n\t\t\t\t\t\t\t/* Note: jQuery strips the pixel unit from its returned values; we re-add it here to conform with computePropertyValue's behavior. */\n\t\t\t\t\t\t\tcomputedValue = $(element).position()[property] + \"px\"; /* GET */\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn computedValue;\n\t\t\t\t}\n\n\t\t\t\tvar propertyValue;\n\n\t\t\t\t/* If this is a hooked property (e.g. \"clipLeft\" instead of the root property of \"clip\"),\n\t\t\t\t extract the hook's value from a normalized rootPropertyValue using CSS.Hooks.extractValue(). */\n\t\t\t\tif (CSS.Hooks.registered[property]) {\n\t\t\t\t\tvar hook = property,\n\t\t\t\t\t\t\thookRoot = CSS.Hooks.getRoot(hook);\n\n\t\t\t\t\t/* If a cached rootPropertyValue wasn't passed in (which Velocity always attempts to do in order to avoid requerying the DOM),\n\t\t\t\t\t query the DOM for the root property's value. */\n\t\t\t\t\tif (rootPropertyValue === undefined) {\n\t\t\t\t\t\t/* Since the browser is now being directly queried, use the official post-prefixing property name for this lookup. */\n\t\t\t\t\t\trootPropertyValue = CSS.getPropertyValue(element, CSS.Names.prefixCheck(hookRoot)[0]); /* GET */\n\t\t\t\t\t}\n\n\t\t\t\t\t/* If this root has a normalization registered, peform the associated normalization extraction. */\n\t\t\t\t\tif (CSS.Normalizations.registered[hookRoot]) {\n\t\t\t\t\t\trootPropertyValue = CSS.Normalizations.registered[hookRoot](\"extract\", element, rootPropertyValue);\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Extract the hook's value. */\n\t\t\t\t\tpropertyValue = CSS.Hooks.extractValue(hook, rootPropertyValue);\n\n\t\t\t\t\t/* If this is a normalized property (e.g. \"opacity\" becomes \"filter\" in <=IE8) or \"translateX\" becomes \"transform\"),\n\t\t\t\t\t normalize the property's name and value, and handle the special case of transforms. */\n\t\t\t\t\t/* Note: Normalizing a property is mutually exclusive from hooking a property since hook-extracted values are strictly\n\t\t\t\t\t numerical and therefore do not require normalization extraction. */\n\t\t\t\t} else if (CSS.Normalizations.registered[property]) {\n\t\t\t\t\tvar normalizedPropertyName,\n\t\t\t\t\t\t\tnormalizedPropertyValue;\n\n\t\t\t\t\tnormalizedPropertyName = CSS.Normalizations.registered[property](\"name\", element);\n\n\t\t\t\t\t/* Transform values are calculated via normalization extraction (see below), which checks against the element's transformCache.\n\t\t\t\t\t At no point do transform GETs ever actually query the DOM; initial stylesheet values are never processed.\n\t\t\t\t\t This is because parsing 3D transform matrices is not always accurate and would bloat our codebase;\n\t\t\t\t\t thus, normalization extraction defaults initial transform values to their zero-values (e.g. 1 for scaleX and 0 for translateX). */\n\t\t\t\t\tif (normalizedPropertyName !== \"transform\") {\n\t\t\t\t\t\tnormalizedPropertyValue = computePropertyValue(element, CSS.Names.prefixCheck(normalizedPropertyName)[0]); /* GET */\n\n\t\t\t\t\t\t/* If the value is a CSS null-value and this property has a hook template, use that zero-value template so that hooks can be extracted from it. */\n\t\t\t\t\t\tif (CSS.Values.isCSSNullValue(normalizedPropertyValue) && CSS.Hooks.templates[property]) {\n\t\t\t\t\t\t\tnormalizedPropertyValue = CSS.Hooks.templates[property][1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpropertyValue = CSS.Normalizations.registered[property](\"extract\", element, normalizedPropertyValue);\n\t\t\t\t}\n\n\t\t\t\t/* If a (numeric) value wasn't produced via hook extraction or normalization, query the DOM. */\n\t\t\t\tif (!/^[\\d-]/.test(propertyValue)) {\n\t\t\t\t\t/* For SVG elements, dimensional properties (which SVGAttribute() detects) are tweened via\n\t\t\t\t\t their HTML attribute values instead of their CSS style values. */\n\t\t\t\t\tvar data = Data(element);\n\n\t\t\t\t\tif (data && data.isSVG && CSS.Names.SVGAttribute(property)) {\n\t\t\t\t\t\t/* Since the height/width attribute values must be set manually, they don't reflect computed values.\n\t\t\t\t\t\t Thus, we use use getBBox() to ensure we always get values for elements with undefined height/width attributes. */\n\t\t\t\t\t\tif (/^(height|width)$/i.test(property)) {\n\t\t\t\t\t\t\t/* Firefox throws an error if .getBBox() is called on an SVG that isn't attached to the DOM. */\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tpropertyValue = element.getBBox()[property];\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tpropertyValue = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* Otherwise, access the attribute value directly. */\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpropertyValue = element.getAttribute(property);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpropertyValue = computePropertyValue(element, CSS.Names.prefixCheck(property)[0]); /* GET */\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Since property lookups are for animation purposes (which entails computing the numeric delta between start and end values),\n\t\t\t\t convert CSS null-values to an integer of value 0. */\n\t\t\t\tif (CSS.Values.isCSSNullValue(propertyValue)) {\n\t\t\t\t\tpropertyValue = 0;\n\t\t\t\t}\n\n\t\t\t\tif (Velocity.debug >= 2) {\n\t\t\t\t\tconsole.log(\"Get \" + property + \": \" + propertyValue);\n\t\t\t\t}\n\n\t\t\t\treturn propertyValue;\n\t\t\t},\n\t\t\t/* The singular setPropertyValue, which routes the logic for all normalizations, hooks, and standard CSS properties. */\n\t\t\tsetPropertyValue: function(element, property, propertyValue, rootPropertyValue, scrollData) {\n\t\t\t\tvar propertyName = property;\n\n\t\t\t\t/* In order to be subjected to call options and element queueing, scroll animation is routed through Velocity as if it were a standard CSS property. */\n\t\t\t\tif (property === \"scroll\") {\n\t\t\t\t\t/* If a container option is present, scroll the container instead of the browser window. */\n\t\t\t\t\tif (scrollData.container) {\n\t\t\t\t\t\tscrollData.container[\"scroll\" + scrollData.direction] = propertyValue;\n\t\t\t\t\t\t/* Otherwise, Velocity defaults to scrolling the browser window. */\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (scrollData.direction === \"Left\") {\n\t\t\t\t\t\t\twindow.scrollTo(propertyValue, scrollData.alternateValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.scrollTo(scrollData.alternateValue, propertyValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t/* Transforms (translateX, rotateZ, etc.) are applied to a per-element transformCache object, which is manually flushed via flushTransformCache().\n\t\t\t\t\t Thus, for now, we merely cache transforms being SET. */\n\t\t\t\t\tif (CSS.Normalizations.registered[property] && CSS.Normalizations.registered[property](\"name\", element) === \"transform\") {\n\t\t\t\t\t\t/* Perform a normalization injection. */\n\t\t\t\t\t\t/* Note: The normalization logic handles the transformCache updating. */\n\t\t\t\t\t\tCSS.Normalizations.registered[property](\"inject\", element, propertyValue);\n\n\t\t\t\t\t\tpropertyName = \"transform\";\n\t\t\t\t\t\tpropertyValue = Data(element).transformCache[property];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Inject hooks. */\n\t\t\t\t\t\tif (CSS.Hooks.registered[property]) {\n\t\t\t\t\t\t\tvar hookName = property,\n\t\t\t\t\t\t\t\t\thookRoot = CSS.Hooks.getRoot(property);\n\n\t\t\t\t\t\t\t/* If a cached rootPropertyValue was not provided, query the DOM for the hookRoot's current value. */\n\t\t\t\t\t\t\trootPropertyValue = rootPropertyValue || CSS.getPropertyValue(element, hookRoot); /* GET */\n\n\t\t\t\t\t\t\tpropertyValue = CSS.Hooks.injectValue(hookName, propertyValue, rootPropertyValue);\n\t\t\t\t\t\t\tproperty = hookRoot;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Normalize names and values. */\n\t\t\t\t\t\tif (CSS.Normalizations.registered[property]) {\n\t\t\t\t\t\t\tpropertyValue = CSS.Normalizations.registered[property](\"inject\", element, propertyValue);\n\t\t\t\t\t\t\tproperty = CSS.Normalizations.registered[property](\"name\", element);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Assign the appropriate vendor prefix before performing an official style update. */\n\t\t\t\t\t\tpropertyName = CSS.Names.prefixCheck(property)[0];\n\n\t\t\t\t\t\t/* A try/catch is used for IE<=8, which throws an error when \"invalid\" CSS values are set, e.g. a negative width.\n\t\t\t\t\t\t Try/catch is avoided for other browsers since it incurs a performance overhead. */\n\t\t\t\t\t\tif (IE <= 8) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\telement.style[propertyName] = propertyValue;\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tif (Velocity.debug) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"Browser does not support [\" + propertyValue + \"] for [\" + propertyName + \"]\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* SVG elements have their dimensional properties (width, height, x, y, cx, etc.) applied directly as attributes instead of as styles. */\n\t\t\t\t\t\t\t/* Note: IE8 does not support SVG elements, so it's okay that we skip it for SVG animation. */\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar data = Data(element);\n\n\t\t\t\t\t\t\tif (data && data.isSVG && CSS.Names.SVGAttribute(property)) {\n\t\t\t\t\t\t\t\t/* Note: For SVG attributes, vendor-prefixed property names are never used. */\n\t\t\t\t\t\t\t\t/* Note: Not all CSS properties can be animated via attributes, but the browser won't throw an error for unsupported properties. */\n\t\t\t\t\t\t\t\telement.setAttribute(property, propertyValue);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telement.style[propertyName] = propertyValue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Velocity.debug >= 2) {\n\t\t\t\t\t\t\tconsole.log(\"Set \" + property + \" (\" + propertyName + \"): \" + propertyValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Return the normalized property name and value in case the caller wants to know how these values were modified before being applied to the DOM. */\n\t\t\t\treturn [propertyName, propertyValue];\n\t\t\t},\n\t\t\t/* To increase performance by batching transform updates into a single SET, transforms are not directly applied to an element until flushTransformCache() is called. */\n\t\t\t/* Note: Velocity applies transform properties in the same order that they are chronogically introduced to the element's CSS styles. */\n\t\t\tflushTransformCache: function(element) {\n\t\t\t\tvar transformString = \"\",\n\t\t\t\t\t\tdata = Data(element);\n\n\t\t\t\t/* Certain browsers require that SVG transforms be applied as an attribute. However, the SVG transform attribute takes a modified version of CSS's transform string\n\t\t\t\t (units are dropped and, except for skewX/Y, subproperties are merged into their master property -- e.g. scaleX and scaleY are merged into scale(X Y). */\n\t\t\t\tif ((IE || (Velocity.State.isAndroid && !Velocity.State.isChrome)) && data && data.isSVG) {\n\t\t\t\t\t/* Since transform values are stored in their parentheses-wrapped form, we use a helper function to strip out their numeric values.\n\t\t\t\t\t Further, SVG transform properties only take unitless (representing pixels) values, so it's okay that parseFloat() strips the unit suffixed to the float value. */\n\t\t\t\t\tvar getTransformFloat = function(transformProperty) {\n\t\t\t\t\t\treturn parseFloat(CSS.getPropertyValue(element, transformProperty));\n\t\t\t\t\t};\n\n\t\t\t\t\t/* Create an object to organize all the transforms that we'll apply to the SVG element. To keep the logic simple,\n\t\t\t\t\t we process *all* transform properties -- even those that may not be explicitly applied (since they default to their zero-values anyway). */\n\t\t\t\t\tvar SVGTransforms = {\n\t\t\t\t\t\ttranslate: [getTransformFloat(\"translateX\"), getTransformFloat(\"translateY\")],\n\t\t\t\t\t\tskewX: [getTransformFloat(\"skewX\")], skewY: [getTransformFloat(\"skewY\")],\n\t\t\t\t\t\t/* If the scale property is set (non-1), use that value for the scaleX and scaleY values\n\t\t\t\t\t\t (this behavior mimics the result of animating all these properties at once on HTML elements). */\n\t\t\t\t\t\tscale: getTransformFloat(\"scale\") !== 1 ? [getTransformFloat(\"scale\"), getTransformFloat(\"scale\")] : [getTransformFloat(\"scaleX\"), getTransformFloat(\"scaleY\")],\n\t\t\t\t\t\t/* Note: SVG's rotate transform takes three values: rotation degrees followed by the X and Y values\n\t\t\t\t\t\t defining the rotation's origin point. We ignore the origin values (default them to 0). */\n\t\t\t\t\t\trotate: [getTransformFloat(\"rotateZ\"), 0, 0]\n\t\t\t\t\t};\n\n\t\t\t\t\t/* Iterate through the transform properties in the user-defined property map order.\n\t\t\t\t\t (This mimics the behavior of non-SVG transform animation.) */\n\t\t\t\t\t$.each(Data(element).transformCache, function(transformName) {\n\t\t\t\t\t\t/* Except for with skewX/Y, revert the axis-specific transform subproperties to their axis-free master\n\t\t\t\t\t\t properties so that they match up with SVG's accepted transform properties. */\n\t\t\t\t\t\tif (/^translate/i.test(transformName)) {\n\t\t\t\t\t\t\ttransformName = \"translate\";\n\t\t\t\t\t\t} else if (/^scale/i.test(transformName)) {\n\t\t\t\t\t\t\ttransformName = \"scale\";\n\t\t\t\t\t\t} else if (/^rotate/i.test(transformName)) {\n\t\t\t\t\t\t\ttransformName = \"rotate\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Check that we haven't yet deleted the property from the SVGTransforms container. */\n\t\t\t\t\t\tif (SVGTransforms[transformName]) {\n\t\t\t\t\t\t\t/* Append the transform property in the SVG-supported transform format. As per the spec, surround the space-delimited values in parentheses. */\n\t\t\t\t\t\t\ttransformString += transformName + \"(\" + SVGTransforms[transformName].join(\" \") + \")\" + \" \";\n\n\t\t\t\t\t\t\t/* After processing an SVG transform property, delete it from the SVGTransforms container so we don't\n\t\t\t\t\t\t\t re-insert the same master property if we encounter another one of its axis-specific properties. */\n\t\t\t\t\t\t\tdelete SVGTransforms[transformName];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tvar transformValue,\n\t\t\t\t\t\t\tperspective;\n\n\t\t\t\t\t/* Transform properties are stored as members of the transformCache object. Concatenate all the members into a string. */\n\t\t\t\t\t$.each(Data(element).transformCache, function(transformName) {\n\t\t\t\t\t\ttransformValue = Data(element).transformCache[transformName];\n\n\t\t\t\t\t\t/* Transform's perspective subproperty must be set first in order to take effect. Store it temporarily. */\n\t\t\t\t\t\tif (transformName === \"transformPerspective\") {\n\t\t\t\t\t\t\tperspective = transformValue;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* IE9 only supports one rotation type, rotateZ, which it refers to as \"rotate\". */\n\t\t\t\t\t\tif (IE === 9 && transformName === \"rotateZ\") {\n\t\t\t\t\t\t\ttransformName = \"rotate\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttransformString += transformName + transformValue + \" \";\n\t\t\t\t\t});\n\n\t\t\t\t\t/* If present, set the perspective subproperty first. */\n\t\t\t\t\tif (perspective) {\n\t\t\t\t\t\ttransformString = \"perspective\" + perspective + \" \" + transformString;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tCSS.setPropertyValue(element, \"transform\", transformString);\n\t\t\t}\n\t\t};\n\n\t\t/* Register hooks and normalizations. */\n\t\tCSS.Hooks.register();\n\t\tCSS.Normalizations.register();\n\n\t\t/* Allow hook setting in the same fashion as jQuery's $.css(). */\n\t\tVelocity.hook = function(elements, arg2, arg3) {\n\t\t\tvar value;\n\n\t\t\telements = sanitizeElements(elements);\n\n\t\t\t$.each(elements, function(i, element) {\n\t\t\t\t/* Initialize Velocity's per-element data cache if this element hasn't previously been animated. */\n\t\t\t\tif (Data(element) === undefined) {\n\t\t\t\t\tVelocity.init(element);\n\t\t\t\t}\n\n\t\t\t\t/* Get property value. If an element set was passed in, only return the value for the first element. */\n\t\t\t\tif (arg3 === undefined) {\n\t\t\t\t\tif (value === undefined) {\n\t\t\t\t\t\tvalue = Velocity.CSS.getPropertyValue(element, arg2);\n\t\t\t\t\t}\n\t\t\t\t\t/* Set property value. */\n\t\t\t\t} else {\n\t\t\t\t\t/* sPV returns an array of the normalized propertyName/propertyValue pair used to update the DOM. */\n\t\t\t\t\tvar adjustedSet = Velocity.CSS.setPropertyValue(element, arg2, arg3);\n\n\t\t\t\t\t/* Transform properties don't automatically set. They have to be flushed to the DOM. */\n\t\t\t\t\tif (adjustedSet[0] === \"transform\") {\n\t\t\t\t\t\tVelocity.CSS.flushTransformCache(element);\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = adjustedSet;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn value;\n\t\t};\n\n\t\t/*****************\n\t\t Animation\n\t\t *****************/\n\n\t\tvar animate = function() {\n\t\t\tvar opts;\n\n\t\t\t/******************\n\t\t\t Call Chain\n\t\t\t ******************/\n\n\t\t\t/* Logic for determining what to return to the call stack when exiting out of Velocity. */\n\t\t\tfunction getChain() {\n\t\t\t\t/* If we are using the utility function, attempt to return this call's promise. If no promise library was detected,\n\t\t\t\t default to null instead of returning the targeted elements so that utility function's return value is standardized. */\n\t\t\t\tif (isUtility) {\n\t\t\t\t\treturn promiseData.promise || null;\n\t\t\t\t\t/* Otherwise, if we're using $.fn, return the jQuery-/Zepto-wrapped element set. */\n\t\t\t\t} else {\n\t\t\t\t\treturn elementsWrapped;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*************************\n\t\t\t Arguments Assignment\n\t\t\t *************************/\n\n\t\t\t/* To allow for expressive CoffeeScript code, Velocity supports an alternative syntax in which \"elements\" (or \"e\"), \"properties\" (or \"p\"), and \"options\" (or \"o\")\n\t\t\t objects are defined on a container object that's passed in as Velocity's sole argument. */\n\t\t\t/* Note: Some browsers automatically populate arguments with a \"properties\" object. We detect it by checking for its default \"names\" property. */\n\t\t\tvar syntacticSugar = (arguments[0] && (arguments[0].p || (($.isPlainObject(arguments[0].properties) && !arguments[0].properties.names) || Type.isString(arguments[0].properties)))),\n\t\t\t\t\t/* Whether Velocity was called via the utility function (as opposed to on a jQuery/Zepto object). */\n\t\t\t\t\tisUtility,\n\t\t\t\t\t/* When Velocity is called via the utility function ($.Velocity()/Velocity()), elements are explicitly\n\t\t\t\t\t passed in as the first parameter. Thus, argument positioning varies. We normalize them here. */\n\t\t\t\t\telementsWrapped,\n\t\t\t\t\targumentIndex;\n\n\t\t\tvar elements,\n\t\t\t\t\tpropertiesMap,\n\t\t\t\t\toptions;\n\n\t\t\t/* Detect jQuery/Zepto elements being animated via the $.fn method. */\n\t\t\tif (Type.isWrapped(this)) {\n\t\t\t\tisUtility = false;\n\n\t\t\t\targumentIndex = 0;\n\t\t\t\telements = this;\n\t\t\t\telementsWrapped = this;\n\t\t\t\t/* Otherwise, raw elements are being animated via the utility function. */\n\t\t\t} else {\n\t\t\t\tisUtility = true;\n\n\t\t\t\targumentIndex = 1;\n\t\t\t\telements = syntacticSugar ? (arguments[0].elements || arguments[0].e) : arguments[0];\n\t\t\t}\n\n\t\t\telements = sanitizeElements(elements);\n\n\t\t\tif (!elements) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (syntacticSugar) {\n\t\t\t\tpropertiesMap = arguments[0].properties || arguments[0].p;\n\t\t\t\toptions = arguments[0].options || arguments[0].o;\n\t\t\t} else {\n\t\t\t\tpropertiesMap = arguments[argumentIndex];\n\t\t\t\toptions = arguments[argumentIndex + 1];\n\t\t\t}\n\n\t\t\t/* The length of the element set (in the form of a nodeList or an array of elements) is defaulted to 1 in case a\n\t\t\t single raw DOM element is passed in (which doesn't contain a length property). */\n\t\t\tvar elementsLength = elements.length,\n\t\t\t\t\telementsIndex = 0;\n\n\t\t\t/***************************\n\t\t\t Argument Overloading\n\t\t\t ***************************/\n\n\t\t\t/* Support is included for jQuery's argument overloading: $.animate(propertyMap [, duration] [, easing] [, complete]).\n\t\t\t Overloading is detected by checking for the absence of an object being passed into options. */\n\t\t\t/* Note: The stop and finish actions do not accept animation options, and are therefore excluded from this check. */\n\t\t\tif (!/^(stop|finish|finishAll)$/i.test(propertiesMap) && !$.isPlainObject(options)) {\n\t\t\t\t/* The utility function shifts all arguments one position to the right, so we adjust for that offset. */\n\t\t\t\tvar startingArgumentPosition = argumentIndex + 1;\n\n\t\t\t\toptions = {};\n\n\t\t\t\t/* Iterate through all options arguments */\n\t\t\t\tfor (var i = startingArgumentPosition; i < arguments.length; i++) {\n\t\t\t\t\t/* Treat a number as a duration. Parse it out. */\n\t\t\t\t\t/* Note: The following RegEx will return true if passed an array with a number as its first item.\n\t\t\t\t\t Thus, arrays are skipped from this check. */\n\t\t\t\t\tif (!Type.isArray(arguments[i]) && (/^(fast|normal|slow)$/i.test(arguments[i]) || /^\\d/.test(arguments[i]))) {\n\t\t\t\t\t\toptions.duration = arguments[i];\n\t\t\t\t\t\t/* Treat strings and arrays as easings. */\n\t\t\t\t\t} else if (Type.isString(arguments[i]) || Type.isArray(arguments[i])) {\n\t\t\t\t\t\toptions.easing = arguments[i];\n\t\t\t\t\t\t/* Treat a function as a complete callback. */\n\t\t\t\t\t} else if (Type.isFunction(arguments[i])) {\n\t\t\t\t\t\toptions.complete = arguments[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/***************\n\t\t\t Promises\n\t\t\t ***************/\n\n\t\t\tvar promiseData = {\n\t\t\t\tpromise: null,\n\t\t\t\tresolver: null,\n\t\t\t\trejecter: null\n\t\t\t};\n\n\t\t\t/* If this call was made via the utility function (which is the default method of invocation when jQuery/Zepto are not being used), and if\n\t\t\t promise support was detected, create a promise object for this call and store references to its resolver and rejecter methods. The resolve\n\t\t\t method is used when a call completes naturally or is prematurely stopped by the user. In both cases, completeCall() handles the associated\n\t\t\t call cleanup and promise resolving logic. The reject method is used when an invalid set of arguments is passed into a Velocity call. */\n\t\t\t/* Note: Velocity employs a call-based queueing architecture, which means that stopping an animating element actually stops the full call that\n\t\t\t triggered it -- not that one element exclusively. Similarly, there is one promise per call, and all elements targeted by a Velocity call are\n\t\t\t grouped together for the purposes of resolving and rejecting a promise. */\n\t\t\tif (isUtility && Velocity.Promise) {\n\t\t\t\tpromiseData.promise = new Velocity.Promise(function(resolve, reject) {\n\t\t\t\t\tpromiseData.resolver = resolve;\n\t\t\t\t\tpromiseData.rejecter = reject;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t/*********************\n\t\t\t Action Detection\n\t\t\t *********************/\n\n\t\t\t/* Velocity's behavior is categorized into \"actions\": Elements can either be specially scrolled into view,\n\t\t\t or they can be started, stopped, or reversed. If a literal or referenced properties map is passed in as Velocity's\n\t\t\t first argument, the associated action is \"start\". Alternatively, \"scroll\", \"reverse\", or \"stop\" can be passed in instead of a properties map. */\n\t\t\tvar action;\n\n\t\t\tswitch (propertiesMap) {\n\t\t\t\tcase \"scroll\":\n\t\t\t\t\taction = \"scroll\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"reverse\":\n\t\t\t\t\taction = \"reverse\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"finish\":\n\t\t\t\tcase \"finishAll\":\n\t\t\t\tcase \"stop\":\n\t\t\t\t\t/*******************\n\t\t\t\t\t Action: Stop\n\t\t\t\t\t *******************/\n\n\t\t\t\t\t/* Clear the currently-active delay on each targeted element. */\n\t\t\t\t\t$.each(elements, function(i, element) {\n\t\t\t\t\t\tif (Data(element) && Data(element).delayTimer) {\n\t\t\t\t\t\t\t/* Stop the timer from triggering its cached next() function. */\n\t\t\t\t\t\t\tclearTimeout(Data(element).delayTimer.setTimeout);\n\n\t\t\t\t\t\t\t/* Manually call the next() function so that the subsequent queue items can progress. */\n\t\t\t\t\t\t\tif (Data(element).delayTimer.next) {\n\t\t\t\t\t\t\t\tData(element).delayTimer.next();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdelete Data(element).delayTimer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* If we want to finish everything in the queue, we have to iterate through it\n\t\t\t\t\t\t and call each function. This will make them active calls below, which will\n\t\t\t\t\t\t cause them to be applied via the duration setting. */\n\t\t\t\t\t\tif (propertiesMap === \"finishAll\" && (options === true || Type.isString(options))) {\n\t\t\t\t\t\t\t/* Iterate through the items in the element's queue. */\n\t\t\t\t\t\t\t$.each($.queue(element, Type.isString(options) ? options : \"\"), function(_, item) {\n\t\t\t\t\t\t\t\t/* The queue array can contain an \"inprogress\" string, which we skip. */\n\t\t\t\t\t\t\t\tif (Type.isFunction(item)) {\n\t\t\t\t\t\t\t\t\titem();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t/* Clearing the $.queue() array is achieved by resetting it to []. */\n\t\t\t\t\t\t\t$.queue(element, Type.isString(options) ? options : \"\", []);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tvar callsToStop = [];\n\n\t\t\t\t\t/* When the stop action is triggered, the elements' currently active call is immediately stopped. The active call might have\n\t\t\t\t\t been applied to multiple elements, in which case all of the call's elements will be stopped. When an element\n\t\t\t\t\t is stopped, the next item in its animation queue is immediately triggered. */\n\t\t\t\t\t/* An additional argument may be passed in to clear an element's remaining queued calls. Either true (which defaults to the \"fx\" queue)\n\t\t\t\t\t or a custom queue string can be passed in. */\n\t\t\t\t\t/* Note: The stop command runs prior to Velocity's Queueing phase since its behavior is intended to take effect *immediately*,\n\t\t\t\t\t regardless of the element's current queue state. */\n\n\t\t\t\t\t/* Iterate through every active call. */\n\t\t\t\t\t$.each(Velocity.State.calls, function(i, activeCall) {\n\t\t\t\t\t\t/* Inactive calls are set to false by the logic inside completeCall(). Skip them. */\n\t\t\t\t\t\tif (activeCall) {\n\t\t\t\t\t\t\t/* Iterate through the active call's targeted elements. */\n\t\t\t\t\t\t\t$.each(activeCall[1], function(k, activeElement) {\n\t\t\t\t\t\t\t\t/* If true was passed in as a secondary argument, clear absolutely all calls on this element. Otherwise, only\n\t\t\t\t\t\t\t\t clear calls associated with the relevant queue. */\n\t\t\t\t\t\t\t\t/* Call stopping logic works as follows:\n\t\t\t\t\t\t\t\t - options === true --> stop current default queue calls (and queue:false calls), including remaining queued ones.\n\t\t\t\t\t\t\t\t - options === undefined --> stop current queue:\"\" call and all queue:false calls.\n\t\t\t\t\t\t\t\t - options === false --> stop only queue:false calls.\n\t\t\t\t\t\t\t\t - options === \"custom\" --> stop current queue:\"custom\" call, including remaining queued ones (there is no functionality to only clear the currently-running queue:\"custom\" call). */\n\t\t\t\t\t\t\t\tvar queueName = (options === undefined) ? \"\" : options;\n\n\t\t\t\t\t\t\t\tif (queueName !== true && (activeCall[2].queue !== queueName) && !(options === undefined && activeCall[2].queue === false)) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/* Iterate through the calls targeted by the stop command. */\n\t\t\t\t\t\t\t\t$.each(elements, function(l, element) {\n\t\t\t\t\t\t\t\t\t/* Check that this call was applied to the target element. */\n\t\t\t\t\t\t\t\t\tif (element === activeElement) {\n\t\t\t\t\t\t\t\t\t\t/* Optionally clear the remaining queued calls. If we're doing \"finishAll\" this won't find anything,\n\t\t\t\t\t\t\t\t\t\t due to the queue-clearing above. */\n\t\t\t\t\t\t\t\t\t\tif (options === true || Type.isString(options)) {\n\t\t\t\t\t\t\t\t\t\t\t/* Iterate through the items in the element's queue. */\n\t\t\t\t\t\t\t\t\t\t\t$.each($.queue(element, Type.isString(options) ? options : \"\"), function(_, item) {\n\t\t\t\t\t\t\t\t\t\t\t\t/* The queue array can contain an \"inprogress\" string, which we skip. */\n\t\t\t\t\t\t\t\t\t\t\t\tif (Type.isFunction(item)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t/* Pass the item's callback a flag indicating that we want to abort from the queue call.\n\t\t\t\t\t\t\t\t\t\t\t\t\t (Specifically, the queue will resolve the call's associated promise then abort.)  */\n\t\t\t\t\t\t\t\t\t\t\t\t\titem(null, true);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t/* Clearing the $.queue() array is achieved by resetting it to []. */\n\t\t\t\t\t\t\t\t\t\t\t$.queue(element, Type.isString(options) ? options : \"\", []);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (propertiesMap === \"stop\") {\n\t\t\t\t\t\t\t\t\t\t\t/* Since \"reverse\" uses cached start values (the previous call's endValues), these values must be\n\t\t\t\t\t\t\t\t\t\t\t changed to reflect the final value that the elements were actually tweened to. */\n\t\t\t\t\t\t\t\t\t\t\t/* Note: If only queue:false animations are currently running on an element, it won't have a tweensContainer\n\t\t\t\t\t\t\t\t\t\t\t object. Also, queue:false animations can't be reversed. */\n\t\t\t\t\t\t\t\t\t\t\tvar data = Data(element);\n\t\t\t\t\t\t\t\t\t\t\tif (data && data.tweensContainer && queueName !== false) {\n\t\t\t\t\t\t\t\t\t\t\t\t$.each(data.tweensContainer, function(m, activeTween) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tactiveTween.endValue = activeTween.currentValue;\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tcallsToStop.push(i);\n\t\t\t\t\t\t\t\t\t\t} else if (propertiesMap === \"finish\" || propertiesMap === \"finishAll\") {\n\t\t\t\t\t\t\t\t\t\t\t/* To get active tweens to finish immediately, we forcefully shorten their durations to 1ms so that\n\t\t\t\t\t\t\t\t\t\t\t they finish upon the next rAf tick then proceed with normal call completion logic. */\n\t\t\t\t\t\t\t\t\t\t\tactiveCall[2].duration = 1;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t/* Prematurely call completeCall() on each matched active call. Pass an additional flag for \"stop\" to indicate\n\t\t\t\t\t that the complete callback and display:none setting should be skipped since we're completing prematurely. */\n\t\t\t\t\tif (propertiesMap === \"stop\") {\n\t\t\t\t\t\t$.each(callsToStop, function(i, j) {\n\t\t\t\t\t\t\tcompleteCall(j, true);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (promiseData.promise) {\n\t\t\t\t\t\t\t/* Immediately resolve the promise associated with this stop call since stop runs synchronously. */\n\t\t\t\t\t\t\tpromiseData.resolver(elements);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Since we're stopping, and not proceeding with queueing, exit out of Velocity. */\n\t\t\t\t\treturn getChain();\n\n\t\t\t\tdefault:\n\t\t\t\t\t/* Treat a non-empty plain object as a literal properties map. */\n\t\t\t\t\tif ($.isPlainObject(propertiesMap) && !Type.isEmptyObject(propertiesMap)) {\n\t\t\t\t\t\taction = \"start\";\n\n\t\t\t\t\t\t/****************\n\t\t\t\t\t\t Redirects\n\t\t\t\t\t\t ****************/\n\n\t\t\t\t\t\t/* Check if a string matches a registered redirect (see Redirects above). */\n\t\t\t\t\t} else if (Type.isString(propertiesMap) && Velocity.Redirects[propertiesMap]) {\n\t\t\t\t\t\topts = $.extend({}, options);\n\n\t\t\t\t\t\tvar durationOriginal = opts.duration,\n\t\t\t\t\t\t\t\tdelayOriginal = opts.delay || 0;\n\n\t\t\t\t\t\t/* If the backwards option was passed in, reverse the element set so that elements animate from the last to the first. */\n\t\t\t\t\t\tif (opts.backwards === true) {\n\t\t\t\t\t\t\telements = $.extend(true, [], elements).reverse();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Individually trigger the redirect for each element in the set to prevent users from having to handle iteration logic in their redirect. */\n\t\t\t\t\t\t$.each(elements, function(elementIndex, element) {\n\t\t\t\t\t\t\t/* If the stagger option was passed in, successively delay each element by the stagger value (in ms). Retain the original delay value. */\n\t\t\t\t\t\t\tif (parseFloat(opts.stagger)) {\n\t\t\t\t\t\t\t\topts.delay = delayOriginal + (parseFloat(opts.stagger) * elementIndex);\n\t\t\t\t\t\t\t} else if (Type.isFunction(opts.stagger)) {\n\t\t\t\t\t\t\t\topts.delay = delayOriginal + opts.stagger.call(element, elementIndex, elementsLength);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* If the drag option was passed in, successively increase/decrease (depending on the presense of opts.backwards)\n\t\t\t\t\t\t\t the duration of each element's animation, using floors to prevent producing very short durations. */\n\t\t\t\t\t\t\tif (opts.drag) {\n\t\t\t\t\t\t\t\t/* Default the duration of UI pack effects (callouts and transitions) to 1000ms instead of the usual default duration of 400ms. */\n\t\t\t\t\t\t\t\topts.duration = parseFloat(durationOriginal) || (/^(callout|transition)/.test(propertiesMap) ? 1000 : DURATION_DEFAULT);\n\n\t\t\t\t\t\t\t\t/* For each element, take the greater duration of: A) animation completion percentage relative to the original duration,\n\t\t\t\t\t\t\t\t B) 75% of the original duration, or C) a 200ms fallback (in case duration is already set to a low value).\n\t\t\t\t\t\t\t\t The end result is a baseline of 75% of the redirect's duration that increases/decreases as the end of the element set is approached. */\n\t\t\t\t\t\t\t\topts.duration = Math.max(opts.duration * (opts.backwards ? 1 - elementIndex / elementsLength : (elementIndex + 1) / elementsLength), opts.duration * 0.75, 200);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Pass in the call's opts object so that the redirect can optionally extend it. It defaults to an empty object instead of null to\n\t\t\t\t\t\t\t reduce the opts checking logic required inside the redirect. */\n\t\t\t\t\t\t\tVelocity.Redirects[propertiesMap].call(element, element, opts || {}, elementIndex, elementsLength, elements, promiseData.promise ? promiseData : undefined);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t/* Since the animation logic resides within the redirect's own code, abort the remainder of this call.\n\t\t\t\t\t\t (The performance overhead up to this point is virtually non-existant.) */\n\t\t\t\t\t\t/* Note: The jQuery call chain is kept intact by returning the complete element set. */\n\t\t\t\t\t\treturn getChain();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar abortError = \"Velocity: First argument (\" + propertiesMap + \") was not a property map, a known action, or a registered redirect. Aborting.\";\n\n\t\t\t\t\t\tif (promiseData.promise) {\n\t\t\t\t\t\t\tpromiseData.rejecter(new Error(abortError));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(abortError);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn getChain();\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**************************\n\t\t\t Call-Wide Variables\n\t\t\t **************************/\n\n\t\t\t/* A container for CSS unit conversion ratios (e.g. %, rem, and em ==> px) that is used to cache ratios across all elements\n\t\t\t being animated in a single Velocity call. Calculating unit ratios necessitates DOM querying and updating, and is therefore\n\t\t\t avoided (via caching) wherever possible. This container is call-wide instead of page-wide to avoid the risk of using stale\n\t\t\t conversion metrics across Velocity animations that are not immediately consecutively chained. */\n\t\t\tvar callUnitConversionData = {\n\t\t\t\tlastParent: null,\n\t\t\t\tlastPosition: null,\n\t\t\t\tlastFontSize: null,\n\t\t\t\tlastPercentToPxWidth: null,\n\t\t\t\tlastPercentToPxHeight: null,\n\t\t\t\tlastEmToPx: null,\n\t\t\t\tremToPx: null,\n\t\t\t\tvwToPx: null,\n\t\t\t\tvhToPx: null\n\t\t\t};\n\n\t\t\t/* A container for all the ensuing tween data and metadata associated with this call. This container gets pushed to the page-wide\n\t\t\t Velocity.State.calls array that is processed during animation ticking. */\n\t\t\tvar call = [];\n\n\t\t\t/************************\n\t\t\t Element Processing\n\t\t\t ************************/\n\n\t\t\t/* Element processing consists of three parts -- data processing that cannot go stale and data processing that *can* go stale (i.e. third-party style modifications):\n\t\t\t 1) Pre-Queueing: Element-wide variables, including the element's data storage, are instantiated. Call options are prepared. If triggered, the Stop action is executed.\n\t\t\t 2) Queueing: The logic that runs once this call has reached its point of execution in the element's $.queue() stack. Most logic is placed here to avoid risking it becoming stale.\n\t\t\t 3) Pushing: Consolidation of the tween data followed by its push onto the global in-progress calls container.\n\t\t\t `elementArrayIndex` allows passing index of the element in the original array to value functions.\n\t\t\t If `elementsIndex` were used instead the index would be determined by the elements' per-element queue.\n\t\t\t */\n\t\t\tfunction processElement(element, elementArrayIndex) {\n\n\t\t\t\t/*************************\n\t\t\t\t Part I: Pre-Queueing\n\t\t\t\t *************************/\n\n\t\t\t\t/***************************\n\t\t\t\t Element-Wide Variables\n\t\t\t\t ***************************/\n\n\t\t\t\tvar /* The runtime opts object is the extension of the current call's options and Velocity's page-wide option defaults. */\n\t\t\t\t\t\topts = $.extend({}, Velocity.defaults, options),\n\t\t\t\t\t\t/* A container for the processed data associated with each property in the propertyMap.\n\t\t\t\t\t\t (Each property in the map produces its own \"tween\".) */\n\t\t\t\t\t\ttweensContainer = {},\n\t\t\t\t\t\telementUnitConversionData;\n\n\t\t\t\t/******************\n\t\t\t\t Element Init\n\t\t\t\t ******************/\n\n\t\t\t\tif (Data(element) === undefined) {\n\t\t\t\t\tVelocity.init(element);\n\t\t\t\t}\n\n\t\t\t\t/******************\n\t\t\t\t Option: Delay\n\t\t\t\t ******************/\n\n\t\t\t\t/* Since queue:false doesn't respect the item's existing queue, we avoid injecting its delay here (it's set later on). */\n\t\t\t\t/* Note: Velocity rolls its own delay function since jQuery doesn't have a utility alias for $.fn.delay()\n\t\t\t\t (and thus requires jQuery element creation, which we avoid since its overhead includes DOM querying). */\n\t\t\t\tif (parseFloat(opts.delay) && opts.queue !== false) {\n\t\t\t\t\t$.queue(element, opts.queue, function(next) {\n\t\t\t\t\t\t/* This is a flag used to indicate to the upcoming completeCall() function that this queue entry was initiated by Velocity. See completeCall() for further details. */\n\t\t\t\t\t\tVelocity.velocityQueueEntryFlag = true;\n\n\t\t\t\t\t\t/* The ensuing queue item (which is assigned to the \"next\" argument that $.queue() automatically passes in) will be triggered after a setTimeout delay.\n\t\t\t\t\t\t The setTimeout is stored so that it can be subjected to clearTimeout() if this animation is prematurely stopped via Velocity's \"stop\" command. */\n\t\t\t\t\t\tData(element).delayTimer = {\n\t\t\t\t\t\t\tsetTimeout: setTimeout(next, parseFloat(opts.delay)),\n\t\t\t\t\t\t\tnext: next\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*********************\n\t\t\t\t Option: Duration\n\t\t\t\t *********************/\n\n\t\t\t\t/* Support for jQuery's named durations. */\n\t\t\t\tswitch (opts.duration.toString().toLowerCase()) {\n\t\t\t\t\tcase \"fast\":\n\t\t\t\t\t\topts.duration = 200;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"normal\":\n\t\t\t\t\t\topts.duration = DURATION_DEFAULT;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"slow\":\n\t\t\t\t\t\topts.duration = 600;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t/* Remove the potential \"ms\" suffix and default to 1 if the user is attempting to set a duration of 0 (in order to produce an immediate style change). */\n\t\t\t\t\t\topts.duration = parseFloat(opts.duration) || 1;\n\t\t\t\t}\n\n\t\t\t\t/************************\n\t\t\t\t Global Option: Mock\n\t\t\t\t ************************/\n\n\t\t\t\tif (Velocity.mock !== false) {\n\t\t\t\t\t/* In mock mode, all animations are forced to 1ms so that they occur immediately upon the next rAF tick.\n\t\t\t\t\t Alternatively, a multiplier can be passed in to time remap all delays and durations. */\n\t\t\t\t\tif (Velocity.mock === true) {\n\t\t\t\t\t\topts.duration = opts.delay = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\topts.duration *= parseFloat(Velocity.mock) || 1;\n\t\t\t\t\t\topts.delay *= parseFloat(Velocity.mock) || 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*******************\n\t\t\t\t Option: Easing\n\t\t\t\t *******************/\n\n\t\t\t\topts.easing = getEasing(opts.easing, opts.duration);\n\n\t\t\t\t/**********************\n\t\t\t\t Option: Callbacks\n\t\t\t\t **********************/\n\n\t\t\t\t/* Callbacks must functions. Otherwise, default to null. */\n\t\t\t\tif (opts.begin && !Type.isFunction(opts.begin)) {\n\t\t\t\t\topts.begin = null;\n\t\t\t\t}\n\n\t\t\t\tif (opts.progress && !Type.isFunction(opts.progress)) {\n\t\t\t\t\topts.progress = null;\n\t\t\t\t}\n\n\t\t\t\tif (opts.complete && !Type.isFunction(opts.complete)) {\n\t\t\t\t\topts.complete = null;\n\t\t\t\t}\n\n\t\t\t\t/*********************************\n\t\t\t\t Option: Display & Visibility\n\t\t\t\t *********************************/\n\n\t\t\t\t/* Refer to Velocity's documentation (VelocityJS.org/#displayAndVisibility) for a description of the display and visibility options' behavior. */\n\t\t\t\t/* Note: We strictly check for undefined instead of falsiness because display accepts an empty string value. */\n\t\t\t\tif (opts.display !== undefined && opts.display !== null) {\n\t\t\t\t\topts.display = opts.display.toString().toLowerCase();\n\n\t\t\t\t\t/* Users can pass in a special \"auto\" value to instruct Velocity to set the element to its default display value. */\n\t\t\t\t\tif (opts.display === \"auto\") {\n\t\t\t\t\t\topts.display = Velocity.CSS.Values.getDisplayType(element);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (opts.visibility !== undefined && opts.visibility !== null) {\n\t\t\t\t\topts.visibility = opts.visibility.toString().toLowerCase();\n\t\t\t\t}\n\n\t\t\t\t/**********************\n\t\t\t\t Option: mobileHA\n\t\t\t\t **********************/\n\n\t\t\t\t/* When set to true, and if this is a mobile device, mobileHA automatically enables hardware acceleration (via a null transform hack)\n\t\t\t\t on animating elements. HA is removed from the element at the completion of its animation. */\n\t\t\t\t/* Note: Android Gingerbread doesn't support HA. If a null transform hack (mobileHA) is in fact set, it will prevent other tranform subproperties from taking effect. */\n\t\t\t\t/* Note: You can read more about the use of mobileHA in Velocity's documentation: VelocityJS.org/#mobileHA. */\n\t\t\t\topts.mobileHA = (opts.mobileHA && Velocity.State.isMobile && !Velocity.State.isGingerbread);\n\n\t\t\t\t/***********************\n\t\t\t\t Part II: Queueing\n\t\t\t\t ***********************/\n\n\t\t\t\t/* When a set of elements is targeted by a Velocity call, the set is broken up and each element has the current Velocity call individually queued onto it.\n\t\t\t\t In this way, each element's existing queue is respected; some elements may already be animating and accordingly should not have this current Velocity call triggered immediately. */\n\t\t\t\t/* In each queue, tween data is processed for each animating property then pushed onto the call-wide calls array. When the last element in the set has had its tweens processed,\n\t\t\t\t the call array is pushed to Velocity.State.calls for live processing by the requestAnimationFrame tick. */\n\t\t\t\tfunction buildQueue(next) {\n\t\t\t\t\tvar data, lastTweensContainer;\n\n\t\t\t\t\t/*******************\n\t\t\t\t\t Option: Begin\n\t\t\t\t\t *******************/\n\n\t\t\t\t\t/* The begin callback is fired once per call -- not once per elemenet -- and is passed the full raw DOM element set as both its context and its first argument. */\n\t\t\t\t\tif (opts.begin && elementsIndex === 0) {\n\t\t\t\t\t\t/* We throw callbacks in a setTimeout so that thrown errors don't halt the execution of Velocity itself. */\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\topts.begin.call(elements, elements);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/*****************************************\n\t\t\t\t\t Tween Data Construction (for Scroll)\n\t\t\t\t\t *****************************************/\n\n\t\t\t\t\t/* Note: In order to be subjected to chaining and animation options, scroll's tweening is routed through Velocity as if it were a standard CSS property animation. */\n\t\t\t\t\tif (action === \"scroll\") {\n\t\t\t\t\t\t/* The scroll action uniquely takes an optional \"offset\" option -- specified in pixels -- that offsets the targeted scroll position. */\n\t\t\t\t\t\tvar scrollDirection = (/^x$/i.test(opts.axis) ? \"Left\" : \"Top\"),\n\t\t\t\t\t\t\t\tscrollOffset = parseFloat(opts.offset) || 0,\n\t\t\t\t\t\t\t\tscrollPositionCurrent,\n\t\t\t\t\t\t\t\tscrollPositionCurrentAlternate,\n\t\t\t\t\t\t\t\tscrollPositionEnd;\n\n\t\t\t\t\t\t/* Scroll also uniquely takes an optional \"container\" option, which indicates the parent element that should be scrolled --\n\t\t\t\t\t\t as opposed to the browser window itself. This is useful for scrolling toward an element that's inside an overflowing parent element. */\n\t\t\t\t\t\tif (opts.container) {\n\t\t\t\t\t\t\t/* Ensure that either a jQuery object or a raw DOM element was passed in. */\n\t\t\t\t\t\t\tif (Type.isWrapped(opts.container) || Type.isNode(opts.container)) {\n\t\t\t\t\t\t\t\t/* Extract the raw DOM element from the jQuery wrapper. */\n\t\t\t\t\t\t\t\topts.container = opts.container[0] || opts.container;\n\t\t\t\t\t\t\t\t/* Note: Unlike other properties in Velocity, the browser's scroll position is never cached since it so frequently changes\n\t\t\t\t\t\t\t\t (due to the user's natural interaction with the page). */\n\t\t\t\t\t\t\t\tscrollPositionCurrent = opts.container[\"scroll\" + scrollDirection]; /* GET */\n\n\t\t\t\t\t\t\t\t/* $.position() values are relative to the container's currently viewable area (without taking into account the container's true dimensions\n\t\t\t\t\t\t\t\t -- say, for example, if the container was not overflowing). Thus, the scroll end value is the sum of the child element's position *and*\n\t\t\t\t\t\t\t\t the scroll container's current scroll position. */\n\t\t\t\t\t\t\t\tscrollPositionEnd = (scrollPositionCurrent + $(element).position()[scrollDirection.toLowerCase()]) + scrollOffset; /* GET */\n\t\t\t\t\t\t\t\t/* If a value other than a jQuery object or a raw DOM element was passed in, default to null so that this option is ignored. */\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topts.container = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t/* If the window itself is being scrolled -- not a containing element -- perform a live scroll position lookup using\n\t\t\t\t\t\t\t the appropriate cached property names (which differ based on browser type). */\n\t\t\t\t\t\t\tscrollPositionCurrent = Velocity.State.scrollAnchor[Velocity.State[\"scrollProperty\" + scrollDirection]]; /* GET */\n\t\t\t\t\t\t\t/* When scrolling the browser window, cache the alternate axis's current value since window.scrollTo() doesn't let us change only one value at a time. */\n\t\t\t\t\t\t\tscrollPositionCurrentAlternate = Velocity.State.scrollAnchor[Velocity.State[\"scrollProperty\" + (scrollDirection === \"Left\" ? \"Top\" : \"Left\")]]; /* GET */\n\n\t\t\t\t\t\t\t/* Unlike $.position(), $.offset() values are relative to the browser window's true dimensions -- not merely its currently viewable area --\n\t\t\t\t\t\t\t and therefore end values do not need to be compounded onto current values. */\n\t\t\t\t\t\t\tscrollPositionEnd = $(element).offset()[scrollDirection.toLowerCase()] + scrollOffset; /* GET */\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Since there's only one format that scroll's associated tweensContainer can take, we create it manually. */\n\t\t\t\t\t\ttweensContainer = {\n\t\t\t\t\t\t\tscroll: {\n\t\t\t\t\t\t\t\trootPropertyValue: false,\n\t\t\t\t\t\t\t\tstartValue: scrollPositionCurrent,\n\t\t\t\t\t\t\t\tcurrentValue: scrollPositionCurrent,\n\t\t\t\t\t\t\t\tendValue: scrollPositionEnd,\n\t\t\t\t\t\t\t\tunitType: \"\",\n\t\t\t\t\t\t\t\teasing: opts.easing,\n\t\t\t\t\t\t\t\tscrollData: {\n\t\t\t\t\t\t\t\t\tcontainer: opts.container,\n\t\t\t\t\t\t\t\t\tdirection: scrollDirection,\n\t\t\t\t\t\t\t\t\talternateValue: scrollPositionCurrentAlternate\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\telement: element\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (Velocity.debug) {\n\t\t\t\t\t\t\tconsole.log(\"tweensContainer (scroll): \", tweensContainer.scroll, element);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/******************************************\n\t\t\t\t\t\t Tween Data Construction (for Reverse)\n\t\t\t\t\t\t ******************************************/\n\n\t\t\t\t\t\t/* Reverse acts like a \"start\" action in that a property map is animated toward. The only difference is\n\t\t\t\t\t\t that the property map used for reverse is the inverse of the map used in the previous call. Thus, we manipulate\n\t\t\t\t\t\t the previous call to construct our new map: use the previous map's end values as our new map's start values. Copy over all other data. */\n\t\t\t\t\t\t/* Note: Reverse can be directly called via the \"reverse\" parameter, or it can be indirectly triggered via the loop option. (Loops are composed of multiple reverses.) */\n\t\t\t\t\t\t/* Note: Reverse calls do not need to be consecutively chained onto a currently-animating element in order to operate on cached values;\n\t\t\t\t\t\t there is no harm to reverse being called on a potentially stale data cache since reverse's behavior is simply defined\n\t\t\t\t\t\t as reverting to the element's values as they were prior to the previous *Velocity* call. */\n\t\t\t\t\t} else if (action === \"reverse\") {\n\t\t\t\t\t\tdata = Data(element);\n\n\t\t\t\t\t\t/* Abort if there is no prior animation data to reverse to. */\n\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!data.tweensContainer) {\n\t\t\t\t\t\t\t/* Dequeue the element so that this queue entry releases itself immediately, allowing subsequent queue entries to run. */\n\t\t\t\t\t\t\t$.dequeue(element, opts.queue);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t/*********************\n\t\t\t\t\t\t\t Options Parsing\n\t\t\t\t\t\t\t *********************/\n\n\t\t\t\t\t\t\t/* If the element was hidden via the display option in the previous call,\n\t\t\t\t\t\t\t revert display to \"auto\" prior to reversal so that the element is visible again. */\n\t\t\t\t\t\t\tif (data.opts.display === \"none\") {\n\t\t\t\t\t\t\t\tdata.opts.display = \"auto\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.opts.visibility === \"hidden\") {\n\t\t\t\t\t\t\t\tdata.opts.visibility = \"visible\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* If the loop option was set in the previous call, disable it so that \"reverse\" calls aren't recursively generated.\n\t\t\t\t\t\t\t Further, remove the previous call's callback options; typically, users do not want these to be refired. */\n\t\t\t\t\t\t\tdata.opts.loop = false;\n\t\t\t\t\t\t\tdata.opts.begin = null;\n\t\t\t\t\t\t\tdata.opts.complete = null;\n\n\t\t\t\t\t\t\t/* Since we're extending an opts object that has already been extended with the defaults options object,\n\t\t\t\t\t\t\t we remove non-explicitly-defined properties that are auto-assigned values. */\n\t\t\t\t\t\t\tif (!options.easing) {\n\t\t\t\t\t\t\t\tdelete opts.easing;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!options.duration) {\n\t\t\t\t\t\t\t\tdelete opts.duration;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* The opts object used for reversal is an extension of the options object optionally passed into this\n\t\t\t\t\t\t\t reverse call plus the options used in the previous Velocity call. */\n\t\t\t\t\t\t\topts = $.extend({}, data.opts, opts);\n\n\t\t\t\t\t\t\t/*************************************\n\t\t\t\t\t\t\t Tweens Container Reconstruction\n\t\t\t\t\t\t\t *************************************/\n\n\t\t\t\t\t\t\t/* Create a deepy copy (indicated via the true flag) of the previous call's tweensContainer. */\n\t\t\t\t\t\t\tlastTweensContainer = $.extend(true, {}, data ? data.tweensContainer : null);\n\n\t\t\t\t\t\t\t/* Manipulate the previous tweensContainer by replacing its end values and currentValues with its start values. */\n\t\t\t\t\t\t\tfor (var lastTween in lastTweensContainer) {\n\t\t\t\t\t\t\t\t/* In addition to tween data, tweensContainers contain an element property that we ignore here. */\n\t\t\t\t\t\t\t\tif (lastTweensContainer.hasOwnProperty(lastTween) && lastTween !== \"element\") {\n\t\t\t\t\t\t\t\t\tvar lastStartValue = lastTweensContainer[lastTween].startValue;\n\n\t\t\t\t\t\t\t\t\tlastTweensContainer[lastTween].startValue = lastTweensContainer[lastTween].currentValue = lastTweensContainer[lastTween].endValue;\n\t\t\t\t\t\t\t\t\tlastTweensContainer[lastTween].endValue = lastStartValue;\n\n\t\t\t\t\t\t\t\t\t/* Easing is the only option that embeds into the individual tween data (since it can be defined on a per-property basis).\n\t\t\t\t\t\t\t\t\t Accordingly, every property's easing value must be updated when an options object is passed in with a reverse call.\n\t\t\t\t\t\t\t\t\t The side effect of this extensibility is that all per-property easing values are forcefully reset to the new value. */\n\t\t\t\t\t\t\t\t\tif (!Type.isEmptyObject(options)) {\n\t\t\t\t\t\t\t\t\t\tlastTweensContainer[lastTween].easing = opts.easing;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (Velocity.debug) {\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"reverse tweensContainer (\" + lastTween + \"): \" + JSON.stringify(lastTweensContainer[lastTween]), element);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttweensContainer = lastTweensContainer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/*****************************************\n\t\t\t\t\t\t Tween Data Construction (for Start)\n\t\t\t\t\t\t *****************************************/\n\n\t\t\t\t\t} else if (action === \"start\") {\n\n\t\t\t\t\t\t/*************************\n\t\t\t\t\t\t Value Transferring\n\t\t\t\t\t\t *************************/\n\n\t\t\t\t\t\t/* If this queue entry follows a previous Velocity-initiated queue entry *and* if this entry was created\n\t\t\t\t\t\t while the element was in the process of being animated by Velocity, then this current call is safe to use\n\t\t\t\t\t\t the end values from the prior call as its start values. Velocity attempts to perform this value transfer\n\t\t\t\t\t\t process whenever possible in order to avoid requerying the DOM. */\n\t\t\t\t\t\t/* If values aren't transferred from a prior call and start values were not forcefed by the user (more on this below),\n\t\t\t\t\t\t then the DOM is queried for the element's current values as a last resort. */\n\t\t\t\t\t\t/* Note: Conversely, animation reversal (and looping) *always* perform inter-call value transfers; they never requery the DOM. */\n\n\t\t\t\t\t\tdata = Data(element);\n\n\t\t\t\t\t\t/* The per-element isAnimating flag is used to indicate whether it's safe (i.e. the data isn't stale)\n\t\t\t\t\t\t to transfer over end values to use as start values. If it's set to true and there is a previous\n\t\t\t\t\t\t Velocity call to pull values from, do so. */\n\t\t\t\t\t\tif (data && data.tweensContainer && data.isAnimating === true) {\n\t\t\t\t\t\t\tlastTweensContainer = data.tweensContainer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/***************************\n\t\t\t\t\t\t Tween Data Calculation\n\t\t\t\t\t\t ***************************/\n\n\t\t\t\t\t\t/* This function parses property data and defaults endValue, easing, and startValue as appropriate. */\n\t\t\t\t\t\t/* Property map values can either take the form of 1) a single value representing the end value,\n\t\t\t\t\t\t or 2) an array in the form of [ endValue, [, easing] [, startValue] ].\n\t\t\t\t\t\t The optional third parameter is a forcefed startValue to be used instead of querying the DOM for\n\t\t\t\t\t\t the element's current value. Read Velocity's docmentation to learn more about forcefeeding: VelocityJS.org/#forcefeeding */\n\t\t\t\t\t\tvar parsePropertyValue = function(valueData, skipResolvingEasing) {\n\t\t\t\t\t\t\tvar endValue, easing, startValue;\n\n\t\t\t\t\t\t\t/* Handle the array format, which can be structured as one of three potential overloads:\n\t\t\t\t\t\t\t A) [ endValue, easing, startValue ], B) [ endValue, easing ], or C) [ endValue, startValue ] */\n\t\t\t\t\t\t\tif (Type.isArray(valueData)) {\n\t\t\t\t\t\t\t\t/* endValue is always the first item in the array. Don't bother validating endValue's value now\n\t\t\t\t\t\t\t\t since the ensuing property cycling logic does that. */\n\t\t\t\t\t\t\t\tendValue = valueData[0];\n\n\t\t\t\t\t\t\t\t/* Two-item array format: If the second item is a number, function, or hex string, treat it as a\n\t\t\t\t\t\t\t\t start value since easings can only be non-hex strings or arrays. */\n\t\t\t\t\t\t\t\tif ((!Type.isArray(valueData[1]) && /^[\\d-]/.test(valueData[1])) || Type.isFunction(valueData[1]) || CSS.RegEx.isHex.test(valueData[1])) {\n\t\t\t\t\t\t\t\t\tstartValue = valueData[1];\n\t\t\t\t\t\t\t\t\t/* Two or three-item array: If the second item is a non-hex string or an array, treat it as an easing. */\n\t\t\t\t\t\t\t\t} else if ((Type.isString(valueData[1]) && !CSS.RegEx.isHex.test(valueData[1])) || Type.isArray(valueData[1])) {\n\t\t\t\t\t\t\t\t\teasing = skipResolvingEasing ? valueData[1] : getEasing(valueData[1], opts.duration);\n\n\t\t\t\t\t\t\t\t\t/* Don't bother validating startValue's value now since the ensuing property cycling logic inherently does that. */\n\t\t\t\t\t\t\t\t\tif (valueData[2] !== undefined) {\n\t\t\t\t\t\t\t\t\t\tstartValue = valueData[2];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/* Handle the single-value format. */\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tendValue = valueData;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Default to the call's easing if a per-property easing type was not defined. */\n\t\t\t\t\t\t\tif (!skipResolvingEasing) {\n\t\t\t\t\t\t\t\teasing = easing || opts.easing;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* If functions were passed in as values, pass the function the current element as its context,\n\t\t\t\t\t\t\t plus the element's index and the element set's size as arguments. Then, assign the returned value. */\n\t\t\t\t\t\t\tif (Type.isFunction(endValue)) {\n\t\t\t\t\t\t\t\tendValue = endValue.call(element, elementArrayIndex, elementsLength);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (Type.isFunction(startValue)) {\n\t\t\t\t\t\t\t\tstartValue = startValue.call(element, elementArrayIndex, elementsLength);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Allow startValue to be left as undefined to indicate to the ensuing code that its value was not forcefed. */\n\t\t\t\t\t\t\treturn [endValue || 0, easing, startValue];\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t/* Cycle through each property in the map, looking for shorthand color properties (e.g. \"color\" as opposed to \"colorRed\"). Inject the corresponding\n\t\t\t\t\t\t colorRed, colorGreen, and colorBlue RGB component tweens into the propertiesMap (which Velocity understands) and remove the shorthand property. */\n\t\t\t\t\t\t$.each(propertiesMap, function(property, value) {\n\t\t\t\t\t\t\t/* Find shorthand color properties that have been passed a hex string. */\n\t\t\t\t\t\t\tif (RegExp(\"^\" + CSS.Lists.colors.join(\"$|^\") + \"$\").test(CSS.Names.camelCase(property))) {\n\t\t\t\t\t\t\t\t/* Parse the value data for each shorthand. */\n\t\t\t\t\t\t\t\tvar valueData = parsePropertyValue(value, true),\n\t\t\t\t\t\t\t\t\t\tendValue = valueData[0],\n\t\t\t\t\t\t\t\t\t\teasing = valueData[1],\n\t\t\t\t\t\t\t\t\t\tstartValue = valueData[2];\n\n\t\t\t\t\t\t\t\tif (CSS.RegEx.isHex.test(endValue)) {\n\t\t\t\t\t\t\t\t\t/* Convert the hex strings into their RGB component arrays. */\n\t\t\t\t\t\t\t\t\tvar colorComponents = [\"Red\", \"Green\", \"Blue\"],\n\t\t\t\t\t\t\t\t\t\t\tendValueRGB = CSS.Values.hexToRgb(endValue),\n\t\t\t\t\t\t\t\t\t\t\tstartValueRGB = startValue ? CSS.Values.hexToRgb(startValue) : undefined;\n\n\t\t\t\t\t\t\t\t\t/* Inject the RGB component tweens into propertiesMap. */\n\t\t\t\t\t\t\t\t\tfor (var i = 0; i < colorComponents.length; i++) {\n\t\t\t\t\t\t\t\t\t\tvar dataArray = [endValueRGB[i]];\n\n\t\t\t\t\t\t\t\t\t\tif (easing) {\n\t\t\t\t\t\t\t\t\t\t\tdataArray.push(easing);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (startValueRGB !== undefined) {\n\t\t\t\t\t\t\t\t\t\t\tdataArray.push(startValueRGB[i]);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tpropertiesMap[CSS.Names.camelCase(property) + colorComponents[i]] = dataArray;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t/* Remove the intermediary shorthand property entry now that we've processed it. */\n\t\t\t\t\t\t\t\t\tdelete propertiesMap[property];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t/* Create a tween out of each property, and append its associated data to tweensContainer. */\n\t\t\t\t\t\tfor (var property in propertiesMap) {\n\n\t\t\t\t\t\t\tif (!propertiesMap.hasOwnProperty(property)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/**************************\n\t\t\t\t\t\t\t Start Value Sourcing\n\t\t\t\t\t\t\t **************************/\n\n\t\t\t\t\t\t\t/* Parse out endValue, easing, and startValue from the property's data. */\n\t\t\t\t\t\t\tvar valueData = parsePropertyValue(propertiesMap[property]),\n\t\t\t\t\t\t\t\t\tendValue = valueData[0],\n\t\t\t\t\t\t\t\t\teasing = valueData[1],\n\t\t\t\t\t\t\t\t\tstartValue = valueData[2];\n\n\t\t\t\t\t\t\t/* Now that the original property name's format has been used for the parsePropertyValue() lookup above,\n\t\t\t\t\t\t\t we force the property to its camelCase styling to normalize it for manipulation. */\n\t\t\t\t\t\t\tproperty = CSS.Names.camelCase(property);\n\n\t\t\t\t\t\t\t/* In case this property is a hook, there are circumstances where we will intend to work on the hook's root property and not the hooked subproperty. */\n\t\t\t\t\t\t\tvar rootProperty = CSS.Hooks.getRoot(property),\n\t\t\t\t\t\t\t\t\trootPropertyValue = false;\n\n\t\t\t\t\t\t\t/* Other than for the dummy tween property, properties that are not supported by the browser (and do not have an associated normalization) will\n\t\t\t\t\t\t\t inherently produce no style changes when set, so they are skipped in order to decrease animation tick overhead.\n\t\t\t\t\t\t\t Property support is determined via prefixCheck(), which returns a false flag when no supported is detected. */\n\t\t\t\t\t\t\t/* Note: Since SVG elements have some of their properties directly applied as HTML attributes,\n\t\t\t\t\t\t\t there is no way to check for their explicit browser support, and so we skip skip this check for them. */\n\t\t\t\t\t\t\tif ((!data || !data.isSVG) && rootProperty !== \"tween\" && CSS.Names.prefixCheck(rootProperty)[1] === false && CSS.Normalizations.registered[rootProperty] === undefined) {\n\t\t\t\t\t\t\t\tif (Velocity.debug) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"Skipping [\" + rootProperty + \"] due to a lack of browser support.\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* If the display option is being set to a non-\"none\" (e.g. \"block\") and opacity (filter on IE<=8) is being\n\t\t\t\t\t\t\t animated to an endValue of non-zero, the user's intention is to fade in from invisible, thus we forcefeed opacity\n\t\t\t\t\t\t\t a startValue of 0 if its startValue hasn't already been sourced by value transferring or prior forcefeeding. */\n\t\t\t\t\t\t\tif (((opts.display !== undefined && opts.display !== null && opts.display !== \"none\") || (opts.visibility !== undefined && opts.visibility !== \"hidden\")) && /opacity|filter/.test(property) && !startValue && endValue !== 0) {\n\t\t\t\t\t\t\t\tstartValue = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* If values have been transferred from the previous Velocity call, extract the endValue and rootPropertyValue\n\t\t\t\t\t\t\t for all of the current call's properties that were *also* animated in the previous call. */\n\t\t\t\t\t\t\t/* Note: Value transferring can optionally be disabled by the user via the _cacheValues option. */\n\t\t\t\t\t\t\tif (opts._cacheValues && lastTweensContainer && lastTweensContainer[property]) {\n\t\t\t\t\t\t\t\tif (startValue === undefined) {\n\t\t\t\t\t\t\t\t\tstartValue = lastTweensContainer[property].endValue + lastTweensContainer[property].unitType;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/* The previous call's rootPropertyValue is extracted from the element's data cache since that's the\n\t\t\t\t\t\t\t\t instance of rootPropertyValue that gets freshly updated by the tweening process, whereas the rootPropertyValue\n\t\t\t\t\t\t\t\t attached to the incoming lastTweensContainer is equal to the root property's value prior to any tweening. */\n\t\t\t\t\t\t\t\trootPropertyValue = data.rootPropertyValueCache[rootProperty];\n\t\t\t\t\t\t\t\t/* If values were not transferred from a previous Velocity call, query the DOM as needed. */\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t/* Handle hooked properties. */\n\t\t\t\t\t\t\t\tif (CSS.Hooks.registered[property]) {\n\t\t\t\t\t\t\t\t\tif (startValue === undefined) {\n\t\t\t\t\t\t\t\t\t\trootPropertyValue = CSS.getPropertyValue(element, rootProperty); /* GET */\n\t\t\t\t\t\t\t\t\t\t/* Note: The following getPropertyValue() call does not actually trigger a DOM query;\n\t\t\t\t\t\t\t\t\t\t getPropertyValue() will extract the hook from rootPropertyValue. */\n\t\t\t\t\t\t\t\t\t\tstartValue = CSS.getPropertyValue(element, property, rootPropertyValue);\n\t\t\t\t\t\t\t\t\t\t/* If startValue is already defined via forcefeeding, do not query the DOM for the root property's value;\n\t\t\t\t\t\t\t\t\t\t just grab rootProperty's zero-value template from CSS.Hooks. This overwrites the element's actual\n\t\t\t\t\t\t\t\t\t\t root property value (if one is set), but this is acceptable since the primary reason users forcefeed is\n\t\t\t\t\t\t\t\t\t\t to avoid DOM queries, and thus we likewise avoid querying the DOM for the root property's value. */\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t/* Grab this hook's zero-value template, e.g. \"0px 0px 0px black\". */\n\t\t\t\t\t\t\t\t\t\trootPropertyValue = CSS.Hooks.templates[rootProperty][1];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t/* Handle non-hooked properties that haven't already been defined via forcefeeding. */\n\t\t\t\t\t\t\t\t} else if (startValue === undefined) {\n\t\t\t\t\t\t\t\t\tstartValue = CSS.getPropertyValue(element, property); /* GET */\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/**************************\n\t\t\t\t\t\t\t Value Data Extraction\n\t\t\t\t\t\t\t **************************/\n\n\t\t\t\t\t\t\tvar separatedValue,\n\t\t\t\t\t\t\t\t\tendValueUnitType,\n\t\t\t\t\t\t\t\t\tstartValueUnitType,\n\t\t\t\t\t\t\t\t\toperator = false;\n\n\t\t\t\t\t\t\t/* Separates a property value into its numeric value and its unit type. */\n\t\t\t\t\t\t\tvar separateValue = function(property, value) {\n\t\t\t\t\t\t\t\tvar unitType,\n\t\t\t\t\t\t\t\t\t\tnumericValue;\n\n\t\t\t\t\t\t\t\tnumericValue = (value || \"0\")\n\t\t\t\t\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t/* Match the unit type at the end of the value. */\n\t\t\t\t\t\t\t\t\t\t.replace(/[%A-z]+$/, function(match) {\n\t\t\t\t\t\t\t\t\t\t\t/* Grab the unit type. */\n\t\t\t\t\t\t\t\t\t\t\tunitType = match;\n\n\t\t\t\t\t\t\t\t\t\t\t/* Strip the unit type off of value. */\n\t\t\t\t\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t/* If no unit type was supplied, assign one that is appropriate for this property (e.g. \"deg\" for rotateZ or \"px\" for width). */\n\t\t\t\t\t\t\t\tif (!unitType) {\n\t\t\t\t\t\t\t\t\tunitType = CSS.Values.getUnitType(property);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn [numericValue, unitType];\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t/* Separate startValue. */\n\t\t\t\t\t\t\tseparatedValue = separateValue(property, startValue);\n\t\t\t\t\t\t\tstartValue = separatedValue[0];\n\t\t\t\t\t\t\tstartValueUnitType = separatedValue[1];\n\n\t\t\t\t\t\t\t/* Separate endValue, and extract a value operator (e.g. \"+=\", \"-=\") if one exists. */\n\t\t\t\t\t\t\tseparatedValue = separateValue(property, endValue);\n\t\t\t\t\t\t\tendValue = separatedValue[0].replace(/^([+-\\/*])=/, function(match, subMatch) {\n\t\t\t\t\t\t\t\toperator = subMatch;\n\n\t\t\t\t\t\t\t\t/* Strip the operator off of the value. */\n\t\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tendValueUnitType = separatedValue[1];\n\n\t\t\t\t\t\t\t/* Parse float values from endValue and startValue. Default to 0 if NaN is returned. */\n\t\t\t\t\t\t\tstartValue = parseFloat(startValue) || 0;\n\t\t\t\t\t\t\tendValue = parseFloat(endValue) || 0;\n\n\t\t\t\t\t\t\t/***************************************\n\t\t\t\t\t\t\t Property-Specific Value Conversion\n\t\t\t\t\t\t\t ***************************************/\n\n\t\t\t\t\t\t\t/* Custom support for properties that don't actually accept the % unit type, but where pollyfilling is trivial and relatively foolproof. */\n\t\t\t\t\t\t\tif (endValueUnitType === \"%\") {\n\t\t\t\t\t\t\t\t/* A %-value fontSize/lineHeight is relative to the parent's fontSize (as opposed to the parent's dimensions),\n\t\t\t\t\t\t\t\t which is identical to the em unit's behavior, so we piggyback off of that. */\n\t\t\t\t\t\t\t\tif (/^(fontSize|lineHeight)$/.test(property)) {\n\t\t\t\t\t\t\t\t\t/* Convert % into an em decimal value. */\n\t\t\t\t\t\t\t\t\tendValue = endValue / 100;\n\t\t\t\t\t\t\t\t\tendValueUnitType = \"em\";\n\t\t\t\t\t\t\t\t\t/* For scaleX and scaleY, convert the value into its decimal format and strip off the unit type. */\n\t\t\t\t\t\t\t\t} else if (/^scale/.test(property)) {\n\t\t\t\t\t\t\t\t\tendValue = endValue / 100;\n\t\t\t\t\t\t\t\t\tendValueUnitType = \"\";\n\t\t\t\t\t\t\t\t\t/* For RGB components, take the defined percentage of 255 and strip off the unit type. */\n\t\t\t\t\t\t\t\t} else if (/(Red|Green|Blue)$/i.test(property)) {\n\t\t\t\t\t\t\t\t\tendValue = (endValue / 100) * 255;\n\t\t\t\t\t\t\t\t\tendValueUnitType = \"\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/***************************\n\t\t\t\t\t\t\t Unit Ratio Calculation\n\t\t\t\t\t\t\t ***************************/\n\n\t\t\t\t\t\t\t/* When queried, the browser returns (most) CSS property values in pixels. Therefore, if an endValue with a unit type of\n\t\t\t\t\t\t\t %, em, or rem is animated toward, startValue must be converted from pixels into the same unit type as endValue in order\n\t\t\t\t\t\t\t for value manipulation logic (increment/decrement) to proceed. Further, if the startValue was forcefed or transferred\n\t\t\t\t\t\t\t from a previous call, startValue may also not be in pixels. Unit conversion logic therefore consists of two steps:\n\t\t\t\t\t\t\t 1) Calculating the ratio of %/em/rem/vh/vw relative to pixels\n\t\t\t\t\t\t\t 2) Converting startValue into the same unit of measurement as endValue based on these ratios. */\n\t\t\t\t\t\t\t/* Unit conversion ratios are calculated by inserting a sibling node next to the target node, copying over its position property,\n\t\t\t\t\t\t\t setting values with the target unit type then comparing the returned pixel value. */\n\t\t\t\t\t\t\t/* Note: Even if only one of these unit types is being animated, all unit ratios are calculated at once since the overhead\n\t\t\t\t\t\t\t of batching the SETs and GETs together upfront outweights the potential overhead\n\t\t\t\t\t\t\t of layout thrashing caused by re-querying for uncalculated ratios for subsequently-processed properties. */\n\t\t\t\t\t\t\t/* Todo: Shift this logic into the calls' first tick instance so that it's synced with RAF. */\n\t\t\t\t\t\t\tvar calculateUnitRatios = function() {\n\n\t\t\t\t\t\t\t\t/************************\n\t\t\t\t\t\t\t\t Same Ratio Checks\n\t\t\t\t\t\t\t\t ************************/\n\n\t\t\t\t\t\t\t\t/* The properties below are used to determine whether the element differs sufficiently from this call's\n\t\t\t\t\t\t\t\t previously iterated element to also differ in its unit conversion ratios. If the properties match up with those\n\t\t\t\t\t\t\t\t of the prior element, the prior element's conversion ratios are used. Like most optimizations in Velocity,\n\t\t\t\t\t\t\t\t this is done to minimize DOM querying. */\n\t\t\t\t\t\t\t\tvar sameRatioIndicators = {\n\t\t\t\t\t\t\t\t\tmyParent: element.parentNode || document.body, /* GET */\n\t\t\t\t\t\t\t\t\tposition: CSS.getPropertyValue(element, \"position\"), /* GET */\n\t\t\t\t\t\t\t\t\tfontSize: CSS.getPropertyValue(element, \"fontSize\") /* GET */\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t/* Determine if the same % ratio can be used. % is based on the element's position value and its parent's width and height dimensions. */\n\t\t\t\t\t\t\t\tsamePercentRatio = ((sameRatioIndicators.position === callUnitConversionData.lastPosition) && (sameRatioIndicators.myParent === callUnitConversionData.lastParent)),\n\t\t\t\t\t\t\t\t\t\t/* Determine if the same em ratio can be used. em is relative to the element's fontSize. */\n\t\t\t\t\t\t\t\t\t\tsameEmRatio = (sameRatioIndicators.fontSize === callUnitConversionData.lastFontSize);\n\n\t\t\t\t\t\t\t\t/* Store these ratio indicators call-wide for the next element to compare against. */\n\t\t\t\t\t\t\t\tcallUnitConversionData.lastParent = sameRatioIndicators.myParent;\n\t\t\t\t\t\t\t\tcallUnitConversionData.lastPosition = sameRatioIndicators.position;\n\t\t\t\t\t\t\t\tcallUnitConversionData.lastFontSize = sameRatioIndicators.fontSize;\n\n\t\t\t\t\t\t\t\t/***************************\n\t\t\t\t\t\t\t\t Element-Specific Units\n\t\t\t\t\t\t\t\t ***************************/\n\n\t\t\t\t\t\t\t\t/* Note: IE8 rounds to the nearest pixel when returning CSS values, thus we perform conversions using a measurement\n\t\t\t\t\t\t\t\t of 100 (instead of 1) to give our ratios a precision of at least 2 decimal values. */\n\t\t\t\t\t\t\t\tvar measurement = 100,\n\t\t\t\t\t\t\t\t\t\tunitRatios = {};\n\n\t\t\t\t\t\t\t\tif (!sameEmRatio || !samePercentRatio) {\n\t\t\t\t\t\t\t\t\tvar dummy = data && data.isSVG ? document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\") : document.createElement(\"div\");\n\n\t\t\t\t\t\t\t\t\tVelocity.init(dummy);\n\t\t\t\t\t\t\t\t\tsameRatioIndicators.myParent.appendChild(dummy);\n\n\t\t\t\t\t\t\t\t\t/* To accurately and consistently calculate conversion ratios, the element's cascaded overflow and box-sizing are stripped.\n\t\t\t\t\t\t\t\t\t Similarly, since width/height can be artificially constrained by their min-/max- equivalents, these are controlled for as well. */\n\t\t\t\t\t\t\t\t\t/* Note: Overflow must be also be controlled for per-axis since the overflow property overwrites its per-axis values. */\n\t\t\t\t\t\t\t\t\t$.each([\"overflow\", \"overflowX\", \"overflowY\"], function(i, property) {\n\t\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, property, \"hidden\");\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, \"position\", sameRatioIndicators.position);\n\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, \"fontSize\", sameRatioIndicators.fontSize);\n\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, \"boxSizing\", \"content-box\");\n\n\t\t\t\t\t\t\t\t\t/* width and height act as our proxy properties for measuring the horizontal and vertical % ratios. */\n\t\t\t\t\t\t\t\t\t$.each([\"minWidth\", \"maxWidth\", \"width\", \"minHeight\", \"maxHeight\", \"height\"], function(i, property) {\n\t\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, property, measurement + \"%\");\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t/* paddingLeft arbitrarily acts as our proxy property for the em ratio. */\n\t\t\t\t\t\t\t\t\tVelocity.CSS.setPropertyValue(dummy, \"paddingLeft\", measurement + \"em\");\n\n\t\t\t\t\t\t\t\t\t/* Divide the returned value by the measurement to get the ratio between 1% and 1px. Default to 1 since working with 0 can produce Infinite. */\n\t\t\t\t\t\t\t\t\tunitRatios.percentToPxWidth = callUnitConversionData.lastPercentToPxWidth = (parseFloat(CSS.getPropertyValue(dummy, \"width\", null, true)) || 1) / measurement; /* GET */\n\t\t\t\t\t\t\t\t\tunitRatios.percentToPxHeight = callUnitConversionData.lastPercentToPxHeight = (parseFloat(CSS.getPropertyValue(dummy, \"height\", null, true)) || 1) / measurement; /* GET */\n\t\t\t\t\t\t\t\t\tunitRatios.emToPx = callUnitConversionData.lastEmToPx = (parseFloat(CSS.getPropertyValue(dummy, \"paddingLeft\")) || 1) / measurement; /* GET */\n\n\t\t\t\t\t\t\t\t\tsameRatioIndicators.myParent.removeChild(dummy);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tunitRatios.emToPx = callUnitConversionData.lastEmToPx;\n\t\t\t\t\t\t\t\t\tunitRatios.percentToPxWidth = callUnitConversionData.lastPercentToPxWidth;\n\t\t\t\t\t\t\t\t\tunitRatios.percentToPxHeight = callUnitConversionData.lastPercentToPxHeight;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/***************************\n\t\t\t\t\t\t\t\t Element-Agnostic Units\n\t\t\t\t\t\t\t\t ***************************/\n\n\t\t\t\t\t\t\t\t/* Whereas % and em ratios are determined on a per-element basis, the rem unit only needs to be checked\n\t\t\t\t\t\t\t\t once per call since it's exclusively dependant upon document.body's fontSize. If this is the first time\n\t\t\t\t\t\t\t\t that calculateUnitRatios() is being run during this call, remToPx will still be set to its default value of null,\n\t\t\t\t\t\t\t\t so we calculate it now. */\n\t\t\t\t\t\t\t\tif (callUnitConversionData.remToPx === null) {\n\t\t\t\t\t\t\t\t\t/* Default to browsers' default fontSize of 16px in the case of 0. */\n\t\t\t\t\t\t\t\t\tcallUnitConversionData.remToPx = parseFloat(CSS.getPropertyValue(document.body, \"fontSize\")) || 16; /* GET */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/* Similarly, viewport units are %-relative to the window's inner dimensions. */\n\t\t\t\t\t\t\t\tif (callUnitConversionData.vwToPx === null) {\n\t\t\t\t\t\t\t\t\tcallUnitConversionData.vwToPx = parseFloat(window.innerWidth) / 100; /* GET */\n\t\t\t\t\t\t\t\t\tcallUnitConversionData.vhToPx = parseFloat(window.innerHeight) / 100; /* GET */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tunitRatios.remToPx = callUnitConversionData.remToPx;\n\t\t\t\t\t\t\t\tunitRatios.vwToPx = callUnitConversionData.vwToPx;\n\t\t\t\t\t\t\t\tunitRatios.vhToPx = callUnitConversionData.vhToPx;\n\n\t\t\t\t\t\t\t\tif (Velocity.debug >= 1) {\n\t\t\t\t\t\t\t\t\tconsole.log(\"Unit ratios: \" + JSON.stringify(unitRatios), element);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn unitRatios;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t/********************\n\t\t\t\t\t\t\t Unit Conversion\n\t\t\t\t\t\t\t ********************/\n\n\t\t\t\t\t\t\t/* The * and / operators, which are not passed in with an associated unit, inherently use startValue's unit. Skip value and unit conversion. */\n\t\t\t\t\t\t\tif (/[\\/*]/.test(operator)) {\n\t\t\t\t\t\t\t\tendValueUnitType = startValueUnitType;\n\t\t\t\t\t\t\t\t/* If startValue and endValue differ in unit type, convert startValue into the same unit type as endValue so that if endValueUnitType\n\t\t\t\t\t\t\t\t is a relative unit (%, em, rem), the values set during tweening will continue to be accurately relative even if the metrics they depend\n\t\t\t\t\t\t\t\t on are dynamically changing during the course of the animation. Conversely, if we always normalized into px and used px for setting values, the px ratio\n\t\t\t\t\t\t\t\t would become stale if the original unit being animated toward was relative and the underlying metrics change during the animation. */\n\t\t\t\t\t\t\t\t/* Since 0 is 0 in any unit type, no conversion is necessary when startValue is 0 -- we just start at 0 with endValueUnitType. */\n\t\t\t\t\t\t\t} else if ((startValueUnitType !== endValueUnitType) && startValue !== 0) {\n\t\t\t\t\t\t\t\t/* Unit conversion is also skipped when endValue is 0, but *startValueUnitType* must be used for tween values to remain accurate. */\n\t\t\t\t\t\t\t\t/* Note: Skipping unit conversion here means that if endValueUnitType was originally a relative unit, the animation won't relatively\n\t\t\t\t\t\t\t\t match the underlying metrics if they change, but this is acceptable since we're animating toward invisibility instead of toward visibility,\n\t\t\t\t\t\t\t\t which remains past the point of the animation's completion. */\n\t\t\t\t\t\t\t\tif (endValue === 0) {\n\t\t\t\t\t\t\t\t\tendValueUnitType = startValueUnitType;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/* By this point, we cannot avoid unit conversion (it's undesirable since it causes layout thrashing).\n\t\t\t\t\t\t\t\t\t If we haven't already, we trigger calculateUnitRatios(), which runs once per element per call. */\n\t\t\t\t\t\t\t\t\telementUnitConversionData = elementUnitConversionData || calculateUnitRatios();\n\n\t\t\t\t\t\t\t\t\t/* The following RegEx matches CSS properties that have their % values measured relative to the x-axis. */\n\t\t\t\t\t\t\t\t\t/* Note: W3C spec mandates that all of margin and padding's properties (even top and bottom) are %-relative to the *width* of the parent element. */\n\t\t\t\t\t\t\t\t\tvar axis = (/margin|padding|left|right|width|text|word|letter/i.test(property) || /X$/.test(property) || property === \"x\") ? \"x\" : \"y\";\n\n\t\t\t\t\t\t\t\t\t/* In order to avoid generating n^2 bespoke conversion functions, unit conversion is a two-step process:\n\t\t\t\t\t\t\t\t\t 1) Convert startValue into pixels. 2) Convert this new pixel value into endValue's unit type. */\n\t\t\t\t\t\t\t\t\tswitch (startValueUnitType) {\n\t\t\t\t\t\t\t\t\t\tcase \"%\":\n\t\t\t\t\t\t\t\t\t\t\t/* Note: translateX and translateY are the only properties that are %-relative to an element's own dimensions -- not its parent's dimensions.\n\t\t\t\t\t\t\t\t\t\t\t Velocity does not include a special conversion process to account for this behavior. Therefore, animating translateX/Y from a % value\n\t\t\t\t\t\t\t\t\t\t\t to a non-% value will produce an incorrect start value. Fortunately, this sort of cross-unit conversion is rarely done by users in practice. */\n\t\t\t\t\t\t\t\t\t\t\tstartValue *= (axis === \"x\" ? elementUnitConversionData.percentToPxWidth : elementUnitConversionData.percentToPxHeight);\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase \"px\":\n\t\t\t\t\t\t\t\t\t\t\t/* px acts as our midpoint in the unit conversion process; do nothing. */\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tstartValue *= elementUnitConversionData[startValueUnitType + \"ToPx\"];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t/* Invert the px ratios to convert into to the target unit. */\n\t\t\t\t\t\t\t\t\tswitch (endValueUnitType) {\n\t\t\t\t\t\t\t\t\t\tcase \"%\":\n\t\t\t\t\t\t\t\t\t\t\tstartValue *= 1 / (axis === \"x\" ? elementUnitConversionData.percentToPxWidth : elementUnitConversionData.percentToPxHeight);\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase \"px\":\n\t\t\t\t\t\t\t\t\t\t\t/* startValue is already in px, do nothing; we're done. */\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tstartValue *= 1 / elementUnitConversionData[endValueUnitType + \"ToPx\"];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/*********************\n\t\t\t\t\t\t\t Relative Values\n\t\t\t\t\t\t\t *********************/\n\n\t\t\t\t\t\t\t/* Operator logic must be performed last since it requires unit-normalized start and end values. */\n\t\t\t\t\t\t\t/* Note: Relative *percent values* do not behave how most people think; while one would expect \"+=50%\"\n\t\t\t\t\t\t\t to increase the property 1.5x its current value, it in fact increases the percent units in absolute terms:\n\t\t\t\t\t\t\t 50 points is added on top of the current % value. */\n\t\t\t\t\t\t\tswitch (operator) {\n\t\t\t\t\t\t\t\tcase \"+\":\n\t\t\t\t\t\t\t\t\tendValue = startValue + endValue;\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase \"-\":\n\t\t\t\t\t\t\t\t\tendValue = startValue - endValue;\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase \"*\":\n\t\t\t\t\t\t\t\t\tendValue = startValue * endValue;\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase \"/\":\n\t\t\t\t\t\t\t\t\tendValue = startValue / endValue;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/**************************\n\t\t\t\t\t\t\t tweensContainer Push\n\t\t\t\t\t\t\t **************************/\n\n\t\t\t\t\t\t\t/* Construct the per-property tween object, and push it to the element's tweensContainer. */\n\t\t\t\t\t\t\ttweensContainer[property] = {\n\t\t\t\t\t\t\t\trootPropertyValue: rootPropertyValue,\n\t\t\t\t\t\t\t\tstartValue: startValue,\n\t\t\t\t\t\t\t\tcurrentValue: startValue,\n\t\t\t\t\t\t\t\tendValue: endValue,\n\t\t\t\t\t\t\t\tunitType: endValueUnitType,\n\t\t\t\t\t\t\t\teasing: easing\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (Velocity.debug) {\n\t\t\t\t\t\t\t\tconsole.log(\"tweensContainer (\" + property + \"): \" + JSON.stringify(tweensContainer[property]), element);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Along with its property data, store a reference to the element itself onto tweensContainer. */\n\t\t\t\t\t\ttweensContainer.element = element;\n\t\t\t\t\t}\n\n\t\t\t\t\t/*****************\n\t\t\t\t\t Call Push\n\t\t\t\t\t *****************/\n\n\t\t\t\t\t/* Note: tweensContainer can be empty if all of the properties in this call's property map were skipped due to not\n\t\t\t\t\t being supported by the browser. The element property is used for checking that the tweensContainer has been appended to. */\n\t\t\t\t\tif (tweensContainer.element) {\n\t\t\t\t\t\t/* Apply the \"velocity-animating\" indicator class. */\n\t\t\t\t\t\tCSS.Values.addClass(element, \"velocity-animating\");\n\n\t\t\t\t\t\t/* The call array houses the tweensContainers for each element being animated in the current call. */\n\t\t\t\t\t\tcall.push(tweensContainer);\n\n\t\t\t\t\t\tdata = Data(element);\n\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\t/* Store the tweensContainer and options if we're working on the default effects queue, so that they can be used by the reverse command. */\n\t\t\t\t\t\t\tif (opts.queue === \"\") {\n\n\t\t\t\t\t\t\t\tdata.tweensContainer = tweensContainer;\n\t\t\t\t\t\t\t\tdata.opts = opts;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Switch on the element's animating flag. */\n\t\t\t\t\t\t\tdata.isAnimating = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Once the final element in this call's element set has been processed, push the call array onto\n\t\t\t\t\t\t Velocity.State.calls for the animation tick to immediately begin processing. */\n\t\t\t\t\t\tif (elementsIndex === elementsLength - 1) {\n\t\t\t\t\t\t\t/* Add the current call plus its associated metadata (the element set and the call's options) onto the global call container.\n\t\t\t\t\t\t\t Anything on this call container is subjected to tick() processing. */\n\t\t\t\t\t\t\tVelocity.State.calls.push([call, elements, opts, null, promiseData.resolver]);\n\n\t\t\t\t\t\t\t/* If the animation tick isn't running, start it. (Velocity shuts it off when there are no active calls to process.) */\n\t\t\t\t\t\t\tif (Velocity.State.isTicking === false) {\n\t\t\t\t\t\t\t\tVelocity.State.isTicking = true;\n\n\t\t\t\t\t\t\t\t/* Start the tick loop. */\n\t\t\t\t\t\t\t\ttick();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telementsIndex++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* When the queue option is set to false, the call skips the element's queue and fires immediately. */\n\t\t\t\tif (opts.queue === false) {\n\t\t\t\t\t/* Since this buildQueue call doesn't respect the element's existing queue (which is where a delay option would have been appended),\n\t\t\t\t\t we manually inject the delay property here with an explicit setTimeout. */\n\t\t\t\t\tif (opts.delay) {\n\t\t\t\t\t\tsetTimeout(buildQueue, opts.delay);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuildQueue();\n\t\t\t\t\t}\n\t\t\t\t\t/* Otherwise, the call undergoes element queueing as normal. */\n\t\t\t\t\t/* Note: To interoperate with jQuery, Velocity uses jQuery's own $.queue() stack for queuing logic. */\n\t\t\t\t} else {\n\t\t\t\t\t$.queue(element, opts.queue, function(next, clearQueue) {\n\t\t\t\t\t\t/* If the clearQueue flag was passed in by the stop command, resolve this call's promise. (Promises can only be resolved once,\n\t\t\t\t\t\t so it's fine if this is repeatedly triggered for each element in the associated call.) */\n\t\t\t\t\t\tif (clearQueue === true) {\n\t\t\t\t\t\t\tif (promiseData.promise) {\n\t\t\t\t\t\t\t\tpromiseData.resolver(elements);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t/* Do not continue with animation queueing. */\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* This flag indicates to the upcoming completeCall() function that this queue entry was initiated by Velocity.\n\t\t\t\t\t\t See completeCall() for further details. */\n\t\t\t\t\t\tVelocity.velocityQueueEntryFlag = true;\n\n\t\t\t\t\t\tbuildQueue(next);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*********************\n\t\t\t\t Auto-Dequeuing\n\t\t\t\t *********************/\n\n\t\t\t\t/* As per jQuery's $.queue() behavior, to fire the first non-custom-queue entry on an element, the element\n\t\t\t\t must be dequeued if its queue stack consists *solely* of the current call. (This can be determined by checking\n\t\t\t\t for the \"inprogress\" item that jQuery prepends to active queue stack arrays.) Regardless, whenever the element's\n\t\t\t\t queue is further appended with additional items -- including $.delay()'s or even $.animate() calls, the queue's\n\t\t\t\t first entry is automatically fired. This behavior contrasts that of custom queues, which never auto-fire. */\n\t\t\t\t/* Note: When an element set is being subjected to a non-parallel Velocity call, the animation will not begin until\n\t\t\t\t each one of the elements in the set has reached the end of its individually pre-existing queue chain. */\n\t\t\t\t/* Note: Unfortunately, most people don't fully grasp jQuery's powerful, yet quirky, $.queue() function.\n\t\t\t\t Lean more here: http://stackoverflow.com/questions/1058158/can-somebody-explain-jquery-queue-to-me */\n\t\t\t\tif ((opts.queue === \"\" || opts.queue === \"fx\") && $.queue(element)[0] !== \"inprogress\") {\n\t\t\t\t\t$.dequeue(element);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**************************\n\t\t\t Element Set Iteration\n\t\t\t **************************/\n\n\t\t\t/* If the \"nodeType\" property exists on the elements variable, we're animating a single element.\n\t\t\t Place it in an array so that $.each() can iterate over it. */\n\t\t\t$.each(elements, function(i, element) {\n\t\t\t\t/* Ensure each element in a set has a nodeType (is a real element) to avoid throwing errors. */\n\t\t\t\tif (Type.isNode(element)) {\n\t\t\t\t\tprocessElement(element, i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/******************\n\t\t\t Option: Loop\n\t\t\t ******************/\n\n\t\t\t/* The loop option accepts an integer indicating how many times the element should loop between the values in the\n\t\t\t current call's properties map and the element's property values prior to this call. */\n\t\t\t/* Note: The loop option's logic is performed here -- after element processing -- because the current call needs\n\t\t\t to undergo its queue insertion prior to the loop option generating its series of constituent \"reverse\" calls,\n\t\t\t which chain after the current call. Two reverse calls (two \"alternations\") constitute one loop. */\n\t\t\topts = $.extend({}, Velocity.defaults, options);\n\t\t\topts.loop = parseInt(opts.loop, 10);\n\t\t\tvar reverseCallsCount = (opts.loop * 2) - 1;\n\n\t\t\tif (opts.loop) {\n\t\t\t\t/* Double the loop count to convert it into its appropriate number of \"reverse\" calls.\n\t\t\t\t Subtract 1 from the resulting value since the current call is included in the total alternation count. */\n\t\t\t\tfor (var x = 0; x < reverseCallsCount; x++) {\n\t\t\t\t\t/* Since the logic for the reverse action occurs inside Queueing and therefore this call's options object\n\t\t\t\t\t isn't parsed until then as well, the current call's delay option must be explicitly passed into the reverse\n\t\t\t\t\t call so that the delay logic that occurs inside *Pre-Queueing* can process it. */\n\t\t\t\t\tvar reverseOptions = {\n\t\t\t\t\t\tdelay: opts.delay,\n\t\t\t\t\t\tprogress: opts.progress\n\t\t\t\t\t};\n\n\t\t\t\t\t/* If a complete callback was passed into this call, transfer it to the loop redirect's final \"reverse\" call\n\t\t\t\t\t so that it's triggered when the entire redirect is complete (and not when the very first animation is complete). */\n\t\t\t\t\tif (x === reverseCallsCount - 1) {\n\t\t\t\t\t\treverseOptions.display = opts.display;\n\t\t\t\t\t\treverseOptions.visibility = opts.visibility;\n\t\t\t\t\t\treverseOptions.complete = opts.complete;\n\t\t\t\t\t}\n\n\t\t\t\t\tanimate(elements, \"reverse\", reverseOptions);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/***************\n\t\t\t Chaining\n\t\t\t ***************/\n\n\t\t\t/* Return the elements back to the call chain, with wrapped elements taking precedence in case Velocity was called via the $.fn. extension. */\n\t\t\treturn getChain();\n\t\t};\n\n\t\t/* Turn Velocity into the animation function, extended with the pre-existing Velocity object. */\n\t\tVelocity = $.extend(animate, Velocity);\n\t\t/* For legacy support, also expose the literal animate method. */\n\t\tVelocity.animate = animate;\n\n\t\t/**************\n\t\t Timing\n\t\t **************/\n\n\t\t/* Ticker function. */\n\t\tvar ticker = window.requestAnimationFrame || rAFShim;\n\n\t\t/* Inactive browser tabs pause rAF, which results in all active animations immediately sprinting to their completion states when the tab refocuses.\n\t\t To get around this, we dynamically switch rAF to setTimeout (which the browser *doesn't* pause) when the tab loses focus. We skip this for mobile\n\t\t devices to avoid wasting battery power on inactive tabs. */\n\t\t/* Note: Tab focus detection doesn't work on older versions of IE, but that's okay since they don't support rAF to begin with. */\n\t\tif (!Velocity.State.isMobile && document.hidden !== undefined) {\n\t\t\tdocument.addEventListener(\"visibilitychange\", function() {\n\t\t\t\t/* Reassign the rAF function (which the global tick() function uses) based on the tab's focus state. */\n\t\t\t\tif (document.hidden) {\n\t\t\t\t\tticker = function(callback) {\n\t\t\t\t\t\t/* The tick function needs a truthy first argument in order to pass its internal timestamp check. */\n\t\t\t\t\t\treturn setTimeout(function() {\n\t\t\t\t\t\t\tcallback(true);\n\t\t\t\t\t\t}, 16);\n\t\t\t\t\t};\n\n\t\t\t\t\t/* The rAF loop has been paused by the browser, so we manually restart the tick. */\n\t\t\t\t\ttick();\n\t\t\t\t} else {\n\t\t\t\t\tticker = window.requestAnimationFrame || rAFShim;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/************\n\t\t Tick\n\t\t ************/\n\n\t\t/* Note: All calls to Velocity are pushed to the Velocity.State.calls array, which is fully iterated through upon each tick. */\n\t\tfunction tick(timestamp) {\n\t\t\t/* An empty timestamp argument indicates that this is the first tick occurence since ticking was turned on.\n\t\t\t We leverage this metadata to fully ignore the first tick pass since RAF's initial pass is fired whenever\n\t\t\t the browser's next tick sync time occurs, which results in the first elements subjected to Velocity\n\t\t\t calls being animated out of sync with any elements animated immediately thereafter. In short, we ignore\n\t\t\t the first RAF tick pass so that elements being immediately consecutively animated -- instead of simultaneously animated\n\t\t\t by the same Velocity call -- are properly batched into the same initial RAF tick and consequently remain in sync thereafter. */\n\t\t\tif (timestamp) {\n\t\t\t\t/* We ignore RAF's high resolution timestamp since it can be significantly offset when the browser is\n\t\t\t\t under high stress; we opt for choppiness over allowing the browser to drop huge chunks of frames. */\n\t\t\t\tvar timeCurrent = (new Date()).getTime();\n\n\t\t\t\t/********************\n\t\t\t\t Call Iteration\n\t\t\t\t ********************/\n\n\t\t\t\tvar callsLength = Velocity.State.calls.length;\n\n\t\t\t\t/* To speed up iterating over this array, it is compacted (falsey items -- calls that have completed -- are removed)\n\t\t\t\t when its length has ballooned to a point that can impact tick performance. This only becomes necessary when animation\n\t\t\t\t has been continuous with many elements over a long period of time; whenever all active calls are completed, completeCall() clears Velocity.State.calls. */\n\t\t\t\tif (callsLength > 10000) {\n\t\t\t\t\tVelocity.State.calls = compactSparseArray(Velocity.State.calls);\n\t\t\t\t\tcallsLength = Velocity.State.calls.length;\n\t\t\t\t}\n\n\t\t\t\t/* Iterate through each active call. */\n\t\t\t\tfor (var i = 0; i < callsLength; i++) {\n\t\t\t\t\t/* When a Velocity call is completed, its Velocity.State.calls entry is set to false. Continue on to the next call. */\n\t\t\t\t\tif (!Velocity.State.calls[i]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t/************************\n\t\t\t\t\t Call-Wide Variables\n\t\t\t\t\t ************************/\n\n\t\t\t\t\tvar callContainer = Velocity.State.calls[i],\n\t\t\t\t\t\t\tcall = callContainer[0],\n\t\t\t\t\t\t\topts = callContainer[2],\n\t\t\t\t\t\t\ttimeStart = callContainer[3],\n\t\t\t\t\t\t\tfirstTick = !!timeStart,\n\t\t\t\t\t\t\ttweenDummyValue = null;\n\n\t\t\t\t\t/* If timeStart is undefined, then this is the first time that this call has been processed by tick().\n\t\t\t\t\t We assign timeStart now so that its value is as close to the real animation start time as possible.\n\t\t\t\t\t (Conversely, had timeStart been defined when this call was added to Velocity.State.calls, the delay\n\t\t\t\t\t between that time and now would cause the first few frames of the tween to be skipped since\n\t\t\t\t\t percentComplete is calculated relative to timeStart.) */\n\t\t\t\t\t/* Further, subtract 16ms (the approximate resolution of RAF) from the current time value so that the\n\t\t\t\t\t first tick iteration isn't wasted by animating at 0% tween completion, which would produce the\n\t\t\t\t\t same style value as the element's current value. */\n\t\t\t\t\tif (!timeStart) {\n\t\t\t\t\t\ttimeStart = Velocity.State.calls[i][3] = timeCurrent - 16;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* The tween's completion percentage is relative to the tween's start time, not the tween's start value\n\t\t\t\t\t (which would result in unpredictable tween durations since JavaScript's timers are not particularly accurate).\n\t\t\t\t\t Accordingly, we ensure that percentComplete does not exceed 1. */\n\t\t\t\t\tvar percentComplete = Math.min((timeCurrent - timeStart) / opts.duration, 1);\n\n\t\t\t\t\t/**********************\n\t\t\t\t\t Element Iteration\n\t\t\t\t\t **********************/\n\n\t\t\t\t\t/* For every call, iterate through each of the elements in its set. */\n\t\t\t\t\tfor (var j = 0, callLength = call.length; j < callLength; j++) {\n\t\t\t\t\t\tvar tweensContainer = call[j],\n\t\t\t\t\t\t\t\telement = tweensContainer.element;\n\n\t\t\t\t\t\t/* Check to see if this element has been deleted midway through the animation by checking for the\n\t\t\t\t\t\t continued existence of its data cache. If it's gone, skip animating this element. */\n\t\t\t\t\t\tif (!Data(element)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar transformPropertyExists = false;\n\n\t\t\t\t\t\t/**********************************\n\t\t\t\t\t\t Display & Visibility Toggling\n\t\t\t\t\t\t **********************************/\n\n\t\t\t\t\t\t/* If the display option is set to non-\"none\", set it upfront so that the element can become visible before tweening begins.\n\t\t\t\t\t\t (Otherwise, display's \"none\" value is set in completeCall() once the animation has completed.) */\n\t\t\t\t\t\tif (opts.display !== undefined && opts.display !== null && opts.display !== \"none\") {\n\t\t\t\t\t\t\tif (opts.display === \"flex\") {\n\t\t\t\t\t\t\t\tvar flexValues = [\"-webkit-box\", \"-moz-box\", \"-ms-flexbox\", \"-webkit-flex\"];\n\n\t\t\t\t\t\t\t\t$.each(flexValues, function(i, flexValue) {\n\t\t\t\t\t\t\t\t\tCSS.setPropertyValue(element, \"display\", flexValue);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tCSS.setPropertyValue(element, \"display\", opts.display);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Same goes with the visibility option, but its \"none\" equivalent is \"hidden\". */\n\t\t\t\t\t\tif (opts.visibility !== undefined && opts.visibility !== \"hidden\") {\n\t\t\t\t\t\t\tCSS.setPropertyValue(element, \"visibility\", opts.visibility);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/************************\n\t\t\t\t\t\t Property Iteration\n\t\t\t\t\t\t ************************/\n\n\t\t\t\t\t\t/* For every element, iterate through each property. */\n\t\t\t\t\t\tfor (var property in tweensContainer) {\n\t\t\t\t\t\t\t/* Note: In addition to property tween data, tweensContainer contains a reference to its associated element. */\n\t\t\t\t\t\t\tif (tweensContainer.hasOwnProperty(property) && property !== \"element\") {\n\t\t\t\t\t\t\t\tvar tween = tweensContainer[property],\n\t\t\t\t\t\t\t\t\t\tcurrentValue,\n\t\t\t\t\t\t\t\t\t\t/* Easing can either be a pre-genereated function or a string that references a pre-registered easing\n\t\t\t\t\t\t\t\t\t\t on the Velocity.Easings object. In either case, return the appropriate easing *function*. */\n\t\t\t\t\t\t\t\t\t\teasing = Type.isString(tween.easing) ? Velocity.Easings[tween.easing] : tween.easing;\n\n\t\t\t\t\t\t\t\t/******************************\n\t\t\t\t\t\t\t\t Current Value Calculation\n\t\t\t\t\t\t\t\t ******************************/\n\n\t\t\t\t\t\t\t\t/* If this is the last tick pass (if we've reached 100% completion for this tween),\n\t\t\t\t\t\t\t\t ensure that currentValue is explicitly set to its target endValue so that it's not subjected to any rounding. */\n\t\t\t\t\t\t\t\tif (percentComplete === 1) {\n\t\t\t\t\t\t\t\t\tcurrentValue = tween.endValue;\n\t\t\t\t\t\t\t\t\t/* Otherwise, calculate currentValue based on the current delta from startValue. */\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvar tweenDelta = tween.endValue - tween.startValue;\n\t\t\t\t\t\t\t\t\tcurrentValue = tween.startValue + (tweenDelta * easing(percentComplete, opts, tweenDelta));\n\n\t\t\t\t\t\t\t\t\t/* If no value change is occurring, don't proceed with DOM updating. */\n\t\t\t\t\t\t\t\t\tif (!firstTick && (currentValue === tween.currentValue)) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttween.currentValue = currentValue;\n\n\t\t\t\t\t\t\t\t/* If we're tweening a fake 'tween' property in order to log transition values, update the one-per-call variable so that\n\t\t\t\t\t\t\t\t it can be passed into the progress callback. */\n\t\t\t\t\t\t\t\tif (property === \"tween\") {\n\t\t\t\t\t\t\t\t\ttweenDummyValue = currentValue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/******************\n\t\t\t\t\t\t\t\t\t Hooks: Part I\n\t\t\t\t\t\t\t\t\t ******************/\n\t\t\t\t\t\t\t\t\tvar hookRoot;\n\n\t\t\t\t\t\t\t\t\t/* For hooked properties, the newly-updated rootPropertyValueCache is cached onto the element so that it can be used\n\t\t\t\t\t\t\t\t\t for subsequent hooks in this call that are associated with the same root property. If we didn't cache the updated\n\t\t\t\t\t\t\t\t\t rootPropertyValue, each subsequent update to the root property in this tick pass would reset the previous hook's\n\t\t\t\t\t\t\t\t\t updates to rootPropertyValue prior to injection. A nice performance byproduct of rootPropertyValue caching is that\n\t\t\t\t\t\t\t\t\t subsequently chained animations using the same hookRoot but a different hook can use this cached rootPropertyValue. */\n\t\t\t\t\t\t\t\t\tif (CSS.Hooks.registered[property]) {\n\t\t\t\t\t\t\t\t\t\thookRoot = CSS.Hooks.getRoot(property);\n\n\t\t\t\t\t\t\t\t\t\tvar rootPropertyValueCache = Data(element).rootPropertyValueCache[hookRoot];\n\n\t\t\t\t\t\t\t\t\t\tif (rootPropertyValueCache) {\n\t\t\t\t\t\t\t\t\t\t\ttween.rootPropertyValue = rootPropertyValueCache;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t/*****************\n\t\t\t\t\t\t\t\t\t DOM Update\n\t\t\t\t\t\t\t\t\t *****************/\n\n\t\t\t\t\t\t\t\t\t/* setPropertyValue() returns an array of the property name and property value post any normalization that may have been performed. */\n\t\t\t\t\t\t\t\t\t/* Note: To solve an IE<=8 positioning bug, the unit type is dropped when setting a property value of 0. */\n\t\t\t\t\t\t\t\t\tvar adjustedSetData = CSS.setPropertyValue(element, /* SET */\n\t\t\t\t\t\t\t\t\t\t\tproperty,\n\t\t\t\t\t\t\t\t\t\t\ttween.currentValue + (parseFloat(currentValue) === 0 ? \"\" : tween.unitType),\n\t\t\t\t\t\t\t\t\t\t\ttween.rootPropertyValue,\n\t\t\t\t\t\t\t\t\t\t\ttween.scrollData);\n\n\t\t\t\t\t\t\t\t\t/*******************\n\t\t\t\t\t\t\t\t\t Hooks: Part II\n\t\t\t\t\t\t\t\t\t *******************/\n\n\t\t\t\t\t\t\t\t\t/* Now that we have the hook's updated rootPropertyValue (the post-processed value provided by adjustedSetData), cache it onto the element. */\n\t\t\t\t\t\t\t\t\tif (CSS.Hooks.registered[property]) {\n\t\t\t\t\t\t\t\t\t\t/* Since adjustedSetData contains normalized data ready for DOM updating, the rootPropertyValue needs to be re-extracted from its normalized form. ?? */\n\t\t\t\t\t\t\t\t\t\tif (CSS.Normalizations.registered[hookRoot]) {\n\t\t\t\t\t\t\t\t\t\t\tData(element).rootPropertyValueCache[hookRoot] = CSS.Normalizations.registered[hookRoot](\"extract\", null, adjustedSetData[1]);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tData(element).rootPropertyValueCache[hookRoot] = adjustedSetData[1];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t/***************\n\t\t\t\t\t\t\t\t\t Transforms\n\t\t\t\t\t\t\t\t\t ***************/\n\n\t\t\t\t\t\t\t\t\t/* Flag whether a transform property is being animated so that flushTransformCache() can be triggered once this tick pass is complete. */\n\t\t\t\t\t\t\t\t\tif (adjustedSetData[0] === \"transform\") {\n\t\t\t\t\t\t\t\t\t\ttransformPropertyExists = true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/****************\n\t\t\t\t\t\t mobileHA\n\t\t\t\t\t\t ****************/\n\n\t\t\t\t\t\t/* If mobileHA is enabled, set the translate3d transform to null to force hardware acceleration.\n\t\t\t\t\t\t It's safe to override this property since Velocity doesn't actually support its animation (hooks are used in its place). */\n\t\t\t\t\t\tif (opts.mobileHA) {\n\t\t\t\t\t\t\t/* Don't set the null transform hack if we've already done so. */\n\t\t\t\t\t\t\tif (Data(element).transformCache.translate3d === undefined) {\n\t\t\t\t\t\t\t\t/* All entries on the transformCache object are later concatenated into a single transform string via flushTransformCache(). */\n\t\t\t\t\t\t\t\tData(element).transformCache.translate3d = \"(0px, 0px, 0px)\";\n\n\t\t\t\t\t\t\t\ttransformPropertyExists = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (transformPropertyExists) {\n\t\t\t\t\t\t\tCSS.flushTransformCache(element);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/* The non-\"none\" display value is only applied to an element once -- when its associated call is first ticked through.\n\t\t\t\t\t Accordingly, it's set to false so that it isn't re-processed by this call in the next tick. */\n\t\t\t\t\tif (opts.display !== undefined && opts.display !== \"none\") {\n\t\t\t\t\t\tVelocity.State.calls[i][2].display = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (opts.visibility !== undefined && opts.visibility !== \"hidden\") {\n\t\t\t\t\t\tVelocity.State.calls[i][2].visibility = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Pass the elements and the timing data (percentComplete, msRemaining, timeStart, tweenDummyValue) into the progress callback. */\n\t\t\t\t\tif (opts.progress) {\n\t\t\t\t\t\topts.progress.call(callContainer[1],\n\t\t\t\t\t\t\t\tcallContainer[1],\n\t\t\t\t\t\t\t\tpercentComplete,\n\t\t\t\t\t\t\t\tMath.max(0, (timeStart + opts.duration) - timeCurrent),\n\t\t\t\t\t\t\t\ttimeStart,\n\t\t\t\t\t\t\t\ttweenDummyValue);\n\t\t\t\t\t}\n\n\t\t\t\t\t/* If this call has finished tweening, pass its index to completeCall() to handle call cleanup. */\n\t\t\t\t\tif (percentComplete === 1) {\n\t\t\t\t\t\tcompleteCall(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Note: completeCall() sets the isTicking flag to false when the last call on Velocity.State.calls has completed. */\n\t\t\tif (Velocity.State.isTicking) {\n\t\t\t\tticker(tick);\n\t\t\t}\n\t\t}\n\n\t\t/**********************\n\t\t Call Completion\n\t\t **********************/\n\n\t\t/* Note: Unlike tick(), which processes all active calls at once, call completion is handled on a per-call basis. */\n\t\tfunction completeCall(callIndex, isStopped) {\n\t\t\t/* Ensure the call exists. */\n\t\t\tif (!Velocity.State.calls[callIndex]) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* Pull the metadata from the call. */\n\t\t\tvar call = Velocity.State.calls[callIndex][0],\n\t\t\t\t\telements = Velocity.State.calls[callIndex][1],\n\t\t\t\t\topts = Velocity.State.calls[callIndex][2],\n\t\t\t\t\tresolver = Velocity.State.calls[callIndex][4];\n\n\t\t\tvar remainingCallsExist = false;\n\n\t\t\t/*************************\n\t\t\t Element Finalization\n\t\t\t *************************/\n\n\t\t\tfor (var i = 0, callLength = call.length; i < callLength; i++) {\n\t\t\t\tvar element = call[i].element;\n\n\t\t\t\t/* If the user set display to \"none\" (intending to hide the element), set it now that the animation has completed. */\n\t\t\t\t/* Note: display:none isn't set when calls are manually stopped (via Velocity(\"stop\"). */\n\t\t\t\t/* Note: Display gets ignored with \"reverse\" calls and infinite loops, since this behavior would be undesirable. */\n\t\t\t\tif (!isStopped && !opts.loop) {\n\t\t\t\t\tif (opts.display === \"none\") {\n\t\t\t\t\t\tCSS.setPropertyValue(element, \"display\", opts.display);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (opts.visibility === \"hidden\") {\n\t\t\t\t\t\tCSS.setPropertyValue(element, \"visibility\", opts.visibility);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* If the element's queue is empty (if only the \"inprogress\" item is left at position 0) or if its queue is about to run\n\t\t\t\t a non-Velocity-initiated entry, turn off the isAnimating flag. A non-Velocity-initiatied queue entry's logic might alter\n\t\t\t\t an element's CSS values and thereby cause Velocity's cached value data to go stale. To detect if a queue entry was initiated by Velocity,\n\t\t\t\t we check for the existence of our special Velocity.queueEntryFlag declaration, which minifiers won't rename since the flag\n\t\t\t\t is assigned to jQuery's global $ object and thus exists out of Velocity's own scope. */\n\t\t\t\tvar data = Data(element);\n\n\t\t\t\tif (opts.loop !== true && ($.queue(element)[1] === undefined || !/\\.velocityQueueEntryFlag/i.test($.queue(element)[1]))) {\n\t\t\t\t\t/* The element may have been deleted. Ensure that its data cache still exists before acting on it. */\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tdata.isAnimating = false;\n\t\t\t\t\t\t/* Clear the element's rootPropertyValueCache, which will become stale. */\n\t\t\t\t\t\tdata.rootPropertyValueCache = {};\n\n\t\t\t\t\t\tvar transformHAPropertyExists = false;\n\t\t\t\t\t\t/* If any 3D transform subproperty is at its default value (regardless of unit type), remove it. */\n\t\t\t\t\t\t$.each(CSS.Lists.transforms3D, function(i, transformName) {\n\t\t\t\t\t\t\tvar defaultValue = /^scale/.test(transformName) ? 1 : 0,\n\t\t\t\t\t\t\t\t\tcurrentValue = data.transformCache[transformName];\n\n\t\t\t\t\t\t\tif (data.transformCache[transformName] !== undefined && new RegExp(\"^\\\\(\" + defaultValue + \"[^.]\").test(currentValue)) {\n\t\t\t\t\t\t\t\ttransformHAPropertyExists = true;\n\n\t\t\t\t\t\t\t\tdelete data.transformCache[transformName];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t/* Mobile devices have hardware acceleration removed at the end of the animation in order to avoid hogging the GPU's memory. */\n\t\t\t\t\t\tif (opts.mobileHA) {\n\t\t\t\t\t\t\ttransformHAPropertyExists = true;\n\t\t\t\t\t\t\tdelete data.transformCache.translate3d;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Flush the subproperty removals to the DOM. */\n\t\t\t\t\t\tif (transformHAPropertyExists) {\n\t\t\t\t\t\t\tCSS.flushTransformCache(element);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Remove the \"velocity-animating\" indicator class. */\n\t\t\t\t\t\tCSS.Values.removeClass(element, \"velocity-animating\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*********************\n\t\t\t\t Option: Complete\n\t\t\t\t *********************/\n\n\t\t\t\t/* Complete is fired once per call (not once per element) and is passed the full raw DOM element set as both its context and its first argument. */\n\t\t\t\t/* Note: Callbacks aren't fired when calls are manually stopped (via Velocity(\"stop\"). */\n\t\t\t\tif (!isStopped && opts.complete && !opts.loop && (i === callLength - 1)) {\n\t\t\t\t\t/* We throw callbacks in a setTimeout so that thrown errors don't halt the execution of Velocity itself. */\n\t\t\t\t\ttry {\n\t\t\t\t\t\topts.complete.call(elements, elements);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**********************\n\t\t\t\t Promise Resolving\n\t\t\t\t **********************/\n\n\t\t\t\t/* Note: Infinite loops don't return promises. */\n\t\t\t\tif (resolver && opts.loop !== true) {\n\t\t\t\t\tresolver(elements);\n\t\t\t\t}\n\n\t\t\t\t/****************************\n\t\t\t\t Option: Loop (Infinite)\n\t\t\t\t ****************************/\n\n\t\t\t\tif (data && opts.loop === true && !isStopped) {\n\t\t\t\t\t/* If a rotateX/Y/Z property is being animated by 360 deg with loop:true, swap tween start/end values to enable\n\t\t\t\t\t continuous iterative rotation looping. (Otherise, the element would just rotate back and forth.) */\n\t\t\t\t\t$.each(data.tweensContainer, function(propertyName, tweenContainer) {\n\t\t\t\t\t\tif (/^rotate/.test(propertyName) && ((parseFloat(tweenContainer.startValue) - parseFloat(tweenContainer.endValue)) % 360 === 0)) {\n\t\t\t\t\t\t\tvar oldStartValue = tweenContainer.startValue;\n\n\t\t\t\t\t\t\ttweenContainer.startValue = tweenContainer.endValue;\n\t\t\t\t\t\t\ttweenContainer.endValue = oldStartValue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (/^backgroundPosition/.test(propertyName) && parseFloat(tweenContainer.endValue) === 100 && tweenContainer.unitType === \"%\") {\n\t\t\t\t\t\t\ttweenContainer.endValue = 0;\n\t\t\t\t\t\t\ttweenContainer.startValue = 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tVelocity(element, \"reverse\", {loop: true, delay: opts.delay});\n\t\t\t\t}\n\n\t\t\t\t/***************\n\t\t\t\t Dequeueing\n\t\t\t\t ***************/\n\n\t\t\t\t/* Fire the next call in the queue so long as this call's queue wasn't set to false (to trigger a parallel animation),\n\t\t\t\t which would have already caused the next call to fire. Note: Even if the end of the animation queue has been reached,\n\t\t\t\t $.dequeue() must still be called in order to completely clear jQuery's animation queue. */\n\t\t\t\tif (opts.queue !== false) {\n\t\t\t\t\t$.dequeue(element, opts.queue);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/************************\n\t\t\t Calls Array Cleanup\n\t\t\t ************************/\n\n\t\t\t/* Since this call is complete, set it to false so that the rAF tick skips it. This array is later compacted via compactSparseArray().\n\t\t\t (For performance reasons, the call is set to false instead of being deleted from the array: http://www.html5rocks.com/en/tutorials/speed/v8/) */\n\t\t\tVelocity.State.calls[callIndex] = false;\n\n\t\t\t/* Iterate through the calls array to determine if this was the final in-progress animation.\n\t\t\t If so, set a flag to end ticking and clear the calls array. */\n\t\t\tfor (var j = 0, callsLength = Velocity.State.calls.length; j < callsLength; j++) {\n\t\t\t\tif (Velocity.State.calls[j] !== false) {\n\t\t\t\t\tremainingCallsExist = true;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (remainingCallsExist === false) {\n\t\t\t\t/* tick() will detect this flag upon its next iteration and subsequently turn itself off. */\n\t\t\t\tVelocity.State.isTicking = false;\n\n\t\t\t\t/* Clear the calls array so that its length is reset. */\n\t\t\t\tdelete Velocity.State.calls;\n\t\t\t\tVelocity.State.calls = [];\n\t\t\t}\n\t\t}\n\n\t\t/******************\n\t\t Frameworks\n\t\t ******************/\n\n\t\t/* Both jQuery and Zepto allow their $.fn object to be extended to allow wrapped elements to be subjected to plugin calls.\n\t\t If either framework is loaded, register a \"velocity\" extension pointing to Velocity's core animate() method.  Velocity\n\t\t also registers itself onto a global container (window.jQuery || window.Zepto || window) so that certain features are\n\t\t accessible beyond just a per-element scope. This master object contains an .animate() method, which is later assigned to $.fn\n\t\t (if jQuery or Zepto are present). Accordingly, Velocity can both act on wrapped DOM elements and stand alone for targeting raw DOM elements. */\n\t\tglobal.Velocity = Velocity;\n\n\t\tif (global !== window) {\n\t\t\t/* Assign the element function to Velocity's core animate() method. */\n\t\t\tglobal.fn.velocity = animate;\n\t\t\t/* Assign the object function's defaults to Velocity's global defaults object. */\n\t\t\tglobal.fn.velocity.defaults = Velocity.defaults;\n\t\t}\n\n\t\t/***********************\n\t\t Packaged Redirects\n\t\t ***********************/\n\n\t\t/* slideUp, slideDown */\n\t\t$.each([\"Down\", \"Up\"], function(i, direction) {\n\t\t\tVelocity.Redirects[\"slide\" + direction] = function(element, options, elementsIndex, elementsSize, elements, promiseData) {\n\t\t\t\tvar opts = $.extend({}, options),\n\t\t\t\t\t\tbegin = opts.begin,\n\t\t\t\t\t\tcomplete = opts.complete,\n\t\t\t\t\t\tcomputedValues = {height: \"\", marginTop: \"\", marginBottom: \"\", paddingTop: \"\", paddingBottom: \"\"},\n\t\t\t\tinlineValues = {};\n\n\t\t\t\tif (opts.display === undefined) {\n\t\t\t\t\t/* Show the element before slideDown begins and hide the element after slideUp completes. */\n\t\t\t\t\t/* Note: Inline elements cannot have dimensions animated, so they're reverted to inline-block. */\n\t\t\t\t\topts.display = (direction === \"Down\" ? (Velocity.CSS.Values.getDisplayType(element) === \"inline\" ? \"inline-block\" : \"block\") : \"none\");\n\t\t\t\t}\n\n\t\t\t\topts.begin = function() {\n\t\t\t\t\t/* If the user passed in a begin callback, fire it now. */\n\t\t\t\t\tif (begin) {\n\t\t\t\t\t\tbegin.call(elements, elements);\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Cache the elements' original vertical dimensional property values so that we can animate back to them. */\n\t\t\t\t\tfor (var property in computedValues) {\n\t\t\t\t\t\tif (!computedValues.hasOwnProperty(property)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinlineValues[property] = element.style[property];\n\n\t\t\t\t\t\t/* For slideDown, use forcefeeding to animate all vertical properties from 0. For slideUp,\n\t\t\t\t\t\t use forcefeeding to start from computed values and animate down to 0. */\n\t\t\t\t\t\tvar propertyValue = Velocity.CSS.getPropertyValue(element, property);\n\t\t\t\t\t\tcomputedValues[property] = (direction === \"Down\") ? [propertyValue, 0] : [0, propertyValue];\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Force vertical overflow content to clip so that sliding works as expected. */\n\t\t\t\t\tinlineValues.overflow = element.style.overflow;\n\t\t\t\t\telement.style.overflow = \"hidden\";\n\t\t\t\t};\n\n\t\t\t\topts.complete = function() {\n\t\t\t\t\t/* Reset element to its pre-slide inline values once its slide animation is complete. */\n\t\t\t\t\tfor (var property in inlineValues) {\n\t\t\t\t\t\tif (inlineValues.hasOwnProperty(property)) {\n\t\t\t\t\t\t\telement.style[property] = inlineValues[property];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/* If the user passed in a complete callback, fire it now. */\n\t\t\t\t\tif (complete) {\n\t\t\t\t\t\tcomplete.call(elements, elements);\n\t\t\t\t\t}\n\t\t\t\t\tif (promiseData) {\n\t\t\t\t\t\tpromiseData.resolver(elements);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tVelocity(element, computedValues, opts);\n\t\t\t};\n\t\t});\n\n\t\t/* fadeIn, fadeOut */\n\t\t$.each([\"In\", \"Out\"], function(i, direction) {\n\t\t\tVelocity.Redirects[\"fade\" + direction] = function(element, options, elementsIndex, elementsSize, elements, promiseData) {\n\t\t\t\tvar opts = $.extend({}, options),\n\t\t\t\t\t\toriginalComplete = opts.complete,\n\t\t\t\t\t\tpropertiesMap = {opacity: (direction === \"In\") ? 1 : 0};\n\n\t\t\t\t/* Since redirects are triggered individually for each element in the animated set, avoid repeatedly triggering\n\t\t\t\t callbacks by firing them only when the final element has been reached. */\n\t\t\t\tif (elementsIndex !== elementsSize - 1) {\n\t\t\t\t\topts.complete = opts.begin = null;\n\t\t\t\t} else {\n\t\t\t\t\topts.complete = function() {\n\t\t\t\t\t\tif (originalComplete) {\n\t\t\t\t\t\t\toriginalComplete.call(elements, elements);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (promiseData) {\n\t\t\t\t\t\t\tpromiseData.resolver(elements);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t/* If a display was passed in, use it. Otherwise, default to \"none\" for fadeOut or the element-specific default for fadeIn. */\n\t\t\t\t/* Note: We allow users to pass in \"null\" to skip display setting altogether. */\n\t\t\t\tif (opts.display === undefined) {\n\t\t\t\t\topts.display = (direction === \"In\" ? \"auto\" : \"none\");\n\t\t\t\t}\n\n\t\t\t\tVelocity(this, propertiesMap, opts);\n\t\t\t};\n\t\t});\n\n\t\treturn Velocity;\n\t}((window.jQuery || window.Zepto || window), window, document);\n}));\n\n/******************\n Known Issues\n ******************/\n\n/* The CSS spec mandates that the translateX/Y/Z transforms are %-relative to the element itself -- not its parent.\n Velocity, however, doesn't make this distinction. Thus, converting to or from the % unit with these subproperties\n will produce an inaccurate conversion value. The same issue exists with the cx/cy attributes of SVG circles and ellipses. */\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vfi92ZWxvY2l0eS1hbmltYXRlL3ZlbG9jaXR5LmpzPzNkZTUiXSwic291cmNlc0NvbnRlbnQiOlsiLyohIFZlbG9jaXR5SlMub3JnICgxLjMuMSkuIChDKSAyMDE0IEp1bGlhbiBTaGFwaXJvLiBNSVQgQGxpY2Vuc2U6IGVuLndpa2lwZWRpYS5vcmcvd2lraS9NSVRfTGljZW5zZSAqL1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKlxuIFZlbG9jaXR5IGpRdWVyeSBTaGltXG4gKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuLyohIFZlbG9jaXR5SlMub3JnIGpRdWVyeSBTaGltICgxLjAuMSkuIChDKSAyMDE0IFRoZSBqUXVlcnkgRm91bmRhdGlvbi4gTUlUIEBsaWNlbnNlOiBlbi53aWtpcGVkaWEub3JnL3dpa2kvTUlUX0xpY2Vuc2UuICovXG5cbi8qIFRoaXMgZmlsZSBjb250YWlucyB0aGUgalF1ZXJ5IGZ1bmN0aW9ucyB0aGF0IFZlbG9jaXR5IHJlbGllcyBvbiwgdGhlcmVieSByZW1vdmluZyBWZWxvY2l0eSdzIGRlcGVuZGVuY3kgb24gYSBmdWxsIGNvcHkgb2YgalF1ZXJ5LCBhbmQgYWxsb3dpbmcgaXQgdG8gd29yayBpbiBhbnkgZW52aXJvbm1lbnQuICovXG4vKiBUaGVzZSBzaGltbWVkIGZ1bmN0aW9ucyBhcmUgb25seSB1c2VkIGlmIGpRdWVyeSBpc24ndCBwcmVzZW50LiBJZiBib3RoIHRoaXMgc2hpbSBhbmQgalF1ZXJ5IGFyZSBsb2FkZWQsIFZlbG9jaXR5IGRlZmF1bHRzIHRvIGpRdWVyeSBwcm9wZXIuICovXG4vKiBCcm93c2VyIHN1cHBvcnQ6IFVzaW5nIHRoaXMgc2hpbSBpbnN0ZWFkIG9mIGpRdWVyeSBwcm9wZXIgcmVtb3ZlcyBzdXBwb3J0IGZvciBJRTguICovXG5cbihmdW5jdGlvbih3aW5kb3cpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdC8qKioqKioqKioqKioqKipcblx0IFNldHVwXG5cdCAqKioqKioqKioqKioqKiovXG5cblx0LyogSWYgalF1ZXJ5IGlzIGFscmVhZHkgbG9hZGVkLCB0aGVyZSdzIG5vIHBvaW50IGluIGxvYWRpbmcgdGhpcyBzaGltLiAqL1xuXHRpZiAod2luZG93LmpRdWVyeSkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdC8qIGpRdWVyeSBiYXNlLiAqL1xuXHR2YXIgJCA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBjb250ZXh0KSB7XG5cdFx0cmV0dXJuIG5ldyAkLmZuLmluaXQoc2VsZWN0b3IsIGNvbnRleHQpO1xuXHR9O1xuXG5cdC8qKioqKioqKioqKioqKioqKioqKlxuXHQgUHJpdmF0ZSBNZXRob2RzXG5cdCAqKioqKioqKioqKioqKioqKioqKi9cblxuXHQvKiBqUXVlcnkgKi9cblx0JC5pc1dpbmRvdyA9IGZ1bmN0aW9uKG9iaikge1xuXHRcdC8qIGpzaGludCBlcWVxZXE6IGZhbHNlICovXG5cdFx0cmV0dXJuIG9iaiAmJiBvYmogPT09IG9iai53aW5kb3c7XG5cdH07XG5cblx0LyogalF1ZXJ5ICovXG5cdCQudHlwZSA9IGZ1bmN0aW9uKG9iaikge1xuXHRcdGlmICghb2JqKSB7XG5cdFx0XHRyZXR1cm4gb2JqICsgXCJcIjtcblx0XHR9XG5cblx0XHRyZXR1cm4gdHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2Ygb2JqID09PSBcImZ1bmN0aW9uXCIgP1xuXHRcdFx0XHRjbGFzczJ0eXBlW3RvU3RyaW5nLmNhbGwob2JqKV0gfHwgXCJvYmplY3RcIiA6XG5cdFx0XHRcdHR5cGVvZiBvYmo7XG5cdH07XG5cblx0LyogalF1ZXJ5ICovXG5cdCQuaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuICQudHlwZShvYmopID09PSBcImFycmF5XCI7XG5cdH07XG5cblx0LyogalF1ZXJ5ICovXG5cdGZ1bmN0aW9uIGlzQXJyYXlsaWtlKG9iaikge1xuXHRcdHZhciBsZW5ndGggPSBvYmoubGVuZ3RoLFxuXHRcdFx0XHR0eXBlID0gJC50eXBlKG9iaik7XG5cblx0XHRpZiAodHlwZSA9PT0gXCJmdW5jdGlvblwiIHx8ICQuaXNXaW5kb3cob2JqKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGlmIChvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdHlwZSA9PT0gXCJhcnJheVwiIHx8IGxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgbGVuZ3RoID09PSBcIm51bWJlclwiICYmIGxlbmd0aCA+IDAgJiYgKGxlbmd0aCAtIDEpIGluIG9iajtcblx0fVxuXG5cdC8qKioqKioqKioqKioqKipcblx0ICQgTWV0aG9kc1xuXHQgKioqKioqKioqKioqKioqL1xuXG5cdC8qIGpRdWVyeTogU3VwcG9ydCByZW1vdmVkIGZvciBJRTw5LiAqL1xuXHQkLmlzUGxhaW5PYmplY3QgPSBmdW5jdGlvbihvYmopIHtcblx0XHR2YXIga2V5O1xuXG5cdFx0aWYgKCFvYmogfHwgJC50eXBlKG9iaikgIT09IFwib2JqZWN0XCIgfHwgb2JqLm5vZGVUeXBlIHx8ICQuaXNXaW5kb3cob2JqKSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yICYmXG5cdFx0XHRcdFx0IWhhc093bi5jYWxsKG9iaiwgXCJjb25zdHJ1Y3RvclwiKSAmJlxuXHRcdFx0XHRcdCFoYXNPd24uY2FsbChvYmouY29uc3RydWN0b3IucHJvdG90eXBlLCBcImlzUHJvdG90eXBlT2ZcIikpIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRmb3IgKGtleSBpbiBvYmopIHtcblx0XHR9XG5cblx0XHRyZXR1cm4ga2V5ID09PSB1bmRlZmluZWQgfHwgaGFzT3duLmNhbGwob2JqLCBrZXkpO1xuXHR9O1xuXG5cdC8qIGpRdWVyeSAqL1xuXHQkLmVhY2ggPSBmdW5jdGlvbihvYmosIGNhbGxiYWNrLCBhcmdzKSB7XG5cdFx0dmFyIHZhbHVlLFxuXHRcdFx0XHRpID0gMCxcblx0XHRcdFx0bGVuZ3RoID0gb2JqLmxlbmd0aCxcblx0XHRcdFx0aXNBcnJheSA9IGlzQXJyYXlsaWtlKG9iaik7XG5cblx0XHRpZiAoYXJncykge1xuXHRcdFx0aWYgKGlzQXJyYXkpIHtcblx0XHRcdFx0Zm9yICg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHZhbHVlID0gY2FsbGJhY2suYXBwbHkob2JqW2ldLCBhcmdzKTtcblxuXHRcdFx0XHRcdGlmICh2YWx1ZSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9yIChpIGluIG9iaikge1xuXHRcdFx0XHRcdGlmICghb2JqLmhhc093blByb3BlcnR5KGkpKSB7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFsdWUgPSBjYWxsYmFjay5hcHBseShvYmpbaV0sIGFyZ3MpO1xuXG5cdFx0XHRcdFx0aWYgKHZhbHVlID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKGlzQXJyYXkpIHtcblx0XHRcdFx0Zm9yICg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHZhbHVlID0gY2FsbGJhY2suY2FsbChvYmpbaV0sIGksIG9ialtpXSk7XG5cblx0XHRcdFx0XHRpZiAodmFsdWUgPT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZvciAoaSBpbiBvYmopIHtcblx0XHRcdFx0XHRpZiAoIW9iai5oYXNPd25Qcm9wZXJ0eShpKSkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHZhbHVlID0gY2FsbGJhY2suY2FsbChvYmpbaV0sIGksIG9ialtpXSk7XG5cblx0XHRcdFx0XHRpZiAodmFsdWUgPT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gb2JqO1xuXHR9O1xuXG5cdC8qIEN1c3RvbSAqL1xuXHQkLmRhdGEgPSBmdW5jdGlvbihub2RlLCBrZXksIHZhbHVlKSB7XG5cdFx0LyogJC5nZXREYXRhKCkgKi9cblx0XHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0dmFyIGdldElkID0gbm9kZVskLmV4cGFuZG9dLFxuXHRcdFx0XHRcdHN0b3JlID0gZ2V0SWQgJiYgY2FjaGVbZ2V0SWRdO1xuXG5cdFx0XHRpZiAoa2V5ID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0cmV0dXJuIHN0b3JlO1xuXHRcdFx0fSBlbHNlIGlmIChzdG9yZSkge1xuXHRcdFx0XHRpZiAoa2V5IGluIHN0b3JlKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHN0b3JlW2tleV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdC8qICQuc2V0RGF0YSgpICovXG5cdFx0fSBlbHNlIGlmIChrZXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0dmFyIHNldElkID0gbm9kZVskLmV4cGFuZG9dIHx8IChub2RlWyQuZXhwYW5kb10gPSArKyQudXVpZCk7XG5cblx0XHRcdGNhY2hlW3NldElkXSA9IGNhY2hlW3NldElkXSB8fCB7fTtcblx0XHRcdGNhY2hlW3NldElkXVtrZXldID0gdmFsdWU7XG5cblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9XG5cdH07XG5cblx0LyogQ3VzdG9tICovXG5cdCQucmVtb3ZlRGF0YSA9IGZ1bmN0aW9uKG5vZGUsIGtleXMpIHtcblx0XHR2YXIgaWQgPSBub2RlWyQuZXhwYW5kb10sXG5cdFx0XHRcdHN0b3JlID0gaWQgJiYgY2FjaGVbaWRdO1xuXG5cdFx0aWYgKHN0b3JlKSB7XG5cdFx0XHQvLyBDbGVhbnVwIHRoZSBlbnRpcmUgc3RvcmUgaWYgbm8ga2V5cyBhcmUgcHJvdmlkZWQuXG5cdFx0XHRpZiAoIWtleXMpIHtcblx0XHRcdFx0ZGVsZXRlIGNhY2hlW2lkXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQuZWFjaChrZXlzLCBmdW5jdGlvbihfLCBrZXkpIHtcblx0XHRcdFx0XHRkZWxldGUgc3RvcmVba2V5XTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdC8qIGpRdWVyeSAqL1xuXHQkLmV4dGVuZCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBzcmMsIGNvcHlJc0FycmF5LCBjb3B5LCBuYW1lLCBvcHRpb25zLCBjbG9uZSxcblx0XHRcdFx0dGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LFxuXHRcdFx0XHRpID0gMSxcblx0XHRcdFx0bGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCxcblx0XHRcdFx0ZGVlcCA9IGZhbHNlO1xuXG5cdFx0aWYgKHR5cGVvZiB0YXJnZXQgPT09IFwiYm9vbGVhblwiKSB7XG5cdFx0XHRkZWVwID0gdGFyZ2V0O1xuXG5cdFx0XHR0YXJnZXQgPSBhcmd1bWVudHNbaV0gfHwge307XG5cdFx0XHRpKys7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiB0YXJnZXQgIT09IFwib2JqZWN0XCIgJiYgJC50eXBlKHRhcmdldCkgIT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0dGFyZ2V0ID0ge307XG5cdFx0fVxuXG5cdFx0aWYgKGkgPT09IGxlbmd0aCkge1xuXHRcdFx0dGFyZ2V0ID0gdGhpcztcblx0XHRcdGktLTtcblx0XHR9XG5cblx0XHRmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRpZiAoKG9wdGlvbnMgPSBhcmd1bWVudHNbaV0pKSB7XG5cdFx0XHRcdGZvciAobmFtZSBpbiBvcHRpb25zKSB7XG5cdFx0XHRcdFx0aWYgKCFvcHRpb25zLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0c3JjID0gdGFyZ2V0W25hbWVdO1xuXHRcdFx0XHRcdGNvcHkgPSBvcHRpb25zW25hbWVdO1xuXG5cdFx0XHRcdFx0aWYgKHRhcmdldCA9PT0gY29weSkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKGRlZXAgJiYgY29weSAmJiAoJC5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9ICQuaXNBcnJheShjb3B5KSkpKSB7XG5cdFx0XHRcdFx0XHRpZiAoY29weUlzQXJyYXkpIHtcblx0XHRcdFx0XHRcdFx0Y29weUlzQXJyYXkgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0Y2xvbmUgPSBzcmMgJiYgJC5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTtcblxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y2xvbmUgPSBzcmMgJiYgJC5pc1BsYWluT2JqZWN0KHNyYykgPyBzcmMgOiB7fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dGFyZ2V0W25hbWVdID0gJC5leHRlbmQoZGVlcCwgY2xvbmUsIGNvcHkpO1xuXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChjb3B5ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdHRhcmdldFtuYW1lXSA9IGNvcHk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRhcmdldDtcblx0fTtcblxuXHQvKiBqUXVlcnkgMS40LjMgKi9cblx0JC5xdWV1ZSA9IGZ1bmN0aW9uKGVsZW0sIHR5cGUsIGRhdGEpIHtcblx0XHRmdW5jdGlvbiAkbWFrZUFycmF5KGFyciwgcmVzdWx0cykge1xuXHRcdFx0dmFyIHJldCA9IHJlc3VsdHMgfHwgW107XG5cblx0XHRcdGlmIChhcnIpIHtcblx0XHRcdFx0aWYgKGlzQXJyYXlsaWtlKE9iamVjdChhcnIpKSkge1xuXHRcdFx0XHRcdC8qICQubWVyZ2UgKi9cblx0XHRcdFx0XHQoZnVuY3Rpb24oZmlyc3QsIHNlY29uZCkge1xuXHRcdFx0XHRcdFx0dmFyIGxlbiA9ICtzZWNvbmQubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRcdGogPSAwLFxuXHRcdFx0XHRcdFx0XHRcdGkgPSBmaXJzdC5sZW5ndGg7XG5cblx0XHRcdFx0XHRcdHdoaWxlIChqIDwgbGVuKSB7XG5cdFx0XHRcdFx0XHRcdGZpcnN0W2krK10gPSBzZWNvbmRbaisrXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKGxlbiAhPT0gbGVuKSB7XG5cdFx0XHRcdFx0XHRcdHdoaWxlIChzZWNvbmRbal0gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0XHRcdGZpcnN0W2krK10gPSBzZWNvbmRbaisrXTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRmaXJzdC5sZW5ndGggPSBpO1xuXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmlyc3Q7XG5cdFx0XHRcdFx0fSkocmV0LCB0eXBlb2YgYXJyID09PSBcInN0cmluZ1wiID8gW2Fycl0gOiBhcnIpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFtdLnB1c2guY2FsbChyZXQsIGFycik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAoIWVsZW0pIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0eXBlID0gKHR5cGUgfHwgXCJmeFwiKSArIFwicXVldWVcIjtcblxuXHRcdHZhciBxID0gJC5kYXRhKGVsZW0sIHR5cGUpO1xuXG5cdFx0aWYgKCFkYXRhKSB7XG5cdFx0XHRyZXR1cm4gcSB8fCBbXTtcblx0XHR9XG5cblx0XHRpZiAoIXEgfHwgJC5pc0FycmF5KGRhdGEpKSB7XG5cdFx0XHRxID0gJC5kYXRhKGVsZW0sIHR5cGUsICRtYWtlQXJyYXkoZGF0YSkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRxLnB1c2goZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHE7XG5cdH07XG5cblx0LyogalF1ZXJ5IDEuNC4zICovXG5cdCQuZGVxdWV1ZSA9IGZ1bmN0aW9uKGVsZW1zLCB0eXBlKSB7XG5cdFx0LyogQ3VzdG9tOiBFbWJlZCBlbGVtZW50IGl0ZXJhdGlvbi4gKi9cblx0XHQkLmVhY2goZWxlbXMubm9kZVR5cGUgPyBbZWxlbXNdIDogZWxlbXMsIGZ1bmN0aW9uKGksIGVsZW0pIHtcblx0XHRcdHR5cGUgPSB0eXBlIHx8IFwiZnhcIjtcblxuXHRcdFx0dmFyIHF1ZXVlID0gJC5xdWV1ZShlbGVtLCB0eXBlKSxcblx0XHRcdFx0XHRmbiA9IHF1ZXVlLnNoaWZ0KCk7XG5cblx0XHRcdGlmIChmbiA9PT0gXCJpbnByb2dyZXNzXCIpIHtcblx0XHRcdFx0Zm4gPSBxdWV1ZS5zaGlmdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZm4pIHtcblx0XHRcdFx0aWYgKHR5cGUgPT09IFwiZnhcIikge1xuXHRcdFx0XHRcdHF1ZXVlLnVuc2hpZnQoXCJpbnByb2dyZXNzXCIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm4uY2FsbChlbGVtLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkLmRlcXVldWUoZWxlbSwgdHlwZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdC8qKioqKioqKioqKioqKioqKipcblx0ICQuZm4gTWV0aG9kc1xuXHQgKioqKioqKioqKioqKioqKioqL1xuXG5cdC8qIGpRdWVyeSAqL1xuXHQkLmZuID0gJC5wcm90b3R5cGUgPSB7XG5cdFx0aW5pdDogZnVuY3Rpb24oc2VsZWN0b3IpIHtcblx0XHRcdC8qIEp1c3QgcmV0dXJuIHRoZSBlbGVtZW50IHdyYXBwZWQgaW5zaWRlIGFuIGFycmF5OyBkb24ndCBwcm9jZWVkIHdpdGggdGhlIGFjdHVhbCBqUXVlcnkgbm9kZSB3cmFwcGluZyBwcm9jZXNzLiAqL1xuXHRcdFx0aWYgKHNlbGVjdG9yLm5vZGVUeXBlKSB7XG5cdFx0XHRcdHRoaXNbMF0gPSBzZWxlY3RvcjtcblxuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBhIERPTSBub2RlLlwiKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9mZnNldDogZnVuY3Rpb24oKSB7XG5cdFx0XHQvKiBqUXVlcnkgYWx0ZXJlZCBjb2RlOiBEcm9wcGVkIGRpc2Nvbm5lY3RlZCBET00gbm9kZSBjaGVja2luZy4gKi9cblx0XHRcdHZhciBib3ggPSB0aGlzWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCA/IHRoaXNbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiB7dG9wOiAwLCBsZWZ0OiAwfTtcblxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0dG9wOiBib3gudG9wICsgKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5zY3JvbGxUb3AgfHwgMCkgLSAoZG9jdW1lbnQuY2xpZW50VG9wIHx8IDApLFxuXHRcdFx0XHRsZWZ0OiBib3gubGVmdCArICh3aW5kb3cucGFnZVhPZmZzZXQgfHwgZG9jdW1lbnQuc2Nyb2xsTGVmdCB8fCAwKSAtIChkb2N1bWVudC5jbGllbnRMZWZ0IHx8IDApXG5cdFx0XHR9O1xuXHRcdH0sXG5cdFx0cG9zaXRpb246IGZ1bmN0aW9uKCkge1xuXHRcdFx0LyogalF1ZXJ5ICovXG5cdFx0XHRmdW5jdGlvbiBvZmZzZXRQYXJlbnRGbihlbGVtKSB7XG5cdFx0XHRcdHZhciBvZmZzZXRQYXJlbnQgPSBlbGVtLm9mZnNldFBhcmVudCB8fCBkb2N1bWVudDtcblxuXHRcdFx0XHR3aGlsZSAob2Zmc2V0UGFyZW50ICYmIChvZmZzZXRQYXJlbnQubm9kZVR5cGUudG9Mb3dlckNhc2UgIT09IFwiaHRtbFwiICYmIG9mZnNldFBhcmVudC5zdHlsZS5wb3NpdGlvbiA9PT0gXCJzdGF0aWNcIikpIHtcblx0XHRcdFx0XHRvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudDtcblx0XHRcdH1cblxuXHRcdFx0LyogWmVwdG8gKi9cblx0XHRcdHZhciBlbGVtID0gdGhpc1swXSxcblx0XHRcdFx0XHRvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnRGbihlbGVtKSxcblx0XHRcdFx0XHRvZmZzZXQgPSB0aGlzLm9mZnNldCgpLFxuXHRcdFx0XHRcdHBhcmVudE9mZnNldCA9IC9eKD86Ym9keXxodG1sKSQvaS50ZXN0KG9mZnNldFBhcmVudC5ub2RlTmFtZSkgPyB7dG9wOiAwLCBsZWZ0OiAwfSA6ICQob2Zmc2V0UGFyZW50KS5vZmZzZXQoKTtcblxuXHRcdFx0b2Zmc2V0LnRvcCAtPSBwYXJzZUZsb2F0KGVsZW0uc3R5bGUubWFyZ2luVG9wKSB8fCAwO1xuXHRcdFx0b2Zmc2V0LmxlZnQgLT0gcGFyc2VGbG9hdChlbGVtLnN0eWxlLm1hcmdpbkxlZnQpIHx8IDA7XG5cblx0XHRcdGlmIChvZmZzZXRQYXJlbnQuc3R5bGUpIHtcblx0XHRcdFx0cGFyZW50T2Zmc2V0LnRvcCArPSBwYXJzZUZsb2F0KG9mZnNldFBhcmVudC5zdHlsZS5ib3JkZXJUb3BXaWR0aCkgfHwgMDtcblx0XHRcdFx0cGFyZW50T2Zmc2V0LmxlZnQgKz0gcGFyc2VGbG9hdChvZmZzZXRQYXJlbnQuc3R5bGUuYm9yZGVyTGVmdFdpZHRoKSB8fCAwO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR0b3A6IG9mZnNldC50b3AgLSBwYXJlbnRPZmZzZXQudG9wLFxuXHRcdFx0XHRsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0XG5cdFx0XHR9O1xuXHRcdH1cblx0fTtcblxuXHQvKioqKioqKioqKioqKioqKioqKioqKlxuXHQgUHJpdmF0ZSBWYXJpYWJsZXNcblx0ICoqKioqKioqKioqKioqKioqKioqKiovXG5cblx0LyogRm9yICQuZGF0YSgpICovXG5cdHZhciBjYWNoZSA9IHt9O1xuXHQkLmV4cGFuZG8gPSBcInZlbG9jaXR5XCIgKyAobmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuXHQkLnV1aWQgPSAwO1xuXG5cdC8qIEZvciAkLnF1ZXVlKCkgKi9cblx0dmFyIGNsYXNzMnR5cGUgPSB7fSxcblx0XHRcdGhhc093biA9IGNsYXNzMnR5cGUuaGFzT3duUHJvcGVydHksXG5cdFx0XHR0b1N0cmluZyA9IGNsYXNzMnR5cGUudG9TdHJpbmc7XG5cblx0dmFyIHR5cGVzID0gXCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yXCIuc3BsaXQoXCIgXCIpO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2xhc3MydHlwZVtcIltvYmplY3QgXCIgKyB0eXBlc1tpXSArIFwiXVwiXSA9IHR5cGVzW2ldLnRvTG93ZXJDYXNlKCk7XG5cdH1cblxuXHQvKiBNYWtlcyAkKG5vZGUpIHBvc3NpYmxlLCB3aXRob3V0IGhhdmluZyB0byBjYWxsIGluaXQuICovXG5cdCQuZm4uaW5pdC5wcm90b3R5cGUgPSAkLmZuO1xuXG5cdC8qIEdsb2JhbGl6ZSBWZWxvY2l0eSBvbnRvIHRoZSB3aW5kb3csIGFuZCBhc3NpZ24gaXRzIFV0aWxpdGllcyBwcm9wZXJ0eS4gKi9cblx0d2luZG93LlZlbG9jaXR5ID0ge1V0aWxpdGllczogJH07XG59KSh3aW5kb3cpO1xuXG4vKioqKioqKioqKioqKioqKioqXG4gVmVsb2NpdHkuanNcbiAqKioqKioqKioqKioqKioqKiovXG5cbihmdW5jdGlvbihmYWN0b3J5KSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXHQvKiBDb21tb25KUyBtb2R1bGUuICovXG5cdGlmICh0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUuZXhwb3J0cyA9PT0gXCJvYmplY3RcIikge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRcdC8qIEFNRCBtb2R1bGUuICovXG5cdH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcblx0XHRkZWZpbmUoZmFjdG9yeSk7XG5cdFx0LyogQnJvd3NlciBnbG9iYWxzLiAqL1xuXHR9IGVsc2Uge1xuXHRcdGZhY3RvcnkoKTtcblx0fVxufShmdW5jdGlvbigpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdHJldHVybiBmdW5jdGlvbihnbG9iYWwsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG5cdFx0LyoqKioqKioqKioqKioqKlxuXHRcdCBTdW1tYXJ5XG5cdFx0ICoqKioqKioqKioqKioqKi9cblxuXHRcdC8qXG5cdFx0IC0gQ1NTOiBDU1Mgc3RhY2sgdGhhdCB3b3JrcyBpbmRlcGVuZGVudGx5IGZyb20gdGhlIHJlc3Qgb2YgVmVsb2NpdHkuXG5cdFx0IC0gYW5pbWF0ZSgpOiBDb3JlIGFuaW1hdGlvbiBtZXRob2QgdGhhdCBpdGVyYXRlcyBvdmVyIHRoZSB0YXJnZXRlZCBlbGVtZW50cyBhbmQgcXVldWVzIHRoZSBpbmNvbWluZyBjYWxsIG9udG8gZWFjaCBlbGVtZW50IGluZGl2aWR1YWxseS5cblx0XHQgLSBQcmUtUXVldWVpbmc6IFByZXBhcmUgdGhlIGVsZW1lbnQgZm9yIGFuaW1hdGlvbiBieSBpbnN0YW50aWF0aW5nIGl0cyBkYXRhIGNhY2hlIGFuZCBwcm9jZXNzaW5nIHRoZSBjYWxsJ3Mgb3B0aW9ucy5cblx0XHQgLSBRdWV1ZWluZzogVGhlIGxvZ2ljIHRoYXQgcnVucyBvbmNlIHRoZSBjYWxsIGhhcyByZWFjaGVkIGl0cyBwb2ludCBvZiBleGVjdXRpb24gaW4gdGhlIGVsZW1lbnQncyAkLnF1ZXVlKCkgc3RhY2suXG5cdFx0IE1vc3QgbG9naWMgaXMgcGxhY2VkIGhlcmUgdG8gYXZvaWQgcmlza2luZyBpdCBiZWNvbWluZyBzdGFsZSAoaWYgdGhlIGVsZW1lbnQncyBwcm9wZXJ0aWVzIGhhdmUgY2hhbmdlZCkuXG5cdFx0IC0gUHVzaGluZzogQ29uc29saWRhdGlvbiBvZiB0aGUgdHdlZW4gZGF0YSBmb2xsb3dlZCBieSBpdHMgcHVzaCBvbnRvIHRoZSBnbG9iYWwgaW4tcHJvZ3Jlc3MgY2FsbHMgY29udGFpbmVyLlxuXHRcdCAtIHRpY2soKTogVGhlIHNpbmdsZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgbG9vcCByZXNwb25zaWJsZSBmb3IgdHdlZW5pbmcgYWxsIGluLXByb2dyZXNzIGNhbGxzLlxuXHRcdCAtIGNvbXBsZXRlQ2FsbCgpOiBIYW5kbGVzIHRoZSBjbGVhbnVwIHByb2Nlc3MgZm9yIGVhY2ggVmVsb2NpdHkgY2FsbC5cblx0XHQgKi9cblxuXHRcdC8qKioqKioqKioqKioqKioqKioqKipcblx0XHQgSGVscGVyIEZ1bmN0aW9uc1xuXHRcdCAqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHQvKiBJRSBkZXRlY3Rpb24uIEdpc3Q6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2p1bGlhbnNoYXBpcm8vOTA5ODYwOSAqL1xuXHRcdHZhciBJRSA9IChmdW5jdGlvbigpIHtcblx0XHRcdGlmIChkb2N1bWVudC5kb2N1bWVudE1vZGUpIHtcblx0XHRcdFx0cmV0dXJuIGRvY3VtZW50LmRvY3VtZW50TW9kZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZvciAodmFyIGkgPSA3OyBpID4gNDsgaS0tKSB7XG5cdFx0XHRcdFx0dmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRcdFx0XHRkaXYuaW5uZXJIVE1MID0gXCI8IS0tW2lmIElFIFwiICsgaSArIFwiXT48c3Bhbj48L3NwYW4+PCFbZW5kaWZdLS0+XCI7XG5cblx0XHRcdFx0XHRpZiAoZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3BhblwiKS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdGRpdiA9IG51bGw7XG5cblx0XHRcdFx0XHRcdHJldHVybiBpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHRcdH0pKCk7XG5cblx0XHQvKiByQUYgc2hpbS4gR2lzdDogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vanVsaWFuc2hhcGlyby85NDk3NTEzICovXG5cdFx0dmFyIHJBRlNoaW0gPSAoZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGltZUxhc3QgPSAwO1xuXG5cdFx0XHRyZXR1cm4gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdHZhciB0aW1lQ3VycmVudCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCksXG5cdFx0XHRcdFx0XHR0aW1lRGVsdGE7XG5cblx0XHRcdFx0LyogRHluYW1pY2FsbHkgc2V0IGRlbGF5IG9uIGEgcGVyLXRpY2sgYmFzaXMgdG8gbWF0Y2ggNjBmcHMuICovXG5cdFx0XHRcdC8qIFRlY2huaXF1ZSBieSBFcmlrIE1vbGxlci4gTUlUIGxpY2Vuc2U6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC8xNTc5NjcxICovXG5cdFx0XHRcdHRpbWVEZWx0YSA9IE1hdGgubWF4KDAsIDE2IC0gKHRpbWVDdXJyZW50IC0gdGltZUxhc3QpKTtcblx0XHRcdFx0dGltZUxhc3QgPSB0aW1lQ3VycmVudCArIHRpbWVEZWx0YTtcblxuXHRcdFx0XHRyZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRjYWxsYmFjayh0aW1lQ3VycmVudCArIHRpbWVEZWx0YSk7XG5cdFx0XHRcdH0sIHRpbWVEZWx0YSk7XG5cdFx0XHR9O1xuXHRcdH0pKCk7XG5cblx0XHQvKiBBcnJheSBjb21wYWN0aW5nLiBDb3B5cmlnaHQgTG8tRGFzaC4gTUlUIExpY2Vuc2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9sb2Rhc2gvbG9kYXNoL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0ICovXG5cdFx0ZnVuY3Rpb24gY29tcGFjdFNwYXJzZUFycmF5KGFycmF5KSB7XG5cdFx0XHR2YXIgaW5kZXggPSAtMSxcblx0XHRcdFx0XHRsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDAsXG5cdFx0XHRcdFx0cmVzdWx0ID0gW107XG5cblx0XHRcdHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTtcblxuXHRcdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0XHRyZXN1bHQucHVzaCh2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzYW5pdGl6ZUVsZW1lbnRzKGVsZW1lbnRzKSB7XG5cdFx0XHQvKiBVbndyYXAgalF1ZXJ5L1plcHRvIG9iamVjdHMuICovXG5cdFx0XHRpZiAoVHlwZS5pc1dyYXBwZWQoZWxlbWVudHMpKSB7XG5cdFx0XHRcdGVsZW1lbnRzID0gW10uc2xpY2UuY2FsbChlbGVtZW50cyk7XG5cdFx0XHRcdC8qIFdyYXAgYSBzaW5nbGUgZWxlbWVudCBpbiBhbiBhcnJheSBzbyB0aGF0ICQuZWFjaCgpIGNhbiBpdGVyYXRlIHdpdGggdGhlIGVsZW1lbnQgaW5zdGVhZCBvZiBpdHMgbm9kZSdzIGNoaWxkcmVuLiAqL1xuXHRcdFx0fSBlbHNlIGlmIChUeXBlLmlzTm9kZShlbGVtZW50cykpIHtcblx0XHRcdFx0ZWxlbWVudHMgPSBbZWxlbWVudHNdO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxlbWVudHM7XG5cdFx0fVxuXG5cdFx0dmFyIFR5cGUgPSB7XG5cdFx0XHRpc1N0cmluZzogZnVuY3Rpb24odmFyaWFibGUpIHtcblx0XHRcdFx0cmV0dXJuICh0eXBlb2YgdmFyaWFibGUgPT09IFwic3RyaW5nXCIpO1xuXHRcdFx0fSxcblx0XHRcdGlzQXJyYXk6IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24odmFyaWFibGUpIHtcblx0XHRcdFx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YXJpYWJsZSkgPT09IFwiW29iamVjdCBBcnJheV1cIjtcblx0XHRcdH0sXG5cdFx0XHRpc0Z1bmN0aW9uOiBmdW5jdGlvbih2YXJpYWJsZSkge1xuXHRcdFx0XHRyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhcmlhYmxlKSA9PT0gXCJbb2JqZWN0IEZ1bmN0aW9uXVwiO1xuXHRcdFx0fSxcblx0XHRcdGlzTm9kZTogZnVuY3Rpb24odmFyaWFibGUpIHtcblx0XHRcdFx0cmV0dXJuIHZhcmlhYmxlICYmIHZhcmlhYmxlLm5vZGVUeXBlO1xuXHRcdFx0fSxcblx0XHRcdC8qIENvcHlyaWdodCBNYXJ0aW4gQm9obS4gTUlUIExpY2Vuc2U6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL1RvbWFsYWsvODE4YTc4YTIyNmEwNzM4ZWFhZGUgKi9cblx0XHRcdGlzTm9kZUxpc3Q6IGZ1bmN0aW9uKHZhcmlhYmxlKSB7XG5cdFx0XHRcdHJldHVybiB0eXBlb2YgdmFyaWFibGUgPT09IFwib2JqZWN0XCIgJiZcblx0XHRcdFx0XHRcdC9eXFxbb2JqZWN0IChIVE1MQ29sbGVjdGlvbnxOb2RlTGlzdHxPYmplY3QpXFxdJC8udGVzdChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFyaWFibGUpKSAmJlxuXHRcdFx0XHRcdFx0dmFyaWFibGUubGVuZ3RoICE9PSB1bmRlZmluZWQgJiZcblx0XHRcdFx0XHRcdCh2YXJpYWJsZS5sZW5ndGggPT09IDAgfHwgKHR5cGVvZiB2YXJpYWJsZVswXSA9PT0gXCJvYmplY3RcIiAmJiB2YXJpYWJsZVswXS5ub2RlVHlwZSA+IDApKTtcblx0XHRcdH0sXG5cdFx0XHQvKiBEZXRlcm1pbmUgaWYgdmFyaWFibGUgaXMgYSB3cmFwcGVkIGpRdWVyeSBvciBaZXB0byBlbGVtZW50LiAqL1xuXHRcdFx0aXNXcmFwcGVkOiBmdW5jdGlvbih2YXJpYWJsZSkge1xuXHRcdFx0XHRyZXR1cm4gdmFyaWFibGUgJiYgKHZhcmlhYmxlLmpxdWVyeSB8fCAod2luZG93LlplcHRvICYmIHdpbmRvdy5aZXB0by56ZXB0by5pc1oodmFyaWFibGUpKSk7XG5cdFx0XHR9LFxuXHRcdFx0aXNTVkc6IGZ1bmN0aW9uKHZhcmlhYmxlKSB7XG5cdFx0XHRcdHJldHVybiB3aW5kb3cuU1ZHRWxlbWVudCAmJiAodmFyaWFibGUgaW5zdGFuY2VvZiB3aW5kb3cuU1ZHRWxlbWVudCk7XG5cdFx0XHR9LFxuXHRcdFx0aXNFbXB0eU9iamVjdDogZnVuY3Rpb24odmFyaWFibGUpIHtcblx0XHRcdFx0Zm9yICh2YXIgbmFtZSBpbiB2YXJpYWJsZSkge1xuXHRcdFx0XHRcdGlmICh2YXJpYWJsZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKioqKioqKioqKioqKioqKipcblx0XHQgRGVwZW5kZW5jaWVzXG5cdFx0ICoqKioqKioqKioqKioqKioqL1xuXG5cdFx0dmFyICQsXG5cdFx0XHRcdGlzSlF1ZXJ5ID0gZmFsc2U7XG5cblx0XHRpZiAoZ2xvYmFsLmZuICYmIGdsb2JhbC5mbi5qcXVlcnkpIHtcblx0XHRcdCQgPSBnbG9iYWw7XG5cdFx0XHRpc0pRdWVyeSA9IHRydWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQgPSB3aW5kb3cuVmVsb2NpdHkuVXRpbGl0aWVzO1xuXHRcdH1cblxuXHRcdGlmIChJRSA8PSA4ICYmICFpc0pRdWVyeSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiVmVsb2NpdHk6IElFOCBhbmQgYmVsb3cgcmVxdWlyZSBqUXVlcnkgdG8gYmUgbG9hZGVkIGJlZm9yZSBWZWxvY2l0eS5cIik7XG5cdFx0fSBlbHNlIGlmIChJRSA8PSA3KSB7XG5cdFx0XHQvKiBSZXZlcnQgdG8galF1ZXJ5J3MgJC5hbmltYXRlKCksIGFuZCBsb3NlIFZlbG9jaXR5J3MgZXh0cmEgZmVhdHVyZXMuICovXG5cdFx0XHRqUXVlcnkuZm4udmVsb2NpdHkgPSBqUXVlcnkuZm4uYW5pbWF0ZTtcblxuXHRcdFx0LyogTm93IHRoYXQgJC5mbi52ZWxvY2l0eSBpcyBhbGlhc2VkLCBhYm9ydCB0aGlzIFZlbG9jaXR5IGRlY2xhcmF0aW9uLiAqL1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8qKioqKioqKioqKioqKioqKlxuXHRcdCBDb25zdGFudHNcblx0XHQgKioqKioqKioqKioqKioqKiovXG5cblx0XHR2YXIgRFVSQVRJT05fREVGQVVMVCA9IDQwMCxcblx0XHRcdFx0RUFTSU5HX0RFRkFVTFQgPSBcInN3aW5nXCI7XG5cblx0XHQvKioqKioqKioqKioqKlxuXHRcdCBTdGF0ZVxuXHRcdCAqKioqKioqKioqKioqL1xuXG5cdFx0dmFyIFZlbG9jaXR5ID0ge1xuXHRcdFx0LyogQ29udGFpbmVyIGZvciBwYWdlLXdpZGUgVmVsb2NpdHkgc3RhdGUgZGF0YS4gKi9cblx0XHRcdFN0YXRlOiB7XG5cdFx0XHRcdC8qIERldGVjdCBtb2JpbGUgZGV2aWNlcyB0byBkZXRlcm1pbmUgaWYgbW9iaWxlSEEgc2hvdWxkIGJlIHR1cm5lZCBvbi4gKi9cblx0XHRcdFx0aXNNb2JpbGU6IC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxcblx0XHRcdFx0LyogVGhlIG1vYmlsZUhBIG9wdGlvbidzIGJlaGF2aW9yIGNoYW5nZXMgb24gb2xkZXIgQW5kcm9pZCBkZXZpY2VzIChHaW5nZXJicmVhZCwgdmVyc2lvbnMgMi4zLjMtMi4zLjcpLiAqL1xuXHRcdFx0XHRpc0FuZHJvaWQ6IC9BbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxcblx0XHRcdFx0aXNHaW5nZXJicmVhZDogL0FuZHJvaWQgMlxcLjNcXC5bMy03XS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksXG5cdFx0XHRcdGlzQ2hyb21lOiB3aW5kb3cuY2hyb21lLFxuXHRcdFx0XHRpc0ZpcmVmb3g6IC9GaXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSxcblx0XHRcdFx0LyogQ3JlYXRlIGEgY2FjaGVkIGVsZW1lbnQgZm9yIHJlLXVzZSB3aGVuIGNoZWNraW5nIGZvciBDU1MgcHJvcGVydHkgcHJlZml4ZXMuICovXG5cdFx0XHRcdHByZWZpeEVsZW1lbnQ6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdFx0XHRcdC8qIENhY2hlIGV2ZXJ5IHByZWZpeCBtYXRjaCB0byBhdm9pZCByZXBlYXRpbmcgbG9va3Vwcy4gKi9cblx0XHRcdFx0cHJlZml4TWF0Y2hlczoge30sXG5cdFx0XHRcdC8qIENhY2hlIHRoZSBhbmNob3IgdXNlZCBmb3IgYW5pbWF0aW5nIHdpbmRvdyBzY3JvbGxpbmcuICovXG5cdFx0XHRcdHNjcm9sbEFuY2hvcjogbnVsbCxcblx0XHRcdFx0LyogQ2FjaGUgdGhlIGJyb3dzZXItc3BlY2lmaWMgcHJvcGVydHkgbmFtZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzY3JvbGwgYW5jaG9yLiAqL1xuXHRcdFx0XHRzY3JvbGxQcm9wZXJ0eUxlZnQ6IG51bGwsXG5cdFx0XHRcdHNjcm9sbFByb3BlcnR5VG9wOiBudWxsLFxuXHRcdFx0XHQvKiBLZWVwIHRyYWNrIG9mIHdoZXRoZXIgb3VyIFJBRiB0aWNrIGlzIHJ1bm5pbmcuICovXG5cdFx0XHRcdGlzVGlja2luZzogZmFsc2UsXG5cdFx0XHRcdC8qIENvbnRhaW5lciBmb3IgZXZlcnkgaW4tcHJvZ3Jlc3MgY2FsbCB0byBWZWxvY2l0eS4gKi9cblx0XHRcdFx0Y2FsbHM6IFtdXG5cdFx0XHR9LFxuXHRcdFx0LyogVmVsb2NpdHkncyBjdXN0b20gQ1NTIHN0YWNrLiBNYWRlIGdsb2JhbCBmb3IgdW5pdCB0ZXN0aW5nLiAqL1xuXHRcdFx0Q1NTOiB7IC8qIERlZmluZWQgYmVsb3cuICovfSxcblx0XHRcdC8qIEEgc2hpbSBvZiB0aGUgalF1ZXJ5IHV0aWxpdHkgZnVuY3Rpb25zIHVzZWQgYnkgVmVsb2NpdHkgLS0gcHJvdmlkZWQgYnkgVmVsb2NpdHkncyBvcHRpb25hbCBqUXVlcnkgc2hpbS4gKi9cblx0XHRcdFV0aWxpdGllczogJCxcblx0XHRcdC8qIENvbnRhaW5lciBmb3IgdGhlIHVzZXIncyBjdXN0b20gYW5pbWF0aW9uIHJlZGlyZWN0cyB0aGF0IGFyZSByZWZlcmVuY2VkIGJ5IG5hbWUgaW4gcGxhY2Ugb2YgdGhlIHByb3BlcnRpZXMgbWFwIGFyZ3VtZW50LiAqL1xuXHRcdFx0UmVkaXJlY3RzOiB7IC8qIE1hbnVhbGx5IHJlZ2lzdGVyZWQgYnkgdGhlIHVzZXIuICovfSxcblx0XHRcdEVhc2luZ3M6IHsgLyogRGVmaW5lZCBiZWxvdy4gKi99LFxuXHRcdFx0LyogQXR0ZW1wdCB0byB1c2UgRVM2IFByb21pc2VzIGJ5IGRlZmF1bHQuIFVzZXJzIGNhbiBvdmVycmlkZSB0aGlzIHdpdGggYSB0aGlyZC1wYXJ0eSBwcm9taXNlcyBsaWJyYXJ5LiAqL1xuXHRcdFx0UHJvbWlzZTogd2luZG93LlByb21pc2UsXG5cdFx0XHQvKiBWZWxvY2l0eSBvcHRpb24gZGVmYXVsdHMsIHdoaWNoIGNhbiBiZSBvdmVycmlkZW4gYnkgdGhlIHVzZXIuICovXG5cdFx0XHRkZWZhdWx0czoge1xuXHRcdFx0XHRxdWV1ZTogXCJcIixcblx0XHRcdFx0ZHVyYXRpb246IERVUkFUSU9OX0RFRkFVTFQsXG5cdFx0XHRcdGVhc2luZzogRUFTSU5HX0RFRkFVTFQsXG5cdFx0XHRcdGJlZ2luOiB1bmRlZmluZWQsXG5cdFx0XHRcdGNvbXBsZXRlOiB1bmRlZmluZWQsXG5cdFx0XHRcdHByb2dyZXNzOiB1bmRlZmluZWQsXG5cdFx0XHRcdGRpc3BsYXk6IHVuZGVmaW5lZCxcblx0XHRcdFx0dmlzaWJpbGl0eTogdW5kZWZpbmVkLFxuXHRcdFx0XHRsb29wOiBmYWxzZSxcblx0XHRcdFx0ZGVsYXk6IGZhbHNlLFxuXHRcdFx0XHRtb2JpbGVIQTogdHJ1ZSxcblx0XHRcdFx0LyogQWR2YW5jZWQ6IFNldCB0byBmYWxzZSB0byBwcmV2ZW50IHByb3BlcnR5IHZhbHVlcyBmcm9tIGJlaW5nIGNhY2hlZCBiZXR3ZWVuIGNvbnNlY3V0aXZlIFZlbG9jaXR5LWluaXRpYXRlZCBjaGFpbiBjYWxscy4gKi9cblx0XHRcdFx0X2NhY2hlVmFsdWVzOiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0LyogQSBkZXNpZ24gZ29hbCBvZiBWZWxvY2l0eSBpcyB0byBjYWNoZSBkYXRhIHdoZXJldmVyIHBvc3NpYmxlIGluIG9yZGVyIHRvIGF2b2lkIERPTSByZXF1ZXJ5aW5nLiBBY2NvcmRpbmdseSwgZWFjaCBlbGVtZW50IGhhcyBhIGRhdGEgY2FjaGUuICovXG5cdFx0XHRpbml0OiBmdW5jdGlvbihlbGVtZW50KSB7XG5cdFx0XHRcdCQuZGF0YShlbGVtZW50LCBcInZlbG9jaXR5XCIsIHtcblx0XHRcdFx0XHQvKiBTdG9yZSB3aGV0aGVyIHRoaXMgaXMgYW4gU1ZHIGVsZW1lbnQsIHNpbmNlIGl0cyBwcm9wZXJ0aWVzIGFyZSByZXRyaWV2ZWQgYW5kIHVwZGF0ZWQgZGlmZmVyZW50bHkgdGhhbiBzdGFuZGFyZCBIVE1MIGVsZW1lbnRzLiAqL1xuXHRcdFx0XHRcdGlzU1ZHOiBUeXBlLmlzU1ZHKGVsZW1lbnQpLFxuXHRcdFx0XHRcdC8qIEtlZXAgdHJhY2sgb2Ygd2hldGhlciB0aGUgZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgYW5pbWF0ZWQgYnkgVmVsb2NpdHkuXG5cdFx0XHRcdFx0IFRoaXMgaXMgdXNlZCB0byBlbnN1cmUgdGhhdCBwcm9wZXJ0eSB2YWx1ZXMgYXJlIG5vdCB0cmFuc2ZlcnJlZCBiZXR3ZWVuIG5vbi1jb25zZWN1dGl2ZSAoc3RhbGUpIGNhbGxzLiAqL1xuXHRcdFx0XHRcdGlzQW5pbWF0aW5nOiBmYWxzZSxcblx0XHRcdFx0XHQvKiBBIHJlZmVyZW5jZSB0byB0aGUgZWxlbWVudCdzIGxpdmUgY29tcHV0ZWRTdHlsZSBvYmplY3QuIExlYXJuIG1vcmUgaGVyZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvQVBJL3dpbmRvdy5nZXRDb21wdXRlZFN0eWxlICovXG5cdFx0XHRcdFx0Y29tcHV0ZWRTdHlsZTogbnVsbCxcblx0XHRcdFx0XHQvKiBUd2VlbiBkYXRhIGlzIGNhY2hlZCBmb3IgZWFjaCBhbmltYXRpb24gb24gdGhlIGVsZW1lbnQgc28gdGhhdCBkYXRhIGNhbiBiZSBwYXNzZWQgYWNyb3NzIGNhbGxzIC0tXG5cdFx0XHRcdFx0IGluIHBhcnRpY3VsYXIsIGVuZCB2YWx1ZXMgYXJlIHVzZWQgYXMgc3Vic2VxdWVudCBzdGFydCB2YWx1ZXMgaW4gY29uc2VjdXRpdmUgVmVsb2NpdHkgY2FsbHMuICovXG5cdFx0XHRcdFx0dHdlZW5zQ29udGFpbmVyOiBudWxsLFxuXHRcdFx0XHRcdC8qIFRoZSBmdWxsIHJvb3QgcHJvcGVydHkgdmFsdWVzIG9mIGVhY2ggQ1NTIGhvb2sgYmVpbmcgYW5pbWF0ZWQgb24gdGhpcyBlbGVtZW50IGFyZSBjYWNoZWQgc28gdGhhdDpcblx0XHRcdFx0XHQgMSkgQ29uY3VycmVudGx5LWFuaW1hdGluZyBob29rcyBzaGFyaW5nIHRoZSBzYW1lIHJvb3QgY2FuIGhhdmUgdGhlaXIgcm9vdCB2YWx1ZXMnIG1lcmdlZCBpbnRvIG9uZSB3aGlsZSB0d2VlbmluZy5cblx0XHRcdFx0XHQgMikgUG9zdC1ob29rLWluamVjdGlvbiByb290IHZhbHVlcyBjYW4gYmUgdHJhbnNmZXJyZWQgb3ZlciB0byBjb25zZWN1dGl2ZWx5IGNoYWluZWQgVmVsb2NpdHkgY2FsbHMgYXMgc3RhcnRpbmcgcm9vdCB2YWx1ZXMuICovXG5cdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWVDYWNoZToge30sXG5cdFx0XHRcdFx0LyogQSBjYWNoZSBmb3IgdHJhbnNmb3JtIHVwZGF0ZXMsIHdoaWNoIG11c3QgYmUgbWFudWFsbHkgZmx1c2hlZCB2aWEgQ1NTLmZsdXNoVHJhbnNmb3JtQ2FjaGUoKS4gKi9cblx0XHRcdFx0XHR0cmFuc2Zvcm1DYWNoZToge31cblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0LyogQSBwYXJhbGxlbCB0byBqUXVlcnkncyAkLmNzcygpLCB1c2VkIGZvciBnZXR0aW5nL3NldHRpbmcgVmVsb2NpdHkncyBob29rZWQgQ1NTIHByb3BlcnRpZXMuICovXG5cdFx0XHRob29rOiBudWxsLCAvKiBEZWZpbmVkIGJlbG93LiAqL1xuXHRcdFx0LyogVmVsb2NpdHktd2lkZSBhbmltYXRpb24gdGltZSByZW1hcHBpbmcgZm9yIHRlc3RpbmcgcHVycG9zZXMuICovXG5cdFx0XHRtb2NrOiBmYWxzZSxcblx0XHRcdHZlcnNpb246IHttYWpvcjogMSwgbWlub3I6IDMsIHBhdGNoOiAxfSxcblx0XHRcdC8qIFNldCB0byAxIG9yIDIgKG1vc3QgdmVyYm9zZSkgdG8gb3V0cHV0IGRlYnVnIGluZm8gdG8gY29uc29sZS4gKi9cblx0XHRcdGRlYnVnOiBmYWxzZVxuXHRcdH07XG5cblx0XHQvKiBSZXRyaWV2ZSB0aGUgYXBwcm9wcmlhdGUgc2Nyb2xsIGFuY2hvciBhbmQgcHJvcGVydHkgbmFtZSBmb3IgdGhlIGJyb3dzZXI6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XaW5kb3cuc2Nyb2xsWSAqL1xuXHRcdGlmICh3aW5kb3cucGFnZVlPZmZzZXQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0VmVsb2NpdHkuU3RhdGUuc2Nyb2xsQW5jaG9yID0gd2luZG93O1xuXHRcdFx0VmVsb2NpdHkuU3RhdGUuc2Nyb2xsUHJvcGVydHlMZWZ0ID0gXCJwYWdlWE9mZnNldFwiO1xuXHRcdFx0VmVsb2NpdHkuU3RhdGUuc2Nyb2xsUHJvcGVydHlUb3AgPSBcInBhZ2VZT2Zmc2V0XCI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdFZlbG9jaXR5LlN0YXRlLnNjcm9sbEFuY2hvciA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUgfHwgZG9jdW1lbnQuYm9keTtcblx0XHRcdFZlbG9jaXR5LlN0YXRlLnNjcm9sbFByb3BlcnR5TGVmdCA9IFwic2Nyb2xsTGVmdFwiO1xuXHRcdFx0VmVsb2NpdHkuU3RhdGUuc2Nyb2xsUHJvcGVydHlUb3AgPSBcInNjcm9sbFRvcFwiO1xuXHRcdH1cblxuXHRcdC8qIFNob3J0aGFuZCBhbGlhcyBmb3IgalF1ZXJ5J3MgJC5kYXRhKCkgdXRpbGl0eS4gKi9cblx0XHRmdW5jdGlvbiBEYXRhKGVsZW1lbnQpIHtcblx0XHRcdC8qIEhhcmRjb2RlIGEgcmVmZXJlbmNlIHRvIHRoZSBwbHVnaW4gbmFtZS4gKi9cblx0XHRcdHZhciByZXNwb25zZSA9ICQuZGF0YShlbGVtZW50LCBcInZlbG9jaXR5XCIpO1xuXG5cdFx0XHQvKiBqUXVlcnkgPD0xLjQuMiByZXR1cm5zIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQgd2hlbiBubyBtYXRjaCBpcyBmb3VuZC4gV2Ugbm9ybWFsaXplIHRoaXMgYmVoYXZpb3IuICovXG5cdFx0XHRyZXR1cm4gcmVzcG9uc2UgPT09IG51bGwgPyB1bmRlZmluZWQgOiByZXNwb25zZTtcblx0XHR9XG5cblx0XHQvKioqKioqKioqKioqKipcblx0XHQgRWFzaW5nXG5cdFx0ICoqKioqKioqKioqKioqL1xuXG5cdFx0LyogU3RlcCBlYXNpbmcgZ2VuZXJhdG9yLiAqL1xuXHRcdGZ1bmN0aW9uIGdlbmVyYXRlU3RlcChzdGVwcykge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKHApIHtcblx0XHRcdFx0cmV0dXJuIE1hdGgucm91bmQocCAqIHN0ZXBzKSAqICgxIC8gc3RlcHMpO1xuXHRcdFx0fTtcblx0XHR9XG5cblx0XHQvKiBCZXppZXIgY3VydmUgZnVuY3Rpb24gZ2VuZXJhdG9yLiBDb3B5cmlnaHQgR2FldGFuIFJlbmF1ZGVhdS4gTUlUIExpY2Vuc2U6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTUlUX0xpY2Vuc2UgKi9cblx0XHRmdW5jdGlvbiBnZW5lcmF0ZUJlemllcihtWDEsIG1ZMSwgbVgyLCBtWTIpIHtcblx0XHRcdHZhciBORVdUT05fSVRFUkFUSU9OUyA9IDQsXG5cdFx0XHRcdFx0TkVXVE9OX01JTl9TTE9QRSA9IDAuMDAxLFxuXHRcdFx0XHRcdFNVQkRJVklTSU9OX1BSRUNJU0lPTiA9IDAuMDAwMDAwMSxcblx0XHRcdFx0XHRTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUyA9IDEwLFxuXHRcdFx0XHRcdGtTcGxpbmVUYWJsZVNpemUgPSAxMSxcblx0XHRcdFx0XHRrU2FtcGxlU3RlcFNpemUgPSAxLjAgLyAoa1NwbGluZVRhYmxlU2l6ZSAtIDEuMCksXG5cdFx0XHRcdFx0ZmxvYXQzMkFycmF5U3VwcG9ydGVkID0gXCJGbG9hdDMyQXJyYXlcIiBpbiB3aW5kb3c7XG5cblx0XHRcdC8qIE11c3QgY29udGFpbiBmb3VyIGFyZ3VtZW50cy4gKi9cblx0XHRcdGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSA0KSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0LyogQXJndW1lbnRzIG11c3QgYmUgbnVtYmVycy4gKi9cblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgNDsgKytpKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgYXJndW1lbnRzW2ldICE9PSBcIm51bWJlclwiIHx8IGlzTmFOKGFyZ3VtZW50c1tpXSkgfHwgIWlzRmluaXRlKGFyZ3VtZW50c1tpXSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0LyogWCB2YWx1ZXMgbXVzdCBiZSBpbiB0aGUgWzAsIDFdIHJhbmdlLiAqL1xuXHRcdFx0bVgxID0gTWF0aC5taW4obVgxLCAxKTtcblx0XHRcdG1YMiA9IE1hdGgubWluKG1YMiwgMSk7XG5cdFx0XHRtWDEgPSBNYXRoLm1heChtWDEsIDApO1xuXHRcdFx0bVgyID0gTWF0aC5tYXgobVgyLCAwKTtcblxuXHRcdFx0dmFyIG1TYW1wbGVWYWx1ZXMgPSBmbG9hdDMyQXJyYXlTdXBwb3J0ZWQgPyBuZXcgRmxvYXQzMkFycmF5KGtTcGxpbmVUYWJsZVNpemUpIDogbmV3IEFycmF5KGtTcGxpbmVUYWJsZVNpemUpO1xuXG5cdFx0XHRmdW5jdGlvbiBBKGFBMSwgYUEyKSB7XG5cdFx0XHRcdHJldHVybiAxLjAgLSAzLjAgKiBhQTIgKyAzLjAgKiBhQTE7XG5cdFx0XHR9XG5cdFx0XHRmdW5jdGlvbiBCKGFBMSwgYUEyKSB7XG5cdFx0XHRcdHJldHVybiAzLjAgKiBhQTIgLSA2LjAgKiBhQTE7XG5cdFx0XHR9XG5cdFx0XHRmdW5jdGlvbiBDKGFBMSkge1xuXHRcdFx0XHRyZXR1cm4gMy4wICogYUExO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBjYWxjQmV6aWVyKGFULCBhQTEsIGFBMikge1xuXHRcdFx0XHRyZXR1cm4gKChBKGFBMSwgYUEyKSAqIGFUICsgQihhQTEsIGFBMikpICogYVQgKyBDKGFBMSkpICogYVQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGdldFNsb3BlKGFULCBhQTEsIGFBMikge1xuXHRcdFx0XHRyZXR1cm4gMy4wICogQShhQTEsIGFBMikgKiBhVCAqIGFUICsgMi4wICogQihhQTEsIGFBMikgKiBhVCArIEMoYUExKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gbmV3dG9uUmFwaHNvbkl0ZXJhdGUoYVgsIGFHdWVzc1QpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBORVdUT05fSVRFUkFUSU9OUzsgKytpKSB7XG5cdFx0XHRcdFx0dmFyIGN1cnJlbnRTbG9wZSA9IGdldFNsb3BlKGFHdWVzc1QsIG1YMSwgbVgyKTtcblxuXHRcdFx0XHRcdGlmIChjdXJyZW50U2xvcGUgPT09IDAuMCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGFHdWVzc1Q7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIGN1cnJlbnRYID0gY2FsY0JlemllcihhR3Vlc3NULCBtWDEsIG1YMikgLSBhWDtcblx0XHRcdFx0XHRhR3Vlc3NUIC09IGN1cnJlbnRYIC8gY3VycmVudFNsb3BlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGFHdWVzc1Q7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGNhbGNTYW1wbGVWYWx1ZXMoKSB7XG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwga1NwbGluZVRhYmxlU2l6ZTsgKytpKSB7XG5cdFx0XHRcdFx0bVNhbXBsZVZhbHVlc1tpXSA9IGNhbGNCZXppZXIoaSAqIGtTYW1wbGVTdGVwU2l6ZSwgbVgxLCBtWDIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGJpbmFyeVN1YmRpdmlkZShhWCwgYUEsIGFCKSB7XG5cdFx0XHRcdHZhciBjdXJyZW50WCwgY3VycmVudFQsIGkgPSAwO1xuXG5cdFx0XHRcdGRvIHtcblx0XHRcdFx0XHRjdXJyZW50VCA9IGFBICsgKGFCIC0gYUEpIC8gMi4wO1xuXHRcdFx0XHRcdGN1cnJlbnRYID0gY2FsY0JlemllcihjdXJyZW50VCwgbVgxLCBtWDIpIC0gYVg7XG5cdFx0XHRcdFx0aWYgKGN1cnJlbnRYID4gMC4wKSB7XG5cdFx0XHRcdFx0XHRhQiA9IGN1cnJlbnRUO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRhQSA9IGN1cnJlbnRUO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSB3aGlsZSAoTWF0aC5hYnMoY3VycmVudFgpID4gU1VCRElWSVNJT05fUFJFQ0lTSU9OICYmICsraSA8IFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TKTtcblxuXHRcdFx0XHRyZXR1cm4gY3VycmVudFQ7XG5cdFx0XHR9XG5cblx0XHRcdGZ1bmN0aW9uIGdldFRGb3JYKGFYKSB7XG5cdFx0XHRcdHZhciBpbnRlcnZhbFN0YXJ0ID0gMC4wLFxuXHRcdFx0XHRcdFx0Y3VycmVudFNhbXBsZSA9IDEsXG5cdFx0XHRcdFx0XHRsYXN0U2FtcGxlID0ga1NwbGluZVRhYmxlU2l6ZSAtIDE7XG5cblx0XHRcdFx0Zm9yICg7IGN1cnJlbnRTYW1wbGUgIT09IGxhc3RTYW1wbGUgJiYgbVNhbXBsZVZhbHVlc1tjdXJyZW50U2FtcGxlXSA8PSBhWDsgKytjdXJyZW50U2FtcGxlKSB7XG5cdFx0XHRcdFx0aW50ZXJ2YWxTdGFydCArPSBrU2FtcGxlU3RlcFNpemU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQtLWN1cnJlbnRTYW1wbGU7XG5cblx0XHRcdFx0dmFyIGRpc3QgPSAoYVggLSBtU2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKSAvIChtU2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGUgKyAxXSAtIG1TYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0pLFxuXHRcdFx0XHRcdFx0Z3Vlc3NGb3JUID0gaW50ZXJ2YWxTdGFydCArIGRpc3QgKiBrU2FtcGxlU3RlcFNpemUsXG5cdFx0XHRcdFx0XHRpbml0aWFsU2xvcGUgPSBnZXRTbG9wZShndWVzc0ZvclQsIG1YMSwgbVgyKTtcblxuXHRcdFx0XHRpZiAoaW5pdGlhbFNsb3BlID49IE5FV1RPTl9NSU5fU0xPUEUpIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3dG9uUmFwaHNvbkl0ZXJhdGUoYVgsIGd1ZXNzRm9yVCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoaW5pdGlhbFNsb3BlID09PSAwLjApIHtcblx0XHRcdFx0XHRyZXR1cm4gZ3Vlc3NGb3JUO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBiaW5hcnlTdWJkaXZpZGUoYVgsIGludGVydmFsU3RhcnQsIGludGVydmFsU3RhcnQgKyBrU2FtcGxlU3RlcFNpemUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHZhciBfcHJlY29tcHV0ZWQgPSBmYWxzZTtcblxuXHRcdFx0ZnVuY3Rpb24gcHJlY29tcHV0ZSgpIHtcblx0XHRcdFx0X3ByZWNvbXB1dGVkID0gdHJ1ZTtcblx0XHRcdFx0aWYgKG1YMSAhPT0gbVkxIHx8IG1YMiAhPT0gbVkyKSB7XG5cdFx0XHRcdFx0Y2FsY1NhbXBsZVZhbHVlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHZhciBmID0gZnVuY3Rpb24oYVgpIHtcblx0XHRcdFx0aWYgKCFfcHJlY29tcHV0ZWQpIHtcblx0XHRcdFx0XHRwcmVjb21wdXRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKG1YMSA9PT0gbVkxICYmIG1YMiA9PT0gbVkyKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGFYO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChhWCA9PT0gMCkge1xuXHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChhWCA9PT0gMSkge1xuXHRcdFx0XHRcdHJldHVybiAxO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGNhbGNCZXppZXIoZ2V0VEZvclgoYVgpLCBtWTEsIG1ZMik7XG5cdFx0XHR9O1xuXG5cdFx0XHRmLmdldENvbnRyb2xQb2ludHMgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIFt7eDogbVgxLCB5OiBtWTF9LCB7eDogbVgyLCB5OiBtWTJ9XTtcblx0XHRcdH07XG5cblx0XHRcdHZhciBzdHIgPSBcImdlbmVyYXRlQmV6aWVyKFwiICsgW21YMSwgbVkxLCBtWDIsIG1ZMl0gKyBcIilcIjtcblx0XHRcdGYudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHN0cjtcblx0XHRcdH07XG5cblx0XHRcdHJldHVybiBmO1xuXHRcdH1cblxuXHRcdC8qIFJ1bmdlLUt1dHRhIHNwcmluZyBwaHlzaWNzIGZ1bmN0aW9uIGdlbmVyYXRvci4gQWRhcHRlZCBmcm9tIEZyYW1lci5qcywgY29weXJpZ2h0IEtvZW4gQm9rLiBNSVQgTGljZW5zZTogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9NSVRfTGljZW5zZSAqL1xuXHRcdC8qIEdpdmVuIGEgdGVuc2lvbiwgZnJpY3Rpb24sIGFuZCBkdXJhdGlvbiwgYSBzaW11bGF0aW9uIGF0IDYwRlBTIHdpbGwgZmlyc3QgcnVuIHdpdGhvdXQgYSBkZWZpbmVkIGR1cmF0aW9uIGluIG9yZGVyIHRvIGNhbGN1bGF0ZSB0aGUgZnVsbCBwYXRoLiBBIHNlY29uZCBwYXNzXG5cdFx0IHRoZW4gYWRqdXN0cyB0aGUgdGltZSBkZWx0YSAtLSB1c2luZyB0aGUgcmVsYXRpb24gYmV0d2VlbiBhY3R1YWwgdGltZSBhbmQgZHVyYXRpb24gLS0gdG8gY2FsY3VsYXRlIHRoZSBwYXRoIGZvciB0aGUgZHVyYXRpb24tY29uc3RyYWluZWQgYW5pbWF0aW9uLiAqL1xuXHRcdHZhciBnZW5lcmF0ZVNwcmluZ1JLNCA9IChmdW5jdGlvbigpIHtcblx0XHRcdGZ1bmN0aW9uIHNwcmluZ0FjY2VsZXJhdGlvbkZvclN0YXRlKHN0YXRlKSB7XG5cdFx0XHRcdHJldHVybiAoLXN0YXRlLnRlbnNpb24gKiBzdGF0ZS54KSAtIChzdGF0ZS5mcmljdGlvbiAqIHN0YXRlLnYpO1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBzcHJpbmdFdmFsdWF0ZVN0YXRlV2l0aERlcml2YXRpdmUoaW5pdGlhbFN0YXRlLCBkdCwgZGVyaXZhdGl2ZSkge1xuXHRcdFx0XHR2YXIgc3RhdGUgPSB7XG5cdFx0XHRcdFx0eDogaW5pdGlhbFN0YXRlLnggKyBkZXJpdmF0aXZlLmR4ICogZHQsXG5cdFx0XHRcdFx0djogaW5pdGlhbFN0YXRlLnYgKyBkZXJpdmF0aXZlLmR2ICogZHQsXG5cdFx0XHRcdFx0dGVuc2lvbjogaW5pdGlhbFN0YXRlLnRlbnNpb24sXG5cdFx0XHRcdFx0ZnJpY3Rpb246IGluaXRpYWxTdGF0ZS5mcmljdGlvblxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHJldHVybiB7ZHg6IHN0YXRlLnYsIGR2OiBzcHJpbmdBY2NlbGVyYXRpb25Gb3JTdGF0ZShzdGF0ZSl9O1xuXHRcdFx0fVxuXG5cdFx0XHRmdW5jdGlvbiBzcHJpbmdJbnRlZ3JhdGVTdGF0ZShzdGF0ZSwgZHQpIHtcblx0XHRcdFx0dmFyIGEgPSB7XG5cdFx0XHRcdFx0ZHg6IHN0YXRlLnYsXG5cdFx0XHRcdFx0ZHY6IHNwcmluZ0FjY2VsZXJhdGlvbkZvclN0YXRlKHN0YXRlKVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRiID0gc3ByaW5nRXZhbHVhdGVTdGF0ZVdpdGhEZXJpdmF0aXZlKHN0YXRlLCBkdCAqIDAuNSwgYSksXG5cdFx0XHRcdFx0XHRjID0gc3ByaW5nRXZhbHVhdGVTdGF0ZVdpdGhEZXJpdmF0aXZlKHN0YXRlLCBkdCAqIDAuNSwgYiksXG5cdFx0XHRcdFx0XHRkID0gc3ByaW5nRXZhbHVhdGVTdGF0ZVdpdGhEZXJpdmF0aXZlKHN0YXRlLCBkdCwgYyksXG5cdFx0XHRcdFx0XHRkeGR0ID0gMS4wIC8gNi4wICogKGEuZHggKyAyLjAgKiAoYi5keCArIGMuZHgpICsgZC5keCksXG5cdFx0XHRcdFx0XHRkdmR0ID0gMS4wIC8gNi4wICogKGEuZHYgKyAyLjAgKiAoYi5kdiArIGMuZHYpICsgZC5kdik7XG5cblx0XHRcdFx0c3RhdGUueCA9IHN0YXRlLnggKyBkeGR0ICogZHQ7XG5cdFx0XHRcdHN0YXRlLnYgPSBzdGF0ZS52ICsgZHZkdCAqIGR0O1xuXG5cdFx0XHRcdHJldHVybiBzdGF0ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uIHNwcmluZ1JLNEZhY3RvcnkodGVuc2lvbiwgZnJpY3Rpb24sIGR1cmF0aW9uKSB7XG5cblx0XHRcdFx0dmFyIGluaXRTdGF0ZSA9IHtcblx0XHRcdFx0XHR4OiAtMSxcblx0XHRcdFx0XHR2OiAwLFxuXHRcdFx0XHRcdHRlbnNpb246IG51bGwsXG5cdFx0XHRcdFx0ZnJpY3Rpb246IG51bGxcblx0XHRcdFx0fSxcblx0XHRcdFx0cGF0aCA9IFswXSxcblx0XHRcdFx0XHRcdHRpbWVfbGFwc2VkID0gMCxcblx0XHRcdFx0XHRcdHRvbGVyYW5jZSA9IDEgLyAxMDAwMCxcblx0XHRcdFx0XHRcdERUID0gMTYgLyAxMDAwLFxuXHRcdFx0XHRcdFx0aGF2ZV9kdXJhdGlvbiwgZHQsIGxhc3Rfc3RhdGU7XG5cblx0XHRcdFx0dGVuc2lvbiA9IHBhcnNlRmxvYXQodGVuc2lvbikgfHwgNTAwO1xuXHRcdFx0XHRmcmljdGlvbiA9IHBhcnNlRmxvYXQoZnJpY3Rpb24pIHx8IDIwO1xuXHRcdFx0XHRkdXJhdGlvbiA9IGR1cmF0aW9uIHx8IG51bGw7XG5cblx0XHRcdFx0aW5pdFN0YXRlLnRlbnNpb24gPSB0ZW5zaW9uO1xuXHRcdFx0XHRpbml0U3RhdGUuZnJpY3Rpb24gPSBmcmljdGlvbjtcblxuXHRcdFx0XHRoYXZlX2R1cmF0aW9uID0gZHVyYXRpb24gIT09IG51bGw7XG5cblx0XHRcdFx0LyogQ2FsY3VsYXRlIHRoZSBhY3R1YWwgdGltZSBpdCB0YWtlcyBmb3IgdGhpcyBhbmltYXRpb24gdG8gY29tcGxldGUgd2l0aCB0aGUgcHJvdmlkZWQgY29uZGl0aW9ucy4gKi9cblx0XHRcdFx0aWYgKGhhdmVfZHVyYXRpb24pIHtcblx0XHRcdFx0XHQvKiBSdW4gdGhlIHNpbXVsYXRpb24gd2l0aG91dCBhIGR1cmF0aW9uLiAqL1xuXHRcdFx0XHRcdHRpbWVfbGFwc2VkID0gc3ByaW5nUks0RmFjdG9yeSh0ZW5zaW9uLCBmcmljdGlvbik7XG5cdFx0XHRcdFx0LyogQ29tcHV0ZSB0aGUgYWRqdXN0ZWQgdGltZSBkZWx0YS4gKi9cblx0XHRcdFx0XHRkdCA9IHRpbWVfbGFwc2VkIC8gZHVyYXRpb24gKiBEVDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRkdCA9IERUO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0d2hpbGUgKHRydWUpIHtcblx0XHRcdFx0XHQvKiBOZXh0L3N0ZXAgZnVuY3Rpb24gLiovXG5cdFx0XHRcdFx0bGFzdF9zdGF0ZSA9IHNwcmluZ0ludGVncmF0ZVN0YXRlKGxhc3Rfc3RhdGUgfHwgaW5pdFN0YXRlLCBkdCk7XG5cdFx0XHRcdFx0LyogU3RvcmUgdGhlIHBvc2l0aW9uLiAqL1xuXHRcdFx0XHRcdHBhdGgucHVzaCgxICsgbGFzdF9zdGF0ZS54KTtcblx0XHRcdFx0XHR0aW1lX2xhcHNlZCArPSAxNjtcblx0XHRcdFx0XHQvKiBJZiB0aGUgY2hhbmdlIHRocmVzaG9sZCBpcyByZWFjaGVkLCBicmVhay4gKi9cblx0XHRcdFx0XHRpZiAoIShNYXRoLmFicyhsYXN0X3N0YXRlLngpID4gdG9sZXJhbmNlICYmIE1hdGguYWJzKGxhc3Rfc3RhdGUudikgPiB0b2xlcmFuY2UpKSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKiBJZiBkdXJhdGlvbiBpcyBub3QgZGVmaW5lZCwgcmV0dXJuIHRoZSBhY3R1YWwgdGltZSByZXF1aXJlZCBmb3IgY29tcGxldGluZyB0aGlzIGFuaW1hdGlvbi4gT3RoZXJ3aXNlLCByZXR1cm4gYSBjbG9zdXJlIHRoYXQgaG9sZHMgdGhlXG5cdFx0XHRcdCBjb21wdXRlZCBwYXRoIGFuZCByZXR1cm5zIGEgc25hcHNob3Qgb2YgdGhlIHBvc2l0aW9uIGFjY29yZGluZyB0byBhIGdpdmVuIHBlcmNlbnRDb21wbGV0ZS4gKi9cblx0XHRcdFx0cmV0dXJuICFoYXZlX2R1cmF0aW9uID8gdGltZV9sYXBzZWQgOiBmdW5jdGlvbihwZXJjZW50Q29tcGxldGUpIHtcblx0XHRcdFx0XHRyZXR1cm4gcGF0aFsgKHBlcmNlbnRDb21wbGV0ZSAqIChwYXRoLmxlbmd0aCAtIDEpKSB8IDAgXTtcblx0XHRcdFx0fTtcblx0XHRcdH07XG5cdFx0fSgpKTtcblxuXHRcdC8qIGpRdWVyeSBlYXNpbmdzLiAqL1xuXHRcdFZlbG9jaXR5LkVhc2luZ3MgPSB7XG5cdFx0XHRsaW5lYXI6IGZ1bmN0aW9uKHApIHtcblx0XHRcdFx0cmV0dXJuIHA7XG5cdFx0XHR9LFxuXHRcdFx0c3dpbmc6IGZ1bmN0aW9uKHApIHtcblx0XHRcdFx0cmV0dXJuIDAuNSAtIE1hdGguY29zKHAgKiBNYXRoLlBJKSAvIDI7XG5cdFx0XHR9LFxuXHRcdFx0LyogQm9udXMgXCJzcHJpbmdcIiBlYXNpbmcsIHdoaWNoIGlzIGEgbGVzcyBleGFnZ2VyYXRlZCB2ZXJzaW9uIG9mIGVhc2VJbk91dEVsYXN0aWMuICovXG5cdFx0XHRzcHJpbmc6IGZ1bmN0aW9uKHApIHtcblx0XHRcdFx0cmV0dXJuIDEgLSAoTWF0aC5jb3MocCAqIDQuNSAqIE1hdGguUEkpICogTWF0aC5leHAoLXAgKiA2KSk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qIENTUzMgYW5kIFJvYmVydCBQZW5uZXIgZWFzaW5ncy4gKi9cblx0XHQkLmVhY2goXG5cdFx0XHRcdFtcblx0XHRcdFx0XHRbXCJlYXNlXCIsIFswLjI1LCAwLjEsIDAuMjUsIDEuMF1dLFxuXHRcdFx0XHRcdFtcImVhc2UtaW5cIiwgWzAuNDIsIDAuMCwgMS4wMCwgMS4wXV0sXG5cdFx0XHRcdFx0W1wiZWFzZS1vdXRcIiwgWzAuMDAsIDAuMCwgMC41OCwgMS4wXV0sXG5cdFx0XHRcdFx0W1wiZWFzZS1pbi1vdXRcIiwgWzAuNDIsIDAuMCwgMC41OCwgMS4wXV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluU2luZVwiLCBbMC40NywgMCwgMC43NDUsIDAuNzE1XV0sXG5cdFx0XHRcdFx0W1wiZWFzZU91dFNpbmVcIiwgWzAuMzksIDAuNTc1LCAwLjU2NSwgMV1dLFxuXHRcdFx0XHRcdFtcImVhc2VJbk91dFNpbmVcIiwgWzAuNDQ1LCAwLjA1LCAwLjU1LCAwLjk1XV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluUXVhZFwiLCBbMC41NSwgMC4wODUsIDAuNjgsIDAuNTNdXSxcblx0XHRcdFx0XHRbXCJlYXNlT3V0UXVhZFwiLCBbMC4yNSwgMC40NiwgMC40NSwgMC45NF1dLFxuXHRcdFx0XHRcdFtcImVhc2VJbk91dFF1YWRcIiwgWzAuNDU1LCAwLjAzLCAwLjUxNSwgMC45NTVdXSxcblx0XHRcdFx0XHRbXCJlYXNlSW5DdWJpY1wiLCBbMC41NSwgMC4wNTUsIDAuNjc1LCAwLjE5XV0sXG5cdFx0XHRcdFx0W1wiZWFzZU91dEN1YmljXCIsIFswLjIxNSwgMC42MSwgMC4zNTUsIDFdXSxcblx0XHRcdFx0XHRbXCJlYXNlSW5PdXRDdWJpY1wiLCBbMC42NDUsIDAuMDQ1LCAwLjM1NSwgMV1dLFxuXHRcdFx0XHRcdFtcImVhc2VJblF1YXJ0XCIsIFswLjg5NSwgMC4wMywgMC42ODUsIDAuMjJdXSxcblx0XHRcdFx0XHRbXCJlYXNlT3V0UXVhcnRcIiwgWzAuMTY1LCAwLjg0LCAwLjQ0LCAxXV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluT3V0UXVhcnRcIiwgWzAuNzcsIDAsIDAuMTc1LCAxXV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluUXVpbnRcIiwgWzAuNzU1LCAwLjA1LCAwLjg1NSwgMC4wNl1dLFxuXHRcdFx0XHRcdFtcImVhc2VPdXRRdWludFwiLCBbMC4yMywgMSwgMC4zMiwgMV1dLFxuXHRcdFx0XHRcdFtcImVhc2VJbk91dFF1aW50XCIsIFswLjg2LCAwLCAwLjA3LCAxXV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluRXhwb1wiLCBbMC45NSwgMC4wNSwgMC43OTUsIDAuMDM1XV0sXG5cdFx0XHRcdFx0W1wiZWFzZU91dEV4cG9cIiwgWzAuMTksIDEsIDAuMjIsIDFdXSxcblx0XHRcdFx0XHRbXCJlYXNlSW5PdXRFeHBvXCIsIFsxLCAwLCAwLCAxXV0sXG5cdFx0XHRcdFx0W1wiZWFzZUluQ2lyY1wiLCBbMC42LCAwLjA0LCAwLjk4LCAwLjMzNV1dLFxuXHRcdFx0XHRcdFtcImVhc2VPdXRDaXJjXCIsIFswLjA3NSwgMC44MiwgMC4xNjUsIDFdXSxcblx0XHRcdFx0XHRbXCJlYXNlSW5PdXRDaXJjXCIsIFswLjc4NSwgMC4xMzUsIDAuMTUsIDAuODZdXVxuXHRcdFx0XHRdLCBmdW5jdGlvbihpLCBlYXNpbmdBcnJheSkge1xuXHRcdFx0VmVsb2NpdHkuRWFzaW5nc1tlYXNpbmdBcnJheVswXV0gPSBnZW5lcmF0ZUJlemllci5hcHBseShudWxsLCBlYXNpbmdBcnJheVsxXSk7XG5cdFx0fSk7XG5cblx0XHQvKiBEZXRlcm1pbmUgdGhlIGFwcHJvcHJpYXRlIGVhc2luZyB0eXBlIGdpdmVuIGFuIGVhc2luZyBpbnB1dC4gKi9cblx0XHRmdW5jdGlvbiBnZXRFYXNpbmcodmFsdWUsIGR1cmF0aW9uKSB7XG5cdFx0XHR2YXIgZWFzaW5nID0gdmFsdWU7XG5cblx0XHRcdC8qIFRoZSBlYXNpbmcgb3B0aW9uIGNhbiBlaXRoZXIgYmUgYSBzdHJpbmcgdGhhdCByZWZlcmVuY2VzIGEgcHJlLXJlZ2lzdGVyZWQgZWFzaW5nLFxuXHRcdFx0IG9yIGl0IGNhbiBiZSBhIHR3by0vZm91ci1pdGVtIGFycmF5IG9mIGludGVnZXJzIHRvIGJlIGNvbnZlcnRlZCBpbnRvIGEgYmV6aWVyL3NwcmluZyBmdW5jdGlvbi4gKi9cblx0XHRcdGlmIChUeXBlLmlzU3RyaW5nKHZhbHVlKSkge1xuXHRcdFx0XHQvKiBFbnN1cmUgdGhhdCB0aGUgZWFzaW5nIGhhcyBiZWVuIGFzc2lnbmVkIHRvIGpRdWVyeSdzIFZlbG9jaXR5LkVhc2luZ3Mgb2JqZWN0LiAqL1xuXHRcdFx0XHRpZiAoIVZlbG9jaXR5LkVhc2luZ3NbdmFsdWVdKSB7XG5cdFx0XHRcdFx0ZWFzaW5nID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAoVHlwZS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDEpIHtcblx0XHRcdFx0ZWFzaW5nID0gZ2VuZXJhdGVTdGVwLmFwcGx5KG51bGwsIHZhbHVlKTtcblx0XHRcdH0gZWxzZSBpZiAoVHlwZS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDIpIHtcblx0XHRcdFx0Lyogc3ByaW5nUks0IG11c3QgYmUgcGFzc2VkIHRoZSBhbmltYXRpb24ncyBkdXJhdGlvbi4gKi9cblx0XHRcdFx0LyogTm90ZTogSWYgdGhlIHNwcmluZ1JLNCBhcnJheSBjb250YWlucyBub24tbnVtYmVycywgZ2VuZXJhdGVTcHJpbmdSSzQoKSByZXR1cm5zIGFuIGVhc2luZ1xuXHRcdFx0XHQgZnVuY3Rpb24gZ2VuZXJhdGVkIHdpdGggZGVmYXVsdCB0ZW5zaW9uIGFuZCBmcmljdGlvbiB2YWx1ZXMuICovXG5cdFx0XHRcdGVhc2luZyA9IGdlbmVyYXRlU3ByaW5nUks0LmFwcGx5KG51bGwsIHZhbHVlLmNvbmNhdChbZHVyYXRpb25dKSk7XG5cdFx0XHR9IGVsc2UgaWYgKFR5cGUuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09PSA0KSB7XG5cdFx0XHRcdC8qIE5vdGU6IElmIHRoZSBiZXppZXIgYXJyYXkgY29udGFpbnMgbm9uLW51bWJlcnMsIGdlbmVyYXRlQmV6aWVyKCkgcmV0dXJucyBmYWxzZS4gKi9cblx0XHRcdFx0ZWFzaW5nID0gZ2VuZXJhdGVCZXppZXIuYXBwbHkobnVsbCwgdmFsdWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWFzaW5nID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdC8qIFJldmVydCB0byB0aGUgVmVsb2NpdHktd2lkZSBkZWZhdWx0IGVhc2luZyB0eXBlLCBvciBmYWxsIGJhY2sgdG8gXCJzd2luZ1wiICh3aGljaCBpcyBhbHNvIGpRdWVyeSdzIGRlZmF1bHQpXG5cdFx0XHQgaWYgdGhlIFZlbG9jaXR5LXdpZGUgZGVmYXVsdCBoYXMgYmVlbiBpbmNvcnJlY3RseSBtb2RpZmllZC4gKi9cblx0XHRcdGlmIChlYXNpbmcgPT09IGZhbHNlKSB7XG5cdFx0XHRcdGlmIChWZWxvY2l0eS5FYXNpbmdzW1ZlbG9jaXR5LmRlZmF1bHRzLmVhc2luZ10pIHtcblx0XHRcdFx0XHRlYXNpbmcgPSBWZWxvY2l0eS5kZWZhdWx0cy5lYXNpbmc7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZWFzaW5nID0gRUFTSU5HX0RFRkFVTFQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGVhc2luZztcblx0XHR9XG5cblx0XHQvKioqKioqKioqKioqKioqKipcblx0XHQgQ1NTIFN0YWNrXG5cdFx0ICoqKioqKioqKioqKioqKioqL1xuXG5cdFx0LyogVGhlIENTUyBvYmplY3QgaXMgYSBoaWdobHkgY29uZGVuc2VkIGFuZCBwZXJmb3JtYW50IENTUyBzdGFjayB0aGF0IGZ1bGx5IHJlcGxhY2VzIGpRdWVyeSdzLlxuXHRcdCBJdCBoYW5kbGVzIHRoZSB2YWxpZGF0aW9uLCBnZXR0aW5nLCBhbmQgc2V0dGluZyBvZiBib3RoIHN0YW5kYXJkIENTUyBwcm9wZXJ0aWVzIGFuZCBDU1MgcHJvcGVydHkgaG9va3MuICovXG5cdFx0LyogTm90ZTogQSBcIkNTU1wiIHNob3J0aGFuZCBpcyBhbGlhc2VkIHNvIHRoYXQgb3VyIGNvZGUgaXMgZWFzaWVyIHRvIHJlYWQuICovXG5cdFx0dmFyIENTUyA9IFZlbG9jaXR5LkNTUyA9IHtcblx0XHRcdC8qKioqKioqKioqKioqXG5cdFx0XHQgUmVnRXhcblx0XHRcdCAqKioqKioqKioqKioqL1xuXG5cdFx0XHRSZWdFeDoge1xuXHRcdFx0XHRpc0hleDogL14jKFtBLWZcXGRdezN9KXsxLDJ9JC9pLFxuXHRcdFx0XHQvKiBVbndyYXAgYSBwcm9wZXJ0eSB2YWx1ZSdzIHN1cnJvdW5kaW5nIHRleHQsIGUuZy4gXCJyZ2JhKDQsIDMsIDIsIDEpXCIgPT0+IFwiNCwgMywgMiwgMVwiIGFuZCBcInJlY3QoNHB4IDNweCAycHggMXB4KVwiID09PiBcIjRweCAzcHggMnB4IDFweFwiLiAqL1xuXHRcdFx0XHR2YWx1ZVVud3JhcDogL15bQS16XStcXCgoLiopXFwpJC9pLFxuXHRcdFx0XHR3cmFwcGVkVmFsdWVBbHJlYWR5RXh0cmFjdGVkOiAvWzAtOS5dKyBbMC05Ll0rIFswLTkuXSsoIFswLTkuXSspPy8sXG5cdFx0XHRcdC8qIFNwbGl0IGEgbXVsdGktdmFsdWUgcHJvcGVydHkgaW50byBhbiBhcnJheSBvZiBzdWJ2YWx1ZXMsIGUuZy4gXCJyZ2JhKDQsIDMsIDIsIDEpIDRweCAzcHggMnB4IDFweFwiID09PiBbIFwicmdiYSg0LCAzLCAyLCAxKVwiLCBcIjRweFwiLCBcIjNweFwiLCBcIjJweFwiLCBcIjFweFwiIF0uICovXG5cdFx0XHRcdHZhbHVlU3BsaXQ6IC8oW0Etel0rXFwoLitcXCkpfCgoW0EtejAtOSMtLl0rPykoPz1cXHN8JCkpL2lnXG5cdFx0XHR9LFxuXHRcdFx0LyoqKioqKioqKioqKlxuXHRcdFx0IExpc3RzXG5cdFx0XHQgKioqKioqKioqKioqL1xuXG5cdFx0XHRMaXN0czoge1xuXHRcdFx0XHRjb2xvcnM6IFtcImZpbGxcIiwgXCJzdHJva2VcIiwgXCJzdG9wQ29sb3JcIiwgXCJjb2xvclwiLCBcImJhY2tncm91bmRDb2xvclwiLCBcImJvcmRlckNvbG9yXCIsIFwiYm9yZGVyVG9wQ29sb3JcIiwgXCJib3JkZXJSaWdodENvbG9yXCIsIFwiYm9yZGVyQm90dG9tQ29sb3JcIiwgXCJib3JkZXJMZWZ0Q29sb3JcIiwgXCJvdXRsaW5lQ29sb3JcIl0sXG5cdFx0XHRcdHRyYW5zZm9ybXNCYXNlOiBbXCJ0cmFuc2xhdGVYXCIsIFwidHJhbnNsYXRlWVwiLCBcInNjYWxlXCIsIFwic2NhbGVYXCIsIFwic2NhbGVZXCIsIFwic2tld1hcIiwgXCJza2V3WVwiLCBcInJvdGF0ZVpcIl0sXG5cdFx0XHRcdHRyYW5zZm9ybXMzRDogW1widHJhbnNmb3JtUGVyc3BlY3RpdmVcIiwgXCJ0cmFuc2xhdGVaXCIsIFwic2NhbGVaXCIsIFwicm90YXRlWFwiLCBcInJvdGF0ZVlcIl1cblx0XHRcdH0sXG5cdFx0XHQvKioqKioqKioqKioqXG5cdFx0XHQgSG9va3Ncblx0XHRcdCAqKioqKioqKioqKiovXG5cblx0XHRcdC8qIEhvb2tzIGFsbG93IGEgc3VicHJvcGVydHkgKGUuZy4gXCJib3hTaGFkb3dCbHVyXCIpIG9mIGEgY29tcG91bmQtdmFsdWUgQ1NTIHByb3BlcnR5XG5cdFx0XHQgKGUuZy4gXCJib3hTaGFkb3c6IFggWSBCbHVyIFNwcmVhZCBDb2xvclwiKSB0byBiZSBhbmltYXRlZCBhcyBpZiBpdCB3ZXJlIGEgZGlzY3JldGUgcHJvcGVydHkuICovXG5cdFx0XHQvKiBOb3RlOiBCZXlvbmQgZW5hYmxpbmcgZmluZS1ncmFpbmVkIHByb3BlcnR5IGFuaW1hdGlvbiwgaG9va2luZyBpcyBuZWNlc3Nhcnkgc2luY2UgVmVsb2NpdHkgb25seVxuXHRcdFx0IHR3ZWVucyBwcm9wZXJ0aWVzIHdpdGggc2luZ2xlIG51bWVyaWMgdmFsdWVzOyB1bmxpa2UgQ1NTIHRyYW5zaXRpb25zLCBWZWxvY2l0eSBkb2VzIG5vdCBpbnRlcnBvbGF0ZSBjb21wb3VuZC12YWx1ZXMuICovXG5cdFx0XHRIb29rczoge1xuXHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IFJlZ2lzdHJhdGlvblxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyogVGVtcGxhdGVzIGFyZSBhIGNvbmNpc2Ugd2F5IG9mIGluZGljYXRpbmcgd2hpY2ggc3VicHJvcGVydGllcyBtdXN0IGJlIGluZGl2aWR1YWxseSByZWdpc3RlcmVkIGZvciBlYWNoIGNvbXBvdW5kLXZhbHVlIENTUyBwcm9wZXJ0eS4gKi9cblx0XHRcdFx0LyogRWFjaCB0ZW1wbGF0ZSBjb25zaXN0cyBvZiB0aGUgY29tcG91bmQtdmFsdWUncyBiYXNlIG5hbWUsIGl0cyBjb25zdGl0dWVudCBzdWJwcm9wZXJ0eSBuYW1lcywgYW5kIHRob3NlIHN1YnByb3BlcnRpZXMnIGRlZmF1bHQgdmFsdWVzLiAqL1xuXHRcdFx0XHR0ZW1wbGF0ZXM6IHtcblx0XHRcdFx0XHRcInRleHRTaGFkb3dcIjogW1wiQ29sb3IgWCBZIEJsdXJcIiwgXCJibGFjayAwcHggMHB4IDBweFwiXSxcblx0XHRcdFx0XHRcImJveFNoYWRvd1wiOiBbXCJDb2xvciBYIFkgQmx1ciBTcHJlYWRcIiwgXCJibGFjayAwcHggMHB4IDBweCAwcHhcIl0sXG5cdFx0XHRcdFx0XCJjbGlwXCI6IFtcIlRvcCBSaWdodCBCb3R0b20gTGVmdFwiLCBcIjBweCAwcHggMHB4IDBweFwiXSxcblx0XHRcdFx0XHRcImJhY2tncm91bmRQb3NpdGlvblwiOiBbXCJYIFlcIiwgXCIwJSAwJVwiXSxcblx0XHRcdFx0XHRcInRyYW5zZm9ybU9yaWdpblwiOiBbXCJYIFkgWlwiLCBcIjUwJSA1MCUgMHB4XCJdLFxuXHRcdFx0XHRcdFwicGVyc3BlY3RpdmVPcmlnaW5cIjogW1wiWCBZXCIsIFwiNTAlIDUwJVwiXVxuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBBIFwicmVnaXN0ZXJlZFwiIGhvb2sgaXMgb25lIHRoYXQgaGFzIGJlZW4gY29udmVydGVkIGZyb20gaXRzIHRlbXBsYXRlIGZvcm0gaW50byBhIGxpdmUsXG5cdFx0XHRcdCB0d2VlbmFibGUgcHJvcGVydHkuIEl0IGNvbnRhaW5zIGRhdGEgdG8gYXNzb2NpYXRlIGl0IHdpdGggaXRzIHJvb3QgcHJvcGVydHkuICovXG5cdFx0XHRcdHJlZ2lzdGVyZWQ6IHtcblx0XHRcdFx0XHQvKiBOb3RlOiBBIHJlZ2lzdGVyZWQgaG9vayBsb29rcyBsaWtlIHRoaXMgPT0+IHRleHRTaGFkb3dCbHVyOiBbIFwidGV4dFNoYWRvd1wiLCAzIF0sXG5cdFx0XHRcdFx0IHdoaWNoIGNvbnNpc3RzIG9mIHRoZSBzdWJwcm9wZXJ0eSdzIG5hbWUsIHRoZSBhc3NvY2lhdGVkIHJvb3QgcHJvcGVydHkncyBuYW1lLFxuXHRcdFx0XHRcdCBhbmQgdGhlIHN1YnByb3BlcnR5J3MgcG9zaXRpb24gaW4gdGhlIHJvb3QncyB2YWx1ZS4gKi9cblx0XHRcdFx0fSxcblx0XHRcdFx0LyogQ29udmVydCB0aGUgdGVtcGxhdGVzIGludG8gaW5kaXZpZHVhbCBob29rcyB0aGVuIGFwcGVuZCB0aGVtIHRvIHRoZSByZWdpc3RlcmVkIG9iamVjdCBhYm92ZS4gKi9cblx0XHRcdFx0cmVnaXN0ZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8qIENvbG9yIGhvb2tzIHJlZ2lzdHJhdGlvbjogQ29sb3JzIGFyZSBkZWZhdWx0ZWQgdG8gd2hpdGUgLS0gYXMgb3Bwb3NlZCB0byBibGFjayAtLSBzaW5jZSBjb2xvcnMgdGhhdCBhcmVcblx0XHRcdFx0XHQgY3VycmVudGx5IHNldCB0byBcInRyYW5zcGFyZW50XCIgZGVmYXVsdCB0byB0aGVpciByZXNwZWN0aXZlIHRlbXBsYXRlIGJlbG93IHdoZW4gY29sb3ItYW5pbWF0ZWQsXG5cdFx0XHRcdFx0IGFuZCB3aGl0ZSBpcyB0eXBpY2FsbHkgYSBjbG9zZXIgbWF0Y2ggdG8gdHJhbnNwYXJlbnQgdGhhbiBibGFjayBpcy4gQW4gZXhjZXB0aW9uIGlzIG1hZGUgZm9yIHRleHQgKFwiY29sb3JcIiksXG5cdFx0XHRcdFx0IHdoaWNoIGlzIGFsbW9zdCBhbHdheXMgc2V0IGNsb3NlciB0byBibGFjayB0aGFuIHdoaXRlLiAqL1xuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgQ1NTLkxpc3RzLmNvbG9ycy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0dmFyIHJnYkNvbXBvbmVudHMgPSAoQ1NTLkxpc3RzLmNvbG9yc1tpXSA9PT0gXCJjb2xvclwiKSA/IFwiMCAwIDAgMVwiIDogXCIyNTUgMjU1IDI1NSAxXCI7XG5cdFx0XHRcdFx0XHRDU1MuSG9va3MudGVtcGxhdGVzW0NTUy5MaXN0cy5jb2xvcnNbaV1dID0gW1wiUmVkIEdyZWVuIEJsdWUgQWxwaGFcIiwgcmdiQ29tcG9uZW50c107XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIHJvb3RQcm9wZXJ0eSxcblx0XHRcdFx0XHRcdFx0aG9va1RlbXBsYXRlLFxuXHRcdFx0XHRcdFx0XHRob29rTmFtZXM7XG5cblx0XHRcdFx0XHQvKiBJbiBJRSwgY29sb3IgdmFsdWVzIGluc2lkZSBjb21wb3VuZC12YWx1ZSBwcm9wZXJ0aWVzIGFyZSBwb3NpdGlvbmVkIGF0IHRoZSBlbmQgdGhlIHZhbHVlIGluc3RlYWQgb2YgYXQgdGhlIGJlZ2lubmluZy5cblx0XHRcdFx0XHQgVGh1cywgd2UgcmUtYXJyYW5nZSB0aGUgdGVtcGxhdGVzIGFjY29yZGluZ2x5LiAqL1xuXHRcdFx0XHRcdGlmIChJRSkge1xuXHRcdFx0XHRcdFx0Zm9yIChyb290UHJvcGVydHkgaW4gQ1NTLkhvb2tzLnRlbXBsYXRlcykge1xuXHRcdFx0XHRcdFx0XHRpZiAoIUNTUy5Ib29rcy50ZW1wbGF0ZXMuaGFzT3duUHJvcGVydHkocm9vdFByb3BlcnR5KSkge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGhvb2tUZW1wbGF0ZSA9IENTUy5Ib29rcy50ZW1wbGF0ZXNbcm9vdFByb3BlcnR5XTtcblx0XHRcdFx0XHRcdFx0aG9va05hbWVzID0gaG9va1RlbXBsYXRlWzBdLnNwbGl0KFwiIFwiKTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgZGVmYXVsdFZhbHVlcyA9IGhvb2tUZW1wbGF0ZVsxXS5tYXRjaChDU1MuUmVnRXgudmFsdWVTcGxpdCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGhvb2tOYW1lc1swXSA9PT0gXCJDb2xvclwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogUmVwb3NpdGlvbiBib3RoIHRoZSBob29rJ3MgbmFtZSBhbmQgaXRzIGRlZmF1bHQgdmFsdWUgdG8gdGhlIGVuZCBvZiB0aGVpciByZXNwZWN0aXZlIHN0cmluZ3MuICovXG5cdFx0XHRcdFx0XHRcdFx0aG9va05hbWVzLnB1c2goaG9va05hbWVzLnNoaWZ0KCkpO1xuXHRcdFx0XHRcdFx0XHRcdGRlZmF1bHRWYWx1ZXMucHVzaChkZWZhdWx0VmFsdWVzLnNoaWZ0KCkpO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyogUmVwbGFjZSB0aGUgZXhpc3RpbmcgdGVtcGxhdGUgZm9yIHRoZSBob29rJ3Mgcm9vdCBwcm9wZXJ0eS4gKi9cblx0XHRcdFx0XHRcdFx0XHRDU1MuSG9va3MudGVtcGxhdGVzW3Jvb3RQcm9wZXJ0eV0gPSBbaG9va05hbWVzLmpvaW4oXCIgXCIpLCBkZWZhdWx0VmFsdWVzLmpvaW4oXCIgXCIpXTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIEhvb2sgcmVnaXN0cmF0aW9uLiAqL1xuXHRcdFx0XHRcdGZvciAocm9vdFByb3BlcnR5IGluIENTUy5Ib29rcy50ZW1wbGF0ZXMpIHtcblx0XHRcdFx0XHRcdGlmICghQ1NTLkhvb2tzLnRlbXBsYXRlcy5oYXNPd25Qcm9wZXJ0eShyb290UHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aG9va1RlbXBsYXRlID0gQ1NTLkhvb2tzLnRlbXBsYXRlc1tyb290UHJvcGVydHldO1xuXHRcdFx0XHRcdFx0aG9va05hbWVzID0gaG9va1RlbXBsYXRlWzBdLnNwbGl0KFwiIFwiKTtcblxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaiBpbiBob29rTmFtZXMpIHtcblx0XHRcdFx0XHRcdFx0aWYgKCFob29rTmFtZXMuaGFzT3duUHJvcGVydHkoaikpIHtcblx0XHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgZnVsbEhvb2tOYW1lID0gcm9vdFByb3BlcnR5ICsgaG9va05hbWVzW2pdLFxuXHRcdFx0XHRcdFx0XHRcdFx0aG9va1Bvc2l0aW9uID0gajtcblxuXHRcdFx0XHRcdFx0XHQvKiBGb3IgZWFjaCBob29rLCByZWdpc3RlciBpdHMgZnVsbCBuYW1lIChlLmcuIHRleHRTaGFkb3dCbHVyKSB3aXRoIGl0cyByb290IHByb3BlcnR5IChlLmcuIHRleHRTaGFkb3cpXG5cdFx0XHRcdFx0XHRcdCBhbmQgdGhlIGhvb2sncyBwb3NpdGlvbiBpbiBpdHMgdGVtcGxhdGUncyBkZWZhdWx0IHZhbHVlIHN0cmluZy4gKi9cblx0XHRcdFx0XHRcdFx0Q1NTLkhvb2tzLnJlZ2lzdGVyZWRbZnVsbEhvb2tOYW1lXSA9IFtyb290UHJvcGVydHksIGhvb2tQb3NpdGlvbl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IEluamVjdGlvbiBhbmQgRXh0cmFjdGlvblxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyogTG9vayB1cCB0aGUgcm9vdCBwcm9wZXJ0eSBhc3NvY2lhdGVkIHdpdGggdGhlIGhvb2sgKGUuZy4gcmV0dXJuIFwidGV4dFNoYWRvd1wiIGZvciBcInRleHRTaGFkb3dCbHVyXCIpLiAqL1xuXHRcdFx0XHQvKiBTaW5jZSBhIGhvb2sgY2Fubm90IGJlIHNldCBkaXJlY3RseSAodGhlIGJyb3dzZXIgd29uJ3QgcmVjb2duaXplIGl0KSwgc3R5bGUgdXBkYXRpbmcgZm9yIGhvb2tzIGlzIHJvdXRlZCB0aHJvdWdoIHRoZSBob29rJ3Mgcm9vdCBwcm9wZXJ0eS4gKi9cblx0XHRcdFx0Z2V0Um9vdDogZnVuY3Rpb24ocHJvcGVydHkpIHtcblx0XHRcdFx0XHR2YXIgaG9va0RhdGEgPSBDU1MuSG9va3MucmVnaXN0ZXJlZFtwcm9wZXJ0eV07XG5cblx0XHRcdFx0XHRpZiAoaG9va0RhdGEpIHtcblx0XHRcdFx0XHRcdHJldHVybiBob29rRGF0YVswXTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0LyogSWYgdGhlcmUgd2FzIG5vIGhvb2sgbWF0Y2gsIHJldHVybiB0aGUgcHJvcGVydHkgbmFtZSB1bnRvdWNoZWQuICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gcHJvcGVydHk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBDb252ZXJ0IGFueSByb290UHJvcGVydHlWYWx1ZSwgbnVsbCBvciBvdGhlcndpc2UsIGludG8gYSBzcGFjZS1kZWxpbWl0ZWQgbGlzdCBvZiBob29rIHZhbHVlcyBzbyB0aGF0XG5cdFx0XHRcdCB0aGUgdGFyZ2V0ZWQgaG9vayBjYW4gYmUgaW5qZWN0ZWQgb3IgZXh0cmFjdGVkIGF0IGl0cyBzdGFuZGFyZCBwb3NpdGlvbi4gKi9cblx0XHRcdFx0Y2xlYW5Sb290UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24ocm9vdFByb3BlcnR5LCByb290UHJvcGVydHlWYWx1ZSkge1xuXHRcdFx0XHRcdC8qIElmIHRoZSByb290UHJvcGVydHlWYWx1ZSBpcyB3cmFwcGVkIHdpdGggXCJyZ2IoKVwiLCBcImNsaXAoKVwiLCBldGMuLCByZW1vdmUgdGhlIHdyYXBwaW5nIHRvIG5vcm1hbGl6ZSB0aGUgdmFsdWUgYmVmb3JlIG1hbmlwdWxhdGlvbi4gKi9cblx0XHRcdFx0XHRpZiAoQ1NTLlJlZ0V4LnZhbHVlVW53cmFwLnRlc3Qocm9vdFByb3BlcnR5VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRyb290UHJvcGVydHlWYWx1ZSA9IHJvb3RQcm9wZXJ0eVZhbHVlLm1hdGNoKENTUy5SZWdFeC52YWx1ZVVud3JhcClbMV07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0LyogSWYgcm9vdFByb3BlcnR5VmFsdWUgaXMgYSBDU1MgbnVsbC12YWx1ZSAoZnJvbSB3aGljaCB0aGVyZSdzIGluaGVyZW50bHkgbm8gaG9vayB2YWx1ZSB0byBleHRyYWN0KSxcblx0XHRcdFx0XHQgZGVmYXVsdCB0byB0aGUgcm9vdCdzIGRlZmF1bHQgdmFsdWUgYXMgZGVmaW5lZCBpbiBDU1MuSG9va3MudGVtcGxhdGVzLiAqL1xuXHRcdFx0XHRcdC8qIE5vdGU6IENTUyBudWxsLXZhbHVlcyBpbmNsdWRlIFwibm9uZVwiLCBcImF1dG9cIiwgYW5kIFwidHJhbnNwYXJlbnRcIi4gVGhleSBtdXN0IGJlIGNvbnZlcnRlZCBpbnRvIHRoZWlyXG5cdFx0XHRcdFx0IHplcm8tdmFsdWVzIChlLmcuIHRleHRTaGFkb3c6IFwibm9uZVwiID09PiB0ZXh0U2hhZG93OiBcIjBweCAwcHggMHB4IGJsYWNrXCIpIGZvciBob29rIG1hbmlwdWxhdGlvbiB0byBwcm9jZWVkLiAqL1xuXHRcdFx0XHRcdGlmIChDU1MuVmFsdWVzLmlzQ1NTTnVsbFZhbHVlKHJvb3RQcm9wZXJ0eVZhbHVlKSkge1xuXHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWUgPSBDU1MuSG9va3MudGVtcGxhdGVzW3Jvb3RQcm9wZXJ0eV1bMV07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJvb3RQcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBFeHRyYWN0ZWQgdGhlIGhvb2sncyB2YWx1ZSBmcm9tIGl0cyByb290IHByb3BlcnR5J3MgdmFsdWUuIFRoaXMgaXMgdXNlZCB0byBnZXQgdGhlIHN0YXJ0aW5nIHZhbHVlIG9mIGFuIGFuaW1hdGluZyBob29rLiAqL1xuXHRcdFx0XHRleHRyYWN0VmFsdWU6IGZ1bmN0aW9uKGZ1bGxIb29rTmFtZSwgcm9vdFByb3BlcnR5VmFsdWUpIHtcblx0XHRcdFx0XHR2YXIgaG9va0RhdGEgPSBDU1MuSG9va3MucmVnaXN0ZXJlZFtmdWxsSG9va05hbWVdO1xuXG5cdFx0XHRcdFx0aWYgKGhvb2tEYXRhKSB7XG5cdFx0XHRcdFx0XHR2YXIgaG9va1Jvb3QgPSBob29rRGF0YVswXSxcblx0XHRcdFx0XHRcdFx0XHRob29rUG9zaXRpb24gPSBob29rRGF0YVsxXTtcblxuXHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWUgPSBDU1MuSG9va3MuY2xlYW5Sb290UHJvcGVydHlWYWx1ZShob29rUm9vdCwgcm9vdFByb3BlcnR5VmFsdWUpO1xuXG5cdFx0XHRcdFx0XHQvKiBTcGxpdCByb290UHJvcGVydHlWYWx1ZSBpbnRvIGl0cyBjb25zdGl0dWVudCBob29rIHZhbHVlcyB0aGVuIGdyYWIgdGhlIGRlc2lyZWQgaG9vayBhdCBpdHMgc3RhbmRhcmQgcG9zaXRpb24uICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gcm9vdFByb3BlcnR5VmFsdWUudG9TdHJpbmcoKS5tYXRjaChDU1MuUmVnRXgudmFsdWVTcGxpdClbaG9va1Bvc2l0aW9uXTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0LyogSWYgdGhlIHByb3ZpZGVkIGZ1bGxIb29rTmFtZSBpc24ndCBhIHJlZ2lzdGVyZWQgaG9vaywgcmV0dXJuIHRoZSByb290UHJvcGVydHlWYWx1ZSB0aGF0IHdhcyBwYXNzZWQgaW4uICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gcm9vdFByb3BlcnR5VmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBJbmplY3QgdGhlIGhvb2sncyB2YWx1ZSBpbnRvIGl0cyByb290IHByb3BlcnR5J3MgdmFsdWUuIFRoaXMgaXMgdXNlZCB0byBwaWVjZSBiYWNrIHRvZ2V0aGVyIHRoZSByb290IHByb3BlcnR5XG5cdFx0XHRcdCBvbmNlIFZlbG9jaXR5IGhhcyB1cGRhdGVkIG9uZSBvZiBpdHMgaW5kaXZpZHVhbGx5IGhvb2tlZCB2YWx1ZXMgdGhyb3VnaCB0d2VlbmluZy4gKi9cblx0XHRcdFx0aW5qZWN0VmFsdWU6IGZ1bmN0aW9uKGZ1bGxIb29rTmFtZSwgaG9va1ZhbHVlLCByb290UHJvcGVydHlWYWx1ZSkge1xuXHRcdFx0XHRcdHZhciBob29rRGF0YSA9IENTUy5Ib29rcy5yZWdpc3RlcmVkW2Z1bGxIb29rTmFtZV07XG5cblx0XHRcdFx0XHRpZiAoaG9va0RhdGEpIHtcblx0XHRcdFx0XHRcdHZhciBob29rUm9vdCA9IGhvb2tEYXRhWzBdLFxuXHRcdFx0XHRcdFx0XHRcdGhvb2tQb3NpdGlvbiA9IGhvb2tEYXRhWzFdLFxuXHRcdFx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlUGFydHMsXG5cdFx0XHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWVVcGRhdGVkO1xuXG5cdFx0XHRcdFx0XHRyb290UHJvcGVydHlWYWx1ZSA9IENTUy5Ib29rcy5jbGVhblJvb3RQcm9wZXJ0eVZhbHVlKGhvb2tSb290LCByb290UHJvcGVydHlWYWx1ZSk7XG5cblx0XHRcdFx0XHRcdC8qIFNwbGl0IHJvb3RQcm9wZXJ0eVZhbHVlIGludG8gaXRzIGluZGl2aWR1YWwgaG9vayB2YWx1ZXMsIHJlcGxhY2UgdGhlIHRhcmdldGVkIHZhbHVlIHdpdGggaG9va1ZhbHVlLFxuXHRcdFx0XHRcdFx0IHRoZW4gcmVjb25zdHJ1Y3QgdGhlIHJvb3RQcm9wZXJ0eVZhbHVlIHN0cmluZy4gKi9cblx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlUGFydHMgPSByb290UHJvcGVydHlWYWx1ZS50b1N0cmluZygpLm1hdGNoKENTUy5SZWdFeC52YWx1ZVNwbGl0KTtcblx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlUGFydHNbaG9va1Bvc2l0aW9uXSA9IGhvb2tWYWx1ZTtcblx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlVXBkYXRlZCA9IHJvb3RQcm9wZXJ0eVZhbHVlUGFydHMuam9pbihcIiBcIik7XG5cblx0XHRcdFx0XHRcdHJldHVybiByb290UHJvcGVydHlWYWx1ZVVwZGF0ZWQ7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8qIElmIHRoZSBwcm92aWRlZCBmdWxsSG9va05hbWUgaXNuJ3QgYSByZWdpc3RlcmVkIGhvb2ssIHJldHVybiB0aGUgcm9vdFByb3BlcnR5VmFsdWUgdGhhdCB3YXMgcGFzc2VkIGluLiAqL1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJvb3RQcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdC8qKioqKioqKioqKioqKioqKioqXG5cdFx0XHQgTm9ybWFsaXphdGlvbnNcblx0XHRcdCAqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHQvKiBOb3JtYWxpemF0aW9ucyBzdGFuZGFyZGl6ZSBDU1MgcHJvcGVydHkgbWFuaXB1bGF0aW9uIGJ5IHBvbGx5ZmlsbGluZyBicm93c2VyLXNwZWNpZmljIGltcGxlbWVudGF0aW9ucyAoZS5nLiBvcGFjaXR5KVxuXHRcdFx0IGFuZCByZWZvcm1hdHRpbmcgc3BlY2lhbCBwcm9wZXJ0aWVzIChlLmcuIGNsaXAsIHJnYmEpIHRvIGxvb2sgbGlrZSBzdGFuZGFyZCBvbmVzLiAqL1xuXHRcdFx0Tm9ybWFsaXphdGlvbnM6IHtcblx0XHRcdFx0LyogTm9ybWFsaXphdGlvbnMgYXJlIHBhc3NlZCBhIG5vcm1hbGl6YXRpb24gdGFyZ2V0IChlaXRoZXIgdGhlIHByb3BlcnR5J3MgbmFtZSwgaXRzIGV4dHJhY3RlZCB2YWx1ZSwgb3IgaXRzIGluamVjdGVkIHZhbHVlKSxcblx0XHRcdFx0IHRoZSB0YXJnZXRlZCBlbGVtZW50ICh3aGljaCBtYXkgbmVlZCB0byBiZSBxdWVyaWVkKSwgYW5kIHRoZSB0YXJnZXRlZCBwcm9wZXJ0eSB2YWx1ZS4gKi9cblx0XHRcdFx0cmVnaXN0ZXJlZDoge1xuXHRcdFx0XHRcdGNsaXA6IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHByb3BlcnR5VmFsdWUpIHtcblx0XHRcdFx0XHRcdHN3aXRjaCAodHlwZSkge1xuXHRcdFx0XHRcdFx0XHRjYXNlIFwibmFtZVwiOlxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBcImNsaXBcIjtcblx0XHRcdFx0XHRcdFx0XHQvKiBDbGlwIG5lZWRzIHRvIGJlIHVud3JhcHBlZCBhbmQgc3RyaXBwZWQgb2YgaXRzIGNvbW1hcyBkdXJpbmcgZXh0cmFjdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0Y2FzZSBcImV4dHJhY3RcIjpcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXh0cmFjdGVkO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyogSWYgVmVsb2NpdHkgYWxzbyBleHRyYWN0ZWQgdGhpcyB2YWx1ZSwgc2tpcCBleHRyYWN0aW9uLiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmIChDU1MuUmVnRXgud3JhcHBlZFZhbHVlQWxyZWFkeUV4dHJhY3RlZC50ZXN0KHByb3BlcnR5VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRleHRyYWN0ZWQgPSBwcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBSZW1vdmUgdGhlIFwicmVjdCgpXCIgd3JhcHBlci4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdGV4dHJhY3RlZCA9IHByb3BlcnR5VmFsdWUudG9TdHJpbmcoKS5tYXRjaChDU1MuUmVnRXgudmFsdWVVbndyYXApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBTdHJpcCBvZmYgY29tbWFzLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0ZXh0cmFjdGVkID0gZXh0cmFjdGVkID8gZXh0cmFjdGVkWzFdLnJlcGxhY2UoLywoXFxzKyk/L2csIFwiIFwiKSA6IHByb3BlcnR5VmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGV4dHJhY3RlZDtcblx0XHRcdFx0XHRcdFx0XHQvKiBDbGlwIG5lZWRzIHRvIGJlIHJlLXdyYXBwZWQgZHVyaW5nIGluamVjdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0Y2FzZSBcImluamVjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBcInJlY3QoXCIgKyBwcm9wZXJ0eVZhbHVlICsgXCIpXCI7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRibHVyOiBmdW5jdGlvbih0eXBlLCBlbGVtZW50LCBwcm9wZXJ0eVZhbHVlKSB7XG5cdFx0XHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcIm5hbWVcIjpcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gVmVsb2NpdHkuU3RhdGUuaXNGaXJlZm94ID8gXCJmaWx0ZXJcIiA6IFwiLXdlYmtpdC1maWx0ZXJcIjtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcImV4dHJhY3RcIjpcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXh0cmFjdGVkID0gcGFyc2VGbG9hdChwcm9wZXJ0eVZhbHVlKTtcblxuXHRcdFx0XHRcdFx0XHRcdC8qIElmIGV4dHJhY3RlZCBpcyBOYU4sIG1lYW5pbmcgdGhlIHZhbHVlIGlzbid0IGFscmVhZHkgZXh0cmFjdGVkLiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmICghKGV4dHJhY3RlZCB8fCBleHRyYWN0ZWQgPT09IDApKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgYmx1ckNvbXBvbmVudCA9IHByb3BlcnR5VmFsdWUudG9TdHJpbmcoKS5tYXRjaCgvYmx1clxcKChbMC05XStbQS16XSspXFwpL2kpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBJZiB0aGUgZmlsdGVyIHN0cmluZyBoYWQgYSBibHVyIGNvbXBvbmVudCwgcmV0dXJuIGp1c3QgdGhlIGJsdXIgdmFsdWUgYW5kIHVuaXQgdHlwZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdGlmIChibHVyQ29tcG9uZW50KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGV4dHJhY3RlZCA9IGJsdXJDb21wb25lbnRbMV07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBjb21wb25lbnQgZG9lc24ndCBleGlzdCwgZGVmYXVsdCBibHVyIHRvIDAuICovXG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRleHRyYWN0ZWQgPSAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBleHRyYWN0ZWQ7XG5cdFx0XHRcdFx0XHRcdFx0LyogQmx1ciBuZWVkcyB0byBiZSByZS13cmFwcGVkIGR1cmluZyBpbmplY3Rpb24uICovXG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJpbmplY3RcIjpcblx0XHRcdFx0XHRcdFx0XHQvKiBGb3IgdGhlIGJsdXIgZWZmZWN0IHRvIGJlIGZ1bGx5IGRlLWFwcGxpZWQsIGl0IG5lZWRzIHRvIGJlIHNldCB0byBcIm5vbmVcIiBpbnN0ZWFkIG9mIDAuICovXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFwYXJzZUZsb2F0KHByb3BlcnR5VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gXCJub25lXCI7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBcImJsdXIoXCIgKyBwcm9wZXJ0eVZhbHVlICsgXCIpXCI7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0LyogPD1JRTggZG8gbm90IHN1cHBvcnQgdGhlIHN0YW5kYXJkIG9wYWNpdHkgcHJvcGVydHkuIFRoZXkgdXNlIGZpbHRlcjphbHBoYShvcGFjaXR5PUlOVCkgaW5zdGVhZC4gKi9cblx0XHRcdFx0XHRvcGFjaXR5OiBmdW5jdGlvbih0eXBlLCBlbGVtZW50LCBwcm9wZXJ0eVZhbHVlKSB7XG5cdFx0XHRcdFx0XHRpZiAoSUUgPD0gOCkge1xuXHRcdFx0XHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRcdFx0XHRjYXNlIFwibmFtZVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIFwiZmlsdGVyXCI7XG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSBcImV4dHJhY3RcIjpcblx0XHRcdFx0XHRcdFx0XHRcdC8qIDw9SUU4IHJldHVybiBhIFwiZmlsdGVyXCIgdmFsdWUgb2YgXCJhbHBoYShvcGFjaXR5PVxcZHsxLDN9KVwiLlxuXHRcdFx0XHRcdFx0XHRcdFx0IEV4dHJhY3QgdGhlIHZhbHVlIGFuZCBjb252ZXJ0IGl0IHRvIGEgZGVjaW1hbCB2YWx1ZSB0byBtYXRjaCB0aGUgc3RhbmRhcmQgQ1NTIG9wYWNpdHkgcHJvcGVydHkncyBmb3JtYXR0aW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGV4dHJhY3RlZCA9IHByb3BlcnR5VmFsdWUudG9TdHJpbmcoKS5tYXRjaCgvYWxwaGFcXChvcGFjaXR5PSguKilcXCkvaSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmIChleHRyYWN0ZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogQ29udmVydCB0byBkZWNpbWFsIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0eVZhbHVlID0gZXh0cmFjdGVkWzFdIC8gMTAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogV2hlbiBleHRyYWN0aW5nIG9wYWNpdHksIGRlZmF1bHQgdG8gMSBzaW5jZSBhIG51bGwgdmFsdWUgbWVhbnMgb3BhY2l0eSBoYXNuJ3QgYmVlbiBzZXQuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSAxO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcHJvcGVydHlWYWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRjYXNlIFwiaW5qZWN0XCI6XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBPcGFjaWZpZWQgZWxlbWVudHMgYXJlIHJlcXVpcmVkIHRvIGhhdmUgdGhlaXIgem9vbSBwcm9wZXJ0eSBzZXQgdG8gYSBub24temVybyB2YWx1ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuc3R5bGUuem9vbSA9IDE7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIFNldHRpbmcgdGhlIGZpbHRlciBwcm9wZXJ0eSBvbiBlbGVtZW50cyB3aXRoIGNlcnRhaW4gZm9udCBwcm9wZXJ0eSBjb21iaW5hdGlvbnMgY2FuIHJlc3VsdCBpbiBhXG5cdFx0XHRcdFx0XHRcdFx0XHQgaGlnaGx5IHVuYXBwZWFsaW5nIHVsdHJhLWJvbGRpbmcgZWZmZWN0LiBUaGVyZSdzIG5vIHdheSB0byByZW1lZHkgdGhpcyB0aHJvdWdob3V0IGEgdHdlZW4sIGJ1dCBkcm9wcGluZyB0aGVcblx0XHRcdFx0XHRcdFx0XHRcdCB2YWx1ZSBhbHRvZ2V0aGVyICh3aGVuIG9wYWNpdHkgaGl0cyAxKSBhdCBsZWFzdHMgZW5zdXJlcyB0aGF0IHRoZSBnbGl0Y2ggaXMgZ29uZSBwb3N0LXR3ZWVuaW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHBhcnNlRmxvYXQocHJvcGVydHlWYWx1ZSkgPj0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gXCJcIjtcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIEFzIHBlciB0aGUgZmlsdGVyIHByb3BlcnR5J3Mgc3BlYywgY29udmVydCB0aGUgZGVjaW1hbCB2YWx1ZSB0byBhIHdob2xlIG51bWJlciBhbmQgd3JhcCB0aGUgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBcImFscGhhKG9wYWNpdHk9XCIgKyBwYXJzZUludChwYXJzZUZsb2F0KHByb3BlcnR5VmFsdWUpICogMTAwLCAxMCkgKyBcIilcIjtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHQvKiBXaXRoIGFsbCBvdGhlciBicm93c2Vycywgbm9ybWFsaXphdGlvbiBpcyBub3QgcmVxdWlyZWQ7IHJldHVybiB0aGUgc2FtZSB2YWx1ZXMgdGhhdCB3ZXJlIHBhc3NlZCBpbi4gKi9cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHN3aXRjaCAodHlwZSkge1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJuYW1lXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gXCJvcGFjaXR5XCI7XG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSBcImV4dHJhY3RcIjpcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBwcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJpbmplY3RcIjpcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBwcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IEJhdGNoZWQgUmVnaXN0cmF0aW9uc1xuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyogTm90ZTogQmF0Y2hlZCBub3JtYWxpemF0aW9ucyBleHRlbmQgdGhlIENTUy5Ob3JtYWxpemF0aW9ucy5yZWdpc3RlcmVkIG9iamVjdC4gKi9cblx0XHRcdFx0cmVnaXN0ZXI6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0IFRyYW5zZm9ybXNcblx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHQvKiBUcmFuc2Zvcm1zIGFyZSB0aGUgc3VicHJvcGVydGllcyBjb250YWluZWQgYnkgdGhlIENTUyBcInRyYW5zZm9ybVwiIHByb3BlcnR5LiBUcmFuc2Zvcm1zIG11c3QgdW5kZXJnbyBub3JtYWxpemF0aW9uXG5cdFx0XHRcdFx0IHNvIHRoYXQgdGhleSBjYW4gYmUgcmVmZXJlbmNlZCBpbiBhIHByb3BlcnRpZXMgbWFwIGJ5IHRoZWlyIGluZGl2aWR1YWwgbmFtZXMuICovXG5cdFx0XHRcdFx0LyogTm90ZTogV2hlbiB0cmFuc2Zvcm1zIGFyZSBcInNldFwiLCB0aGV5IGFyZSBhY3R1YWxseSBhc3NpZ25lZCB0byBhIHBlci1lbGVtZW50IHRyYW5zZm9ybUNhY2hlLiBXaGVuIGFsbCB0cmFuc2Zvcm1cblx0XHRcdFx0XHQgc2V0dGluZyBpcyBjb21wbGV0ZSBjb21wbGV0ZSwgQ1NTLmZsdXNoVHJhbnNmb3JtQ2FjaGUoKSBtdXN0IGJlIG1hbnVhbGx5IGNhbGxlZCB0byBmbHVzaCB0aGUgdmFsdWVzIHRvIHRoZSBET00uXG5cdFx0XHRcdFx0IFRyYW5zZm9ybSBzZXR0aW5nIGlzIGJhdGNoZWQgaW4gdGhpcyB3YXkgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZTogdGhlIHRyYW5zZm9ybSBzdHlsZSBvbmx5IG5lZWRzIHRvIGJlIHVwZGF0ZWRcblx0XHRcdFx0XHQgb25jZSB3aGVuIG11bHRpcGxlIHRyYW5zZm9ybSBzdWJwcm9wZXJ0aWVzIGFyZSBiZWluZyBhbmltYXRlZCBzaW11bHRhbmVvdXNseS4gKi9cblx0XHRcdFx0XHQvKiBOb3RlOiBJRTkgYW5kIEFuZHJvaWQgR2luZ2VyYnJlYWQgaGF2ZSBzdXBwb3J0IGZvciAyRCAtLSBidXQgbm90IDNEIC0tIHRyYW5zZm9ybXMuIFNpbmNlIGFuaW1hdGluZyB1bnN1cHBvcnRlZFxuXHRcdFx0XHRcdCB0cmFuc2Zvcm0gcHJvcGVydGllcyByZXN1bHRzIGluIHRoZSBicm93c2VyIGlnbm9yaW5nIHRoZSAqZW50aXJlKiB0cmFuc2Zvcm0gc3RyaW5nLCB3ZSBwcmV2ZW50IHRoZXNlIDNEIHZhbHVlc1xuXHRcdFx0XHRcdCBmcm9tIGJlaW5nIG5vcm1hbGl6ZWQgZm9yIHRoZXNlIGJyb3dzZXJzIHNvIHRoYXQgdHdlZW5pbmcgc2tpcHMgdGhlc2UgcHJvcGVydGllcyBhbHRvZ2V0aGVyXG5cdFx0XHRcdFx0IChzaW5jZSBpdCB3aWxsIGlnbm9yZSB0aGVtIGFzIGJlaW5nIHVuc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyLikgKi9cblx0XHRcdFx0XHRpZiAoKCFJRSB8fCBJRSA+IDkpICYmICFWZWxvY2l0eS5TdGF0ZS5pc0dpbmdlcmJyZWFkKSB7XG5cdFx0XHRcdFx0XHQvKiBOb3RlOiBTaW5jZSB0aGUgc3RhbmRhbG9uZSBDU1MgXCJwZXJzcGVjdGl2ZVwiIHByb3BlcnR5IGFuZCB0aGUgQ1NTIHRyYW5zZm9ybSBcInBlcnNwZWN0aXZlXCIgc3VicHJvcGVydHlcblx0XHRcdFx0XHRcdCBzaGFyZSB0aGUgc2FtZSBuYW1lLCB0aGUgbGF0dGVyIGlzIGdpdmVuIGEgdW5pcXVlIHRva2VuIHdpdGhpbiBWZWxvY2l0eTogXCJ0cmFuc2Zvcm1QZXJzcGVjdGl2ZVwiLiAqL1xuXHRcdFx0XHRcdFx0Q1NTLkxpc3RzLnRyYW5zZm9ybXNCYXNlID0gQ1NTLkxpc3RzLnRyYW5zZm9ybXNCYXNlLmNvbmNhdChDU1MuTGlzdHMudHJhbnNmb3JtczNEKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IENTUy5MaXN0cy50cmFuc2Zvcm1zQmFzZS5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0LyogV3JhcCB0aGUgZHluYW1pY2FsbHkgZ2VuZXJhdGVkIG5vcm1hbGl6YXRpb24gZnVuY3Rpb24gaW4gYSBuZXcgc2NvcGUgc28gdGhhdCB0cmFuc2Zvcm1OYW1lJ3MgdmFsdWUgaXNcblx0XHRcdFx0XHRcdCBwYWlyZWQgd2l0aCBpdHMgcmVzcGVjdGl2ZSBmdW5jdGlvbi4gKE90aGVyd2lzZSwgYWxsIGZ1bmN0aW9ucyB3b3VsZCB0YWtlIHRoZSBmaW5hbCBmb3IgbG9vcCdzIHRyYW5zZm9ybU5hbWUuKSAqL1xuXHRcdFx0XHRcdFx0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHR2YXIgdHJhbnNmb3JtTmFtZSA9IENTUy5MaXN0cy50cmFuc2Zvcm1zQmFzZVtpXTtcblxuXHRcdFx0XHRcdFx0XHRDU1MuTm9ybWFsaXphdGlvbnMucmVnaXN0ZXJlZFt0cmFuc2Zvcm1OYW1lXSA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHByb3BlcnR5VmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8qIFRoZSBub3JtYWxpemVkIHByb3BlcnR5IG5hbWUgaXMgdGhlIHBhcmVudCBcInRyYW5zZm9ybVwiIHByb3BlcnR5IC0tIHRoZSBwcm9wZXJ0eSB0aGF0IGlzIGFjdHVhbGx5IHNldCBpbiBDU1MuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwibmFtZVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gXCJ0cmFuc2Zvcm1cIjtcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogVHJhbnNmb3JtIHZhbHVlcyBhcmUgY2FjaGVkIG9udG8gYSBwZXItZWxlbWVudCB0cmFuc2Zvcm1DYWNoZSBvYmplY3QuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwiZXh0cmFjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBJZiB0aGlzIHRyYW5zZm9ybSBoYXMgeWV0IHRvIGJlIGFzc2lnbmVkIGEgdmFsdWUsIHJldHVybiBpdHMgbnVsbCB2YWx1ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKERhdGEoZWxlbWVudCkgPT09IHVuZGVmaW5lZCB8fCBEYXRhKGVsZW1lbnQpLnRyYW5zZm9ybUNhY2hlW3RyYW5zZm9ybU5hbWVdID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBTY2FsZSBDU1MuTGlzdHMudHJhbnNmb3Jtc0Jhc2UgZGVmYXVsdCB0byAxIHdoZXJlYXMgYWxsIG90aGVyIHRyYW5zZm9ybSBwcm9wZXJ0aWVzIGRlZmF1bHQgdG8gMC4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gL15zY2FsZS9pLnRlc3QodHJhbnNmb3JtTmFtZSkgPyAxIDogMDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBXaGVuIHRyYW5zZm9ybSB2YWx1ZXMgYXJlIHNldCwgdGhleSBhcmUgd3JhcHBlZCBpbiBwYXJlbnRoZXNlcyBhcyBwZXIgdGhlIENTUyBzcGVjLlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCBUaHVzLCB3aGVuIGV4dHJhY3RpbmcgdGhlaXIgdmFsdWVzIChmb3IgdHdlZW4gY2FsY3VsYXRpb25zKSwgd2Ugc3RyaXAgb2ZmIHRoZSBwYXJlbnRoZXNlcy4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gRGF0YShlbGVtZW50KS50cmFuc2Zvcm1DYWNoZVt0cmFuc2Zvcm1OYW1lXS5yZXBsYWNlKC9bKCldL2csIFwiXCIpO1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSBcImluamVjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgaW52YWxpZCA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIElmIGFuIGluZGl2aWR1YWwgdHJhbnNmb3JtIHByb3BlcnR5IGNvbnRhaW5zIGFuIHVuc3VwcG9ydGVkIHVuaXQgdHlwZSwgdGhlIGJyb3dzZXIgaWdub3JlcyB0aGUgKmVudGlyZSogdHJhbnNmb3JtIHByb3BlcnR5LlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQgVGh1cywgcHJvdGVjdCB1c2VycyBmcm9tIHRoZW1zZWx2ZXMgYnkgc2tpcHBpbmcgc2V0dGluZyBmb3IgdHJhbnNmb3JtIHZhbHVlcyBzdXBwbGllZCB3aXRoIGludmFsaWQgdW5pdCB0eXBlcy4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogU3dpdGNoIG9uIHRoZSBiYXNlIHRyYW5zZm9ybSB0eXBlOyBpZ25vcmUgdGhlIGF4aXMgYnkgcmVtb3ZpbmcgdGhlIGxhc3QgbGV0dGVyIGZyb20gdGhlIHRyYW5zZm9ybSdzIG5hbWUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN3aXRjaCAodHJhbnNmb3JtTmFtZS5zdWJzdHIoMCwgdHJhbnNmb3JtTmFtZS5sZW5ndGggLSAxKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFdoaXRlbGlzdCB1bml0IHR5cGVzIGZvciBlYWNoIHRyYW5zZm9ybS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwidHJhbnNsYXRlXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpbnZhbGlkID0gIS8oJXxweHxlbXxyZW18dnd8dmh8XFxkKSQvaS50ZXN0KHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBTaW5jZSBhbiBheGlzLWZyZWUgXCJzY2FsZVwiIHByb3BlcnR5IGlzIHN1cHBvcnRlZCBhcyB3ZWxsLCBhIGxpdHRsZSBoYWNrIGlzIHVzZWQgaGVyZSB0byBkZXRlY3QgaXQgYnkgY2hvcHBpbmcgb2ZmIGl0cyBsYXN0IGxldHRlci4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwic2NhbFwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJzY2FsZVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogQ2hyb21lIG9uIEFuZHJvaWQgaGFzIGEgYnVnIGluIHdoaWNoIHNjYWxlZCBlbGVtZW50cyBibHVyIGlmIHRoZWlyIGluaXRpYWwgc2NhbGVcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCB2YWx1ZSBpcyBiZWxvdyAxICh3aGljaCBjYW4gaGFwcGVuIHdpdGggZm9yY2VmZWVkaW5nKS4gVGh1cywgd2UgZGV0ZWN0IGEgeWV0LXVuc2V0IHNjYWxlIHByb3BlcnR5XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgYW5kIGVuc3VyZSB0aGF0IGl0cyBmaXJzdCB2YWx1ZSBpcyBhbHdheXMgMS4gTW9yZSBpbmZvOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNDE3ODkwL2NzczMtYW5pbWF0aW9ucy13aXRoLXRyYW5zZm9ybS1jYXVzZXMtYmx1cnJlZC1lbGVtZW50cy1vbi13ZWJraXQvMTA0MTc5NjIjMTA0MTc5NjIgKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChWZWxvY2l0eS5TdGF0ZS5pc0FuZHJvaWQgJiYgRGF0YShlbGVtZW50KS50cmFuc2Zvcm1DYWNoZVt0cmFuc2Zvcm1OYW1lXSA9PT0gdW5kZWZpbmVkICYmIHByb3BlcnR5VmFsdWUgPCAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSAxO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpbnZhbGlkID0gIS8oXFxkKSQvaS50ZXN0KHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSBcInNrZXdcIjpcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGludmFsaWQgPSAhLyhkZWd8XFxkKSQvaS50ZXN0KHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSBcInJvdGF0ZVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aW52YWxpZCA9ICEvKGRlZ3xcXGQpJC9pLnRlc3QocHJvcGVydHlWYWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmICghaW52YWxpZCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIEFzIHBlciB0aGUgQ1NTIHNwZWMsIHdyYXAgdGhlIHZhbHVlIGluIHBhcmVudGhlc2VzLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdERhdGEoZWxlbWVudCkudHJhbnNmb3JtQ2FjaGVbdHJhbnNmb3JtTmFtZV0gPSBcIihcIiArIHByb3BlcnR5VmFsdWUgKyBcIilcIjtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIEFsdGhvdWdoIHRoZSB2YWx1ZSBpcyBzZXQgb24gdGhlIHRyYW5zZm9ybUNhY2hlIG9iamVjdCwgcmV0dXJuIHRoZSBuZXdseS11cGRhdGVkIHZhbHVlIGZvciB0aGUgY2FsbGluZyBjb2RlIHRvIHByb2Nlc3MgYXMgbm9ybWFsLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gRGF0YShlbGVtZW50KS50cmFuc2Zvcm1DYWNoZVt0cmFuc2Zvcm1OYW1lXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHR9KSgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qKioqKioqKioqKioqXG5cdFx0XHRcdFx0IENvbG9yc1xuXHRcdFx0XHRcdCAqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0LyogU2luY2UgVmVsb2NpdHkgb25seSBhbmltYXRlcyBhIHNpbmdsZSBudW1lcmljIHZhbHVlIHBlciBwcm9wZXJ0eSwgY29sb3IgYW5pbWF0aW9uIGlzIGFjaGlldmVkIGJ5IGhvb2tpbmcgdGhlIGluZGl2aWR1YWwgUkdCQSBjb21wb25lbnRzIG9mIENTUyBjb2xvciBwcm9wZXJ0aWVzLlxuXHRcdFx0XHRcdCBBY2NvcmRpbmdseSwgY29sb3IgdmFsdWVzIG11c3QgYmUgbm9ybWFsaXplZCAoZS5nLiBcIiNmZjAwMDBcIiwgXCJyZWRcIiwgYW5kIFwicmdiKDI1NSwgMCwgMClcIiA9PT4gXCIyNTUgMCAwIDFcIikgc28gdGhhdCB0aGVpciBjb21wb25lbnRzIGNhbiBiZSBpbmplY3RlZC9leHRyYWN0ZWQgYnkgQ1NTLkhvb2tzIGxvZ2ljLiAqL1xuXHRcdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgQ1NTLkxpc3RzLmNvbG9ycy5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRcdFx0LyogV3JhcCB0aGUgZHluYW1pY2FsbHkgZ2VuZXJhdGVkIG5vcm1hbGl6YXRpb24gZnVuY3Rpb24gaW4gYSBuZXcgc2NvcGUgc28gdGhhdCBjb2xvck5hbWUncyB2YWx1ZSBpcyBwYWlyZWQgd2l0aCBpdHMgcmVzcGVjdGl2ZSBmdW5jdGlvbi5cblx0XHRcdFx0XHRcdCAoT3RoZXJ3aXNlLCBhbGwgZnVuY3Rpb25zIHdvdWxkIHRha2UgdGhlIGZpbmFsIGZvciBsb29wJ3MgY29sb3JOYW1lLikgKi9cblx0XHRcdFx0XHRcdChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGNvbG9yTmFtZSA9IENTUy5MaXN0cy5jb2xvcnNbal07XG5cblx0XHRcdFx0XHRcdFx0LyogTm90ZTogSW4gSUU8PTgsIHdoaWNoIHN1cHBvcnQgcmdiIGJ1dCBub3QgcmdiYSwgY29sb3IgcHJvcGVydGllcyBhcmUgcmV2ZXJ0ZWQgdG8gcmdiIGJ5IHN0cmlwcGluZyBvZmYgdGhlIGFscGhhIGNvbXBvbmVudC4gKi9cblx0XHRcdFx0XHRcdFx0Q1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbY29sb3JOYW1lXSA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHByb3BlcnR5VmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCJuYW1lXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBjb2xvck5hbWU7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIENvbnZlcnQgYWxsIGNvbG9yIHZhbHVlcyBpbnRvIHRoZSByZ2IgZm9ybWF0LiAoT2xkIElFIGNhbiByZXR1cm4gaGV4IHZhbHVlcyBhbmQgY29sb3IgbmFtZXMgaW5zdGVhZCBvZiByZ2IvcmdiYS4pICovXG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwiZXh0cmFjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZXh0cmFjdGVkO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBjb2xvciBpcyBhbHJlYWR5IGluIGl0cyBob29rYWJsZSBmb3JtIChlLmcuIFwiMjU1IDI1NSAyNTUgMVwiKSBkdWUgdG8gaGF2aW5nIGJlZW4gcHJldmlvdXNseSBleHRyYWN0ZWQsIHNraXAgZXh0cmFjdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKENTUy5SZWdFeC53cmFwcGVkVmFsdWVBbHJlYWR5RXh0cmFjdGVkLnRlc3QocHJvcGVydHlWYWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRleHRyYWN0ZWQgPSBwcm9wZXJ0eVZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBjb252ZXJ0ZWQsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGNvbG9yTmFtZXMgPSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0YmxhY2s6IFwicmdiKDAsIDAsIDApXCIsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ymx1ZTogXCJyZ2IoMCwgMCwgMjU1KVwiLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGdyYXk6IFwicmdiKDEyOCwgMTI4LCAxMjgpXCIsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Z3JlZW46IFwicmdiKDAsIDEyOCwgMClcIixcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZWQ6IFwicmdiKDI1NSwgMCwgMClcIixcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR3aGl0ZTogXCJyZ2IoMjU1LCAyNTUsIDI1NSlcIlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogQ29udmVydCBjb2xvciBuYW1lcyB0byByZ2IuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKC9eW0Etel0rJC9pLnRlc3QocHJvcGVydHlWYWx1ZSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChjb2xvck5hbWVzW3Byb3BlcnR5VmFsdWVdICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y29udmVydGVkID0gY29sb3JOYW1lc1twcm9wZXJ0eVZhbHVlXTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIElmIGFuIHVubWF0Y2hlZCBjb2xvciBuYW1lIGlzIHByb3ZpZGVkLCBkZWZhdWx0IHRvIGJsYWNrLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb252ZXJ0ZWQgPSBjb2xvck5hbWVzLmJsYWNrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogQ29udmVydCBoZXggdmFsdWVzIHRvIHJnYi4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKENTUy5SZWdFeC5pc0hleC50ZXN0KHByb3BlcnR5VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb252ZXJ0ZWQgPSBcInJnYihcIiArIENTUy5WYWx1ZXMuaGV4VG9SZ2IocHJvcGVydHlWYWx1ZSkuam9pbihcIiBcIikgKyBcIilcIjtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBwcm92aWRlZCBjb2xvciBkb2Vzbid0IG1hdGNoIGFueSBvZiB0aGUgYWNjZXB0ZWQgY29sb3IgZm9ybWF0cywgZGVmYXVsdCB0byBibGFjay4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCEoL15yZ2JhP1xcKC9pLnRlc3QocHJvcGVydHlWYWx1ZSkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRjb252ZXJ0ZWQgPSBjb2xvck5hbWVzLmJsYWNrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFJlbW92ZSB0aGUgc3Vycm91bmRpbmcgXCJyZ2IvcmdiYSgpXCIgc3RyaW5nIHRoZW4gcmVwbGFjZSBjb21tYXMgd2l0aCBzcGFjZXMgYW5kIHN0cmlwXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0IHJlcGVhdGVkIHNwYWNlcyAoaW4gY2FzZSB0aGUgdmFsdWUgaW5jbHVkZWQgc3BhY2VzIHRvIGJlZ2luIHdpdGgpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGV4dHJhY3RlZCA9IChjb252ZXJ0ZWQgfHwgcHJvcGVydHlWYWx1ZSkudG9TdHJpbmcoKS5tYXRjaChDU1MuUmVnRXgudmFsdWVVbndyYXApWzFdLnJlcGxhY2UoLywoXFxzKyk/L2csIFwiIFwiKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFNvIGxvbmcgYXMgdGhpcyBpc24ndCA8PUlFOCwgYWRkIGEgZm91cnRoIChhbHBoYSkgY29tcG9uZW50IGlmIGl0J3MgbWlzc2luZyBhbmQgZGVmYXVsdCBpdCB0byAxICh2aXNpYmxlKS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKCghSUUgfHwgSUUgPiA4KSAmJiBleHRyYWN0ZWQuc3BsaXQoXCIgXCIpLmxlbmd0aCA9PT0gMykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGV4dHJhY3RlZCArPSBcIiAxXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZXh0cmFjdGVkO1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSBcImluamVjdFwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBJZiB0aGlzIGlzIElFPD04IGFuZCBhbiBhbHBoYSBjb21wb25lbnQgZXhpc3RzLCBzdHJpcCBpdCBvZmYuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChJRSA8PSA4KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHByb3BlcnR5VmFsdWUuc3BsaXQoXCIgXCIpLmxlbmd0aCA9PT0gNCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5VmFsdWUuc3BsaXQoL1xccysvKS5zbGljZSgwLCAzKS5qb2luKFwiIFwiKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogT3RoZXJ3aXNlLCBhZGQgYSBmb3VydGggKGFscGhhKSBjb21wb25lbnQgaWYgaXQncyBtaXNzaW5nIGFuZCBkZWZhdWx0IGl0IHRvIDEgKHZpc2libGUpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHByb3BlcnR5VmFsdWUuc3BsaXQoXCIgXCIpLmxlbmd0aCA9PT0gMykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgKz0gXCIgMVwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogUmUtaW5zZXJ0IHRoZSBicm93c2VyLWFwcHJvcHJpYXRlIHdyYXBwZXIoXCJyZ2IvcmdiYSgpXCIpLCBpbnNlcnQgY29tbWFzLCBhbmQgc3RyaXAgb2ZmIGRlY2ltYWwgdW5pdHNcblx0XHRcdFx0XHRcdFx0XHRcdFx0IG9uIGFsbCB2YWx1ZXMgYnV0IHRoZSBmb3VydGggKFIsIEcsIGFuZCBCIG9ubHkgYWNjZXB0IHdob2xlIG51bWJlcnMpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKElFIDw9IDggPyBcInJnYlwiIDogXCJyZ2JhXCIpICsgXCIoXCIgKyBwcm9wZXJ0eVZhbHVlLnJlcGxhY2UoL1xccysvZywgXCIsXCIpLnJlcGxhY2UoL1xcLihcXGQpKyg/PSwpL2csIFwiXCIpICsgXCIpXCI7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0fSkoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHQgQ1NTIFByb3BlcnR5IE5hbWVzXG5cdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHROYW1lczoge1xuXHRcdFx0XHQvKiBDYW1lbGNhc2UgYSBwcm9wZXJ0eSBuYW1lIGludG8gaXRzIEphdmFTY3JpcHQgbm90YXRpb24gKGUuZy4gXCJiYWNrZ3JvdW5kLWNvbG9yXCIgPT0+IFwiYmFja2dyb3VuZENvbG9yXCIpLlxuXHRcdFx0XHQgQ2FtZWxjYXNpbmcgaXMgdXNlZCB0byBub3JtYWxpemUgcHJvcGVydHkgbmFtZXMgYmV0d2VlbiBhbmQgYWNyb3NzIGNhbGxzLiAqL1xuXHRcdFx0XHRjYW1lbENhc2U6IGZ1bmN0aW9uKHByb3BlcnR5KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHByb3BlcnR5LnJlcGxhY2UoLy0oXFx3KS9nLCBmdW5jdGlvbihtYXRjaCwgc3ViTWF0Y2gpIHtcblx0XHRcdFx0XHRcdHJldHVybiBzdWJNYXRjaC50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBGb3IgU1ZHIGVsZW1lbnRzLCBzb21lIHByb3BlcnRpZXMgKG5hbWVseSwgZGltZW5zaW9uYWwgb25lcykgYXJlIEdFVC9TRVQgdmlhIHRoZSBlbGVtZW50J3MgSFRNTCBhdHRyaWJ1dGVzIChpbnN0ZWFkIG9mIHZpYSBDU1Mgc3R5bGVzKS4gKi9cblx0XHRcdFx0U1ZHQXR0cmlidXRlOiBmdW5jdGlvbihwcm9wZXJ0eSkge1xuXHRcdFx0XHRcdHZhciBTVkdBdHRyaWJ1dGVzID0gXCJ3aWR0aHxoZWlnaHR8eHx5fGN4fGN5fHJ8cnh8cnl8eDF8eDJ8eTF8eTJcIjtcblxuXHRcdFx0XHRcdC8qIENlcnRhaW4gYnJvd3NlcnMgcmVxdWlyZSBhbiBTVkcgdHJhbnNmb3JtIHRvIGJlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlLiAoT3RoZXJ3aXNlLCBhcHBsaWNhdGlvbiB2aWEgQ1NTIGlzIHByZWZlcmFibGUgZHVlIHRvIDNEIHN1cHBvcnQuKSAqL1xuXHRcdFx0XHRcdGlmIChJRSB8fCAoVmVsb2NpdHkuU3RhdGUuaXNBbmRyb2lkICYmICFWZWxvY2l0eS5TdGF0ZS5pc0Nocm9tZSkpIHtcblx0XHRcdFx0XHRcdFNWR0F0dHJpYnV0ZXMgKz0gXCJ8dHJhbnNmb3JtXCI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBSZWdFeHAoXCJeKFwiICsgU1ZHQXR0cmlidXRlcyArIFwiKSRcIiwgXCJpXCIpLnRlc3QocHJvcGVydHkpO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHQvKiBEZXRlcm1pbmUgd2hldGhlciBhIHByb3BlcnR5IHNob3VsZCBiZSBzZXQgd2l0aCBhIHZlbmRvciBwcmVmaXguICovXG5cdFx0XHRcdC8qIElmIGEgcHJlZml4ZWQgdmVyc2lvbiBvZiB0aGUgcHJvcGVydHkgZXhpc3RzLCByZXR1cm4gaXQuIE90aGVyd2lzZSwgcmV0dXJuIHRoZSBvcmlnaW5hbCBwcm9wZXJ0eSBuYW1lLlxuXHRcdFx0XHQgSWYgdGhlIHByb3BlcnR5IGlzIG5vdCBhdCBhbGwgc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyLCByZXR1cm4gYSBmYWxzZSBmbGFnLiAqL1xuXHRcdFx0XHRwcmVmaXhDaGVjazogZnVuY3Rpb24ocHJvcGVydHkpIHtcblx0XHRcdFx0XHQvKiBJZiB0aGlzIHByb3BlcnR5IGhhcyBhbHJlYWR5IGJlZW4gY2hlY2tlZCwgcmV0dXJuIHRoZSBjYWNoZWQgdmFsdWUuICovXG5cdFx0XHRcdFx0aWYgKFZlbG9jaXR5LlN0YXRlLnByZWZpeE1hdGNoZXNbcHJvcGVydHldKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gW1ZlbG9jaXR5LlN0YXRlLnByZWZpeE1hdGNoZXNbcHJvcGVydHldLCB0cnVlXTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dmFyIHZlbmRvcnMgPSBbXCJcIiwgXCJXZWJraXRcIiwgXCJNb3pcIiwgXCJtc1wiLCBcIk9cIl07XG5cblx0XHRcdFx0XHRcdGZvciAodmFyIGkgPSAwLCB2ZW5kb3JzTGVuZ3RoID0gdmVuZG9ycy5sZW5ndGg7IGkgPCB2ZW5kb3JzTGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5UHJlZml4ZWQ7XG5cblx0XHRcdFx0XHRcdFx0aWYgKGkgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0eVByZWZpeGVkID0gcHJvcGVydHk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogQ2FwaXRhbGl6ZSB0aGUgZmlyc3QgbGV0dGVyIG9mIHRoZSBwcm9wZXJ0eSB0byBjb25mb3JtIHRvIEphdmFTY3JpcHQgdmVuZG9yIHByZWZpeCBub3RhdGlvbiAoZS5nLiB3ZWJraXRGaWx0ZXIpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdHByb3BlcnR5UHJlZml4ZWQgPSB2ZW5kb3JzW2ldICsgcHJvcGVydHkucmVwbGFjZSgvXlxcdy8sIGZ1bmN0aW9uKG1hdGNoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbWF0Y2gudG9VcHBlckNhc2UoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIENoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIHRoaXMgcHJvcGVydHkgYXMgcHJlZml4ZWQuICovXG5cdFx0XHRcdFx0XHRcdGlmIChUeXBlLmlzU3RyaW5nKFZlbG9jaXR5LlN0YXRlLnByZWZpeEVsZW1lbnQuc3R5bGVbcHJvcGVydHlQcmVmaXhlZF0pKSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogQ2FjaGUgdGhlIG1hdGNoLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFZlbG9jaXR5LlN0YXRlLnByZWZpeE1hdGNoZXNbcHJvcGVydHldID0gcHJvcGVydHlQcmVmaXhlZDtcblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBbcHJvcGVydHlQcmVmaXhlZCwgdHJ1ZV07XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogSWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHRoaXMgcHJvcGVydHkgaW4gYW55IGZvcm0sIGluY2x1ZGUgYSBmYWxzZSBmbGFnIHNvIHRoYXQgdGhlIGNhbGxlciBjYW4gZGVjaWRlIGhvdyB0byBwcm9jZWVkLiAqL1xuXHRcdFx0XHRcdFx0cmV0dXJuIFtwcm9wZXJ0eSwgZmFsc2VdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBDU1MgUHJvcGVydHkgVmFsdWVzXG5cdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRWYWx1ZXM6IHtcblx0XHRcdFx0LyogSGV4IHRvIFJHQiBjb252ZXJzaW9uLiBDb3B5cmlnaHQgVGltIERvd246IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTYyMzgzOC9yZ2ItdG8taGV4LWFuZC1oZXgtdG8tcmdiICovXG5cdFx0XHRcdGhleFRvUmdiOiBmdW5jdGlvbihoZXgpIHtcblx0XHRcdFx0XHR2YXIgc2hvcnRmb3JtUmVnZXggPSAvXiM/KFthLWZcXGRdKShbYS1mXFxkXSkoW2EtZlxcZF0pJC9pLFxuXHRcdFx0XHRcdFx0XHRsb25nZm9ybVJlZ2V4ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaSxcblx0XHRcdFx0XHRcdFx0cmdiUGFydHM7XG5cblx0XHRcdFx0XHRoZXggPSBoZXgucmVwbGFjZShzaG9ydGZvcm1SZWdleCwgZnVuY3Rpb24obSwgciwgZywgYikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHJnYlBhcnRzID0gbG9uZ2Zvcm1SZWdleC5leGVjKGhleCk7XG5cblx0XHRcdFx0XHRyZXR1cm4gcmdiUGFydHMgPyBbcGFyc2VJbnQocmdiUGFydHNbMV0sIDE2KSwgcGFyc2VJbnQocmdiUGFydHNbMl0sIDE2KSwgcGFyc2VJbnQocmdiUGFydHNbM10sIDE2KV0gOiBbMCwgMCwgMF07XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGlzQ1NTTnVsbFZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0XHRcdC8qIFRoZSBicm93c2VyIGRlZmF1bHRzIENTUyB2YWx1ZXMgdGhhdCBoYXZlIG5vdCBiZWVuIHNldCB0byBlaXRoZXIgMCBvciBvbmUgb2Ygc2V2ZXJhbCBwb3NzaWJsZSBudWxsLXZhbHVlIHN0cmluZ3MuXG5cdFx0XHRcdFx0IFRodXMsIHdlIGNoZWNrIGZvciBib3RoIGZhbHNpbmVzcyBhbmQgdGhlc2Ugc3BlY2lhbCBzdHJpbmdzLiAqL1xuXHRcdFx0XHRcdC8qIE51bGwtdmFsdWUgY2hlY2tpbmcgaXMgcGVyZm9ybWVkIHRvIGRlZmF1bHQgdGhlIHNwZWNpYWwgc3RyaW5ncyB0byAwIChmb3IgdGhlIHNha2Ugb2YgdHdlZW5pbmcpIG9yIHRoZWlyIGhvb2tcblx0XHRcdFx0XHQgdGVtcGxhdGVzIGFzIGRlZmluZWQgYXMgQ1NTLkhvb2tzIChmb3IgdGhlIHNha2Ugb2YgaG9vayBpbmplY3Rpb24vZXh0cmFjdGlvbikuICovXG5cdFx0XHRcdFx0LyogTm90ZTogQ2hyb21lIHJldHVybnMgXCJyZ2JhKDAsIDAsIDAsIDApXCIgZm9yIGFuIHVuZGVmaW5lZCBjb2xvciB3aGVyZWFzIElFIHJldHVybnMgXCJ0cmFuc3BhcmVudFwiLiAqL1xuXHRcdFx0XHRcdHJldHVybiAoIXZhbHVlIHx8IC9eKG5vbmV8YXV0b3x0cmFuc3BhcmVudHwocmdiYVxcKDAsID8wLCA/MCwgPzBcXCkpKSQvaS50ZXN0KHZhbHVlKSk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdC8qIFJldHJpZXZlIGEgcHJvcGVydHkncyBkZWZhdWx0IHVuaXQgdHlwZS4gVXNlZCBmb3IgYXNzaWduaW5nIGEgdW5pdCB0eXBlIHdoZW4gb25lIGlzIG5vdCBzdXBwbGllZCBieSB0aGUgdXNlci4gKi9cblx0XHRcdFx0Z2V0VW5pdFR5cGU6IGZ1bmN0aW9uKHByb3BlcnR5KSB7XG5cdFx0XHRcdFx0aWYgKC9eKHJvdGF0ZXxza2V3KS9pLnRlc3QocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gXCJkZWdcIjtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKC8oXihzY2FsZXxzY2FsZVh8c2NhbGVZfHNjYWxlWnxhbHBoYXxmbGV4R3Jvd3xmbGV4SGVpZ2h0fHpJbmRleHxmb250V2VpZ2h0KSQpfCgob3BhY2l0eXxyZWR8Z3JlZW58Ymx1ZXxhbHBoYSkkKS9pLnRlc3QocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHQvKiBUaGUgYWJvdmUgcHJvcGVydGllcyBhcmUgdW5pdGxlc3MuICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gXCJcIjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0LyogRGVmYXVsdCB0byBweCBmb3IgYWxsIG90aGVyIHByb3BlcnRpZXMuICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gXCJweFwiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0LyogSFRNTCBlbGVtZW50cyBkZWZhdWx0IHRvIGFuIGFzc29jaWF0ZWQgZGlzcGxheSB0eXBlIHdoZW4gdGhleSdyZSBub3Qgc2V0IHRvIGRpc3BsYXk6bm9uZS4gKi9cblx0XHRcdFx0LyogTm90ZTogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIGZvciBjb3JyZWN0bHkgc2V0dGluZyB0aGUgbm9uLVwibm9uZVwiIGRpc3BsYXkgdmFsdWUgaW4gY2VydGFpbiBWZWxvY2l0eSByZWRpcmVjdHMsIHN1Y2ggYXMgZmFkZUluL091dC4gKi9cblx0XHRcdFx0Z2V0RGlzcGxheVR5cGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcblx0XHRcdFx0XHR2YXIgdGFnTmFtZSA9IGVsZW1lbnQgJiYgZWxlbWVudC50YWdOYW1lLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdGlmICgvXihifGJpZ3xpfHNtYWxsfHR0fGFiYnJ8YWNyb255bXxjaXRlfGNvZGV8ZGZufGVtfGtiZHxzdHJvbmd8c2FtcHx2YXJ8YXxiZG98YnJ8aW1nfG1hcHxvYmplY3R8cXxzY3JpcHR8c3BhbnxzdWJ8c3VwfGJ1dHRvbnxpbnB1dHxsYWJlbHxzZWxlY3R8dGV4dGFyZWEpJC9pLnRlc3QodGFnTmFtZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBcImlubGluZVwiO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoL14obGkpJC9pLnRlc3QodGFnTmFtZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBcImxpc3QtaXRlbVwiO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoL14odHIpJC9pLnRlc3QodGFnTmFtZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBcInRhYmxlLXJvd1wiO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoL14odGFibGUpJC9pLnRlc3QodGFnTmFtZSkpIHtcblx0XHRcdFx0XHRcdHJldHVybiBcInRhYmxlXCI7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICgvXih0Ym9keSkkL2kudGVzdCh0YWdOYW1lKSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFwidGFibGUtcm93LWdyb3VwXCI7XG5cdFx0XHRcdFx0XHQvKiBEZWZhdWx0IHRvIFwiYmxvY2tcIiB3aGVuIG5vIG1hdGNoIGlzIGZvdW5kLiAqL1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gXCJibG9ja1wiO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0LyogVGhlIGNsYXNzIGFkZC9yZW1vdmUgZnVuY3Rpb25zIGFyZSB1c2VkIHRvIHRlbXBvcmFyaWx5IGFwcGx5IGEgXCJ2ZWxvY2l0eS1hbmltYXRpbmdcIiBjbGFzcyB0byBlbGVtZW50cyB3aGlsZSB0aGV5J3JlIGFuaW1hdGluZy4gKi9cblx0XHRcdFx0YWRkQ2xhc3M6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdGlmIChlbGVtZW50LmNsYXNzTGlzdCkge1xuXHRcdFx0XHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVsZW1lbnQuY2xhc3NOYW1lICs9IChlbGVtZW50LmNsYXNzTmFtZS5sZW5ndGggPyBcIiBcIiA6IFwiXCIpICsgY2xhc3NOYW1lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0cmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdGlmIChlbGVtZW50LmNsYXNzTGlzdCkge1xuXHRcdFx0XHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUudG9TdHJpbmcoKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCIoXnxcXFxccylcIiArIGNsYXNzTmFtZS5zcGxpdChcIiBcIikuam9pbihcInxcIikgKyBcIihcXFxcc3wkKVwiLCBcImdpXCIpLCBcIiBcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBTdHlsZSBHZXR0aW5nICYgU2V0dGluZ1xuXHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdC8qIFRoZSBzaW5ndWxhciBnZXRQcm9wZXJ0eVZhbHVlLCB3aGljaCByb3V0ZXMgdGhlIGxvZ2ljIGZvciBhbGwgbm9ybWFsaXphdGlvbnMsIGhvb2tzLCBhbmQgc3RhbmRhcmQgQ1NTIHByb3BlcnRpZXMuICovXG5cdFx0XHRnZXRQcm9wZXJ0eVZhbHVlOiBmdW5jdGlvbihlbGVtZW50LCBwcm9wZXJ0eSwgcm9vdFByb3BlcnR5VmFsdWUsIGZvcmNlU3R5bGVMb29rdXApIHtcblx0XHRcdFx0LyogR2V0IGFuIGVsZW1lbnQncyBjb21wdXRlZCBwcm9wZXJ0eSB2YWx1ZS4gKi9cblx0XHRcdFx0LyogTm90ZTogUmV0cmlldmluZyB0aGUgdmFsdWUgb2YgYSBDU1MgcHJvcGVydHkgY2Fubm90IHNpbXBseSBiZSBwZXJmb3JtZWQgYnkgY2hlY2tpbmcgYW4gZWxlbWVudCdzXG5cdFx0XHRcdCBzdHlsZSBhdHRyaWJ1dGUgKHdoaWNoIG9ubHkgcmVmbGVjdHMgdXNlci1kZWZpbmVkIHZhbHVlcykuIEluc3RlYWQsIHRoZSBicm93c2VyIG11c3QgYmUgcXVlcmllZCBmb3IgYSBwcm9wZXJ0eSdzXG5cdFx0XHRcdCAqY29tcHV0ZWQqIHZhbHVlLiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCBnZXRDb21wdXRlZFN0eWxlIGhlcmU6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL2RvY3MvV2ViL0FQSS93aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSAqL1xuXHRcdFx0XHRmdW5jdGlvbiBjb21wdXRlUHJvcGVydHlWYWx1ZShlbGVtZW50LCBwcm9wZXJ0eSkge1xuXHRcdFx0XHRcdC8qIFdoZW4gYm94LXNpemluZyBpc24ndCBzZXQgdG8gYm9yZGVyLWJveCwgaGVpZ2h0IGFuZCB3aWR0aCBzdHlsZSB2YWx1ZXMgYXJlIGluY29ycmVjdGx5IGNvbXB1dGVkIHdoZW4gYW5cblx0XHRcdFx0XHQgZWxlbWVudCdzIHNjcm9sbGJhcnMgYXJlIHZpc2libGUgKHdoaWNoIGV4cGFuZHMgdGhlIGVsZW1lbnQncyBkaW1lbnNpb25zKS4gVGh1cywgd2UgZGVmZXIgdG8gdGhlIG1vcmUgYWNjdXJhdGVcblx0XHRcdFx0XHQgb2Zmc2V0SGVpZ2h0L1dpZHRoIHByb3BlcnR5LCB3aGljaCBpbmNsdWRlcyB0aGUgdG90YWwgZGltZW5zaW9ucyBmb3IgaW50ZXJpb3IsIGJvcmRlciwgcGFkZGluZywgYW5kIHNjcm9sbGJhci5cblx0XHRcdFx0XHQgV2Ugc3VidHJhY3QgYm9yZGVyIGFuZCBwYWRkaW5nIHRvIGdldCB0aGUgc3VtIG9mIGludGVyaW9yICsgc2Nyb2xsYmFyLiAqL1xuXHRcdFx0XHRcdHZhciBjb21wdXRlZFZhbHVlID0gMDtcblxuXHRcdFx0XHRcdC8qIElFPD04IGRvZXNuJ3Qgc3VwcG9ydCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSwgdGh1cyB3ZSBkZWZlciB0byBqUXVlcnksIHdoaWNoIGhhcyBhbiBleHRlbnNpdmUgYXJyYXlcblx0XHRcdFx0XHQgb2YgaGFja3MgdG8gYWNjdXJhdGVseSByZXRyaWV2ZSBJRTggcHJvcGVydHkgdmFsdWVzLiBSZS1pbXBsZW1lbnRpbmcgdGhhdCBsb2dpYyBoZXJlIGlzIG5vdCB3b3J0aCBibG9hdGluZyB0aGVcblx0XHRcdFx0XHQgY29kZWJhc2UgZm9yIGEgZHlpbmcgYnJvd3Nlci4gVGhlIHBlcmZvcm1hbmNlIHJlcGVyY3Vzc2lvbnMgb2YgdXNpbmcgalF1ZXJ5IGhlcmUgYXJlIG1pbmltYWwgc2luY2Vcblx0XHRcdFx0XHQgVmVsb2NpdHkgaXMgb3B0aW1pemVkIHRvIHJhcmVseSAoYW5kIHNvbWV0aW1lcyBuZXZlcikgcXVlcnkgdGhlIERPTS4gRnVydGhlciwgdGhlICQuY3NzKCkgY29kZXBhdGggaXNuJ3QgdGhhdCBzbG93LiAqL1xuXHRcdFx0XHRcdGlmIChJRSA8PSA4KSB7XG5cdFx0XHRcdFx0XHRjb21wdXRlZFZhbHVlID0gJC5jc3MoZWxlbWVudCwgcHJvcGVydHkpOyAvKiBHRVQgKi9cblx0XHRcdFx0XHRcdC8qIEFsbCBvdGhlciBicm93c2VycyBzdXBwb3J0IGdldENvbXB1dGVkU3R5bGUuIFRoZSByZXR1cm5lZCBsaXZlIG9iamVjdCByZWZlcmVuY2UgaXMgY2FjaGVkIG9udG8gaXRzXG5cdFx0XHRcdFx0XHQgYXNzb2NpYXRlZCBlbGVtZW50IHNvIHRoYXQgaXQgZG9lcyBub3QgbmVlZCB0byBiZSByZWZldGNoZWQgdXBvbiBldmVyeSBHRVQuICovXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8qIEJyb3dzZXJzIGRvIG5vdCByZXR1cm4gaGVpZ2h0IGFuZCB3aWR0aCB2YWx1ZXMgZm9yIGVsZW1lbnRzIHRoYXQgYXJlIHNldCB0byBkaXNwbGF5Olwibm9uZVwiLiBUaHVzLCB3ZSB0ZW1wb3JhcmlseVxuXHRcdFx0XHRcdFx0IHRvZ2dsZSBkaXNwbGF5IHRvIHRoZSBlbGVtZW50IHR5cGUncyBkZWZhdWx0IHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0dmFyIHRvZ2dsZURpc3BsYXkgPSBmYWxzZTtcblxuXHRcdFx0XHRcdFx0aWYgKC9eKHdpZHRofGhlaWdodCkkLy50ZXN0KHByb3BlcnR5KSAmJiBDU1MuZ2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcImRpc3BsYXlcIikgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0dG9nZ2xlRGlzcGxheSA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdENTUy5zZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwiZGlzcGxheVwiLCBDU1MuVmFsdWVzLmdldERpc3BsYXlUeXBlKGVsZW1lbnQpKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dmFyIHJldmVydERpc3BsYXkgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHRvZ2dsZURpc3BsYXkpIHtcblx0XHRcdFx0XHRcdFx0XHRDU1Muc2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpZiAoIWZvcmNlU3R5bGVMb29rdXApIHtcblx0XHRcdFx0XHRcdFx0aWYgKHByb3BlcnR5ID09PSBcImhlaWdodFwiICYmIENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwiYm94U2l6aW5nXCIpLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSAhPT0gXCJib3JkZXItYm94XCIpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgY29udGVudEJveEhlaWdodCA9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gKHBhcnNlRmxvYXQoQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJib3JkZXJUb3BXaWR0aFwiKSkgfHwgMCkgLSAocGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcImJvcmRlckJvdHRvbVdpZHRoXCIpKSB8fCAwKSAtIChwYXJzZUZsb2F0KENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwicGFkZGluZ1RvcFwiKSkgfHwgMCkgLSAocGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcInBhZGRpbmdCb3R0b21cIikpIHx8IDApO1xuXHRcdFx0XHRcdFx0XHRcdHJldmVydERpc3BsYXkoKTtcblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBjb250ZW50Qm94SGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHByb3BlcnR5ID09PSBcIndpZHRoXCIgJiYgQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJib3hTaXppbmdcIikudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpICE9PSBcImJvcmRlci1ib3hcIikge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBjb250ZW50Qm94V2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoIC0gKHBhcnNlRmxvYXQoQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJib3JkZXJMZWZ0V2lkdGhcIikpIHx8IDApIC0gKHBhcnNlRmxvYXQoQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJib3JkZXJSaWdodFdpZHRoXCIpKSB8fCAwKSAtIChwYXJzZUZsb2F0KENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwicGFkZGluZ0xlZnRcIikpIHx8IDApIC0gKHBhcnNlRmxvYXQoQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJwYWRkaW5nUmlnaHRcIikpIHx8IDApO1xuXHRcdFx0XHRcdFx0XHRcdHJldmVydERpc3BsYXkoKTtcblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBjb250ZW50Qm94V2lkdGg7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dmFyIGNvbXB1dGVkU3R5bGU7XG5cblx0XHRcdFx0XHRcdC8qIEZvciBlbGVtZW50cyB0aGF0IFZlbG9jaXR5IGhhc24ndCBiZWVuIGNhbGxlZCBvbiBkaXJlY3RseSAoZS5nLiB3aGVuIFZlbG9jaXR5IHF1ZXJpZXMgdGhlIERPTSBvbiBiZWhhbGZcblx0XHRcdFx0XHRcdCBvZiBhIHBhcmVudCBvZiBhbiBlbGVtZW50IGl0cyBhbmltYXRpbmcpLCBwZXJmb3JtIGEgZGlyZWN0IGdldENvbXB1dGVkU3R5bGUgbG9va3VwIHNpbmNlIHRoZSBvYmplY3QgaXNuJ3QgY2FjaGVkLiAqL1xuXHRcdFx0XHRcdFx0aWYgKERhdGEoZWxlbWVudCkgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0XHRjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHQvKiBJZiB0aGUgY29tcHV0ZWRTdHlsZSBvYmplY3QgaGFzIHlldCB0byBiZSBjYWNoZWQsIGRvIHNvIG5vdy4gKi9cblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIURhdGEoZWxlbWVudCkuY29tcHV0ZWRTdHlsZSkge1xuXHRcdFx0XHRcdFx0XHRjb21wdXRlZFN0eWxlID0gRGF0YShlbGVtZW50KS5jb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHQvKiBJZiBjb21wdXRlZFN0eWxlIGlzIGNhY2hlZCwgdXNlIGl0LiAqL1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y29tcHV0ZWRTdHlsZSA9IERhdGEoZWxlbWVudCkuY29tcHV0ZWRTdHlsZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogSUUgYW5kIEZpcmVmb3ggZG8gbm90IHJldHVybiBhIHZhbHVlIGZvciB0aGUgZ2VuZXJpYyBib3JkZXJDb2xvciAtLSB0aGV5IG9ubHkgcmV0dXJuIGluZGl2aWR1YWwgdmFsdWVzIGZvciBlYWNoIGJvcmRlciBzaWRlJ3MgY29sb3IuXG5cdFx0XHRcdFx0XHQgQWxzbywgaW4gYWxsIGJyb3dzZXJzLCB3aGVuIGJvcmRlciBjb2xvcnMgYXJlbid0IGFsbCB0aGUgc2FtZSwgYSBjb21wb3VuZCB2YWx1ZSBpcyByZXR1cm5lZCB0aGF0IFZlbG9jaXR5IGlzbid0IHNldHVwIHRvIHBhcnNlLlxuXHRcdFx0XHRcdFx0IFNvLCBhcyBhIHBvbHlmaWxsIGZvciBxdWVyeWluZyBpbmRpdmlkdWFsIGJvcmRlciBzaWRlIGNvbG9ycywgd2UganVzdCByZXR1cm4gdGhlIHRvcCBib3JkZXIncyBjb2xvciBhbmQgYW5pbWF0ZSBhbGwgYm9yZGVycyBmcm9tIHRoYXQgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRpZiAocHJvcGVydHkgPT09IFwiYm9yZGVyQ29sb3JcIikge1xuXHRcdFx0XHRcdFx0XHRwcm9wZXJ0eSA9IFwiYm9yZGVyVG9wQ29sb3JcIjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogSUU5IGhhcyBhIGJ1ZyBpbiB3aGljaCB0aGUgXCJmaWx0ZXJcIiBwcm9wZXJ0eSBtdXN0IGJlIGFjY2Vzc2VkIGZyb20gY29tcHV0ZWRTdHlsZSB1c2luZyB0aGUgZ2V0UHJvcGVydHlWYWx1ZSBtZXRob2Rcblx0XHRcdFx0XHRcdCBpbnN0ZWFkIG9mIGEgZGlyZWN0IHByb3BlcnR5IGxvb2t1cC4gVGhlIGdldFByb3BlcnR5VmFsdWUgbWV0aG9kIGlzIHNsb3dlciB0aGFuIGEgZGlyZWN0IGxvb2t1cCwgd2hpY2ggaXMgd2h5IHdlIGF2b2lkIGl0IGJ5IGRlZmF1bHQuICovXG5cdFx0XHRcdFx0XHRpZiAoSUUgPT09IDkgJiYgcHJvcGVydHkgPT09IFwiZmlsdGVyXCIpIHtcblx0XHRcdFx0XHRcdFx0Y29tcHV0ZWRWYWx1ZSA9IGNvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Y29tcHV0ZWRWYWx1ZSA9IGNvbXB1dGVkU3R5bGVbcHJvcGVydHldO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKiBGYWxsIGJhY2sgdG8gdGhlIHByb3BlcnR5J3Mgc3R5bGUgdmFsdWUgKGlmIGRlZmluZWQpIHdoZW4gY29tcHV0ZWRWYWx1ZSByZXR1cm5zIG5vdGhpbmcsXG5cdFx0XHRcdFx0XHQgd2hpY2ggY2FuIGhhcHBlbiB3aGVuIHRoZSBlbGVtZW50IGhhc24ndCBiZWVuIHBhaW50ZWQuICovXG5cdFx0XHRcdFx0XHRpZiAoY29tcHV0ZWRWYWx1ZSA9PT0gXCJcIiB8fCBjb21wdXRlZFZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdGNvbXB1dGVkVmFsdWUgPSBlbGVtZW50LnN0eWxlW3Byb3BlcnR5XTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV2ZXJ0RGlzcGxheSgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIEZvciB0b3AsIHJpZ2h0LCBib3R0b20sIGFuZCBsZWZ0IChUUkJMKSB2YWx1ZXMgdGhhdCBhcmUgc2V0IHRvIFwiYXV0b1wiIG9uIGVsZW1lbnRzIG9mIFwiZml4ZWRcIiBvciBcImFic29sdXRlXCIgcG9zaXRpb24sXG5cdFx0XHRcdFx0IGRlZmVyIHRvIGpRdWVyeSBmb3IgY29udmVydGluZyBcImF1dG9cIiB0byBhIG51bWVyaWMgdmFsdWUuIChGb3IgZWxlbWVudHMgd2l0aCBhIFwic3RhdGljXCIgb3IgXCJyZWxhdGl2ZVwiIHBvc2l0aW9uLCBcImF1dG9cIiBoYXMgdGhlIHNhbWVcblx0XHRcdFx0XHQgZWZmZWN0IGFzIGJlaW5nIHNldCB0byAwLCBzbyBubyBjb252ZXJzaW9uIGlzIG5lY2Vzc2FyeS4pICovXG5cdFx0XHRcdFx0LyogQW4gZXhhbXBsZSBvZiB3aHkgbnVtZXJpYyBjb252ZXJzaW9uIGlzIG5lY2Vzc2FyeTogV2hlbiBhbiBlbGVtZW50IHdpdGggXCJwb3NpdGlvbjphYnNvbHV0ZVwiIGhhcyBhbiB1bnRvdWNoZWQgXCJsZWZ0XCJcblx0XHRcdFx0XHQgcHJvcGVydHksIHdoaWNoIHJldmVydHMgdG8gXCJhdXRvXCIsIGxlZnQncyB2YWx1ZSBpcyAwIHJlbGF0aXZlIHRvIGl0cyBwYXJlbnQgZWxlbWVudCwgYnV0IGlzIG9mdGVuIG5vbi16ZXJvIHJlbGF0aXZlXG5cdFx0XHRcdFx0IHRvIGl0cyAqY29udGFpbmluZyogKG5vdCBwYXJlbnQpIGVsZW1lbnQsIHdoaWNoIGlzIHRoZSBuZWFyZXN0IFwicG9zaXRpb246cmVsYXRpdmVcIiBhbmNlc3RvciBvciB0aGUgdmlld3BvcnQgKGFuZCBhbHdheXMgdGhlIHZpZXdwb3J0IGluIHRoZSBjYXNlIG9mIFwicG9zaXRpb246Zml4ZWRcIikuICovXG5cdFx0XHRcdFx0aWYgKGNvbXB1dGVkVmFsdWUgPT09IFwiYXV0b1wiICYmIC9eKHRvcHxyaWdodHxib3R0b218bGVmdCkkL2kudGVzdChwcm9wZXJ0eSkpIHtcblx0XHRcdFx0XHRcdHZhciBwb3NpdGlvbiA9IGNvbXB1dGVQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwicG9zaXRpb25cIik7IC8qIEdFVCAqL1xuXG5cdFx0XHRcdFx0XHQvKiBGb3IgYWJzb2x1dGUgcG9zaXRpb25pbmcsIGpRdWVyeSdzICQucG9zaXRpb24oKSBvbmx5IHJldHVybnMgdmFsdWVzIGZvciB0b3AgYW5kIGxlZnQ7XG5cdFx0XHRcdFx0XHQgcmlnaHQgYW5kIGJvdHRvbSB3aWxsIGhhdmUgdGhlaXIgXCJhdXRvXCIgdmFsdWUgcmV2ZXJ0ZWQgdG8gMC4gKi9cblx0XHRcdFx0XHRcdC8qIE5vdGU6IEEgalF1ZXJ5IG9iamVjdCBtdXN0IGJlIGNyZWF0ZWQgaGVyZSBzaW5jZSBqUXVlcnkgZG9lc24ndCBoYXZlIGEgbG93LWxldmVsIGFsaWFzIGZvciAkLnBvc2l0aW9uKCkuXG5cdFx0XHRcdFx0XHQgTm90IGEgYmlnIGRlYWwgc2luY2Ugd2UncmUgY3VycmVudGx5IGluIGEgR0VUIGJhdGNoIGFueXdheS4gKi9cblx0XHRcdFx0XHRcdGlmIChwb3NpdGlvbiA9PT0gXCJmaXhlZFwiIHx8IChwb3NpdGlvbiA9PT0gXCJhYnNvbHV0ZVwiICYmIC90b3B8bGVmdC9pLnRlc3QocHJvcGVydHkpKSkge1xuXHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBqUXVlcnkgc3RyaXBzIHRoZSBwaXhlbCB1bml0IGZyb20gaXRzIHJldHVybmVkIHZhbHVlczsgd2UgcmUtYWRkIGl0IGhlcmUgdG8gY29uZm9ybSB3aXRoIGNvbXB1dGVQcm9wZXJ0eVZhbHVlJ3MgYmVoYXZpb3IuICovXG5cdFx0XHRcdFx0XHRcdGNvbXB1dGVkVmFsdWUgPSAkKGVsZW1lbnQpLnBvc2l0aW9uKClbcHJvcGVydHldICsgXCJweFwiOyAvKiBHRVQgKi9cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gY29tcHV0ZWRWYWx1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBwcm9wZXJ0eVZhbHVlO1xuXG5cdFx0XHRcdC8qIElmIHRoaXMgaXMgYSBob29rZWQgcHJvcGVydHkgKGUuZy4gXCJjbGlwTGVmdFwiIGluc3RlYWQgb2YgdGhlIHJvb3QgcHJvcGVydHkgb2YgXCJjbGlwXCIpLFxuXHRcdFx0XHQgZXh0cmFjdCB0aGUgaG9vaydzIHZhbHVlIGZyb20gYSBub3JtYWxpemVkIHJvb3RQcm9wZXJ0eVZhbHVlIHVzaW5nIENTUy5Ib29rcy5leHRyYWN0VmFsdWUoKS4gKi9cblx0XHRcdFx0aWYgKENTUy5Ib29rcy5yZWdpc3RlcmVkW3Byb3BlcnR5XSkge1xuXHRcdFx0XHRcdHZhciBob29rID0gcHJvcGVydHksXG5cdFx0XHRcdFx0XHRcdGhvb2tSb290ID0gQ1NTLkhvb2tzLmdldFJvb3QoaG9vayk7XG5cblx0XHRcdFx0XHQvKiBJZiBhIGNhY2hlZCByb290UHJvcGVydHlWYWx1ZSB3YXNuJ3QgcGFzc2VkIGluICh3aGljaCBWZWxvY2l0eSBhbHdheXMgYXR0ZW1wdHMgdG8gZG8gaW4gb3JkZXIgdG8gYXZvaWQgcmVxdWVyeWluZyB0aGUgRE9NKSxcblx0XHRcdFx0XHQgcXVlcnkgdGhlIERPTSBmb3IgdGhlIHJvb3QgcHJvcGVydHkncyB2YWx1ZS4gKi9cblx0XHRcdFx0XHRpZiAocm9vdFByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0LyogU2luY2UgdGhlIGJyb3dzZXIgaXMgbm93IGJlaW5nIGRpcmVjdGx5IHF1ZXJpZWQsIHVzZSB0aGUgb2ZmaWNpYWwgcG9zdC1wcmVmaXhpbmcgcHJvcGVydHkgbmFtZSBmb3IgdGhpcyBsb29rdXAuICovXG5cdFx0XHRcdFx0XHRyb290UHJvcGVydHlWYWx1ZSA9IENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIENTUy5OYW1lcy5wcmVmaXhDaGVjayhob29rUm9vdClbMF0pOyAvKiBHRVQgKi9cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvKiBJZiB0aGlzIHJvb3QgaGFzIGEgbm9ybWFsaXphdGlvbiByZWdpc3RlcmVkLCBwZWZvcm0gdGhlIGFzc29jaWF0ZWQgbm9ybWFsaXphdGlvbiBleHRyYWN0aW9uLiAqL1xuXHRcdFx0XHRcdGlmIChDU1MuTm9ybWFsaXphdGlvbnMucmVnaXN0ZXJlZFtob29rUm9vdF0pIHtcblx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlID0gQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbaG9va1Jvb3RdKFwiZXh0cmFjdFwiLCBlbGVtZW50LCByb290UHJvcGVydHlWYWx1ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0LyogRXh0cmFjdCB0aGUgaG9vaydzIHZhbHVlLiAqL1xuXHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSBDU1MuSG9va3MuZXh0cmFjdFZhbHVlKGhvb2ssIHJvb3RQcm9wZXJ0eVZhbHVlKTtcblxuXHRcdFx0XHRcdC8qIElmIHRoaXMgaXMgYSBub3JtYWxpemVkIHByb3BlcnR5IChlLmcuIFwib3BhY2l0eVwiIGJlY29tZXMgXCJmaWx0ZXJcIiBpbiA8PUlFOCkgb3IgXCJ0cmFuc2xhdGVYXCIgYmVjb21lcyBcInRyYW5zZm9ybVwiKSxcblx0XHRcdFx0XHQgbm9ybWFsaXplIHRoZSBwcm9wZXJ0eSdzIG5hbWUgYW5kIHZhbHVlLCBhbmQgaGFuZGxlIHRoZSBzcGVjaWFsIGNhc2Ugb2YgdHJhbnNmb3Jtcy4gKi9cblx0XHRcdFx0XHQvKiBOb3RlOiBOb3JtYWxpemluZyBhIHByb3BlcnR5IGlzIG11dHVhbGx5IGV4Y2x1c2l2ZSBmcm9tIGhvb2tpbmcgYSBwcm9wZXJ0eSBzaW5jZSBob29rLWV4dHJhY3RlZCB2YWx1ZXMgYXJlIHN0cmljdGx5XG5cdFx0XHRcdFx0IG51bWVyaWNhbCBhbmQgdGhlcmVmb3JlIGRvIG5vdCByZXF1aXJlIG5vcm1hbGl6YXRpb24gZXh0cmFjdGlvbi4gKi9cblx0XHRcdFx0fSBlbHNlIGlmIChDU1MuTm9ybWFsaXphdGlvbnMucmVnaXN0ZXJlZFtwcm9wZXJ0eV0pIHtcblx0XHRcdFx0XHR2YXIgbm9ybWFsaXplZFByb3BlcnR5TmFtZSxcblx0XHRcdFx0XHRcdFx0bm9ybWFsaXplZFByb3BlcnR5VmFsdWU7XG5cblx0XHRcdFx0XHRub3JtYWxpemVkUHJvcGVydHlOYW1lID0gQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcHJvcGVydHldKFwibmFtZVwiLCBlbGVtZW50KTtcblxuXHRcdFx0XHRcdC8qIFRyYW5zZm9ybSB2YWx1ZXMgYXJlIGNhbGN1bGF0ZWQgdmlhIG5vcm1hbGl6YXRpb24gZXh0cmFjdGlvbiAoc2VlIGJlbG93KSwgd2hpY2ggY2hlY2tzIGFnYWluc3QgdGhlIGVsZW1lbnQncyB0cmFuc2Zvcm1DYWNoZS5cblx0XHRcdFx0XHQgQXQgbm8gcG9pbnQgZG8gdHJhbnNmb3JtIEdFVHMgZXZlciBhY3R1YWxseSBxdWVyeSB0aGUgRE9NOyBpbml0aWFsIHN0eWxlc2hlZXQgdmFsdWVzIGFyZSBuZXZlciBwcm9jZXNzZWQuXG5cdFx0XHRcdFx0IFRoaXMgaXMgYmVjYXVzZSBwYXJzaW5nIDNEIHRyYW5zZm9ybSBtYXRyaWNlcyBpcyBub3QgYWx3YXlzIGFjY3VyYXRlIGFuZCB3b3VsZCBibG9hdCBvdXIgY29kZWJhc2U7XG5cdFx0XHRcdFx0IHRodXMsIG5vcm1hbGl6YXRpb24gZXh0cmFjdGlvbiBkZWZhdWx0cyBpbml0aWFsIHRyYW5zZm9ybSB2YWx1ZXMgdG8gdGhlaXIgemVyby12YWx1ZXMgKGUuZy4gMSBmb3Igc2NhbGVYIGFuZCAwIGZvciB0cmFuc2xhdGVYKS4gKi9cblx0XHRcdFx0XHRpZiAobm9ybWFsaXplZFByb3BlcnR5TmFtZSAhPT0gXCJ0cmFuc2Zvcm1cIikge1xuXHRcdFx0XHRcdFx0bm9ybWFsaXplZFByb3BlcnR5VmFsdWUgPSBjb21wdXRlUHJvcGVydHlWYWx1ZShlbGVtZW50LCBDU1MuTmFtZXMucHJlZml4Q2hlY2sobm9ybWFsaXplZFByb3BlcnR5TmFtZSlbMF0pOyAvKiBHRVQgKi9cblxuXHRcdFx0XHRcdFx0LyogSWYgdGhlIHZhbHVlIGlzIGEgQ1NTIG51bGwtdmFsdWUgYW5kIHRoaXMgcHJvcGVydHkgaGFzIGEgaG9vayB0ZW1wbGF0ZSwgdXNlIHRoYXQgemVyby12YWx1ZSB0ZW1wbGF0ZSBzbyB0aGF0IGhvb2tzIGNhbiBiZSBleHRyYWN0ZWQgZnJvbSBpdC4gKi9cblx0XHRcdFx0XHRcdGlmIChDU1MuVmFsdWVzLmlzQ1NTTnVsbFZhbHVlKG5vcm1hbGl6ZWRQcm9wZXJ0eVZhbHVlKSAmJiBDU1MuSG9va3MudGVtcGxhdGVzW3Byb3BlcnR5XSkge1xuXHRcdFx0XHRcdFx0XHRub3JtYWxpemVkUHJvcGVydHlWYWx1ZSA9IENTUy5Ib29rcy50ZW1wbGF0ZXNbcHJvcGVydHldWzFdO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSBDU1MuTm9ybWFsaXphdGlvbnMucmVnaXN0ZXJlZFtwcm9wZXJ0eV0oXCJleHRyYWN0XCIsIGVsZW1lbnQsIG5vcm1hbGl6ZWRQcm9wZXJ0eVZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qIElmIGEgKG51bWVyaWMpIHZhbHVlIHdhc24ndCBwcm9kdWNlZCB2aWEgaG9vayBleHRyYWN0aW9uIG9yIG5vcm1hbGl6YXRpb24sIHF1ZXJ5IHRoZSBET00uICovXG5cdFx0XHRcdGlmICghL15bXFxkLV0vLnRlc3QocHJvcGVydHlWYWx1ZSkpIHtcblx0XHRcdFx0XHQvKiBGb3IgU1ZHIGVsZW1lbnRzLCBkaW1lbnNpb25hbCBwcm9wZXJ0aWVzICh3aGljaCBTVkdBdHRyaWJ1dGUoKSBkZXRlY3RzKSBhcmUgdHdlZW5lZCB2aWFcblx0XHRcdFx0XHQgdGhlaXIgSFRNTCBhdHRyaWJ1dGUgdmFsdWVzIGluc3RlYWQgb2YgdGhlaXIgQ1NTIHN0eWxlIHZhbHVlcy4gKi9cblx0XHRcdFx0XHR2YXIgZGF0YSA9IERhdGEoZWxlbWVudCk7XG5cblx0XHRcdFx0XHRpZiAoZGF0YSAmJiBkYXRhLmlzU1ZHICYmIENTUy5OYW1lcy5TVkdBdHRyaWJ1dGUocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHQvKiBTaW5jZSB0aGUgaGVpZ2h0L3dpZHRoIGF0dHJpYnV0ZSB2YWx1ZXMgbXVzdCBiZSBzZXQgbWFudWFsbHksIHRoZXkgZG9uJ3QgcmVmbGVjdCBjb21wdXRlZCB2YWx1ZXMuXG5cdFx0XHRcdFx0XHQgVGh1cywgd2UgdXNlIHVzZSBnZXRCQm94KCkgdG8gZW5zdXJlIHdlIGFsd2F5cyBnZXQgdmFsdWVzIGZvciBlbGVtZW50cyB3aXRoIHVuZGVmaW5lZCBoZWlnaHQvd2lkdGggYXR0cmlidXRlcy4gKi9cblx0XHRcdFx0XHRcdGlmICgvXihoZWlnaHR8d2lkdGgpJC9pLnRlc3QocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdC8qIEZpcmVmb3ggdGhyb3dzIGFuIGVycm9yIGlmIC5nZXRCQm94KCkgaXMgY2FsbGVkIG9uIGFuIFNWRyB0aGF0IGlzbid0IGF0dGFjaGVkIHRvIHRoZSBET00uICovXG5cdFx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IGVsZW1lbnQuZ2V0QkJveCgpW3Byb3BlcnR5XTtcblx0XHRcdFx0XHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0eVZhbHVlID0gMDtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHQvKiBPdGhlcndpc2UsIGFjY2VzcyB0aGUgYXR0cmlidXRlIHZhbHVlIGRpcmVjdGx5LiAqL1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKHByb3BlcnR5KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IGNvbXB1dGVQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIENTUy5OYW1lcy5wcmVmaXhDaGVjayhwcm9wZXJ0eSlbMF0pOyAvKiBHRVQgKi9cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKiBTaW5jZSBwcm9wZXJ0eSBsb29rdXBzIGFyZSBmb3IgYW5pbWF0aW9uIHB1cnBvc2VzICh3aGljaCBlbnRhaWxzIGNvbXB1dGluZyB0aGUgbnVtZXJpYyBkZWx0YSBiZXR3ZWVuIHN0YXJ0IGFuZCBlbmQgdmFsdWVzKSxcblx0XHRcdFx0IGNvbnZlcnQgQ1NTIG51bGwtdmFsdWVzIHRvIGFuIGludGVnZXIgb2YgdmFsdWUgMC4gKi9cblx0XHRcdFx0aWYgKENTUy5WYWx1ZXMuaXNDU1NOdWxsVmFsdWUocHJvcGVydHlWYWx1ZSkpIHtcblx0XHRcdFx0XHRwcm9wZXJ0eVZhbHVlID0gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChWZWxvY2l0eS5kZWJ1ZyA+PSAyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJHZXQgXCIgKyBwcm9wZXJ0eSArIFwiOiBcIiArIHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHByb3BlcnR5VmFsdWU7XG5cdFx0XHR9LFxuXHRcdFx0LyogVGhlIHNpbmd1bGFyIHNldFByb3BlcnR5VmFsdWUsIHdoaWNoIHJvdXRlcyB0aGUgbG9naWMgZm9yIGFsbCBub3JtYWxpemF0aW9ucywgaG9va3MsIGFuZCBzdGFuZGFyZCBDU1MgcHJvcGVydGllcy4gKi9cblx0XHRcdHNldFByb3BlcnR5VmFsdWU6IGZ1bmN0aW9uKGVsZW1lbnQsIHByb3BlcnR5LCBwcm9wZXJ0eVZhbHVlLCByb290UHJvcGVydHlWYWx1ZSwgc2Nyb2xsRGF0YSkge1xuXHRcdFx0XHR2YXIgcHJvcGVydHlOYW1lID0gcHJvcGVydHk7XG5cblx0XHRcdFx0LyogSW4gb3JkZXIgdG8gYmUgc3ViamVjdGVkIHRvIGNhbGwgb3B0aW9ucyBhbmQgZWxlbWVudCBxdWV1ZWluZywgc2Nyb2xsIGFuaW1hdGlvbiBpcyByb3V0ZWQgdGhyb3VnaCBWZWxvY2l0eSBhcyBpZiBpdCB3ZXJlIGEgc3RhbmRhcmQgQ1NTIHByb3BlcnR5LiAqL1xuXHRcdFx0XHRpZiAocHJvcGVydHkgPT09IFwic2Nyb2xsXCIpIHtcblx0XHRcdFx0XHQvKiBJZiBhIGNvbnRhaW5lciBvcHRpb24gaXMgcHJlc2VudCwgc2Nyb2xsIHRoZSBjb250YWluZXIgaW5zdGVhZCBvZiB0aGUgYnJvd3NlciB3aW5kb3cuICovXG5cdFx0XHRcdFx0aWYgKHNjcm9sbERhdGEuY29udGFpbmVyKSB7XG5cdFx0XHRcdFx0XHRzY3JvbGxEYXRhLmNvbnRhaW5lcltcInNjcm9sbFwiICsgc2Nyb2xsRGF0YS5kaXJlY3Rpb25dID0gcHJvcGVydHlWYWx1ZTtcblx0XHRcdFx0XHRcdC8qIE90aGVyd2lzZSwgVmVsb2NpdHkgZGVmYXVsdHMgdG8gc2Nyb2xsaW5nIHRoZSBicm93c2VyIHdpbmRvdy4gKi9cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0aWYgKHNjcm9sbERhdGEuZGlyZWN0aW9uID09PSBcIkxlZnRcIikge1xuXHRcdFx0XHRcdFx0XHR3aW5kb3cuc2Nyb2xsVG8ocHJvcGVydHlWYWx1ZSwgc2Nyb2xsRGF0YS5hbHRlcm5hdGVWYWx1ZSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR3aW5kb3cuc2Nyb2xsVG8oc2Nyb2xsRGF0YS5hbHRlcm5hdGVWYWx1ZSwgcHJvcGVydHlWYWx1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8qIFRyYW5zZm9ybXMgKHRyYW5zbGF0ZVgsIHJvdGF0ZVosIGV0Yy4pIGFyZSBhcHBsaWVkIHRvIGEgcGVyLWVsZW1lbnQgdHJhbnNmb3JtQ2FjaGUgb2JqZWN0LCB3aGljaCBpcyBtYW51YWxseSBmbHVzaGVkIHZpYSBmbHVzaFRyYW5zZm9ybUNhY2hlKCkuXG5cdFx0XHRcdFx0IFRodXMsIGZvciBub3csIHdlIG1lcmVseSBjYWNoZSB0cmFuc2Zvcm1zIGJlaW5nIFNFVC4gKi9cblx0XHRcdFx0XHRpZiAoQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcHJvcGVydHldICYmIENTUy5Ob3JtYWxpemF0aW9ucy5yZWdpc3RlcmVkW3Byb3BlcnR5XShcIm5hbWVcIiwgZWxlbWVudCkgPT09IFwidHJhbnNmb3JtXCIpIHtcblx0XHRcdFx0XHRcdC8qIFBlcmZvcm0gYSBub3JtYWxpemF0aW9uIGluamVjdGlvbi4gKi9cblx0XHRcdFx0XHRcdC8qIE5vdGU6IFRoZSBub3JtYWxpemF0aW9uIGxvZ2ljIGhhbmRsZXMgdGhlIHRyYW5zZm9ybUNhY2hlIHVwZGF0aW5nLiAqL1xuXHRcdFx0XHRcdFx0Q1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcHJvcGVydHldKFwiaW5qZWN0XCIsIGVsZW1lbnQsIHByb3BlcnR5VmFsdWUpO1xuXG5cdFx0XHRcdFx0XHRwcm9wZXJ0eU5hbWUgPSBcInRyYW5zZm9ybVwiO1xuXHRcdFx0XHRcdFx0cHJvcGVydHlWYWx1ZSA9IERhdGEoZWxlbWVudCkudHJhbnNmb3JtQ2FjaGVbcHJvcGVydHldO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQvKiBJbmplY3QgaG9va3MuICovXG5cdFx0XHRcdFx0XHRpZiAoQ1NTLkhvb2tzLnJlZ2lzdGVyZWRbcHJvcGVydHldKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBob29rTmFtZSA9IHByb3BlcnR5LFxuXHRcdFx0XHRcdFx0XHRcdFx0aG9va1Jvb3QgPSBDU1MuSG9va3MuZ2V0Um9vdChwcm9wZXJ0eSk7XG5cblx0XHRcdFx0XHRcdFx0LyogSWYgYSBjYWNoZWQgcm9vdFByb3BlcnR5VmFsdWUgd2FzIG5vdCBwcm92aWRlZCwgcXVlcnkgdGhlIERPTSBmb3IgdGhlIGhvb2tSb290J3MgY3VycmVudCB2YWx1ZS4gKi9cblx0XHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWUgPSByb290UHJvcGVydHlWYWx1ZSB8fCBDU1MuZ2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBob29rUm9vdCk7IC8qIEdFVCAqL1xuXG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSBDU1MuSG9va3MuaW5qZWN0VmFsdWUoaG9va05hbWUsIHByb3BlcnR5VmFsdWUsIHJvb3RQcm9wZXJ0eVZhbHVlKTtcblx0XHRcdFx0XHRcdFx0cHJvcGVydHkgPSBob29rUm9vdDtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogTm9ybWFsaXplIG5hbWVzIGFuZCB2YWx1ZXMuICovXG5cdFx0XHRcdFx0XHRpZiAoQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcHJvcGVydHldKSB7XG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5VmFsdWUgPSBDU1MuTm9ybWFsaXphdGlvbnMucmVnaXN0ZXJlZFtwcm9wZXJ0eV0oXCJpbmplY3RcIiwgZWxlbWVudCwgcHJvcGVydHlWYWx1ZSk7XG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5ID0gQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcHJvcGVydHldKFwibmFtZVwiLCBlbGVtZW50KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogQXNzaWduIHRoZSBhcHByb3ByaWF0ZSB2ZW5kb3IgcHJlZml4IGJlZm9yZSBwZXJmb3JtaW5nIGFuIG9mZmljaWFsIHN0eWxlIHVwZGF0ZS4gKi9cblx0XHRcdFx0XHRcdHByb3BlcnR5TmFtZSA9IENTUy5OYW1lcy5wcmVmaXhDaGVjayhwcm9wZXJ0eSlbMF07XG5cblx0XHRcdFx0XHRcdC8qIEEgdHJ5L2NhdGNoIGlzIHVzZWQgZm9yIElFPD04LCB3aGljaCB0aHJvd3MgYW4gZXJyb3Igd2hlbiBcImludmFsaWRcIiBDU1MgdmFsdWVzIGFyZSBzZXQsIGUuZy4gYSBuZWdhdGl2ZSB3aWR0aC5cblx0XHRcdFx0XHRcdCBUcnkvY2F0Y2ggaXMgYXZvaWRlZCBmb3Igb3RoZXIgYnJvd3NlcnMgc2luY2UgaXQgaW5jdXJzIGEgcGVyZm9ybWFuY2Ugb3ZlcmhlYWQuICovXG5cdFx0XHRcdFx0XHRpZiAoSUUgPD0gOCkge1xuXHRcdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRcdGVsZW1lbnQuc3R5bGVbcHJvcGVydHlOYW1lXSA9IHByb3BlcnR5VmFsdWU7XG5cdFx0XHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKFZlbG9jaXR5LmRlYnVnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBbXCIgKyBwcm9wZXJ0eVZhbHVlICsgXCJdIGZvciBbXCIgKyBwcm9wZXJ0eU5hbWUgKyBcIl1cIik7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdC8qIFNWRyBlbGVtZW50cyBoYXZlIHRoZWlyIGRpbWVuc2lvbmFsIHByb3BlcnRpZXMgKHdpZHRoLCBoZWlnaHQsIHgsIHksIGN4LCBldGMuKSBhcHBsaWVkIGRpcmVjdGx5IGFzIGF0dHJpYnV0ZXMgaW5zdGVhZCBvZiBhcyBzdHlsZXMuICovXG5cdFx0XHRcdFx0XHRcdC8qIE5vdGU6IElFOCBkb2VzIG5vdCBzdXBwb3J0IFNWRyBlbGVtZW50cywgc28gaXQncyBva2F5IHRoYXQgd2Ugc2tpcCBpdCBmb3IgU1ZHIGFuaW1hdGlvbi4gKi9cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHZhciBkYXRhID0gRGF0YShlbGVtZW50KTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoZGF0YSAmJiBkYXRhLmlzU1ZHICYmIENTUy5OYW1lcy5TVkdBdHRyaWJ1dGUocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogTm90ZTogRm9yIFNWRyBhdHRyaWJ1dGVzLCB2ZW5kb3ItcHJlZml4ZWQgcHJvcGVydHkgbmFtZXMgYXJlIG5ldmVyIHVzZWQuICovXG5cdFx0XHRcdFx0XHRcdFx0LyogTm90ZTogTm90IGFsbCBDU1MgcHJvcGVydGllcyBjYW4gYmUgYW5pbWF0ZWQgdmlhIGF0dHJpYnV0ZXMsIGJ1dCB0aGUgYnJvd3NlciB3b24ndCB0aHJvdyBhbiBlcnJvciBmb3IgdW5zdXBwb3J0ZWQgcHJvcGVydGllcy4gKi9cblx0XHRcdFx0XHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShwcm9wZXJ0eSwgcHJvcGVydHlWYWx1ZSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0ZWxlbWVudC5zdHlsZVtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoVmVsb2NpdHkuZGVidWcgPj0gMikge1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIlNldCBcIiArIHByb3BlcnR5ICsgXCIgKFwiICsgcHJvcGVydHlOYW1lICsgXCIpOiBcIiArIHByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qIFJldHVybiB0aGUgbm9ybWFsaXplZCBwcm9wZXJ0eSBuYW1lIGFuZCB2YWx1ZSBpbiBjYXNlIHRoZSBjYWxsZXIgd2FudHMgdG8ga25vdyBob3cgdGhlc2UgdmFsdWVzIHdlcmUgbW9kaWZpZWQgYmVmb3JlIGJlaW5nIGFwcGxpZWQgdG8gdGhlIERPTS4gKi9cblx0XHRcdFx0cmV0dXJuIFtwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWVdO1xuXHRcdFx0fSxcblx0XHRcdC8qIFRvIGluY3JlYXNlIHBlcmZvcm1hbmNlIGJ5IGJhdGNoaW5nIHRyYW5zZm9ybSB1cGRhdGVzIGludG8gYSBzaW5nbGUgU0VULCB0cmFuc2Zvcm1zIGFyZSBub3QgZGlyZWN0bHkgYXBwbGllZCB0byBhbiBlbGVtZW50IHVudGlsIGZsdXNoVHJhbnNmb3JtQ2FjaGUoKSBpcyBjYWxsZWQuICovXG5cdFx0XHQvKiBOb3RlOiBWZWxvY2l0eSBhcHBsaWVzIHRyYW5zZm9ybSBwcm9wZXJ0aWVzIGluIHRoZSBzYW1lIG9yZGVyIHRoYXQgdGhleSBhcmUgY2hyb25vZ2ljYWxseSBpbnRyb2R1Y2VkIHRvIHRoZSBlbGVtZW50J3MgQ1NTIHN0eWxlcy4gKi9cblx0XHRcdGZsdXNoVHJhbnNmb3JtQ2FjaGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcblx0XHRcdFx0dmFyIHRyYW5zZm9ybVN0cmluZyA9IFwiXCIsXG5cdFx0XHRcdFx0XHRkYXRhID0gRGF0YShlbGVtZW50KTtcblxuXHRcdFx0XHQvKiBDZXJ0YWluIGJyb3dzZXJzIHJlcXVpcmUgdGhhdCBTVkcgdHJhbnNmb3JtcyBiZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZS4gSG93ZXZlciwgdGhlIFNWRyB0cmFuc2Zvcm0gYXR0cmlidXRlIHRha2VzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiBDU1MncyB0cmFuc2Zvcm0gc3RyaW5nXG5cdFx0XHRcdCAodW5pdHMgYXJlIGRyb3BwZWQgYW5kLCBleGNlcHQgZm9yIHNrZXdYL1ksIHN1YnByb3BlcnRpZXMgYXJlIG1lcmdlZCBpbnRvIHRoZWlyIG1hc3RlciBwcm9wZXJ0eSAtLSBlLmcuIHNjYWxlWCBhbmQgc2NhbGVZIGFyZSBtZXJnZWQgaW50byBzY2FsZShYIFkpLiAqL1xuXHRcdFx0XHRpZiAoKElFIHx8IChWZWxvY2l0eS5TdGF0ZS5pc0FuZHJvaWQgJiYgIVZlbG9jaXR5LlN0YXRlLmlzQ2hyb21lKSkgJiYgZGF0YSAmJiBkYXRhLmlzU1ZHKSB7XG5cdFx0XHRcdFx0LyogU2luY2UgdHJhbnNmb3JtIHZhbHVlcyBhcmUgc3RvcmVkIGluIHRoZWlyIHBhcmVudGhlc2VzLXdyYXBwZWQgZm9ybSwgd2UgdXNlIGEgaGVscGVyIGZ1bmN0aW9uIHRvIHN0cmlwIG91dCB0aGVpciBudW1lcmljIHZhbHVlcy5cblx0XHRcdFx0XHQgRnVydGhlciwgU1ZHIHRyYW5zZm9ybSBwcm9wZXJ0aWVzIG9ubHkgdGFrZSB1bml0bGVzcyAocmVwcmVzZW50aW5nIHBpeGVscykgdmFsdWVzLCBzbyBpdCdzIG9rYXkgdGhhdCBwYXJzZUZsb2F0KCkgc3RyaXBzIHRoZSB1bml0IHN1ZmZpeGVkIHRvIHRoZSBmbG9hdCB2YWx1ZS4gKi9cblx0XHRcdFx0XHR2YXIgZ2V0VHJhbnNmb3JtRmxvYXQgPSBmdW5jdGlvbih0cmFuc2Zvcm1Qcm9wZXJ0eSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHBhcnNlRmxvYXQoQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgdHJhbnNmb3JtUHJvcGVydHkpKTtcblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0LyogQ3JlYXRlIGFuIG9iamVjdCB0byBvcmdhbml6ZSBhbGwgdGhlIHRyYW5zZm9ybXMgdGhhdCB3ZSdsbCBhcHBseSB0byB0aGUgU1ZHIGVsZW1lbnQuIFRvIGtlZXAgdGhlIGxvZ2ljIHNpbXBsZSxcblx0XHRcdFx0XHQgd2UgcHJvY2VzcyAqYWxsKiB0cmFuc2Zvcm0gcHJvcGVydGllcyAtLSBldmVuIHRob3NlIHRoYXQgbWF5IG5vdCBiZSBleHBsaWNpdGx5IGFwcGxpZWQgKHNpbmNlIHRoZXkgZGVmYXVsdCB0byB0aGVpciB6ZXJvLXZhbHVlcyBhbnl3YXkpLiAqL1xuXHRcdFx0XHRcdHZhciBTVkdUcmFuc2Zvcm1zID0ge1xuXHRcdFx0XHRcdFx0dHJhbnNsYXRlOiBbZ2V0VHJhbnNmb3JtRmxvYXQoXCJ0cmFuc2xhdGVYXCIpLCBnZXRUcmFuc2Zvcm1GbG9hdChcInRyYW5zbGF0ZVlcIildLFxuXHRcdFx0XHRcdFx0c2tld1g6IFtnZXRUcmFuc2Zvcm1GbG9hdChcInNrZXdYXCIpXSwgc2tld1k6IFtnZXRUcmFuc2Zvcm1GbG9hdChcInNrZXdZXCIpXSxcblx0XHRcdFx0XHRcdC8qIElmIHRoZSBzY2FsZSBwcm9wZXJ0eSBpcyBzZXQgKG5vbi0xKSwgdXNlIHRoYXQgdmFsdWUgZm9yIHRoZSBzY2FsZVggYW5kIHNjYWxlWSB2YWx1ZXNcblx0XHRcdFx0XHRcdCAodGhpcyBiZWhhdmlvciBtaW1pY3MgdGhlIHJlc3VsdCBvZiBhbmltYXRpbmcgYWxsIHRoZXNlIHByb3BlcnRpZXMgYXQgb25jZSBvbiBIVE1MIGVsZW1lbnRzKS4gKi9cblx0XHRcdFx0XHRcdHNjYWxlOiBnZXRUcmFuc2Zvcm1GbG9hdChcInNjYWxlXCIpICE9PSAxID8gW2dldFRyYW5zZm9ybUZsb2F0KFwic2NhbGVcIiksIGdldFRyYW5zZm9ybUZsb2F0KFwic2NhbGVcIildIDogW2dldFRyYW5zZm9ybUZsb2F0KFwic2NhbGVYXCIpLCBnZXRUcmFuc2Zvcm1GbG9hdChcInNjYWxlWVwiKV0sXG5cdFx0XHRcdFx0XHQvKiBOb3RlOiBTVkcncyByb3RhdGUgdHJhbnNmb3JtIHRha2VzIHRocmVlIHZhbHVlczogcm90YXRpb24gZGVncmVlcyBmb2xsb3dlZCBieSB0aGUgWCBhbmQgWSB2YWx1ZXNcblx0XHRcdFx0XHRcdCBkZWZpbmluZyB0aGUgcm90YXRpb24ncyBvcmlnaW4gcG9pbnQuIFdlIGlnbm9yZSB0aGUgb3JpZ2luIHZhbHVlcyAoZGVmYXVsdCB0aGVtIHRvIDApLiAqL1xuXHRcdFx0XHRcdFx0cm90YXRlOiBbZ2V0VHJhbnNmb3JtRmxvYXQoXCJyb3RhdGVaXCIpLCAwLCAwXVxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHQvKiBJdGVyYXRlIHRocm91Z2ggdGhlIHRyYW5zZm9ybSBwcm9wZXJ0aWVzIGluIHRoZSB1c2VyLWRlZmluZWQgcHJvcGVydHkgbWFwIG9yZGVyLlxuXHRcdFx0XHRcdCAoVGhpcyBtaW1pY3MgdGhlIGJlaGF2aW9yIG9mIG5vbi1TVkcgdHJhbnNmb3JtIGFuaW1hdGlvbi4pICovXG5cdFx0XHRcdFx0JC5lYWNoKERhdGEoZWxlbWVudCkudHJhbnNmb3JtQ2FjaGUsIGZ1bmN0aW9uKHRyYW5zZm9ybU5hbWUpIHtcblx0XHRcdFx0XHRcdC8qIEV4Y2VwdCBmb3Igd2l0aCBza2V3WC9ZLCByZXZlcnQgdGhlIGF4aXMtc3BlY2lmaWMgdHJhbnNmb3JtIHN1YnByb3BlcnRpZXMgdG8gdGhlaXIgYXhpcy1mcmVlIG1hc3RlclxuXHRcdFx0XHRcdFx0IHByb3BlcnRpZXMgc28gdGhhdCB0aGV5IG1hdGNoIHVwIHdpdGggU1ZHJ3MgYWNjZXB0ZWQgdHJhbnNmb3JtIHByb3BlcnRpZXMuICovXG5cdFx0XHRcdFx0XHRpZiAoL150cmFuc2xhdGUvaS50ZXN0KHRyYW5zZm9ybU5hbWUpKSB7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybU5hbWUgPSBcInRyYW5zbGF0ZVwiO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICgvXnNjYWxlL2kudGVzdCh0cmFuc2Zvcm1OYW1lKSkge1xuXHRcdFx0XHRcdFx0XHR0cmFuc2Zvcm1OYW1lID0gXCJzY2FsZVwiO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICgvXnJvdGF0ZS9pLnRlc3QodHJhbnNmb3JtTmFtZSkpIHtcblx0XHRcdFx0XHRcdFx0dHJhbnNmb3JtTmFtZSA9IFwicm90YXRlXCI7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8qIENoZWNrIHRoYXQgd2UgaGF2ZW4ndCB5ZXQgZGVsZXRlZCB0aGUgcHJvcGVydHkgZnJvbSB0aGUgU1ZHVHJhbnNmb3JtcyBjb250YWluZXIuICovXG5cdFx0XHRcdFx0XHRpZiAoU1ZHVHJhbnNmb3Jtc1t0cmFuc2Zvcm1OYW1lXSkge1xuXHRcdFx0XHRcdFx0XHQvKiBBcHBlbmQgdGhlIHRyYW5zZm9ybSBwcm9wZXJ0eSBpbiB0aGUgU1ZHLXN1cHBvcnRlZCB0cmFuc2Zvcm0gZm9ybWF0LiBBcyBwZXIgdGhlIHNwZWMsIHN1cnJvdW5kIHRoZSBzcGFjZS1kZWxpbWl0ZWQgdmFsdWVzIGluIHBhcmVudGhlc2VzLiAqL1xuXHRcdFx0XHRcdFx0XHR0cmFuc2Zvcm1TdHJpbmcgKz0gdHJhbnNmb3JtTmFtZSArIFwiKFwiICsgU1ZHVHJhbnNmb3Jtc1t0cmFuc2Zvcm1OYW1lXS5qb2luKFwiIFwiKSArIFwiKVwiICsgXCIgXCI7XG5cblx0XHRcdFx0XHRcdFx0LyogQWZ0ZXIgcHJvY2Vzc2luZyBhbiBTVkcgdHJhbnNmb3JtIHByb3BlcnR5LCBkZWxldGUgaXQgZnJvbSB0aGUgU1ZHVHJhbnNmb3JtcyBjb250YWluZXIgc28gd2UgZG9uJ3Rcblx0XHRcdFx0XHRcdFx0IHJlLWluc2VydCB0aGUgc2FtZSBtYXN0ZXIgcHJvcGVydHkgaWYgd2UgZW5jb3VudGVyIGFub3RoZXIgb25lIG9mIGl0cyBheGlzLXNwZWNpZmljIHByb3BlcnRpZXMuICovXG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBTVkdUcmFuc2Zvcm1zW3RyYW5zZm9ybU5hbWVdO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHZhciB0cmFuc2Zvcm1WYWx1ZSxcblx0XHRcdFx0XHRcdFx0cGVyc3BlY3RpdmU7XG5cblx0XHRcdFx0XHQvKiBUcmFuc2Zvcm0gcHJvcGVydGllcyBhcmUgc3RvcmVkIGFzIG1lbWJlcnMgb2YgdGhlIHRyYW5zZm9ybUNhY2hlIG9iamVjdC4gQ29uY2F0ZW5hdGUgYWxsIHRoZSBtZW1iZXJzIGludG8gYSBzdHJpbmcuICovXG5cdFx0XHRcdFx0JC5lYWNoKERhdGEoZWxlbWVudCkudHJhbnNmb3JtQ2FjaGUsIGZ1bmN0aW9uKHRyYW5zZm9ybU5hbWUpIHtcblx0XHRcdFx0XHRcdHRyYW5zZm9ybVZhbHVlID0gRGF0YShlbGVtZW50KS50cmFuc2Zvcm1DYWNoZVt0cmFuc2Zvcm1OYW1lXTtcblxuXHRcdFx0XHRcdFx0LyogVHJhbnNmb3JtJ3MgcGVyc3BlY3RpdmUgc3VicHJvcGVydHkgbXVzdCBiZSBzZXQgZmlyc3QgaW4gb3JkZXIgdG8gdGFrZSBlZmZlY3QuIFN0b3JlIGl0IHRlbXBvcmFyaWx5LiAqL1xuXHRcdFx0XHRcdFx0aWYgKHRyYW5zZm9ybU5hbWUgPT09IFwidHJhbnNmb3JtUGVyc3BlY3RpdmVcIikge1xuXHRcdFx0XHRcdFx0XHRwZXJzcGVjdGl2ZSA9IHRyYW5zZm9ybVZhbHVlO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogSUU5IG9ubHkgc3VwcG9ydHMgb25lIHJvdGF0aW9uIHR5cGUsIHJvdGF0ZVosIHdoaWNoIGl0IHJlZmVycyB0byBhcyBcInJvdGF0ZVwiLiAqL1xuXHRcdFx0XHRcdFx0aWYgKElFID09PSA5ICYmIHRyYW5zZm9ybU5hbWUgPT09IFwicm90YXRlWlwiKSB7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybU5hbWUgPSBcInJvdGF0ZVwiO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR0cmFuc2Zvcm1TdHJpbmcgKz0gdHJhbnNmb3JtTmFtZSArIHRyYW5zZm9ybVZhbHVlICsgXCIgXCI7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQvKiBJZiBwcmVzZW50LCBzZXQgdGhlIHBlcnNwZWN0aXZlIHN1YnByb3BlcnR5IGZpcnN0LiAqL1xuXHRcdFx0XHRcdGlmIChwZXJzcGVjdGl2ZSkge1xuXHRcdFx0XHRcdFx0dHJhbnNmb3JtU3RyaW5nID0gXCJwZXJzcGVjdGl2ZVwiICsgcGVyc3BlY3RpdmUgKyBcIiBcIiArIHRyYW5zZm9ybVN0cmluZztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRDU1Muc2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcInRyYW5zZm9ybVwiLCB0cmFuc2Zvcm1TdHJpbmcpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKiBSZWdpc3RlciBob29rcyBhbmQgbm9ybWFsaXphdGlvbnMuICovXG5cdFx0Q1NTLkhvb2tzLnJlZ2lzdGVyKCk7XG5cdFx0Q1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyKCk7XG5cblx0XHQvKiBBbGxvdyBob29rIHNldHRpbmcgaW4gdGhlIHNhbWUgZmFzaGlvbiBhcyBqUXVlcnkncyAkLmNzcygpLiAqL1xuXHRcdFZlbG9jaXR5Lmhvb2sgPSBmdW5jdGlvbihlbGVtZW50cywgYXJnMiwgYXJnMykge1xuXHRcdFx0dmFyIHZhbHVlO1xuXG5cdFx0XHRlbGVtZW50cyA9IHNhbml0aXplRWxlbWVudHMoZWxlbWVudHMpO1xuXG5cdFx0XHQkLmVhY2goZWxlbWVudHMsIGZ1bmN0aW9uKGksIGVsZW1lbnQpIHtcblx0XHRcdFx0LyogSW5pdGlhbGl6ZSBWZWxvY2l0eSdzIHBlci1lbGVtZW50IGRhdGEgY2FjaGUgaWYgdGhpcyBlbGVtZW50IGhhc24ndCBwcmV2aW91c2x5IGJlZW4gYW5pbWF0ZWQuICovXG5cdFx0XHRcdGlmIChEYXRhKGVsZW1lbnQpID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRWZWxvY2l0eS5pbml0KGVsZW1lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyogR2V0IHByb3BlcnR5IHZhbHVlLiBJZiBhbiBlbGVtZW50IHNldCB3YXMgcGFzc2VkIGluLCBvbmx5IHJldHVybiB0aGUgdmFsdWUgZm9yIHRoZSBmaXJzdCBlbGVtZW50LiAqL1xuXHRcdFx0XHRpZiAoYXJnMyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0aWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gVmVsb2NpdHkuQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgYXJnMik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8qIFNldCBwcm9wZXJ0eSB2YWx1ZS4gKi9cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvKiBzUFYgcmV0dXJucyBhbiBhcnJheSBvZiB0aGUgbm9ybWFsaXplZCBwcm9wZXJ0eU5hbWUvcHJvcGVydHlWYWx1ZSBwYWlyIHVzZWQgdG8gdXBkYXRlIHRoZSBET00uICovXG5cdFx0XHRcdFx0dmFyIGFkanVzdGVkU2V0ID0gVmVsb2NpdHkuQ1NTLnNldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgYXJnMiwgYXJnMyk7XG5cblx0XHRcdFx0XHQvKiBUcmFuc2Zvcm0gcHJvcGVydGllcyBkb24ndCBhdXRvbWF0aWNhbGx5IHNldC4gVGhleSBoYXZlIHRvIGJlIGZsdXNoZWQgdG8gdGhlIERPTS4gKi9cblx0XHRcdFx0XHRpZiAoYWRqdXN0ZWRTZXRbMF0gPT09IFwidHJhbnNmb3JtXCIpIHtcblx0XHRcdFx0XHRcdFZlbG9jaXR5LkNTUy5mbHVzaFRyYW5zZm9ybUNhY2hlKGVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhbHVlID0gYWRqdXN0ZWRTZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fTtcblxuXHRcdC8qKioqKioqKioqKioqKioqKlxuXHRcdCBBbmltYXRpb25cblx0XHQgKioqKioqKioqKioqKioqKiovXG5cblx0XHR2YXIgYW5pbWF0ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG9wdHM7XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKipcblx0XHRcdCBDYWxsIENoYWluXG5cdFx0XHQgKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHQvKiBMb2dpYyBmb3IgZGV0ZXJtaW5pbmcgd2hhdCB0byByZXR1cm4gdG8gdGhlIGNhbGwgc3RhY2sgd2hlbiBleGl0aW5nIG91dCBvZiBWZWxvY2l0eS4gKi9cblx0XHRcdGZ1bmN0aW9uIGdldENoYWluKCkge1xuXHRcdFx0XHQvKiBJZiB3ZSBhcmUgdXNpbmcgdGhlIHV0aWxpdHkgZnVuY3Rpb24sIGF0dGVtcHQgdG8gcmV0dXJuIHRoaXMgY2FsbCdzIHByb21pc2UuIElmIG5vIHByb21pc2UgbGlicmFyeSB3YXMgZGV0ZWN0ZWQsXG5cdFx0XHRcdCBkZWZhdWx0IHRvIG51bGwgaW5zdGVhZCBvZiByZXR1cm5pbmcgdGhlIHRhcmdldGVkIGVsZW1lbnRzIHNvIHRoYXQgdXRpbGl0eSBmdW5jdGlvbidzIHJldHVybiB2YWx1ZSBpcyBzdGFuZGFyZGl6ZWQuICovXG5cdFx0XHRcdGlmIChpc1V0aWxpdHkpIHtcblx0XHRcdFx0XHRyZXR1cm4gcHJvbWlzZURhdGEucHJvbWlzZSB8fCBudWxsO1xuXHRcdFx0XHRcdC8qIE90aGVyd2lzZSwgaWYgd2UncmUgdXNpbmcgJC5mbiwgcmV0dXJuIHRoZSBqUXVlcnktL1plcHRvLXdyYXBwZWQgZWxlbWVudCBzZXQuICovXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGVsZW1lbnRzV3JhcHBlZDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0IEFyZ3VtZW50cyBBc3NpZ25tZW50XG5cdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0LyogVG8gYWxsb3cgZm9yIGV4cHJlc3NpdmUgQ29mZmVlU2NyaXB0IGNvZGUsIFZlbG9jaXR5IHN1cHBvcnRzIGFuIGFsdGVybmF0aXZlIHN5bnRheCBpbiB3aGljaCBcImVsZW1lbnRzXCIgKG9yIFwiZVwiKSwgXCJwcm9wZXJ0aWVzXCIgKG9yIFwicFwiKSwgYW5kIFwib3B0aW9uc1wiIChvciBcIm9cIilcblx0XHRcdCBvYmplY3RzIGFyZSBkZWZpbmVkIG9uIGEgY29udGFpbmVyIG9iamVjdCB0aGF0J3MgcGFzc2VkIGluIGFzIFZlbG9jaXR5J3Mgc29sZSBhcmd1bWVudC4gKi9cblx0XHRcdC8qIE5vdGU6IFNvbWUgYnJvd3NlcnMgYXV0b21hdGljYWxseSBwb3B1bGF0ZSBhcmd1bWVudHMgd2l0aCBhIFwicHJvcGVydGllc1wiIG9iamVjdC4gV2UgZGV0ZWN0IGl0IGJ5IGNoZWNraW5nIGZvciBpdHMgZGVmYXVsdCBcIm5hbWVzXCIgcHJvcGVydHkuICovXG5cdFx0XHR2YXIgc3ludGFjdGljU3VnYXIgPSAoYXJndW1lbnRzWzBdICYmIChhcmd1bWVudHNbMF0ucCB8fCAoKCQuaXNQbGFpbk9iamVjdChhcmd1bWVudHNbMF0ucHJvcGVydGllcykgJiYgIWFyZ3VtZW50c1swXS5wcm9wZXJ0aWVzLm5hbWVzKSB8fCBUeXBlLmlzU3RyaW5nKGFyZ3VtZW50c1swXS5wcm9wZXJ0aWVzKSkpKSxcblx0XHRcdFx0XHQvKiBXaGV0aGVyIFZlbG9jaXR5IHdhcyBjYWxsZWQgdmlhIHRoZSB1dGlsaXR5IGZ1bmN0aW9uIChhcyBvcHBvc2VkIHRvIG9uIGEgalF1ZXJ5L1plcHRvIG9iamVjdCkuICovXG5cdFx0XHRcdFx0aXNVdGlsaXR5LFxuXHRcdFx0XHRcdC8qIFdoZW4gVmVsb2NpdHkgaXMgY2FsbGVkIHZpYSB0aGUgdXRpbGl0eSBmdW5jdGlvbiAoJC5WZWxvY2l0eSgpL1ZlbG9jaXR5KCkpLCBlbGVtZW50cyBhcmUgZXhwbGljaXRseVxuXHRcdFx0XHRcdCBwYXNzZWQgaW4gYXMgdGhlIGZpcnN0IHBhcmFtZXRlci4gVGh1cywgYXJndW1lbnQgcG9zaXRpb25pbmcgdmFyaWVzLiBXZSBub3JtYWxpemUgdGhlbSBoZXJlLiAqL1xuXHRcdFx0XHRcdGVsZW1lbnRzV3JhcHBlZCxcblx0XHRcdFx0XHRhcmd1bWVudEluZGV4O1xuXG5cdFx0XHR2YXIgZWxlbWVudHMsXG5cdFx0XHRcdFx0cHJvcGVydGllc01hcCxcblx0XHRcdFx0XHRvcHRpb25zO1xuXG5cdFx0XHQvKiBEZXRlY3QgalF1ZXJ5L1plcHRvIGVsZW1lbnRzIGJlaW5nIGFuaW1hdGVkIHZpYSB0aGUgJC5mbiBtZXRob2QuICovXG5cdFx0XHRpZiAoVHlwZS5pc1dyYXBwZWQodGhpcykpIHtcblx0XHRcdFx0aXNVdGlsaXR5ID0gZmFsc2U7XG5cblx0XHRcdFx0YXJndW1lbnRJbmRleCA9IDA7XG5cdFx0XHRcdGVsZW1lbnRzID0gdGhpcztcblx0XHRcdFx0ZWxlbWVudHNXcmFwcGVkID0gdGhpcztcblx0XHRcdFx0LyogT3RoZXJ3aXNlLCByYXcgZWxlbWVudHMgYXJlIGJlaW5nIGFuaW1hdGVkIHZpYSB0aGUgdXRpbGl0eSBmdW5jdGlvbi4gKi9cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlzVXRpbGl0eSA9IHRydWU7XG5cblx0XHRcdFx0YXJndW1lbnRJbmRleCA9IDE7XG5cdFx0XHRcdGVsZW1lbnRzID0gc3ludGFjdGljU3VnYXIgPyAoYXJndW1lbnRzWzBdLmVsZW1lbnRzIHx8IGFyZ3VtZW50c1swXS5lKSA6IGFyZ3VtZW50c1swXTtcblx0XHRcdH1cblxuXHRcdFx0ZWxlbWVudHMgPSBzYW5pdGl6ZUVsZW1lbnRzKGVsZW1lbnRzKTtcblxuXHRcdFx0aWYgKCFlbGVtZW50cykge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzeW50YWN0aWNTdWdhcikge1xuXHRcdFx0XHRwcm9wZXJ0aWVzTWFwID0gYXJndW1lbnRzWzBdLnByb3BlcnRpZXMgfHwgYXJndW1lbnRzWzBdLnA7XG5cdFx0XHRcdG9wdGlvbnMgPSBhcmd1bWVudHNbMF0ub3B0aW9ucyB8fCBhcmd1bWVudHNbMF0ubztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHByb3BlcnRpZXNNYXAgPSBhcmd1bWVudHNbYXJndW1lbnRJbmRleF07XG5cdFx0XHRcdG9wdGlvbnMgPSBhcmd1bWVudHNbYXJndW1lbnRJbmRleCArIDFdO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiBUaGUgbGVuZ3RoIG9mIHRoZSBlbGVtZW50IHNldCAoaW4gdGhlIGZvcm0gb2YgYSBub2RlTGlzdCBvciBhbiBhcnJheSBvZiBlbGVtZW50cykgaXMgZGVmYXVsdGVkIHRvIDEgaW4gY2FzZSBhXG5cdFx0XHQgc2luZ2xlIHJhdyBET00gZWxlbWVudCBpcyBwYXNzZWQgaW4gKHdoaWNoIGRvZXNuJ3QgY29udGFpbiBhIGxlbmd0aCBwcm9wZXJ0eSkuICovXG5cdFx0XHR2YXIgZWxlbWVudHNMZW5ndGggPSBlbGVtZW50cy5sZW5ndGgsXG5cdFx0XHRcdFx0ZWxlbWVudHNJbmRleCA9IDA7XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBBcmd1bWVudCBPdmVybG9hZGluZ1xuXHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0LyogU3VwcG9ydCBpcyBpbmNsdWRlZCBmb3IgalF1ZXJ5J3MgYXJndW1lbnQgb3ZlcmxvYWRpbmc6ICQuYW5pbWF0ZShwcm9wZXJ0eU1hcCBbLCBkdXJhdGlvbl0gWywgZWFzaW5nXSBbLCBjb21wbGV0ZV0pLlxuXHRcdFx0IE92ZXJsb2FkaW5nIGlzIGRldGVjdGVkIGJ5IGNoZWNraW5nIGZvciB0aGUgYWJzZW5jZSBvZiBhbiBvYmplY3QgYmVpbmcgcGFzc2VkIGludG8gb3B0aW9ucy4gKi9cblx0XHRcdC8qIE5vdGU6IFRoZSBzdG9wIGFuZCBmaW5pc2ggYWN0aW9ucyBkbyBub3QgYWNjZXB0IGFuaW1hdGlvbiBvcHRpb25zLCBhbmQgYXJlIHRoZXJlZm9yZSBleGNsdWRlZCBmcm9tIHRoaXMgY2hlY2suICovXG5cdFx0XHRpZiAoIS9eKHN0b3B8ZmluaXNofGZpbmlzaEFsbCkkL2kudGVzdChwcm9wZXJ0aWVzTWFwKSAmJiAhJC5pc1BsYWluT2JqZWN0KG9wdGlvbnMpKSB7XG5cdFx0XHRcdC8qIFRoZSB1dGlsaXR5IGZ1bmN0aW9uIHNoaWZ0cyBhbGwgYXJndW1lbnRzIG9uZSBwb3NpdGlvbiB0byB0aGUgcmlnaHQsIHNvIHdlIGFkanVzdCBmb3IgdGhhdCBvZmZzZXQuICovXG5cdFx0XHRcdHZhciBzdGFydGluZ0FyZ3VtZW50UG9zaXRpb24gPSBhcmd1bWVudEluZGV4ICsgMTtcblxuXHRcdFx0XHRvcHRpb25zID0ge307XG5cblx0XHRcdFx0LyogSXRlcmF0ZSB0aHJvdWdoIGFsbCBvcHRpb25zIGFyZ3VtZW50cyAqL1xuXHRcdFx0XHRmb3IgKHZhciBpID0gc3RhcnRpbmdBcmd1bWVudFBvc2l0aW9uOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0LyogVHJlYXQgYSBudW1iZXIgYXMgYSBkdXJhdGlvbi4gUGFyc2UgaXQgb3V0LiAqL1xuXHRcdFx0XHRcdC8qIE5vdGU6IFRoZSBmb2xsb3dpbmcgUmVnRXggd2lsbCByZXR1cm4gdHJ1ZSBpZiBwYXNzZWQgYW4gYXJyYXkgd2l0aCBhIG51bWJlciBhcyBpdHMgZmlyc3QgaXRlbS5cblx0XHRcdFx0XHQgVGh1cywgYXJyYXlzIGFyZSBza2lwcGVkIGZyb20gdGhpcyBjaGVjay4gKi9cblx0XHRcdFx0XHRpZiAoIVR5cGUuaXNBcnJheShhcmd1bWVudHNbaV0pICYmICgvXihmYXN0fG5vcm1hbHxzbG93KSQvaS50ZXN0KGFyZ3VtZW50c1tpXSkgfHwgL15cXGQvLnRlc3QoYXJndW1lbnRzW2ldKSkpIHtcblx0XHRcdFx0XHRcdG9wdGlvbnMuZHVyYXRpb24gPSBhcmd1bWVudHNbaV07XG5cdFx0XHRcdFx0XHQvKiBUcmVhdCBzdHJpbmdzIGFuZCBhcnJheXMgYXMgZWFzaW5ncy4gKi9cblx0XHRcdFx0XHR9IGVsc2UgaWYgKFR5cGUuaXNTdHJpbmcoYXJndW1lbnRzW2ldKSB8fCBUeXBlLmlzQXJyYXkoYXJndW1lbnRzW2ldKSkge1xuXHRcdFx0XHRcdFx0b3B0aW9ucy5lYXNpbmcgPSBhcmd1bWVudHNbaV07XG5cdFx0XHRcdFx0XHQvKiBUcmVhdCBhIGZ1bmN0aW9uIGFzIGEgY29tcGxldGUgY2FsbGJhY2suICovXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChUeXBlLmlzRnVuY3Rpb24oYXJndW1lbnRzW2ldKSkge1xuXHRcdFx0XHRcdFx0b3B0aW9ucy5jb21wbGV0ZSA9IGFyZ3VtZW50c1tpXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0LyoqKioqKioqKioqKioqKlxuXHRcdFx0IFByb21pc2VzXG5cdFx0XHQgKioqKioqKioqKioqKioqL1xuXG5cdFx0XHR2YXIgcHJvbWlzZURhdGEgPSB7XG5cdFx0XHRcdHByb21pc2U6IG51bGwsXG5cdFx0XHRcdHJlc29sdmVyOiBudWxsLFxuXHRcdFx0XHRyZWplY3RlcjogbnVsbFxuXHRcdFx0fTtcblxuXHRcdFx0LyogSWYgdGhpcyBjYWxsIHdhcyBtYWRlIHZpYSB0aGUgdXRpbGl0eSBmdW5jdGlvbiAod2hpY2ggaXMgdGhlIGRlZmF1bHQgbWV0aG9kIG9mIGludm9jYXRpb24gd2hlbiBqUXVlcnkvWmVwdG8gYXJlIG5vdCBiZWluZyB1c2VkKSwgYW5kIGlmXG5cdFx0XHQgcHJvbWlzZSBzdXBwb3J0IHdhcyBkZXRlY3RlZCwgY3JlYXRlIGEgcHJvbWlzZSBvYmplY3QgZm9yIHRoaXMgY2FsbCBhbmQgc3RvcmUgcmVmZXJlbmNlcyB0byBpdHMgcmVzb2x2ZXIgYW5kIHJlamVjdGVyIG1ldGhvZHMuIFRoZSByZXNvbHZlXG5cdFx0XHQgbWV0aG9kIGlzIHVzZWQgd2hlbiBhIGNhbGwgY29tcGxldGVzIG5hdHVyYWxseSBvciBpcyBwcmVtYXR1cmVseSBzdG9wcGVkIGJ5IHRoZSB1c2VyLiBJbiBib3RoIGNhc2VzLCBjb21wbGV0ZUNhbGwoKSBoYW5kbGVzIHRoZSBhc3NvY2lhdGVkXG5cdFx0XHQgY2FsbCBjbGVhbnVwIGFuZCBwcm9taXNlIHJlc29sdmluZyBsb2dpYy4gVGhlIHJlamVjdCBtZXRob2QgaXMgdXNlZCB3aGVuIGFuIGludmFsaWQgc2V0IG9mIGFyZ3VtZW50cyBpcyBwYXNzZWQgaW50byBhIFZlbG9jaXR5IGNhbGwuICovXG5cdFx0XHQvKiBOb3RlOiBWZWxvY2l0eSBlbXBsb3lzIGEgY2FsbC1iYXNlZCBxdWV1ZWluZyBhcmNoaXRlY3R1cmUsIHdoaWNoIG1lYW5zIHRoYXQgc3RvcHBpbmcgYW4gYW5pbWF0aW5nIGVsZW1lbnQgYWN0dWFsbHkgc3RvcHMgdGhlIGZ1bGwgY2FsbCB0aGF0XG5cdFx0XHQgdHJpZ2dlcmVkIGl0IC0tIG5vdCB0aGF0IG9uZSBlbGVtZW50IGV4Y2x1c2l2ZWx5LiBTaW1pbGFybHksIHRoZXJlIGlzIG9uZSBwcm9taXNlIHBlciBjYWxsLCBhbmQgYWxsIGVsZW1lbnRzIHRhcmdldGVkIGJ5IGEgVmVsb2NpdHkgY2FsbCBhcmVcblx0XHRcdCBncm91cGVkIHRvZ2V0aGVyIGZvciB0aGUgcHVycG9zZXMgb2YgcmVzb2x2aW5nIGFuZCByZWplY3RpbmcgYSBwcm9taXNlLiAqL1xuXHRcdFx0aWYgKGlzVXRpbGl0eSAmJiBWZWxvY2l0eS5Qcm9taXNlKSB7XG5cdFx0XHRcdHByb21pc2VEYXRhLnByb21pc2UgPSBuZXcgVmVsb2NpdHkuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHRcdFx0XHRwcm9taXNlRGF0YS5yZXNvbHZlciA9IHJlc29sdmU7XG5cdFx0XHRcdFx0cHJvbWlzZURhdGEucmVqZWN0ZXIgPSByZWplY3Q7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHQgQWN0aW9uIERldGVjdGlvblxuXHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0LyogVmVsb2NpdHkncyBiZWhhdmlvciBpcyBjYXRlZ29yaXplZCBpbnRvIFwiYWN0aW9uc1wiOiBFbGVtZW50cyBjYW4gZWl0aGVyIGJlIHNwZWNpYWxseSBzY3JvbGxlZCBpbnRvIHZpZXcsXG5cdFx0XHQgb3IgdGhleSBjYW4gYmUgc3RhcnRlZCwgc3RvcHBlZCwgb3IgcmV2ZXJzZWQuIElmIGEgbGl0ZXJhbCBvciByZWZlcmVuY2VkIHByb3BlcnRpZXMgbWFwIGlzIHBhc3NlZCBpbiBhcyBWZWxvY2l0eSdzXG5cdFx0XHQgZmlyc3QgYXJndW1lbnQsIHRoZSBhc3NvY2lhdGVkIGFjdGlvbiBpcyBcInN0YXJ0XCIuIEFsdGVybmF0aXZlbHksIFwic2Nyb2xsXCIsIFwicmV2ZXJzZVwiLCBvciBcInN0b3BcIiBjYW4gYmUgcGFzc2VkIGluIGluc3RlYWQgb2YgYSBwcm9wZXJ0aWVzIG1hcC4gKi9cblx0XHRcdHZhciBhY3Rpb247XG5cblx0XHRcdHN3aXRjaCAocHJvcGVydGllc01hcCkge1xuXHRcdFx0XHRjYXNlIFwic2Nyb2xsXCI6XG5cdFx0XHRcdFx0YWN0aW9uID0gXCJzY3JvbGxcIjtcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwicmV2ZXJzZVwiOlxuXHRcdFx0XHRcdGFjdGlvbiA9IFwicmV2ZXJzZVwiO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmaW5pc2hcIjpcblx0XHRcdFx0Y2FzZSBcImZpbmlzaEFsbFwiOlxuXHRcdFx0XHRjYXNlIFwic3RvcFwiOlxuXHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0IEFjdGlvbjogU3RvcFxuXHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0LyogQ2xlYXIgdGhlIGN1cnJlbnRseS1hY3RpdmUgZGVsYXkgb24gZWFjaCB0YXJnZXRlZCBlbGVtZW50LiAqL1xuXHRcdFx0XHRcdCQuZWFjaChlbGVtZW50cywgZnVuY3Rpb24oaSwgZWxlbWVudCkge1xuXHRcdFx0XHRcdFx0aWYgKERhdGEoZWxlbWVudCkgJiYgRGF0YShlbGVtZW50KS5kZWxheVRpbWVyKSB7XG5cdFx0XHRcdFx0XHRcdC8qIFN0b3AgdGhlIHRpbWVyIGZyb20gdHJpZ2dlcmluZyBpdHMgY2FjaGVkIG5leHQoKSBmdW5jdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KERhdGEoZWxlbWVudCkuZGVsYXlUaW1lci5zZXRUaW1lb3V0KTtcblxuXHRcdFx0XHRcdFx0XHQvKiBNYW51YWxseSBjYWxsIHRoZSBuZXh0KCkgZnVuY3Rpb24gc28gdGhhdCB0aGUgc3Vic2VxdWVudCBxdWV1ZSBpdGVtcyBjYW4gcHJvZ3Jlc3MuICovXG5cdFx0XHRcdFx0XHRcdGlmIChEYXRhKGVsZW1lbnQpLmRlbGF5VGltZXIubmV4dCkge1xuXHRcdFx0XHRcdFx0XHRcdERhdGEoZWxlbWVudCkuZGVsYXlUaW1lci5uZXh0KCk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRkZWxldGUgRGF0YShlbGVtZW50KS5kZWxheVRpbWVyO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKiBJZiB3ZSB3YW50IHRvIGZpbmlzaCBldmVyeXRoaW5nIGluIHRoZSBxdWV1ZSwgd2UgaGF2ZSB0byBpdGVyYXRlIHRocm91Z2ggaXRcblx0XHRcdFx0XHRcdCBhbmQgY2FsbCBlYWNoIGZ1bmN0aW9uLiBUaGlzIHdpbGwgbWFrZSB0aGVtIGFjdGl2ZSBjYWxscyBiZWxvdywgd2hpY2ggd2lsbFxuXHRcdFx0XHRcdFx0IGNhdXNlIHRoZW0gdG8gYmUgYXBwbGllZCB2aWEgdGhlIGR1cmF0aW9uIHNldHRpbmcuICovXG5cdFx0XHRcdFx0XHRpZiAocHJvcGVydGllc01hcCA9PT0gXCJmaW5pc2hBbGxcIiAmJiAob3B0aW9ucyA9PT0gdHJ1ZSB8fCBUeXBlLmlzU3RyaW5nKG9wdGlvbnMpKSkge1xuXHRcdFx0XHRcdFx0XHQvKiBJdGVyYXRlIHRocm91Z2ggdGhlIGl0ZW1zIGluIHRoZSBlbGVtZW50J3MgcXVldWUuICovXG5cdFx0XHRcdFx0XHRcdCQuZWFjaCgkLnF1ZXVlKGVsZW1lbnQsIFR5cGUuaXNTdHJpbmcob3B0aW9ucykgPyBvcHRpb25zIDogXCJcIiksIGZ1bmN0aW9uKF8sIGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0XHQvKiBUaGUgcXVldWUgYXJyYXkgY2FuIGNvbnRhaW4gYW4gXCJpbnByb2dyZXNzXCIgc3RyaW5nLCB3aGljaCB3ZSBza2lwLiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmIChUeXBlLmlzRnVuY3Rpb24oaXRlbSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGl0ZW0oKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdC8qIENsZWFyaW5nIHRoZSAkLnF1ZXVlKCkgYXJyYXkgaXMgYWNoaWV2ZWQgYnkgcmVzZXR0aW5nIGl0IHRvIFtdLiAqL1xuXHRcdFx0XHRcdFx0XHQkLnF1ZXVlKGVsZW1lbnQsIFR5cGUuaXNTdHJpbmcob3B0aW9ucykgPyBvcHRpb25zIDogXCJcIiwgW10pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0dmFyIGNhbGxzVG9TdG9wID0gW107XG5cblx0XHRcdFx0XHQvKiBXaGVuIHRoZSBzdG9wIGFjdGlvbiBpcyB0cmlnZ2VyZWQsIHRoZSBlbGVtZW50cycgY3VycmVudGx5IGFjdGl2ZSBjYWxsIGlzIGltbWVkaWF0ZWx5IHN0b3BwZWQuIFRoZSBhY3RpdmUgY2FsbCBtaWdodCBoYXZlXG5cdFx0XHRcdFx0IGJlZW4gYXBwbGllZCB0byBtdWx0aXBsZSBlbGVtZW50cywgaW4gd2hpY2ggY2FzZSBhbGwgb2YgdGhlIGNhbGwncyBlbGVtZW50cyB3aWxsIGJlIHN0b3BwZWQuIFdoZW4gYW4gZWxlbWVudFxuXHRcdFx0XHRcdCBpcyBzdG9wcGVkLCB0aGUgbmV4dCBpdGVtIGluIGl0cyBhbmltYXRpb24gcXVldWUgaXMgaW1tZWRpYXRlbHkgdHJpZ2dlcmVkLiAqL1xuXHRcdFx0XHRcdC8qIEFuIGFkZGl0aW9uYWwgYXJndW1lbnQgbWF5IGJlIHBhc3NlZCBpbiB0byBjbGVhciBhbiBlbGVtZW50J3MgcmVtYWluaW5nIHF1ZXVlZCBjYWxscy4gRWl0aGVyIHRydWUgKHdoaWNoIGRlZmF1bHRzIHRvIHRoZSBcImZ4XCIgcXVldWUpXG5cdFx0XHRcdFx0IG9yIGEgY3VzdG9tIHF1ZXVlIHN0cmluZyBjYW4gYmUgcGFzc2VkIGluLiAqL1xuXHRcdFx0XHRcdC8qIE5vdGU6IFRoZSBzdG9wIGNvbW1hbmQgcnVucyBwcmlvciB0byBWZWxvY2l0eSdzIFF1ZXVlaW5nIHBoYXNlIHNpbmNlIGl0cyBiZWhhdmlvciBpcyBpbnRlbmRlZCB0byB0YWtlIGVmZmVjdCAqaW1tZWRpYXRlbHkqLFxuXHRcdFx0XHRcdCByZWdhcmRsZXNzIG9mIHRoZSBlbGVtZW50J3MgY3VycmVudCBxdWV1ZSBzdGF0ZS4gKi9cblxuXHRcdFx0XHRcdC8qIEl0ZXJhdGUgdGhyb3VnaCBldmVyeSBhY3RpdmUgY2FsbC4gKi9cblx0XHRcdFx0XHQkLmVhY2goVmVsb2NpdHkuU3RhdGUuY2FsbHMsIGZ1bmN0aW9uKGksIGFjdGl2ZUNhbGwpIHtcblx0XHRcdFx0XHRcdC8qIEluYWN0aXZlIGNhbGxzIGFyZSBzZXQgdG8gZmFsc2UgYnkgdGhlIGxvZ2ljIGluc2lkZSBjb21wbGV0ZUNhbGwoKS4gU2tpcCB0aGVtLiAqL1xuXHRcdFx0XHRcdFx0aWYgKGFjdGl2ZUNhbGwpIHtcblx0XHRcdFx0XHRcdFx0LyogSXRlcmF0ZSB0aHJvdWdoIHRoZSBhY3RpdmUgY2FsbCdzIHRhcmdldGVkIGVsZW1lbnRzLiAqL1xuXHRcdFx0XHRcdFx0XHQkLmVhY2goYWN0aXZlQ2FsbFsxXSwgZnVuY3Rpb24oaywgYWN0aXZlRWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHRcdC8qIElmIHRydWUgd2FzIHBhc3NlZCBpbiBhcyBhIHNlY29uZGFyeSBhcmd1bWVudCwgY2xlYXIgYWJzb2x1dGVseSBhbGwgY2FsbHMgb24gdGhpcyBlbGVtZW50LiBPdGhlcndpc2UsIG9ubHlcblx0XHRcdFx0XHRcdFx0XHQgY2xlYXIgY2FsbHMgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWxldmFudCBxdWV1ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHQvKiBDYWxsIHN0b3BwaW5nIGxvZ2ljIHdvcmtzIGFzIGZvbGxvd3M6XG5cdFx0XHRcdFx0XHRcdFx0IC0gb3B0aW9ucyA9PT0gdHJ1ZSAtLT4gc3RvcCBjdXJyZW50IGRlZmF1bHQgcXVldWUgY2FsbHMgKGFuZCBxdWV1ZTpmYWxzZSBjYWxscyksIGluY2x1ZGluZyByZW1haW5pbmcgcXVldWVkIG9uZXMuXG5cdFx0XHRcdFx0XHRcdFx0IC0gb3B0aW9ucyA9PT0gdW5kZWZpbmVkIC0tPiBzdG9wIGN1cnJlbnQgcXVldWU6XCJcIiBjYWxsIGFuZCBhbGwgcXVldWU6ZmFsc2UgY2FsbHMuXG5cdFx0XHRcdFx0XHRcdFx0IC0gb3B0aW9ucyA9PT0gZmFsc2UgLS0+IHN0b3Agb25seSBxdWV1ZTpmYWxzZSBjYWxscy5cblx0XHRcdFx0XHRcdFx0XHQgLSBvcHRpb25zID09PSBcImN1c3RvbVwiIC0tPiBzdG9wIGN1cnJlbnQgcXVldWU6XCJjdXN0b21cIiBjYWxsLCBpbmNsdWRpbmcgcmVtYWluaW5nIHF1ZXVlZCBvbmVzICh0aGVyZSBpcyBubyBmdW5jdGlvbmFsaXR5IHRvIG9ubHkgY2xlYXIgdGhlIGN1cnJlbnRseS1ydW5uaW5nIHF1ZXVlOlwiY3VzdG9tXCIgY2FsbCkuICovXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHF1ZXVlTmFtZSA9IChvcHRpb25zID09PSB1bmRlZmluZWQpID8gXCJcIiA6IG9wdGlvbnM7XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAocXVldWVOYW1lICE9PSB0cnVlICYmIChhY3RpdmVDYWxsWzJdLnF1ZXVlICE9PSBxdWV1ZU5hbWUpICYmICEob3B0aW9ucyA9PT0gdW5kZWZpbmVkICYmIGFjdGl2ZUNhbGxbMl0ucXVldWUgPT09IGZhbHNlKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0LyogSXRlcmF0ZSB0aHJvdWdoIHRoZSBjYWxscyB0YXJnZXRlZCBieSB0aGUgc3RvcCBjb21tYW5kLiAqL1xuXHRcdFx0XHRcdFx0XHRcdCQuZWFjaChlbGVtZW50cywgZnVuY3Rpb24obCwgZWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0LyogQ2hlY2sgdGhhdCB0aGlzIGNhbGwgd2FzIGFwcGxpZWQgdG8gdGhlIHRhcmdldCBlbGVtZW50LiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVsZW1lbnQgPT09IGFjdGl2ZUVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogT3B0aW9uYWxseSBjbGVhciB0aGUgcmVtYWluaW5nIHF1ZXVlZCBjYWxscy4gSWYgd2UncmUgZG9pbmcgXCJmaW5pc2hBbGxcIiB0aGlzIHdvbid0IGZpbmQgYW55dGhpbmcsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCBkdWUgdG8gdGhlIHF1ZXVlLWNsZWFyaW5nIGFib3ZlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAob3B0aW9ucyA9PT0gdHJ1ZSB8fCBUeXBlLmlzU3RyaW5nKG9wdGlvbnMpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogSXRlcmF0ZSB0aHJvdWdoIHRoZSBpdGVtcyBpbiB0aGUgZWxlbWVudCdzIHF1ZXVlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCQuZWFjaCgkLnF1ZXVlKGVsZW1lbnQsIFR5cGUuaXNTdHJpbmcob3B0aW9ucykgPyBvcHRpb25zIDogXCJcIiksIGZ1bmN0aW9uKF8sIGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFRoZSBxdWV1ZSBhcnJheSBjYW4gY29udGFpbiBhbiBcImlucHJvZ3Jlc3NcIiBzdHJpbmcsIHdoaWNoIHdlIHNraXAuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoVHlwZS5pc0Z1bmN0aW9uKGl0ZW0pKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFBhc3MgdGhlIGl0ZW0ncyBjYWxsYmFjayBhIGZsYWcgaW5kaWNhdGluZyB0aGF0IHdlIHdhbnQgdG8gYWJvcnQgZnJvbSB0aGUgcXVldWUgY2FsbC5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0IChTcGVjaWZpY2FsbHksIHRoZSBxdWV1ZSB3aWxsIHJlc29sdmUgdGhlIGNhbGwncyBhc3NvY2lhdGVkIHByb21pc2UgdGhlbiBhYm9ydC4pICAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpdGVtKG51bGwsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0LyogQ2xlYXJpbmcgdGhlICQucXVldWUoKSBhcnJheSBpcyBhY2hpZXZlZCBieSByZXNldHRpbmcgaXQgdG8gW10uICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JC5xdWV1ZShlbGVtZW50LCBUeXBlLmlzU3RyaW5nKG9wdGlvbnMpID8gb3B0aW9ucyA6IFwiXCIsIFtdKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwcm9wZXJ0aWVzTWFwID09PSBcInN0b3BcIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFNpbmNlIFwicmV2ZXJzZVwiIHVzZXMgY2FjaGVkIHN0YXJ0IHZhbHVlcyAodGhlIHByZXZpb3VzIGNhbGwncyBlbmRWYWx1ZXMpLCB0aGVzZSB2YWx1ZXMgbXVzdCBiZVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCBjaGFuZ2VkIHRvIHJlZmxlY3QgdGhlIGZpbmFsIHZhbHVlIHRoYXQgdGhlIGVsZW1lbnRzIHdlcmUgYWN0dWFsbHkgdHdlZW5lZCB0by4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBJZiBvbmx5IHF1ZXVlOmZhbHNlIGFuaW1hdGlvbnMgYXJlIGN1cnJlbnRseSBydW5uaW5nIG9uIGFuIGVsZW1lbnQsIGl0IHdvbid0IGhhdmUgYSB0d2VlbnNDb250YWluZXJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgb2JqZWN0LiBBbHNvLCBxdWV1ZTpmYWxzZSBhbmltYXRpb25zIGNhbid0IGJlIHJldmVyc2VkLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkYXRhID0gRGF0YShlbGVtZW50KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZGF0YSAmJiBkYXRhLnR3ZWVuc0NvbnRhaW5lciAmJiBxdWV1ZU5hbWUgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQkLmVhY2goZGF0YS50d2VlbnNDb250YWluZXIsIGZ1bmN0aW9uKG0sIGFjdGl2ZVR3ZWVuKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGFjdGl2ZVR3ZWVuLmVuZFZhbHVlID0gYWN0aXZlVHdlZW4uY3VycmVudFZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FsbHNUb1N0b3AucHVzaChpKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmIChwcm9wZXJ0aWVzTWFwID09PSBcImZpbmlzaFwiIHx8IHByb3BlcnRpZXNNYXAgPT09IFwiZmluaXNoQWxsXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBUbyBnZXQgYWN0aXZlIHR3ZWVucyB0byBmaW5pc2ggaW1tZWRpYXRlbHksIHdlIGZvcmNlZnVsbHkgc2hvcnRlbiB0aGVpciBkdXJhdGlvbnMgdG8gMW1zIHNvIHRoYXRcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgdGhleSBmaW5pc2ggdXBvbiB0aGUgbmV4dCByQWYgdGljayB0aGVuIHByb2NlZWQgd2l0aCBub3JtYWwgY2FsbCBjb21wbGV0aW9uIGxvZ2ljLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGFjdGl2ZUNhbGxbMl0uZHVyYXRpb24gPSAxO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0LyogUHJlbWF0dXJlbHkgY2FsbCBjb21wbGV0ZUNhbGwoKSBvbiBlYWNoIG1hdGNoZWQgYWN0aXZlIGNhbGwuIFBhc3MgYW4gYWRkaXRpb25hbCBmbGFnIGZvciBcInN0b3BcIiB0byBpbmRpY2F0ZVxuXHRcdFx0XHRcdCB0aGF0IHRoZSBjb21wbGV0ZSBjYWxsYmFjayBhbmQgZGlzcGxheTpub25lIHNldHRpbmcgc2hvdWxkIGJlIHNraXBwZWQgc2luY2Ugd2UncmUgY29tcGxldGluZyBwcmVtYXR1cmVseS4gKi9cblx0XHRcdFx0XHRpZiAocHJvcGVydGllc01hcCA9PT0gXCJzdG9wXCIpIHtcblx0XHRcdFx0XHRcdCQuZWFjaChjYWxsc1RvU3RvcCwgZnVuY3Rpb24oaSwgaikge1xuXHRcdFx0XHRcdFx0XHRjb21wbGV0ZUNhbGwoaiwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0aWYgKHByb21pc2VEYXRhLnByb21pc2UpIHtcblx0XHRcdFx0XHRcdFx0LyogSW1tZWRpYXRlbHkgcmVzb2x2ZSB0aGUgcHJvbWlzZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBzdG9wIGNhbGwgc2luY2Ugc3RvcCBydW5zIHN5bmNocm9ub3VzbHkuICovXG5cdFx0XHRcdFx0XHRcdHByb21pc2VEYXRhLnJlc29sdmVyKGVsZW1lbnRzKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvKiBTaW5jZSB3ZSdyZSBzdG9wcGluZywgYW5kIG5vdCBwcm9jZWVkaW5nIHdpdGggcXVldWVpbmcsIGV4aXQgb3V0IG9mIFZlbG9jaXR5LiAqL1xuXHRcdFx0XHRcdHJldHVybiBnZXRDaGFpbigpO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0LyogVHJlYXQgYSBub24tZW1wdHkgcGxhaW4gb2JqZWN0IGFzIGEgbGl0ZXJhbCBwcm9wZXJ0aWVzIG1hcC4gKi9cblx0XHRcdFx0XHRpZiAoJC5pc1BsYWluT2JqZWN0KHByb3BlcnRpZXNNYXApICYmICFUeXBlLmlzRW1wdHlPYmplY3QocHJvcGVydGllc01hcCkpIHtcblx0XHRcdFx0XHRcdGFjdGlvbiA9IFwic3RhcnRcIjtcblxuXHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdCBSZWRpcmVjdHNcblx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0XHQvKiBDaGVjayBpZiBhIHN0cmluZyBtYXRjaGVzIGEgcmVnaXN0ZXJlZCByZWRpcmVjdCAoc2VlIFJlZGlyZWN0cyBhYm92ZSkuICovXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChUeXBlLmlzU3RyaW5nKHByb3BlcnRpZXNNYXApICYmIFZlbG9jaXR5LlJlZGlyZWN0c1twcm9wZXJ0aWVzTWFwXSkge1xuXHRcdFx0XHRcdFx0b3B0cyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTtcblxuXHRcdFx0XHRcdFx0dmFyIGR1cmF0aW9uT3JpZ2luYWwgPSBvcHRzLmR1cmF0aW9uLFxuXHRcdFx0XHRcdFx0XHRcdGRlbGF5T3JpZ2luYWwgPSBvcHRzLmRlbGF5IHx8IDA7XG5cblx0XHRcdFx0XHRcdC8qIElmIHRoZSBiYWNrd2FyZHMgb3B0aW9uIHdhcyBwYXNzZWQgaW4sIHJldmVyc2UgdGhlIGVsZW1lbnQgc2V0IHNvIHRoYXQgZWxlbWVudHMgYW5pbWF0ZSBmcm9tIHRoZSBsYXN0IHRvIHRoZSBmaXJzdC4gKi9cblx0XHRcdFx0XHRcdGlmIChvcHRzLmJhY2t3YXJkcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50cyA9ICQuZXh0ZW5kKHRydWUsIFtdLCBlbGVtZW50cykucmV2ZXJzZSgpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKiBJbmRpdmlkdWFsbHkgdHJpZ2dlciB0aGUgcmVkaXJlY3QgZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgc2V0IHRvIHByZXZlbnQgdXNlcnMgZnJvbSBoYXZpbmcgdG8gaGFuZGxlIGl0ZXJhdGlvbiBsb2dpYyBpbiB0aGVpciByZWRpcmVjdC4gKi9cblx0XHRcdFx0XHRcdCQuZWFjaChlbGVtZW50cywgZnVuY3Rpb24oZWxlbWVudEluZGV4LCBlbGVtZW50KSB7XG5cdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBzdGFnZ2VyIG9wdGlvbiB3YXMgcGFzc2VkIGluLCBzdWNjZXNzaXZlbHkgZGVsYXkgZWFjaCBlbGVtZW50IGJ5IHRoZSBzdGFnZ2VyIHZhbHVlIChpbiBtcykuIFJldGFpbiB0aGUgb3JpZ2luYWwgZGVsYXkgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdGlmIChwYXJzZUZsb2F0KG9wdHMuc3RhZ2dlcikpIHtcblx0XHRcdFx0XHRcdFx0XHRvcHRzLmRlbGF5ID0gZGVsYXlPcmlnaW5hbCArIChwYXJzZUZsb2F0KG9wdHMuc3RhZ2dlcikgKiBlbGVtZW50SW5kZXgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKFR5cGUuaXNGdW5jdGlvbihvcHRzLnN0YWdnZXIpKSB7XG5cdFx0XHRcdFx0XHRcdFx0b3B0cy5kZWxheSA9IGRlbGF5T3JpZ2luYWwgKyBvcHRzLnN0YWdnZXIuY2FsbChlbGVtZW50LCBlbGVtZW50SW5kZXgsIGVsZW1lbnRzTGVuZ3RoKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBkcmFnIG9wdGlvbiB3YXMgcGFzc2VkIGluLCBzdWNjZXNzaXZlbHkgaW5jcmVhc2UvZGVjcmVhc2UgKGRlcGVuZGluZyBvbiB0aGUgcHJlc2Vuc2Ugb2Ygb3B0cy5iYWNrd2FyZHMpXG5cdFx0XHRcdFx0XHRcdCB0aGUgZHVyYXRpb24gb2YgZWFjaCBlbGVtZW50J3MgYW5pbWF0aW9uLCB1c2luZyBmbG9vcnMgdG8gcHJldmVudCBwcm9kdWNpbmcgdmVyeSBzaG9ydCBkdXJhdGlvbnMuICovXG5cdFx0XHRcdFx0XHRcdGlmIChvcHRzLmRyYWcpIHtcblx0XHRcdFx0XHRcdFx0XHQvKiBEZWZhdWx0IHRoZSBkdXJhdGlvbiBvZiBVSSBwYWNrIGVmZmVjdHMgKGNhbGxvdXRzIGFuZCB0cmFuc2l0aW9ucykgdG8gMTAwMG1zIGluc3RlYWQgb2YgdGhlIHVzdWFsIGRlZmF1bHQgZHVyYXRpb24gb2YgNDAwbXMuICovXG5cdFx0XHRcdFx0XHRcdFx0b3B0cy5kdXJhdGlvbiA9IHBhcnNlRmxvYXQoZHVyYXRpb25PcmlnaW5hbCkgfHwgKC9eKGNhbGxvdXR8dHJhbnNpdGlvbikvLnRlc3QocHJvcGVydGllc01hcCkgPyAxMDAwIDogRFVSQVRJT05fREVGQVVMVCk7XG5cblx0XHRcdFx0XHRcdFx0XHQvKiBGb3IgZWFjaCBlbGVtZW50LCB0YWtlIHRoZSBncmVhdGVyIGR1cmF0aW9uIG9mOiBBKSBhbmltYXRpb24gY29tcGxldGlvbiBwZXJjZW50YWdlIHJlbGF0aXZlIHRvIHRoZSBvcmlnaW5hbCBkdXJhdGlvbixcblx0XHRcdFx0XHRcdFx0XHQgQikgNzUlIG9mIHRoZSBvcmlnaW5hbCBkdXJhdGlvbiwgb3IgQykgYSAyMDBtcyBmYWxsYmFjayAoaW4gY2FzZSBkdXJhdGlvbiBpcyBhbHJlYWR5IHNldCB0byBhIGxvdyB2YWx1ZSkuXG5cdFx0XHRcdFx0XHRcdFx0IFRoZSBlbmQgcmVzdWx0IGlzIGEgYmFzZWxpbmUgb2YgNzUlIG9mIHRoZSByZWRpcmVjdCdzIGR1cmF0aW9uIHRoYXQgaW5jcmVhc2VzL2RlY3JlYXNlcyBhcyB0aGUgZW5kIG9mIHRoZSBlbGVtZW50IHNldCBpcyBhcHByb2FjaGVkLiAqL1xuXHRcdFx0XHRcdFx0XHRcdG9wdHMuZHVyYXRpb24gPSBNYXRoLm1heChvcHRzLmR1cmF0aW9uICogKG9wdHMuYmFja3dhcmRzID8gMSAtIGVsZW1lbnRJbmRleCAvIGVsZW1lbnRzTGVuZ3RoIDogKGVsZW1lbnRJbmRleCArIDEpIC8gZWxlbWVudHNMZW5ndGgpLCBvcHRzLmR1cmF0aW9uICogMC43NSwgMjAwKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIFBhc3MgaW4gdGhlIGNhbGwncyBvcHRzIG9iamVjdCBzbyB0aGF0IHRoZSByZWRpcmVjdCBjYW4gb3B0aW9uYWxseSBleHRlbmQgaXQuIEl0IGRlZmF1bHRzIHRvIGFuIGVtcHR5IG9iamVjdCBpbnN0ZWFkIG9mIG51bGwgdG9cblx0XHRcdFx0XHRcdFx0IHJlZHVjZSB0aGUgb3B0cyBjaGVja2luZyBsb2dpYyByZXF1aXJlZCBpbnNpZGUgdGhlIHJlZGlyZWN0LiAqL1xuXHRcdFx0XHRcdFx0XHRWZWxvY2l0eS5SZWRpcmVjdHNbcHJvcGVydGllc01hcF0uY2FsbChlbGVtZW50LCBlbGVtZW50LCBvcHRzIHx8IHt9LCBlbGVtZW50SW5kZXgsIGVsZW1lbnRzTGVuZ3RoLCBlbGVtZW50cywgcHJvbWlzZURhdGEucHJvbWlzZSA/IHByb21pc2VEYXRhIDogdW5kZWZpbmVkKTtcblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHQvKiBTaW5jZSB0aGUgYW5pbWF0aW9uIGxvZ2ljIHJlc2lkZXMgd2l0aGluIHRoZSByZWRpcmVjdCdzIG93biBjb2RlLCBhYm9ydCB0aGUgcmVtYWluZGVyIG9mIHRoaXMgY2FsbC5cblx0XHRcdFx0XHRcdCAoVGhlIHBlcmZvcm1hbmNlIG92ZXJoZWFkIHVwIHRvIHRoaXMgcG9pbnQgaXMgdmlydHVhbGx5IG5vbi1leGlzdGFudC4pICovXG5cdFx0XHRcdFx0XHQvKiBOb3RlOiBUaGUgalF1ZXJ5IGNhbGwgY2hhaW4gaXMga2VwdCBpbnRhY3QgYnkgcmV0dXJuaW5nIHRoZSBjb21wbGV0ZSBlbGVtZW50IHNldC4gKi9cblx0XHRcdFx0XHRcdHJldHVybiBnZXRDaGFpbigpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR2YXIgYWJvcnRFcnJvciA9IFwiVmVsb2NpdHk6IEZpcnN0IGFyZ3VtZW50IChcIiArIHByb3BlcnRpZXNNYXAgKyBcIikgd2FzIG5vdCBhIHByb3BlcnR5IG1hcCwgYSBrbm93biBhY3Rpb24sIG9yIGEgcmVnaXN0ZXJlZCByZWRpcmVjdC4gQWJvcnRpbmcuXCI7XG5cblx0XHRcdFx0XHRcdGlmIChwcm9taXNlRGF0YS5wcm9taXNlKSB7XG5cdFx0XHRcdFx0XHRcdHByb21pc2VEYXRhLnJlamVjdGVyKG5ldyBFcnJvcihhYm9ydEVycm9yKSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhhYm9ydEVycm9yKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIGdldENoYWluKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBDYWxsLVdpZGUgVmFyaWFibGVzXG5cdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdC8qIEEgY29udGFpbmVyIGZvciBDU1MgdW5pdCBjb252ZXJzaW9uIHJhdGlvcyAoZS5nLiAlLCByZW0sIGFuZCBlbSA9PT4gcHgpIHRoYXQgaXMgdXNlZCB0byBjYWNoZSByYXRpb3MgYWNyb3NzIGFsbCBlbGVtZW50c1xuXHRcdFx0IGJlaW5nIGFuaW1hdGVkIGluIGEgc2luZ2xlIFZlbG9jaXR5IGNhbGwuIENhbGN1bGF0aW5nIHVuaXQgcmF0aW9zIG5lY2Vzc2l0YXRlcyBET00gcXVlcnlpbmcgYW5kIHVwZGF0aW5nLCBhbmQgaXMgdGhlcmVmb3JlXG5cdFx0XHQgYXZvaWRlZCAodmlhIGNhY2hpbmcpIHdoZXJldmVyIHBvc3NpYmxlLiBUaGlzIGNvbnRhaW5lciBpcyBjYWxsLXdpZGUgaW5zdGVhZCBvZiBwYWdlLXdpZGUgdG8gYXZvaWQgdGhlIHJpc2sgb2YgdXNpbmcgc3RhbGVcblx0XHRcdCBjb252ZXJzaW9uIG1ldHJpY3MgYWNyb3NzIFZlbG9jaXR5IGFuaW1hdGlvbnMgdGhhdCBhcmUgbm90IGltbWVkaWF0ZWx5IGNvbnNlY3V0aXZlbHkgY2hhaW5lZC4gKi9cblx0XHRcdHZhciBjYWxsVW5pdENvbnZlcnNpb25EYXRhID0ge1xuXHRcdFx0XHRsYXN0UGFyZW50OiBudWxsLFxuXHRcdFx0XHRsYXN0UG9zaXRpb246IG51bGwsXG5cdFx0XHRcdGxhc3RGb250U2l6ZTogbnVsbCxcblx0XHRcdFx0bGFzdFBlcmNlbnRUb1B4V2lkdGg6IG51bGwsXG5cdFx0XHRcdGxhc3RQZXJjZW50VG9QeEhlaWdodDogbnVsbCxcblx0XHRcdFx0bGFzdEVtVG9QeDogbnVsbCxcblx0XHRcdFx0cmVtVG9QeDogbnVsbCxcblx0XHRcdFx0dndUb1B4OiBudWxsLFxuXHRcdFx0XHR2aFRvUHg6IG51bGxcblx0XHRcdH07XG5cblx0XHRcdC8qIEEgY29udGFpbmVyIGZvciBhbGwgdGhlIGVuc3VpbmcgdHdlZW4gZGF0YSBhbmQgbWV0YWRhdGEgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2FsbC4gVGhpcyBjb250YWluZXIgZ2V0cyBwdXNoZWQgdG8gdGhlIHBhZ2Utd2lkZVxuXHRcdFx0IFZlbG9jaXR5LlN0YXRlLmNhbGxzIGFycmF5IHRoYXQgaXMgcHJvY2Vzc2VkIGR1cmluZyBhbmltYXRpb24gdGlja2luZy4gKi9cblx0XHRcdHZhciBjYWxsID0gW107XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBFbGVtZW50IFByb2Nlc3Npbmdcblx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdC8qIEVsZW1lbnQgcHJvY2Vzc2luZyBjb25zaXN0cyBvZiB0aHJlZSBwYXJ0cyAtLSBkYXRhIHByb2Nlc3NpbmcgdGhhdCBjYW5ub3QgZ28gc3RhbGUgYW5kIGRhdGEgcHJvY2Vzc2luZyB0aGF0ICpjYW4qIGdvIHN0YWxlIChpLmUuIHRoaXJkLXBhcnR5IHN0eWxlIG1vZGlmaWNhdGlvbnMpOlxuXHRcdFx0IDEpIFByZS1RdWV1ZWluZzogRWxlbWVudC13aWRlIHZhcmlhYmxlcywgaW5jbHVkaW5nIHRoZSBlbGVtZW50J3MgZGF0YSBzdG9yYWdlLCBhcmUgaW5zdGFudGlhdGVkLiBDYWxsIG9wdGlvbnMgYXJlIHByZXBhcmVkLiBJZiB0cmlnZ2VyZWQsIHRoZSBTdG9wIGFjdGlvbiBpcyBleGVjdXRlZC5cblx0XHRcdCAyKSBRdWV1ZWluZzogVGhlIGxvZ2ljIHRoYXQgcnVucyBvbmNlIHRoaXMgY2FsbCBoYXMgcmVhY2hlZCBpdHMgcG9pbnQgb2YgZXhlY3V0aW9uIGluIHRoZSBlbGVtZW50J3MgJC5xdWV1ZSgpIHN0YWNrLiBNb3N0IGxvZ2ljIGlzIHBsYWNlZCBoZXJlIHRvIGF2b2lkIHJpc2tpbmcgaXQgYmVjb21pbmcgc3RhbGUuXG5cdFx0XHQgMykgUHVzaGluZzogQ29uc29saWRhdGlvbiBvZiB0aGUgdHdlZW4gZGF0YSBmb2xsb3dlZCBieSBpdHMgcHVzaCBvbnRvIHRoZSBnbG9iYWwgaW4tcHJvZ3Jlc3MgY2FsbHMgY29udGFpbmVyLlxuXHRcdFx0IGBlbGVtZW50QXJyYXlJbmRleGAgYWxsb3dzIHBhc3NpbmcgaW5kZXggb2YgdGhlIGVsZW1lbnQgaW4gdGhlIG9yaWdpbmFsIGFycmF5IHRvIHZhbHVlIGZ1bmN0aW9ucy5cblx0XHRcdCBJZiBgZWxlbWVudHNJbmRleGAgd2VyZSB1c2VkIGluc3RlYWQgdGhlIGluZGV4IHdvdWxkIGJlIGRldGVybWluZWQgYnkgdGhlIGVsZW1lbnRzJyBwZXItZWxlbWVudCBxdWV1ZS5cblx0XHRcdCAqL1xuXHRcdFx0ZnVuY3Rpb24gcHJvY2Vzc0VsZW1lbnQoZWxlbWVudCwgZWxlbWVudEFycmF5SW5kZXgpIHtcblxuXHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgUGFydCBJOiBQcmUtUXVldWVpbmdcblx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgRWxlbWVudC1XaWRlIFZhcmlhYmxlc1xuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdHZhciAvKiBUaGUgcnVudGltZSBvcHRzIG9iamVjdCBpcyB0aGUgZXh0ZW5zaW9uIG9mIHRoZSBjdXJyZW50IGNhbGwncyBvcHRpb25zIGFuZCBWZWxvY2l0eSdzIHBhZ2Utd2lkZSBvcHRpb24gZGVmYXVsdHMuICovXG5cdFx0XHRcdFx0XHRvcHRzID0gJC5leHRlbmQoe30sIFZlbG9jaXR5LmRlZmF1bHRzLCBvcHRpb25zKSxcblx0XHRcdFx0XHRcdC8qIEEgY29udGFpbmVyIGZvciB0aGUgcHJvY2Vzc2VkIGRhdGEgYXNzb2NpYXRlZCB3aXRoIGVhY2ggcHJvcGVydHkgaW4gdGhlIHByb3BlcnR5TWFwLlxuXHRcdFx0XHRcdFx0IChFYWNoIHByb3BlcnR5IGluIHRoZSBtYXAgcHJvZHVjZXMgaXRzIG93biBcInR3ZWVuXCIuKSAqL1xuXHRcdFx0XHRcdFx0dHdlZW5zQ29udGFpbmVyID0ge30sXG5cdFx0XHRcdFx0XHRlbGVtZW50VW5pdENvbnZlcnNpb25EYXRhO1xuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IEVsZW1lbnQgSW5pdFxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdGlmIChEYXRhKGVsZW1lbnQpID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRWZWxvY2l0eS5pbml0KGVsZW1lbnQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgT3B0aW9uOiBEZWxheVxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIFNpbmNlIHF1ZXVlOmZhbHNlIGRvZXNuJ3QgcmVzcGVjdCB0aGUgaXRlbSdzIGV4aXN0aW5nIHF1ZXVlLCB3ZSBhdm9pZCBpbmplY3RpbmcgaXRzIGRlbGF5IGhlcmUgKGl0J3Mgc2V0IGxhdGVyIG9uKS4gKi9cblx0XHRcdFx0LyogTm90ZTogVmVsb2NpdHkgcm9sbHMgaXRzIG93biBkZWxheSBmdW5jdGlvbiBzaW5jZSBqUXVlcnkgZG9lc24ndCBoYXZlIGEgdXRpbGl0eSBhbGlhcyBmb3IgJC5mbi5kZWxheSgpXG5cdFx0XHRcdCAoYW5kIHRodXMgcmVxdWlyZXMgalF1ZXJ5IGVsZW1lbnQgY3JlYXRpb24sIHdoaWNoIHdlIGF2b2lkIHNpbmNlIGl0cyBvdmVyaGVhZCBpbmNsdWRlcyBET00gcXVlcnlpbmcpLiAqL1xuXHRcdFx0XHRpZiAocGFyc2VGbG9hdChvcHRzLmRlbGF5KSAmJiBvcHRzLnF1ZXVlICE9PSBmYWxzZSkge1xuXHRcdFx0XHRcdCQucXVldWUoZWxlbWVudCwgb3B0cy5xdWV1ZSwgZnVuY3Rpb24obmV4dCkge1xuXHRcdFx0XHRcdFx0LyogVGhpcyBpcyBhIGZsYWcgdXNlZCB0byBpbmRpY2F0ZSB0byB0aGUgdXBjb21pbmcgY29tcGxldGVDYWxsKCkgZnVuY3Rpb24gdGhhdCB0aGlzIHF1ZXVlIGVudHJ5IHdhcyBpbml0aWF0ZWQgYnkgVmVsb2NpdHkuIFNlZSBjb21wbGV0ZUNhbGwoKSBmb3IgZnVydGhlciBkZXRhaWxzLiAqL1xuXHRcdFx0XHRcdFx0VmVsb2NpdHkudmVsb2NpdHlRdWV1ZUVudHJ5RmxhZyA9IHRydWU7XG5cblx0XHRcdFx0XHRcdC8qIFRoZSBlbnN1aW5nIHF1ZXVlIGl0ZW0gKHdoaWNoIGlzIGFzc2lnbmVkIHRvIHRoZSBcIm5leHRcIiBhcmd1bWVudCB0aGF0ICQucXVldWUoKSBhdXRvbWF0aWNhbGx5IHBhc3NlcyBpbikgd2lsbCBiZSB0cmlnZ2VyZWQgYWZ0ZXIgYSBzZXRUaW1lb3V0IGRlbGF5LlxuXHRcdFx0XHRcdFx0IFRoZSBzZXRUaW1lb3V0IGlzIHN0b3JlZCBzbyB0aGF0IGl0IGNhbiBiZSBzdWJqZWN0ZWQgdG8gY2xlYXJUaW1lb3V0KCkgaWYgdGhpcyBhbmltYXRpb24gaXMgcHJlbWF0dXJlbHkgc3RvcHBlZCB2aWEgVmVsb2NpdHkncyBcInN0b3BcIiBjb21tYW5kLiAqL1xuXHRcdFx0XHRcdFx0RGF0YShlbGVtZW50KS5kZWxheVRpbWVyID0ge1xuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0OiBzZXRUaW1lb3V0KG5leHQsIHBhcnNlRmxvYXQob3B0cy5kZWxheSkpLFxuXHRcdFx0XHRcdFx0XHRuZXh0OiBuZXh0XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgT3B0aW9uOiBEdXJhdGlvblxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIFN1cHBvcnQgZm9yIGpRdWVyeSdzIG5hbWVkIGR1cmF0aW9ucy4gKi9cblx0XHRcdFx0c3dpdGNoIChvcHRzLmR1cmF0aW9uLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSkge1xuXHRcdFx0XHRcdGNhc2UgXCJmYXN0XCI6XG5cdFx0XHRcdFx0XHRvcHRzLmR1cmF0aW9uID0gMjAwO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwibm9ybWFsXCI6XG5cdFx0XHRcdFx0XHRvcHRzLmR1cmF0aW9uID0gRFVSQVRJT05fREVGQVVMVDtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcInNsb3dcIjpcblx0XHRcdFx0XHRcdG9wdHMuZHVyYXRpb24gPSA2MDA7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHQvKiBSZW1vdmUgdGhlIHBvdGVudGlhbCBcIm1zXCIgc3VmZml4IGFuZCBkZWZhdWx0IHRvIDEgaWYgdGhlIHVzZXIgaXMgYXR0ZW1wdGluZyB0byBzZXQgYSBkdXJhdGlvbiBvZiAwIChpbiBvcmRlciB0byBwcm9kdWNlIGFuIGltbWVkaWF0ZSBzdHlsZSBjaGFuZ2UpLiAqL1xuXHRcdFx0XHRcdFx0b3B0cy5kdXJhdGlvbiA9IHBhcnNlRmxvYXQob3B0cy5kdXJhdGlvbikgfHwgMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IEdsb2JhbCBPcHRpb246IE1vY2tcblx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRpZiAoVmVsb2NpdHkubW9jayAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHQvKiBJbiBtb2NrIG1vZGUsIGFsbCBhbmltYXRpb25zIGFyZSBmb3JjZWQgdG8gMW1zIHNvIHRoYXQgdGhleSBvY2N1ciBpbW1lZGlhdGVseSB1cG9uIHRoZSBuZXh0IHJBRiB0aWNrLlxuXHRcdFx0XHRcdCBBbHRlcm5hdGl2ZWx5LCBhIG11bHRpcGxpZXIgY2FuIGJlIHBhc3NlZCBpbiB0byB0aW1lIHJlbWFwIGFsbCBkZWxheXMgYW5kIGR1cmF0aW9ucy4gKi9cblx0XHRcdFx0XHRpZiAoVmVsb2NpdHkubW9jayA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdFx0b3B0cy5kdXJhdGlvbiA9IG9wdHMuZGVsYXkgPSAxO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRvcHRzLmR1cmF0aW9uICo9IHBhcnNlRmxvYXQoVmVsb2NpdHkubW9jaykgfHwgMTtcblx0XHRcdFx0XHRcdG9wdHMuZGVsYXkgKj0gcGFyc2VGbG9hdChWZWxvY2l0eS5tb2NrKSB8fCAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdCBPcHRpb246IEVhc2luZ1xuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRvcHRzLmVhc2luZyA9IGdldEVhc2luZyhvcHRzLmVhc2luZywgb3B0cy5kdXJhdGlvbik7XG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IE9wdGlvbjogQ2FsbGJhY2tzXG5cdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIENhbGxiYWNrcyBtdXN0IGZ1bmN0aW9ucy4gT3RoZXJ3aXNlLCBkZWZhdWx0IHRvIG51bGwuICovXG5cdFx0XHRcdGlmIChvcHRzLmJlZ2luICYmICFUeXBlLmlzRnVuY3Rpb24ob3B0cy5iZWdpbikpIHtcblx0XHRcdFx0XHRvcHRzLmJlZ2luID0gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvcHRzLnByb2dyZXNzICYmICFUeXBlLmlzRnVuY3Rpb24ob3B0cy5wcm9ncmVzcykpIHtcblx0XHRcdFx0XHRvcHRzLnByb2dyZXNzID0gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChvcHRzLmNvbXBsZXRlICYmICFUeXBlLmlzRnVuY3Rpb24ob3B0cy5jb21wbGV0ZSkpIHtcblx0XHRcdFx0XHRvcHRzLmNvbXBsZXRlID0gbnVsbDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IE9wdGlvbjogRGlzcGxheSAmIFZpc2liaWxpdHlcblx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHQvKiBSZWZlciB0byBWZWxvY2l0eSdzIGRvY3VtZW50YXRpb24gKFZlbG9jaXR5SlMub3JnLyNkaXNwbGF5QW5kVmlzaWJpbGl0eSkgZm9yIGEgZGVzY3JpcHRpb24gb2YgdGhlIGRpc3BsYXkgYW5kIHZpc2liaWxpdHkgb3B0aW9ucycgYmVoYXZpb3IuICovXG5cdFx0XHRcdC8qIE5vdGU6IFdlIHN0cmljdGx5IGNoZWNrIGZvciB1bmRlZmluZWQgaW5zdGVhZCBvZiBmYWxzaW5lc3MgYmVjYXVzZSBkaXNwbGF5IGFjY2VwdHMgYW4gZW1wdHkgc3RyaW5nIHZhbHVlLiAqL1xuXHRcdFx0XHRpZiAob3B0cy5kaXNwbGF5ICE9PSB1bmRlZmluZWQgJiYgb3B0cy5kaXNwbGF5ICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0b3B0cy5kaXNwbGF5ID0gb3B0cy5kaXNwbGF5LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcblxuXHRcdFx0XHRcdC8qIFVzZXJzIGNhbiBwYXNzIGluIGEgc3BlY2lhbCBcImF1dG9cIiB2YWx1ZSB0byBpbnN0cnVjdCBWZWxvY2l0eSB0byBzZXQgdGhlIGVsZW1lbnQgdG8gaXRzIGRlZmF1bHQgZGlzcGxheSB2YWx1ZS4gKi9cblx0XHRcdFx0XHRpZiAob3B0cy5kaXNwbGF5ID09PSBcImF1dG9cIikge1xuXHRcdFx0XHRcdFx0b3B0cy5kaXNwbGF5ID0gVmVsb2NpdHkuQ1NTLlZhbHVlcy5nZXREaXNwbGF5VHlwZShlbGVtZW50KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAob3B0cy52aXNpYmlsaXR5ICE9PSB1bmRlZmluZWQgJiYgb3B0cy52aXNpYmlsaXR5ICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0b3B0cy52aXNpYmlsaXR5ID0gb3B0cy52aXNpYmlsaXR5LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdCBPcHRpb246IG1vYmlsZUhBXG5cdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIFdoZW4gc2V0IHRvIHRydWUsIGFuZCBpZiB0aGlzIGlzIGEgbW9iaWxlIGRldmljZSwgbW9iaWxlSEEgYXV0b21hdGljYWxseSBlbmFibGVzIGhhcmR3YXJlIGFjY2VsZXJhdGlvbiAodmlhIGEgbnVsbCB0cmFuc2Zvcm0gaGFjaylcblx0XHRcdFx0IG9uIGFuaW1hdGluZyBlbGVtZW50cy4gSEEgaXMgcmVtb3ZlZCBmcm9tIHRoZSBlbGVtZW50IGF0IHRoZSBjb21wbGV0aW9uIG9mIGl0cyBhbmltYXRpb24uICovXG5cdFx0XHRcdC8qIE5vdGU6IEFuZHJvaWQgR2luZ2VyYnJlYWQgZG9lc24ndCBzdXBwb3J0IEhBLiBJZiBhIG51bGwgdHJhbnNmb3JtIGhhY2sgKG1vYmlsZUhBKSBpcyBpbiBmYWN0IHNldCwgaXQgd2lsbCBwcmV2ZW50IG90aGVyIHRyYW5mb3JtIHN1YnByb3BlcnRpZXMgZnJvbSB0YWtpbmcgZWZmZWN0LiAqL1xuXHRcdFx0XHQvKiBOb3RlOiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCB0aGUgdXNlIG9mIG1vYmlsZUhBIGluIFZlbG9jaXR5J3MgZG9jdW1lbnRhdGlvbjogVmVsb2NpdHlKUy5vcmcvI21vYmlsZUhBLiAqL1xuXHRcdFx0XHRvcHRzLm1vYmlsZUhBID0gKG9wdHMubW9iaWxlSEEgJiYgVmVsb2NpdHkuU3RhdGUuaXNNb2JpbGUgJiYgIVZlbG9jaXR5LlN0YXRlLmlzR2luZ2VyYnJlYWQpO1xuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgUGFydCBJSTogUXVldWVpbmdcblx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIFdoZW4gYSBzZXQgb2YgZWxlbWVudHMgaXMgdGFyZ2V0ZWQgYnkgYSBWZWxvY2l0eSBjYWxsLCB0aGUgc2V0IGlzIGJyb2tlbiB1cCBhbmQgZWFjaCBlbGVtZW50IGhhcyB0aGUgY3VycmVudCBWZWxvY2l0eSBjYWxsIGluZGl2aWR1YWxseSBxdWV1ZWQgb250byBpdC5cblx0XHRcdFx0IEluIHRoaXMgd2F5LCBlYWNoIGVsZW1lbnQncyBleGlzdGluZyBxdWV1ZSBpcyByZXNwZWN0ZWQ7IHNvbWUgZWxlbWVudHMgbWF5IGFscmVhZHkgYmUgYW5pbWF0aW5nIGFuZCBhY2NvcmRpbmdseSBzaG91bGQgbm90IGhhdmUgdGhpcyBjdXJyZW50IFZlbG9jaXR5IGNhbGwgdHJpZ2dlcmVkIGltbWVkaWF0ZWx5LiAqL1xuXHRcdFx0XHQvKiBJbiBlYWNoIHF1ZXVlLCB0d2VlbiBkYXRhIGlzIHByb2Nlc3NlZCBmb3IgZWFjaCBhbmltYXRpbmcgcHJvcGVydHkgdGhlbiBwdXNoZWQgb250byB0aGUgY2FsbC13aWRlIGNhbGxzIGFycmF5LiBXaGVuIHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIHNldCBoYXMgaGFkIGl0cyB0d2VlbnMgcHJvY2Vzc2VkLFxuXHRcdFx0XHQgdGhlIGNhbGwgYXJyYXkgaXMgcHVzaGVkIHRvIFZlbG9jaXR5LlN0YXRlLmNhbGxzIGZvciBsaXZlIHByb2Nlc3NpbmcgYnkgdGhlIHJlcXVlc3RBbmltYXRpb25GcmFtZSB0aWNrLiAqL1xuXHRcdFx0XHRmdW5jdGlvbiBidWlsZFF1ZXVlKG5leHQpIHtcblx0XHRcdFx0XHR2YXIgZGF0YSwgbGFzdFR3ZWVuc0NvbnRhaW5lcjtcblxuXHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0IE9wdGlvbjogQmVnaW5cblx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdC8qIFRoZSBiZWdpbiBjYWxsYmFjayBpcyBmaXJlZCBvbmNlIHBlciBjYWxsIC0tIG5vdCBvbmNlIHBlciBlbGVtZW5ldCAtLSBhbmQgaXMgcGFzc2VkIHRoZSBmdWxsIHJhdyBET00gZWxlbWVudCBzZXQgYXMgYm90aCBpdHMgY29udGV4dCBhbmQgaXRzIGZpcnN0IGFyZ3VtZW50LiAqL1xuXHRcdFx0XHRcdGlmIChvcHRzLmJlZ2luICYmIGVsZW1lbnRzSW5kZXggPT09IDApIHtcblx0XHRcdFx0XHRcdC8qIFdlIHRocm93IGNhbGxiYWNrcyBpbiBhIHNldFRpbWVvdXQgc28gdGhhdCB0aHJvd24gZXJyb3JzIGRvbid0IGhhbHQgdGhlIGV4ZWN1dGlvbiBvZiBWZWxvY2l0eSBpdHNlbGYuICovXG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRvcHRzLmJlZ2luLmNhbGwoZWxlbWVudHMsIGVsZW1lbnRzKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgZXJyb3I7XG5cdFx0XHRcdFx0XHRcdH0sIDEpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdCBUd2VlbiBEYXRhIENvbnN0cnVjdGlvbiAoZm9yIFNjcm9sbClcblx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHQvKiBOb3RlOiBJbiBvcmRlciB0byBiZSBzdWJqZWN0ZWQgdG8gY2hhaW5pbmcgYW5kIGFuaW1hdGlvbiBvcHRpb25zLCBzY3JvbGwncyB0d2VlbmluZyBpcyByb3V0ZWQgdGhyb3VnaCBWZWxvY2l0eSBhcyBpZiBpdCB3ZXJlIGEgc3RhbmRhcmQgQ1NTIHByb3BlcnR5IGFuaW1hdGlvbi4gKi9cblx0XHRcdFx0XHRpZiAoYWN0aW9uID09PSBcInNjcm9sbFwiKSB7XG5cdFx0XHRcdFx0XHQvKiBUaGUgc2Nyb2xsIGFjdGlvbiB1bmlxdWVseSB0YWtlcyBhbiBvcHRpb25hbCBcIm9mZnNldFwiIG9wdGlvbiAtLSBzcGVjaWZpZWQgaW4gcGl4ZWxzIC0tIHRoYXQgb2Zmc2V0cyB0aGUgdGFyZ2V0ZWQgc2Nyb2xsIHBvc2l0aW9uLiAqL1xuXHRcdFx0XHRcdFx0dmFyIHNjcm9sbERpcmVjdGlvbiA9ICgvXngkL2kudGVzdChvcHRzLmF4aXMpID8gXCJMZWZ0XCIgOiBcIlRvcFwiKSxcblx0XHRcdFx0XHRcdFx0XHRzY3JvbGxPZmZzZXQgPSBwYXJzZUZsb2F0KG9wdHMub2Zmc2V0KSB8fCAwLFxuXHRcdFx0XHRcdFx0XHRcdHNjcm9sbFBvc2l0aW9uQ3VycmVudCxcblx0XHRcdFx0XHRcdFx0XHRzY3JvbGxQb3NpdGlvbkN1cnJlbnRBbHRlcm5hdGUsXG5cdFx0XHRcdFx0XHRcdFx0c2Nyb2xsUG9zaXRpb25FbmQ7XG5cblx0XHRcdFx0XHRcdC8qIFNjcm9sbCBhbHNvIHVuaXF1ZWx5IHRha2VzIGFuIG9wdGlvbmFsIFwiY29udGFpbmVyXCIgb3B0aW9uLCB3aGljaCBpbmRpY2F0ZXMgdGhlIHBhcmVudCBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHNjcm9sbGVkIC0tXG5cdFx0XHRcdFx0XHQgYXMgb3Bwb3NlZCB0byB0aGUgYnJvd3NlciB3aW5kb3cgaXRzZWxmLiBUaGlzIGlzIHVzZWZ1bCBmb3Igc2Nyb2xsaW5nIHRvd2FyZCBhbiBlbGVtZW50IHRoYXQncyBpbnNpZGUgYW4gb3ZlcmZsb3dpbmcgcGFyZW50IGVsZW1lbnQuICovXG5cdFx0XHRcdFx0XHRpZiAob3B0cy5jb250YWluZXIpIHtcblx0XHRcdFx0XHRcdFx0LyogRW5zdXJlIHRoYXQgZWl0aGVyIGEgalF1ZXJ5IG9iamVjdCBvciBhIHJhdyBET00gZWxlbWVudCB3YXMgcGFzc2VkIGluLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoVHlwZS5pc1dyYXBwZWQob3B0cy5jb250YWluZXIpIHx8IFR5cGUuaXNOb2RlKG9wdHMuY29udGFpbmVyKSkge1xuXHRcdFx0XHRcdFx0XHRcdC8qIEV4dHJhY3QgdGhlIHJhdyBET00gZWxlbWVudCBmcm9tIHRoZSBqUXVlcnkgd3JhcHBlci4gKi9cblx0XHRcdFx0XHRcdFx0XHRvcHRzLmNvbnRhaW5lciA9IG9wdHMuY29udGFpbmVyWzBdIHx8IG9wdHMuY29udGFpbmVyO1xuXHRcdFx0XHRcdFx0XHRcdC8qIE5vdGU6IFVubGlrZSBvdGhlciBwcm9wZXJ0aWVzIGluIFZlbG9jaXR5LCB0aGUgYnJvd3NlcidzIHNjcm9sbCBwb3NpdGlvbiBpcyBuZXZlciBjYWNoZWQgc2luY2UgaXQgc28gZnJlcXVlbnRseSBjaGFuZ2VzXG5cdFx0XHRcdFx0XHRcdFx0IChkdWUgdG8gdGhlIHVzZXIncyBuYXR1cmFsIGludGVyYWN0aW9uIHdpdGggdGhlIHBhZ2UpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdHNjcm9sbFBvc2l0aW9uQ3VycmVudCA9IG9wdHMuY29udGFpbmVyW1wic2Nyb2xsXCIgKyBzY3JvbGxEaXJlY3Rpb25dOyAvKiBHRVQgKi9cblxuXHRcdFx0XHRcdFx0XHRcdC8qICQucG9zaXRpb24oKSB2YWx1ZXMgYXJlIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXIncyBjdXJyZW50bHkgdmlld2FibGUgYXJlYSAod2l0aG91dCB0YWtpbmcgaW50byBhY2NvdW50IHRoZSBjb250YWluZXIncyB0cnVlIGRpbWVuc2lvbnNcblx0XHRcdFx0XHRcdFx0XHQgLS0gc2F5LCBmb3IgZXhhbXBsZSwgaWYgdGhlIGNvbnRhaW5lciB3YXMgbm90IG92ZXJmbG93aW5nKS4gVGh1cywgdGhlIHNjcm9sbCBlbmQgdmFsdWUgaXMgdGhlIHN1bSBvZiB0aGUgY2hpbGQgZWxlbWVudCdzIHBvc2l0aW9uICphbmQqXG5cdFx0XHRcdFx0XHRcdFx0IHRoZSBzY3JvbGwgY29udGFpbmVyJ3MgY3VycmVudCBzY3JvbGwgcG9zaXRpb24uICovXG5cdFx0XHRcdFx0XHRcdFx0c2Nyb2xsUG9zaXRpb25FbmQgPSAoc2Nyb2xsUG9zaXRpb25DdXJyZW50ICsgJChlbGVtZW50KS5wb3NpdGlvbigpW3Njcm9sbERpcmVjdGlvbi50b0xvd2VyQ2FzZSgpXSkgKyBzY3JvbGxPZmZzZXQ7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdC8qIElmIGEgdmFsdWUgb3RoZXIgdGhhbiBhIGpRdWVyeSBvYmplY3Qgb3IgYSByYXcgRE9NIGVsZW1lbnQgd2FzIHBhc3NlZCBpbiwgZGVmYXVsdCB0byBudWxsIHNvIHRoYXQgdGhpcyBvcHRpb24gaXMgaWdub3JlZC4gKi9cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRvcHRzLmNvbnRhaW5lciA9IG51bGw7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdC8qIElmIHRoZSB3aW5kb3cgaXRzZWxmIGlzIGJlaW5nIHNjcm9sbGVkIC0tIG5vdCBhIGNvbnRhaW5pbmcgZWxlbWVudCAtLSBwZXJmb3JtIGEgbGl2ZSBzY3JvbGwgcG9zaXRpb24gbG9va3VwIHVzaW5nXG5cdFx0XHRcdFx0XHRcdCB0aGUgYXBwcm9wcmlhdGUgY2FjaGVkIHByb3BlcnR5IG5hbWVzICh3aGljaCBkaWZmZXIgYmFzZWQgb24gYnJvd3NlciB0eXBlKS4gKi9cblx0XHRcdFx0XHRcdFx0c2Nyb2xsUG9zaXRpb25DdXJyZW50ID0gVmVsb2NpdHkuU3RhdGUuc2Nyb2xsQW5jaG9yW1ZlbG9jaXR5LlN0YXRlW1wic2Nyb2xsUHJvcGVydHlcIiArIHNjcm9sbERpcmVjdGlvbl1dOyAvKiBHRVQgKi9cblx0XHRcdFx0XHRcdFx0LyogV2hlbiBzY3JvbGxpbmcgdGhlIGJyb3dzZXIgd2luZG93LCBjYWNoZSB0aGUgYWx0ZXJuYXRlIGF4aXMncyBjdXJyZW50IHZhbHVlIHNpbmNlIHdpbmRvdy5zY3JvbGxUbygpIGRvZXNuJ3QgbGV0IHVzIGNoYW5nZSBvbmx5IG9uZSB2YWx1ZSBhdCBhIHRpbWUuICovXG5cdFx0XHRcdFx0XHRcdHNjcm9sbFBvc2l0aW9uQ3VycmVudEFsdGVybmF0ZSA9IFZlbG9jaXR5LlN0YXRlLnNjcm9sbEFuY2hvcltWZWxvY2l0eS5TdGF0ZVtcInNjcm9sbFByb3BlcnR5XCIgKyAoc2Nyb2xsRGlyZWN0aW9uID09PSBcIkxlZnRcIiA/IFwiVG9wXCIgOiBcIkxlZnRcIildXTsgLyogR0VUICovXG5cblx0XHRcdFx0XHRcdFx0LyogVW5saWtlICQucG9zaXRpb24oKSwgJC5vZmZzZXQoKSB2YWx1ZXMgYXJlIHJlbGF0aXZlIHRvIHRoZSBicm93c2VyIHdpbmRvdydzIHRydWUgZGltZW5zaW9ucyAtLSBub3QgbWVyZWx5IGl0cyBjdXJyZW50bHkgdmlld2FibGUgYXJlYSAtLVxuXHRcdFx0XHRcdFx0XHQgYW5kIHRoZXJlZm9yZSBlbmQgdmFsdWVzIGRvIG5vdCBuZWVkIHRvIGJlIGNvbXBvdW5kZWQgb250byBjdXJyZW50IHZhbHVlcy4gKi9cblx0XHRcdFx0XHRcdFx0c2Nyb2xsUG9zaXRpb25FbmQgPSAkKGVsZW1lbnQpLm9mZnNldCgpW3Njcm9sbERpcmVjdGlvbi50b0xvd2VyQ2FzZSgpXSArIHNjcm9sbE9mZnNldDsgLyogR0VUICovXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8qIFNpbmNlIHRoZXJlJ3Mgb25seSBvbmUgZm9ybWF0IHRoYXQgc2Nyb2xsJ3MgYXNzb2NpYXRlZCB0d2VlbnNDb250YWluZXIgY2FuIHRha2UsIHdlIGNyZWF0ZSBpdCBtYW51YWxseS4gKi9cblx0XHRcdFx0XHRcdHR3ZWVuc0NvbnRhaW5lciA9IHtcblx0XHRcdFx0XHRcdFx0c2Nyb2xsOiB7XG5cdFx0XHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWU6IGZhbHNlLFxuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWU6IHNjcm9sbFBvc2l0aW9uQ3VycmVudCxcblx0XHRcdFx0XHRcdFx0XHRjdXJyZW50VmFsdWU6IHNjcm9sbFBvc2l0aW9uQ3VycmVudCxcblx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZTogc2Nyb2xsUG9zaXRpb25FbmQsXG5cdFx0XHRcdFx0XHRcdFx0dW5pdFR5cGU6IFwiXCIsXG5cdFx0XHRcdFx0XHRcdFx0ZWFzaW5nOiBvcHRzLmVhc2luZyxcblx0XHRcdFx0XHRcdFx0XHRzY3JvbGxEYXRhOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb250YWluZXI6IG9wdHMuY29udGFpbmVyLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZGlyZWN0aW9uOiBzY3JvbGxEaXJlY3Rpb24sXG5cdFx0XHRcdFx0XHRcdFx0XHRhbHRlcm5hdGVWYWx1ZTogc2Nyb2xsUG9zaXRpb25DdXJyZW50QWx0ZXJuYXRlXG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRlbGVtZW50OiBlbGVtZW50XG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRpZiAoVmVsb2NpdHkuZGVidWcpIHtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJ0d2VlbnNDb250YWluZXIgKHNjcm9sbCk6IFwiLCB0d2VlbnNDb250YWluZXIuc2Nyb2xsLCBlbGVtZW50KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0IFR3ZWVuIERhdGEgQ29uc3RydWN0aW9uIChmb3IgUmV2ZXJzZSlcblx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdC8qIFJldmVyc2UgYWN0cyBsaWtlIGEgXCJzdGFydFwiIGFjdGlvbiBpbiB0aGF0IGEgcHJvcGVydHkgbWFwIGlzIGFuaW1hdGVkIHRvd2FyZC4gVGhlIG9ubHkgZGlmZmVyZW5jZSBpc1xuXHRcdFx0XHRcdFx0IHRoYXQgdGhlIHByb3BlcnR5IG1hcCB1c2VkIGZvciByZXZlcnNlIGlzIHRoZSBpbnZlcnNlIG9mIHRoZSBtYXAgdXNlZCBpbiB0aGUgcHJldmlvdXMgY2FsbC4gVGh1cywgd2UgbWFuaXB1bGF0ZVxuXHRcdFx0XHRcdFx0IHRoZSBwcmV2aW91cyBjYWxsIHRvIGNvbnN0cnVjdCBvdXIgbmV3IG1hcDogdXNlIHRoZSBwcmV2aW91cyBtYXAncyBlbmQgdmFsdWVzIGFzIG91ciBuZXcgbWFwJ3Mgc3RhcnQgdmFsdWVzLiBDb3B5IG92ZXIgYWxsIG90aGVyIGRhdGEuICovXG5cdFx0XHRcdFx0XHQvKiBOb3RlOiBSZXZlcnNlIGNhbiBiZSBkaXJlY3RseSBjYWxsZWQgdmlhIHRoZSBcInJldmVyc2VcIiBwYXJhbWV0ZXIsIG9yIGl0IGNhbiBiZSBpbmRpcmVjdGx5IHRyaWdnZXJlZCB2aWEgdGhlIGxvb3Agb3B0aW9uLiAoTG9vcHMgYXJlIGNvbXBvc2VkIG9mIG11bHRpcGxlIHJldmVyc2VzLikgKi9cblx0XHRcdFx0XHRcdC8qIE5vdGU6IFJldmVyc2UgY2FsbHMgZG8gbm90IG5lZWQgdG8gYmUgY29uc2VjdXRpdmVseSBjaGFpbmVkIG9udG8gYSBjdXJyZW50bHktYW5pbWF0aW5nIGVsZW1lbnQgaW4gb3JkZXIgdG8gb3BlcmF0ZSBvbiBjYWNoZWQgdmFsdWVzO1xuXHRcdFx0XHRcdFx0IHRoZXJlIGlzIG5vIGhhcm0gdG8gcmV2ZXJzZSBiZWluZyBjYWxsZWQgb24gYSBwb3RlbnRpYWxseSBzdGFsZSBkYXRhIGNhY2hlIHNpbmNlIHJldmVyc2UncyBiZWhhdmlvciBpcyBzaW1wbHkgZGVmaW5lZFxuXHRcdFx0XHRcdFx0IGFzIHJldmVydGluZyB0byB0aGUgZWxlbWVudCdzIHZhbHVlcyBhcyB0aGV5IHdlcmUgcHJpb3IgdG8gdGhlIHByZXZpb3VzICpWZWxvY2l0eSogY2FsbC4gKi9cblx0XHRcdFx0XHR9IGVsc2UgaWYgKGFjdGlvbiA9PT0gXCJyZXZlcnNlXCIpIHtcblx0XHRcdFx0XHRcdGRhdGEgPSBEYXRhKGVsZW1lbnQpO1xuXG5cdFx0XHRcdFx0XHQvKiBBYm9ydCBpZiB0aGVyZSBpcyBubyBwcmlvciBhbmltYXRpb24gZGF0YSB0byByZXZlcnNlIHRvLiAqL1xuXHRcdFx0XHRcdFx0aWYgKCFkYXRhKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCFkYXRhLnR3ZWVuc0NvbnRhaW5lcikge1xuXHRcdFx0XHRcdFx0XHQvKiBEZXF1ZXVlIHRoZSBlbGVtZW50IHNvIHRoYXQgdGhpcyBxdWV1ZSBlbnRyeSByZWxlYXNlcyBpdHNlbGYgaW1tZWRpYXRlbHksIGFsbG93aW5nIHN1YnNlcXVlbnQgcXVldWUgZW50cmllcyB0byBydW4uICovXG5cdFx0XHRcdFx0XHRcdCQuZGVxdWV1ZShlbGVtZW50LCBvcHRzLnF1ZXVlKTtcblxuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHRcdCBPcHRpb25zIFBhcnNpbmdcblx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHQvKiBJZiB0aGUgZWxlbWVudCB3YXMgaGlkZGVuIHZpYSB0aGUgZGlzcGxheSBvcHRpb24gaW4gdGhlIHByZXZpb3VzIGNhbGwsXG5cdFx0XHRcdFx0XHRcdCByZXZlcnQgZGlzcGxheSB0byBcImF1dG9cIiBwcmlvciB0byByZXZlcnNhbCBzbyB0aGF0IHRoZSBlbGVtZW50IGlzIHZpc2libGUgYWdhaW4uICovXG5cdFx0XHRcdFx0XHRcdGlmIChkYXRhLm9wdHMuZGlzcGxheSA9PT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRcdFx0XHRkYXRhLm9wdHMuZGlzcGxheSA9IFwiYXV0b1wiO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aWYgKGRhdGEub3B0cy52aXNpYmlsaXR5ID09PSBcImhpZGRlblwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YS5vcHRzLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBsb29wIG9wdGlvbiB3YXMgc2V0IGluIHRoZSBwcmV2aW91cyBjYWxsLCBkaXNhYmxlIGl0IHNvIHRoYXQgXCJyZXZlcnNlXCIgY2FsbHMgYXJlbid0IHJlY3Vyc2l2ZWx5IGdlbmVyYXRlZC5cblx0XHRcdFx0XHRcdFx0IEZ1cnRoZXIsIHJlbW92ZSB0aGUgcHJldmlvdXMgY2FsbCdzIGNhbGxiYWNrIG9wdGlvbnM7IHR5cGljYWxseSwgdXNlcnMgZG8gbm90IHdhbnQgdGhlc2UgdG8gYmUgcmVmaXJlZC4gKi9cblx0XHRcdFx0XHRcdFx0ZGF0YS5vcHRzLmxvb3AgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0ZGF0YS5vcHRzLmJlZ2luID0gbnVsbDtcblx0XHRcdFx0XHRcdFx0ZGF0YS5vcHRzLmNvbXBsZXRlID0gbnVsbDtcblxuXHRcdFx0XHRcdFx0XHQvKiBTaW5jZSB3ZSdyZSBleHRlbmRpbmcgYW4gb3B0cyBvYmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIGV4dGVuZGVkIHdpdGggdGhlIGRlZmF1bHRzIG9wdGlvbnMgb2JqZWN0LFxuXHRcdFx0XHRcdFx0XHQgd2UgcmVtb3ZlIG5vbi1leHBsaWNpdGx5LWRlZmluZWQgcHJvcGVydGllcyB0aGF0IGFyZSBhdXRvLWFzc2lnbmVkIHZhbHVlcy4gKi9cblx0XHRcdFx0XHRcdFx0aWYgKCFvcHRpb25zLmVhc2luZykge1xuXHRcdFx0XHRcdFx0XHRcdGRlbGV0ZSBvcHRzLmVhc2luZztcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmICghb3B0aW9ucy5kdXJhdGlvbikge1xuXHRcdFx0XHRcdFx0XHRcdGRlbGV0ZSBvcHRzLmR1cmF0aW9uO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogVGhlIG9wdHMgb2JqZWN0IHVzZWQgZm9yIHJldmVyc2FsIGlzIGFuIGV4dGVuc2lvbiBvZiB0aGUgb3B0aW9ucyBvYmplY3Qgb3B0aW9uYWxseSBwYXNzZWQgaW50byB0aGlzXG5cdFx0XHRcdFx0XHRcdCByZXZlcnNlIGNhbGwgcGx1cyB0aGUgb3B0aW9ucyB1c2VkIGluIHRoZSBwcmV2aW91cyBWZWxvY2l0eSBjYWxsLiAqL1xuXHRcdFx0XHRcdFx0XHRvcHRzID0gJC5leHRlbmQoe30sIGRhdGEub3B0cywgb3B0cyk7XG5cblx0XHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0IFR3ZWVucyBDb250YWluZXIgUmVjb25zdHJ1Y3Rpb25cblx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0LyogQ3JlYXRlIGEgZGVlcHkgY29weSAoaW5kaWNhdGVkIHZpYSB0aGUgdHJ1ZSBmbGFnKSBvZiB0aGUgcHJldmlvdXMgY2FsbCdzIHR3ZWVuc0NvbnRhaW5lci4gKi9cblx0XHRcdFx0XHRcdFx0bGFzdFR3ZWVuc0NvbnRhaW5lciA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkYXRhID8gZGF0YS50d2VlbnNDb250YWluZXIgOiBudWxsKTtcblxuXHRcdFx0XHRcdFx0XHQvKiBNYW5pcHVsYXRlIHRoZSBwcmV2aW91cyB0d2VlbnNDb250YWluZXIgYnkgcmVwbGFjaW5nIGl0cyBlbmQgdmFsdWVzIGFuZCBjdXJyZW50VmFsdWVzIHdpdGggaXRzIHN0YXJ0IHZhbHVlcy4gKi9cblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgbGFzdFR3ZWVuIGluIGxhc3RUd2VlbnNDb250YWluZXIpIHtcblx0XHRcdFx0XHRcdFx0XHQvKiBJbiBhZGRpdGlvbiB0byB0d2VlbiBkYXRhLCB0d2VlbnNDb250YWluZXJzIGNvbnRhaW4gYW4gZWxlbWVudCBwcm9wZXJ0eSB0aGF0IHdlIGlnbm9yZSBoZXJlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmIChsYXN0VHdlZW5zQ29udGFpbmVyLmhhc093blByb3BlcnR5KGxhc3RUd2VlbikgJiYgbGFzdFR3ZWVuICE9PSBcImVsZW1lbnRcIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGxhc3RTdGFydFZhbHVlID0gbGFzdFR3ZWVuc0NvbnRhaW5lcltsYXN0VHdlZW5dLnN0YXJ0VmFsdWU7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGxhc3RUd2VlbnNDb250YWluZXJbbGFzdFR3ZWVuXS5zdGFydFZhbHVlID0gbGFzdFR3ZWVuc0NvbnRhaW5lcltsYXN0VHdlZW5dLmN1cnJlbnRWYWx1ZSA9IGxhc3RUd2VlbnNDb250YWluZXJbbGFzdFR3ZWVuXS5lbmRWYWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdGxhc3RUd2VlbnNDb250YWluZXJbbGFzdFR3ZWVuXS5lbmRWYWx1ZSA9IGxhc3RTdGFydFZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBFYXNpbmcgaXMgdGhlIG9ubHkgb3B0aW9uIHRoYXQgZW1iZWRzIGludG8gdGhlIGluZGl2aWR1YWwgdHdlZW4gZGF0YSAoc2luY2UgaXQgY2FuIGJlIGRlZmluZWQgb24gYSBwZXItcHJvcGVydHkgYmFzaXMpLlxuXHRcdFx0XHRcdFx0XHRcdFx0IEFjY29yZGluZ2x5LCBldmVyeSBwcm9wZXJ0eSdzIGVhc2luZyB2YWx1ZSBtdXN0IGJlIHVwZGF0ZWQgd2hlbiBhbiBvcHRpb25zIG9iamVjdCBpcyBwYXNzZWQgaW4gd2l0aCBhIHJldmVyc2UgY2FsbC5cblx0XHRcdFx0XHRcdFx0XHRcdCBUaGUgc2lkZSBlZmZlY3Qgb2YgdGhpcyBleHRlbnNpYmlsaXR5IGlzIHRoYXQgYWxsIHBlci1wcm9wZXJ0eSBlYXNpbmcgdmFsdWVzIGFyZSBmb3JjZWZ1bGx5IHJlc2V0IHRvIHRoZSBuZXcgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIVR5cGUuaXNFbXB0eU9iamVjdChvcHRpb25zKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRsYXN0VHdlZW5zQ29udGFpbmVyW2xhc3RUd2Vlbl0uZWFzaW5nID0gb3B0cy5lYXNpbmc7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmIChWZWxvY2l0eS5kZWJ1Zykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInJldmVyc2UgdHdlZW5zQ29udGFpbmVyIChcIiArIGxhc3RUd2VlbiArIFwiKTogXCIgKyBKU09OLnN0cmluZ2lmeShsYXN0VHdlZW5zQ29udGFpbmVyW2xhc3RUd2Vlbl0pLCBlbGVtZW50KTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHR0d2VlbnNDb250YWluZXIgPSBsYXN0VHdlZW5zQ29udGFpbmVyO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdCBUd2VlbiBEYXRhIENvbnN0cnVjdGlvbiAoZm9yIFN0YXJ0KVxuXHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0fSBlbHNlIGlmIChhY3Rpb24gPT09IFwic3RhcnRcIikge1xuXG5cdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0IFZhbHVlIFRyYW5zZmVycmluZ1xuXHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdC8qIElmIHRoaXMgcXVldWUgZW50cnkgZm9sbG93cyBhIHByZXZpb3VzIFZlbG9jaXR5LWluaXRpYXRlZCBxdWV1ZSBlbnRyeSAqYW5kKiBpZiB0aGlzIGVudHJ5IHdhcyBjcmVhdGVkXG5cdFx0XHRcdFx0XHQgd2hpbGUgdGhlIGVsZW1lbnQgd2FzIGluIHRoZSBwcm9jZXNzIG9mIGJlaW5nIGFuaW1hdGVkIGJ5IFZlbG9jaXR5LCB0aGVuIHRoaXMgY3VycmVudCBjYWxsIGlzIHNhZmUgdG8gdXNlXG5cdFx0XHRcdFx0XHQgdGhlIGVuZCB2YWx1ZXMgZnJvbSB0aGUgcHJpb3IgY2FsbCBhcyBpdHMgc3RhcnQgdmFsdWVzLiBWZWxvY2l0eSBhdHRlbXB0cyB0byBwZXJmb3JtIHRoaXMgdmFsdWUgdHJhbnNmZXJcblx0XHRcdFx0XHRcdCBwcm9jZXNzIHdoZW5ldmVyIHBvc3NpYmxlIGluIG9yZGVyIHRvIGF2b2lkIHJlcXVlcnlpbmcgdGhlIERPTS4gKi9cblx0XHRcdFx0XHRcdC8qIElmIHZhbHVlcyBhcmVuJ3QgdHJhbnNmZXJyZWQgZnJvbSBhIHByaW9yIGNhbGwgYW5kIHN0YXJ0IHZhbHVlcyB3ZXJlIG5vdCBmb3JjZWZlZCBieSB0aGUgdXNlciAobW9yZSBvbiB0aGlzIGJlbG93KSxcblx0XHRcdFx0XHRcdCB0aGVuIHRoZSBET00gaXMgcXVlcmllZCBmb3IgdGhlIGVsZW1lbnQncyBjdXJyZW50IHZhbHVlcyBhcyBhIGxhc3QgcmVzb3J0LiAqL1xuXHRcdFx0XHRcdFx0LyogTm90ZTogQ29udmVyc2VseSwgYW5pbWF0aW9uIHJldmVyc2FsIChhbmQgbG9vcGluZykgKmFsd2F5cyogcGVyZm9ybSBpbnRlci1jYWxsIHZhbHVlIHRyYW5zZmVyczsgdGhleSBuZXZlciByZXF1ZXJ5IHRoZSBET00uICovXG5cblx0XHRcdFx0XHRcdGRhdGEgPSBEYXRhKGVsZW1lbnQpO1xuXG5cdFx0XHRcdFx0XHQvKiBUaGUgcGVyLWVsZW1lbnQgaXNBbmltYXRpbmcgZmxhZyBpcyB1c2VkIHRvIGluZGljYXRlIHdoZXRoZXIgaXQncyBzYWZlIChpLmUuIHRoZSBkYXRhIGlzbid0IHN0YWxlKVxuXHRcdFx0XHRcdFx0IHRvIHRyYW5zZmVyIG92ZXIgZW5kIHZhbHVlcyB0byB1c2UgYXMgc3RhcnQgdmFsdWVzLiBJZiBpdCdzIHNldCB0byB0cnVlIGFuZCB0aGVyZSBpcyBhIHByZXZpb3VzXG5cdFx0XHRcdFx0XHQgVmVsb2NpdHkgY2FsbCB0byBwdWxsIHZhbHVlcyBmcm9tLCBkbyBzby4gKi9cblx0XHRcdFx0XHRcdGlmIChkYXRhICYmIGRhdGEudHdlZW5zQ29udGFpbmVyICYmIGRhdGEuaXNBbmltYXRpbmcgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdFx0bGFzdFR3ZWVuc0NvbnRhaW5lciA9IGRhdGEudHdlZW5zQ29udGFpbmVyO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHQgVHdlZW4gRGF0YSBDYWxjdWxhdGlvblxuXHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0LyogVGhpcyBmdW5jdGlvbiBwYXJzZXMgcHJvcGVydHkgZGF0YSBhbmQgZGVmYXVsdHMgZW5kVmFsdWUsIGVhc2luZywgYW5kIHN0YXJ0VmFsdWUgYXMgYXBwcm9wcmlhdGUuICovXG5cdFx0XHRcdFx0XHQvKiBQcm9wZXJ0eSBtYXAgdmFsdWVzIGNhbiBlaXRoZXIgdGFrZSB0aGUgZm9ybSBvZiAxKSBhIHNpbmdsZSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIGVuZCB2YWx1ZSxcblx0XHRcdFx0XHRcdCBvciAyKSBhbiBhcnJheSBpbiB0aGUgZm9ybSBvZiBbIGVuZFZhbHVlLCBbLCBlYXNpbmddIFssIHN0YXJ0VmFsdWVdIF0uXG5cdFx0XHRcdFx0XHQgVGhlIG9wdGlvbmFsIHRoaXJkIHBhcmFtZXRlciBpcyBhIGZvcmNlZmVkIHN0YXJ0VmFsdWUgdG8gYmUgdXNlZCBpbnN0ZWFkIG9mIHF1ZXJ5aW5nIHRoZSBET00gZm9yXG5cdFx0XHRcdFx0XHQgdGhlIGVsZW1lbnQncyBjdXJyZW50IHZhbHVlLiBSZWFkIFZlbG9jaXR5J3MgZG9jbWVudGF0aW9uIHRvIGxlYXJuIG1vcmUgYWJvdXQgZm9yY2VmZWVkaW5nOiBWZWxvY2l0eUpTLm9yZy8jZm9yY2VmZWVkaW5nICovXG5cdFx0XHRcdFx0XHR2YXIgcGFyc2VQcm9wZXJ0eVZhbHVlID0gZnVuY3Rpb24odmFsdWVEYXRhLCBza2lwUmVzb2x2aW5nRWFzaW5nKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBlbmRWYWx1ZSwgZWFzaW5nLCBzdGFydFZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdC8qIEhhbmRsZSB0aGUgYXJyYXkgZm9ybWF0LCB3aGljaCBjYW4gYmUgc3RydWN0dXJlZCBhcyBvbmUgb2YgdGhyZWUgcG90ZW50aWFsIG92ZXJsb2Fkczpcblx0XHRcdFx0XHRcdFx0IEEpIFsgZW5kVmFsdWUsIGVhc2luZywgc3RhcnRWYWx1ZSBdLCBCKSBbIGVuZFZhbHVlLCBlYXNpbmcgXSwgb3IgQykgWyBlbmRWYWx1ZSwgc3RhcnRWYWx1ZSBdICovXG5cdFx0XHRcdFx0XHRcdGlmIChUeXBlLmlzQXJyYXkodmFsdWVEYXRhKSkge1xuXHRcdFx0XHRcdFx0XHRcdC8qIGVuZFZhbHVlIGlzIGFsd2F5cyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgYXJyYXkuIERvbid0IGJvdGhlciB2YWxpZGF0aW5nIGVuZFZhbHVlJ3MgdmFsdWUgbm93XG5cdFx0XHRcdFx0XHRcdFx0IHNpbmNlIHRoZSBlbnN1aW5nIHByb3BlcnR5IGN5Y2xpbmcgbG9naWMgZG9lcyB0aGF0LiAqL1xuXHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gdmFsdWVEYXRhWzBdO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyogVHdvLWl0ZW0gYXJyYXkgZm9ybWF0OiBJZiB0aGUgc2Vjb25kIGl0ZW0gaXMgYSBudW1iZXIsIGZ1bmN0aW9uLCBvciBoZXggc3RyaW5nLCB0cmVhdCBpdCBhcyBhXG5cdFx0XHRcdFx0XHRcdFx0IHN0YXJ0IHZhbHVlIHNpbmNlIGVhc2luZ3MgY2FuIG9ubHkgYmUgbm9uLWhleCBzdHJpbmdzIG9yIGFycmF5cy4gKi9cblx0XHRcdFx0XHRcdFx0XHRpZiAoKCFUeXBlLmlzQXJyYXkodmFsdWVEYXRhWzFdKSAmJiAvXltcXGQtXS8udGVzdCh2YWx1ZURhdGFbMV0pKSB8fCBUeXBlLmlzRnVuY3Rpb24odmFsdWVEYXRhWzFdKSB8fCBDU1MuUmVnRXguaXNIZXgudGVzdCh2YWx1ZURhdGFbMV0pKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlID0gdmFsdWVEYXRhWzFdO1xuXHRcdFx0XHRcdFx0XHRcdFx0LyogVHdvIG9yIHRocmVlLWl0ZW0gYXJyYXk6IElmIHRoZSBzZWNvbmQgaXRlbSBpcyBhIG5vbi1oZXggc3RyaW5nIG9yIGFuIGFycmF5LCB0cmVhdCBpdCBhcyBhbiBlYXNpbmcuICovXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICgoVHlwZS5pc1N0cmluZyh2YWx1ZURhdGFbMV0pICYmICFDU1MuUmVnRXguaXNIZXgudGVzdCh2YWx1ZURhdGFbMV0pKSB8fCBUeXBlLmlzQXJyYXkodmFsdWVEYXRhWzFdKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0ZWFzaW5nID0gc2tpcFJlc29sdmluZ0Vhc2luZyA/IHZhbHVlRGF0YVsxXSA6IGdldEVhc2luZyh2YWx1ZURhdGFbMV0sIG9wdHMuZHVyYXRpb24pO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBEb24ndCBib3RoZXIgdmFsaWRhdGluZyBzdGFydFZhbHVlJ3MgdmFsdWUgbm93IHNpbmNlIHRoZSBlbnN1aW5nIHByb3BlcnR5IGN5Y2xpbmcgbG9naWMgaW5oZXJlbnRseSBkb2VzIHRoYXQuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodmFsdWVEYXRhWzJdICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RhcnRWYWx1ZSA9IHZhbHVlRGF0YVsyXTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0LyogSGFuZGxlIHRoZSBzaW5nbGUtdmFsdWUgZm9ybWF0LiAqL1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gdmFsdWVEYXRhO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogRGVmYXVsdCB0byB0aGUgY2FsbCdzIGVhc2luZyBpZiBhIHBlci1wcm9wZXJ0eSBlYXNpbmcgdHlwZSB3YXMgbm90IGRlZmluZWQuICovXG5cdFx0XHRcdFx0XHRcdGlmICghc2tpcFJlc29sdmluZ0Vhc2luZykge1xuXHRcdFx0XHRcdFx0XHRcdGVhc2luZyA9IGVhc2luZyB8fCBvcHRzLmVhc2luZztcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIElmIGZ1bmN0aW9ucyB3ZXJlIHBhc3NlZCBpbiBhcyB2YWx1ZXMsIHBhc3MgdGhlIGZ1bmN0aW9uIHRoZSBjdXJyZW50IGVsZW1lbnQgYXMgaXRzIGNvbnRleHQsXG5cdFx0XHRcdFx0XHRcdCBwbHVzIHRoZSBlbGVtZW50J3MgaW5kZXggYW5kIHRoZSBlbGVtZW50IHNldCdzIHNpemUgYXMgYXJndW1lbnRzLiBUaGVuLCBhc3NpZ24gdGhlIHJldHVybmVkIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoVHlwZS5pc0Z1bmN0aW9uKGVuZFZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gZW5kVmFsdWUuY2FsbChlbGVtZW50LCBlbGVtZW50QXJyYXlJbmRleCwgZWxlbWVudHNMZW5ndGgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aWYgKFR5cGUuaXNGdW5jdGlvbihzdGFydFZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWUgPSBzdGFydFZhbHVlLmNhbGwoZWxlbWVudCwgZWxlbWVudEFycmF5SW5kZXgsIGVsZW1lbnRzTGVuZ3RoKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qIEFsbG93IHN0YXJ0VmFsdWUgdG8gYmUgbGVmdCBhcyB1bmRlZmluZWQgdG8gaW5kaWNhdGUgdG8gdGhlIGVuc3VpbmcgY29kZSB0aGF0IGl0cyB2YWx1ZSB3YXMgbm90IGZvcmNlZmVkLiAqL1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gW2VuZFZhbHVlIHx8IDAsIGVhc2luZywgc3RhcnRWYWx1ZV07XG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHQvKiBDeWNsZSB0aHJvdWdoIGVhY2ggcHJvcGVydHkgaW4gdGhlIG1hcCwgbG9va2luZyBmb3Igc2hvcnRoYW5kIGNvbG9yIHByb3BlcnRpZXMgKGUuZy4gXCJjb2xvclwiIGFzIG9wcG9zZWQgdG8gXCJjb2xvclJlZFwiKS4gSW5qZWN0IHRoZSBjb3JyZXNwb25kaW5nXG5cdFx0XHRcdFx0XHQgY29sb3JSZWQsIGNvbG9yR3JlZW4sIGFuZCBjb2xvckJsdWUgUkdCIGNvbXBvbmVudCB0d2VlbnMgaW50byB0aGUgcHJvcGVydGllc01hcCAod2hpY2ggVmVsb2NpdHkgdW5kZXJzdGFuZHMpIGFuZCByZW1vdmUgdGhlIHNob3J0aGFuZCBwcm9wZXJ0eS4gKi9cblx0XHRcdFx0XHRcdCQuZWFjaChwcm9wZXJ0aWVzTWFwLCBmdW5jdGlvbihwcm9wZXJ0eSwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0LyogRmluZCBzaG9ydGhhbmQgY29sb3IgcHJvcGVydGllcyB0aGF0IGhhdmUgYmVlbiBwYXNzZWQgYSBoZXggc3RyaW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoUmVnRXhwKFwiXlwiICsgQ1NTLkxpc3RzLmNvbG9ycy5qb2luKFwiJHxeXCIpICsgXCIkXCIpLnRlc3QoQ1NTLk5hbWVzLmNhbWVsQ2FzZShwcm9wZXJ0eSkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogUGFyc2UgdGhlIHZhbHVlIGRhdGEgZm9yIGVhY2ggc2hvcnRoYW5kLiAqL1xuXHRcdFx0XHRcdFx0XHRcdHZhciB2YWx1ZURhdGEgPSBwYXJzZVByb3BlcnR5VmFsdWUodmFsdWUsIHRydWUpLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZSA9IHZhbHVlRGF0YVswXSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZWFzaW5nID0gdmFsdWVEYXRhWzFdLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlID0gdmFsdWVEYXRhWzJdO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKENTUy5SZWdFeC5pc0hleC50ZXN0KGVuZFZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0LyogQ29udmVydCB0aGUgaGV4IHN0cmluZ3MgaW50byB0aGVpciBSR0IgY29tcG9uZW50IGFycmF5cy4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdHZhciBjb2xvckNvbXBvbmVudHMgPSBbXCJSZWRcIiwgXCJHcmVlblwiLCBcIkJsdWVcIl0sXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZW5kVmFsdWVSR0IgPSBDU1MuVmFsdWVzLmhleFRvUmdiKGVuZFZhbHVlKSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlUkdCID0gc3RhcnRWYWx1ZSA/IENTUy5WYWx1ZXMuaGV4VG9SZ2Ioc3RhcnRWYWx1ZSkgOiB1bmRlZmluZWQ7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIEluamVjdCB0aGUgUkdCIGNvbXBvbmVudCB0d2VlbnMgaW50byBwcm9wZXJ0aWVzTWFwLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjb2xvckNvbXBvbmVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRhdGFBcnJheSA9IFtlbmRWYWx1ZVJHQltpXV07XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVhc2luZykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRhdGFBcnJheS5wdXNoKGVhc2luZyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoc3RhcnRWYWx1ZVJHQiAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGF0YUFycmF5LnB1c2goc3RhcnRWYWx1ZVJHQltpXSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9wZXJ0aWVzTWFwW0NTUy5OYW1lcy5jYW1lbENhc2UocHJvcGVydHkpICsgY29sb3JDb21wb25lbnRzW2ldXSA9IGRhdGFBcnJheTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0LyogUmVtb3ZlIHRoZSBpbnRlcm1lZGlhcnkgc2hvcnRoYW5kIHByb3BlcnR5IGVudHJ5IG5vdyB0aGF0IHdlJ3ZlIHByb2Nlc3NlZCBpdC4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdGRlbGV0ZSBwcm9wZXJ0aWVzTWFwW3Byb3BlcnR5XTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHQvKiBDcmVhdGUgYSB0d2VlbiBvdXQgb2YgZWFjaCBwcm9wZXJ0eSwgYW5kIGFwcGVuZCBpdHMgYXNzb2NpYXRlZCBkYXRhIHRvIHR3ZWVuc0NvbnRhaW5lci4gKi9cblx0XHRcdFx0XHRcdGZvciAodmFyIHByb3BlcnR5IGluIHByb3BlcnRpZXNNYXApIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAoIXByb3BlcnRpZXNNYXAuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHRcdCBTdGFydCBWYWx1ZSBTb3VyY2luZ1xuXHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0LyogUGFyc2Ugb3V0IGVuZFZhbHVlLCBlYXNpbmcsIGFuZCBzdGFydFZhbHVlIGZyb20gdGhlIHByb3BlcnR5J3MgZGF0YS4gKi9cblx0XHRcdFx0XHRcdFx0dmFyIHZhbHVlRGF0YSA9IHBhcnNlUHJvcGVydHlWYWx1ZShwcm9wZXJ0aWVzTWFwW3Byb3BlcnR5XSksXG5cdFx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZSA9IHZhbHVlRGF0YVswXSxcblx0XHRcdFx0XHRcdFx0XHRcdGVhc2luZyA9IHZhbHVlRGF0YVsxXSxcblx0XHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWUgPSB2YWx1ZURhdGFbMl07XG5cblx0XHRcdFx0XHRcdFx0LyogTm93IHRoYXQgdGhlIG9yaWdpbmFsIHByb3BlcnR5IG5hbWUncyBmb3JtYXQgaGFzIGJlZW4gdXNlZCBmb3IgdGhlIHBhcnNlUHJvcGVydHlWYWx1ZSgpIGxvb2t1cCBhYm92ZSxcblx0XHRcdFx0XHRcdFx0IHdlIGZvcmNlIHRoZSBwcm9wZXJ0eSB0byBpdHMgY2FtZWxDYXNlIHN0eWxpbmcgdG8gbm9ybWFsaXplIGl0IGZvciBtYW5pcHVsYXRpb24uICovXG5cdFx0XHRcdFx0XHRcdHByb3BlcnR5ID0gQ1NTLk5hbWVzLmNhbWVsQ2FzZShwcm9wZXJ0eSk7XG5cblx0XHRcdFx0XHRcdFx0LyogSW4gY2FzZSB0aGlzIHByb3BlcnR5IGlzIGEgaG9vaywgdGhlcmUgYXJlIGNpcmN1bXN0YW5jZXMgd2hlcmUgd2Ugd2lsbCBpbnRlbmQgdG8gd29yayBvbiB0aGUgaG9vaydzIHJvb3QgcHJvcGVydHkgYW5kIG5vdCB0aGUgaG9va2VkIHN1YnByb3BlcnR5LiAqL1xuXHRcdFx0XHRcdFx0XHR2YXIgcm9vdFByb3BlcnR5ID0gQ1NTLkhvb2tzLmdldFJvb3QocHJvcGVydHkpLFxuXHRcdFx0XHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWUgPSBmYWxzZTtcblxuXHRcdFx0XHRcdFx0XHQvKiBPdGhlciB0aGFuIGZvciB0aGUgZHVtbXkgdHdlZW4gcHJvcGVydHksIHByb3BlcnRpZXMgdGhhdCBhcmUgbm90IHN1cHBvcnRlZCBieSB0aGUgYnJvd3NlciAoYW5kIGRvIG5vdCBoYXZlIGFuIGFzc29jaWF0ZWQgbm9ybWFsaXphdGlvbikgd2lsbFxuXHRcdFx0XHRcdFx0XHQgaW5oZXJlbnRseSBwcm9kdWNlIG5vIHN0eWxlIGNoYW5nZXMgd2hlbiBzZXQsIHNvIHRoZXkgYXJlIHNraXBwZWQgaW4gb3JkZXIgdG8gZGVjcmVhc2UgYW5pbWF0aW9uIHRpY2sgb3ZlcmhlYWQuXG5cdFx0XHRcdFx0XHRcdCBQcm9wZXJ0eSBzdXBwb3J0IGlzIGRldGVybWluZWQgdmlhIHByZWZpeENoZWNrKCksIHdoaWNoIHJldHVybnMgYSBmYWxzZSBmbGFnIHdoZW4gbm8gc3VwcG9ydGVkIGlzIGRldGVjdGVkLiAqL1xuXHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBTaW5jZSBTVkcgZWxlbWVudHMgaGF2ZSBzb21lIG9mIHRoZWlyIHByb3BlcnRpZXMgZGlyZWN0bHkgYXBwbGllZCBhcyBIVE1MIGF0dHJpYnV0ZXMsXG5cdFx0XHRcdFx0XHRcdCB0aGVyZSBpcyBubyB3YXkgdG8gY2hlY2sgZm9yIHRoZWlyIGV4cGxpY2l0IGJyb3dzZXIgc3VwcG9ydCwgYW5kIHNvIHdlIHNraXAgc2tpcCB0aGlzIGNoZWNrIGZvciB0aGVtLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoKCFkYXRhIHx8ICFkYXRhLmlzU1ZHKSAmJiByb290UHJvcGVydHkgIT09IFwidHdlZW5cIiAmJiBDU1MuTmFtZXMucHJlZml4Q2hlY2socm9vdFByb3BlcnR5KVsxXSA9PT0gZmFsc2UgJiYgQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbcm9vdFByb3BlcnR5XSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKFZlbG9jaXR5LmRlYnVnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIlNraXBwaW5nIFtcIiArIHJvb3RQcm9wZXJ0eSArIFwiXSBkdWUgdG8gYSBsYWNrIG9mIGJyb3dzZXIgc3VwcG9ydC5cIik7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogSWYgdGhlIGRpc3BsYXkgb3B0aW9uIGlzIGJlaW5nIHNldCB0byBhIG5vbi1cIm5vbmVcIiAoZS5nLiBcImJsb2NrXCIpIGFuZCBvcGFjaXR5IChmaWx0ZXIgb24gSUU8PTgpIGlzIGJlaW5nXG5cdFx0XHRcdFx0XHRcdCBhbmltYXRlZCB0byBhbiBlbmRWYWx1ZSBvZiBub24temVybywgdGhlIHVzZXIncyBpbnRlbnRpb24gaXMgdG8gZmFkZSBpbiBmcm9tIGludmlzaWJsZSwgdGh1cyB3ZSBmb3JjZWZlZWQgb3BhY2l0eVxuXHRcdFx0XHRcdFx0XHQgYSBzdGFydFZhbHVlIG9mIDAgaWYgaXRzIHN0YXJ0VmFsdWUgaGFzbid0IGFscmVhZHkgYmVlbiBzb3VyY2VkIGJ5IHZhbHVlIHRyYW5zZmVycmluZyBvciBwcmlvciBmb3JjZWZlZWRpbmcuICovXG5cdFx0XHRcdFx0XHRcdGlmICgoKG9wdHMuZGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIG9wdHMuZGlzcGxheSAhPT0gbnVsbCAmJiBvcHRzLmRpc3BsYXkgIT09IFwibm9uZVwiKSB8fCAob3B0cy52aXNpYmlsaXR5ICE9PSB1bmRlZmluZWQgJiYgb3B0cy52aXNpYmlsaXR5ICE9PSBcImhpZGRlblwiKSkgJiYgL29wYWNpdHl8ZmlsdGVyLy50ZXN0KHByb3BlcnR5KSAmJiAhc3RhcnRWYWx1ZSAmJiBlbmRWYWx1ZSAhPT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWUgPSAwO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogSWYgdmFsdWVzIGhhdmUgYmVlbiB0cmFuc2ZlcnJlZCBmcm9tIHRoZSBwcmV2aW91cyBWZWxvY2l0eSBjYWxsLCBleHRyYWN0IHRoZSBlbmRWYWx1ZSBhbmQgcm9vdFByb3BlcnR5VmFsdWVcblx0XHRcdFx0XHRcdFx0IGZvciBhbGwgb2YgdGhlIGN1cnJlbnQgY2FsbCdzIHByb3BlcnRpZXMgdGhhdCB3ZXJlICphbHNvKiBhbmltYXRlZCBpbiB0aGUgcHJldmlvdXMgY2FsbC4gKi9cblx0XHRcdFx0XHRcdFx0LyogTm90ZTogVmFsdWUgdHJhbnNmZXJyaW5nIGNhbiBvcHRpb25hbGx5IGJlIGRpc2FibGVkIGJ5IHRoZSB1c2VyIHZpYSB0aGUgX2NhY2hlVmFsdWVzIG9wdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0aWYgKG9wdHMuX2NhY2hlVmFsdWVzICYmIGxhc3RUd2VlbnNDb250YWluZXIgJiYgbGFzdFR3ZWVuc0NvbnRhaW5lcltwcm9wZXJ0eV0pIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoc3RhcnRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlID0gbGFzdFR3ZWVuc0NvbnRhaW5lcltwcm9wZXJ0eV0uZW5kVmFsdWUgKyBsYXN0VHdlZW5zQ29udGFpbmVyW3Byb3BlcnR5XS51bml0VHlwZTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHQvKiBUaGUgcHJldmlvdXMgY2FsbCdzIHJvb3RQcm9wZXJ0eVZhbHVlIGlzIGV4dHJhY3RlZCBmcm9tIHRoZSBlbGVtZW50J3MgZGF0YSBjYWNoZSBzaW5jZSB0aGF0J3MgdGhlXG5cdFx0XHRcdFx0XHRcdFx0IGluc3RhbmNlIG9mIHJvb3RQcm9wZXJ0eVZhbHVlIHRoYXQgZ2V0cyBmcmVzaGx5IHVwZGF0ZWQgYnkgdGhlIHR3ZWVuaW5nIHByb2Nlc3MsIHdoZXJlYXMgdGhlIHJvb3RQcm9wZXJ0eVZhbHVlXG5cdFx0XHRcdFx0XHRcdFx0IGF0dGFjaGVkIHRvIHRoZSBpbmNvbWluZyBsYXN0VHdlZW5zQ29udGFpbmVyIGlzIGVxdWFsIHRvIHRoZSByb290IHByb3BlcnR5J3MgdmFsdWUgcHJpb3IgdG8gYW55IHR3ZWVuaW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlID0gZGF0YS5yb290UHJvcGVydHlWYWx1ZUNhY2hlW3Jvb3RQcm9wZXJ0eV07XG5cdFx0XHRcdFx0XHRcdFx0LyogSWYgdmFsdWVzIHdlcmUgbm90IHRyYW5zZmVycmVkIGZyb20gYSBwcmV2aW91cyBWZWxvY2l0eSBjYWxsLCBxdWVyeSB0aGUgRE9NIGFzIG5lZWRlZC4gKi9cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHQvKiBIYW5kbGUgaG9va2VkIHByb3BlcnRpZXMuICovXG5cdFx0XHRcdFx0XHRcdFx0aWYgKENTUy5Ib29rcy5yZWdpc3RlcmVkW3Byb3BlcnR5XSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHN0YXJ0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyb290UHJvcGVydHlWYWx1ZSA9IENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIHJvb3RQcm9wZXJ0eSk7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBUaGUgZm9sbG93aW5nIGdldFByb3BlcnR5VmFsdWUoKSBjYWxsIGRvZXMgbm90IGFjdHVhbGx5IHRyaWdnZXIgYSBET00gcXVlcnk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCBnZXRQcm9wZXJ0eVZhbHVlKCkgd2lsbCBleHRyYWN0IHRoZSBob29rIGZyb20gcm9vdFByb3BlcnR5VmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWUgPSBDU1MuZ2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBwcm9wZXJ0eSwgcm9vdFByb3BlcnR5VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBJZiBzdGFydFZhbHVlIGlzIGFscmVhZHkgZGVmaW5lZCB2aWEgZm9yY2VmZWVkaW5nLCBkbyBub3QgcXVlcnkgdGhlIERPTSBmb3IgdGhlIHJvb3QgcHJvcGVydHkncyB2YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0IGp1c3QgZ3JhYiByb290UHJvcGVydHkncyB6ZXJvLXZhbHVlIHRlbXBsYXRlIGZyb20gQ1NTLkhvb2tzLiBUaGlzIG92ZXJ3cml0ZXMgdGhlIGVsZW1lbnQncyBhY3R1YWxcblx0XHRcdFx0XHRcdFx0XHRcdFx0IHJvb3QgcHJvcGVydHkgdmFsdWUgKGlmIG9uZSBpcyBzZXQpLCBidXQgdGhpcyBpcyBhY2NlcHRhYmxlIHNpbmNlIHRoZSBwcmltYXJ5IHJlYXNvbiB1c2VycyBmb3JjZWZlZWQgaXNcblx0XHRcdFx0XHRcdFx0XHRcdFx0IHRvIGF2b2lkIERPTSBxdWVyaWVzLCBhbmQgdGh1cyB3ZSBsaWtld2lzZSBhdm9pZCBxdWVyeWluZyB0aGUgRE9NIGZvciB0aGUgcm9vdCBwcm9wZXJ0eSdzIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogR3JhYiB0aGlzIGhvb2sncyB6ZXJvLXZhbHVlIHRlbXBsYXRlLCBlLmcuIFwiMHB4IDBweCAwcHggYmxhY2tcIi4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0cm9vdFByb3BlcnR5VmFsdWUgPSBDU1MuSG9va3MudGVtcGxhdGVzW3Jvb3RQcm9wZXJ0eV1bMV07XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBIYW5kbGUgbm9uLWhvb2tlZCBwcm9wZXJ0aWVzIHRoYXQgaGF2ZW4ndCBhbHJlYWR5IGJlZW4gZGVmaW5lZCB2aWEgZm9yY2VmZWVkaW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoc3RhcnRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlID0gQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgcHJvcGVydHkpOyAvKiBHRVQgKi9cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0IFZhbHVlIERhdGEgRXh0cmFjdGlvblxuXHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0dmFyIHNlcGFyYXRlZFZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0ZW5kVmFsdWVVbml0VHlwZSxcblx0XHRcdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWVVbml0VHlwZSxcblx0XHRcdFx0XHRcdFx0XHRcdG9wZXJhdG9yID0gZmFsc2U7XG5cblx0XHRcdFx0XHRcdFx0LyogU2VwYXJhdGVzIGEgcHJvcGVydHkgdmFsdWUgaW50byBpdHMgbnVtZXJpYyB2YWx1ZSBhbmQgaXRzIHVuaXQgdHlwZS4gKi9cblx0XHRcdFx0XHRcdFx0dmFyIHNlcGFyYXRlVmFsdWUgPSBmdW5jdGlvbihwcm9wZXJ0eSwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgdW5pdFR5cGUsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdG51bWVyaWNWYWx1ZTtcblxuXHRcdFx0XHRcdFx0XHRcdG51bWVyaWNWYWx1ZSA9ICh2YWx1ZSB8fCBcIjBcIilcblx0XHRcdFx0XHRcdFx0XHRcdFx0LnRvU3RyaW5nKClcblx0XHRcdFx0XHRcdFx0XHRcdFx0LnRvTG93ZXJDYXNlKClcblx0XHRcdFx0XHRcdFx0XHRcdFx0LyogTWF0Y2ggdGhlIHVuaXQgdHlwZSBhdCB0aGUgZW5kIG9mIHRoZSB2YWx1ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0LnJlcGxhY2UoL1slQS16XSskLywgZnVuY3Rpb24obWF0Y2gpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBHcmFiIHRoZSB1bml0IHR5cGUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dW5pdFR5cGUgPSBtYXRjaDtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIFN0cmlwIHRoZSB1bml0IHR5cGUgb2ZmIG9mIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBcIlwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdC8qIElmIG5vIHVuaXQgdHlwZSB3YXMgc3VwcGxpZWQsIGFzc2lnbiBvbmUgdGhhdCBpcyBhcHByb3ByaWF0ZSBmb3IgdGhpcyBwcm9wZXJ0eSAoZS5nLiBcImRlZ1wiIGZvciByb3RhdGVaIG9yIFwicHhcIiBmb3Igd2lkdGgpLiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmICghdW5pdFR5cGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHVuaXRUeXBlID0gQ1NTLlZhbHVlcy5nZXRVbml0VHlwZShwcm9wZXJ0eSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIFtudW1lcmljVmFsdWUsIHVuaXRUeXBlXTtcblx0XHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0XHQvKiBTZXBhcmF0ZSBzdGFydFZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRzZXBhcmF0ZWRWYWx1ZSA9IHNlcGFyYXRlVmFsdWUocHJvcGVydHksIHN0YXJ0VmFsdWUpO1xuXHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlID0gc2VwYXJhdGVkVmFsdWVbMF07XG5cdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWVVbml0VHlwZSA9IHNlcGFyYXRlZFZhbHVlWzFdO1xuXG5cdFx0XHRcdFx0XHRcdC8qIFNlcGFyYXRlIGVuZFZhbHVlLCBhbmQgZXh0cmFjdCBhIHZhbHVlIG9wZXJhdG9yIChlLmcuIFwiKz1cIiwgXCItPVwiKSBpZiBvbmUgZXhpc3RzLiAqL1xuXHRcdFx0XHRcdFx0XHRzZXBhcmF0ZWRWYWx1ZSA9IHNlcGFyYXRlVmFsdWUocHJvcGVydHksIGVuZFZhbHVlKTtcblx0XHRcdFx0XHRcdFx0ZW5kVmFsdWUgPSBzZXBhcmF0ZWRWYWx1ZVswXS5yZXBsYWNlKC9eKFsrLVxcLypdKT0vLCBmdW5jdGlvbihtYXRjaCwgc3ViTWF0Y2gpIHtcblx0XHRcdFx0XHRcdFx0XHRvcGVyYXRvciA9IHN1Yk1hdGNoO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyogU3RyaXAgdGhlIG9wZXJhdG9yIG9mZiBvZiB0aGUgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRlbmRWYWx1ZVVuaXRUeXBlID0gc2VwYXJhdGVkVmFsdWVbMV07XG5cblx0XHRcdFx0XHRcdFx0LyogUGFyc2UgZmxvYXQgdmFsdWVzIGZyb20gZW5kVmFsdWUgYW5kIHN0YXJ0VmFsdWUuIERlZmF1bHQgdG8gMCBpZiBOYU4gaXMgcmV0dXJuZWQuICovXG5cdFx0XHRcdFx0XHRcdHN0YXJ0VmFsdWUgPSBwYXJzZUZsb2F0KHN0YXJ0VmFsdWUpIHx8IDA7XG5cdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gcGFyc2VGbG9hdChlbmRWYWx1ZSkgfHwgMDtcblxuXHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHRcdCBQcm9wZXJ0eS1TcGVjaWZpYyBWYWx1ZSBDb252ZXJzaW9uXG5cdFx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0LyogQ3VzdG9tIHN1cHBvcnQgZm9yIHByb3BlcnRpZXMgdGhhdCBkb24ndCBhY3R1YWxseSBhY2NlcHQgdGhlICUgdW5pdCB0eXBlLCBidXQgd2hlcmUgcG9sbHlmaWxsaW5nIGlzIHRyaXZpYWwgYW5kIHJlbGF0aXZlbHkgZm9vbHByb29mLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoZW5kVmFsdWVVbml0VHlwZSA9PT0gXCIlXCIpIHtcblx0XHRcdFx0XHRcdFx0XHQvKiBBICUtdmFsdWUgZm9udFNpemUvbGluZUhlaWdodCBpcyByZWxhdGl2ZSB0byB0aGUgcGFyZW50J3MgZm9udFNpemUgKGFzIG9wcG9zZWQgdG8gdGhlIHBhcmVudCdzIGRpbWVuc2lvbnMpLFxuXHRcdFx0XHRcdFx0XHRcdCB3aGljaCBpcyBpZGVudGljYWwgdG8gdGhlIGVtIHVuaXQncyBiZWhhdmlvciwgc28gd2UgcGlnZ3liYWNrIG9mZiBvZiB0aGF0LiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmICgvXihmb250U2l6ZXxsaW5lSGVpZ2h0KSQvLnRlc3QocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBDb252ZXJ0ICUgaW50byBhbiBlbSBkZWNpbWFsIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0ZW5kVmFsdWUgPSBlbmRWYWx1ZSAvIDEwMDtcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlVW5pdFR5cGUgPSBcImVtXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBGb3Igc2NhbGVYIGFuZCBzY2FsZVksIGNvbnZlcnQgdGhlIHZhbHVlIGludG8gaXRzIGRlY2ltYWwgZm9ybWF0IGFuZCBzdHJpcCBvZmYgdGhlIHVuaXQgdHlwZS4gKi9cblx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKC9ec2NhbGUvLnRlc3QocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZSA9IGVuZFZhbHVlIC8gMTAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0ZW5kVmFsdWVVbml0VHlwZSA9IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBGb3IgUkdCIGNvbXBvbmVudHMsIHRha2UgdGhlIGRlZmluZWQgcGVyY2VudGFnZSBvZiAyNTUgYW5kIHN0cmlwIG9mZiB0aGUgdW5pdCB0eXBlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoLyhSZWR8R3JlZW58Qmx1ZSkkL2kudGVzdChwcm9wZXJ0eSkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gKGVuZFZhbHVlIC8gMTAwKSAqIDI1NTtcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlVW5pdFR5cGUgPSBcIlwiO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0IFVuaXQgUmF0aW8gQ2FsY3VsYXRpb25cblx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHQvKiBXaGVuIHF1ZXJpZWQsIHRoZSBicm93c2VyIHJldHVybnMgKG1vc3QpIENTUyBwcm9wZXJ0eSB2YWx1ZXMgaW4gcGl4ZWxzLiBUaGVyZWZvcmUsIGlmIGFuIGVuZFZhbHVlIHdpdGggYSB1bml0IHR5cGUgb2Zcblx0XHRcdFx0XHRcdFx0ICUsIGVtLCBvciByZW0gaXMgYW5pbWF0ZWQgdG93YXJkLCBzdGFydFZhbHVlIG11c3QgYmUgY29udmVydGVkIGZyb20gcGl4ZWxzIGludG8gdGhlIHNhbWUgdW5pdCB0eXBlIGFzIGVuZFZhbHVlIGluIG9yZGVyXG5cdFx0XHRcdFx0XHRcdCBmb3IgdmFsdWUgbWFuaXB1bGF0aW9uIGxvZ2ljIChpbmNyZW1lbnQvZGVjcmVtZW50KSB0byBwcm9jZWVkLiBGdXJ0aGVyLCBpZiB0aGUgc3RhcnRWYWx1ZSB3YXMgZm9yY2VmZWQgb3IgdHJhbnNmZXJyZWRcblx0XHRcdFx0XHRcdFx0IGZyb20gYSBwcmV2aW91cyBjYWxsLCBzdGFydFZhbHVlIG1heSBhbHNvIG5vdCBiZSBpbiBwaXhlbHMuIFVuaXQgY29udmVyc2lvbiBsb2dpYyB0aGVyZWZvcmUgY29uc2lzdHMgb2YgdHdvIHN0ZXBzOlxuXHRcdFx0XHRcdFx0XHQgMSkgQ2FsY3VsYXRpbmcgdGhlIHJhdGlvIG9mICUvZW0vcmVtL3ZoL3Z3IHJlbGF0aXZlIHRvIHBpeGVsc1xuXHRcdFx0XHRcdFx0XHQgMikgQ29udmVydGluZyBzdGFydFZhbHVlIGludG8gdGhlIHNhbWUgdW5pdCBvZiBtZWFzdXJlbWVudCBhcyBlbmRWYWx1ZSBiYXNlZCBvbiB0aGVzZSByYXRpb3MuICovXG5cdFx0XHRcdFx0XHRcdC8qIFVuaXQgY29udmVyc2lvbiByYXRpb3MgYXJlIGNhbGN1bGF0ZWQgYnkgaW5zZXJ0aW5nIGEgc2libGluZyBub2RlIG5leHQgdG8gdGhlIHRhcmdldCBub2RlLCBjb3B5aW5nIG92ZXIgaXRzIHBvc2l0aW9uIHByb3BlcnR5LFxuXHRcdFx0XHRcdFx0XHQgc2V0dGluZyB2YWx1ZXMgd2l0aCB0aGUgdGFyZ2V0IHVuaXQgdHlwZSB0aGVuIGNvbXBhcmluZyB0aGUgcmV0dXJuZWQgcGl4ZWwgdmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdC8qIE5vdGU6IEV2ZW4gaWYgb25seSBvbmUgb2YgdGhlc2UgdW5pdCB0eXBlcyBpcyBiZWluZyBhbmltYXRlZCwgYWxsIHVuaXQgcmF0aW9zIGFyZSBjYWxjdWxhdGVkIGF0IG9uY2Ugc2luY2UgdGhlIG92ZXJoZWFkXG5cdFx0XHRcdFx0XHRcdCBvZiBiYXRjaGluZyB0aGUgU0VUcyBhbmQgR0VUcyB0b2dldGhlciB1cGZyb250IG91dHdlaWdodHMgdGhlIHBvdGVudGlhbCBvdmVyaGVhZFxuXHRcdFx0XHRcdFx0XHQgb2YgbGF5b3V0IHRocmFzaGluZyBjYXVzZWQgYnkgcmUtcXVlcnlpbmcgZm9yIHVuY2FsY3VsYXRlZCByYXRpb3MgZm9yIHN1YnNlcXVlbnRseS1wcm9jZXNzZWQgcHJvcGVydGllcy4gKi9cblx0XHRcdFx0XHRcdFx0LyogVG9kbzogU2hpZnQgdGhpcyBsb2dpYyBpbnRvIHRoZSBjYWxscycgZmlyc3QgdGljayBpbnN0YW5jZSBzbyB0aGF0IGl0J3Mgc3luY2VkIHdpdGggUkFGLiAqL1xuXHRcdFx0XHRcdFx0XHR2YXIgY2FsY3VsYXRlVW5pdFJhdGlvcyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0XHRcdCBTYW1lIFJhdGlvIENoZWNrc1xuXHRcdFx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0XHQvKiBUaGUgcHJvcGVydGllcyBiZWxvdyBhcmUgdXNlZCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgZWxlbWVudCBkaWZmZXJzIHN1ZmZpY2llbnRseSBmcm9tIHRoaXMgY2FsbCdzXG5cdFx0XHRcdFx0XHRcdFx0IHByZXZpb3VzbHkgaXRlcmF0ZWQgZWxlbWVudCB0byBhbHNvIGRpZmZlciBpbiBpdHMgdW5pdCBjb252ZXJzaW9uIHJhdGlvcy4gSWYgdGhlIHByb3BlcnRpZXMgbWF0Y2ggdXAgd2l0aCB0aG9zZVxuXHRcdFx0XHRcdFx0XHRcdCBvZiB0aGUgcHJpb3IgZWxlbWVudCwgdGhlIHByaW9yIGVsZW1lbnQncyBjb252ZXJzaW9uIHJhdGlvcyBhcmUgdXNlZC4gTGlrZSBtb3N0IG9wdGltaXphdGlvbnMgaW4gVmVsb2NpdHksXG5cdFx0XHRcdFx0XHRcdFx0IHRoaXMgaXMgZG9uZSB0byBtaW5pbWl6ZSBET00gcXVlcnlpbmcuICovXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHNhbWVSYXRpb0luZGljYXRvcnMgPSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRteVBhcmVudDogZWxlbWVudC5wYXJlbnROb2RlIHx8IGRvY3VtZW50LmJvZHksIC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb246IENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwicG9zaXRpb25cIiksIC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0Zm9udFNpemU6IENTUy5nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIFwiZm9udFNpemVcIikgLyogR0VUICovXG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHQvKiBEZXRlcm1pbmUgaWYgdGhlIHNhbWUgJSByYXRpbyBjYW4gYmUgdXNlZC4gJSBpcyBiYXNlZCBvbiB0aGUgZWxlbWVudCdzIHBvc2l0aW9uIHZhbHVlIGFuZCBpdHMgcGFyZW50J3Mgd2lkdGggYW5kIGhlaWdodCBkaW1lbnNpb25zLiAqL1xuXHRcdFx0XHRcdFx0XHRcdHNhbWVQZXJjZW50UmF0aW8gPSAoKHNhbWVSYXRpb0luZGljYXRvcnMucG9zaXRpb24gPT09IGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdFBvc2l0aW9uKSAmJiAoc2FtZVJhdGlvSW5kaWNhdG9ycy5teVBhcmVudCA9PT0gY2FsbFVuaXRDb252ZXJzaW9uRGF0YS5sYXN0UGFyZW50KSksXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC8qIERldGVybWluZSBpZiB0aGUgc2FtZSBlbSByYXRpbyBjYW4gYmUgdXNlZC4gZW0gaXMgcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQncyBmb250U2l6ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0c2FtZUVtUmF0aW8gPSAoc2FtZVJhdGlvSW5kaWNhdG9ycy5mb250U2l6ZSA9PT0gY2FsbFVuaXRDb252ZXJzaW9uRGF0YS5sYXN0Rm9udFNpemUpO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyogU3RvcmUgdGhlc2UgcmF0aW8gaW5kaWNhdG9ycyBjYWxsLXdpZGUgZm9yIHRoZSBuZXh0IGVsZW1lbnQgdG8gY29tcGFyZSBhZ2FpbnN0LiAqL1xuXHRcdFx0XHRcdFx0XHRcdGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdFBhcmVudCA9IHNhbWVSYXRpb0luZGljYXRvcnMubXlQYXJlbnQ7XG5cdFx0XHRcdFx0XHRcdFx0Y2FsbFVuaXRDb252ZXJzaW9uRGF0YS5sYXN0UG9zaXRpb24gPSBzYW1lUmF0aW9JbmRpY2F0b3JzLnBvc2l0aW9uO1xuXHRcdFx0XHRcdFx0XHRcdGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdEZvbnRTaXplID0gc2FtZVJhdGlvSW5kaWNhdG9ycy5mb250U2l6ZTtcblxuXHRcdFx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0XHQgRWxlbWVudC1TcGVjaWZpYyBVbml0c1xuXHRcdFx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBJRTggcm91bmRzIHRvIHRoZSBuZWFyZXN0IHBpeGVsIHdoZW4gcmV0dXJuaW5nIENTUyB2YWx1ZXMsIHRodXMgd2UgcGVyZm9ybSBjb252ZXJzaW9ucyB1c2luZyBhIG1lYXN1cmVtZW50XG5cdFx0XHRcdFx0XHRcdFx0IG9mIDEwMCAoaW5zdGVhZCBvZiAxKSB0byBnaXZlIG91ciByYXRpb3MgYSBwcmVjaXNpb24gb2YgYXQgbGVhc3QgMiBkZWNpbWFsIHZhbHVlcy4gKi9cblx0XHRcdFx0XHRcdFx0XHR2YXIgbWVhc3VyZW1lbnQgPSAxMDAsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHVuaXRSYXRpb3MgPSB7fTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmICghc2FtZUVtUmF0aW8gfHwgIXNhbWVQZXJjZW50UmF0aW8pIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBkdW1teSA9IGRhdGEgJiYgZGF0YS5pc1NWRyA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwicmVjdFwiKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFZlbG9jaXR5LmluaXQoZHVtbXkpO1xuXHRcdFx0XHRcdFx0XHRcdFx0c2FtZVJhdGlvSW5kaWNhdG9ycy5teVBhcmVudC5hcHBlbmRDaGlsZChkdW1teSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIFRvIGFjY3VyYXRlbHkgYW5kIGNvbnNpc3RlbnRseSBjYWxjdWxhdGUgY29udmVyc2lvbiByYXRpb3MsIHRoZSBlbGVtZW50J3MgY2FzY2FkZWQgb3ZlcmZsb3cgYW5kIGJveC1zaXppbmcgYXJlIHN0cmlwcGVkLlxuXHRcdFx0XHRcdFx0XHRcdFx0IFNpbWlsYXJseSwgc2luY2Ugd2lkdGgvaGVpZ2h0IGNhbiBiZSBhcnRpZmljaWFsbHkgY29uc3RyYWluZWQgYnkgdGhlaXIgbWluLS9tYXgtIGVxdWl2YWxlbnRzLCB0aGVzZSBhcmUgY29udHJvbGxlZCBmb3IgYXMgd2VsbC4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdC8qIE5vdGU6IE92ZXJmbG93IG11c3QgYmUgYWxzbyBiZSBjb250cm9sbGVkIGZvciBwZXItYXhpcyBzaW5jZSB0aGUgb3ZlcmZsb3cgcHJvcGVydHkgb3ZlcndyaXRlcyBpdHMgcGVyLWF4aXMgdmFsdWVzLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0JC5lYWNoKFtcIm92ZXJmbG93XCIsIFwib3ZlcmZsb3dYXCIsIFwib3ZlcmZsb3dZXCJdLCBmdW5jdGlvbihpLCBwcm9wZXJ0eSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRWZWxvY2l0eS5DU1Muc2V0UHJvcGVydHlWYWx1ZShkdW1teSwgcHJvcGVydHksIFwiaGlkZGVuXCIpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRWZWxvY2l0eS5DU1Muc2V0UHJvcGVydHlWYWx1ZShkdW1teSwgXCJwb3NpdGlvblwiLCBzYW1lUmF0aW9JbmRpY2F0b3JzLnBvc2l0aW9uKTtcblx0XHRcdFx0XHRcdFx0XHRcdFZlbG9jaXR5LkNTUy5zZXRQcm9wZXJ0eVZhbHVlKGR1bW15LCBcImZvbnRTaXplXCIsIHNhbWVSYXRpb0luZGljYXRvcnMuZm9udFNpemUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0VmVsb2NpdHkuQ1NTLnNldFByb3BlcnR5VmFsdWUoZHVtbXksIFwiYm94U2l6aW5nXCIsIFwiY29udGVudC1ib3hcIik7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIHdpZHRoIGFuZCBoZWlnaHQgYWN0IGFzIG91ciBwcm94eSBwcm9wZXJ0aWVzIGZvciBtZWFzdXJpbmcgdGhlIGhvcml6b250YWwgYW5kIHZlcnRpY2FsICUgcmF0aW9zLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0JC5lYWNoKFtcIm1pbldpZHRoXCIsIFwibWF4V2lkdGhcIiwgXCJ3aWR0aFwiLCBcIm1pbkhlaWdodFwiLCBcIm1heEhlaWdodFwiLCBcImhlaWdodFwiXSwgZnVuY3Rpb24oaSwgcHJvcGVydHkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0VmVsb2NpdHkuQ1NTLnNldFByb3BlcnR5VmFsdWUoZHVtbXksIHByb3BlcnR5LCBtZWFzdXJlbWVudCArIFwiJVwiKTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0LyogcGFkZGluZ0xlZnQgYXJiaXRyYXJpbHkgYWN0cyBhcyBvdXIgcHJveHkgcHJvcGVydHkgZm9yIHRoZSBlbSByYXRpby4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFZlbG9jaXR5LkNTUy5zZXRQcm9wZXJ0eVZhbHVlKGR1bW15LCBcInBhZGRpbmdMZWZ0XCIsIG1lYXN1cmVtZW50ICsgXCJlbVwiKTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0LyogRGl2aWRlIHRoZSByZXR1cm5lZCB2YWx1ZSBieSB0aGUgbWVhc3VyZW1lbnQgdG8gZ2V0IHRoZSByYXRpbyBiZXR3ZWVuIDElIGFuZCAxcHguIERlZmF1bHQgdG8gMSBzaW5jZSB3b3JraW5nIHdpdGggMCBjYW4gcHJvZHVjZSBJbmZpbml0ZS4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdHVuaXRSYXRpb3MucGVyY2VudFRvUHhXaWR0aCA9IGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdFBlcmNlbnRUb1B4V2lkdGggPSAocGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShkdW1teSwgXCJ3aWR0aFwiLCBudWxsLCB0cnVlKSkgfHwgMSkgLyBtZWFzdXJlbWVudDsgLyogR0VUICovXG5cdFx0XHRcdFx0XHRcdFx0XHR1bml0UmF0aW9zLnBlcmNlbnRUb1B4SGVpZ2h0ID0gY2FsbFVuaXRDb252ZXJzaW9uRGF0YS5sYXN0UGVyY2VudFRvUHhIZWlnaHQgPSAocGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShkdW1teSwgXCJoZWlnaHRcIiwgbnVsbCwgdHJ1ZSkpIHx8IDEpIC8gbWVhc3VyZW1lbnQ7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0dW5pdFJhdGlvcy5lbVRvUHggPSBjYWxsVW5pdENvbnZlcnNpb25EYXRhLmxhc3RFbVRvUHggPSAocGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShkdW1teSwgXCJwYWRkaW5nTGVmdFwiKSkgfHwgMSkgLyBtZWFzdXJlbWVudDsgLyogR0VUICovXG5cblx0XHRcdFx0XHRcdFx0XHRcdHNhbWVSYXRpb0luZGljYXRvcnMubXlQYXJlbnQucmVtb3ZlQ2hpbGQoZHVtbXkpO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR1bml0UmF0aW9zLmVtVG9QeCA9IGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdEVtVG9QeDtcblx0XHRcdFx0XHRcdFx0XHRcdHVuaXRSYXRpb3MucGVyY2VudFRvUHhXaWR0aCA9IGNhbGxVbml0Q29udmVyc2lvbkRhdGEubGFzdFBlcmNlbnRUb1B4V2lkdGg7XG5cdFx0XHRcdFx0XHRcdFx0XHR1bml0UmF0aW9zLnBlcmNlbnRUb1B4SGVpZ2h0ID0gY2FsbFVuaXRDb252ZXJzaW9uRGF0YS5sYXN0UGVyY2VudFRvUHhIZWlnaHQ7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0XHRcdCBFbGVtZW50LUFnbm9zdGljIFVuaXRzXG5cdFx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHRcdC8qIFdoZXJlYXMgJSBhbmQgZW0gcmF0aW9zIGFyZSBkZXRlcm1pbmVkIG9uIGEgcGVyLWVsZW1lbnQgYmFzaXMsIHRoZSByZW0gdW5pdCBvbmx5IG5lZWRzIHRvIGJlIGNoZWNrZWRcblx0XHRcdFx0XHRcdFx0XHQgb25jZSBwZXIgY2FsbCBzaW5jZSBpdCdzIGV4Y2x1c2l2ZWx5IGRlcGVuZGFudCB1cG9uIGRvY3VtZW50LmJvZHkncyBmb250U2l6ZS4gSWYgdGhpcyBpcyB0aGUgZmlyc3QgdGltZVxuXHRcdFx0XHRcdFx0XHRcdCB0aGF0IGNhbGN1bGF0ZVVuaXRSYXRpb3MoKSBpcyBiZWluZyBydW4gZHVyaW5nIHRoaXMgY2FsbCwgcmVtVG9QeCB3aWxsIHN0aWxsIGJlIHNldCB0byBpdHMgZGVmYXVsdCB2YWx1ZSBvZiBudWxsLFxuXHRcdFx0XHRcdFx0XHRcdCBzbyB3ZSBjYWxjdWxhdGUgaXQgbm93LiAqL1xuXHRcdFx0XHRcdFx0XHRcdGlmIChjYWxsVW5pdENvbnZlcnNpb25EYXRhLnJlbVRvUHggPT09IG51bGwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8qIERlZmF1bHQgdG8gYnJvd3NlcnMnIGRlZmF1bHQgZm9udFNpemUgb2YgMTZweCBpbiB0aGUgY2FzZSBvZiAwLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2FsbFVuaXRDb252ZXJzaW9uRGF0YS5yZW1Ub1B4ID0gcGFyc2VGbG9hdChDU1MuZ2V0UHJvcGVydHlWYWx1ZShkb2N1bWVudC5ib2R5LCBcImZvbnRTaXplXCIpKSB8fCAxNjsgLyogR0VUICovXG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0LyogU2ltaWxhcmx5LCB2aWV3cG9ydCB1bml0cyBhcmUgJS1yZWxhdGl2ZSB0byB0aGUgd2luZG93J3MgaW5uZXIgZGltZW5zaW9ucy4gKi9cblx0XHRcdFx0XHRcdFx0XHRpZiAoY2FsbFVuaXRDb252ZXJzaW9uRGF0YS52d1RvUHggPT09IG51bGwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNhbGxVbml0Q29udmVyc2lvbkRhdGEudndUb1B4ID0gcGFyc2VGbG9hdCh3aW5kb3cuaW5uZXJXaWR0aCkgLyAxMDA7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2FsbFVuaXRDb252ZXJzaW9uRGF0YS52aFRvUHggPSBwYXJzZUZsb2F0KHdpbmRvdy5pbm5lckhlaWdodCkgLyAxMDA7IC8qIEdFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHVuaXRSYXRpb3MucmVtVG9QeCA9IGNhbGxVbml0Q29udmVyc2lvbkRhdGEucmVtVG9QeDtcblx0XHRcdFx0XHRcdFx0XHR1bml0UmF0aW9zLnZ3VG9QeCA9IGNhbGxVbml0Q29udmVyc2lvbkRhdGEudndUb1B4O1xuXHRcdFx0XHRcdFx0XHRcdHVuaXRSYXRpb3MudmhUb1B4ID0gY2FsbFVuaXRDb252ZXJzaW9uRGF0YS52aFRvUHg7XG5cblx0XHRcdFx0XHRcdFx0XHRpZiAoVmVsb2NpdHkuZGVidWcgPj0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJVbml0IHJhdGlvczogXCIgKyBKU09OLnN0cmluZ2lmeSh1bml0UmF0aW9zKSwgZWxlbWVudCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB1bml0UmF0aW9zO1xuXHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0XHQgVW5pdCBDb252ZXJzaW9uXG5cdFx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHQvKiBUaGUgKiBhbmQgLyBvcGVyYXRvcnMsIHdoaWNoIGFyZSBub3QgcGFzc2VkIGluIHdpdGggYW4gYXNzb2NpYXRlZCB1bml0LCBpbmhlcmVudGx5IHVzZSBzdGFydFZhbHVlJ3MgdW5pdC4gU2tpcCB2YWx1ZSBhbmQgdW5pdCBjb252ZXJzaW9uLiAqL1xuXHRcdFx0XHRcdFx0XHRpZiAoL1tcXC8qXS8udGVzdChvcGVyYXRvcikpIHtcblx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZVVuaXRUeXBlID0gc3RhcnRWYWx1ZVVuaXRUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdC8qIElmIHN0YXJ0VmFsdWUgYW5kIGVuZFZhbHVlIGRpZmZlciBpbiB1bml0IHR5cGUsIGNvbnZlcnQgc3RhcnRWYWx1ZSBpbnRvIHRoZSBzYW1lIHVuaXQgdHlwZSBhcyBlbmRWYWx1ZSBzbyB0aGF0IGlmIGVuZFZhbHVlVW5pdFR5cGVcblx0XHRcdFx0XHRcdFx0XHQgaXMgYSByZWxhdGl2ZSB1bml0ICglLCBlbSwgcmVtKSwgdGhlIHZhbHVlcyBzZXQgZHVyaW5nIHR3ZWVuaW5nIHdpbGwgY29udGludWUgdG8gYmUgYWNjdXJhdGVseSByZWxhdGl2ZSBldmVuIGlmIHRoZSBtZXRyaWNzIHRoZXkgZGVwZW5kXG5cdFx0XHRcdFx0XHRcdFx0IG9uIGFyZSBkeW5hbWljYWxseSBjaGFuZ2luZyBkdXJpbmcgdGhlIGNvdXJzZSBvZiB0aGUgYW5pbWF0aW9uLiBDb252ZXJzZWx5LCBpZiB3ZSBhbHdheXMgbm9ybWFsaXplZCBpbnRvIHB4IGFuZCB1c2VkIHB4IGZvciBzZXR0aW5nIHZhbHVlcywgdGhlIHB4IHJhdGlvXG5cdFx0XHRcdFx0XHRcdFx0IHdvdWxkIGJlY29tZSBzdGFsZSBpZiB0aGUgb3JpZ2luYWwgdW5pdCBiZWluZyBhbmltYXRlZCB0b3dhcmQgd2FzIHJlbGF0aXZlIGFuZCB0aGUgdW5kZXJseWluZyBtZXRyaWNzIGNoYW5nZSBkdXJpbmcgdGhlIGFuaW1hdGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0XHQvKiBTaW5jZSAwIGlzIDAgaW4gYW55IHVuaXQgdHlwZSwgbm8gY29udmVyc2lvbiBpcyBuZWNlc3Nhcnkgd2hlbiBzdGFydFZhbHVlIGlzIDAgLS0gd2UganVzdCBzdGFydCBhdCAwIHdpdGggZW5kVmFsdWVVbml0VHlwZS4gKi9cblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICgoc3RhcnRWYWx1ZVVuaXRUeXBlICE9PSBlbmRWYWx1ZVVuaXRUeXBlKSAmJiBzdGFydFZhbHVlICE9PSAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0LyogVW5pdCBjb252ZXJzaW9uIGlzIGFsc28gc2tpcHBlZCB3aGVuIGVuZFZhbHVlIGlzIDAsIGJ1dCAqc3RhcnRWYWx1ZVVuaXRUeXBlKiBtdXN0IGJlIHVzZWQgZm9yIHR3ZWVuIHZhbHVlcyB0byByZW1haW4gYWNjdXJhdGUuICovXG5cdFx0XHRcdFx0XHRcdFx0LyogTm90ZTogU2tpcHBpbmcgdW5pdCBjb252ZXJzaW9uIGhlcmUgbWVhbnMgdGhhdCBpZiBlbmRWYWx1ZVVuaXRUeXBlIHdhcyBvcmlnaW5hbGx5IGEgcmVsYXRpdmUgdW5pdCwgdGhlIGFuaW1hdGlvbiB3b24ndCByZWxhdGl2ZWx5XG5cdFx0XHRcdFx0XHRcdFx0IG1hdGNoIHRoZSB1bmRlcmx5aW5nIG1ldHJpY3MgaWYgdGhleSBjaGFuZ2UsIGJ1dCB0aGlzIGlzIGFjY2VwdGFibGUgc2luY2Ugd2UncmUgYW5pbWF0aW5nIHRvd2FyZCBpbnZpc2liaWxpdHkgaW5zdGVhZCBvZiB0b3dhcmQgdmlzaWJpbGl0eSxcblx0XHRcdFx0XHRcdFx0XHQgd2hpY2ggcmVtYWlucyBwYXN0IHRoZSBwb2ludCBvZiB0aGUgYW5pbWF0aW9uJ3MgY29tcGxldGlvbi4gKi9cblx0XHRcdFx0XHRcdFx0XHRpZiAoZW5kVmFsdWUgPT09IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlVW5pdFR5cGUgPSBzdGFydFZhbHVlVW5pdFR5cGU7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8qIEJ5IHRoaXMgcG9pbnQsIHdlIGNhbm5vdCBhdm9pZCB1bml0IGNvbnZlcnNpb24gKGl0J3MgdW5kZXNpcmFibGUgc2luY2UgaXQgY2F1c2VzIGxheW91dCB0aHJhc2hpbmcpLlxuXHRcdFx0XHRcdFx0XHRcdFx0IElmIHdlIGhhdmVuJ3QgYWxyZWFkeSwgd2UgdHJpZ2dlciBjYWxjdWxhdGVVbml0UmF0aW9zKCksIHdoaWNoIHJ1bnMgb25jZSBwZXIgZWxlbWVudCBwZXIgY2FsbC4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdGVsZW1lbnRVbml0Q29udmVyc2lvbkRhdGEgPSBlbGVtZW50VW5pdENvbnZlcnNpb25EYXRhIHx8IGNhbGN1bGF0ZVVuaXRSYXRpb3MoKTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0LyogVGhlIGZvbGxvd2luZyBSZWdFeCBtYXRjaGVzIENTUyBwcm9wZXJ0aWVzIHRoYXQgaGF2ZSB0aGVpciAlIHZhbHVlcyBtZWFzdXJlZCByZWxhdGl2ZSB0byB0aGUgeC1heGlzLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0LyogTm90ZTogVzNDIHNwZWMgbWFuZGF0ZXMgdGhhdCBhbGwgb2YgbWFyZ2luIGFuZCBwYWRkaW5nJ3MgcHJvcGVydGllcyAoZXZlbiB0b3AgYW5kIGJvdHRvbSkgYXJlICUtcmVsYXRpdmUgdG8gdGhlICp3aWR0aCogb2YgdGhlIHBhcmVudCBlbGVtZW50LiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGF4aXMgPSAoL21hcmdpbnxwYWRkaW5nfGxlZnR8cmlnaHR8d2lkdGh8dGV4dHx3b3JkfGxldHRlci9pLnRlc3QocHJvcGVydHkpIHx8IC9YJC8udGVzdChwcm9wZXJ0eSkgfHwgcHJvcGVydHkgPT09IFwieFwiKSA/IFwieFwiIDogXCJ5XCI7XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIEluIG9yZGVyIHRvIGF2b2lkIGdlbmVyYXRpbmcgbl4yIGJlc3Bva2UgY29udmVyc2lvbiBmdW5jdGlvbnMsIHVuaXQgY29udmVyc2lvbiBpcyBhIHR3by1zdGVwIHByb2Nlc3M6XG5cdFx0XHRcdFx0XHRcdFx0XHQgMSkgQ29udmVydCBzdGFydFZhbHVlIGludG8gcGl4ZWxzLiAyKSBDb252ZXJ0IHRoaXMgbmV3IHBpeGVsIHZhbHVlIGludG8gZW5kVmFsdWUncyB1bml0IHR5cGUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRzd2l0Y2ggKHN0YXJ0VmFsdWVVbml0VHlwZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwiJVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8qIE5vdGU6IHRyYW5zbGF0ZVggYW5kIHRyYW5zbGF0ZVkgYXJlIHRoZSBvbmx5IHByb3BlcnRpZXMgdGhhdCBhcmUgJS1yZWxhdGl2ZSB0byBhbiBlbGVtZW50J3Mgb3duIGRpbWVuc2lvbnMgLS0gbm90IGl0cyBwYXJlbnQncyBkaW1lbnNpb25zLlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCBWZWxvY2l0eSBkb2VzIG5vdCBpbmNsdWRlIGEgc3BlY2lhbCBjb252ZXJzaW9uIHByb2Nlc3MgdG8gYWNjb3VudCBmb3IgdGhpcyBiZWhhdmlvci4gVGhlcmVmb3JlLCBhbmltYXRpbmcgdHJhbnNsYXRlWC9ZIGZyb20gYSAlIHZhbHVlXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0IHRvIGEgbm9uLSUgdmFsdWUgd2lsbCBwcm9kdWNlIGFuIGluY29ycmVjdCBzdGFydCB2YWx1ZS4gRm9ydHVuYXRlbHksIHRoaXMgc29ydCBvZiBjcm9zcy11bml0IGNvbnZlcnNpb24gaXMgcmFyZWx5IGRvbmUgYnkgdXNlcnMgaW4gcHJhY3RpY2UuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RhcnRWYWx1ZSAqPSAoYXhpcyA9PT0gXCJ4XCIgPyBlbGVtZW50VW5pdENvbnZlcnNpb25EYXRhLnBlcmNlbnRUb1B4V2lkdGggOiBlbGVtZW50VW5pdENvbnZlcnNpb25EYXRhLnBlcmNlbnRUb1B4SGVpZ2h0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIFwicHhcIjpcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBweCBhY3RzIGFzIG91ciBtaWRwb2ludCBpbiB0aGUgdW5pdCBjb252ZXJzaW9uIHByb2Nlc3M7IGRvIG5vdGhpbmcuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlICo9IGVsZW1lbnRVbml0Q29udmVyc2lvbkRhdGFbc3RhcnRWYWx1ZVVuaXRUeXBlICsgXCJUb1B4XCJdO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBJbnZlcnQgdGhlIHB4IHJhdGlvcyB0byBjb252ZXJ0IGludG8gdG8gdGhlIHRhcmdldCB1bml0LiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0c3dpdGNoIChlbmRWYWx1ZVVuaXRUeXBlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgXCIlXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RhcnRWYWx1ZSAqPSAxIC8gKGF4aXMgPT09IFwieFwiID8gZWxlbWVudFVuaXRDb252ZXJzaW9uRGF0YS5wZXJjZW50VG9QeFdpZHRoIDogZWxlbWVudFVuaXRDb252ZXJzaW9uRGF0YS5wZXJjZW50VG9QeEhlaWdodCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSBcInB4XCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Lyogc3RhcnRWYWx1ZSBpcyBhbHJlYWR5IGluIHB4LCBkbyBub3RoaW5nOyB3ZSdyZSBkb25lLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RhcnRWYWx1ZSAqPSAxIC8gZWxlbWVudFVuaXRDb252ZXJzaW9uRGF0YVtlbmRWYWx1ZVVuaXRUeXBlICsgXCJUb1B4XCJdO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0IFJlbGF0aXZlIFZhbHVlc1xuXHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0XHRcdC8qIE9wZXJhdG9yIGxvZ2ljIG11c3QgYmUgcGVyZm9ybWVkIGxhc3Qgc2luY2UgaXQgcmVxdWlyZXMgdW5pdC1ub3JtYWxpemVkIHN0YXJ0IGFuZCBlbmQgdmFsdWVzLiAqL1xuXHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBSZWxhdGl2ZSAqcGVyY2VudCB2YWx1ZXMqIGRvIG5vdCBiZWhhdmUgaG93IG1vc3QgcGVvcGxlIHRoaW5rOyB3aGlsZSBvbmUgd291bGQgZXhwZWN0IFwiKz01MCVcIlxuXHRcdFx0XHRcdFx0XHQgdG8gaW5jcmVhc2UgdGhlIHByb3BlcnR5IDEuNXggaXRzIGN1cnJlbnQgdmFsdWUsIGl0IGluIGZhY3QgaW5jcmVhc2VzIHRoZSBwZXJjZW50IHVuaXRzIGluIGFic29sdXRlIHRlcm1zOlxuXHRcdFx0XHRcdFx0XHQgNTAgcG9pbnRzIGlzIGFkZGVkIG9uIHRvcCBvZiB0aGUgY3VycmVudCAlIHZhbHVlLiAqL1xuXHRcdFx0XHRcdFx0XHRzd2l0Y2ggKG9wZXJhdG9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSBcIitcIjpcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gc3RhcnRWYWx1ZSArIGVuZFZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRjYXNlIFwiLVwiOlxuXHRcdFx0XHRcdFx0XHRcdFx0ZW5kVmFsdWUgPSBzdGFydFZhbHVlIC0gZW5kVmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdGNhc2UgXCIqXCI6XG5cdFx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZSA9IHN0YXJ0VmFsdWUgKiBlbmRWYWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdFx0Y2FzZSBcIi9cIjpcblx0XHRcdFx0XHRcdFx0XHRcdGVuZFZhbHVlID0gc3RhcnRWYWx1ZSAvIGVuZFZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0IHR3ZWVuc0NvbnRhaW5lciBQdXNoXG5cdFx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHQvKiBDb25zdHJ1Y3QgdGhlIHBlci1wcm9wZXJ0eSB0d2VlbiBvYmplY3QsIGFuZCBwdXNoIGl0IHRvIHRoZSBlbGVtZW50J3MgdHdlZW5zQ29udGFpbmVyLiAqL1xuXHRcdFx0XHRcdFx0XHR0d2VlbnNDb250YWluZXJbcHJvcGVydHldID0ge1xuXHRcdFx0XHRcdFx0XHRcdHJvb3RQcm9wZXJ0eVZhbHVlOiByb290UHJvcGVydHlWYWx1ZSxcblx0XHRcdFx0XHRcdFx0XHRzdGFydFZhbHVlOiBzdGFydFZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdGN1cnJlbnRWYWx1ZTogc3RhcnRWYWx1ZSxcblx0XHRcdFx0XHRcdFx0XHRlbmRWYWx1ZTogZW5kVmFsdWUsXG5cdFx0XHRcdFx0XHRcdFx0dW5pdFR5cGU6IGVuZFZhbHVlVW5pdFR5cGUsXG5cdFx0XHRcdFx0XHRcdFx0ZWFzaW5nOiBlYXNpbmdcblx0XHRcdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdFx0XHRpZiAoVmVsb2NpdHkuZGVidWcpIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInR3ZWVuc0NvbnRhaW5lciAoXCIgKyBwcm9wZXJ0eSArIFwiKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0d2VlbnNDb250YWluZXJbcHJvcGVydHldKSwgZWxlbWVudCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogQWxvbmcgd2l0aCBpdHMgcHJvcGVydHkgZGF0YSwgc3RvcmUgYSByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgaXRzZWxmIG9udG8gdHdlZW5zQ29udGFpbmVyLiAqL1xuXHRcdFx0XHRcdFx0dHdlZW5zQ29udGFpbmVyLmVsZW1lbnQgPSBlbGVtZW50O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdCBDYWxsIFB1c2hcblx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHQvKiBOb3RlOiB0d2VlbnNDb250YWluZXIgY2FuIGJlIGVtcHR5IGlmIGFsbCBvZiB0aGUgcHJvcGVydGllcyBpbiB0aGlzIGNhbGwncyBwcm9wZXJ0eSBtYXAgd2VyZSBza2lwcGVkIGR1ZSB0byBub3Rcblx0XHRcdFx0XHQgYmVpbmcgc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyLiBUaGUgZWxlbWVudCBwcm9wZXJ0eSBpcyB1c2VkIGZvciBjaGVja2luZyB0aGF0IHRoZSB0d2VlbnNDb250YWluZXIgaGFzIGJlZW4gYXBwZW5kZWQgdG8uICovXG5cdFx0XHRcdFx0aWYgKHR3ZWVuc0NvbnRhaW5lci5lbGVtZW50KSB7XG5cdFx0XHRcdFx0XHQvKiBBcHBseSB0aGUgXCJ2ZWxvY2l0eS1hbmltYXRpbmdcIiBpbmRpY2F0b3IgY2xhc3MuICovXG5cdFx0XHRcdFx0XHRDU1MuVmFsdWVzLmFkZENsYXNzKGVsZW1lbnQsIFwidmVsb2NpdHktYW5pbWF0aW5nXCIpO1xuXG5cdFx0XHRcdFx0XHQvKiBUaGUgY2FsbCBhcnJheSBob3VzZXMgdGhlIHR3ZWVuc0NvbnRhaW5lcnMgZm9yIGVhY2ggZWxlbWVudCBiZWluZyBhbmltYXRlZCBpbiB0aGUgY3VycmVudCBjYWxsLiAqL1xuXHRcdFx0XHRcdFx0Y2FsbC5wdXNoKHR3ZWVuc0NvbnRhaW5lcik7XG5cblx0XHRcdFx0XHRcdGRhdGEgPSBEYXRhKGVsZW1lbnQpO1xuXG5cdFx0XHRcdFx0XHRpZiAoZGF0YSkge1xuXHRcdFx0XHRcdFx0XHQvKiBTdG9yZSB0aGUgdHdlZW5zQ29udGFpbmVyIGFuZCBvcHRpb25zIGlmIHdlJ3JlIHdvcmtpbmcgb24gdGhlIGRlZmF1bHQgZWZmZWN0cyBxdWV1ZSwgc28gdGhhdCB0aGV5IGNhbiBiZSB1c2VkIGJ5IHRoZSByZXZlcnNlIGNvbW1hbmQuICovXG5cdFx0XHRcdFx0XHRcdGlmIChvcHRzLnF1ZXVlID09PSBcIlwiKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRkYXRhLnR3ZWVuc0NvbnRhaW5lciA9IHR3ZWVuc0NvbnRhaW5lcjtcblx0XHRcdFx0XHRcdFx0XHRkYXRhLm9wdHMgPSBvcHRzO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogU3dpdGNoIG9uIHRoZSBlbGVtZW50J3MgYW5pbWF0aW5nIGZsYWcuICovXG5cdFx0XHRcdFx0XHRcdGRhdGEuaXNBbmltYXRpbmcgPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvKiBPbmNlIHRoZSBmaW5hbCBlbGVtZW50IGluIHRoaXMgY2FsbCdzIGVsZW1lbnQgc2V0IGhhcyBiZWVuIHByb2Nlc3NlZCwgcHVzaCB0aGUgY2FsbCBhcnJheSBvbnRvXG5cdFx0XHRcdFx0XHQgVmVsb2NpdHkuU3RhdGUuY2FsbHMgZm9yIHRoZSBhbmltYXRpb24gdGljayB0byBpbW1lZGlhdGVseSBiZWdpbiBwcm9jZXNzaW5nLiAqL1xuXHRcdFx0XHRcdFx0aWYgKGVsZW1lbnRzSW5kZXggPT09IGVsZW1lbnRzTGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRcdFx0XHQvKiBBZGQgdGhlIGN1cnJlbnQgY2FsbCBwbHVzIGl0cyBhc3NvY2lhdGVkIG1ldGFkYXRhICh0aGUgZWxlbWVudCBzZXQgYW5kIHRoZSBjYWxsJ3Mgb3B0aW9ucykgb250byB0aGUgZ2xvYmFsIGNhbGwgY29udGFpbmVyLlxuXHRcdFx0XHRcdFx0XHQgQW55dGhpbmcgb24gdGhpcyBjYWxsIGNvbnRhaW5lciBpcyBzdWJqZWN0ZWQgdG8gdGljaygpIHByb2Nlc3NpbmcuICovXG5cdFx0XHRcdFx0XHRcdFZlbG9jaXR5LlN0YXRlLmNhbGxzLnB1c2goW2NhbGwsIGVsZW1lbnRzLCBvcHRzLCBudWxsLCBwcm9taXNlRGF0YS5yZXNvbHZlcl0pO1xuXG5cdFx0XHRcdFx0XHRcdC8qIElmIHRoZSBhbmltYXRpb24gdGljayBpc24ndCBydW5uaW5nLCBzdGFydCBpdC4gKFZlbG9jaXR5IHNodXRzIGl0IG9mZiB3aGVuIHRoZXJlIGFyZSBubyBhY3RpdmUgY2FsbHMgdG8gcHJvY2Vzcy4pICovXG5cdFx0XHRcdFx0XHRcdGlmIChWZWxvY2l0eS5TdGF0ZS5pc1RpY2tpbmcgPT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0XHRcdFx0VmVsb2NpdHkuU3RhdGUuaXNUaWNraW5nID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRcdC8qIFN0YXJ0IHRoZSB0aWNrIGxvb3AuICovXG5cdFx0XHRcdFx0XHRcdFx0dGljaygpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlbGVtZW50c0luZGV4Kys7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyogV2hlbiB0aGUgcXVldWUgb3B0aW9uIGlzIHNldCB0byBmYWxzZSwgdGhlIGNhbGwgc2tpcHMgdGhlIGVsZW1lbnQncyBxdWV1ZSBhbmQgZmlyZXMgaW1tZWRpYXRlbHkuICovXG5cdFx0XHRcdGlmIChvcHRzLnF1ZXVlID09PSBmYWxzZSkge1xuXHRcdFx0XHRcdC8qIFNpbmNlIHRoaXMgYnVpbGRRdWV1ZSBjYWxsIGRvZXNuJ3QgcmVzcGVjdCB0aGUgZWxlbWVudCdzIGV4aXN0aW5nIHF1ZXVlICh3aGljaCBpcyB3aGVyZSBhIGRlbGF5IG9wdGlvbiB3b3VsZCBoYXZlIGJlZW4gYXBwZW5kZWQpLFxuXHRcdFx0XHRcdCB3ZSBtYW51YWxseSBpbmplY3QgdGhlIGRlbGF5IHByb3BlcnR5IGhlcmUgd2l0aCBhbiBleHBsaWNpdCBzZXRUaW1lb3V0LiAqL1xuXHRcdFx0XHRcdGlmIChvcHRzLmRlbGF5KSB7XG5cdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGJ1aWxkUXVldWUsIG9wdHMuZGVsYXkpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRidWlsZFF1ZXVlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8qIE90aGVyd2lzZSwgdGhlIGNhbGwgdW5kZXJnb2VzIGVsZW1lbnQgcXVldWVpbmcgYXMgbm9ybWFsLiAqL1xuXHRcdFx0XHRcdC8qIE5vdGU6IFRvIGludGVyb3BlcmF0ZSB3aXRoIGpRdWVyeSwgVmVsb2NpdHkgdXNlcyBqUXVlcnkncyBvd24gJC5xdWV1ZSgpIHN0YWNrIGZvciBxdWV1aW5nIGxvZ2ljLiAqL1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCQucXVldWUoZWxlbWVudCwgb3B0cy5xdWV1ZSwgZnVuY3Rpb24obmV4dCwgY2xlYXJRdWV1ZSkge1xuXHRcdFx0XHRcdFx0LyogSWYgdGhlIGNsZWFyUXVldWUgZmxhZyB3YXMgcGFzc2VkIGluIGJ5IHRoZSBzdG9wIGNvbW1hbmQsIHJlc29sdmUgdGhpcyBjYWxsJ3MgcHJvbWlzZS4gKFByb21pc2VzIGNhbiBvbmx5IGJlIHJlc29sdmVkIG9uY2UsXG5cdFx0XHRcdFx0XHQgc28gaXQncyBmaW5lIGlmIHRoaXMgaXMgcmVwZWF0ZWRseSB0cmlnZ2VyZWQgZm9yIGVhY2ggZWxlbWVudCBpbiB0aGUgYXNzb2NpYXRlZCBjYWxsLikgKi9cblx0XHRcdFx0XHRcdGlmIChjbGVhclF1ZXVlID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChwcm9taXNlRGF0YS5wcm9taXNlKSB7XG5cdFx0XHRcdFx0XHRcdFx0cHJvbWlzZURhdGEucmVzb2x2ZXIoZWxlbWVudHMpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0LyogRG8gbm90IGNvbnRpbnVlIHdpdGggYW5pbWF0aW9uIHF1ZXVlaW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogVGhpcyBmbGFnIGluZGljYXRlcyB0byB0aGUgdXBjb21pbmcgY29tcGxldGVDYWxsKCkgZnVuY3Rpb24gdGhhdCB0aGlzIHF1ZXVlIGVudHJ5IHdhcyBpbml0aWF0ZWQgYnkgVmVsb2NpdHkuXG5cdFx0XHRcdFx0XHQgU2VlIGNvbXBsZXRlQ2FsbCgpIGZvciBmdXJ0aGVyIGRldGFpbHMuICovXG5cdFx0XHRcdFx0XHRWZWxvY2l0eS52ZWxvY2l0eVF1ZXVlRW50cnlGbGFnID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0YnVpbGRRdWV1ZShuZXh0KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IEF1dG8tRGVxdWV1aW5nXG5cdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyogQXMgcGVyIGpRdWVyeSdzICQucXVldWUoKSBiZWhhdmlvciwgdG8gZmlyZSB0aGUgZmlyc3Qgbm9uLWN1c3RvbS1xdWV1ZSBlbnRyeSBvbiBhbiBlbGVtZW50LCB0aGUgZWxlbWVudFxuXHRcdFx0XHQgbXVzdCBiZSBkZXF1ZXVlZCBpZiBpdHMgcXVldWUgc3RhY2sgY29uc2lzdHMgKnNvbGVseSogb2YgdGhlIGN1cnJlbnQgY2FsbC4gKFRoaXMgY2FuIGJlIGRldGVybWluZWQgYnkgY2hlY2tpbmdcblx0XHRcdFx0IGZvciB0aGUgXCJpbnByb2dyZXNzXCIgaXRlbSB0aGF0IGpRdWVyeSBwcmVwZW5kcyB0byBhY3RpdmUgcXVldWUgc3RhY2sgYXJyYXlzLikgUmVnYXJkbGVzcywgd2hlbmV2ZXIgdGhlIGVsZW1lbnQnc1xuXHRcdFx0XHQgcXVldWUgaXMgZnVydGhlciBhcHBlbmRlZCB3aXRoIGFkZGl0aW9uYWwgaXRlbXMgLS0gaW5jbHVkaW5nICQuZGVsYXkoKSdzIG9yIGV2ZW4gJC5hbmltYXRlKCkgY2FsbHMsIHRoZSBxdWV1ZSdzXG5cdFx0XHRcdCBmaXJzdCBlbnRyeSBpcyBhdXRvbWF0aWNhbGx5IGZpcmVkLiBUaGlzIGJlaGF2aW9yIGNvbnRyYXN0cyB0aGF0IG9mIGN1c3RvbSBxdWV1ZXMsIHdoaWNoIG5ldmVyIGF1dG8tZmlyZS4gKi9cblx0XHRcdFx0LyogTm90ZTogV2hlbiBhbiBlbGVtZW50IHNldCBpcyBiZWluZyBzdWJqZWN0ZWQgdG8gYSBub24tcGFyYWxsZWwgVmVsb2NpdHkgY2FsbCwgdGhlIGFuaW1hdGlvbiB3aWxsIG5vdCBiZWdpbiB1bnRpbFxuXHRcdFx0XHQgZWFjaCBvbmUgb2YgdGhlIGVsZW1lbnRzIGluIHRoZSBzZXQgaGFzIHJlYWNoZWQgdGhlIGVuZCBvZiBpdHMgaW5kaXZpZHVhbGx5IHByZS1leGlzdGluZyBxdWV1ZSBjaGFpbi4gKi9cblx0XHRcdFx0LyogTm90ZTogVW5mb3J0dW5hdGVseSwgbW9zdCBwZW9wbGUgZG9uJ3QgZnVsbHkgZ3Jhc3AgalF1ZXJ5J3MgcG93ZXJmdWwsIHlldCBxdWlya3ksICQucXVldWUoKSBmdW5jdGlvbi5cblx0XHRcdFx0IExlYW4gbW9yZSBoZXJlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTgxNTgvY2FuLXNvbWVib2R5LWV4cGxhaW4tanF1ZXJ5LXF1ZXVlLXRvLW1lICovXG5cdFx0XHRcdGlmICgob3B0cy5xdWV1ZSA9PT0gXCJcIiB8fCBvcHRzLnF1ZXVlID09PSBcImZ4XCIpICYmICQucXVldWUoZWxlbWVudClbMF0gIT09IFwiaW5wcm9ncmVzc1wiKSB7XG5cdFx0XHRcdFx0JC5kZXF1ZXVlKGVsZW1lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0IEVsZW1lbnQgU2V0IEl0ZXJhdGlvblxuXHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHQvKiBJZiB0aGUgXCJub2RlVHlwZVwiIHByb3BlcnR5IGV4aXN0cyBvbiB0aGUgZWxlbWVudHMgdmFyaWFibGUsIHdlJ3JlIGFuaW1hdGluZyBhIHNpbmdsZSBlbGVtZW50LlxuXHRcdFx0IFBsYWNlIGl0IGluIGFuIGFycmF5IHNvIHRoYXQgJC5lYWNoKCkgY2FuIGl0ZXJhdGUgb3ZlciBpdC4gKi9cblx0XHRcdCQuZWFjaChlbGVtZW50cywgZnVuY3Rpb24oaSwgZWxlbWVudCkge1xuXHRcdFx0XHQvKiBFbnN1cmUgZWFjaCBlbGVtZW50IGluIGEgc2V0IGhhcyBhIG5vZGVUeXBlIChpcyBhIHJlYWwgZWxlbWVudCkgdG8gYXZvaWQgdGhyb3dpbmcgZXJyb3JzLiAqL1xuXHRcdFx0XHRpZiAoVHlwZS5pc05vZGUoZWxlbWVudCkpIHtcblx0XHRcdFx0XHRwcm9jZXNzRWxlbWVudChlbGVtZW50LCBpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKipcblx0XHRcdCBPcHRpb246IExvb3Bcblx0XHRcdCAqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdC8qIFRoZSBsb29wIG9wdGlvbiBhY2NlcHRzIGFuIGludGVnZXIgaW5kaWNhdGluZyBob3cgbWFueSB0aW1lcyB0aGUgZWxlbWVudCBzaG91bGQgbG9vcCBiZXR3ZWVuIHRoZSB2YWx1ZXMgaW4gdGhlXG5cdFx0XHQgY3VycmVudCBjYWxsJ3MgcHJvcGVydGllcyBtYXAgYW5kIHRoZSBlbGVtZW50J3MgcHJvcGVydHkgdmFsdWVzIHByaW9yIHRvIHRoaXMgY2FsbC4gKi9cblx0XHRcdC8qIE5vdGU6IFRoZSBsb29wIG9wdGlvbidzIGxvZ2ljIGlzIHBlcmZvcm1lZCBoZXJlIC0tIGFmdGVyIGVsZW1lbnQgcHJvY2Vzc2luZyAtLSBiZWNhdXNlIHRoZSBjdXJyZW50IGNhbGwgbmVlZHNcblx0XHRcdCB0byB1bmRlcmdvIGl0cyBxdWV1ZSBpbnNlcnRpb24gcHJpb3IgdG8gdGhlIGxvb3Agb3B0aW9uIGdlbmVyYXRpbmcgaXRzIHNlcmllcyBvZiBjb25zdGl0dWVudCBcInJldmVyc2VcIiBjYWxscyxcblx0XHRcdCB3aGljaCBjaGFpbiBhZnRlciB0aGUgY3VycmVudCBjYWxsLiBUd28gcmV2ZXJzZSBjYWxscyAodHdvIFwiYWx0ZXJuYXRpb25zXCIpIGNvbnN0aXR1dGUgb25lIGxvb3AuICovXG5cdFx0XHRvcHRzID0gJC5leHRlbmQoe30sIFZlbG9jaXR5LmRlZmF1bHRzLCBvcHRpb25zKTtcblx0XHRcdG9wdHMubG9vcCA9IHBhcnNlSW50KG9wdHMubG9vcCwgMTApO1xuXHRcdFx0dmFyIHJldmVyc2VDYWxsc0NvdW50ID0gKG9wdHMubG9vcCAqIDIpIC0gMTtcblxuXHRcdFx0aWYgKG9wdHMubG9vcCkge1xuXHRcdFx0XHQvKiBEb3VibGUgdGhlIGxvb3AgY291bnQgdG8gY29udmVydCBpdCBpbnRvIGl0cyBhcHByb3ByaWF0ZSBudW1iZXIgb2YgXCJyZXZlcnNlXCIgY2FsbHMuXG5cdFx0XHRcdCBTdWJ0cmFjdCAxIGZyb20gdGhlIHJlc3VsdGluZyB2YWx1ZSBzaW5jZSB0aGUgY3VycmVudCBjYWxsIGlzIGluY2x1ZGVkIGluIHRoZSB0b3RhbCBhbHRlcm5hdGlvbiBjb3VudC4gKi9cblx0XHRcdFx0Zm9yICh2YXIgeCA9IDA7IHggPCByZXZlcnNlQ2FsbHNDb3VudDsgeCsrKSB7XG5cdFx0XHRcdFx0LyogU2luY2UgdGhlIGxvZ2ljIGZvciB0aGUgcmV2ZXJzZSBhY3Rpb24gb2NjdXJzIGluc2lkZSBRdWV1ZWluZyBhbmQgdGhlcmVmb3JlIHRoaXMgY2FsbCdzIG9wdGlvbnMgb2JqZWN0XG5cdFx0XHRcdFx0IGlzbid0IHBhcnNlZCB1bnRpbCB0aGVuIGFzIHdlbGwsIHRoZSBjdXJyZW50IGNhbGwncyBkZWxheSBvcHRpb24gbXVzdCBiZSBleHBsaWNpdGx5IHBhc3NlZCBpbnRvIHRoZSByZXZlcnNlXG5cdFx0XHRcdFx0IGNhbGwgc28gdGhhdCB0aGUgZGVsYXkgbG9naWMgdGhhdCBvY2N1cnMgaW5zaWRlICpQcmUtUXVldWVpbmcqIGNhbiBwcm9jZXNzIGl0LiAqL1xuXHRcdFx0XHRcdHZhciByZXZlcnNlT3B0aW9ucyA9IHtcblx0XHRcdFx0XHRcdGRlbGF5OiBvcHRzLmRlbGF5LFxuXHRcdFx0XHRcdFx0cHJvZ3Jlc3M6IG9wdHMucHJvZ3Jlc3Ncblx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0LyogSWYgYSBjb21wbGV0ZSBjYWxsYmFjayB3YXMgcGFzc2VkIGludG8gdGhpcyBjYWxsLCB0cmFuc2ZlciBpdCB0byB0aGUgbG9vcCByZWRpcmVjdCdzIGZpbmFsIFwicmV2ZXJzZVwiIGNhbGxcblx0XHRcdFx0XHQgc28gdGhhdCBpdCdzIHRyaWdnZXJlZCB3aGVuIHRoZSBlbnRpcmUgcmVkaXJlY3QgaXMgY29tcGxldGUgKGFuZCBub3Qgd2hlbiB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gaXMgY29tcGxldGUpLiAqL1xuXHRcdFx0XHRcdGlmICh4ID09PSByZXZlcnNlQ2FsbHNDb3VudCAtIDEpIHtcblx0XHRcdFx0XHRcdHJldmVyc2VPcHRpb25zLmRpc3BsYXkgPSBvcHRzLmRpc3BsYXk7XG5cdFx0XHRcdFx0XHRyZXZlcnNlT3B0aW9ucy52aXNpYmlsaXR5ID0gb3B0cy52aXNpYmlsaXR5O1xuXHRcdFx0XHRcdFx0cmV2ZXJzZU9wdGlvbnMuY29tcGxldGUgPSBvcHRzLmNvbXBsZXRlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGFuaW1hdGUoZWxlbWVudHMsIFwicmV2ZXJzZVwiLCByZXZlcnNlT3B0aW9ucyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0LyoqKioqKioqKioqKioqKlxuXHRcdFx0IENoYWluaW5nXG5cdFx0XHQgKioqKioqKioqKioqKioqL1xuXG5cdFx0XHQvKiBSZXR1cm4gdGhlIGVsZW1lbnRzIGJhY2sgdG8gdGhlIGNhbGwgY2hhaW4sIHdpdGggd3JhcHBlZCBlbGVtZW50cyB0YWtpbmcgcHJlY2VkZW5jZSBpbiBjYXNlIFZlbG9jaXR5IHdhcyBjYWxsZWQgdmlhIHRoZSAkLmZuLiBleHRlbnNpb24uICovXG5cdFx0XHRyZXR1cm4gZ2V0Q2hhaW4oKTtcblx0XHR9O1xuXG5cdFx0LyogVHVybiBWZWxvY2l0eSBpbnRvIHRoZSBhbmltYXRpb24gZnVuY3Rpb24sIGV4dGVuZGVkIHdpdGggdGhlIHByZS1leGlzdGluZyBWZWxvY2l0eSBvYmplY3QuICovXG5cdFx0VmVsb2NpdHkgPSAkLmV4dGVuZChhbmltYXRlLCBWZWxvY2l0eSk7XG5cdFx0LyogRm9yIGxlZ2FjeSBzdXBwb3J0LCBhbHNvIGV4cG9zZSB0aGUgbGl0ZXJhbCBhbmltYXRlIG1ldGhvZC4gKi9cblx0XHRWZWxvY2l0eS5hbmltYXRlID0gYW5pbWF0ZTtcblxuXHRcdC8qKioqKioqKioqKioqKlxuXHRcdCBUaW1pbmdcblx0XHQgKioqKioqKioqKioqKiovXG5cblx0XHQvKiBUaWNrZXIgZnVuY3Rpb24uICovXG5cdFx0dmFyIHRpY2tlciA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgckFGU2hpbTtcblxuXHRcdC8qIEluYWN0aXZlIGJyb3dzZXIgdGFicyBwYXVzZSByQUYsIHdoaWNoIHJlc3VsdHMgaW4gYWxsIGFjdGl2ZSBhbmltYXRpb25zIGltbWVkaWF0ZWx5IHNwcmludGluZyB0byB0aGVpciBjb21wbGV0aW9uIHN0YXRlcyB3aGVuIHRoZSB0YWIgcmVmb2N1c2VzLlxuXHRcdCBUbyBnZXQgYXJvdW5kIHRoaXMsIHdlIGR5bmFtaWNhbGx5IHN3aXRjaCByQUYgdG8gc2V0VGltZW91dCAod2hpY2ggdGhlIGJyb3dzZXIgKmRvZXNuJ3QqIHBhdXNlKSB3aGVuIHRoZSB0YWIgbG9zZXMgZm9jdXMuIFdlIHNraXAgdGhpcyBmb3IgbW9iaWxlXG5cdFx0IGRldmljZXMgdG8gYXZvaWQgd2FzdGluZyBiYXR0ZXJ5IHBvd2VyIG9uIGluYWN0aXZlIHRhYnMuICovXG5cdFx0LyogTm90ZTogVGFiIGZvY3VzIGRldGVjdGlvbiBkb2Vzbid0IHdvcmsgb24gb2xkZXIgdmVyc2lvbnMgb2YgSUUsIGJ1dCB0aGF0J3Mgb2theSBzaW5jZSB0aGV5IGRvbid0IHN1cHBvcnQgckFGIHRvIGJlZ2luIHdpdGguICovXG5cdFx0aWYgKCFWZWxvY2l0eS5TdGF0ZS5pc01vYmlsZSAmJiBkb2N1bWVudC5oaWRkZW4gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdC8qIFJlYXNzaWduIHRoZSByQUYgZnVuY3Rpb24gKHdoaWNoIHRoZSBnbG9iYWwgdGljaygpIGZ1bmN0aW9uIHVzZXMpIGJhc2VkIG9uIHRoZSB0YWIncyBmb2N1cyBzdGF0ZS4gKi9cblx0XHRcdFx0aWYgKGRvY3VtZW50LmhpZGRlbikge1xuXHRcdFx0XHRcdHRpY2tlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0XHRcdFx0XHQvKiBUaGUgdGljayBmdW5jdGlvbiBuZWVkcyBhIHRydXRoeSBmaXJzdCBhcmd1bWVudCBpbiBvcmRlciB0byBwYXNzIGl0cyBpbnRlcm5hbCB0aW1lc3RhbXAgY2hlY2suICovXG5cdFx0XHRcdFx0XHRyZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2sodHJ1ZSk7XG5cdFx0XHRcdFx0XHR9LCAxNik7XG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdC8qIFRoZSByQUYgbG9vcCBoYXMgYmVlbiBwYXVzZWQgYnkgdGhlIGJyb3dzZXIsIHNvIHdlIG1hbnVhbGx5IHJlc3RhcnQgdGhlIHRpY2suICovXG5cdFx0XHRcdFx0dGljaygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRpY2tlciA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgckFGU2hpbTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0LyoqKioqKioqKioqKlxuXHRcdCBUaWNrXG5cdFx0ICoqKioqKioqKioqKi9cblxuXHRcdC8qIE5vdGU6IEFsbCBjYWxscyB0byBWZWxvY2l0eSBhcmUgcHVzaGVkIHRvIHRoZSBWZWxvY2l0eS5TdGF0ZS5jYWxscyBhcnJheSwgd2hpY2ggaXMgZnVsbHkgaXRlcmF0ZWQgdGhyb3VnaCB1cG9uIGVhY2ggdGljay4gKi9cblx0XHRmdW5jdGlvbiB0aWNrKHRpbWVzdGFtcCkge1xuXHRcdFx0LyogQW4gZW1wdHkgdGltZXN0YW1wIGFyZ3VtZW50IGluZGljYXRlcyB0aGF0IHRoaXMgaXMgdGhlIGZpcnN0IHRpY2sgb2NjdXJlbmNlIHNpbmNlIHRpY2tpbmcgd2FzIHR1cm5lZCBvbi5cblx0XHRcdCBXZSBsZXZlcmFnZSB0aGlzIG1ldGFkYXRhIHRvIGZ1bGx5IGlnbm9yZSB0aGUgZmlyc3QgdGljayBwYXNzIHNpbmNlIFJBRidzIGluaXRpYWwgcGFzcyBpcyBmaXJlZCB3aGVuZXZlclxuXHRcdFx0IHRoZSBicm93c2VyJ3MgbmV4dCB0aWNrIHN5bmMgdGltZSBvY2N1cnMsIHdoaWNoIHJlc3VsdHMgaW4gdGhlIGZpcnN0IGVsZW1lbnRzIHN1YmplY3RlZCB0byBWZWxvY2l0eVxuXHRcdFx0IGNhbGxzIGJlaW5nIGFuaW1hdGVkIG91dCBvZiBzeW5jIHdpdGggYW55IGVsZW1lbnRzIGFuaW1hdGVkIGltbWVkaWF0ZWx5IHRoZXJlYWZ0ZXIuIEluIHNob3J0LCB3ZSBpZ25vcmVcblx0XHRcdCB0aGUgZmlyc3QgUkFGIHRpY2sgcGFzcyBzbyB0aGF0IGVsZW1lbnRzIGJlaW5nIGltbWVkaWF0ZWx5IGNvbnNlY3V0aXZlbHkgYW5pbWF0ZWQgLS0gaW5zdGVhZCBvZiBzaW11bHRhbmVvdXNseSBhbmltYXRlZFxuXHRcdFx0IGJ5IHRoZSBzYW1lIFZlbG9jaXR5IGNhbGwgLS0gYXJlIHByb3Blcmx5IGJhdGNoZWQgaW50byB0aGUgc2FtZSBpbml0aWFsIFJBRiB0aWNrIGFuZCBjb25zZXF1ZW50bHkgcmVtYWluIGluIHN5bmMgdGhlcmVhZnRlci4gKi9cblx0XHRcdGlmICh0aW1lc3RhbXApIHtcblx0XHRcdFx0LyogV2UgaWdub3JlIFJBRidzIGhpZ2ggcmVzb2x1dGlvbiB0aW1lc3RhbXAgc2luY2UgaXQgY2FuIGJlIHNpZ25pZmljYW50bHkgb2Zmc2V0IHdoZW4gdGhlIGJyb3dzZXIgaXNcblx0XHRcdFx0IHVuZGVyIGhpZ2ggc3RyZXNzOyB3ZSBvcHQgZm9yIGNob3BwaW5lc3Mgb3ZlciBhbGxvd2luZyB0aGUgYnJvd3NlciB0byBkcm9wIGh1Z2UgY2h1bmtzIG9mIGZyYW1lcy4gKi9cblx0XHRcdFx0dmFyIHRpbWVDdXJyZW50ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcblxuXHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IENhbGwgSXRlcmF0aW9uXG5cdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHR2YXIgY2FsbHNMZW5ndGggPSBWZWxvY2l0eS5TdGF0ZS5jYWxscy5sZW5ndGg7XG5cblx0XHRcdFx0LyogVG8gc3BlZWQgdXAgaXRlcmF0aW5nIG92ZXIgdGhpcyBhcnJheSwgaXQgaXMgY29tcGFjdGVkIChmYWxzZXkgaXRlbXMgLS0gY2FsbHMgdGhhdCBoYXZlIGNvbXBsZXRlZCAtLSBhcmUgcmVtb3ZlZClcblx0XHRcdFx0IHdoZW4gaXRzIGxlbmd0aCBoYXMgYmFsbG9vbmVkIHRvIGEgcG9pbnQgdGhhdCBjYW4gaW1wYWN0IHRpY2sgcGVyZm9ybWFuY2UuIFRoaXMgb25seSBiZWNvbWVzIG5lY2Vzc2FyeSB3aGVuIGFuaW1hdGlvblxuXHRcdFx0XHQgaGFzIGJlZW4gY29udGludW91cyB3aXRoIG1hbnkgZWxlbWVudHMgb3ZlciBhIGxvbmcgcGVyaW9kIG9mIHRpbWU7IHdoZW5ldmVyIGFsbCBhY3RpdmUgY2FsbHMgYXJlIGNvbXBsZXRlZCwgY29tcGxldGVDYWxsKCkgY2xlYXJzIFZlbG9jaXR5LlN0YXRlLmNhbGxzLiAqL1xuXHRcdFx0XHRpZiAoY2FsbHNMZW5ndGggPiAxMDAwMCkge1xuXHRcdFx0XHRcdFZlbG9jaXR5LlN0YXRlLmNhbGxzID0gY29tcGFjdFNwYXJzZUFycmF5KFZlbG9jaXR5LlN0YXRlLmNhbGxzKTtcblx0XHRcdFx0XHRjYWxsc0xlbmd0aCA9IFZlbG9jaXR5LlN0YXRlLmNhbGxzLmxlbmd0aDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGFjdGl2ZSBjYWxsLiAqL1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNhbGxzTGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHQvKiBXaGVuIGEgVmVsb2NpdHkgY2FsbCBpcyBjb21wbGV0ZWQsIGl0cyBWZWxvY2l0eS5TdGF0ZS5jYWxscyBlbnRyeSBpcyBzZXQgdG8gZmFsc2UuIENvbnRpbnVlIG9uIHRvIHRoZSBuZXh0IGNhbGwuICovXG5cdFx0XHRcdFx0aWYgKCFWZWxvY2l0eS5TdGF0ZS5jYWxsc1tpXSkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdCBDYWxsLVdpZGUgVmFyaWFibGVzXG5cdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdHZhciBjYWxsQ29udGFpbmVyID0gVmVsb2NpdHkuU3RhdGUuY2FsbHNbaV0sXG5cdFx0XHRcdFx0XHRcdGNhbGwgPSBjYWxsQ29udGFpbmVyWzBdLFxuXHRcdFx0XHRcdFx0XHRvcHRzID0gY2FsbENvbnRhaW5lclsyXSxcblx0XHRcdFx0XHRcdFx0dGltZVN0YXJ0ID0gY2FsbENvbnRhaW5lclszXSxcblx0XHRcdFx0XHRcdFx0Zmlyc3RUaWNrID0gISF0aW1lU3RhcnQsXG5cdFx0XHRcdFx0XHRcdHR3ZWVuRHVtbXlWYWx1ZSA9IG51bGw7XG5cblx0XHRcdFx0XHQvKiBJZiB0aW1lU3RhcnQgaXMgdW5kZWZpbmVkLCB0aGVuIHRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgdGhhdCB0aGlzIGNhbGwgaGFzIGJlZW4gcHJvY2Vzc2VkIGJ5IHRpY2soKS5cblx0XHRcdFx0XHQgV2UgYXNzaWduIHRpbWVTdGFydCBub3cgc28gdGhhdCBpdHMgdmFsdWUgaXMgYXMgY2xvc2UgdG8gdGhlIHJlYWwgYW5pbWF0aW9uIHN0YXJ0IHRpbWUgYXMgcG9zc2libGUuXG5cdFx0XHRcdFx0IChDb252ZXJzZWx5LCBoYWQgdGltZVN0YXJ0IGJlZW4gZGVmaW5lZCB3aGVuIHRoaXMgY2FsbCB3YXMgYWRkZWQgdG8gVmVsb2NpdHkuU3RhdGUuY2FsbHMsIHRoZSBkZWxheVxuXHRcdFx0XHRcdCBiZXR3ZWVuIHRoYXQgdGltZSBhbmQgbm93IHdvdWxkIGNhdXNlIHRoZSBmaXJzdCBmZXcgZnJhbWVzIG9mIHRoZSB0d2VlbiB0byBiZSBza2lwcGVkIHNpbmNlXG5cdFx0XHRcdFx0IHBlcmNlbnRDb21wbGV0ZSBpcyBjYWxjdWxhdGVkIHJlbGF0aXZlIHRvIHRpbWVTdGFydC4pICovXG5cdFx0XHRcdFx0LyogRnVydGhlciwgc3VidHJhY3QgMTZtcyAodGhlIGFwcHJveGltYXRlIHJlc29sdXRpb24gb2YgUkFGKSBmcm9tIHRoZSBjdXJyZW50IHRpbWUgdmFsdWUgc28gdGhhdCB0aGVcblx0XHRcdFx0XHQgZmlyc3QgdGljayBpdGVyYXRpb24gaXNuJ3Qgd2FzdGVkIGJ5IGFuaW1hdGluZyBhdCAwJSB0d2VlbiBjb21wbGV0aW9uLCB3aGljaCB3b3VsZCBwcm9kdWNlIHRoZVxuXHRcdFx0XHRcdCBzYW1lIHN0eWxlIHZhbHVlIGFzIHRoZSBlbGVtZW50J3MgY3VycmVudCB2YWx1ZS4gKi9cblx0XHRcdFx0XHRpZiAoIXRpbWVTdGFydCkge1xuXHRcdFx0XHRcdFx0dGltZVN0YXJ0ID0gVmVsb2NpdHkuU3RhdGUuY2FsbHNbaV1bM10gPSB0aW1lQ3VycmVudCAtIDE2O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIFRoZSB0d2VlbidzIGNvbXBsZXRpb24gcGVyY2VudGFnZSBpcyByZWxhdGl2ZSB0byB0aGUgdHdlZW4ncyBzdGFydCB0aW1lLCBub3QgdGhlIHR3ZWVuJ3Mgc3RhcnQgdmFsdWVcblx0XHRcdFx0XHQgKHdoaWNoIHdvdWxkIHJlc3VsdCBpbiB1bnByZWRpY3RhYmxlIHR3ZWVuIGR1cmF0aW9ucyBzaW5jZSBKYXZhU2NyaXB0J3MgdGltZXJzIGFyZSBub3QgcGFydGljdWxhcmx5IGFjY3VyYXRlKS5cblx0XHRcdFx0XHQgQWNjb3JkaW5nbHksIHdlIGVuc3VyZSB0aGF0IHBlcmNlbnRDb21wbGV0ZSBkb2VzIG5vdCBleGNlZWQgMS4gKi9cblx0XHRcdFx0XHR2YXIgcGVyY2VudENvbXBsZXRlID0gTWF0aC5taW4oKHRpbWVDdXJyZW50IC0gdGltZVN0YXJ0KSAvIG9wdHMuZHVyYXRpb24sIDEpO1xuXG5cdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHQgRWxlbWVudCBJdGVyYXRpb25cblx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdC8qIEZvciBldmVyeSBjYWxsLCBpdGVyYXRlIHRocm91Z2ggZWFjaCBvZiB0aGUgZWxlbWVudHMgaW4gaXRzIHNldC4gKi9cblx0XHRcdFx0XHRmb3IgKHZhciBqID0gMCwgY2FsbExlbmd0aCA9IGNhbGwubGVuZ3RoOyBqIDwgY2FsbExlbmd0aDsgaisrKSB7XG5cdFx0XHRcdFx0XHR2YXIgdHdlZW5zQ29udGFpbmVyID0gY2FsbFtqXSxcblx0XHRcdFx0XHRcdFx0XHRlbGVtZW50ID0gdHdlZW5zQ29udGFpbmVyLmVsZW1lbnQ7XG5cblx0XHRcdFx0XHRcdC8qIENoZWNrIHRvIHNlZSBpZiB0aGlzIGVsZW1lbnQgaGFzIGJlZW4gZGVsZXRlZCBtaWR3YXkgdGhyb3VnaCB0aGUgYW5pbWF0aW9uIGJ5IGNoZWNraW5nIGZvciB0aGVcblx0XHRcdFx0XHRcdCBjb250aW51ZWQgZXhpc3RlbmNlIG9mIGl0cyBkYXRhIGNhY2hlLiBJZiBpdCdzIGdvbmUsIHNraXAgYW5pbWF0aW5nIHRoaXMgZWxlbWVudC4gKi9cblx0XHRcdFx0XHRcdGlmICghRGF0YShlbGVtZW50KSkge1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0dmFyIHRyYW5zZm9ybVByb3BlcnR5RXhpc3RzID0gZmFsc2U7XG5cblx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHQgRGlzcGxheSAmIFZpc2liaWxpdHkgVG9nZ2xpbmdcblx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0XHQvKiBJZiB0aGUgZGlzcGxheSBvcHRpb24gaXMgc2V0IHRvIG5vbi1cIm5vbmVcIiwgc2V0IGl0IHVwZnJvbnQgc28gdGhhdCB0aGUgZWxlbWVudCBjYW4gYmVjb21lIHZpc2libGUgYmVmb3JlIHR3ZWVuaW5nIGJlZ2lucy5cblx0XHRcdFx0XHRcdCAoT3RoZXJ3aXNlLCBkaXNwbGF5J3MgXCJub25lXCIgdmFsdWUgaXMgc2V0IGluIGNvbXBsZXRlQ2FsbCgpIG9uY2UgdGhlIGFuaW1hdGlvbiBoYXMgY29tcGxldGVkLikgKi9cblx0XHRcdFx0XHRcdGlmIChvcHRzLmRpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiBvcHRzLmRpc3BsYXkgIT09IG51bGwgJiYgb3B0cy5kaXNwbGF5ICE9PSBcIm5vbmVcIikge1xuXHRcdFx0XHRcdFx0XHRpZiAob3B0cy5kaXNwbGF5ID09PSBcImZsZXhcIikge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBmbGV4VmFsdWVzID0gW1wiLXdlYmtpdC1ib3hcIiwgXCItbW96LWJveFwiLCBcIi1tcy1mbGV4Ym94XCIsIFwiLXdlYmtpdC1mbGV4XCJdO1xuXG5cdFx0XHRcdFx0XHRcdFx0JC5lYWNoKGZsZXhWYWx1ZXMsIGZ1bmN0aW9uKGksIGZsZXhWYWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Q1NTLnNldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJkaXNwbGF5XCIsIGZsZXhWYWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRDU1Muc2V0UHJvcGVydHlWYWx1ZShlbGVtZW50LCBcImRpc3BsYXlcIiwgb3B0cy5kaXNwbGF5KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogU2FtZSBnb2VzIHdpdGggdGhlIHZpc2liaWxpdHkgb3B0aW9uLCBidXQgaXRzIFwibm9uZVwiIGVxdWl2YWxlbnQgaXMgXCJoaWRkZW5cIi4gKi9cblx0XHRcdFx0XHRcdGlmIChvcHRzLnZpc2liaWxpdHkgIT09IHVuZGVmaW5lZCAmJiBvcHRzLnZpc2liaWxpdHkgIT09IFwiaGlkZGVuXCIpIHtcblx0XHRcdFx0XHRcdFx0Q1NTLnNldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJ2aXNpYmlsaXR5XCIsIG9wdHMudmlzaWJpbGl0eSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdCBQcm9wZXJ0eSBJdGVyYXRpb25cblx0XHRcdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdC8qIEZvciBldmVyeSBlbGVtZW50LCBpdGVyYXRlIHRocm91Z2ggZWFjaCBwcm9wZXJ0eS4gKi9cblx0XHRcdFx0XHRcdGZvciAodmFyIHByb3BlcnR5IGluIHR3ZWVuc0NvbnRhaW5lcikge1xuXHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBJbiBhZGRpdGlvbiB0byBwcm9wZXJ0eSB0d2VlbiBkYXRhLCB0d2VlbnNDb250YWluZXIgY29udGFpbnMgYSByZWZlcmVuY2UgdG8gaXRzIGFzc29jaWF0ZWQgZWxlbWVudC4gKi9cblx0XHRcdFx0XHRcdFx0aWYgKHR3ZWVuc0NvbnRhaW5lci5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkgJiYgcHJvcGVydHkgIT09IFwiZWxlbWVudFwiKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHR3ZWVuID0gdHdlZW5zQ29udGFpbmVyW3Byb3BlcnR5XSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y3VycmVudFZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBFYXNpbmcgY2FuIGVpdGhlciBiZSBhIHByZS1nZW5lcmVhdGVkIGZ1bmN0aW9uIG9yIGEgc3RyaW5nIHRoYXQgcmVmZXJlbmNlcyBhIHByZS1yZWdpc3RlcmVkIGVhc2luZ1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQgb24gdGhlIFZlbG9jaXR5LkVhc2luZ3Mgb2JqZWN0LiBJbiBlaXRoZXIgY2FzZSwgcmV0dXJuIHRoZSBhcHByb3ByaWF0ZSBlYXNpbmcgKmZ1bmN0aW9uKi4gKi9cblx0XHRcdFx0XHRcdFx0XHRcdFx0ZWFzaW5nID0gVHlwZS5pc1N0cmluZyh0d2Vlbi5lYXNpbmcpID8gVmVsb2NpdHkuRWFzaW5nc1t0d2Vlbi5lYXNpbmddIDogdHdlZW4uZWFzaW5nO1xuXG5cdFx0XHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0XHRcdCBDdXJyZW50IFZhbHVlIENhbGN1bGF0aW9uXG5cdFx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHRcdC8qIElmIHRoaXMgaXMgdGhlIGxhc3QgdGljayBwYXNzIChpZiB3ZSd2ZSByZWFjaGVkIDEwMCUgY29tcGxldGlvbiBmb3IgdGhpcyB0d2VlbiksXG5cdFx0XHRcdFx0XHRcdFx0IGVuc3VyZSB0aGF0IGN1cnJlbnRWYWx1ZSBpcyBleHBsaWNpdGx5IHNldCB0byBpdHMgdGFyZ2V0IGVuZFZhbHVlIHNvIHRoYXQgaXQncyBub3Qgc3ViamVjdGVkIHRvIGFueSByb3VuZGluZy4gKi9cblx0XHRcdFx0XHRcdFx0XHRpZiAocGVyY2VudENvbXBsZXRlID09PSAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRjdXJyZW50VmFsdWUgPSB0d2Vlbi5lbmRWYWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdC8qIE90aGVyd2lzZSwgY2FsY3VsYXRlIGN1cnJlbnRWYWx1ZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkZWx0YSBmcm9tIHN0YXJ0VmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciB0d2VlbkRlbHRhID0gdHdlZW4uZW5kVmFsdWUgLSB0d2Vlbi5zdGFydFZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0Y3VycmVudFZhbHVlID0gdHdlZW4uc3RhcnRWYWx1ZSArICh0d2VlbkRlbHRhICogZWFzaW5nKHBlcmNlbnRDb21wbGV0ZSwgb3B0cywgdHdlZW5EZWx0YSkpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBJZiBubyB2YWx1ZSBjaGFuZ2UgaXMgb2NjdXJyaW5nLCBkb24ndCBwcm9jZWVkIHdpdGggRE9NIHVwZGF0aW5nLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCFmaXJzdFRpY2sgJiYgKGN1cnJlbnRWYWx1ZSA9PT0gdHdlZW4uY3VycmVudFZhbHVlKSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHR0d2Vlbi5jdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWU7XG5cblx0XHRcdFx0XHRcdFx0XHQvKiBJZiB3ZSdyZSB0d2VlbmluZyBhIGZha2UgJ3R3ZWVuJyBwcm9wZXJ0eSBpbiBvcmRlciB0byBsb2cgdHJhbnNpdGlvbiB2YWx1ZXMsIHVwZGF0ZSB0aGUgb25lLXBlci1jYWxsIHZhcmlhYmxlIHNvIHRoYXRcblx0XHRcdFx0XHRcdFx0XHQgaXQgY2FuIGJlIHBhc3NlZCBpbnRvIHRoZSBwcm9ncmVzcyBjYWxsYmFjay4gKi9cblx0XHRcdFx0XHRcdFx0XHRpZiAocHJvcGVydHkgPT09IFwidHdlZW5cIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0dHdlZW5EdW1teVZhbHVlID0gY3VycmVudFZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdFx0XHRcdFx0XHQgSG9va3M6IFBhcnQgSVxuXHRcdFx0XHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKioqKi9cblx0XHRcdFx0XHRcdFx0XHRcdHZhciBob29rUm9vdDtcblxuXHRcdFx0XHRcdFx0XHRcdFx0LyogRm9yIGhvb2tlZCBwcm9wZXJ0aWVzLCB0aGUgbmV3bHktdXBkYXRlZCByb290UHJvcGVydHlWYWx1ZUNhY2hlIGlzIGNhY2hlZCBvbnRvIHRoZSBlbGVtZW50IHNvIHRoYXQgaXQgY2FuIGJlIHVzZWRcblx0XHRcdFx0XHRcdFx0XHRcdCBmb3Igc3Vic2VxdWVudCBob29rcyBpbiB0aGlzIGNhbGwgdGhhdCBhcmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBzYW1lIHJvb3QgcHJvcGVydHkuIElmIHdlIGRpZG4ndCBjYWNoZSB0aGUgdXBkYXRlZFxuXHRcdFx0XHRcdFx0XHRcdFx0IHJvb3RQcm9wZXJ0eVZhbHVlLCBlYWNoIHN1YnNlcXVlbnQgdXBkYXRlIHRvIHRoZSByb290IHByb3BlcnR5IGluIHRoaXMgdGljayBwYXNzIHdvdWxkIHJlc2V0IHRoZSBwcmV2aW91cyBob29rJ3Ncblx0XHRcdFx0XHRcdFx0XHRcdCB1cGRhdGVzIHRvIHJvb3RQcm9wZXJ0eVZhbHVlIHByaW9yIHRvIGluamVjdGlvbi4gQSBuaWNlIHBlcmZvcm1hbmNlIGJ5cHJvZHVjdCBvZiByb290UHJvcGVydHlWYWx1ZSBjYWNoaW5nIGlzIHRoYXRcblx0XHRcdFx0XHRcdFx0XHRcdCBzdWJzZXF1ZW50bHkgY2hhaW5lZCBhbmltYXRpb25zIHVzaW5nIHRoZSBzYW1lIGhvb2tSb290IGJ1dCBhIGRpZmZlcmVudCBob29rIGNhbiB1c2UgdGhpcyBjYWNoZWQgcm9vdFByb3BlcnR5VmFsdWUuICovXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoQ1NTLkhvb2tzLnJlZ2lzdGVyZWRbcHJvcGVydHldKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGhvb2tSb290ID0gQ1NTLkhvb2tzLmdldFJvb3QocHJvcGVydHkpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciByb290UHJvcGVydHlWYWx1ZUNhY2hlID0gRGF0YShlbGVtZW50KS5yb290UHJvcGVydHlWYWx1ZUNhY2hlW2hvb2tSb290XTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocm9vdFByb3BlcnR5VmFsdWVDYWNoZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHR3ZWVuLnJvb3RQcm9wZXJ0eVZhbHVlID0gcm9vdFByb3BlcnR5VmFsdWVDYWNoZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0XHRcdCBET00gVXBkYXRlXG5cdFx0XHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qIHNldFByb3BlcnR5VmFsdWUoKSByZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBwcm9wZXJ0eSBuYW1lIGFuZCBwcm9wZXJ0eSB2YWx1ZSBwb3N0IGFueSBub3JtYWxpemF0aW9uIHRoYXQgbWF5IGhhdmUgYmVlbiBwZXJmb3JtZWQuICovXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBOb3RlOiBUbyBzb2x2ZSBhbiBJRTw9OCBwb3NpdGlvbmluZyBidWcsIHRoZSB1bml0IHR5cGUgaXMgZHJvcHBlZCB3aGVuIHNldHRpbmcgYSBwcm9wZXJ0eSB2YWx1ZSBvZiAwLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGFkanVzdGVkU2V0RGF0YSA9IENTUy5zZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQsIC8qIFNFVCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHByb3BlcnR5LFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHR3ZWVuLmN1cnJlbnRWYWx1ZSArIChwYXJzZUZsb2F0KGN1cnJlbnRWYWx1ZSkgPT09IDAgPyBcIlwiIDogdHdlZW4udW5pdFR5cGUpLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHR3ZWVuLnJvb3RQcm9wZXJ0eVZhbHVlLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHR3ZWVuLnNjcm9sbERhdGEpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHRcdFx0XHRcdFx0IEhvb2tzOiBQYXJ0IElJXG5cdFx0XHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRcdFx0XHRcdFx0LyogTm93IHRoYXQgd2UgaGF2ZSB0aGUgaG9vaydzIHVwZGF0ZWQgcm9vdFByb3BlcnR5VmFsdWUgKHRoZSBwb3N0LXByb2Nlc3NlZCB2YWx1ZSBwcm92aWRlZCBieSBhZGp1c3RlZFNldERhdGEpLCBjYWNoZSBpdCBvbnRvIHRoZSBlbGVtZW50LiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKENTUy5Ib29rcy5yZWdpc3RlcmVkW3Byb3BlcnR5XSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvKiBTaW5jZSBhZGp1c3RlZFNldERhdGEgY29udGFpbnMgbm9ybWFsaXplZCBkYXRhIHJlYWR5IGZvciBET00gdXBkYXRpbmcsIHRoZSByb290UHJvcGVydHlWYWx1ZSBuZWVkcyB0byBiZSByZS1leHRyYWN0ZWQgZnJvbSBpdHMgbm9ybWFsaXplZCBmb3JtLiA/PyAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoQ1NTLk5vcm1hbGl6YXRpb25zLnJlZ2lzdGVyZWRbaG9va1Jvb3RdKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0RGF0YShlbGVtZW50KS5yb290UHJvcGVydHlWYWx1ZUNhY2hlW2hvb2tSb290XSA9IENTUy5Ob3JtYWxpemF0aW9ucy5yZWdpc3RlcmVkW2hvb2tSb290XShcImV4dHJhY3RcIiwgbnVsbCwgYWRqdXN0ZWRTZXREYXRhWzFdKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHREYXRhKGVsZW1lbnQpLnJvb3RQcm9wZXJ0eVZhbHVlQ2FjaGVbaG9va1Jvb3RdID0gYWRqdXN0ZWRTZXREYXRhWzFdO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8qKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdFx0XHRcdCBUcmFuc2Zvcm1zXG5cdFx0XHRcdFx0XHRcdFx0XHQgKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQvKiBGbGFnIHdoZXRoZXIgYSB0cmFuc2Zvcm0gcHJvcGVydHkgaXMgYmVpbmcgYW5pbWF0ZWQgc28gdGhhdCBmbHVzaFRyYW5zZm9ybUNhY2hlKCkgY2FuIGJlIHRyaWdnZXJlZCBvbmNlIHRoaXMgdGljayBwYXNzIGlzIGNvbXBsZXRlLiAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGFkanVzdGVkU2V0RGF0YVswXSA9PT0gXCJ0cmFuc2Zvcm1cIikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0cmFuc2Zvcm1Qcm9wZXJ0eUV4aXN0cyA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyoqKioqKioqKioqKioqKipcblx0XHRcdFx0XHRcdCBtb2JpbGVIQVxuXHRcdFx0XHRcdFx0ICoqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0XHRcdC8qIElmIG1vYmlsZUhBIGlzIGVuYWJsZWQsIHNldCB0aGUgdHJhbnNsYXRlM2QgdHJhbnNmb3JtIHRvIG51bGwgdG8gZm9yY2UgaGFyZHdhcmUgYWNjZWxlcmF0aW9uLlxuXHRcdFx0XHRcdFx0IEl0J3Mgc2FmZSB0byBvdmVycmlkZSB0aGlzIHByb3BlcnR5IHNpbmNlIFZlbG9jaXR5IGRvZXNuJ3QgYWN0dWFsbHkgc3VwcG9ydCBpdHMgYW5pbWF0aW9uIChob29rcyBhcmUgdXNlZCBpbiBpdHMgcGxhY2UpLiAqL1xuXHRcdFx0XHRcdFx0aWYgKG9wdHMubW9iaWxlSEEpIHtcblx0XHRcdFx0XHRcdFx0LyogRG9uJ3Qgc2V0IHRoZSBudWxsIHRyYW5zZm9ybSBoYWNrIGlmIHdlJ3ZlIGFscmVhZHkgZG9uZSBzby4gKi9cblx0XHRcdFx0XHRcdFx0aWYgKERhdGEoZWxlbWVudCkudHJhbnNmb3JtQ2FjaGUudHJhbnNsYXRlM2QgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0XHRcdC8qIEFsbCBlbnRyaWVzIG9uIHRoZSB0cmFuc2Zvcm1DYWNoZSBvYmplY3QgYXJlIGxhdGVyIGNvbmNhdGVuYXRlZCBpbnRvIGEgc2luZ2xlIHRyYW5zZm9ybSBzdHJpbmcgdmlhIGZsdXNoVHJhbnNmb3JtQ2FjaGUoKS4gKi9cblx0XHRcdFx0XHRcdFx0XHREYXRhKGVsZW1lbnQpLnRyYW5zZm9ybUNhY2hlLnRyYW5zbGF0ZTNkID0gXCIoMHB4LCAwcHgsIDBweClcIjtcblxuXHRcdFx0XHRcdFx0XHRcdHRyYW5zZm9ybVByb3BlcnR5RXhpc3RzID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAodHJhbnNmb3JtUHJvcGVydHlFeGlzdHMpIHtcblx0XHRcdFx0XHRcdFx0Q1NTLmZsdXNoVHJhbnNmb3JtQ2FjaGUoZWxlbWVudCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0LyogVGhlIG5vbi1cIm5vbmVcIiBkaXNwbGF5IHZhbHVlIGlzIG9ubHkgYXBwbGllZCB0byBhbiBlbGVtZW50IG9uY2UgLS0gd2hlbiBpdHMgYXNzb2NpYXRlZCBjYWxsIGlzIGZpcnN0IHRpY2tlZCB0aHJvdWdoLlxuXHRcdFx0XHRcdCBBY2NvcmRpbmdseSwgaXQncyBzZXQgdG8gZmFsc2Ugc28gdGhhdCBpdCBpc24ndCByZS1wcm9jZXNzZWQgYnkgdGhpcyBjYWxsIGluIHRoZSBuZXh0IHRpY2suICovXG5cdFx0XHRcdFx0aWYgKG9wdHMuZGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIG9wdHMuZGlzcGxheSAhPT0gXCJub25lXCIpIHtcblx0XHRcdFx0XHRcdFZlbG9jaXR5LlN0YXRlLmNhbGxzW2ldWzJdLmRpc3BsYXkgPSBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKG9wdHMudmlzaWJpbGl0eSAhPT0gdW5kZWZpbmVkICYmIG9wdHMudmlzaWJpbGl0eSAhPT0gXCJoaWRkZW5cIikge1xuXHRcdFx0XHRcdFx0VmVsb2NpdHkuU3RhdGUuY2FsbHNbaV1bMl0udmlzaWJpbGl0eSA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIFBhc3MgdGhlIGVsZW1lbnRzIGFuZCB0aGUgdGltaW5nIGRhdGEgKHBlcmNlbnRDb21wbGV0ZSwgbXNSZW1haW5pbmcsIHRpbWVTdGFydCwgdHdlZW5EdW1teVZhbHVlKSBpbnRvIHRoZSBwcm9ncmVzcyBjYWxsYmFjay4gKi9cblx0XHRcdFx0XHRpZiAob3B0cy5wcm9ncmVzcykge1xuXHRcdFx0XHRcdFx0b3B0cy5wcm9ncmVzcy5jYWxsKGNhbGxDb250YWluZXJbMV0sXG5cdFx0XHRcdFx0XHRcdFx0Y2FsbENvbnRhaW5lclsxXSxcblx0XHRcdFx0XHRcdFx0XHRwZXJjZW50Q29tcGxldGUsXG5cdFx0XHRcdFx0XHRcdFx0TWF0aC5tYXgoMCwgKHRpbWVTdGFydCArIG9wdHMuZHVyYXRpb24pIC0gdGltZUN1cnJlbnQpLFxuXHRcdFx0XHRcdFx0XHRcdHRpbWVTdGFydCxcblx0XHRcdFx0XHRcdFx0XHR0d2VlbkR1bW15VmFsdWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIElmIHRoaXMgY2FsbCBoYXMgZmluaXNoZWQgdHdlZW5pbmcsIHBhc3MgaXRzIGluZGV4IHRvIGNvbXBsZXRlQ2FsbCgpIHRvIGhhbmRsZSBjYWxsIGNsZWFudXAuICovXG5cdFx0XHRcdFx0aWYgKHBlcmNlbnRDb21wbGV0ZSA9PT0gMSkge1xuXHRcdFx0XHRcdFx0Y29tcGxldGVDYWxsKGkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvKiBOb3RlOiBjb21wbGV0ZUNhbGwoKSBzZXRzIHRoZSBpc1RpY2tpbmcgZmxhZyB0byBmYWxzZSB3aGVuIHRoZSBsYXN0IGNhbGwgb24gVmVsb2NpdHkuU3RhdGUuY2FsbHMgaGFzIGNvbXBsZXRlZC4gKi9cblx0XHRcdGlmIChWZWxvY2l0eS5TdGF0ZS5pc1RpY2tpbmcpIHtcblx0XHRcdFx0dGlja2VyKHRpY2spO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKioqKioqKioqKioqKioqKioqKioqXG5cdFx0IENhbGwgQ29tcGxldGlvblxuXHRcdCAqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0LyogTm90ZTogVW5saWtlIHRpY2soKSwgd2hpY2ggcHJvY2Vzc2VzIGFsbCBhY3RpdmUgY2FsbHMgYXQgb25jZSwgY2FsbCBjb21wbGV0aW9uIGlzIGhhbmRsZWQgb24gYSBwZXItY2FsbCBiYXNpcy4gKi9cblx0XHRmdW5jdGlvbiBjb21wbGV0ZUNhbGwoY2FsbEluZGV4LCBpc1N0b3BwZWQpIHtcblx0XHRcdC8qIEVuc3VyZSB0aGUgY2FsbCBleGlzdHMuICovXG5cdFx0XHRpZiAoIVZlbG9jaXR5LlN0YXRlLmNhbGxzW2NhbGxJbmRleF0pIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiBQdWxsIHRoZSBtZXRhZGF0YSBmcm9tIHRoZSBjYWxsLiAqL1xuXHRcdFx0dmFyIGNhbGwgPSBWZWxvY2l0eS5TdGF0ZS5jYWxsc1tjYWxsSW5kZXhdWzBdLFxuXHRcdFx0XHRcdGVsZW1lbnRzID0gVmVsb2NpdHkuU3RhdGUuY2FsbHNbY2FsbEluZGV4XVsxXSxcblx0XHRcdFx0XHRvcHRzID0gVmVsb2NpdHkuU3RhdGUuY2FsbHNbY2FsbEluZGV4XVsyXSxcblx0XHRcdFx0XHRyZXNvbHZlciA9IFZlbG9jaXR5LlN0YXRlLmNhbGxzW2NhbGxJbmRleF1bNF07XG5cblx0XHRcdHZhciByZW1haW5pbmdDYWxsc0V4aXN0ID0gZmFsc2U7XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHQgRWxlbWVudCBGaW5hbGl6YXRpb25cblx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRmb3IgKHZhciBpID0gMCwgY2FsbExlbmd0aCA9IGNhbGwubGVuZ3RoOyBpIDwgY2FsbExlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHZhciBlbGVtZW50ID0gY2FsbFtpXS5lbGVtZW50O1xuXG5cdFx0XHRcdC8qIElmIHRoZSB1c2VyIHNldCBkaXNwbGF5IHRvIFwibm9uZVwiIChpbnRlbmRpbmcgdG8gaGlkZSB0aGUgZWxlbWVudCksIHNldCBpdCBub3cgdGhhdCB0aGUgYW5pbWF0aW9uIGhhcyBjb21wbGV0ZWQuICovXG5cdFx0XHRcdC8qIE5vdGU6IGRpc3BsYXk6bm9uZSBpc24ndCBzZXQgd2hlbiBjYWxscyBhcmUgbWFudWFsbHkgc3RvcHBlZCAodmlhIFZlbG9jaXR5KFwic3RvcFwiKS4gKi9cblx0XHRcdFx0LyogTm90ZTogRGlzcGxheSBnZXRzIGlnbm9yZWQgd2l0aCBcInJldmVyc2VcIiBjYWxscyBhbmQgaW5maW5pdGUgbG9vcHMsIHNpbmNlIHRoaXMgYmVoYXZpb3Igd291bGQgYmUgdW5kZXNpcmFibGUuICovXG5cdFx0XHRcdGlmICghaXNTdG9wcGVkICYmICFvcHRzLmxvb3ApIHtcblx0XHRcdFx0XHRpZiAob3B0cy5kaXNwbGF5ID09PSBcIm5vbmVcIikge1xuXHRcdFx0XHRcdFx0Q1NTLnNldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJkaXNwbGF5XCIsIG9wdHMuZGlzcGxheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKG9wdHMudmlzaWJpbGl0eSA9PT0gXCJoaWRkZW5cIikge1xuXHRcdFx0XHRcdFx0Q1NTLnNldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgXCJ2aXNpYmlsaXR5XCIsIG9wdHMudmlzaWJpbGl0eSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyogSWYgdGhlIGVsZW1lbnQncyBxdWV1ZSBpcyBlbXB0eSAoaWYgb25seSB0aGUgXCJpbnByb2dyZXNzXCIgaXRlbSBpcyBsZWZ0IGF0IHBvc2l0aW9uIDApIG9yIGlmIGl0cyBxdWV1ZSBpcyBhYm91dCB0byBydW5cblx0XHRcdFx0IGEgbm9uLVZlbG9jaXR5LWluaXRpYXRlZCBlbnRyeSwgdHVybiBvZmYgdGhlIGlzQW5pbWF0aW5nIGZsYWcuIEEgbm9uLVZlbG9jaXR5LWluaXRpYXRpZWQgcXVldWUgZW50cnkncyBsb2dpYyBtaWdodCBhbHRlclxuXHRcdFx0XHQgYW4gZWxlbWVudCdzIENTUyB2YWx1ZXMgYW5kIHRoZXJlYnkgY2F1c2UgVmVsb2NpdHkncyBjYWNoZWQgdmFsdWUgZGF0YSB0byBnbyBzdGFsZS4gVG8gZGV0ZWN0IGlmIGEgcXVldWUgZW50cnkgd2FzIGluaXRpYXRlZCBieSBWZWxvY2l0eSxcblx0XHRcdFx0IHdlIGNoZWNrIGZvciB0aGUgZXhpc3RlbmNlIG9mIG91ciBzcGVjaWFsIFZlbG9jaXR5LnF1ZXVlRW50cnlGbGFnIGRlY2xhcmF0aW9uLCB3aGljaCBtaW5pZmllcnMgd29uJ3QgcmVuYW1lIHNpbmNlIHRoZSBmbGFnXG5cdFx0XHRcdCBpcyBhc3NpZ25lZCB0byBqUXVlcnkncyBnbG9iYWwgJCBvYmplY3QgYW5kIHRodXMgZXhpc3RzIG91dCBvZiBWZWxvY2l0eSdzIG93biBzY29wZS4gKi9cblx0XHRcdFx0dmFyIGRhdGEgPSBEYXRhKGVsZW1lbnQpO1xuXG5cdFx0XHRcdGlmIChvcHRzLmxvb3AgIT09IHRydWUgJiYgKCQucXVldWUoZWxlbWVudClbMV0gPT09IHVuZGVmaW5lZCB8fCAhL1xcLnZlbG9jaXR5UXVldWVFbnRyeUZsYWcvaS50ZXN0KCQucXVldWUoZWxlbWVudClbMV0pKSkge1xuXHRcdFx0XHRcdC8qIFRoZSBlbGVtZW50IG1heSBoYXZlIGJlZW4gZGVsZXRlZC4gRW5zdXJlIHRoYXQgaXRzIGRhdGEgY2FjaGUgc3RpbGwgZXhpc3RzIGJlZm9yZSBhY3Rpbmcgb24gaXQuICovXG5cdFx0XHRcdFx0aWYgKGRhdGEpIHtcblx0XHRcdFx0XHRcdGRhdGEuaXNBbmltYXRpbmcgPSBmYWxzZTtcblx0XHRcdFx0XHRcdC8qIENsZWFyIHRoZSBlbGVtZW50J3Mgcm9vdFByb3BlcnR5VmFsdWVDYWNoZSwgd2hpY2ggd2lsbCBiZWNvbWUgc3RhbGUuICovXG5cdFx0XHRcdFx0XHRkYXRhLnJvb3RQcm9wZXJ0eVZhbHVlQ2FjaGUgPSB7fTtcblxuXHRcdFx0XHRcdFx0dmFyIHRyYW5zZm9ybUhBUHJvcGVydHlFeGlzdHMgPSBmYWxzZTtcblx0XHRcdFx0XHRcdC8qIElmIGFueSAzRCB0cmFuc2Zvcm0gc3VicHJvcGVydHkgaXMgYXQgaXRzIGRlZmF1bHQgdmFsdWUgKHJlZ2FyZGxlc3Mgb2YgdW5pdCB0eXBlKSwgcmVtb3ZlIGl0LiAqL1xuXHRcdFx0XHRcdFx0JC5lYWNoKENTUy5MaXN0cy50cmFuc2Zvcm1zM0QsIGZ1bmN0aW9uKGksIHRyYW5zZm9ybU5hbWUpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGRlZmF1bHRWYWx1ZSA9IC9ec2NhbGUvLnRlc3QodHJhbnNmb3JtTmFtZSkgPyAxIDogMCxcblx0XHRcdFx0XHRcdFx0XHRcdGN1cnJlbnRWYWx1ZSA9IGRhdGEudHJhbnNmb3JtQ2FjaGVbdHJhbnNmb3JtTmFtZV07XG5cblx0XHRcdFx0XHRcdFx0aWYgKGRhdGEudHJhbnNmb3JtQ2FjaGVbdHJhbnNmb3JtTmFtZV0gIT09IHVuZGVmaW5lZCAmJiBuZXcgUmVnRXhwKFwiXlxcXFwoXCIgKyBkZWZhdWx0VmFsdWUgKyBcIlteLl1cIikudGVzdChjdXJyZW50VmFsdWUpKSB7XG5cdFx0XHRcdFx0XHRcdFx0dHJhbnNmb3JtSEFQcm9wZXJ0eUV4aXN0cyA9IHRydWU7XG5cblx0XHRcdFx0XHRcdFx0XHRkZWxldGUgZGF0YS50cmFuc2Zvcm1DYWNoZVt0cmFuc2Zvcm1OYW1lXTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdC8qIE1vYmlsZSBkZXZpY2VzIGhhdmUgaGFyZHdhcmUgYWNjZWxlcmF0aW9uIHJlbW92ZWQgYXQgdGhlIGVuZCBvZiB0aGUgYW5pbWF0aW9uIGluIG9yZGVyIHRvIGF2b2lkIGhvZ2dpbmcgdGhlIEdQVSdzIG1lbW9yeS4gKi9cblx0XHRcdFx0XHRcdGlmIChvcHRzLm1vYmlsZUhBKSB7XG5cdFx0XHRcdFx0XHRcdHRyYW5zZm9ybUhBUHJvcGVydHlFeGlzdHMgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHRkZWxldGUgZGF0YS50cmFuc2Zvcm1DYWNoZS50cmFuc2xhdGUzZDtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogRmx1c2ggdGhlIHN1YnByb3BlcnR5IHJlbW92YWxzIHRvIHRoZSBET00uICovXG5cdFx0XHRcdFx0XHRpZiAodHJhbnNmb3JtSEFQcm9wZXJ0eUV4aXN0cykge1xuXHRcdFx0XHRcdFx0XHRDU1MuZmx1c2hUcmFuc2Zvcm1DYWNoZShlbGVtZW50KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0LyogUmVtb3ZlIHRoZSBcInZlbG9jaXR5LWFuaW1hdGluZ1wiIGluZGljYXRvciBjbGFzcy4gKi9cblx0XHRcdFx0XHRcdENTUy5WYWx1ZXMucmVtb3ZlQ2xhc3MoZWxlbWVudCwgXCJ2ZWxvY2l0eS1hbmltYXRpbmdcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKlxuXHRcdFx0XHQgT3B0aW9uOiBDb21wbGV0ZVxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIENvbXBsZXRlIGlzIGZpcmVkIG9uY2UgcGVyIGNhbGwgKG5vdCBvbmNlIHBlciBlbGVtZW50KSBhbmQgaXMgcGFzc2VkIHRoZSBmdWxsIHJhdyBET00gZWxlbWVudCBzZXQgYXMgYm90aCBpdHMgY29udGV4dCBhbmQgaXRzIGZpcnN0IGFyZ3VtZW50LiAqL1xuXHRcdFx0XHQvKiBOb3RlOiBDYWxsYmFja3MgYXJlbid0IGZpcmVkIHdoZW4gY2FsbHMgYXJlIG1hbnVhbGx5IHN0b3BwZWQgKHZpYSBWZWxvY2l0eShcInN0b3BcIikuICovXG5cdFx0XHRcdGlmICghaXNTdG9wcGVkICYmIG9wdHMuY29tcGxldGUgJiYgIW9wdHMubG9vcCAmJiAoaSA9PT0gY2FsbExlbmd0aCAtIDEpKSB7XG5cdFx0XHRcdFx0LyogV2UgdGhyb3cgY2FsbGJhY2tzIGluIGEgc2V0VGltZW91dCBzbyB0aGF0IHRocm93biBlcnJvcnMgZG9uJ3QgaGFsdCB0aGUgZXhlY3V0aW9uIG9mIFZlbG9jaXR5IGl0c2VsZi4gKi9cblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0b3B0cy5jb21wbGV0ZS5jYWxsKGVsZW1lbnRzLCBlbGVtZW50cyk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdHRocm93IGVycm9yO1xuXHRcdFx0XHRcdFx0fSwgMSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0LyoqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdFx0IFByb21pc2UgUmVzb2x2aW5nXG5cdFx0XHRcdCAqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHRcdC8qIE5vdGU6IEluZmluaXRlIGxvb3BzIGRvbid0IHJldHVybiBwcm9taXNlcy4gKi9cblx0XHRcdFx0aWYgKHJlc29sdmVyICYmIG9wdHMubG9vcCAhPT0gdHJ1ZSkge1xuXHRcdFx0XHRcdHJlc29sdmVyKGVsZW1lbnRzKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFx0XHRcdCBPcHRpb246IExvb3AgKEluZmluaXRlKVxuXHRcdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXHRcdFx0XHRpZiAoZGF0YSAmJiBvcHRzLmxvb3AgPT09IHRydWUgJiYgIWlzU3RvcHBlZCkge1xuXHRcdFx0XHRcdC8qIElmIGEgcm90YXRlWC9ZL1ogcHJvcGVydHkgaXMgYmVpbmcgYW5pbWF0ZWQgYnkgMzYwIGRlZyB3aXRoIGxvb3A6dHJ1ZSwgc3dhcCB0d2VlbiBzdGFydC9lbmQgdmFsdWVzIHRvIGVuYWJsZVxuXHRcdFx0XHRcdCBjb250aW51b3VzIGl0ZXJhdGl2ZSByb3RhdGlvbiBsb29waW5nLiAoT3RoZXJpc2UsIHRoZSBlbGVtZW50IHdvdWxkIGp1c3Qgcm90YXRlIGJhY2sgYW5kIGZvcnRoLikgKi9cblx0XHRcdFx0XHQkLmVhY2goZGF0YS50d2VlbnNDb250YWluZXIsIGZ1bmN0aW9uKHByb3BlcnR5TmFtZSwgdHdlZW5Db250YWluZXIpIHtcblx0XHRcdFx0XHRcdGlmICgvXnJvdGF0ZS8udGVzdChwcm9wZXJ0eU5hbWUpICYmICgocGFyc2VGbG9hdCh0d2VlbkNvbnRhaW5lci5zdGFydFZhbHVlKSAtIHBhcnNlRmxvYXQodHdlZW5Db250YWluZXIuZW5kVmFsdWUpKSAlIDM2MCA9PT0gMCkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIG9sZFN0YXJ0VmFsdWUgPSB0d2VlbkNvbnRhaW5lci5zdGFydFZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdHR3ZWVuQ29udGFpbmVyLnN0YXJ0VmFsdWUgPSB0d2VlbkNvbnRhaW5lci5lbmRWYWx1ZTtcblx0XHRcdFx0XHRcdFx0dHdlZW5Db250YWluZXIuZW5kVmFsdWUgPSBvbGRTdGFydFZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoL15iYWNrZ3JvdW5kUG9zaXRpb24vLnRlc3QocHJvcGVydHlOYW1lKSAmJiBwYXJzZUZsb2F0KHR3ZWVuQ29udGFpbmVyLmVuZFZhbHVlKSA9PT0gMTAwICYmIHR3ZWVuQ29udGFpbmVyLnVuaXRUeXBlID09PSBcIiVcIikge1xuXHRcdFx0XHRcdFx0XHR0d2VlbkNvbnRhaW5lci5lbmRWYWx1ZSA9IDA7XG5cdFx0XHRcdFx0XHRcdHR3ZWVuQ29udGFpbmVyLnN0YXJ0VmFsdWUgPSAxMDA7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRWZWxvY2l0eShlbGVtZW50LCBcInJldmVyc2VcIiwge2xvb3A6IHRydWUsIGRlbGF5OiBvcHRzLmRlbGF5fSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKioqKioqKioqKioqKioqXG5cdFx0XHRcdCBEZXF1ZXVlaW5nXG5cdFx0XHRcdCAqKioqKioqKioqKioqKiovXG5cblx0XHRcdFx0LyogRmlyZSB0aGUgbmV4dCBjYWxsIGluIHRoZSBxdWV1ZSBzbyBsb25nIGFzIHRoaXMgY2FsbCdzIHF1ZXVlIHdhc24ndCBzZXQgdG8gZmFsc2UgKHRvIHRyaWdnZXIgYSBwYXJhbGxlbCBhbmltYXRpb24pLFxuXHRcdFx0XHQgd2hpY2ggd291bGQgaGF2ZSBhbHJlYWR5IGNhdXNlZCB0aGUgbmV4dCBjYWxsIHRvIGZpcmUuIE5vdGU6IEV2ZW4gaWYgdGhlIGVuZCBvZiB0aGUgYW5pbWF0aW9uIHF1ZXVlIGhhcyBiZWVuIHJlYWNoZWQsXG5cdFx0XHRcdCAkLmRlcXVldWUoKSBtdXN0IHN0aWxsIGJlIGNhbGxlZCBpbiBvcmRlciB0byBjb21wbGV0ZWx5IGNsZWFyIGpRdWVyeSdzIGFuaW1hdGlvbiBxdWV1ZS4gKi9cblx0XHRcdFx0aWYgKG9wdHMucXVldWUgIT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0JC5kZXF1ZXVlKGVsZW1lbnQsIG9wdHMucXVldWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8qKioqKioqKioqKioqKioqKioqKioqKipcblx0XHRcdCBDYWxscyBBcnJheSBDbGVhbnVwXG5cdFx0XHQgKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0XHQvKiBTaW5jZSB0aGlzIGNhbGwgaXMgY29tcGxldGUsIHNldCBpdCB0byBmYWxzZSBzbyB0aGF0IHRoZSByQUYgdGljayBza2lwcyBpdC4gVGhpcyBhcnJheSBpcyBsYXRlciBjb21wYWN0ZWQgdmlhIGNvbXBhY3RTcGFyc2VBcnJheSgpLlxuXHRcdFx0IChGb3IgcGVyZm9ybWFuY2UgcmVhc29ucywgdGhlIGNhbGwgaXMgc2V0IHRvIGZhbHNlIGluc3RlYWQgb2YgYmVpbmcgZGVsZXRlZCBmcm9tIHRoZSBhcnJheTogaHR0cDovL3d3dy5odG1sNXJvY2tzLmNvbS9lbi90dXRvcmlhbHMvc3BlZWQvdjgvKSAqL1xuXHRcdFx0VmVsb2NpdHkuU3RhdGUuY2FsbHNbY2FsbEluZGV4XSA9IGZhbHNlO1xuXG5cdFx0XHQvKiBJdGVyYXRlIHRocm91Z2ggdGhlIGNhbGxzIGFycmF5IHRvIGRldGVybWluZSBpZiB0aGlzIHdhcyB0aGUgZmluYWwgaW4tcHJvZ3Jlc3MgYW5pbWF0aW9uLlxuXHRcdFx0IElmIHNvLCBzZXQgYSBmbGFnIHRvIGVuZCB0aWNraW5nIGFuZCBjbGVhciB0aGUgY2FsbHMgYXJyYXkuICovXG5cdFx0XHRmb3IgKHZhciBqID0gMCwgY2FsbHNMZW5ndGggPSBWZWxvY2l0eS5TdGF0ZS5jYWxscy5sZW5ndGg7IGogPCBjYWxsc0xlbmd0aDsgaisrKSB7XG5cdFx0XHRcdGlmIChWZWxvY2l0eS5TdGF0ZS5jYWxsc1tqXSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0XHRyZW1haW5pbmdDYWxsc0V4aXN0ID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChyZW1haW5pbmdDYWxsc0V4aXN0ID09PSBmYWxzZSkge1xuXHRcdFx0XHQvKiB0aWNrKCkgd2lsbCBkZXRlY3QgdGhpcyBmbGFnIHVwb24gaXRzIG5leHQgaXRlcmF0aW9uIGFuZCBzdWJzZXF1ZW50bHkgdHVybiBpdHNlbGYgb2ZmLiAqL1xuXHRcdFx0XHRWZWxvY2l0eS5TdGF0ZS5pc1RpY2tpbmcgPSBmYWxzZTtcblxuXHRcdFx0XHQvKiBDbGVhciB0aGUgY2FsbHMgYXJyYXkgc28gdGhhdCBpdHMgbGVuZ3RoIGlzIHJlc2V0LiAqL1xuXHRcdFx0XHRkZWxldGUgVmVsb2NpdHkuU3RhdGUuY2FsbHM7XG5cdFx0XHRcdFZlbG9jaXR5LlN0YXRlLmNhbGxzID0gW107XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqKioqKioqKioqKioqKioqKlxuXHRcdCBGcmFtZXdvcmtzXG5cdFx0ICoqKioqKioqKioqKioqKioqKi9cblxuXHRcdC8qIEJvdGggalF1ZXJ5IGFuZCBaZXB0byBhbGxvdyB0aGVpciAkLmZuIG9iamVjdCB0byBiZSBleHRlbmRlZCB0byBhbGxvdyB3cmFwcGVkIGVsZW1lbnRzIHRvIGJlIHN1YmplY3RlZCB0byBwbHVnaW4gY2FsbHMuXG5cdFx0IElmIGVpdGhlciBmcmFtZXdvcmsgaXMgbG9hZGVkLCByZWdpc3RlciBhIFwidmVsb2NpdHlcIiBleHRlbnNpb24gcG9pbnRpbmcgdG8gVmVsb2NpdHkncyBjb3JlIGFuaW1hdGUoKSBtZXRob2QuICBWZWxvY2l0eVxuXHRcdCBhbHNvIHJlZ2lzdGVycyBpdHNlbGYgb250byBhIGdsb2JhbCBjb250YWluZXIgKHdpbmRvdy5qUXVlcnkgfHwgd2luZG93LlplcHRvIHx8IHdpbmRvdykgc28gdGhhdCBjZXJ0YWluIGZlYXR1cmVzIGFyZVxuXHRcdCBhY2Nlc3NpYmxlIGJleW9uZCBqdXN0IGEgcGVyLWVsZW1lbnQgc2NvcGUuIFRoaXMgbWFzdGVyIG9iamVjdCBjb250YWlucyBhbiAuYW5pbWF0ZSgpIG1ldGhvZCwgd2hpY2ggaXMgbGF0ZXIgYXNzaWduZWQgdG8gJC5mblxuXHRcdCAoaWYgalF1ZXJ5IG9yIFplcHRvIGFyZSBwcmVzZW50KS4gQWNjb3JkaW5nbHksIFZlbG9jaXR5IGNhbiBib3RoIGFjdCBvbiB3cmFwcGVkIERPTSBlbGVtZW50cyBhbmQgc3RhbmQgYWxvbmUgZm9yIHRhcmdldGluZyByYXcgRE9NIGVsZW1lbnRzLiAqL1xuXHRcdGdsb2JhbC5WZWxvY2l0eSA9IFZlbG9jaXR5O1xuXG5cdFx0aWYgKGdsb2JhbCAhPT0gd2luZG93KSB7XG5cdFx0XHQvKiBBc3NpZ24gdGhlIGVsZW1lbnQgZnVuY3Rpb24gdG8gVmVsb2NpdHkncyBjb3JlIGFuaW1hdGUoKSBtZXRob2QuICovXG5cdFx0XHRnbG9iYWwuZm4udmVsb2NpdHkgPSBhbmltYXRlO1xuXHRcdFx0LyogQXNzaWduIHRoZSBvYmplY3QgZnVuY3Rpb24ncyBkZWZhdWx0cyB0byBWZWxvY2l0eSdzIGdsb2JhbCBkZWZhdWx0cyBvYmplY3QuICovXG5cdFx0XHRnbG9iYWwuZm4udmVsb2NpdHkuZGVmYXVsdHMgPSBWZWxvY2l0eS5kZWZhdWx0cztcblx0XHR9XG5cblx0XHQvKioqKioqKioqKioqKioqKioqKioqKipcblx0XHQgUGFja2FnZWQgUmVkaXJlY3RzXG5cdFx0ICoqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cdFx0Lyogc2xpZGVVcCwgc2xpZGVEb3duICovXG5cdFx0JC5lYWNoKFtcIkRvd25cIiwgXCJVcFwiXSwgZnVuY3Rpb24oaSwgZGlyZWN0aW9uKSB7XG5cdFx0XHRWZWxvY2l0eS5SZWRpcmVjdHNbXCJzbGlkZVwiICsgZGlyZWN0aW9uXSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMsIGVsZW1lbnRzSW5kZXgsIGVsZW1lbnRzU2l6ZSwgZWxlbWVudHMsIHByb21pc2VEYXRhKSB7XG5cdFx0XHRcdHZhciBvcHRzID0gJC5leHRlbmQoe30sIG9wdGlvbnMpLFxuXHRcdFx0XHRcdFx0YmVnaW4gPSBvcHRzLmJlZ2luLFxuXHRcdFx0XHRcdFx0Y29tcGxldGUgPSBvcHRzLmNvbXBsZXRlLFxuXHRcdFx0XHRcdFx0Y29tcHV0ZWRWYWx1ZXMgPSB7aGVpZ2h0OiBcIlwiLCBtYXJnaW5Ub3A6IFwiXCIsIG1hcmdpbkJvdHRvbTogXCJcIiwgcGFkZGluZ1RvcDogXCJcIiwgcGFkZGluZ0JvdHRvbTogXCJcIn0sXG5cdFx0XHRcdGlubGluZVZhbHVlcyA9IHt9O1xuXG5cdFx0XHRcdGlmIChvcHRzLmRpc3BsYXkgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdC8qIFNob3cgdGhlIGVsZW1lbnQgYmVmb3JlIHNsaWRlRG93biBiZWdpbnMgYW5kIGhpZGUgdGhlIGVsZW1lbnQgYWZ0ZXIgc2xpZGVVcCBjb21wbGV0ZXMuICovXG5cdFx0XHRcdFx0LyogTm90ZTogSW5saW5lIGVsZW1lbnRzIGNhbm5vdCBoYXZlIGRpbWVuc2lvbnMgYW5pbWF0ZWQsIHNvIHRoZXkncmUgcmV2ZXJ0ZWQgdG8gaW5saW5lLWJsb2NrLiAqL1xuXHRcdFx0XHRcdG9wdHMuZGlzcGxheSA9IChkaXJlY3Rpb24gPT09IFwiRG93blwiID8gKFZlbG9jaXR5LkNTUy5WYWx1ZXMuZ2V0RGlzcGxheVR5cGUoZWxlbWVudCkgPT09IFwiaW5saW5lXCIgPyBcImlubGluZS1ibG9ja1wiIDogXCJibG9ja1wiKSA6IFwibm9uZVwiKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG9wdHMuYmVnaW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvKiBJZiB0aGUgdXNlciBwYXNzZWQgaW4gYSBiZWdpbiBjYWxsYmFjaywgZmlyZSBpdCBub3cuICovXG5cdFx0XHRcdFx0aWYgKGJlZ2luKSB7XG5cdFx0XHRcdFx0XHRiZWdpbi5jYWxsKGVsZW1lbnRzLCBlbGVtZW50cyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0LyogQ2FjaGUgdGhlIGVsZW1lbnRzJyBvcmlnaW5hbCB2ZXJ0aWNhbCBkaW1lbnNpb25hbCBwcm9wZXJ0eSB2YWx1ZXMgc28gdGhhdCB3ZSBjYW4gYW5pbWF0ZSBiYWNrIHRvIHRoZW0uICovXG5cdFx0XHRcdFx0Zm9yICh2YXIgcHJvcGVydHkgaW4gY29tcHV0ZWRWYWx1ZXMpIHtcblx0XHRcdFx0XHRcdGlmICghY29tcHV0ZWRWYWx1ZXMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aW5saW5lVmFsdWVzW3Byb3BlcnR5XSA9IGVsZW1lbnQuc3R5bGVbcHJvcGVydHldO1xuXG5cdFx0XHRcdFx0XHQvKiBGb3Igc2xpZGVEb3duLCB1c2UgZm9yY2VmZWVkaW5nIHRvIGFuaW1hdGUgYWxsIHZlcnRpY2FsIHByb3BlcnRpZXMgZnJvbSAwLiBGb3Igc2xpZGVVcCxcblx0XHRcdFx0XHRcdCB1c2UgZm9yY2VmZWVkaW5nIHRvIHN0YXJ0IGZyb20gY29tcHV0ZWQgdmFsdWVzIGFuZCBhbmltYXRlIGRvd24gdG8gMC4gKi9cblx0XHRcdFx0XHRcdHZhciBwcm9wZXJ0eVZhbHVlID0gVmVsb2NpdHkuQ1NTLmdldFByb3BlcnR5VmFsdWUoZWxlbWVudCwgcHJvcGVydHkpO1xuXHRcdFx0XHRcdFx0Y29tcHV0ZWRWYWx1ZXNbcHJvcGVydHldID0gKGRpcmVjdGlvbiA9PT0gXCJEb3duXCIpID8gW3Byb3BlcnR5VmFsdWUsIDBdIDogWzAsIHByb3BlcnR5VmFsdWVdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIEZvcmNlIHZlcnRpY2FsIG92ZXJmbG93IGNvbnRlbnQgdG8gY2xpcCBzbyB0aGF0IHNsaWRpbmcgd29ya3MgYXMgZXhwZWN0ZWQuICovXG5cdFx0XHRcdFx0aW5saW5lVmFsdWVzLm92ZXJmbG93ID0gZWxlbWVudC5zdHlsZS5vdmVyZmxvdztcblx0XHRcdFx0XHRlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRvcHRzLmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0LyogUmVzZXQgZWxlbWVudCB0byBpdHMgcHJlLXNsaWRlIGlubGluZSB2YWx1ZXMgb25jZSBpdHMgc2xpZGUgYW5pbWF0aW9uIGlzIGNvbXBsZXRlLiAqL1xuXHRcdFx0XHRcdGZvciAodmFyIHByb3BlcnR5IGluIGlubGluZVZhbHVlcykge1xuXHRcdFx0XHRcdFx0aWYgKGlubGluZVZhbHVlcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcblx0XHRcdFx0XHRcdFx0ZWxlbWVudC5zdHlsZVtwcm9wZXJ0eV0gPSBpbmxpbmVWYWx1ZXNbcHJvcGVydHldO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8qIElmIHRoZSB1c2VyIHBhc3NlZCBpbiBhIGNvbXBsZXRlIGNhbGxiYWNrLCBmaXJlIGl0IG5vdy4gKi9cblx0XHRcdFx0XHRpZiAoY29tcGxldGUpIHtcblx0XHRcdFx0XHRcdGNvbXBsZXRlLmNhbGwoZWxlbWVudHMsIGVsZW1lbnRzKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHByb21pc2VEYXRhKSB7XG5cdFx0XHRcdFx0XHRwcm9taXNlRGF0YS5yZXNvbHZlcihlbGVtZW50cyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdFZlbG9jaXR5KGVsZW1lbnQsIGNvbXB1dGVkVmFsdWVzLCBvcHRzKTtcblx0XHRcdH07XG5cdFx0fSk7XG5cblx0XHQvKiBmYWRlSW4sIGZhZGVPdXQgKi9cblx0XHQkLmVhY2goW1wiSW5cIiwgXCJPdXRcIl0sIGZ1bmN0aW9uKGksIGRpcmVjdGlvbikge1xuXHRcdFx0VmVsb2NpdHkuUmVkaXJlY3RzW1wiZmFkZVwiICsgZGlyZWN0aW9uXSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMsIGVsZW1lbnRzSW5kZXgsIGVsZW1lbnRzU2l6ZSwgZWxlbWVudHMsIHByb21pc2VEYXRhKSB7XG5cdFx0XHRcdHZhciBvcHRzID0gJC5leHRlbmQoe30sIG9wdGlvbnMpLFxuXHRcdFx0XHRcdFx0b3JpZ2luYWxDb21wbGV0ZSA9IG9wdHMuY29tcGxldGUsXG5cdFx0XHRcdFx0XHRwcm9wZXJ0aWVzTWFwID0ge29wYWNpdHk6IChkaXJlY3Rpb24gPT09IFwiSW5cIikgPyAxIDogMH07XG5cblx0XHRcdFx0LyogU2luY2UgcmVkaXJlY3RzIGFyZSB0cmlnZ2VyZWQgaW5kaXZpZHVhbGx5IGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIGFuaW1hdGVkIHNldCwgYXZvaWQgcmVwZWF0ZWRseSB0cmlnZ2VyaW5nXG5cdFx0XHRcdCBjYWxsYmFja3MgYnkgZmlyaW5nIHRoZW0gb25seSB3aGVuIHRoZSBmaW5hbCBlbGVtZW50IGhhcyBiZWVuIHJlYWNoZWQuICovXG5cdFx0XHRcdGlmIChlbGVtZW50c0luZGV4ICE9PSBlbGVtZW50c1NpemUgLSAxKSB7XG5cdFx0XHRcdFx0b3B0cy5jb21wbGV0ZSA9IG9wdHMuYmVnaW4gPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9wdHMuY29tcGxldGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGlmIChvcmlnaW5hbENvbXBsZXRlKSB7XG5cdFx0XHRcdFx0XHRcdG9yaWdpbmFsQ29tcGxldGUuY2FsbChlbGVtZW50cywgZWxlbWVudHMpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAocHJvbWlzZURhdGEpIHtcblx0XHRcdFx0XHRcdFx0cHJvbWlzZURhdGEucmVzb2x2ZXIoZWxlbWVudHMpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvKiBJZiBhIGRpc3BsYXkgd2FzIHBhc3NlZCBpbiwgdXNlIGl0LiBPdGhlcndpc2UsIGRlZmF1bHQgdG8gXCJub25lXCIgZm9yIGZhZGVPdXQgb3IgdGhlIGVsZW1lbnQtc3BlY2lmaWMgZGVmYXVsdCBmb3IgZmFkZUluLiAqL1xuXHRcdFx0XHQvKiBOb3RlOiBXZSBhbGxvdyB1c2VycyB0byBwYXNzIGluIFwibnVsbFwiIHRvIHNraXAgZGlzcGxheSBzZXR0aW5nIGFsdG9nZXRoZXIuICovXG5cdFx0XHRcdGlmIChvcHRzLmRpc3BsYXkgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdG9wdHMuZGlzcGxheSA9IChkaXJlY3Rpb24gPT09IFwiSW5cIiA/IFwiYXV0b1wiIDogXCJub25lXCIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0VmVsb2NpdHkodGhpcywgcHJvcGVydGllc01hcCwgb3B0cyk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIFZlbG9jaXR5O1xuXHR9KCh3aW5kb3cualF1ZXJ5IHx8IHdpbmRvdy5aZXB0byB8fCB3aW5kb3cpLCB3aW5kb3csIGRvY3VtZW50KTtcbn0pKTtcblxuLyoqKioqKioqKioqKioqKioqKlxuIEtub3duIElzc3Vlc1xuICoqKioqKioqKioqKioqKioqKi9cblxuLyogVGhlIENTUyBzcGVjIG1hbmRhdGVzIHRoYXQgdGhlIHRyYW5zbGF0ZVgvWS9aIHRyYW5zZm9ybXMgYXJlICUtcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQgaXRzZWxmIC0tIG5vdCBpdHMgcGFyZW50LlxuIFZlbG9jaXR5LCBob3dldmVyLCBkb2Vzbid0IG1ha2UgdGhpcyBkaXN0aW5jdGlvbi4gVGh1cywgY29udmVydGluZyB0byBvciBmcm9tIHRoZSAlIHVuaXQgd2l0aCB0aGVzZSBzdWJwcm9wZXJ0aWVzXG4gd2lsbCBwcm9kdWNlIGFuIGluYWNjdXJhdGUgY29udmVyc2lvbiB2YWx1ZS4gVGhlIHNhbWUgaXNzdWUgZXhpc3RzIHdpdGggdGhlIGN4L2N5IGF0dHJpYnV0ZXMgb2YgU1ZHIGNpcmNsZXMgYW5kIGVsbGlwc2VzLiAqL1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi92ZWxvY2l0eS1hbmltYXRlL3ZlbG9jaXR5LmpzXG4vLyBtb2R1bGUgaWQgPSA1N1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 58 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar createView = __webpack_require__(59),\n    workspaceState = __webpack_require__(25),\n    bindDatePicker = __webpack_require__(61),\n    pageModels = __webpack_require__(62),\n    editController = __webpack_require__(52),\n    getActivePage = __webpack_require__(56),\n    saveNewPage = __webpack_require__(63),\n    utilities = __webpack_require__(64),\n    activePageType = \"\";\n\nvar createController = {\n\n    init: function init() {\n        activePageType = utilities.findNodeInBrowseTreeByUri(workspaceState.activeUrl.get()).type;\n        createView.render(createController.getValidPageOptions());\n        this.bindEvents();\n\n        // If page being created as part of a series pre-populate some inputs\n        if (activePageType === \"bulletin\" || activePageType === \"article\") {\n            this.prePopulateInputs();\n            this.prePopulatePageModel();\n        }\n    },\n\n    bindEvents: function bindEvents() {\n        var $form = $('#js-create__form');\n\n        this.bindPageTypeSelection();\n        this.bindFormInput($form);\n        this.bindFormSubmit($form);\n    },\n\n    bindFormSubmit: function bindFormSubmit($form) {\n        $form.submit(function (event) {\n            event.preventDefault();\n\n            if (!createController.validateForm()) {\n                return false;\n            }\n\n            saveNewPage().then(function (newPageURI) {\n                workspaceState.activeUrl.set(newPageURI);\n                workspaceState.activeScreen.set(\"edit\");\n            }).catch(function (error) {\n                console.log(\"Error saving new page \\n\", error);\n            });\n        });\n    },\n\n    bindFormInput: function bindFormInput($form) {\n        var newEditorData;\n\n        // Remove previous bindings\n        $form.off();\n\n        // Bind updating to any inputs\n        $form.on('input', '#edition', function () {\n            newEditorData = workspaceState.editorData.get();\n            newEditorData.description.edition = $(this).val();\n            workspaceState.editorData.set(newEditorData);\n        });\n\n        $form.on('input', '#pagename', function () {\n            newEditorData = workspaceState.editorData.get();\n            newEditorData.description.title = $(this).val();\n            workspaceState.editorData.set(newEditorData);\n        });\n\n        $form.on('change', '#releaseDate', function () {\n            newEditorData = workspaceState.editorData.get();\n            newEditorData.description.releaseDate = new Date($(this).val()).toISOString();\n            workspaceState.editorData.set(newEditorData);\n        });\n    },\n\n    bindPageTypeSelection: function bindPageTypeSelection() {\n        $(\"#pageType\").change(function () {\n            var selectOption = $(this).val();\n            createController.buildInputs(selectOption);\n            workspaceState.editorData.set(createController.getPageModel(selectOption));\n        });\n    },\n\n    prePopulateInputs: function prePopulateInputs() {\n        var $pageNameInput;\n\n        // Render inputs\n        createController.buildInputs(activePageType);\n        workspaceState.editorData.set(createController.getPageModel(activePageType));\n        $pageNameInput = $('#pagename');\n\n        // Disable page name input as it'll be inheriting from page data\n        $pageNameInput.prop('disabled', true).prop('placeholder', 'Page name [FETCHING TITLE...]');\n\n        // Get title from page data of active URL\n        getActivePage().then(function (pageData) {\n            $pageNameInput.val(pageData.description.title).trigger('input');\n            $pageNameInput.prop('disabled', false).prop('placeholder', 'Page name');\n        }).catch(function (error) {\n            console.log(\"Error getting page data for creating page as part of a series:\\n\", error);\n            $pageNameInput.prop('disabled', false).prop('placeholder', 'Page name');\n        });\n    },\n\n    prePopulatePageModel: function prePopulatePageModel() {\n        // Get data from active bulletin ready for editor screen later\n        getActivePage().then(function (pageData) {\n            var newEditorData = workspaceState.editorData.get();\n\n            newEditorData.description.nationalStatistic = pageData.description.nationalStatistic;\n            newEditorData.description.contact.name = pageData.description.contact.name;\n            newEditorData.description.contact.email = pageData.description.contact.email;\n            newEditorData.description.contact.telephone = pageData.description.contact.telephone;\n            newEditorData.description.keywords = pageData.description.keywords;\n            newEditorData.description.metaDescription = pageData.description.metaDescription;\n            newEditorData.relatedMethodology = pageData.relatedMethodology;\n\n            if (newEditorData.type === \"bulletin\") {\n                newEditorData.description.summary = pageData.description.summary;\n                newEditorData.relatedData = pageData.relatedData;\n            }\n\n            // Update state with new editorData inherited from publication series\n            workspaceState.editorData.set(newEditorData);\n        }).catch(function (error) {\n            console.log(\"Error getting page to inherit series data into page model: \\n\", error);\n        });\n    },\n\n    validateForm: function validateForm() {\n        var pageData = workspaceState.editorData.get();\n\n        createView.renderInputError.clearAll();\n\n        /* Validate each key that could exist in form data */\n\n        // Edition\n        var edition;\n        if (pageData.description.edition) {\n            edition = pageData.description.edition.toLowerCase();\n        }\n        if (edition && (edition === 'latest' || edition === 'data' || edition === 'previousreleases' || edition === 'current')) {\n            createView.renderInputError.edition(\"<span>'\" + edition + \"' is a reserved path so it can't be used as an edition title</span>\");\n            return false;\n        }\n\n        return true;\n    },\n\n    buildInputs: function buildInputs(selectedOptionId) {\n        /* Get string of inputs HTML and request view to render it */\n        var inputsArray = this.getInputsForOptionID(selectedOptionId),\n            inputsArrayLength = inputsArray.length,\n            i;\n\n        // Empty any existing optional inputs from DOM\n        createView.inputs.empty();\n\n        // Go through array and build up new array of HTML returned for input type from view\n        for (i = 0; i < inputsArrayLength; i++) {\n            var inputHtml = createView.inputHtml(inputsArray[i]);\n            createView.inputs.append(inputHtml);\n\n            // Bind date picker pop-up on focus of input - pull this out to a separate function if it starts being used for more inputs\n            if (inputsArray[i] === \"releaseDate\") {\n                bindDatePicker();\n            }\n        }\n    },\n\n    getInputsForOptionID: function getInputsForOptionID(selectedOptionId) {\n        // Get page type for the selected option\n        switch (selectedOptionId) {\n            case \"noneSelected\":\n                {\n                    return [];\n                }\n            case \"bulletin\":\n                {\n                    return [\"pageName\", \"edition\", \"releaseDate\"];\n                }\n            case \"article\":\n                {\n                    return [\"pageName\", \"edition\", \"releaseDate\"];\n                }\n            case \"dataset_landing_page\":\n                {\n                    return [\"pageName\", \"releaseDate\"];\n                }\n            case \"timeseries_dataset_landing_page\":\n                {\n                    return [\"pageName\", \"releaseDate\"];\n                }\n            default:\n                {\n                    console.log(\"Unrecognised selected option id, doesn't map to a page type\");\n                    return false;\n                }\n        }\n    },\n\n    getPageModel: function getPageModel(selectedOptionId) {\n        switch (selectedOptionId) {\n            case \"bulletin\":\n                {\n                    return pageModels.bulletin;\n                }\n            case \"article\":\n                {\n                    return pageModels.article;\n                }\n            default:\n                {\n                    return {};\n                }\n        }\n    },\n\n    getValidPageTypesForLocation: function getValidPageTypesForLocation() {\n        /* Returns an array of page types that can be created at a URI */\n        var validPageTypes = [];\n\n        switch (activePageType) {\n            case \"home_page\":\n                {\n                    validPageTypes = [\"visualisation\", \"release\"];\n                    break;\n                }\n            case \"product_page\":\n                {\n                    validPageTypes = [\"bulletin\", \"article\", \"article_download\", \"compendium_landing_page\", \"static_methodology\", \"static_methodology_download\", \"static_qmi\", \"static_adhoc\", \"dataset_landing_page\", \"timeseries_dataset_landing_page\"];\n                    break;\n                }\n            case \"bulletin\":\n                {\n                    validPageTypes = [\"bulletin\"];\n                    break;\n                }\n            case \"article\":\n                {\n                    validPageTypes = [\"article\"];\n                    break;\n                }\n            case \"compendium\":\n                {\n                    validPageTypes = [\"compendium_chapter\", \"compendium_data\"];\n                    break;\n                }\n        }\n\n        return validPageTypes;\n    },\n\n    allPageTypeOptions: function allPageTypeOptions() {\n        /* All possible <option> elements that can be used in page type <select> */\n        return [{\n            id: \"bulletin\",\n            title: \"Statistical bulletin\"\n        }, {\n            id: \"article\",\n            title: \"Article\"\n        }, {\n            id: \"article_download\",\n            title: \"Article [PDF]\"\n        }, {\n            id: \"compendium_landing_page\",\n            title: \"Compendium\"\n        }, {\n            id: \"compendium_chapter\",\n            title: \"Compendium chapter\"\n        }, {\n            id: \"compendium_data\",\n            title: \"Compendium data\"\n        }, {\n            id: \"static_landing_page\",\n            title: \"Static landing page\"\n        }, {\n            id: \"static_page\",\n            title: \"Static page\"\n        }, {\n            id: \"static_article\",\n            title: \"Static article\"\n        }, {\n            id: \"static_foi\",\n            title: \"FOI\"\n        }, {\n            id: \"static_qmi\",\n            title: \"QMI\"\n        }, {\n            id: \"static_adhoc\",\n            title: \"User requested data\"\n        }, {\n            id: \"static_methodology\",\n            title: \"Methodology article\"\n        }, {\n            id: \"static_methodology_download\",\n            title: \"Methodology article [PDF]\"\n        }, {\n            id: \"dataset_landing_page\",\n            title: \"Dataset landing page\"\n        }, {\n            id: \"timeseries_dataset_landing_page\",\n            title: \"Timeseries data landing page\"\n        }, {\n            id: \"dataset\",\n            title: \"Dataset\"\n        }, {\n            id: \"timeseries_dataset\",\n            title: \"Timeseries dataset\"\n        }, {\n            id: \"visualisation\",\n            title: \"Data visualisation\"\n        }, {\n            id: \"release\",\n            title: \"Calendar entry\"\n        }];\n    },\n\n    getValidPageOptions: function getValidPageOptions() {\n        var validPageTypes = createController.getValidPageTypesForLocation(),\n            validPageTypesLength = validPageTypes.length,\n            validPageOptions = createController.allPageTypeOptions(),\n            validPageOptionsLength = validPageOptions.length,\n            index,\n            nestedIndex;\n\n        for (index = 0; index < validPageOptionsLength; index++) {\n            for (nestedIndex = 0; nestedIndex < validPageTypesLength; nestedIndex++) {\n\n                if (validPageOptions[index].id == validPageTypes[nestedIndex]) {\n                    validPageOptions[index].valid = true;\n                }\n\n                if (validPageOptions[index].id === activePageType) {\n                    validPageOptions[index].active = true;\n                }\n            }\n        }\n\n        return validPageOptions;\n    }\n\n};\n\nmodule.exports = createController;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9jcmVhdGUvY3JlYXRlQ29udHJvbGxlci5qcz80YzAxIl0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIGNyZWF0ZVZpZXcgPSByZXF1aXJlKCd3b3Jrc3BhY2UvY3JlYXRlL2NyZWF0ZVZpZXcnKSxcbiAgICB3b3Jrc3BhY2VTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZScpLFxuICAgIGJpbmREYXRlUGlja2VyID0gcmVxdWlyZSgnc2hhcmVkL3V0aWxpdGllcy9iaW5kRGF0ZVBpY2tlcicpLFxuICAgIHBhZ2VNb2RlbHMgPSByZXF1aXJlKCdzaGFyZWQvbW9kZWxzL3BhZ2VNb2RlbHMnKSxcbiAgICBlZGl0Q29udHJvbGxlciA9IHJlcXVpcmUoJ3dvcmtzcGFjZS9lZGl0L2VkaXRDb250cm9sbGVyJyksXG4gICAgZ2V0QWN0aXZlUGFnZSA9IHJlcXVpcmUoJ3NoYXJlZC9hcGkvZ2V0QWN0aXZlUGFnZScpLFxuICAgIHNhdmVOZXdQYWdlID0gcmVxdWlyZSgnc2hhcmVkL2FwaS9zYXZlTmV3UGFnZScpLFxuICAgIHV0aWxpdGllcyA9IHJlcXVpcmUoJ3NoYXJlZC91dGlsaXRpZXMvdXRpbGl0aWVzJyksXG4gICAgYWN0aXZlUGFnZVR5cGUgPSBcIlwiO1xuXG52YXIgY3JlYXRlQ29udHJvbGxlciA9IHtcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhY3RpdmVQYWdlVHlwZSA9IHV0aWxpdGllcy5maW5kTm9kZUluQnJvd3NlVHJlZUJ5VXJpKHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5nZXQoKSkudHlwZTtcbiAgICAgICAgY3JlYXRlVmlldy5yZW5kZXIoY3JlYXRlQ29udHJvbGxlci5nZXRWYWxpZFBhZ2VPcHRpb25zKCkpO1xuICAgICAgICB0aGlzLmJpbmRFdmVudHMoKTtcblxuICAgICAgICAvLyBJZiBwYWdlIGJlaW5nIGNyZWF0ZWQgYXMgcGFydCBvZiBhIHNlcmllcyBwcmUtcG9wdWxhdGUgc29tZSBpbnB1dHNcbiAgICAgICAgaWYgKGFjdGl2ZVBhZ2VUeXBlID09PSBcImJ1bGxldGluXCIgfHwgYWN0aXZlUGFnZVR5cGUgPT09IFwiYXJ0aWNsZVwiKSB7XG4gICAgICAgICAgICB0aGlzLnByZVBvcHVsYXRlSW5wdXRzKCk7XG4gICAgICAgICAgICB0aGlzLnByZVBvcHVsYXRlUGFnZU1vZGVsKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYmluZEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciAkZm9ybSA9ICQoJyNqcy1jcmVhdGVfX2Zvcm0nKTtcblxuICAgICAgICB0aGlzLmJpbmRQYWdlVHlwZVNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLmJpbmRGb3JtSW5wdXQoJGZvcm0pO1xuICAgICAgICB0aGlzLmJpbmRGb3JtU3VibWl0KCRmb3JtKTtcbiAgICB9LFxuXG4gICAgYmluZEZvcm1TdWJtaXQ6IGZ1bmN0aW9uKCRmb3JtKSB7XG4gICAgICAgICRmb3JtLnN1Ym1pdChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKCFjcmVhdGVDb250cm9sbGVyLnZhbGlkYXRlRm9ybSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzYXZlTmV3UGFnZSgpLnRoZW4oZnVuY3Rpb24obmV3UGFnZVVSSSkge1xuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5zZXQobmV3UGFnZVVSSSk7XG4gICAgICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuYWN0aXZlU2NyZWVuLnNldChcImVkaXRcIik7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3Igc2F2aW5nIG5ldyBwYWdlIFxcblwiLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGJpbmRGb3JtSW5wdXQ6IGZ1bmN0aW9uKCRmb3JtKSB7XG4gICAgICAgIHZhciBuZXdFZGl0b3JEYXRhO1xuXG4gICAgICAgIC8vIFJlbW92ZSBwcmV2aW91cyBiaW5kaW5nc1xuICAgICAgICAkZm9ybS5vZmYoKTtcblxuICAgICAgICAvLyBCaW5kIHVwZGF0aW5nIHRvIGFueSBpbnB1dHNcbiAgICAgICAgJGZvcm0ub24oJ2lucHV0JywgJyNlZGl0aW9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKTtcbiAgICAgICAgICAgIG5ld0VkaXRvckRhdGEuZGVzY3JpcHRpb24uZWRpdGlvbiA9ICQodGhpcykudmFsKCk7XG4gICAgICAgICAgICB3b3Jrc3BhY2VTdGF0ZS5lZGl0b3JEYXRhLnNldChuZXdFZGl0b3JEYXRhKVxuICAgICAgICB9KTtcblxuICAgICAgICAkZm9ybS5vbignaW5wdXQnLCAnI3BhZ2VuYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKTtcbiAgICAgICAgICAgIG5ld0VkaXRvckRhdGEuZGVzY3JpcHRpb24udGl0bGUgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5zZXQobmV3RWRpdG9yRGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRmb3JtLm9uKCdjaGFuZ2UnLCAnI3JlbGVhc2VEYXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKTtcbiAgICAgICAgICAgIG5ld0VkaXRvckRhdGEuZGVzY3JpcHRpb24ucmVsZWFzZURhdGUgPSAobmV3IERhdGUgKCQodGhpcykudmFsKCkpKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5zZXQobmV3RWRpdG9yRGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cblxuXG4gICAgYmluZFBhZ2VUeXBlU2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJChcIiNwYWdlVHlwZVwiKS5jaGFuZ2UoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0T3B0aW9uID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgIGNyZWF0ZUNvbnRyb2xsZXIuYnVpbGRJbnB1dHMoc2VsZWN0T3B0aW9uKTtcbiAgICAgICAgICAgIHdvcmtzcGFjZVN0YXRlLmVkaXRvckRhdGEuc2V0KGNyZWF0ZUNvbnRyb2xsZXIuZ2V0UGFnZU1vZGVsKHNlbGVjdE9wdGlvbikpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcHJlUG9wdWxhdGVJbnB1dHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHBhZ2VOYW1lSW5wdXQ7XG5cbiAgICAgICAgLy8gUmVuZGVyIGlucHV0c1xuICAgICAgICBjcmVhdGVDb250cm9sbGVyLmJ1aWxkSW5wdXRzKGFjdGl2ZVBhZ2VUeXBlKTtcbiAgICAgICAgd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5zZXQoY3JlYXRlQ29udHJvbGxlci5nZXRQYWdlTW9kZWwoYWN0aXZlUGFnZVR5cGUpKTtcbiAgICAgICAgJHBhZ2VOYW1lSW5wdXQgPSAkKCcjcGFnZW5hbWUnKTtcblxuICAgICAgICAvLyBEaXNhYmxlIHBhZ2UgbmFtZSBpbnB1dCBhcyBpdCdsbCBiZSBpbmhlcml0aW5nIGZyb20gcGFnZSBkYXRhXG4gICAgICAgICRwYWdlTmFtZUlucHV0LnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSkucHJvcCgncGxhY2Vob2xkZXInLCAnUGFnZSBuYW1lIFtGRVRDSElORyBUSVRMRS4uLl0nKTtcblxuICAgICAgICAvLyBHZXQgdGl0bGUgZnJvbSBwYWdlIGRhdGEgb2YgYWN0aXZlIFVSTFxuICAgICAgICBnZXRBY3RpdmVQYWdlKCkudGhlbihmdW5jdGlvbihwYWdlRGF0YSkge1xuICAgICAgICAgICAgJHBhZ2VOYW1lSW5wdXQudmFsKHBhZ2VEYXRhLmRlc2NyaXB0aW9uLnRpdGxlKS50cmlnZ2VyKCdpbnB1dCcpO1xuICAgICAgICAgICAgJHBhZ2VOYW1lSW5wdXQucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSkucHJvcCgncGxhY2Vob2xkZXInLCAnUGFnZSBuYW1lJyk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGdldHRpbmcgcGFnZSBkYXRhIGZvciBjcmVhdGluZyBwYWdlIGFzIHBhcnQgb2YgYSBzZXJpZXM6XFxuXCIsIGVycm9yKTtcbiAgICAgICAgICAgICRwYWdlTmFtZUlucHV0LnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpLnByb3AoJ3BsYWNlaG9sZGVyJywgJ1BhZ2UgbmFtZScpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcHJlUG9wdWxhdGVQYWdlTW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBHZXQgZGF0YSBmcm9tIGFjdGl2ZSBidWxsZXRpbiByZWFkeSBmb3IgZWRpdG9yIHNjcmVlbiBsYXRlclxuICAgICAgICBnZXRBY3RpdmVQYWdlKCkudGhlbihmdW5jdGlvbihwYWdlRGF0YSkge1xuICAgICAgICAgICAgdmFyIG5ld0VkaXRvckRhdGEgPSB3b3Jrc3BhY2VTdGF0ZS5lZGl0b3JEYXRhLmdldCgpO1xuXG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLm5hdGlvbmFsU3RhdGlzdGljID0gcGFnZURhdGEuZGVzY3JpcHRpb24ubmF0aW9uYWxTdGF0aXN0aWM7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QubmFtZSA9IHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QubmFtZTtcbiAgICAgICAgICAgIG5ld0VkaXRvckRhdGEuZGVzY3JpcHRpb24uY29udGFjdC5lbWFpbCA9IHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QuZW1haWw7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLmNvbnRhY3QudGVsZXBob25lID0gcGFnZURhdGEuZGVzY3JpcHRpb24uY29udGFjdC50ZWxlcGhvbmU7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLmtleXdvcmRzID0gcGFnZURhdGEuZGVzY3JpcHRpb24ua2V5d29yZHM7XG4gICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbiA9IHBhZ2VEYXRhLmRlc2NyaXB0aW9uLm1ldGFEZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIG5ld0VkaXRvckRhdGEucmVsYXRlZE1ldGhvZG9sb2d5ID0gcGFnZURhdGEucmVsYXRlZE1ldGhvZG9sb2d5O1xuXG4gICAgICAgICAgICBpZiAobmV3RWRpdG9yRGF0YS50eXBlID09PSBcImJ1bGxldGluXCIpIHtcbiAgICAgICAgICAgICAgICBuZXdFZGl0b3JEYXRhLmRlc2NyaXB0aW9uLnN1bW1hcnkgPSBwYWdlRGF0YS5kZXNjcmlwdGlvbi5zdW1tYXJ5O1xuICAgICAgICAgICAgICAgIG5ld0VkaXRvckRhdGEucmVsYXRlZERhdGEgPSBwYWdlRGF0YS5yZWxhdGVkRGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIHN0YXRlIHdpdGggbmV3IGVkaXRvckRhdGEgaW5oZXJpdGVkIGZyb20gcHVibGljYXRpb24gc2VyaWVzXG4gICAgICAgICAgICB3b3Jrc3BhY2VTdGF0ZS5lZGl0b3JEYXRhLnNldChuZXdFZGl0b3JEYXRhKTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgZ2V0dGluZyBwYWdlIHRvIGluaGVyaXQgc2VyaWVzIGRhdGEgaW50byBwYWdlIG1vZGVsOiBcXG5cIiwgZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdmFsaWRhdGVGb3JtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBhZ2VEYXRhID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKTtcblxuICAgICAgICBjcmVhdGVWaWV3LnJlbmRlcklucHV0RXJyb3IuY2xlYXJBbGwoKTtcblxuICAgICAgICAvKiBWYWxpZGF0ZSBlYWNoIGtleSB0aGF0IGNvdWxkIGV4aXN0IGluIGZvcm0gZGF0YSAqL1xuXG4gICAgICAgIC8vIEVkaXRpb25cbiAgICAgICAgdmFyIGVkaXRpb247XG4gICAgICAgIGlmIChwYWdlRGF0YS5kZXNjcmlwdGlvbi5lZGl0aW9uKSB7XG4gICAgICAgICAgICBlZGl0aW9uID0gKHBhZ2VEYXRhLmRlc2NyaXB0aW9uLmVkaXRpb24pLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVkaXRpb24gJiYgKGVkaXRpb24gPT09ICdsYXRlc3QnIHx8IGVkaXRpb24gPT09ICdkYXRhJyB8fCBlZGl0aW9uID09PSAncHJldmlvdXNyZWxlYXNlcycgfHwgZWRpdGlvbiA9PT0gJ2N1cnJlbnQnKSkge1xuICAgICAgICAgICAgY3JlYXRlVmlldy5yZW5kZXJJbnB1dEVycm9yLmVkaXRpb24oXCI8c3Bhbj4nXCIgKyBlZGl0aW9uICsgXCInIGlzIGEgcmVzZXJ2ZWQgcGF0aCBzbyBpdCBjYW4ndCBiZSB1c2VkIGFzIGFuIGVkaXRpb24gdGl0bGU8L3NwYW4+XCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGJ1aWxkSW5wdXRzOiBmdW5jdGlvbihzZWxlY3RlZE9wdGlvbklkKSB7XG4gICAgICAgIC8qIEdldCBzdHJpbmcgb2YgaW5wdXRzIEhUTUwgYW5kIHJlcXVlc3QgdmlldyB0byByZW5kZXIgaXQgKi9cbiAgICAgICAgdmFyIGlucHV0c0FycmF5ID0gdGhpcy5nZXRJbnB1dHNGb3JPcHRpb25JRChzZWxlY3RlZE9wdGlvbklkKSxcbiAgICAgICAgICAgIGlucHV0c0FycmF5TGVuZ3RoID0gaW5wdXRzQXJyYXkubGVuZ3RoLFxuICAgICAgICAgICAgaTtcblxuICAgICAgICAvLyBFbXB0eSBhbnkgZXhpc3Rpbmcgb3B0aW9uYWwgaW5wdXRzIGZyb20gRE9NXG4gICAgICAgIGNyZWF0ZVZpZXcuaW5wdXRzLmVtcHR5KCk7XG5cbiAgICAgICAgLy8gR28gdGhyb3VnaCBhcnJheSBhbmQgYnVpbGQgdXAgbmV3IGFycmF5IG9mIEhUTUwgcmV0dXJuZWQgZm9yIGlucHV0IHR5cGUgZnJvbSB2aWV3XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dHNBcnJheUxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXRIdG1sID0gKGNyZWF0ZVZpZXcuaW5wdXRIdG1sKGlucHV0c0FycmF5W2ldKSk7XG4gICAgICAgICAgICBjcmVhdGVWaWV3LmlucHV0cy5hcHBlbmQoaW5wdXRIdG1sKTtcblxuICAgICAgICAgICAgLy8gQmluZCBkYXRlIHBpY2tlciBwb3AtdXAgb24gZm9jdXMgb2YgaW5wdXQgLSBwdWxsIHRoaXMgb3V0IHRvIGEgc2VwYXJhdGUgZnVuY3Rpb24gaWYgaXQgc3RhcnRzIGJlaW5nIHVzZWQgZm9yIG1vcmUgaW5wdXRzXG4gICAgICAgICAgICBpZiAoaW5wdXRzQXJyYXlbaV0gPT09IFwicmVsZWFzZURhdGVcIikge1xuICAgICAgICAgICAgICAgIGJpbmREYXRlUGlja2VyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICBnZXRJbnB1dHNGb3JPcHRpb25JRDogZnVuY3Rpb24oc2VsZWN0ZWRPcHRpb25JZCkge1xuICAgICAgICAvLyBHZXQgcGFnZSB0eXBlIGZvciB0aGUgc2VsZWN0ZWQgb3B0aW9uXG4gICAgICAgIHN3aXRjaCAoc2VsZWN0ZWRPcHRpb25JZCkge1xuICAgICAgICAgICAgY2FzZSAoXCJub25lU2VsZWN0ZWRcIik6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIChcImJ1bGxldGluXCIpOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgXCJwYWdlTmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImVkaXRpb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlRGF0ZVwiXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgKFwiYXJ0aWNsZVwiKToge1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIFwicGFnZU5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJlZGl0aW9uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIChcImRhdGFzZXRfbGFuZGluZ19wYWdlXCIpOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgXCJwYWdlTmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCJcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAoXCJ0aW1lc2VyaWVzX2RhdGFzZXRfbGFuZGluZ19wYWdlXCIpOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgXCJwYWdlTmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VEYXRlXCJcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pc2VkIHNlbGVjdGVkIG9wdGlvbiBpZCwgZG9lc24ndCBtYXAgdG8gYSBwYWdlIHR5cGVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0UGFnZU1vZGVsOiBmdW5jdGlvbihzZWxlY3RlZE9wdGlvbklkKSB7XG4gICAgICAgIHN3aXRjaCAoc2VsZWN0ZWRPcHRpb25JZCkge1xuICAgICAgICAgICAgY2FzZSAoXCJidWxsZXRpblwiKToge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYWdlTW9kZWxzLmJ1bGxldGluO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAoXCJhcnRpY2xlXCIpOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZ2VNb2RlbHMuYXJ0aWNsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0VmFsaWRQYWdlVHlwZXNGb3JMb2NhdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8qIFJldHVybnMgYW4gYXJyYXkgb2YgcGFnZSB0eXBlcyB0aGF0IGNhbiBiZSBjcmVhdGVkIGF0IGEgVVJJICovXG4gICAgICAgIHZhciB2YWxpZFBhZ2VUeXBlcyA9IFtdO1xuXG4gICAgICAgIHN3aXRjaCAoYWN0aXZlUGFnZVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgKFwiaG9tZV9wYWdlXCIpOiB7XG4gICAgICAgICAgICAgICAgdmFsaWRQYWdlVHlwZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIFwidmlzdWFsaXNhdGlvblwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VcIlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIChcInByb2R1Y3RfcGFnZVwiKToge1xuICAgICAgICAgICAgICAgIHZhbGlkUGFnZVR5cGVzID0gW1xuICAgICAgICAgICAgICAgICAgICBcImJ1bGxldGluXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYXJ0aWNsZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImFydGljbGVfZG93bmxvYWRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjb21wZW5kaXVtX2xhbmRpbmdfcGFnZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInN0YXRpY19tZXRob2RvbG9neVwiLFxuICAgICAgICAgICAgICAgICAgICBcInN0YXRpY19tZXRob2RvbG9neV9kb3dubG9hZFwiLFxuICAgICAgICAgICAgICAgICAgICBcInN0YXRpY19xbWlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzdGF0aWNfYWRob2NcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkYXRhc2V0X2xhbmRpbmdfcGFnZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInRpbWVzZXJpZXNfZGF0YXNldF9sYW5kaW5nX3BhZ2VcIlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIChcImJ1bGxldGluXCIpOiB7XG4gICAgICAgICAgICAgICAgdmFsaWRQYWdlVHlwZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIFwiYnVsbGV0aW5cIlxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIChcImFydGljbGVcIik6IHtcbiAgICAgICAgICAgICAgICB2YWxpZFBhZ2VUeXBlcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgXCJhcnRpY2xlXCJcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAoXCJjb21wZW5kaXVtXCIpOiB7XG4gICAgICAgICAgICAgICAgdmFsaWRQYWdlVHlwZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIFwiY29tcGVuZGl1bV9jaGFwdGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiY29tcGVuZGl1bV9kYXRhXCJcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbGlkUGFnZVR5cGVzO1xuICAgIH0sXG5cbiAgICBhbGxQYWdlVHlwZU9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKiBBbGwgcG9zc2libGUgPG9wdGlvbj4gZWxlbWVudHMgdGhhdCBjYW4gYmUgdXNlZCBpbiBwYWdlIHR5cGUgPHNlbGVjdD4gKi9cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogXCJidWxsZXRpblwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlN0YXRpc3RpY2FsIGJ1bGxldGluXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwiYXJ0aWNsZVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkFydGljbGVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogXCJhcnRpY2xlX2Rvd25sb2FkXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQXJ0aWNsZSBbUERGXVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcImNvbXBlbmRpdW1fbGFuZGluZ19wYWdlXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQ29tcGVuZGl1bVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcImNvbXBlbmRpdW1fY2hhcHRlclwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkNvbXBlbmRpdW0gY2hhcHRlclwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcImNvbXBlbmRpdW1fZGF0YVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkNvbXBlbmRpdW0gZGF0YVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcInN0YXRpY19sYW5kaW5nX3BhZ2VcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJTdGF0aWMgbGFuZGluZyBwYWdlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwic3RhdGljX3BhZ2VcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJTdGF0aWMgcGFnZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcInN0YXRpY19hcnRpY2xlXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiU3RhdGljIGFydGljbGVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogXCJzdGF0aWNfZm9pXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiRk9JXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwic3RhdGljX3FtaVwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlFNSVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcInN0YXRpY19hZGhvY1wiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlVzZXIgcmVxdWVzdGVkIGRhdGFcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogXCJzdGF0aWNfbWV0aG9kb2xvZ3lcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJNZXRob2RvbG9neSBhcnRpY2xlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwic3RhdGljX21ldGhvZG9sb2d5X2Rvd25sb2FkXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiTWV0aG9kb2xvZ3kgYXJ0aWNsZSBbUERGXVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcImRhdGFzZXRfbGFuZGluZ19wYWdlXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiRGF0YXNldCBsYW5kaW5nIHBhZ2VcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogXCJ0aW1lc2VyaWVzX2RhdGFzZXRfbGFuZGluZ19wYWdlXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiVGltZXNlcmllcyBkYXRhIGxhbmRpbmcgcGFnZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcImRhdGFzZXRcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJEYXRhc2V0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwidGltZXNlcmllc19kYXRhc2V0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiVGltZXNlcmllcyBkYXRhc2V0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFwidmlzdWFsaXNhdGlvblwiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRhdGEgdmlzdWFsaXNhdGlvblwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiBcInJlbGVhc2VcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJDYWxlbmRhciBlbnRyeVwiXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfSxcblxuICAgIGdldFZhbGlkUGFnZU9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdmFsaWRQYWdlVHlwZXMgPSBjcmVhdGVDb250cm9sbGVyLmdldFZhbGlkUGFnZVR5cGVzRm9yTG9jYXRpb24oKSxcbiAgICAgICAgICAgIHZhbGlkUGFnZVR5cGVzTGVuZ3RoID0gdmFsaWRQYWdlVHlwZXMubGVuZ3RoLFxuICAgICAgICAgICAgdmFsaWRQYWdlT3B0aW9ucyA9IGNyZWF0ZUNvbnRyb2xsZXIuYWxsUGFnZVR5cGVPcHRpb25zKCksXG4gICAgICAgICAgICB2YWxpZFBhZ2VPcHRpb25zTGVuZ3RoID0gdmFsaWRQYWdlT3B0aW9ucy5sZW5ndGgsXG4gICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgIG5lc3RlZEluZGV4O1xuXG4gICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHZhbGlkUGFnZU9wdGlvbnNMZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGZvciAobmVzdGVkSW5kZXggPSAwOyBuZXN0ZWRJbmRleCA8IHZhbGlkUGFnZVR5cGVzTGVuZ3RoOyBuZXN0ZWRJbmRleCsrKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodmFsaWRQYWdlT3B0aW9uc1tpbmRleF0uaWQgPT0gdmFsaWRQYWdlVHlwZXNbbmVzdGVkSW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkUGFnZU9wdGlvbnNbaW5kZXhdLnZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodmFsaWRQYWdlT3B0aW9uc1tpbmRleF0uaWQgPT09IGFjdGl2ZVBhZ2VUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkUGFnZU9wdGlvbnNbaW5kZXhdLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsaWRQYWdlT3B0aW9ucztcbiAgICB9XG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlQ29udHJvbGxlcjtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvd29ya3NwYWNlL2NyZWF0ZS9jcmVhdGVDb250cm9sbGVyLmpzIl0sIm1hcHBpbmdzIjoiOztBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQWpDQTtBQW1DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBWUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQXpDQTtBQUNBO0FBMkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6WEE7QUFDQTtBQTJYQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 59 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar createTemplate = __webpack_require__(60);\n\nvar createView = {\n\n    render: function render(templateData) {\n        document.getElementById('workspace-browse').innerHTML = createTemplate(templateData);\n    },\n\n    inputs: {\n\n        append: function append(inputHtml) {\n            document.getElementById('js-create__optional-inputs').innerHTML += inputHtml;\n        },\n\n        empty: function empty() {\n            document.getElementById('js-create__optional-inputs').innerHTML = '';\n        }\n    },\n\n    findErrorElement: function findErrorElement(inputId) {\n        var siblings = document.getElementById(inputId).parentNode.children,\n            siblingsLength = siblings.length,\n            i,\n            errorElement;\n\n        for (i = 0; i < siblingsLength; i++) {\n            if (siblings[i].classList.contains(\"js-create__input-error\")) {\n                errorElement = siblings[i];\n                break;\n            }\n        }\n\n        return errorElement;\n    },\n\n    renderInputError: {\n\n        clearAll: function clearAll() {\n            var errorElements = document.getElementsByClassName('js-create__input-error'),\n                errorElementsLength = errorElements.length,\n                i;\n\n            for (i = 0; i < errorElementsLength; i++) {\n                errorElements[i].innerHTML = \"\";\n            }\n        },\n\n        pageType: function pageType(error) {\n            var errorElement = createView.findErrorElement('pageType');\n            errorElement.innerHTML = error;\n        },\n\n        edition: function edition(error) {\n            var errorElement = createView.findErrorElement('edition');\n            errorElement.innerHTML = error;\n        },\n\n        releaseDate: function releaseDate(error) {\n            var errorElement = createView.findErrorElement('releaseDate');\n            errorElement.innerHTML = error;\n        }\n    },\n\n    inputHtml: function inputHtml(inputType) {\n\n        switch (inputType) {\n            case \"pageName\":\n                {\n                    return '<div><label for=\"pagename\" class=\"hidden\">Page name</label>' + '<input id=\"pagename\" name=\"pagename\" required minlength=\"4\" class=\"full\" type=\"text\" placeholder=\"Page name\"/>' + '<span class=\"js-create__input-error\"></span></div>';\n                }\n            case \"edition\":\n                {\n                    return '<div><label for=\"edition\">Edition</label>' + '<input id=\"edition\" name=\"edition\" type=\"text\" placeholder=\"August 2010, Q3 2015, 1978, etc.\" />' + '<span class=\"js-create__input-error\"></span></div>';\n                }\n            case \"releaseDate\":\n                {\n                    return '<div><label for=\"releaseDate\">Release date</label>' + '<input id=\"releaseDate\" name=\"releaseDate\" required type=\"text\" placeholder=\"day month year\" />' + '<span class=\"js-create__input-error\"></span></div>';\n                }\n            default:\n                {\n                    console.log('Input type for HTML requested from createView class not recognised');\n                    return false;\n                }\n        }\n    }\n\n};\n\nmodule.exports = createView;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9jcmVhdGUvY3JlYXRlVmlldy5qcz80Y2M0Il0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIGNyZWF0ZVRlbXBsYXRlID0gcmVxdWlyZSgnLi9jcmVhdGUuaGFuZGxlYmFycycpO1xuXG52YXIgY3JlYXRlVmlldyA9IHtcblxuICAgIHJlbmRlcjogZnVuY3Rpb24odGVtcGxhdGVEYXRhKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3b3Jrc3BhY2UtYnJvd3NlJykuaW5uZXJIVE1MID0gY3JlYXRlVGVtcGxhdGUodGVtcGxhdGVEYXRhKTtcbiAgICB9LFxuXG4gICAgaW5wdXRzOiB7XG5cbiAgICAgICAgYXBwZW5kOiBmdW5jdGlvbihpbnB1dEh0bWwpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqcy1jcmVhdGVfX29wdGlvbmFsLWlucHV0cycpLmlubmVySFRNTCArPSBpbnB1dEh0bWw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW1wdHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzLWNyZWF0ZV9fb3B0aW9uYWwtaW5wdXRzJykuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZmluZEVycm9yRWxlbWVudDogZnVuY3Rpb24oaW5wdXRJZCkge1xuICAgICAgICB2YXIgc2libGluZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbnB1dElkKS5wYXJlbnROb2RlLmNoaWxkcmVuLFxuICAgICAgICAgICAgc2libGluZ3NMZW5ndGggPSBzaWJsaW5ncy5sZW5ndGgsXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgZXJyb3JFbGVtZW50O1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaWJsaW5nc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoc2libGluZ3NbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKFwianMtY3JlYXRlX19pbnB1dC1lcnJvclwiKSkge1xuICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudCA9IHNpYmxpbmdzW2ldO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVycm9yRWxlbWVudDtcbiAgICB9LFxuXG4gICAgcmVuZGVySW5wdXRFcnJvcjoge1xuXG4gICAgICAgIGNsZWFyQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBlcnJvckVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtY3JlYXRlX19pbnB1dC1lcnJvcicpLFxuICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudHNMZW5ndGggPSBlcnJvckVsZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBpO1xuXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZXJyb3JFbGVtZW50c0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JFbGVtZW50c1tpXS5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBhZ2VUeXBlOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGNyZWF0ZVZpZXcuZmluZEVycm9yRWxlbWVudCgncGFnZVR5cGUnKTtcbiAgICAgICAgICAgIGVycm9yRWxlbWVudC5pbm5lckhUTUwgPSBlcnJvcjtcbiAgICAgICAgfSxcblxuICAgICAgICBlZGl0aW9uOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGNyZWF0ZVZpZXcuZmluZEVycm9yRWxlbWVudCgnZWRpdGlvbicpO1xuICAgICAgICAgICAgZXJyb3JFbGVtZW50LmlubmVySFRNTCA9IGVycm9yO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbGVhc2VEYXRlOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGNyZWF0ZVZpZXcuZmluZEVycm9yRWxlbWVudCgncmVsZWFzZURhdGUnKTtcbiAgICAgICAgICAgIGVycm9yRWxlbWVudC5pbm5lckhUTUwgPSBlcnJvcjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbnB1dEh0bWw6IGZ1bmN0aW9uKGlucHV0VHlwZSkge1xuXG4gICAgICAgIHN3aXRjaCAoaW5wdXRUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIChcInBhZ2VOYW1lXCIpOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2PjxsYWJlbCBmb3I9XCJwYWdlbmFtZVwiIGNsYXNzPVwiaGlkZGVuXCI+UGFnZSBuYW1lPC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBpZD1cInBhZ2VuYW1lXCIgbmFtZT1cInBhZ2VuYW1lXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiNFwiIGNsYXNzPVwiZnVsbFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJQYWdlIG5hbWVcIi8+JyArXG4gICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cImpzLWNyZWF0ZV9faW5wdXQtZXJyb3JcIj48L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgKFwiZWRpdGlvblwiKToge1xuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdj48bGFiZWwgZm9yPVwiZWRpdGlvblwiPkVkaXRpb248L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPVwiZWRpdGlvblwiIG5hbWU9XCJlZGl0aW9uXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkF1Z3VzdCAyMDEwLCBRMyAyMDE1LCAxOTc4LCBldGMuXCIgLz4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwianMtY3JlYXRlX19pbnB1dC1lcnJvclwiPjwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAoXCJyZWxlYXNlRGF0ZVwiKToge1xuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdj48bGFiZWwgZm9yPVwicmVsZWFzZURhdGVcIj5SZWxlYXNlIGRhdGU8L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGlkPVwicmVsZWFzZURhdGVcIiBuYW1lPVwicmVsZWFzZURhdGVcIiByZXF1aXJlZCB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiZGF5IG1vbnRoIHllYXJcIiAvPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJqcy1jcmVhdGVfX2lucHV0LWVycm9yXCI+PC9zcGFuPjwvZGl2Pic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0lucHV0IHR5cGUgZm9yIEhUTUwgcmVxdWVzdGVkIGZyb20gY3JlYXRlVmlldyBjbGFzcyBub3QgcmVjb2duaXNlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlVmlldztcblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC93b3Jrc3BhY2UvY3JlYXRlL2NyZWF0ZVZpZXcuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6QkE7QUFDQTtBQTJCQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBcUJBO0FBQ0E7QUFyRkE7QUFDQTtBQXlGQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 60 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.valid : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(2, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"2\":function(depth0,helpers,partials,data) {\n    var stack1, helper, alias1=helpers.helperMissing, alias2=\"function\", alias3=this.escapeExpression;\n\n  return \"                            <option \"\n    + ((stack1 = helpers['if'].call(depth0,(depth0 != null ? depth0.active : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":this.program(3, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \" value=\\\"\"\n    + alias3(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" name=\\\"\"\n    + alias3(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\"\n    + alias3(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"title\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</option>\\n\";\n},\"3\":function(depth0,helpers,partials,data) {\n    return \"selected\";\n},\"5\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return ((stack1 = helpers.unless.call(depth0,(depth0 != null ? depth0.valid : depth0),{\"name\":\"unless\",\"hash\":{},\"fn\":this.program(6, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"6\":function(depth0,helpers,partials,data) {\n    var helper, alias1=helpers.helperMissing, alias2=\"function\", alias3=this.escapeExpression;\n\n  return \"                            <option value=\\\"\"\n    + alias3(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" name=\\\"\"\n    + alias3(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" disabled>\"\n    + alias3(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : alias1),(typeof helper === alias2 ? helper.call(depth0,{\"name\":\"title\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</option>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<section class=\\\"panel workspace-create\\\" id=\\\"js-create\\\">\\n    <h1>New page details</h1>\\n    <form id=\\\"js-create__form\\\">\\n        <div>\\n            <label for=\\\"pageType\\\" class=\\\"hidden\\\">Page type</label>\\n            <div class=\\\"select-wrap\\\">\\n                <select id=\\\"pageType\\\" required>\\n                    <option value=\\\"\\\" name=\\\"noneSelected\\\"> --- Select page type ---</option>\\n\"\n    + ((stack1 = helpers.each.call(depth0,depth0,{\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\"\n    + ((stack1 = helpers.each.call(depth0,depth0,{\"name\":\"each\",\"hash\":{},\"fn\":this.program(5, data, 0),\"inverse\":this.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"                </select>\\n            </div>\\n            <span class=\\\"js-create__input-error\\\"></span>\\n        </div>\\n        <div id=\\\"js-create__optional-inputs\\\"></div>\\n        <button class=\\\"btn btn--positive margin-left--0 btn-page-create\\\">Create page</button>\\n    </form>\\n</section>\\n\";\n},\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL2NyZWF0ZS9jcmVhdGUuaGFuZGxlYmFycz9kODdmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBIYW5kbGViYXJzID0gcmVxdWlyZShcIi9Vc2Vycy9jcmlzcGlubWVycmltYW4vR2l0L29uc2RpZ2l0YWwvZmxvcmVuY2Uvc3JjL25vZGVfbW9kdWxlcy9oYW5kbGViYXJzL3J1bnRpbWUuanNcIik7XG5mdW5jdGlvbiBfX2RlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgKG9iai5fX2VzTW9kdWxlID8gb2JqW1wiZGVmYXVsdFwiXSA6IG9iaik7IH1cbm1vZHVsZS5leHBvcnRzID0gKEhhbmRsZWJhcnNbXCJkZWZhdWx0XCJdIHx8IEhhbmRsZWJhcnMpLnRlbXBsYXRlKHtcIjFcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC52YWxpZCA6IGRlcHRoMCkse1wibmFtZVwiOlwiaWZcIixcImhhc2hcIjp7fSxcImZuXCI6dGhpcy5wcm9ncmFtKDIsIGRhdGEsIDApLFwiaW52ZXJzZVwiOnRoaXMubm9vcCxcImRhdGFcIjpkYXRhfSkpICE9IG51bGwgPyBzdGFjazEgOiBcIlwiKTtcbn0sXCIyXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazEsIGhlbHBlciwgYWxpYXMxPWhlbHBlcnMuaGVscGVyTWlzc2luZywgYWxpYXMyPVwiZnVuY3Rpb25cIiwgYWxpYXMzPXRoaXMuZXNjYXBlRXhwcmVzc2lvbjtcblxuICByZXR1cm4gXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiBcIlxuICAgICsgKChzdGFjazEgPSBoZWxwZXJzWydpZiddLmNhbGwoZGVwdGgwLChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5hY3RpdmUgOiBkZXB0aDApLHtcIm5hbWVcIjpcImlmXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgzLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiIHZhbHVlPVxcXCJcIlxuICAgICsgYWxpYXMzKCgoaGVscGVyID0gKGhlbHBlciA9IGhlbHBlcnMuaWQgfHwgKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmlkIDogZGVwdGgwKSkgIT0gbnVsbCA/IGhlbHBlciA6IGFsaWFzMSksKHR5cGVvZiBoZWxwZXIgPT09IGFsaWFzMiA/IGhlbHBlci5jYWxsKGRlcHRoMCx7XCJuYW1lXCI6XCJpZFwiLFwiaGFzaFwiOnt9LFwiZGF0YVwiOmRhdGF9KSA6IGhlbHBlcikpKVxuICAgICsgXCJcXFwiIG5hbWU9XFxcIlwiXG4gICAgKyBhbGlhczMoKChoZWxwZXIgPSAoaGVscGVyID0gaGVscGVycy5pZCB8fCAoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAuaWQgOiBkZXB0aDApKSAhPSBudWxsID8gaGVscGVyIDogYWxpYXMxKSwodHlwZW9mIGhlbHBlciA9PT0gYWxpYXMyID8gaGVscGVyLmNhbGwoZGVwdGgwLHtcIm5hbWVcIjpcImlkXCIsXCJoYXNoXCI6e30sXCJkYXRhXCI6ZGF0YX0pIDogaGVscGVyKSkpXG4gICAgKyBcIlxcXCI+XCJcbiAgICArIGFsaWFzMygoKGhlbHBlciA9IChoZWxwZXIgPSBoZWxwZXJzLnRpdGxlIHx8IChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC50aXRsZSA6IGRlcHRoMCkpICE9IG51bGwgPyBoZWxwZXIgOiBhbGlhczEpLCh0eXBlb2YgaGVscGVyID09PSBhbGlhczIgPyBoZWxwZXIuY2FsbChkZXB0aDAse1wibmFtZVwiOlwidGl0bGVcIixcImhhc2hcIjp7fSxcImRhdGFcIjpkYXRhfSkgOiBoZWxwZXIpKSlcbiAgICArIFwiPC9vcHRpb24+XFxuXCI7XG59LFwiM1wiOmZ1bmN0aW9uKGRlcHRoMCxoZWxwZXJzLHBhcnRpYWxzLGRhdGEpIHtcbiAgICByZXR1cm4gXCJzZWxlY3RlZFwiO1xufSxcIjVcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIHN0YWNrMTtcblxuICByZXR1cm4gKChzdGFjazEgPSBoZWxwZXJzLnVubGVzcy5jYWxsKGRlcHRoMCwoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudmFsaWQgOiBkZXB0aDApLHtcIm5hbWVcIjpcInVubGVzc1wiLFwiaGFzaFwiOnt9LFwiZm5cIjp0aGlzLnByb2dyYW0oNiwgZGF0YSwgMCksXCJpbnZlcnNlXCI6dGhpcy5ub29wLFwiZGF0YVwiOmRhdGF9KSkgIT0gbnVsbCA/IHN0YWNrMSA6IFwiXCIpO1xufSxcIjZcIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIGhlbHBlciwgYWxpYXMxPWhlbHBlcnMuaGVscGVyTWlzc2luZywgYWxpYXMyPVwiZnVuY3Rpb25cIiwgYWxpYXMzPXRoaXMuZXNjYXBlRXhwcmVzc2lvbjtcblxuICByZXR1cm4gXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cXFwiXCJcbiAgICArIGFsaWFzMygoKGhlbHBlciA9IChoZWxwZXIgPSBoZWxwZXJzLmlkIHx8IChkZXB0aDAgIT0gbnVsbCA/IGRlcHRoMC5pZCA6IGRlcHRoMCkpICE9IG51bGwgPyBoZWxwZXIgOiBhbGlhczEpLCh0eXBlb2YgaGVscGVyID09PSBhbGlhczIgPyBoZWxwZXIuY2FsbChkZXB0aDAse1wibmFtZVwiOlwiaWRcIixcImhhc2hcIjp7fSxcImRhdGFcIjpkYXRhfSkgOiBoZWxwZXIpKSlcbiAgICArIFwiXFxcIiBuYW1lPVxcXCJcIlxuICAgICsgYWxpYXMzKCgoaGVscGVyID0gKGhlbHBlciA9IGhlbHBlcnMuaWQgfHwgKGRlcHRoMCAhPSBudWxsID8gZGVwdGgwLmlkIDogZGVwdGgwKSkgIT0gbnVsbCA/IGhlbHBlciA6IGFsaWFzMSksKHR5cGVvZiBoZWxwZXIgPT09IGFsaWFzMiA/IGhlbHBlci5jYWxsKGRlcHRoMCx7XCJuYW1lXCI6XCJpZFwiLFwiaGFzaFwiOnt9LFwiZGF0YVwiOmRhdGF9KSA6IGhlbHBlcikpKVxuICAgICsgXCJcXFwiIGRpc2FibGVkPlwiXG4gICAgKyBhbGlhczMoKChoZWxwZXIgPSAoaGVscGVyID0gaGVscGVycy50aXRsZSB8fCAoZGVwdGgwICE9IG51bGwgPyBkZXB0aDAudGl0bGUgOiBkZXB0aDApKSAhPSBudWxsID8gaGVscGVyIDogYWxpYXMxKSwodHlwZW9mIGhlbHBlciA9PT0gYWxpYXMyID8gaGVscGVyLmNhbGwoZGVwdGgwLHtcIm5hbWVcIjpcInRpdGxlXCIsXCJoYXNoXCI6e30sXCJkYXRhXCI6ZGF0YX0pIDogaGVscGVyKSkpXG4gICAgKyBcIjwvb3B0aW9uPlxcblwiO1xufSxcImNvbXBpbGVyXCI6WzYsXCI+PSAyLjAuMC1iZXRhLjFcIl0sXCJtYWluXCI6ZnVuY3Rpb24oZGVwdGgwLGhlbHBlcnMscGFydGlhbHMsZGF0YSkge1xuICAgIHZhciBzdGFjazE7XG5cbiAgcmV0dXJuIFwiPHNlY3Rpb24gY2xhc3M9XFxcInBhbmVsIHdvcmtzcGFjZS1jcmVhdGVcXFwiIGlkPVxcXCJqcy1jcmVhdGVcXFwiPlxcbiAgICA8aDE+TmV3IHBhZ2UgZGV0YWlsczwvaDE+XFxuICAgIDxmb3JtIGlkPVxcXCJqcy1jcmVhdGVfX2Zvcm1cXFwiPlxcbiAgICAgICAgPGRpdj5cXG4gICAgICAgICAgICA8bGFiZWwgZm9yPVxcXCJwYWdlVHlwZVxcXCIgY2xhc3M9XFxcImhpZGRlblxcXCI+UGFnZSB0eXBlPC9sYWJlbD5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJzZWxlY3Qtd3JhcFxcXCI+XFxuICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9XFxcInBhZ2VUeXBlXFxcIiByZXF1aXJlZD5cXG4gICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XFxcIlxcXCIgbmFtZT1cXFwibm9uZVNlbGVjdGVkXFxcIj4gLS0tIFNlbGVjdCBwYWdlIHR5cGUgLS0tPC9vcHRpb24+XFxuXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVycy5lYWNoLmNhbGwoZGVwdGgwLGRlcHRoMCx7XCJuYW1lXCI6XCJlYWNoXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSgxLCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiXFxuXCJcbiAgICArICgoc3RhY2sxID0gaGVscGVycy5lYWNoLmNhbGwoZGVwdGgwLGRlcHRoMCx7XCJuYW1lXCI6XCJlYWNoXCIsXCJoYXNoXCI6e30sXCJmblwiOnRoaXMucHJvZ3JhbSg1LCBkYXRhLCAwKSxcImludmVyc2VcIjp0aGlzLm5vb3AsXCJkYXRhXCI6ZGF0YX0pKSAhPSBudWxsID8gc3RhY2sxIDogXCJcIilcbiAgICArIFwiICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJqcy1jcmVhdGVfX2lucHV0LWVycm9yXFxcIj48L3NwYW4+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDxkaXYgaWQ9XFxcImpzLWNyZWF0ZV9fb3B0aW9uYWwtaW5wdXRzXFxcIj48L2Rpdj5cXG4gICAgICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tLXBvc2l0aXZlIG1hcmdpbi1sZWZ0LS0wIGJ0bi1wYWdlLWNyZWF0ZVxcXCI+Q3JlYXRlIHBhZ2U8L2J1dHRvbj5cXG4gICAgPC9mb3JtPlxcbjwvc2VjdGlvbj5cXG5cIjtcbn0sXCJ1c2VEYXRhXCI6dHJ1ZX0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYXBwL3dvcmtzcGFjZS9jcmVhdGUvY3JlYXRlLmhhbmRsZWJhcnNcbi8vIG1vZHVsZSBpZCA9IDYwXG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 61 */
/***/ function(module, exports) {

	eval("'use strict';\n\nvar bindDatePicker = function bindDatePicker() {\n    $('#releaseDate').datepicker({\n        dateFormat: 'dd MM yy'\n    });\n};\n\nmodule.exports = bindDatePicker;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC91dGlsaXRpZXMvYmluZERhdGVQaWNrZXIuanM/MDM2YiJdLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBiaW5kRGF0ZVBpY2tlciA9IGZ1bmN0aW9uKCkge1xuICAgICQoJyNyZWxlYXNlRGF0ZScpLmRhdGVwaWNrZXIoe1xuICAgICAgICBkYXRlRm9ybWF0OiAnZGQgTU0geXknXG4gICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGJpbmREYXRlUGlja2VyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9zaGFyZWQvdXRpbGl0aWVzL2JpbmREYXRlUGlja2VyLmpzIl0sIm1hcHBpbmdzIjoiOztBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 62 */
/***/ function(module, exports) {

	eval("\"use strict\";\n\nvar pageModels = {\n\n    bulletin: {\n        \"description\": {\n            \"title\": \"\",\n            \"edition\": \"\",\n            \"summary\": \"\",\n            \"releaseDate\": \"\",\n            \"nextRelease\": \"\",\n            \"contact\": {\n                \"name\": \"\",\n                \"email\": \"\",\n                \"telephone\": \"\"\n            },\n            \"nationalStatistic\": false,\n            \"headline1\": \"\",\n            \"headline2\": \"\",\n            \"headline3\": \"\",\n            \"keywords\": [],\n            \"metaDescription\": \"\"\n        },\n        \"sections\": [],\n        \"accordion\": [],\n        \"relatedDocuments\": [],\n        \"relatedData\": [],\n        \"relatedMethodology\": [],\n        \"relatedMethodologyArticle\": [],\n        \"topics\": [],\n        \"links\": [],\n        \"charts\": [],\n        \"tables\": [],\n        \"equations\": [],\n        \"pdfTable\": [],\n        \"images\": [],\n        \"alerts\": [],\n        \"versions\": [],\n        type: 'bulletin'\n    },\n\n    article: {\n        \"description\": {\n            \"title\": \"\",\n            \"edition\": \"\",\n            \"_abstract\": \"\",\n            \"releaseDate\": \"\",\n            \"nextRelease\": \"\",\n            \"contact\": {\n                \"name\": \"\",\n                \"email\": \"\",\n                \"telephone\": \"\"\n            },\n            \"nationalStatistic\": false,\n            \"keywords\": [],\n            \"metaDescription\": \"\"\n        },\n        \"sections\": [],\n        \"accordion\": [],\n        \"relatedDocuments\": [],\n        \"relatedData\": [],\n        \"relatedMethodology\": [],\n        \"relatedMethodologyArticle\": [],\n        \"topics\": [],\n        \"links\": [],\n        \"charts\": [],\n        \"tables\": [],\n        \"equations\": [],\n        \"pdfTable\": [],\n        \"images\": [],\n        \"alerts\": [],\n        \"versions\": [],\n        type: \"article\"\n    }\n};\n\nmodule.exports = pageModels;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9tb2RlbHMvcGFnZU1vZGVscy5qcz9iZjU3Il0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIHBhZ2VNb2RlbHMgPSB7XG5cbiAgICBidWxsZXRpbjoge1xuICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgIFwiZWRpdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgXCJzdW1tYXJ5XCI6IFwiXCIsXG4gICAgICAgICAgICBcInJlbGVhc2VEYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICBcIm5leHRSZWxlYXNlXCI6IFwiXCIsXG4gICAgICAgICAgICBcImNvbnRhY3RcIjoge1xuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwiZW1haWxcIjogXCJcIixcbiAgICAgICAgICAgICAgICBcInRlbGVwaG9uZVwiOiBcIlwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJuYXRpb25hbFN0YXRpc3RpY1wiOiBmYWxzZSxcbiAgICAgICAgICAgIFwiaGVhZGxpbmUxXCI6IFwiXCIsXG4gICAgICAgICAgICBcImhlYWRsaW5lMlwiOiBcIlwiLFxuICAgICAgICAgICAgXCJoZWFkbGluZTNcIjogXCJcIixcbiAgICAgICAgICAgIFwia2V5d29yZHNcIjogW10sXG4gICAgICAgICAgICBcIm1ldGFEZXNjcmlwdGlvblwiOiBcIlwiXG4gICAgICAgIH0sXG4gICAgICAgIFwic2VjdGlvbnNcIjogW10sXG4gICAgICAgIFwiYWNjb3JkaW9uXCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWREb2N1bWVudHNcIjogW10sXG4gICAgICAgIFwicmVsYXRlZERhdGFcIjogW10sXG4gICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5XCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neUFydGljbGVcIjogW10sXG4gICAgICAgIFwidG9waWNzXCI6IFtdLFxuICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICBcImNoYXJ0c1wiOiBbXSxcbiAgICAgICAgXCJ0YWJsZXNcIjogW10sXG4gICAgICAgIFwiZXF1YXRpb25zXCI6IFtdLFxuICAgICAgICBcInBkZlRhYmxlXCI6IFtdLFxuICAgICAgICBcImltYWdlc1wiOiBbXSxcbiAgICAgICAgXCJhbGVydHNcIjogW10sXG4gICAgICAgIFwidmVyc2lvbnNcIjogW10sXG4gICAgICAgIHR5cGU6ICdidWxsZXRpbidcbiAgICB9LFxuXG4gICAgYXJ0aWNsZToge1xuICAgICAgICBcImRlc2NyaXB0aW9uXCI6IHtcbiAgICAgICAgICAgIFwidGl0bGVcIjogXCJcIixcbiAgICAgICAgICAgIFwiZWRpdGlvblwiOiBcIlwiLFxuICAgICAgICAgICAgXCJfYWJzdHJhY3RcIjogXCJcIixcbiAgICAgICAgICAgIFwicmVsZWFzZURhdGVcIjogXCJcIixcbiAgICAgICAgICAgIFwibmV4dFJlbGVhc2VcIjogXCJcIixcbiAgICAgICAgICAgIFwiY29udGFjdFwiOiB7XG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJlbWFpbFwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwidGVsZXBob25lXCI6IFwiXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm5hdGlvbmFsU3RhdGlzdGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgXCJrZXl3b3Jkc1wiOiBbXSxcbiAgICAgICAgICAgIFwibWV0YURlc2NyaXB0aW9uXCI6IFwiXCIsXG4gICAgICAgIH0sXG4gICAgICAgIFwic2VjdGlvbnNcIjogW10sXG4gICAgICAgIFwiYWNjb3JkaW9uXCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWREb2N1bWVudHNcIjogW10sXG4gICAgICAgIFwicmVsYXRlZERhdGFcIjogW10sXG4gICAgICAgIFwicmVsYXRlZE1ldGhvZG9sb2d5XCI6IFtdLFxuICAgICAgICBcInJlbGF0ZWRNZXRob2RvbG9neUFydGljbGVcIjogW10sXG4gICAgICAgIFwidG9waWNzXCI6IFtdLFxuICAgICAgICBcImxpbmtzXCI6IFtdLFxuICAgICAgICBcImNoYXJ0c1wiOiBbXSxcbiAgICAgICAgXCJ0YWJsZXNcIjogW10sXG4gICAgICAgIFwiZXF1YXRpb25zXCI6IFtdLFxuICAgICAgICBcInBkZlRhYmxlXCI6IFtdLFxuICAgICAgICBcImltYWdlc1wiOiBbXSxcbiAgICAgICAgXCJhbGVydHNcIjogW10sXG4gICAgICAgIFwidmVyc2lvbnNcIjogW10sXG4gICAgICAgIHR5cGU6IFwiYXJ0aWNsZVwiXG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBwYWdlTW9kZWxzO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC9zaGFyZWQvbW9kZWxzL3BhZ2VNb2RlbHMuanMiXSwibWFwcGluZ3MiOiI7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWxDQTtBQUNBO0FBb0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQWJBO0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvQkE7QUF2Q0E7QUFDQTtBQXlFQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 63 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\n/**\n * Builds a safe URI from current state and POSTs to API. It handles any errors itself rather than passing it back up the stack\n *\n * @returns {Promise}\n */\n\nvar utilities = __webpack_require__(64),\n    post = __webpack_require__(65),\n    workspaceState = __webpack_require__(25),\n    collectionState = __webpack_require__(28);\n\nvar saveNewPage = function saveNewPage() {\n    var pageType = workspaceState.editorData.get().type,\n        pageEdition = workspaceState.editorData.get().description.edition ? workspaceState.editorData.get().description.edition : \"\",\n        pagePath = [],\n        activePageType = utilities.findNodeInBrowseTreeByUri(workspaceState.activeUrl.get()).type,\n        activeURL = workspaceState.activeUrl.get().split('/'),\n        index;\n\n    // Page being created as part of a series, remove unnecessary/duplicated entries from current activeURL\n    if (activePageType === \"article\" || activePageType === \"article_download\") {\n        index = activeURL.indexOf(\"articles\");\n        activeURL.splice(index, activeURL.length - index);\n    } else if (activePageType === \"bulletin\") {\n        index = activeURL.indexOf(\"bulletins\");\n        activeURL.splice(index, activeURL.length - index);\n    }\n\n    // Add current active location\n    pagePath = activeURL.concat(pagePath);\n\n    // Add page type to path\n    switch (pageType) {\n        case \"bulletin\":\n            {\n                pagePath.push(pageType + \"s\");\n                break;\n            }\n        case \"article\":\n            {\n                pagePath.push(pageType + \"s\");\n                break;\n            }\n        case \"article_download\":\n            {\n                pagePath.push(\"articles\");\n                break;\n            }\n        case \"dataset_landing_page\":\n            {\n                pagePath.push(\"datasets\");\n                break;\n            }\n        case \"compendium_landing_page\":\n            {\n                pagePath.push(\"compendium\");\n                break;\n            }\n        default:\n            {\n                console.log(\"Page type not recognised, so new page can't be saved\");\n                break;\n            }\n    }\n\n    // Add page title (which is checked for correct slashes)\n    pagePath.push(workspaceState.editorData.get().description.title);\n\n    // Add page edition (defaults to an empty string if not available)\n    pagePath.push(pageEdition);\n\n    // Build safe URI from pagePath string\n    pagePath = utilities.getSafeURI(pagePath.join('/'));\n\n    // Return the POST of latest editor data from state to API\n    return post('/zebedee/content/' + collectionState.get().id + '?uri=' + pagePath + '/data.json', workspaceState.editorData.get()).then(function () {\n        return pagePath;\n    }).catch(function (error) {\n        return error;\n    });\n};\n\nmodule.exports = saveNewPage;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC9hcGkvc2F2ZU5ld1BhZ2UuanM/OWNmMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJ1aWxkcyBhIHNhZmUgVVJJIGZyb20gY3VycmVudCBzdGF0ZSBhbmQgUE9TVHMgdG8gQVBJLiBJdCBoYW5kbGVzIGFueSBlcnJvcnMgaXRzZWxmIHJhdGhlciB0aGFuIHBhc3NpbmcgaXQgYmFjayB1cCB0aGUgc3RhY2tcbiAqXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAqL1xuXG5cbnZhciB1dGlsaXRpZXMgPSByZXF1aXJlKCdzaGFyZWQvdXRpbGl0aWVzL3V0aWxpdGllcycpLFxuICAgIHBvc3QgPSByZXF1aXJlKCdzaGFyZWQvdXRpbGl0aWVzL3Bvc3QnKSxcbiAgICB3b3Jrc3BhY2VTdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS93b3Jrc3BhY2VTdGF0ZScpLFxuICAgIGNvbGxlY3Rpb25TdGF0ZSA9IHJlcXVpcmUoJ3NoYXJlZC9zdGF0ZS9jb2xsZWN0aW9uU3RhdGUnKTtcblxudmFyIHNhdmVOZXdQYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhZ2VUeXBlID0gd29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKS50eXBlLFxuICAgICAgICBwYWdlRWRpdGlvbiA9IHdvcmtzcGFjZVN0YXRlLmVkaXRvckRhdGEuZ2V0KCkuZGVzY3JpcHRpb24uZWRpdGlvbiA/IHdvcmtzcGFjZVN0YXRlLmVkaXRvckRhdGEuZ2V0KCkuZGVzY3JpcHRpb24uZWRpdGlvbiA6IFwiXCIsXG4gICAgICAgIHBhZ2VQYXRoID0gW10sXG4gICAgICAgIGFjdGl2ZVBhZ2VUeXBlID0gdXRpbGl0aWVzLmZpbmROb2RlSW5Ccm93c2VUcmVlQnlVcmkod29ya3NwYWNlU3RhdGUuYWN0aXZlVXJsLmdldCgpKS50eXBlLFxuICAgICAgICBhY3RpdmVVUkwgPSB3b3Jrc3BhY2VTdGF0ZS5hY3RpdmVVcmwuZ2V0KCkuc3BsaXQoJy8nKSxcbiAgICAgICAgaW5kZXg7XG5cbiAgICAvLyBQYWdlIGJlaW5nIGNyZWF0ZWQgYXMgcGFydCBvZiBhIHNlcmllcywgcmVtb3ZlIHVubmVjZXNzYXJ5L2R1cGxpY2F0ZWQgZW50cmllcyBmcm9tIGN1cnJlbnQgYWN0aXZlVVJMXG4gICAgaWYgKGFjdGl2ZVBhZ2VUeXBlID09PSBcImFydGljbGVcIiB8fCBhY3RpdmVQYWdlVHlwZSA9PT0gXCJhcnRpY2xlX2Rvd25sb2FkXCIpIHtcbiAgICAgICAgaW5kZXggPSBhY3RpdmVVUkwuaW5kZXhPZihcImFydGljbGVzXCIpO1xuICAgICAgICBhY3RpdmVVUkwuc3BsaWNlKGluZGV4LCAoYWN0aXZlVVJMLmxlbmd0aC1pbmRleCkpO1xuICAgIH0gZWxzZSBpZiAoYWN0aXZlUGFnZVR5cGUgPT09IFwiYnVsbGV0aW5cIikge1xuICAgICAgICBpbmRleCA9IGFjdGl2ZVVSTC5pbmRleE9mKFwiYnVsbGV0aW5zXCIpO1xuICAgICAgICBhY3RpdmVVUkwuc3BsaWNlKGluZGV4LCAoYWN0aXZlVVJMLmxlbmd0aC1pbmRleCkpO1xuICAgIH1cblxuICAgIC8vIEFkZCBjdXJyZW50IGFjdGl2ZSBsb2NhdGlvblxuICAgIHBhZ2VQYXRoID0gYWN0aXZlVVJMLmNvbmNhdChwYWdlUGF0aCk7XG5cbiAgICAvLyBBZGQgcGFnZSB0eXBlIHRvIHBhdGhcbiAgICBzd2l0Y2ggKHBhZ2VUeXBlKSB7XG4gICAgICAgIGNhc2UgKFwiYnVsbGV0aW5cIik6IHtcbiAgICAgICAgICAgIHBhZ2VQYXRoLnB1c2gocGFnZVR5cGUgKyBcInNcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcImFydGljbGVcIik6IHtcbiAgICAgICAgICAgIHBhZ2VQYXRoLnB1c2gocGFnZVR5cGUgKyBcInNcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIChcImFydGljbGVfZG93bmxvYWRcIik6IHtcbiAgICAgICAgICAgIHBhZ2VQYXRoLnB1c2goXCJhcnRpY2xlc1wiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgKFwiZGF0YXNldF9sYW5kaW5nX3BhZ2VcIik6IHtcbiAgICAgICAgICAgIHBhZ2VQYXRoLnB1c2goXCJkYXRhc2V0c1wiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgKFwiY29tcGVuZGl1bV9sYW5kaW5nX3BhZ2VcIik6IHtcbiAgICAgICAgICAgIHBhZ2VQYXRoLnB1c2goXCJjb21wZW5kaXVtXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQYWdlIHR5cGUgbm90IHJlY29nbmlzZWQsIHNvIG5ldyBwYWdlIGNhbid0IGJlIHNhdmVkXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgcGFnZSB0aXRsZSAod2hpY2ggaXMgY2hlY2tlZCBmb3IgY29ycmVjdCBzbGFzaGVzKVxuICAgIHBhZ2VQYXRoLnB1c2god29ya3NwYWNlU3RhdGUuZWRpdG9yRGF0YS5nZXQoKS5kZXNjcmlwdGlvbi50aXRsZSk7XG5cbiAgICAvLyBBZGQgcGFnZSBlZGl0aW9uIChkZWZhdWx0cyB0byBhbiBlbXB0eSBzdHJpbmcgaWYgbm90IGF2YWlsYWJsZSlcbiAgICBwYWdlUGF0aC5wdXNoKHBhZ2VFZGl0aW9uKTtcblxuICAgIC8vIEJ1aWxkIHNhZmUgVVJJIGZyb20gcGFnZVBhdGggc3RyaW5nXG4gICAgcGFnZVBhdGggPSB1dGlsaXRpZXMuZ2V0U2FmZVVSSShwYWdlUGF0aC5qb2luKCcvJykpO1xuXG4gICAgLy8gUmV0dXJuIHRoZSBQT1NUIG9mIGxhdGVzdCBlZGl0b3IgZGF0YSBmcm9tIHN0YXRlIHRvIEFQSVxuICAgIHJldHVybiBwb3N0KCcvemViZWRlZS9jb250ZW50LycgKyBjb2xsZWN0aW9uU3RhdGUuZ2V0KCkuaWQgKyAnP3VyaT0nICsgcGFnZVBhdGggKyAnL2RhdGEuanNvbicsIHdvcmtzcGFjZVN0YXRlLmVkaXRvckRhdGEuZ2V0KClcbiAgICAgICAgKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBwYWdlUGF0aDtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBzYXZlTmV3UGFnZTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2hhcmVkL2FwaS9zYXZlTmV3UGFnZS5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0FBT0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBQ0E7QUEwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7Iiwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 64 */
/***/ function(module, exports, __webpack_require__) {

	eval("/* WEBPACK VAR INJECTION */(function(console) {'use strict';\n\nvar workspaceState = __webpack_require__(25);\n\nvar utilities = {\n\n    /* Strips a URI of any spaces, capitalisation */\n    getSafeURI: function getSafeURI(uri) {\n        var URIArray = uri.split('/'),\n            safeURI = [],\n            i;\n\n        for (i = 0; i < URIArray.length; i++) {\n            if (URIArray !== \"\") {\n                safeURI.push(URIArray[i].replace(/[^A-Z0-9]+/ig, \"\").toLowerCase());\n            }\n        }\n\n        safeURI = this.checkURISlashes(safeURI.join('/'));\n\n        return safeURI;\n    },\n\n    /* Removes trailing slash and add leading slash (if necessary) to string */\n    checkURISlashes: function checkURISlashes(uri) {\n        var checkedUri = uri[uri.length - 1] === '/' ? uri.substring(0, uri.length - 1) : uri;\n        checkedUri = checkedUri[0] !== '/' ? '/' + checkedUri : checkedUri;\n        return checkedUri;\n    },\n\n    /* Returns the object of the node that matches the given URI string */\n    findNodeInBrowseTreeByUri: function findNodeInBrowseTreeByUri(uri) {\n        // TODO this feels like a utility - it perhaps shouldn't live here at least?\n        var browseTreeData = workspaceState.browseTreeData.get(),\n            nodeObject = false;\n\n        if (!browseTreeData) {\n            console.log(\"Error: No browse tree data is currently stored in state\");\n            return;\n        }\n\n        if (uri === \"/\") {\n            return browseTreeData;\n        }\n\n        checkOneLayer(browseTreeData.children);\n\n        function checkOneLayer(array) {\n            array.forEach(function (object) {\n                if (object.uri === uri) {\n                    nodeObject = object;\n                }\n\n                if (!nodeObject && object.children && object.children.length > 0) {\n                    checkOneLayer(object.children);\n                }\n            });\n        }\n\n        return nodeObject;\n    }\n\n};\n\nmodule.exports = utilities;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC91dGlsaXRpZXMvdXRpbGl0aWVzLmpzPzJjZmQiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHdvcmtzcGFjZVN0YXRlID0gcmVxdWlyZSgnc2hhcmVkL3N0YXRlL3dvcmtzcGFjZVN0YXRlJyk7XG5cbnZhciB1dGlsaXRpZXMgPSB7XG5cbiAgICAvKiBTdHJpcHMgYSBVUkkgb2YgYW55IHNwYWNlcywgY2FwaXRhbGlzYXRpb24gKi9cbiAgICBnZXRTYWZlVVJJOiBmdW5jdGlvbih1cmkpIHtcbiAgICAgICAgdmFyIFVSSUFycmF5ID0gdXJpLnNwbGl0KCcvJyksXG4gICAgICAgICAgICBzYWZlVVJJID0gW10sXG4gICAgICAgICAgICBpO1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBVUklBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKFVSSUFycmF5ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgc2FmZVVSSS5wdXNoKFVSSUFycmF5W2ldLnJlcGxhY2UoL1teQS1aMC05XSsvaWcsIFwiXCIpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc2FmZVVSSSA9IHRoaXMuY2hlY2tVUklTbGFzaGVzKHNhZmVVUkkuam9pbignLycpKTtcblxuICAgICAgICByZXR1cm4gc2FmZVVSSTtcbiAgICB9LFxuXG4gICAgLyogUmVtb3ZlcyB0cmFpbGluZyBzbGFzaCBhbmQgYWRkIGxlYWRpbmcgc2xhc2ggKGlmIG5lY2Vzc2FyeSkgdG8gc3RyaW5nICovXG4gICAgY2hlY2tVUklTbGFzaGVzOiBmdW5jdGlvbih1cmkpIHtcbiAgICAgICAgdmFyIGNoZWNrZWRVcmkgPSB1cmlbdXJpLmxlbmd0aCAtIDFdID09PSAnLycgPyB1cmkuc3Vic3RyaW5nKDAsIHVyaS5sZW5ndGggLSAxKSA6IHVyaTtcbiAgICAgICAgY2hlY2tlZFVyaSA9IGNoZWNrZWRVcmlbMF0gIT09ICcvJyA/ICcvJyArIGNoZWNrZWRVcmkgOiBjaGVja2VkVXJpO1xuICAgICAgICByZXR1cm4gY2hlY2tlZFVyaTtcbiAgICB9LFxuXG4gICAgLyogUmV0dXJucyB0aGUgb2JqZWN0IG9mIHRoZSBub2RlIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gVVJJIHN0cmluZyAqL1xuICAgIGZpbmROb2RlSW5Ccm93c2VUcmVlQnlVcmk6IGZ1bmN0aW9uKHVyaSkge1xuICAgICAgICAvLyBUT0RPIHRoaXMgZmVlbHMgbGlrZSBhIHV0aWxpdHkgLSBpdCBwZXJoYXBzIHNob3VsZG4ndCBsaXZlIGhlcmUgYXQgbGVhc3Q/XG4gICAgICAgIHZhciBicm93c2VUcmVlRGF0YSA9IHdvcmtzcGFjZVN0YXRlLmJyb3dzZVRyZWVEYXRhLmdldCgpLFxuICAgICAgICAgICAgbm9kZU9iamVjdCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghYnJvd3NlVHJlZURhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3I6IE5vIGJyb3dzZSB0cmVlIGRhdGEgaXMgY3VycmVudGx5IHN0b3JlZCBpbiBzdGF0ZVwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1cmkgPT09IFwiL1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gYnJvd3NlVHJlZURhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBjaGVja09uZUxheWVyKGJyb3dzZVRyZWVEYXRhLmNoaWxkcmVuKTtcblxuICAgICAgICBmdW5jdGlvbiBjaGVja09uZUxheWVyKGFycmF5KSB7XG4gICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICAgICAgICAgIGlmIChvYmplY3QudXJpID09PSB1cmkpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZU9iamVjdCA9IG9iamVjdDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIW5vZGVPYmplY3QgJiYgb2JqZWN0LmNoaWxkcmVuICYmIG9iamVjdC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrT25lTGF5ZXIob2JqZWN0LmNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2RlT2JqZWN0O1xuICAgIH1cblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB1dGlsaXRpZXM7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3NoYXJlZC91dGlsaXRpZXMvdXRpbGl0aWVzLmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpEQTtBQUNBO0FBMkRBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 65 */
/***/ function(module, exports) {

	eval("\"use strict\";\n\nvar post = function post(uri, body) {\n\n    return new Promise(function (resolve, reject) {\n\n        fetch(uri, {\n            credentials: \"include\",\n            method: \"POST\",\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body)\n        }).then(function (response) {\n            return response.json().then(function (data) {\n                if (response.ok) {\n                    return data;\n                } else {\n                    reject({ status: response.status, message: data.message });\n                }\n            });\n        }).then(function (responseJSON) {\n            resolve(responseJSON);\n        }).catch(function (fetchError) {\n            reject(fetchError);\n        });\n    });\n};\n\nmodule.exports = post;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3NoYXJlZC91dGlsaXRpZXMvcG9zdC5qcz9jNzgzIl0sInNvdXJjZXNDb250ZW50IjpbIlxudmFyIHBvc3QgPSBmdW5jdGlvbih1cmksIGJvZHkpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICBmZXRjaCh1cmksIHtcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiBcImluY2x1ZGVcIixcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7c3RhdHVzOiByZXNwb25zZS5zdGF0dXMsIG1lc3NhZ2U6IGRhdGEubWVzc2FnZX0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2VKU09OKSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlSlNPTik7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGZldGNoRXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChmZXRjaEVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gcG9zdDtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBhcHAvc2hhcmVkL3V0aWxpdGllcy9wb3N0LmpzIl0sIm1hcHBpbmdzIjoiOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 66 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar previewView = __webpack_require__(67),\n    baseUrlState = __webpack_require__(8),\n    workspaceState = __webpack_require__(25),\n    utilities = __webpack_require__(64);\n\nvar previewController = {\n\n    init: function init() {\n        var url = baseUrlState.get() + workspaceState.activeUrl.get();\n        previewView.render(url);\n        this.catchPreviewOnUnload();\n    },\n\n    catchPreviewOnUnload: function catchPreviewOnUnload() {\n        window.addEventListener(\"message\", function (event) {\n            // Only handle messages from babbage (they have the body \"load\" in the message)\n            if (event.data === \"load\") {\n                previewController.handlePreviewChange();\n            }\n        });\n    },\n\n    handlePreviewChange: function handlePreviewChange() {\n        var newPreviewUri = this.getPreviewUri();\n        workspaceState.activeUrl.set(newPreviewUri);\n        workspaceState.previewU.set(newPreviewUri);\n    },\n\n    refreshPreview: function refreshPreview() {},\n\n    updatePreview: function updatePreview(uri) {\n        previewView.render(baseUrlState.get() + uri);\n    },\n\n    getPreviewUri: function getPreviewUri() {\n        var iframeUri = document.getElementById('iframe').contentWindow.location.pathname;\n        return utilities.getSafeURI(iframeUri);\n    },\n\n    addressBar: {\n\n        set: function set(uri) {\n            var addressBar = document.getElementById('browser-location');\n            addressBar.value = baseUrlState.get() + uri;\n        }\n    }\n\n};\n\nmodule.exports = previewController;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9wcmV2aWV3L3ByZXZpZXdDb250cm9sbGVyLmpzP2I5ZTQiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHByZXZpZXdWaWV3ID0gcmVxdWlyZSgnd29ya3NwYWNlL3ByZXZpZXcvcHJldmlld1ZpZXcnKSxcbiAgICBiYXNlVXJsU3RhdGUgPSByZXF1aXJlKCdzaGFyZWQvc3RhdGUvYmFzZVVybFN0YXRlJyksXG4gICAgd29ya3NwYWNlU3RhdGUgPSByZXF1aXJlKCdzaGFyZWQvc3RhdGUvd29ya3NwYWNlU3RhdGUnKSxcbiAgICB1dGlsaXRpZXMgPSByZXF1aXJlKCdzaGFyZWQvdXRpbGl0aWVzL3V0aWxpdGllcycpO1xuXG52YXIgcHJldmlld0NvbnRyb2xsZXIgPSB7XG5cbiAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGJhc2VVcmxTdGF0ZS5nZXQoKSArIHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5nZXQoKTtcbiAgICAgICAgcHJldmlld1ZpZXcucmVuZGVyKHVybCk7XG4gICAgICAgIHRoaXMuY2F0Y2hQcmV2aWV3T25VbmxvYWQoKTtcbiAgICB9LFxuXG4gICAgY2F0Y2hQcmV2aWV3T25VbmxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAvLyBPbmx5IGhhbmRsZSBtZXNzYWdlcyBmcm9tIGJhYmJhZ2UgKHRoZXkgaGF2ZSB0aGUgYm9keSBcImxvYWRcIiBpbiB0aGUgbWVzc2FnZSlcbiAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09PSBcImxvYWRcIikge1xuICAgICAgICAgICAgICAgIHByZXZpZXdDb250cm9sbGVyLmhhbmRsZVByZXZpZXdDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGhhbmRsZVByZXZpZXdDaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBuZXdQcmV2aWV3VXJpID0gdGhpcy5nZXRQcmV2aWV3VXJpKCk7XG4gICAgICAgIHdvcmtzcGFjZVN0YXRlLmFjdGl2ZVVybC5zZXQobmV3UHJldmlld1VyaSk7XG4gICAgICAgIHdvcmtzcGFjZVN0YXRlLnByZXZpZXdVLnNldChuZXdQcmV2aWV3VXJpKTtcbiAgICB9LFxuXG4gICAgcmVmcmVzaFByZXZpZXc6IGZ1bmN0aW9uKCkge1xuXG4gICAgfSxcblxuICAgIHVwZGF0ZVByZXZpZXc6IGZ1bmN0aW9uKHVyaSkge1xuICAgICAgICBwcmV2aWV3Vmlldy5yZW5kZXIoYmFzZVVybFN0YXRlLmdldCgpICsgdXJpKTtcbiAgICB9LFxuXG4gICAgZ2V0UHJldmlld1VyaTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaWZyYW1lVXJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgICAgIHJldHVybiB1dGlsaXRpZXMuZ2V0U2FmZVVSSShpZnJhbWVVcmkpO1xuICAgIH0sXG5cbiAgICBhZGRyZXNzQmFyOiB7XG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbih1cmkpIHtcbiAgICAgICAgICAgIHZhciBhZGRyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3dzZXItbG9jYXRpb24nKTtcbiAgICAgICAgICAgIGFkZHJlc3NCYXIudmFsdWUgPSBiYXNlVXJsU3RhdGUuZ2V0KCkgKyB1cmk7XG4gICAgICAgIH1cbiAgICB9XG5cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gcHJldmlld0NvbnRyb2xsZXI7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFwcC93b3Jrc3BhY2UvcHJldmlldy9wcmV2aWV3Q29udHJvbGxlci5qcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBckNBO0FBQ0E7QUE2Q0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 67 */
/***/ function(module, exports, __webpack_require__) {

	eval("'use strict';\n\nvar template = __webpack_require__(68);\n\nvar previewView = {\n    render: function render(uri) {\n        document.getElementById('workspace-preview').innerHTML = template(uri);\n    }\n};\n\nmodule.exports = previewView;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYXBwL3dvcmtzcGFjZS9wcmV2aWV3L3ByZXZpZXdWaWV3LmpzP2I2MTgiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIHRlbXBsYXRlID0gcmVxdWlyZSgnLi9wcmV2aWV3LmhhbmRsZWJhcnMnKTtcblxudmFyIHByZXZpZXdWaWV3ID0ge1xuICAgIHJlbmRlcjogZnVuY3Rpb24odXJpKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3b3Jrc3BhY2UtcHJldmlldycpLmlubmVySFRNTCA9IHRlbXBsYXRlKHVyaSk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBwcmV2aWV3VmlldztcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYXBwL3dvcmtzcGFjZS9wcmV2aWV3L3ByZXZpZXdWaWV3LmpzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 68 */
/***/ function(module, exports, __webpack_require__) {

	eval("var Handlebars = __webpack_require__(32);\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n    var alias1=this.lambda, alias2=this.escapeExpression;\n\n  return \"<div class=\\\"browser\\\">\\n    <div class=\\\"addressbar\\\">\\n        <label for=\\\"browser-location\\\" class=\\\"browser-location-label\\\">Preview URL</label>\\n        <input id=\\\"browser-location\\\" class=\\\"browser-location\\\" type=\\\"text\\\" value=\\\"\"\n    + alias2(alias1(depth0, depth0))\n    + \"\\\">\\n        <div class=\\\"browser-location__select select-wrap select-wrap--browser\\\" id='select-vis-wrapper'>\\n            <select id='select-vis-preview'></select>\\n        </div>\\n    </div>\\n    <iframe id=\\\"iframe\\\" src=\\\"\"\n    + alias2(alias1(depth0, depth0))\n    + \"\\\">\\n    </iframe>\\n</div>\";\n},\"useData\":true});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvd29ya3NwYWNlL3ByZXZpZXcvcHJldmlldy5oYW5kbGViYXJzPzM3Y2IiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiL1VzZXJzL2NyaXNwaW5tZXJyaW1hbi9HaXQvb25zZGlnaXRhbC9mbG9yZW5jZS9zcmMvbm9kZV9tb2R1bGVzL2hhbmRsZWJhcnMvcnVudGltZS5qc1wiKTtcbmZ1bmN0aW9uIF9fZGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiAob2JqLl9fZXNNb2R1bGUgPyBvYmpbXCJkZWZhdWx0XCJdIDogb2JqKTsgfVxubW9kdWxlLmV4cG9ydHMgPSAoSGFuZGxlYmFyc1tcImRlZmF1bHRcIl0gfHwgSGFuZGxlYmFycykudGVtcGxhdGUoe1wiY29tcGlsZXJcIjpbNixcIj49IDIuMC4wLWJldGEuMVwiXSxcIm1haW5cIjpmdW5jdGlvbihkZXB0aDAsaGVscGVycyxwYXJ0aWFscyxkYXRhKSB7XG4gICAgdmFyIGFsaWFzMT10aGlzLmxhbWJkYSwgYWxpYXMyPXRoaXMuZXNjYXBlRXhwcmVzc2lvbjtcblxuICByZXR1cm4gXCI8ZGl2IGNsYXNzPVxcXCJicm93c2VyXFxcIj5cXG4gICAgPGRpdiBjbGFzcz1cXFwiYWRkcmVzc2JhclxcXCI+XFxuICAgICAgICA8bGFiZWwgZm9yPVxcXCJicm93c2VyLWxvY2F0aW9uXFxcIiBjbGFzcz1cXFwiYnJvd3Nlci1sb2NhdGlvbi1sYWJlbFxcXCI+UHJldmlldyBVUkw8L2xhYmVsPlxcbiAgICAgICAgPGlucHV0IGlkPVxcXCJicm93c2VyLWxvY2F0aW9uXFxcIiBjbGFzcz1cXFwiYnJvd3Nlci1sb2NhdGlvblxcXCIgdHlwZT1cXFwidGV4dFxcXCIgdmFsdWU9XFxcIlwiXG4gICAgKyBhbGlhczIoYWxpYXMxKGRlcHRoMCwgZGVwdGgwKSlcbiAgICArIFwiXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImJyb3dzZXItbG9jYXRpb25fX3NlbGVjdCBzZWxlY3Qtd3JhcCBzZWxlY3Qtd3JhcC0tYnJvd3NlclxcXCIgaWQ9J3NlbGVjdC12aXMtd3JhcHBlcic+XFxuICAgICAgICAgICAgPHNlbGVjdCBpZD0nc2VsZWN0LXZpcy1wcmV2aWV3Jz48L3NlbGVjdD5cXG4gICAgICAgIDwvZGl2PlxcbiAgICA8L2Rpdj5cXG4gICAgPGlmcmFtZSBpZD1cXFwiaWZyYW1lXFxcIiBzcmM9XFxcIlwiXG4gICAgKyBhbGlhczIoYWxpYXMxKGRlcHRoMCwgZGVwdGgwKSlcbiAgICArIFwiXFxcIj5cXG4gICAgPC9pZnJhbWU+XFxuPC9kaXY+XCI7XG59LFwidXNlRGF0YVwiOnRydWV9KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2FwcC93b3Jrc3BhY2UvcHJldmlldy9wcmV2aWV3LmhhbmRsZWJhcnNcbi8vIG1vZHVsZSBpZCA9IDY4XG4vLyBtb2R1bGUgY2h1bmtzID0gMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }
/******/ ]);